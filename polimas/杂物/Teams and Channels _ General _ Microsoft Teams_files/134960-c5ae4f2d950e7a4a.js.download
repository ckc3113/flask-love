"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[134960],{8122:(e,t,i)=>{var n,a;i.d(t,{E:()=>n,f:()=>a}),function(e){e.ActiveDirectoryGroupService="ActiveDirectoryGroupService",e.AiInsightsFeedbackService="AiInsightsFeedbackService",e.AppService="appservice",e.AppStudio="appstudio",e.AMS="asyncMediaService",e.AtpSafelinksService="atpSafelinksService",e.Attendee="attendee",e.AllFiles="allFiles",e.Auth="auth",e.BRB="brb",e.CDN="cdn",e.CallingConversationService="callingConversationService",e.ChannelNotificationSettings="channelNotificationSettings",e.CognitiveService="cognitiveService",e.ChatService="chatservice",e.CMDArtifactsService="cmdArtifactsService",e.CmdMeetingIntelligenceService="cmdMeetingIntelligenceService",e.CMDServices="cmdServices",e.CNS="cns",e.CollabCloudService="collabCloudService",e.CSA="csa",e.CustomEmoji="customEmoji",e.CXCS="cxcs",e.DynamicsMarketing="dynamicsMarketing",e.DynamicsVirtualEvents="dynamicsVirtualEvents",e.ECS="ecs",e.Graph="graph",e.GroupsServiceV2="groupsServiceV2",e.InstantAnswers="instantanswers",e.Loki="loki",e.LokiWrapper="lokiWrapper",e.MeetingArtifacts="meetingArtifacts",e.MeetingIntelligenceService="meetingIntelligenceService",e.MeetingRecapService="meetingRecapService",e.MeetingRecapWorkingSetFilesService="meetingRecapWorkingSetFilesService",e.MeetingRecapSwa="meetingRecapSwa",e.MeetingOptions="meetingOptionsService",e.MeetingTemplates="meetingTemplates",e.MiddleTier="mt",e.MsaContacts="msaContacts",e.MSGraph="msGraph",e.NetworkPing="networkPing",e.NotificationSettingsService="notificationSettingsService",e.OCV="ocv",e.Ocws="ocws",e.ODS="ods",e.OSearch="osearch",e.Payment="payment",e.PhonelinkSmsService="phonelinkSmsService",e.PowerApps="powerapps",e.PPTCast="pptcast",e.Registrar="registrar",e.Sharepoint="sharepoint",e.Skype="skype",e.Substrate="substrate",e.Suggestion="suggestion",e.TAMS="teamsAdminService",e.TeamsAndChannelsProvisioningService="teamsAndChannelsProvisioningService",e.TeamsPushService="teamsPushService",e.Tenants="tenants",e.UnifiedConsent="unifiedConsent",e.UnifiedPresence="unifiedPresence",e.UserEntitlement="ues",e.UserProfileService="userProfileService",e.VivaInsights="vivaInsights",e.Vroom="vroom",e.Webinar="webinar",e.Workflows="workflows",e.VivaInsightsMT="vivaInsightsMt",e.MeetingSchedulingService="schedulingService",e.Yammer="yammer"}(n||(n={})),function(e){e.xMsClientType="x-ms-client-type",e.xMsClientVersion="x-ms-client-version",e.xMsSessionId="x-ms-session-id",e.xMsRequestId="x-ms-request-id",e.xMsClientCaller="x-ms-client-caller"}(a||(a={}))},137021:(e,t,i)=>{i.d(t,{ip:()=>c,Yx:()=>m,MI:()=>u,P3:()=>p,aA:()=>v,Rr:()=>g});var n=i(781662),a=i(870017),r=i(969939),o=i(982190),s=i(300426),d=i(974509);const l="heartbeat";class c{constructor(){this.initialized=!1,this.logger=r.h.default,this.eventDecoratorCallbacks=[],this.flush=()=>this.telemetryProvider.flush(),this.telemetryProvider=(0,n.G)(),(0,a.Y)((()=>{this.initialized=!1,this.eventDecoratorCallbacks=[]}))}get sessionId(){return this.telemetryProvider.sessionId}initialize(e,t=r.h.default){this.initialized||(this.consoleLogger=e,this.consoleLogger.debug("TelemetrySender initialized."),this.logger=t,this.initialized=!0)}static getInstance(){return this.telemetrySender||(this.telemetrySender=new c),this.telemetrySender}registerEventDecorator(e){this.eventDecoratorCallbacks.push(e)}sendTelemetry(e,t,i={},n,a,r,l=""){if(!this.initialized)return;t=t.replace(/\-/g,"_").toLowerCase();const c=e===o.x.Http?i.resultCode:e===o.x.Endpoint&&i.result&&d.qb[i.result]?d.qb[i.result].toString():e===o.x.Endpoint&&i.hasInnerError?"fail":"success",m=s.H.getInstance().getSampleRate(e,null!=r?r:t,c);if(m===s.k)return;this.decorateEvent(t,i);const u=this.telemetryProvider.createEvent(e,t,i,n,a,r);u.setProperty("sampleRate",m),this.telemetryProvider.logEvent(this.logger,u,l)}sendScenarioEvent(e,t,i,n,a,r=""){var d;if(!this.initialized)return;const l=e.replace(/\-/g,"_"),c=o.x.Scenario;let m=s.H.getInstance().getSampleRate(c,l,i["Scenario.Status"]);if("Scenario.CrossClientMode"in t&&(m=null!==(d=s.H.getInstance().getCrossClientScenarioSampleRate(i["Scenario.Mode"]))&&void 0!==d?d:m),m===s.k)return;this.decorateEvent(l,t);const u=Object.assign(Object.assign({},i),t),p=this.telemetryProvider.createEvent(c,e,u,n,a);p.setProperty("sampleRate",m),this.telemetryProvider.logEvent(this.logger,p,r)}sendHeartbeatEvent(e){if(!this.initialized)return;const t=o.x.Heartbeat;this.decorateEvent(l,e);const i=this.telemetryProvider.createEvent(t,l,e);this.telemetryProvider.logEvent(this.logger,i,void 0)}sendLoggingEvent(e,t,i,n,a,r){if(!this.initialized)return;const d=o.x.Logging,l=s.H.getInstance().getSampleRate(d,i,t.logLevel);if(l===s.k)return;e=e.replace(/\-/g,"_").toLowerCase(),this.decorateEvent(e,t);const c=this.telemetryProvider.createEvent(d,e,t,a,r,i);c.setProperty("sampleRate",l),this.telemetryProvider.logEvent(this.logger,c,n)}decorateEvent(e,t){this.eventDecoratorCallbacks.forEach((i=>i(e,t)))}}function m(e,t,i,n,a,r=""){c.getInstance().sendScenarioEvent(e,t,i,n,a,r)}function u(e,t,i,n,a,r=""){c.getInstance().sendLoggingEvent(e,t,i,r,n,a)}function p(e,t,i,n,a,r,o=""){c.getInstance().sendTelemetry(e,t,i,n,a,r,o)}function v(e){c.getInstance().sendHeartbeatEvent(e)}function g(e){c.getInstance().registerEventDecorator(e)}},586990:(e,t,i)=>{i.d(t,{K:()=>C});var n,a=i(740597);!function(e){e.p720="720p",e.p1080="1080p",e.p2k="2k",e.p4k="4k",e.unkown="unkown"}(n||(n={}));const r=2073600,o=3686400,s=8294400;function d(e){var t,i,d;return(0,a.__awaiter)(this,void 0,void 0,(function*(){const a={Perf_Screen:void 0};let l;const c=e.screen.availWidth*(null===(t=e.screen)||void 0===t?void 0:t.availHeight);return l=c<r?n.p720:c>=r&&c<o?n.p1080:c>=o&&c<s?n.p2k:c>=s?n.p4k:n.unkown,a.Perf_Screen={width:null===(i=e.screen)||void 0===i?void 0:i.availWidth,height:null===(d=e.screen)||void 0===d?void 0:d.availHeight,resolution:l,dpr:e.devicePixelRatio},Promise.resolve(a)}))}var l=i(354571),c=i(50805),m=i(132756),u=i(137021),p=i(375823),v=i(422325),g=i(778161),h=i(74583);class k{constructor(e,t,i){this.hostCommunicationService=t,this.trackAppCountOnly=i,this.uuidToAppIdMap={},this.cmsObjects=[],this.logger=e.newLogger("PlatformAppsManagementService","core-services-telemetry")}getTelemetry(e){return this.getPlatformAppsStats(e)}getAppsPerfMetrics(){return(0,a.__awaiter)(this,void 0,void 0,(function*(){if(this.hostCommunicationService){const e=yield(0,v.K)(this.hostCommunicationService,this.logger,!0);return this.getPlatformAppsStats(e,!0)}}))}addCacheManagementService(e){var t,i;return this.cmsObjects.find((t=>t===e))?(null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,"addCacheManagementService: cms exists in appManagementService","platform_app_caching_cms_exists_in_app_management_service",void 0,!0),!1):(this.cmsObjects.push(e),!0)}removeCacheManagementService(e){return this.cmsObjects.splice(this.cmsObjects.indexOf(e),1),!0}addApp(e,t,i){var n,a;return this.uuidToAppIdMap.hasOwnProperty(e)?(null===(a=(n=this.logger).errorToTelemetry)||void 0===a||a.call(n,"addApp: App exists in appManagementService","platform_app_exists_in_app_management_service",{"App.Id":t},!0),!1):(this.uuidToAppIdMap[e]={appId:t,managedByCache:i},!0)}removeApp(e){var t,i;return this.uuidToAppIdMap[e]?(delete this.uuidToAppIdMap[e],!0):(null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,"removeApp: App is not in uuid map","platform_app_missing_in_uuid_map",void 0,!0),!1)}removeLeastRecentlyUsedApp(){let e;for(const t of this.cmsObjects){const i=t.getLeastRecentlyUsedApp();i&&(i.uuid&&i.timeInCache&&(void 0===e||i.timeInCache<e.timeInCache)&&(e={frameUuid:i.uuid,cmsObject:t,timeInCache:i.timeInCache}))}if(null==e?void 0:e.frameUuid){const t=this.uuidToAppIdMap[e.frameUuid];(null==t?void 0:t.appId)&&e.cmsObject.removeByAms(null==t?void 0:t.appId)}}findProcessInfo(e,t){if(!t)return;const i=e.processes.find((e=>e.processId===t));return i?{workingSetSize:i.workingSetSizeKB,commitSize:i.commitSizeKB,cpuCycleTime:i.cpuCycleTime}:void 0}computeSizeOfFrames(e){const{memoryMetrics:t,processVisitedMap:i,isActiveApp:n,appsStats:a,perAppData:r,frames:o,treeLevel:s}=e;for(const d of o){d.platformFrameUuid&&(n?a.activeAppsCount+=1:a.cachedAppsCount+=1);const o=this.findProcessInfo(t,d.processId);if(!o)return;const l=o.workingSetSize||0,c=o.commitSize||0;d.processId&&!i[d.processId]&&(i[d.processId]=d,this.addAppStatsInfo(n,l,c,a)),r.totalWorkingSetSizeKB+=l,r.totalCommitSizeKB+=c,r.maxCpuCycleTime=Math.max(r.maxCpuCycleTime,o.cpuCycleTime),r.frameInfo.push({processId:d.processId,workingSetSizeKB:o.workingSetSize,cpuCycleTime:o.cpuCycleTime,treeLevel:s}),this.computeSizeOfFrames(Object.assign(Object.assign({},e),{frames:d.frames,treeLevel:s+1}))}}isActiveApp(e){let t=!1;for(const i of this.cmsObjects){const n=i.isAppCached(e);if(void 0!==n&&(t=!n,t))break}return t}getPlatformAppsStats(e,t){const i={activeWorkingSetSizeKB:0,cachedWorkingSetSizeKB:0,activeCommitSizeKB:0,cachedCommitSizeKB:0,activeAppsCount:0,cachedAppsCount:0,appsPlatformStats:[]},n={windows:e.windows,processVisitedMap:{},memoryMetrics:e,appsStats:i,includeFrameUuid:t};if(this.trackAppCountOnly){const{cachedAppsCount:e,activeAppsCount:t}=this.processCachedAppCount();return Object.assign(Object.assign({},i),{cachedAppsCount:e,activeAppsCount:t})}return this.processMemoryInformation(Object.assign(Object.assign({},n),{computeActiveApps:!0})),this.processMemoryInformation(Object.assign(Object.assign({},n),{computeActiveApps:!1})),i}addAppStatsInfo(e,t,i,n){e?(n.activeWorkingSetSizeKB+=t,n.activeCommitSizeKB+=i):(n.cachedWorkingSetSizeKB+=t,n.cachedCommitSizeKB+=i)}processCachedAppCount(){let e=0,t=0;const i=Object.keys(this.uuidToAppIdMap);for(const n of i){const i=this.uuidToAppIdMap[n];!(null==i?void 0:i.managedByCache)||this.isActiveApp(n)?e+=1:t+=1}return{cachedAppsCount:t,activeAppsCount:e}}processMemoryInformation(e){var t;const{windows:i,computeActiveApps:n,appsStats:a,memoryMetrics:r,processVisitedMap:o,includeFrameUuid:s}=e;for(const e of i)for(const i of e.frames){if(!i.platformFrameUuid)continue;const d=this.uuidToAppIdMap[i.platformFrameUuid],l=!(null==d?void 0:d.managedByCache)||this.isActiveApp(i.platformFrameUuid);if(l===!n)continue;const c={windowId:e.windowId,isCached:!l,totalWorkingSetSizeKB:0,totalCommitSizeKB:0,maxCpuCycleTime:0,frameInfo:[],appId:null!==(t=null==d?void 0:d.appId)&&void 0!==t?t:"",platformFrameUuid:s?i.platformFrameUuid:void 0};this.computeSizeOfFrames({frames:[i],appsStats:a,memoryMetrics:r,perAppData:c,isActiveApp:l,processVisitedMap:o,treeLevel:0}),a.appsPlatformStats.push(c)}}}var S=i(382433),y=i(101027);class N{constructor(e,t,i){this.leakDetectorService=t,this.fallbackHost=i,this.logger=e.newLogger("StyleMetricsService","core-services-telemetry"),this.currentStyles=this.getCurrentStyles()}getTelemetry(){const e=this.getCurrentStyles(),t=e-this.currentStyles;return t>0&&this.logger.warn(`Style count increased by ${t} since last heartbeat. New Style count: ${e}`),this.currentStyles=e,{Style_Count:e,Style_Delta:t}}getPrimaryWindow(){var e,t;const i=null===(e=this.leakDetectorService)||void 0===e?void 0:e.getReachableObjects(y.I.UnwrappedWindow);return i&&0!==i.size?Array.from(null===(t=this.leakDetectorService)||void 0===t?void 0:t.getReachableObjects(y.I.UnwrappedWindow)).find((e=>{var t;return(null===(t=e.windowLeakInfo)||void 0===t?void 0:t.windowLeakInfoViewportContext)===S.R.primary})):this.fallbackHost}getCurrentStyles(){const e=this.getPrimaryWindow();return e?Array.from(e.document.styleSheets).filter((e=>!e.href)).flatMap((e=>Array.from(e.cssRules))).length:0}}const f=[l.pk.LongInactive],_=e=>f.includes(e),T=e=>e.map((e=>e.processId)).concat(...e.map((e=>T(e.frames)))).filter((e=>void 0!==e));class C{constructor(e){this.context=e,this.isRunning=!1,this.timeouts={},this.lastBeatTimes={},this.intervals={},this.granularNativeMetrics=[],this.granularWorkerMetrics=[],this.packedCallingData=new Map,this.peakWorkingSetByProcess=new Map,this.peakUsedJSHeapSize=0,this.granularJSHeapMetrics=[],this.getHeartbeatStandardInterval=()=>{var e,t;return null!==(t=null===(e=this._configuration)||void 0===e?void 0:e.intervalInSeconds)&&void 0!==t?t:Number.MAX_SAFE_INTEGER},this.getHeartbeatInterval=e=>{var t,i,n,a,r;const o=this.getHeartbeatStandardInterval(),s=null!==(i=null===(t=this._configuration)||void 0===t?void 0:t.maxIntervalInSeconds)&&void 0!==i?i:o,d=Math.max(1,null!==(a=null===(n=this._configuration)||void 0===n?void 0:n.delayFactor)&&void 0!==a?a:1),l=null===(r=this.context.clientState)||void 0===r?void 0:r.getState();return l&&_(l)?Math.min(s,Math.max(e,o)*d):o},this.getMemorySubInterval=()=>{var e,t,i;return null!==(i=null===(t=null===(e=this._configuration)||void 0===e?void 0:e.memoryMetricsCollection)||void 0===t?void 0:t.collectionIntervalInSeconds)&&void 0!==i?i:Number.MAX_SAFE_INTEGER},this.logger=e.loggerFactory.newLogger("Heartbeat","core-services-telemetry");const{enableAppCountTracking:t}=e.coreSettings.get(c.J.Extensibility);this.platformAppsManagementService=new k(e.loggerFactory,e.hostCommunicationService,!!t),this.styleMetricsService=new N(e.loggerFactory,e.leakDetectorService,e.windowProvider)}static getInstance(){return C.instance}get configuration(){return this._configuration}getPlatformAppsService(){return this.platformAppsManagementService}start(){return(0,a.__awaiter)(this,void 0,void 0,(function*(){C.instance||(C.instance=this,this.logger.debug("Starting the monitor..."),this.initializedTime=Date.now(),this.subscribeToCoreSettings(),this.subscribeToClientState(),yield this.registerScenarios())}))}isHeartbeatMonitorRunning(){return this.isRunning}getMemoryData(e){var t,i;return(0,a.__awaiter)(this,void 0,void 0,(function*(){if(null===(i=null===(t=this._configuration)||void 0===t?void 0:t.memoryMetricsCollection)||void 0===i?void 0:i.enabled){if(e)return this.getAverageMemoryMetrics();if(this.isRunning){const{jsHeapMetrics:e,nativeMemoryMetrics:t,hasExtraRenderer:i}=yield this.getMemoryAndJSHeapData();return Object.assign(Object.assign(Object.assign(Object.assign({},e&&(0,p.RQ)(e,this.peakUsedJSHeapSize)),t&&(0,p.Mv)(t.processes,this.peakWorkingSetByProcess,this.mainRendererProcessId)),t&&(0,p.tC)(t.workers)),{hasExtraRenderer:i})}}return{}}))}collectData(){return(0,a.__awaiter)(this,void 0,void 0,(function*(){const e=this.getActions().map((e=>(0,a.__awaiter)(this,void 0,void 0,(function*(){var t,i;try{return yield e()}catch(n){return null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`call to function '${e}' failed in heartbeat monitor.`,"fundamentals_performance_heartbeat_monitor"),{}}}))));return Object.assign.apply(Object,yield Promise.all(e))}))}collectCallingData(e,t){var i,n;const{enableCallingCDLTrackingNS:a}=this.context.coreSettings.get(c.J.Calling)||{};if(a){const e=JSON.parse(t),n={cdlData:null===(i=this.context.graphqlOpsCountService)||void 0===i?void 0:i.getLatestDataAndClear()},a=Object.assign(e,n);t=JSON.stringify(a)}this.packedCallingData.set(e,(null!==(n=this.packedCallingData.get(e))&&void 0!==n?n:[]).concat(t))}getActions(){var e,t,i,n,a,r,o,s,l,m,u,p,v,g,h,k,S,y,N,f,_,T,C,I,b,E,D,R,M;const A=[];(null===(t=null===(e=this._configuration)||void 0===e?void 0:e.memoryMetricsCollection)||void 0===t?void 0:t.enabled)&&A.push(this.getAverageMemoryMetrics.bind(this)),(null===(n=null===(i=this._configuration)||void 0===i?void 0:i.elapsedTimeTracking)||void 0===n?void 0:n.enabled)&&A.push(this.getElapsedTime.bind(this)),(null===(r=null===(a=this._configuration)||void 0===a?void 0:a.screenInfoCollection)||void 0===r?void 0:r.enabled)&&A.push(d.bind(this,this.context.windowProvider)),(null===(s=null===(o=this._configuration)||void 0===o?void 0:o.inpMetricsCollection)||void 0===s?void 0:s.enabled)&&A.push(this.getInpMetrics.bind(this)),(null===(m=null===(l=this._configuration)||void 0===l?void 0:l.ariMetricsCollection)||void 0===m?void 0:m.enabled)&&A.push(this.getAriMetrics.bind(this)),(null===(p=null===(u=this._configuration)||void 0===u?void 0:u.dataClientMetricsCollection)||void 0===p?void 0:p.enabled)&&A.push(this.getDataClientMetrics.bind(this)),(null===(g=null===(v=this._configuration)||void 0===v?void 0:v.windowMetricsCollection)||void 0===g?void 0:g.enabled)&&A.push(this.getWindowMetrics.bind(this)),(null===(k=null===(h=this._configuration)||void 0===h?void 0:h.clientStateMetricsCollection)||void 0===k?void 0:k.enabled)&&A.push(this.getClientStateMetrics.bind(this)),(null===(y=null===(S=this._configuration)||void 0===S?void 0:S.OLDMetricsCollection)||void 0===y?void 0:y.enabled)&&A.push(this.getObjectLeakDetectorMetrics.bind(this));const{enableCallingDataCollectionInHeartbeatConfig:w}=(null===(N=this.context.coreSettings)||void 0===N?void 0:N.get(c.J.Calling))||{};return w&&(null===(_=null===(f=this._configuration)||void 0===f?void 0:f.callingDataCollection)||void 0===_?void 0:_.enabled)&&A.push(this.getCallingData.bind(this)),(null===(C=null===(T=this._configuration)||void 0===T?void 0:T.graphqlStoreMetricsCollection)||void 0===C?void 0:C.enabled)&&A.push(this.getGraphQLStoreMetrics.bind(this)),(null===(b=null===(I=this._configuration)||void 0===I?void 0:I.platformAppMetricsCollection)||void 0===b?void 0:b.enabled)&&A.push(this.getPlatformAppsMetrics.bind(this)),(null===(D=null===(E=this._configuration)||void 0===E?void 0:E.styleMetricsCollection)||void 0===D?void 0:D.enabled)&&A.push(this.getStyleMetrics.bind(this)),(null===(M=null===(R=this._configuration)||void 0===R?void 0:R.vdiMetricsCollection)||void 0===M?void 0:M.enabled)&&A.push(this.getVdiMetrics.bind(this)),A}stopHeartbeat(){this.isRunning&&this.logger.debug("stopping heartbeat monitor"),Object.keys(this.timeouts).forEach((e=>{this.context.windowProvider.clearTimeout(this.timeouts[e])})),this.timeouts={},this.isRunning=!1}subscribeToCoreSettings(){const e=this.context.coreSettings.getObservable(c.J.Telemetry);let t=this.context.coreSettings.get(c.J.Telemetry).heartbeatConfiguration;e.subscribe((e=>{var i,n,a,r,o,s;const{enableHeartbeatMonitor:d,heartbeatConfiguration:l}=e;l?(this._configuration=l,this.logger.debug("Configuration loaded...",this._configuration)):null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,"'heartbeatConfiguration' not found.","fundamentals_performance_heartbeat_monitor"),d?(this.startHeartbeat(),(null===(r=null===(a=this._configuration)||void 0===a?void 0:a.memoryMetricsCollection)||void 0===r?void 0:r.enabled)||(this.context.windowProvider.clearTimeout(this.timeouts.memory),this.timeouts.memory=void 0)):(this._configuration=void 0,this.stopHeartbeat()),(null===(o=this._configuration)||void 0===o?void 0:o.intervalInSeconds)&&(null==t?void 0:t.intervalInSeconds)!==(null===(s=this._configuration)||void 0===s?void 0:s.intervalInSeconds)&&this.overrideNextBeat(),t=this._configuration}))}startHeartbeat(){!this.isRunning&&this.logger.debug("starting heartbeat monitor"),this.scheduleNextTimeout("heartbeat",this.isRunning?this.getHeartbeatInterval(0):Math.min(30,this.getHeartbeatInterval(0)),this.beat.bind(this),this.getHeartbeatInterval,!1),this.scheduleNextTimeout("memory",this.isRunning?this.getMemorySubInterval():Math.min(25,this.getMemorySubInterval()),this.collectGranularMemoryAndJSHeapData.bind(this),this.getMemorySubInterval,!1),this.isRunning=!0}overrideNextBeat(){var e,t;if(!this.isRunning)return;const i=this.getHeartbeatInterval(0)*m.B.second,n=Date.now(),a=((null!==(t=null!==(e=this.lastBeatTimes.heartbeat)&&void 0!==e?e:this.initializedTime)&&void 0!==t?t:n)+i-n)/m.B.second;this.scheduleNextTimeout("heartbeat",a>0?a:0,this.beat.bind(this),this.getHeartbeatInterval,!0)}subscribeToClientState(){const{clientState:e}=this.context;if(!e)return void this.context.windowProvider.setTimeout((()=>this.subscribeToClientState()),100);this.logger.log("Client state is available, preparing subscription");const t=e.observe();let i=e.getState();t.subscribe({next:e=>{_(i)&&!_(e)&&this.overrideNextBeat(),i=e}})}scheduleNextTimeout(e,t=Number.MAX_SAFE_INTEGER,i,n,r){const o=t*m.B.second;0<=o&&o<2147483647&&(r&&this.timeouts[e]&&(this.context.windowProvider.clearTimeout(this.timeouts[e]),this.timeouts[e]=void 0),this.timeouts[e]||(this.intervals[e]=t,this.timeouts[e]=this.context.windowProvider.setTimeout((()=>(0,a.__awaiter)(this,void 0,void 0,(function*(){var a,r;this.timeouts[e]=void 0;try{yield i()}catch(e){null===(r=(a=this.logger).errorToTelemetry)||void 0===r||r.call(a,`call to function '${i}' failed in heartbeat monitor.`,"fundamentals_performance_heartbeat_monitor")}finally{this.lastBeatTimes[e]=Date.now(),this.scheduleNextTimeout(e,n(t),i,n,!1)}}))),o)))}beat(){return(0,a.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.collectData();(0,u.aA)(e)}))}getElapsedTime(){const e=Date.now(),t=this.initializedTime||e;return{elapsed:Math.floor((e-t)/m.B.second)}}getAverageMemoryMetrics(){const e=[];if(this.granularNativeMetrics.length){const t=new Map(this.peakWorkingSetByProcess.entries());this.peakWorkingSetByProcess.clear(),this.granularNativeMetrics.reduce(((e,t)=>{var i;for(const n of t){const{processId:t}=n;e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:[]).concat(n))}return e}),new Map).forEach(((i,n)=>{var a;this.peakWorkingSetByProcess.set(n,null!==(a=t.get(n))&&void 0!==a?a:0);const r=(0,h.meanBy)(i,(e=>e.workingSetSizeKB)),o=(0,h.meanBy)(i,(e=>e.privateWorkingSetSizeKB)),s=(0,h.meanBy)(i,(e=>e.commitSizeKB)),d={processId:n,name:i[0].name,type:i[0].type,utilitySubType:i[0].utilitySubType,embeddedBrowserWebView:i[0].embeddedBrowserWebView,cpuCycleTime:i[0].cpuCycleTime,workingSetSizeKB:isNaN(r)?void 0:Math.round(r),privateWorkingSetSizeKB:isNaN(o)?void 0:Math.round(o),commitSizeKB:isNaN(s)?void 0:Math.round(s)};e.push(d)}))}const t=[];this.granularWorkerMetrics.length&&this.granularWorkerMetrics.reduce(((e,t)=>{var i;for(const n of t){const{targetSessionId:t}=n;e.set(t,(null!==(i=e.get(t))&&void 0!==i?i:[]).concat(n))}return e}),new Map).forEach(((e,i)=>{const n=(0,h.meanBy)(e,(e=>e.totalSizeKB)),a=(0,h.meanBy)(e,(e=>e.usedSizeKB)),r={targetSessionId:i,type:e[0].type,subType:e[0].subType,totalSizeKB:isNaN(n)?void 0:Math.round(n),usedSizeKB:isNaN(a)?void 0:Math.round(a)};t.push(r)}));const i=(0,p.Mv)(e,this.peakWorkingSetByProcess,this.mainRendererProcessId),n=(0,p.tC)(t);let a={};if(this.granularJSHeapMetrics.length){const e={jsHeapSizeLimit:Math.round((0,h.meanBy)(this.granularJSHeapMetrics,(e=>e.jsHeapSizeLimit||0))),totalJSHeapSize:Math.round((0,h.meanBy)(this.granularJSHeapMetrics,(e=>e.totalJSHeapSize||0))),usedJSHeapSize:Math.round((0,h.meanBy)(this.granularJSHeapMetrics,(e=>e.usedJSHeapSize||0)))};a=(0,p.RQ)(e,this.peakUsedJSHeapSize)}const r=Object.assign(Object.assign(Object.assign(Object.assign({},i),n),a),{hasExtraRenderer:this.hasExtraRenderer});return this.hasExtraRenderer=void 0,r}getInpMetrics(){const e={Perf_Inp:""};if(this.context.interactionToNextPaintService){const t=this.context.interactionToNextPaintService.getTelemetry();e.Perf_Inp=t}return e}getAriMetrics(){const e={Perf_Ari:""};if(this.context.appResponsivenessService){const t=this.context.appResponsivenessService.getTelemetry();e.Perf_Ari=t}return e}getDataClientMetrics(){const e={Perf_ApolloCacheStats:void 0};if(this.context.dataClientTrackingService){const t=this.context.dataClientTrackingService.getTelemetry();e.Perf_ApolloCacheStats=t}return e}getWindowMetrics(){const e={Perf_WindowStats:void 0};if(this.context.windowTrackerService){const t=this.context.windowTrackerService.getTelemetry();e.Perf_WindowStats=t}return e}getObjectLeakDetectorMetrics(){const e={};if(this.context.leakDetectorService){const t=this.context.leakDetectorService.getTelemetry();if(t){const{counts:i,leakStats:n,leaks:a,countsRecord:r,hasWindowLeak:o,hasApolloLeak:s}=t;e.Perf_OLDStats=i,e.Perf_LeakStats=n,e.Perf_Leaks=a,e.Perf_LeaksRecord=r,e.Perf_Leaks_HasWindowLeak=o,e.Perf_Leaks_HasApolloLeak=s}}return e}getClientStateMetrics(){const e={Perf_IsUserInCall:void 0};if(this.context.clientState){const t=this.context.clientState.getState()===l.pk.VeryActive;e.Perf_IsUserInCall=t}return e}getCallingData(){const e={Perf_Calling_Data:void 0};return this.packedCallingData.forEach((t=>{e.Perf_Calling_Data?e.Perf_Calling_Data.push(...t):e.Perf_Calling_Data=t})),this.packedCallingData.clear(),e}getGraphQLStoreMetrics(){const e={};return this.context.graphqlStoreStatsReporterService&&(e.Perf_GraphQLStoreStats=this.context.graphqlStoreStatsReporterService.getTelemetry()),e}getPlatformAppsMetrics(){let e={};if(this.lastMemoryMetrics){const t=this.platformAppsManagementService.getTelemetry(this.lastMemoryMetrics);e={Perf_PlatformApps_Active_WorkingSet:t.activeWorkingSetSizeKB,Perf_PlatformApps_Cached_WorkingSet:t.cachedWorkingSetSizeKB,Perf_PlatformApps_Active_Commit_Size:t.activeCommitSizeKB,Perf_PlatformApps_Cached_Commit_Size:t.cachedCommitSizeKB,Perf_PlatformApps_Count_CachedApps:t.cachedAppsCount,Perf_PlatformApps_Count_ActiveApps:t.activeAppsCount,Perf_PlatformApps_Stats:t.appsPlatformStats}}return e}getStyleMetrics(){return this.styleMetricsService.getTelemetry()}getVdiMetrics(){var e,t,i;return{vdiMode:null!==(i=null===(t=null===(e=this.context.platformService)||void 0===e?void 0:e.config.vdi)||void 0===t?void 0:t.mode)&&void 0!==i?i:"0"}}getMemoryAndJSHeapData(){var e,t,i,n,r,o,s;return(0,a.__awaiter)(this,void 0,void 0,(function*(){let a,d,l;if(this.context.hostCommunicationService){a=yield(0,v.K)(this.context.hostCommunicationService,this.logger,(null===(t=null===(e=this._configuration)||void 0===e?void 0:e.workerMetricsCollection)||void 0===t?void 0:t.enabled)||!1);const n=[];let r=0;for(const e of a.processes){const{type:t,isMainRenderer:i,processId:a}=e;"renderer"===t.toLowerCase()&&(i&&(r=a),n.push(e))}this.mainRendererProcessId=this.mainRendererProcessId&&n.find((e=>e.processId===this.mainRendererProcessId))?this.mainRendererProcessId:r||(null===(i=n.sort(((e,t)=>{var i,n;return(null!==(i=t.workingSetSizeKB)&&void 0!==i?i:0)-(null!==(n=e.workingSetSizeKB)&&void 0!==n?n:0)}))[0])||void 0===i?void 0:i.processId);const o=a.windows.flatMap((e=>[e.processId,...T(e.frames)]));l=n.length>0&&!n.every((e=>e.isMainRenderer||o.includes(e.processId)))}else null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,"Invalid hostCommunicationService, cannot get native metrics from Desktop","fundamentals_performance_heartbeat_monitor");return this.context.windowProvider?d=(0,g.P)(this.context.windowProvider):null===(s=(o=this.logger).errorToTelemetry)||void 0===s||s.call(o,"Invalid windowProvider, cannot get js metrics from window","fundamentals_performance_heartbeat_monitor"),{nativeMemoryMetrics:a,jsHeapMetrics:d,hasExtraRenderer:l}}))}collectGranularMemoryAndJSHeapData(){var e;return(0,a.__awaiter)(this,void 0,void 0,(function*(){const{nativeMemoryMetrics:t,jsHeapMetrics:i,hasExtraRenderer:n}=yield this.getMemoryAndJSHeapData(),a=null!==(e=this.intervals.heartbeat)&&void 0!==e?e:this.getHeartbeatStandardInterval(),r=Math.max(Math.round(a/this.getMemorySubInterval()),1)||1;if(t){this.lastMemoryMetrics=t,this.granularNativeMetrics=this.granularNativeMetrics.concat([t.processes]).slice(-r),this.granularWorkerMetrics=this.granularWorkerMetrics.concat([t.workers]).slice(-r);for(const e of t.processes){const{processId:t}=e,i=this.peakWorkingSetByProcess.get(t);this.peakWorkingSetByProcess.set(t,Math.max(i||0,e.workingSetSizeKB||0))}}i&&(this.peakUsedJSHeapSize=Math.max(this.peakUsedJSHeapSize,i.usedJSHeapSize||0),this.granularJSHeapMetrics=this.granularJSHeapMetrics.concat(i).slice(-r)),this.hasExtraRenderer||(this.hasExtraRenderer=n)}))}registerScenarios(){return(0,a.__awaiter)(this,void 0,void 0,(function*(){if(this.context.hostCommunicationService){const e=yield this.context.hostCommunicationService.loadModule("heartbeat");if(null==e?void 0:e.registerForScenarioStart)try{e.registerForScenarioStart((e=>{}))}catch(e){this.logger.error("Failed to register for listening to host scenarios starting")}if(null==e?void 0:e.registerForScenarioStop)try{e.registerForScenarioStop((e=>{}))}catch(e){this.logger.error("Failed to register for listening to host scenarios stopping")}}}))}}C.instance=void 0},534380:(e,t,i)=>{i.d(t,{E:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppButtonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appButtonResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"action"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"AppButtonResult"}}}]}}]}},743107:(e,t,i)=>{i.d(t,{i:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformBackButtonHandlerStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"backButtonHandlerState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"registered"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"BackButtonHandlerState"}},arguments:[]}]}}]}},858453:(e,t,i)=>{i.d(t,{L:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformChangeSettingsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSettingsResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"status"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tabId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ChangeSettingsResult"}}}]}}]}},210439:(e,t,i)=>{i.d(t,{N:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformChangeSettingsTriggerQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSettingsTriggerResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tabId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"message"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ChangeSettingsTriggerResult"}}}]}}]}},691584:(e,t,i)=>{i.d(t,{O:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformLocalFrameContextQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"localFrameContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"threadId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"messageId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tabId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"websiteUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"contentUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"LocalFrameContext"}},arguments:[]}]}}]}},324029:(e,t,i)=>{i.d(t,{i:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"mapCoordinateResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mapCoordinateResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"latitude"},__type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"longitude"},__type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"locationApiError"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"MapCoordinateResult"}},arguments:[]}]}}]}},56818:(e,t,i)=>{i.d(t,{n:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messageToChildResult"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageToChildResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"message"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"messageToChildResult"}}}]}}]}},24756:(e,t,i)=>{i.d(t,{y:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messageToParentResult"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageToParentResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"message"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"messageToParentResult"}}}]}}]}},516102:(e,t,i)=>{i.d(t,{a:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"selectMediaResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectMediaResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectMediaError"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"mediaUrls"},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SelectMediaResult"}},arguments:[]}]}}]}},933246:(e,t,i)=>{i.d(t,{k:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"selectPeoplePickerResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectPeoplePickerResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"email"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SelectPeoplePickerResult"}}}}},arguments:[]}]}}]}},607036:(e,t,i)=>{i.d(t,{F:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"showLocationResponse"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showLocationResponse"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}}]}},47101:(e,t,i)=>{i.d(t,{sR:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"taskModuleResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"taskModuleResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"card"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"content"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"contentType"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"locale"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"PlatformCard"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"adaptiveCardTabResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"content"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"contentType"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"locale"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"PlatformCard"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"text"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"taskModuleId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"draftId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"conversationId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"reason"},__type:{kind:"NamedType",name:{kind:"Name",value:"TaskModuleClosedReason"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"entryPoint"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TaskModuleEntryPoints"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"TaskModuleResult"}},arguments:[]}]}}]}},166031:(e,t,i)=>{i.d(t,{R:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"viewImagesResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewImagesResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewImagesError"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"errorCode"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ViewImagesResult"}},arguments:[]}]}}]}},321748:(e,t,i)=>{i.d(t,{q8:()=>c,dR:()=>m,Zl:()=>u});var n=i(740597),a=i(765923),r=i(905581),o=i(132756),s=i(738646);const d="Browser does not support IndexedDB APIs",l="Error in indexedDB open request";function c(e,t,i,c,m,u){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n;const v=(0,a.J)().indexedDB,g=new Promise(((a,g)=>{const h=m.newScenario(s.RG.IndexedDBFetch);h.appendEventData({dataSource:i});try{v||g((0,r.Tr)(o.w5.IndexDb,o.jK.IndexDbException,d)),n=v.open(e,t),n.onerror=()=>{g((0,r.Tr)(o.w5.IndexDb,o.jK.IndexDbException,l))},n.onupgradeneeded=e=>{p(t,i,c,n,e,a,g,h)},n.onsuccess=function(e,t,i,n,a,s,d){return()=>{try{const l=e.result,c=l.transaction([t]).objectStore(t),m=d?c.getAll():c.get(i);m.onsuccess=e=>{l.close(),n.stop();const t=e.target.result;a(d?t:t&&(t.value||m.result))},m.onerror=()=>{l.close(),n.fail(),s((0,r.Tr)(o.w5.IndexDb,o.jK.IndexDbException,"Error trying to get chat service sync end point from indexedDB"))}}catch(e){n.fail(),s((0,r.Tr)(o.w5.IndexDb,o.jK.IndexDbException,`Failed to read from '${t}' object store on the indexedDB.`))}}}(n,i,c,h,a,g,u)}catch(e){h.fail({errors:e.message}),g(e)}}));return g}))}function m(e,t,i,r,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){{let n;const l=(0,a.J)().indexedDB;return new Promise(((a,c)=>{const m=o.newScenario(s.RG.IndexedDBDelete);m.appendEventData({dataSource:i});try{l||c(new Error(d)),n=l.open(e,t),n.onerror=()=>{c(new Error(d)),m.fail({errors:d})},n.onsuccess=()=>{!function(e,t,i,n,a){try{const r=e.result,o=r.transaction([t],"readwrite"),s=o.objectStore(t).clear();s.onsuccess=e=>{r.close(),i.stop(),n(e.target.result)},s.onerror=e=>{r.close(),i.fail(),a(`Error trying to delete data from indexedDB: ${e}`)}}catch(e){i.fail(),a(`Error trying to delete data from indexedDB: ${e}`)}}(n,i,m,a,c)},n.onupgradeneeded=e=>{p(t,i,r,n,e,a,c,m)}}catch(e){m.fail({errors:e.message}),c(e)}}))}}))}function u(e,t,i,r,o,l){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n;const c=(0,a.J)().indexedDB,m=new Promise(((a,m)=>{const u=l.newScenario(s.RG.IndexedDBWrite);u.appendEventData({dataSource:i});try{c||m(new Error(d)),n=c.open(e,t),n.onerror=()=>{m(new Error(d)),u.fail({errors:d})},n.onsuccess=()=>{!function(e,t,i,n,a,r){try{const o=e.result,s=o.transaction([t],"readwrite").objectStore(t);let d;i.forEach((e=>{d=s.put(e),d.onsuccess=e=>{o.close(),n.stop(),a(e.target.result.value)},d.onerror=e=>{o.close(),n.fail(),r(`Error trying to write into indexedDB: ${e}`)}}))}catch(e){n.fail(),r(`Error trying to write into indexedDB: ${e}`)}}(n,i,o,u,a,m)},n.onupgradeneeded=e=>{p(t,i,r,n,e,a,m,u)}}catch(e){u.fail({errors:e.message}),m(e)}}));return m}))}function p(e,t,i,n,a,r,o,d){try{a.oldVersion<e&&n.result.createObjectStore(t,{keyPath:i}),d.mark(s.ck.IndexedDBUpgrade),r()}catch(e){d.fail(),o(`Failed to create object stores on the indexedDB: ${e}`)}}},658630:(e,t,i)=>{i.r(t),i.d(t,{cloudDomains:()=>n,CrossCloudUtils:()=>c});const n={publicCommercialCloud:"teams.microsoft.com",gccHighCloud:"gov.teams.microsoft.us",dodCloud:"dod.teams.microsoft.us",dev:"local.teams.office.com",devLive:"local.teams.live.com",liveCloud:"teams.live.com",ag08Cloud:"https://teams.eaglex.ic.gov",ag09Cloud:"https://teams.microsoft.scloud"},a=/^(\s|\/)+|(\s|\/)+$/g,r={pathNamesLength:4,threadIDIndex:2,secondPathName:"meetup-join"},o={pathNamesLength:2,meetingIDIndex:1,firstPathName:"meet"};function s(e,t){return[n.dev,n.publicCommercialCloud].includes(t)?[n.devLive,n.liveCloud].includes(e):!![n.devLive,n.liveCloud].includes(t)&&[n.dev,n.publicCommercialCloud].includes(e)}function d(e,t){let i;try{i=new URL(e)}catch(e){return!1}const n=i.pathname.replace(a,"").split("/"),d=i.hostname;return!((n.length!==r.pathNamesLength||n[1]!==r.secondPathName||!n[r.threadIDIndex])&&(n.length!==o.pathNamesLength||n[0]!==o.firstPathName||!n[o.meetingIDIndex]))&&s(d,t)}function l(e){return e.substring(e.lastIndexOf(":")+1)}const c={getMeetingLegacyURL:function(e){const{tenantId:t,organizerId:i,meetingCloud:n,conversationId:a,rootMessageId:r,messageId:o}=e,s=encodeURIComponent(a),d=encodeURIComponent(r),c=o||void 0,m=encodeURIComponent(JSON.stringify({Tid:t,Oid:i?l(i):"",MessageId:c}));if(s&&d&&i&&t&&n)return`https://${n}/l/meetup-join/${s}/${d}?context=${m}`},isCrossCloudMeetingJoinAttempt:function(e,t){return!(!e||t===e||s(e,t)||t===n.dev&&e===n.publicCommercialCloud||t===n.devLive&&e===n.liveCloud)},isCrossCloudMeetingJoinAttemptBetweenTFLAndTFW:s,isCrossCloudMeetingJoinBetweenTFLAndTFWAllowed:d,isDeepLinkExecutionForCrossCloudMeetingJoinBetweenTFLAndTFWAllowed:function(e,t,i){let n,a;try{n=new URL(e).hostname,a=i&&d(t,n)}catch(e){a=!1}return a},isLegacyMeetingUrl:function(e){let t;try{t=new URL(e)}catch(e){return!1}const i=t.pathname.replace(a,"").split("/");return i.length===r.pathNamesLength&&i[1]===r.secondPathName&&!!i[r.threadIDIndex]},isTFWDomain:function(e){return[n.dev,n.publicCommercialCloud].includes(e)},stripMriPrefix:l,isTFLMeetingURL:function(e){try{let t;return e&&(t=new URL(e)),[n.liveCloud,n.devLive].includes(null==t?void 0:t.host)}catch(e){return!1}}}},74187:(e,t,i)=>{i.d(t,{zm:()=>n,py:()=>a,WK:()=>r,bW:()=>l,x$:()=>c,Zk:()=>m,OO:()=>u});var n,a,r,o,s,d=i(132756);!function(e){e.logErrorMessage="errorMessage",e.internalErrorCode="errorCode",e.correlationId="correlationId",e.httpStatusCode="httpStatusCode",e.isRecoverable="isRecoverable",e.reportingService="reportingService",e.subError="subError",e.serviceErrorMessage="serviceErrorMessage",e.cmdRequestId="requestId"}(n||(n={})),function(e){e.UNKNOWN_ERROR="UnknownError",e.FORBIDDEN="Forbidden",e.NOT_FOUND="NotFound",e.CONFLICT="Conflict",e.UNAUTHORIZED="Unauthorized",e.BAD_REQUEST="BadRequest",e.INTERNAL_SERVER_ERROR="InternalServerError",e.SERVICE_UNAVAILABLE="ServiceUnavailable",e.REQUEST_THROTTLED="RequestThrottled",e.FAILED_TO_CALL_SCHEDULING_SERVICE="FailedToCallSchedulingService",e.GATEWAY_TIMEOUT="GatewayTimeout",e[e.DEFAULT_ERROR=1e3]="DEFAULT_ERROR",e[e.BEGIN_CLIENT_ERROR_CODES=1001]="BEGIN_CLIENT_ERROR_CODES",e[e.INVALID_RESPONSE=1002]="INVALID_RESPONSE",e[e.CHANGE_KEY_NOT_FOUND=1003]="CHANGE_KEY_NOT_FOUND",e[e.EMPTY_INPUT=1004]="EMPTY_INPUT",e[e.INVALID_SECRET=1005]="INVALID_SECRET",e[e.RENEW_TOKEN_FAILED=1006]="RENEW_TOKEN_FAILED"}(a||(a={})),function(e){e.DEFAULT_BAD_REQUEST="Request is not correct, please ensure you are passing the values for each parameter.",e.DEFAULT_ERROR="Unknown error occurred",e.COLLAB_OBJECT_NOT_FOUND="Collab object could not be found for the provided external entity key",e.RESOURCE_CONFLICT="Resource conflicts with another; location URLs must be unique",e.EMPTY_INPUT="Input is empty",e.INVALID_SECRET="Invalid Secret while trying to commit resource",e.FORBIDDEN="User does not have permissions to access the requested resource",e.INVALID_RESPONSE="Response from CMD Artifact service is not valid.",e.CHANGE_KEY_NOT_FOUND="No change key in collab object returned.",e.UNAUTHORIZED="User does not have permissions to perform the requested action",e.INTERNAL_SERVER_ERROR="An error occurred with Artifacts service",e.SERVICE_UNAVAILABLE="Service is not currently available.",e.REQUEST_THROTTLED="Requests to the artifacts service are being throttled.",e.FAILED_TO_CALL_SCHEDULING_SERVICE="Artifact service was not able to call scheduling service",e.GATEWAY_TIMEOUT="A downstream service is timing out."}(r||(r={})),function(e){e.RESOURCE_CONFLICT="Conflict - Reason: Conflict",e.BAD_REQUEST="Bad Request",e.NOT_FOUND="NotFound - Reason: Not Found",e.FORBIDDEN="Permission Issue"}(o||(o={})),function(e){e.POPUP_BLOCKED="Error opening popup",e.RENEW_TOKEN_FAILED="Token Renewal Failed"}(s||(s={}));const l="Unknown",c="None",m="None",u=(new Map([[s.POPUP_BLOCKED,d.jK.AuthPopupWindowBlocked],[s.RENEW_TOKEN_FAILED,a.RENEW_TOKEN_FAILED]]),new Map([[a.UNKNOWN_ERROR,r.DEFAULT_ERROR],[a.CONFLICT,r.RESOURCE_CONFLICT],[a.NOT_FOUND,r.COLLAB_OBJECT_NOT_FOUND],[a.BAD_REQUEST,r.DEFAULT_BAD_REQUEST],[a.FORBIDDEN,r.FORBIDDEN],[a.UNAUTHORIZED,r.UNAUTHORIZED],[a.INTERNAL_SERVER_ERROR,r.INTERNAL_SERVER_ERROR],[a.SERVICE_UNAVAILABLE,r.SERVICE_UNAVAILABLE],[a.REQUEST_THROTTLED,r.REQUEST_THROTTLED],[a.INVALID_RESPONSE,r.INVALID_RESPONSE],[a.CHANGE_KEY_NOT_FOUND,r.CHANGE_KEY_NOT_FOUND],[a.FAILED_TO_CALL_SCHEDULING_SERVICE,r.FAILED_TO_CALL_SCHEDULING_SERVICE],[a.GATEWAY_TIMEOUT,r.GATEWAY_TIMEOUT]]))},541986:(e,t,i)=>{i.d(t,{H:()=>r,P:()=>o});var n=i(50805);const a=["msteams:","ms-teams:"];function r(e,t,i=!1){const{deepLinkDomains:a,deepLinkPaths:r,supportHashDeeplinks:o}=t.get(n.J.Messaging),s=i?[""]:r||[];let d=a||[];return i||(d=d.concat(function(e){const{enableCrossCloudLaunch:t}=e.get(n.J.Core);if(!t)return[];const i=null==e?void 0:e.get(n.J.Auth).cloudDomainMap;if(!i)return[];const a=i.map((e=>`https://${e.domain}`));return a}(t))),c({url:e,deepLinkDomains:d,deepLinkPaths:s,supportHashDeeplinks:!!o,coreSettings:t})}function o(e,t){if(a.includes(e.protocol)){const i=t.get(n.J.Host).deepLinkDomain||void 0,a=s(e,t)||i;return new URL(`${e.pathname}${e.search}${e.hash}`,a)}return e}const s=(e,t)=>{const{enableOriginValidationForIncomingIntents:i}=t.get(n.J.Core);if(!i||"null"!==e.origin)return e.origin;if(!a.includes(e.protocol))return;const r=e.searchParams.get("fqdn");return r?new URL(`https://${r}`).origin:"null"===e.origin&&e.hostname?new URL(`https://${e.hostname}`).origin:void 0},d=(e,t,i,n)=>{const a=s(e,n);return!(a&&a!==t.origin||!e.pathname.startsWith(i))},l=(e,t,i)=>{const n=s(e,i);return!(n&&n!==t.origin||!e.hash||"/_"!==e.pathname)},c=({url:e,deepLinkDomains:t,deepLinkPaths:i,supportHashDeeplinks:n,coreSettings:a})=>{for(const r of t)for(const t of i){let i,o;try{i=new URL(e),o=new URL(t,r)}catch(e){return!1}if(d(i,o,t,a))return!0;if(n&&l(i,o,a))return!0}return!1}},303307:(e,t,i)=>{i.d(t,{z:()=>n});const n=(e,t)=>{if(e&&t){const t=/^(.*); expires=(.*); path=\/$/,i=2,n=e.match(t);if(n){return new Date(n[i]).getTime()>Date.now()}}return!1}},298117:(e,t,i)=>{i.d(t,{Q:()=>o});var n=i(475230);const a=new RegExp(n.yH.oneDriveFile),r=new RegExp(n.yH.sharePointFile),o=(e,t)=>{if(t){const i=t.replace(n.yH.leadingAndTrailingSlashesRegex,"").split("/");i.pop();const a=i.join("/");return`${new URL(e).origin}/${a}/`}if(r.test(e)){const t=e.match(r);return t?t[0]:null}if(a.test(e)){const t=e.match(a);return t?t[0]:null}if(e){const t=e.split("/"),i=2;if(t.length>=i)return`${t[0]}//${t[i]}/`}return e}},385589:(e,t,i)=>{i.d(t,{X:()=>a});var n=i(475230);const a=e=>{switch(e){case n.Bx.unauthorizedAccess:return!1;case n.Bx.clientError:case n.Bx.badRequest:case n.Bx.internalServerError:case n.Bx.serviceUnavailable:case n.Bx.tooManyRequests:return!0;default:return!1}}},778161:(e,t,i)=>{i.d(t,{P:()=>a});var n=i(375823);function a(e){const t=e.performance;let i,a,r;const o=null==t?void 0:t.memory;return o&&(i=(0,n.kl)(o.jsHeapSizeLimit),a=(0,n.kl)(o.totalJSHeapSize),r=(0,n.kl)(o.usedJSHeapSize)),{jsHeapSizeLimit:i,totalJSHeapSize:a,usedJSHeapSize:r}}},422325:(e,t,i)=>{i.d(t,{K:()=>o});var n=i(740597),a=i(375823);const r="heartbeat";function o(e,t,i){var o,s;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n={workers:[],processes:[],windows:[]},d=yield null==e?void 0:e.loadModule(r);if(!(null==d?void 0:d.getPerfMetrics))return n;try{let e;if(i&&d.getPerfMetricsAsync){const t=yield d.getPerfMetricsAsync();e=t.processes,n.windows=t.windows;for(const e of t.workers)n.workers.push({targetSessionId:e.targetSessionId,type:e.type,subType:e.subType,totalSizeKB:(0,a.kl)(e.totalSizeBytes),usedSizeKB:(0,a.kl)(e.usedSizeBytes)})}else e=yield d.getPerfMetrics();for(const t of e)n.processes.push({processId:t.processId,name:t.name,type:t.type,utilitySubType:t.utilitySubType,embeddedBrowserWebView:t.embeddedBrowserWebView,cpuCycleTime:t.cpuCycleTime,workingSetSizeKB:(0,a.kl)(t.workingSetSizeBytes),privateWorkingSetSizeKB:(0,a.kl)(0===t.privateWorkingSetSizeBytes?void 0:t.privateWorkingSetSizeBytes),commitSizeKB:(0,a.kl)(t.pageFileUsageBytes),isMainRenderer:null!==(o=t.isMainRenderer)&&void 0!==o&&o})}catch(e){null===(s=t.errorToTelemetry)||void 0===s||s.call(t,"get-webview-2-metrics, getMetrics: Failed to get metrics.","fundamentals_performance_get_webview2_metrics")}return n}))}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/134960-c5ae4f2d950e7a4a.js.map