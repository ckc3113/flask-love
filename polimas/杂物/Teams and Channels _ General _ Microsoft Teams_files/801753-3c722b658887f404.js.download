"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[801753],{455572:(e,t,n)=>{var i,a,r,o,s,l,d,c,u,g,m,p,h,v,y,f,C,T,b,S,I;n.d(t,{OV:()=>i,Qf:()=>a,Ml:()=>r,z7:()=>s,Wz:()=>l,Zc:()=>d,XR:()=>c,cb:()=>u,Lv:()=>g,oW:()=>m,$g:()=>p,hD:()=>v,DC:()=>y,_v:()=>f,zP:()=>C,Dz:()=>T,xu:()=>b,UE:()=>S}),function(e){e.Work="",e[e.Freemium=2]="Freemium",e[e.Life=3]="Life"}(i||(i={})),function(e){e.Personal="personal",e.Channel="channel",e.Unknown="unknown"}(a||(a={})),function(e){e.GuardianChat="GuardianChat"}(r||(r={})),function(e){e[e.anonymous=0]="anonymous",e[e.default=1]="default",e[e.guest=2]="guest",e[e.msaGuest=3]="msaGuest",e[e.msaMember=4]="msaMember",e[e.otpGuest=5]="otpGuest",e[e.otpMember=6]="otpMember"}(o||(o={})),function(e){e[e.Admin=0]="Admin",e[e.Anonymous=1]="Anonymous",e[e.Guest=2]="Guest",e[e.Regular=3]="Regular"}(s||(s={})),function(e){e.x64="x64",e.ia32="ia32",e.x86="x86",e.unknown="unknown"}(l||(l={})),function(e){e.MACOSX="UNIX/MACINTOSH",e.UNIX="UNIX",e.UNKNOWN="Unknown",e.WINDOWS="Windows"}(d||(d={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(c||(c={})),function(e){e.background="background",e.foreground="foreground"}(u||(u={})),function(e){e.maximized="maximized",e.minimized="minimized",e.systray="systray"}(g||(g={})),function(e){e.copy="Copy"}(m||(m={})),function(e){e.nav="nav",e.notification="notification"}(p||(p={})),function(e){e.Cold="cold",e.Warm="warm"}(h||(h={})),function(e){e.TopLevel="L1",e.DrillDown="L2"}(v||(v={})),function(e){e.SettingsPrivacyPage="SettingsPrivacyPage",e.LpcMeProfileCard="LpcMeProfileCard"}(y||(y={})),function(e){e.tflExternal="TFLExternal",e.tfwUser="TFWUser"}(f||(f={})),function(e){e.addMembers="addMembers",e.pinChannel="pinChannel",e.unpinChannel="unpinChannel",e.favoriteChannel="favoriteChannel",e.manageChannel="manageChannel",e.getChannelEmail="getChannelEmail",e.getChannelLink="getChannelLink",e.editChannel="editChannel",e.editChannelConnectors="editChannelConnectors",e.editChannelWorkflows="editChannelWorkflows",e.deleteChannel="deleteChannel",e.leaveChannel="leaveChannel",e.toggleChannelOrder="toggleChannelOrder",e.archiveChannel="archiveChannel",e.unarchiveChannel="unarchiveChannel"}(C||(C={})),function(e){e.pinned="pinned",e.shown="shown",e.hidden="hidden"}(T||(T={})),function(e){e.Regular="Regular",e.Private="Private",e.Shared="Shared",e.Standalone="Standalone"}(b||(b={})),function(e){e.General="General",e.NotGeneral="NotGeneral"}(S||(S={})),function(e){e.Unknown="Unknown",e.VSB="VSB",e.MM="MM",e.Lrg="Lrg"}(I||(I={}))},656690:(e,t,n)=>{var i,a,r,o,s,l;n.d(t,{rY:()=>i,cr:()=>a,Gx:()=>r,H:()=>s,C3:()=>l}),function(e){e.ExpandTab="expandTab",e.UndoExpandTab="undoExpandTab",e.MaximizeTab="maximizeTab",e.UndoMaximizeTab="undoMaximizeTab",e.WindowInitialized="windowInitialized",e.WindowErrored="windowErrored",e.GetAadToken="aadGetToken",e.Login="login",e.GetDriveItemResponse="getDriveItemResponse",e.GetAadCurrentUser="aadCurrentUser",e.AadClearCacheForResource="aadClearCache",e.GetStateData="getStateData",e.GetLogs="getLogs",e.GetSettings="getSettings",e.TriggerAutoBrb="triggerAutoBrb",e.ShouldShowChatNotification="shouldShowChatNotification",e.GetLeaks="getLeaks",e.GetMemory="getMemory",e.UpdateWindowState="updateWindowState",e.AppStateSyncMessage="appStateSyncMessage",e.CentralDataLayerRequest="centralDataLayer:request",e.CentralDataLayerResponse="centralDataLayer:response",e.ScreenSharingControlMessage="screenSharing:controlMessage",e.HideFileViewerLoader="hideFileViewerLoader",e.StopDocStageScenario="stopDocStageScenario",e.AddScenarioMarker="addScenarioMarker",e.FilesExperienceSendData="filesExperience:sendData",e.FilesExperienceRequestData="filesExperience:requestData",e.ActivityEvent="activityEvent",e.GetAggregatedSettings="getAggregatedSettings",e.SetAggregatedSettings="setAggregatedSettings",e.GetWindowLaunchSubSteps="getWindowLaunchSubSteps",e.CreateWebview="createWebview",e.UnhandledMouseEvent="unhandledMouseEvent",e.GetHeartbeat="getHeartbeat",e.GetApolloCacheStats="getApolloCacheStats",e.GetCdlStats="getCdlStats",e.GetWindowEntityTypeStats="getWindowEntityTypeStats",e.SetTouchBar="set-touch-bar",e.ClearTouchBar="clear-touch-bar",e.LayoutChangeMessage="layoutChangeMessage",e.UnhandledShortcut="unhandledShortcut",e.NavigateToOpenerLandmark="NavigateToOpenerLandmark",e.NavigateToLandmark="NavigateToLandmark",e.HybridRouteNavigation="hybridRouteNavigation",e.FocusManagementEvent="focusManagementEvent",e.FocusResetEvent="focusResetEvent",e.CdlRegistration="cdlRegistration",e.NotificationBannerUpdate="NotificationBannerUpdate",e.EntityCommandTimedOutAtHost="entityCommandTimedOutAtHost",e.ActivateOutlook="activateOutlook",e.RequestTabMetrics="requestTabMetrics",e.SendWebviewIdentity="sendWebviewIdentity",e.HasDevicePermissions="hasDevicePermissions",e.HasDevicePermissionsCallback="hasDevicePermissionsCallback"}(i||(i={})),function(e){e.GlobalWindowError="error",e.UnhandledRejection="unhandledrejection"}(a||(a={})),function(e){e.Create="createIframe",e.Destroy="destroyIframe",e.ChildReady="iframeReady",e.Acquired="iframeAcquired",e.ToggleMinimized="toggleChatMinimize"}(r||(r={})),function(e){e.ConversationOpened="conversationOpened",e.CreateNewConversation="createNewConversation",e.EmbedClientInitializationSuccess="embedClientInitializationSuccess",e.EmbedClientInitializationFail="embedClientInitializationFail",e.NewConversationResolved="newConversationResolved",e.SetFocusOnChatList="setFocusOnChatList",e.UpdateSettings="UpdateSettings",e.ShowCoreIFrame="ShowCoreIFrame",e.HideCoreIFrame="HideCoreIFrame",e.TeamsPreAuthComplete="teamsPreAuthComplete",e.ContinueWithTeamsCoreTasks="continueWithTeamsCoreTasks"}(o||(o={})),function(e){e.LogoutSuccess="logoutSuccessful",e.LogoutFailed="logoutFailed",e.Logout="logout"}(s||(s={})),function(e){e.TrustedUIInit="trusted-ui:init",e.TrustedUIResize="trusted-ui:resize",e.TrustedUIRendered="trusted-ui:rendered",e.TrustedUIError="trusted-ui:error"}(l||(l={}))},916987:(e,t,n)=>{n.d(t,{NP:()=>H,b6:()=>j,Hi:()=>G,xA:()=>Q,FX:()=>V,Rx:()=>q,Kn:()=>Y,eH:()=>ee,OB:()=>te,is:()=>re,YU:()=>ue,it:()=>ge,H4:()=>he,Ey:()=>ve,dx:()=>ye,zK:()=>fe,Th:()=>Ce,TK:()=>Te,iB:()=>be,q7:()=>Se,Gt:()=>Ie,yU:()=>Me,ac:()=>we,xr:()=>Ue,CH:()=>ke,J$:()=>Ae,bv:()=>Ne,wX:()=>Fe,ob:()=>Be,sf:()=>Re,fN:()=>We,FH:()=>Ve,pR:()=>qe,b_:()=>Ye,zT:()=>Xe,vI:()=>Ke,Qq:()=>Ze,I6:()=>et,AY:()=>at,nF:()=>ot,Lr:()=>lt,_$:()=>dt,x6:()=>ct,Hl:()=>ut,lg:()=>gt,_S:()=>mt,t4:()=>pt,ph:()=>ht,O5:()=>yt,eN:()=>Ct,YX:()=>bt,im:()=>St,l0:()=>It,D1:()=>Lt,Pi:()=>Mt,MB:()=>wt,Go:()=>Ot,xT:()=>Ut,RU:()=>kt,eY:()=>At,_V:()=>Dt,aw:()=>Nt,rP:()=>Et,qJ:()=>Pt,UL:()=>xt,AK:()=>Ft,YD:()=>Bt,wm:()=>Rt,nI:()=>_t,fM:()=>$t,GE:()=>jt,Eu:()=>Wt,NL:()=>zt,SX:()=>qt,oQ:()=>Yt,Dy:()=>Xt,Er:()=>Kt,nm:()=>Zt,qA:()=>tn,hj:()=>nn,wq:()=>an,Oz:()=>rn});var i=n(740597),a=n(50805),r=n(663945),o=n(181620),s=n(533464),l=n(453078),d=n(711676),c=n(760005),u=n(628063),g=n(592153),m=n(114881),p=n(500396),h=n(876661),v=n(708975),y=n(303065),f=n(614658),C=n(863553),T=n(558632),b=n(878652),S=n(403778),I=n(905581),L=n(132756),M=n(74583),w=n(315338),O=n(516909),U=n(951296),k=n(205480),A=n(32552),D=n(451567),N=n(849142),E=n(38613),P=n(431506),x=n(785014),F=n(281973),B=n(592301);const R="http://schema.skype.com",_=`${R}/StarredMessage`,$=`${R}/Mention`,H=`${R}/File`,j=2,W=C.F,z=new Map([["sms","SMS"],["email","Email"],["call","Call"],["teamscall","TeamsCall"],["etnp","ETNP"]]),J=new Set(["RichText/Media_LocalRecording","RichText/Media_CallRecording","RichText/Media_CallTranscript","Event/Call"]);var G;!function(e){e.FAMILY="family",e.FRIENDS="friends",e.PROJECT="projectCoord",e.WORKPLACE="company",e.TRIP_PLANNING="tripPlanning",e.GET_TOGETHER="getTogether",e.LOCAL_COMMUNITY="localCommunity",e.HOLIDAY_PLANNING="holidayPlanning"}(G||(G={}));const Q="preview-",V="newchat",q="welcomePage",Y="bizChatMetaOSChatListEntryPoint",X=(e,t,n=!1)=>{if(!(null==e?void 0:e.emotions))return null;const i=e.emotions.map((({key:e,users:t})=>({key:e,users:t.map((({mri:e,time:t,value:n})=>({id:W(e),time:t,value:n}))).sort(((e,t)=>e.time-t.time))})));return n&&i.sort(((e,n)=>{var i,a,r,o,s,l;return(null!==(r=null!==(a=null===(i=null==t?void 0:t.emotions)||void 0===i?void 0:i[n.key])&&void 0!==a?a:n.users.length)&&void 0!==r?r:0)-(null!==(l=null!==(s=null===(o=null==t?void 0:t.emotions)||void 0===o?void 0:o[e.key])&&void 0!==s?s:e.users.length)&&void 0!==l?l:0)})),i},K=e=>{if(!e||!e.emotions)return null;const t=e.emotions;return Object.keys(t).map((e=>({key:e,count:t[e]})))},Z=e=>{if(!e||!e.escalations)return null;return JSON.parse(e.escalations).map((({key:e,users:t})=>({key:z.get(e),users:t.map((({mri:e,time:t,value:n})=>({mri:W(e),time:t,value:n})))})))},ee=(e,t,n)=>e&&e.mentions?ie(e.mentions,t,n):null,te=(e,t,n)=>e&&e.onbehalfof?ie(e.onbehalfof,t,n):null,ne=(e,t)=>{if(!t||!t.atp)return null;const n=t.atp;try{return"string"==typeof n?JSON.parse(n):n}catch(t){return e.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in toAtpSharepointData: ${t}`),null}},ie=(e,t,n)=>{var i;try{if("string"==typeof e&&(0,d.lp)(e))return null;const n="string"==typeof e?JSON.parse(e):e;return(null==n?void 0:n.length)?n.map((({itemid:e,mri:n,displayName:i,mentionType:a})=>({id:`${t}_${e}_${n}`,userId:n,itemId:e,displayName:i,mentionType:a}))):null}catch(e){const a=null==n?void 0:n.newLogger("Chat Helper","data-resolvers-common");return null===(i=null==a?void 0:a.errorToTelemetry)||void 0===i||i.call(a,`UnhandledException in messageId: ${t}, processMentions - errorcode: ${e.errorcode}, error: ${e.error}`,"process_mentions_parse_error"),null}},ae=(e,t,n,i)=>{var a,r,o;if(!t||!t.files)return null;const s=e.newLogger("Chat Helper","data-resolvers-common");try{let e=JSON.parse(null==t?void 0:t.files),o=0;return e=e.filter((e=>"deeplink"===e.type)),o=e.length,e=e.filter((e=>e)),o!==e.length&&(null===(a=null==s?void 0:s.errorToTelemetry)||void 0===a||a.call(s,`toDeepLinks::Files contains falsy value. Filtered out.::id=${n}::conversationId=${i}`,"process_deeplink_parse_error"),o=e.length),e=e.filter((e=>e.id)),o!==e.length&&(null===(r=null==s?void 0:s.errorToTelemetry)||void 0===r||r.call(s,`toDeepLinks::Files contains object without id field which should be a required field. Filtered out.::id=${n}::conversationId=${i}`,"process_deeplink_parse_error")),e.map((({id:e,title:t,fileInfo:n,channelId:i,state:a})=>({id:e,title:t,state:a,serverRelativeUrl:n.serverRelativeUrl,channelId:i,siteUrl:n.siteUrl,objectUrl:n.fileUrl})))}catch(e){return null===(o=null==s?void 0:s.errorToTelemetry)||void 0===o||o.call(s,`toDeepLinks::errorcode=${e.errorcode}::error=${e.error}::id=${n}::conversationId=${i}`,"process_deeplink_parse_error"),null}},re=e=>e&&JSON.stringify((0,M.map)(e,(e=>{var{content:t}=e,n=(0,i.__rest)(e,["content"]);return Object.assign(Object.assign({},n),{content:JSON.parse(t)})}))),oe=(e,t)=>{if(!e||!e.links)return{urlPreview:null,embeddedLinks:null};try{const t=["http","https"],n=JSON.parse(e.links),i=[],a=[];return n.forEach((e=>{se(e,i,t),le(e,a,t)})),{urlPreview:a.length>0?a[0]:null,embeddedLinks:i}}catch(e){return t.newLogger("Chat Helper","data-resolvers-common").log(`Failed to parse message link properties: ${e}`),{urlPreview:null,embeddedLinks:null}}},se=(e,t,n)=>{const{url:i,fileShareUrlMeta:a,title:r,description:o}=e,s=(0,T.Nm)(i,n);a&&t.push({objectUrl:s,title:r,description:o,fileShareUrlMeta:a})},le=(e,t,n)=>{const{url:i,preview:a,previewenabled:r}=e,{previewurl:o,previewmeta:s,title:l,description:d}=a||{},c=(0,T.Nm)(i,n);t.push({url:c,thumbnail:(0,T.Nm)(o,n),title:l,description:d,previewEnabled:r,thumbnailMeta:s?{width:s.width,height:s.height}:null})},de=(e,t,n,i)=>{let a=i&&i.policyViolation;const r=i&&i.genericStreamMetadata;if(!a&&!r)return null;const o={};if("string"==typeof a)try{a=JSON.parse(a)}catch(n){e.newLogger("Chat Helper","data-resolvers-common").log(`Exception in parsing PolicyViolation in message: ${t}. Error: ${n}`)}a&&(o.policyViolation=a);let s=r&&r.policyTip;if("string"==typeof r)try{s=JSON.parse(r).policyTip}catch(n){e.newLogger("Chat Helper","data-resolvers-common").log(`Exception in parsing policy tip in message: ${t}. Error: ${n}`)}if(s){const e=i&&i.subject;o.dlpData={id:t,content:n,policyTip:s,subject:e}}return o},ce=e=>{if(!e.scheduledmeetinginfo||(0,M.isNil)(e.scheduledmeetinginfo.eventType))return null;const t=e.scheduledmeetinginfo,{iCalUid:n}=t,a=(0,i.__rest)(t,["iCalUid"]);return Object.assign({iCalUID:n},a)},ue=e=>{const{itemId:t,meetingTitle:n,meetingActionType:a,scheduledMeetingInfo:r}=e,o=(0,i.__rest)(e,["itemId","meetingTitle","meetingActionType","scheduledMeetingInfo"]),s=Object.assign(Object.assign(Object.assign({},o),(e=>{const{iCalUID:t}=e,n=(0,i.__rest)(e,["iCalUID"]);return{scheduledmeetinginfo:Object.assign(Object.assign({},n),{iCalUid:t})}})(r)),{itemid:t,meetingtitle:n,"@type":a});return JSON.stringify(s)},ge=(e,t)=>{if(!t||!t.meeting)return null;try{const e=JSON.parse(t.meeting),{organizerId:n,tenantId:i,meetingJoinUrl:a,location:r,itemid:o,meetingtitle:s,rsvpTo:l,body:d}=e;return(0,N.w)({meetingActionType:e[c.BM.MeetingType],organizerId:n,tenantId:i,meetingJoinUrl:a,location:r,itemId:o,meetingTitle:s,rsvpTo:l,body:d,scheduledMeetingInfo:ce(e)})}catch(t){return e.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in toMeeting: ${t}`),null}},me=(e,t,n,i)=>{const a=t||n;if(a)return a;if(i&&J.has(e)){const e=i.match(/<id type="callId"[^>]*?\svalue="([^"]+?)"/i);return e&&e[1]||null}return null},pe=(e,t)=>"-1"===e?t:e,he=(0,l.Z)((e=>new Intl.Collator(e,{numeric:!1,sensitivity:"accent"}))),ve=(e,t)=>{if(e.length<=1)return e;const n=he(t),i=[...e];return i.sort(((e,t)=>n.compare(e.displayName||"",t.displayName||""))),i},ye=(e,t,n)=>{const i=ve(e,n),a=[],r=[];return(0,M.forEach)(i,(e=>{const{id:n,displayName:i}=e;if(n!==t&&!D.eo.isTFLOffNetworkUser(n)&&i){if(r.push(i),20===r.length)return!1;a.length<3&&a.push(e)}return!0})),{membersLimited:a,memberDisplayNamesLimited:r}},fe=(e,t,n,i,a,r,s,l)=>{var c,u;if(!(null==e?void 0:e.id))return;const g=Ce(e,t,i,a,n,!!r),{id:m,messagetype:p,properties:h,callId:v,skypeguid:y,composetime:f,content:C,contentHash:T,conversationid:b,draftDetails:S,crossPostData:I}=e,L=(0,d.kw)(S),M=(0,P.xJ)(t,null==h?void 0:h.languageStamp,null==s?void 0:s.targetLanguageCode,C,l),O=(0,P.R4)(s,M,g.translatedContent,g.translationStatus),U=(0,B.Q)(h),k=(0,P.bv)(m,null==M?void 0:M.code,null==s?void 0:s.seenLanguages);return Object.assign(Object.assign({},g),{__typename:"Message",contentHash:T,interopDeliveryState:Vt(null==h?void 0:h.deliveryState),smsDeliveryReports:h&&h.smsDeliveryReports?h.smsDeliveryReports:null,announcement:Ne(h),escalations:Z(h),notification:Jt(t,h),notifications:Qt(t,h),meeting:ge(t,h),onBehalfOf:te(h,m,t),callId:me(p,v,y||h&&h.skypeguid,C),callLog:h&&(0,w.Hb)({skypeMessage:e,loggerFactory:t}),skypeguid:y,composeTime:f,isCallStartedMessage:(0,o.LY)(C,p),replyPermission:null!==(c=null==h?void 0:h.replyPermission)&&void 0!==c?c:null,atpSharepointData:ne(t,h),isDeletedByAdmin:(null==h?void 0:h.adminDelete)||!1,suggestedActions:(null==h?void 0:h.suggestedActions)||null,scheduledSendTime:L?new Date(L).toISOString():null,draftId:(null==h?void 0:h.draftId)||(L?null==g?void 0:g.id:null),forwardedMessageContext:De(h,C),conversationId:b,vivaTopicsAnnotations:U,crossPostStatus:I?(0,x.Nd)(I.status):void 0,crossPostFailedChannels:null==I?void 0:I.failedChannels,isWrittenInPreferredLanguage:!O,languageSeenBefore:k,sourceLanguageCode:null!==(u=null==M?void 0:M.code)&&void 0!==u?u:null})},Ce=({id:e,content:t,originalarrivaltime:n,from:i,messagetype:a,annotationsSummary:r,userHasStarred:o,properties:s,clientmessageid:l,version:d,prioritizeimdisplayname:c,imdisplayname:g,translation:m,conversationid:p,conversationLink:h},v,y,f,C,T=!1)=>{var b;let S=t;y&&(S=y);const I=(0,u.le)(v,s,f),L=(0,P.cC)(m),M=(null==L?void 0:L.translationStatus)===O.C1.Done?(0,E.MX)()[0].toString():d,w=(0,P.xJ)(v,null==s?void 0:s.languageStamp);return Object.assign(Object.assign(Object.assign({id:pe(e,l),content:S,originalArrivalTime:n,from:W(i),messageType:(0,u.DE)(v,a,s),isImportant:(0,U.wU)(null==s?void 0:s.importance),importance:(0,U.gy)(null==s?void 0:s.importance),emotionsSummary:K(r),emotions:X(s,r,T),mentions:ee(s,e,v),cards:I,files:(0,u.jz)(v,s),deeplinks:ae(v,s,e,p||h)},oe(s,v)),{deleteTime:null==s?void 0:s.deletetime,editTime:null==s?void 0:s.edittime,version:M,userHasSaved:o,renamedDisplayName:c?g:null,imDisplayName:g,clientMessageId:l,dlpContext:de(v,e,t,s),atpSharepointData:ne(v,s),status:C||O.rJ.Delivered,hardDeleteReason:null==s?void 0:s.hardDeleteReason,hardDeleteTime:null==s?void 0:s.hardDeleteTime,onBehalfOf:te(s,e,v),sourceLanguageCode:null!==(b=null==w?void 0:w.code)&&void 0!==b?b:null}),L)},Te=({content:e,contentHash:t,id:n,messageType:i,originalArrivalTime:a,type:r,version:o})=>({__typename:"Message",content:e,contentHash:t,id:n,messageType:i,originalArrivalTime:new Date(a).toISOString(),type:r,version:o}),be=(e,t,n,i)=>{const a=fe(e,t,Dt(e.state),void 0,void 0,!!(null==n?void 0:n.shouldSortReactions),i,null==n?void 0:n.translationLanguageStampingTunerSettings);if(!a)throw(0,I.Tr)("ChatHelpers",L.jK.Undefined,"toNewMessageSchema",{resource:e},"Bad shaped NewMessage");let r=null;if(e&&e.conversationLink){const t=(0,d.P5)(e);r=t===a.id?null:t}return{convId:e.conversationid||(0,d.o_)(e),replyChainId:r,threadType:e.threadtype,threadTopic:e.threadtopic,message:a}};function Se(e,t){return{__typename:"LastMessage",content:"",preview:"",messageType:"Text",id:e,originalArrivalTime:t,imDisplayName:null,from:null,deleteTime:null,files:null,cards:null,embeddedLinks:null,callId:null,replyPermission:null,onBehalfOf:null,atpSharepointData:null,deeplinks:null,version:null,importance:null,interopDeliveryState:null,smsDeliveryReports:null,suggestedActions:null,emotions:null,emotionsSummary:null,escalations:null,mentions:null,status:null,clientMessageId:e,urlPreview:null,dlpContext:null,editTime:null,userHasSaved:null,isSystemMessage:!1,canShowEveryoneMentionBadge:!1}}function Ie(e,t){return{__typename:"ConsumptionHorizon",id:e,originalArrivalTime:t,timeStamp:t,clientMessageId:(0,A.K)()}}const Le=()=>({members:[],membersLimited:[],activeCallsCount:null,canBeDiscarded:null,canBeFavorited:null,canBeHidden:null,botMembers:null,canBeLeft:null,canBeMuted:null,canBePinned:null,canBotBeBlocked:null,canManageApps:null,canPopOut:null,canTagContact:null,chatSubType:null,isDisabled:!1,isOneOnOne:!1,isOneOnOneBotChat:!1,isRead:!0,datatid:null,displayName:null,hasActions:null,hasActiveCalls:null,hasFailedMessages:null,isBotBlocked:null,isBotUser:null,isContactTagged:null,isFederated:!1,isHidden:null,isHighImportance:null,isLastMessageFromMe:null,isLastMessageText:null,isMeeting:!1,isMuted:null,isNewChat:!0,isSfB:!1,isUrgentImportance:null,isUserMember:!0,creator:null,meetingInformation:null,userConsumptionHorizon:null,consumptionHorizonBookmark:null,lastMessageTime:null,lastContentMessageTime:null,longTitle:null,messagePreview:null,messagePreviewAria:null,otherMemberMris:null,pictureGroup:null,pictureUpn:null,pinnedIndex:null,plGroupKey:null,presenceSource:null,showAtMention:null,showMarkers:null,tooltipTitle:null,substrateGroupId:null});function Me(e){const t=new Date,n=t.toISOString(),i=t.getTime().toString();return Object.assign(Object.assign({},Le()),{__typename:"Conversation",id:e,memberIds:[],memberDisplayNamesLimited:[],nonTeamsFederatedUserLimitedNames:[],hasFederatedUser:!1,chatHistoryHiddenTime:null,hasTflConsumerUser:!1,hasEnterpriseUser:!1,hasUnknownConsumerUser:!1,hasUnknownEnterpriseUser:!1,hasTflSmsUnverifiedUser:!1,hasTflSmsVerifiedUser:!1,tflOffNetworkUser:null,cfet:!1,consumerGroupId:null,tenantId:null,title:"",hasBotMember:!1,hasUnresolvedFederatedUser:!1,isChatDisabledForRecipients:!1,typingUsers:[],isPrivateChatPolicyDefinedScenario:null,meetingChatPolicy:null,me:null,tflOffNetworkUserLength:null,nonTeamsFederatedUsers:[],nonTeamsFederatedUsersLength:0,chatType:"Chat",type:"Chat",lastMessage:Se(i,n),consumptionHorizon:Ie(e,n),addedBy:null,addedByTenantId:null,sensitivityLabel:null})}const we=(e,t,n,a)=>{var r,o,{annotationsSummary:s,id:l,from:d,messageType:c,properties:g,version:m}=e,p=(0,i.__rest)(e,["annotationsSummary","id","from","messageType","properties","version"]);if(void 0===a&&(a=!1),!l)return null;try{const e=(0,B.Q)(g);return Object.assign(Object.assign(Object.assign({__typename:"Message",id:l,from:d,messageType:(0,u.DE)(n,c,g),version:(0,M.isNumber)(m)?m.toString():void 0,isImportant:(0,U.wU)(g&&g.importance),importance:(0,U.gy)(g&&g.importance),interopDeliveryState:Vt(null==g?void 0:g.deliveryState),smsDeliveryReports:(null==g?void 0:g.smsDeliveryReports)||null,emotions:X(g,s,a),emotionsSummary:K(s),announcement:Ne(g),escalations:Z(g),mentions:ee(g,l,n),onBehalfOf:te(g,l,n),cards:(0,u.le)(n,g),files:(0,u.jz)(n,g),deeplinks:ae(n,g,l,t)},oe(g,n)),{deleteTime:g&&g.deletetime,editTime:g&&g.edittime,isDeletedByAdmin:g&&g.adminDelete,scheduledSendTime:(null==g?void 0:g.sendAt)||null,draftId:(null==g?void 0:g.draftId)||null,forwardedMessageContext:De(g,p.content||""),hardDeleteTime:g&&g.hardDeleteTime,hardDeleteReason:g&&g.hardDeleteReason,suggestedActions:(null==g?void 0:g.suggestedActions)||null,status:O.rJ.Delivered,dlpContext:de(n,l,p.content,g),meeting:ge(n,g),callId:g&&g.skypeguid,callLog:g&&(0,w.Hb)({skypeMessage:{properties:g,id:l,conversationid:t,messagetype:c,content:p.content,originalarrivaltime:p.originalArrivalTime},loggerFactory:n}),sourceLanguageCode:null!==(o=null===(r=(0,P.xJ)(n,null==g?void 0:g.languageStamp))||void 0===r?void 0:r.code)&&void 0!==o?o:null,vivaTopicsAnnotations:e}),p)}catch(e){return n.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in message transformation: ${e}`),Object.assign({id:l,from:d,messageType:(0,u.DE)(n,c,g),isImportant:null,emotions:null,mentions:null,files:null,announcement:null,urlPreview:null,deleteTime:null,status:null},p)}},Oe=({originalArrivalTime:e,timeStamp:t,clientMessageId:n})=>({originalArrivalTime:new Date(e).toISOString(),timeStamp:new Date(t).toISOString(),clientMessageId:n}),Ue=(e,t,n)=>ke({id:e,properties:{[c.Ff.ConsumptionHorizon]:(0,g.A1)(n)},type:t}),ke=e=>Object.assign({id:e.id},Oe((0,g.bf)(e))),Ae=e=>Object.assign({id:e.id},Oe((0,g.BU)(e))),De=(e,t)=>{if(!e||!e.originalMessageContext)return null;const n=t.indexOf(m.mU.ForwardedContentStart),i=t.lastIndexOf(m.mU.ForwardedContentEnd),a=t.slice(n,i+m.mU.ForwardedContentEnd.length),r="string"==typeof e.originalMessageContext?JSON.parse(e.originalMessageContext):e.originalMessageContext;return{originalSenderMri:r.originalSender,originalArrivalTime:r.originalSentTime,originalMessageId:r.messageId,originalMessageContent:a,originalThreadId:r.originalThreadId}},Ne=e=>{const t={title:"",originalImageUrl:null,croppedImageUrl:null,colorTheme:null};if(!(null==e?void 0:e.cards))return t;const n="string"==typeof e.cards?JSON.parse(e.cards):e.cards;if(!n||0===n.length)return t;const i=n.find((e=>"application/vnd.microsoft.teams.messaging-announcementBanner"===e.contentType));if(!i)return t;const a=Ee(i);return{title:e.title?e.title:"",originalImageUrl:a.originalImageUrl,croppedImageUrl:a.croppedImageUrl,colorTheme:a.colorTheme,croppedImageHeight:a.croppedImageHeight,croppedImageWidth:a.croppedImageWidth,croppedImageAltText:a.croppedImageAltText,isTeamsIllustration:a.isTeamsIllustration}},Ee=e=>{let t=(0,M.get)(e,"content.imageData.origImage.src",null),n=(0,M.get)(e,"content.imageData.croppedImage.src",null);const i=(0,M.get)(e,"content.imageData.croppedImage.imageHeight",null),a=(0,M.get)(e,"content.imageData.croppedImage.imageWidth",null),r=(0,M.get)(e,"content.imageData.croppedImage.imageAltText",null),o=(0,M.get)(e,"content.imageData.isTeamsIllustration",null);let s=(0,M.get)(e,"content.imageData.colorTheme",null)||(0,M.get)(e,"content.colorTheme",null);return t=void 0===t?null:t,n=void 0===n?null:n,s=void 0===s?null:s,{originalImageUrl:t,croppedImageUrl:n,croppedImageHeight:i,croppedImageWidth:a,croppedImageAltText:r,colorTheme:s,isTeamsIllustration:o}},Pe=(e,t,n)=>{try{const n=xe(t),i=null==n?void 0:n.map((t=>({activityReplyToId:t.replyToId,activityTimestamp:t.timestamp,convId:e,suggestedReplies:t.suggestedActions.actions.filter((e=>{var t,n;return(null===(t=null==e?void 0:e.channelData)||void 0===t?void 0:t.id)&&(null===(n=null==e?void 0:e.channelData)||void 0===n?void 0:n.utcTime)})).map((e=>{var n,i;const a={targetMessageId:(null===(n=null==e?void 0:e.channelData)||void 0===n?void 0:n.targetMessageId)||t.replyToId,type:(null===(i=null==e?void 0:e.channelData)||void 0===i?void 0:i.type)||"reply"};return{suggestionChannelData:Object.assign(Object.assign({},null==e?void 0:e.channelData),a),value:e.value||e.title,title:e.title,whisperId:t.id}}))})));return i&&0!==i.length?{suggestedRepliesCollections:i}:null}catch(e){return n.newLogger("Chat Helper","data-resolvers-common").error(`formatQuickReplyAugmentationFromObject: Exception in parsing quick reply augmentation. Error: ${e}`),null}},xe=e=>{const t=e&&e.suggestedActivities&&e.suggestedActivities.filter((e=>{var t,n,i;return(null==e?void 0:e.type)===c.uV&&(null===(t=null==e?void 0:e.from)||void 0===t?void 0:t.id)===c.ZI&&(null==e?void 0:e.timestamp)&&(null===(i=null===(n=null==e?void 0:e.suggestedActions)||void 0===n?void 0:n.actions)||void 0===i?void 0:i.some((e=>e.type===c.qC||e.type===c.DC)))}));return t&&0!==t.length?t:null},Fe=(e,t,n)=>{const i=t&&t[c.Ff.SmartReplies];return i&&"string"==typeof i?((e,t,n)=>{try{const i=JSON.parse(t);return Pe(e,i,n)}catch(e){return n.newLogger("Chat Helper","data-resolvers-common").error(`formatQuickReplyAugmentationFromString: Exception in parsing quick reply augmentation. Error: ${e}`),null}})(e,i,n):null},Be=e=>{switch(e){case p.wJ.None:return O.wJ.Unknown;case p.wJ.Adhoc:return O.wJ.Adhoc;case p.wJ.Scheduled:return O.wJ.Scheduled;case p.wJ.Recurring:return O.wJ.Recurring;case p.wJ.Broadcast:return O.wJ.Broadcast;case p.wJ.MeetNow:return O.wJ.MeetNow}},Re=e=>e&&e.map((e=>({id:e.id,originalArrivalTime:e.consumptionhorizon,messageVisibilityTime:e.messageVisibilityTime})))||null;function _e(e,t){if(!e||!t)return!1;return(0,h.hu)(e,t)>0}function $e(e,t,n,i,a,r=!1,o=!1,s,l){const c=(0,u.C)(e,n),g=e.find((({id:e})=>e===t))||null,m=kt(e),p=(0,d.iK)(e,a,[]).members||[];return Object.assign(Object.assign(Object.assign(Object.assign({memberIds:p.map((({id:e})=>e))},ye(p,t,i)),qe(c)),at(t,p)),{me:g,isUserMember:!!g,tflOffNetworkUser:(0,M.first)(m),tflOffNetworkUserLength:m.length,hasBotMember:p.some((({id:e})=>(0,d.bl)(e))),hasFederatedUser:!!c.length||r,hasTflConsumerUser:Ze(p)||o,hasEnterpriseUser:it(p),hasUnknownEnterpriseUser:nt(p),hasUnknownConsumerUser:tt(p),hasUnresolvedFederatedUser:c.some(D.eo.isUnknownUser),hasTflSmsUnverifiedUser:Ke(p),hasTflSmsVerifiedUser:et(p),isRetentionHorizonSet:_e(l,s),hasExtendedDirectoryUsers:en(p)})}function He(e,t,n){if(e&&!(0,M.isEmpty)(e))return lt(fe(e,t,void 0,void 0,void 0,n))}const je=e=>"string"==typeof e?"true"===e.toLowerCase():e,We=e=>{const t=Object.keys(null!=e?e:{}).filter((e=>e.includes(c.Q5.Liveness))).map((t=>({key:t,value:String(e[t])})));return(0,M.isEmpty)(t)?null:t};function ze(e,t,n,i,r,o,s,l,u){var g,m,C,T,b,S,I,L,w;const{id:O,lastMessage:U}=e,k=He(U,i,!!(null===(m=null===(g=null==n?void 0:n.get(a.J.Messaging).expandedReactionsConfigs)||void 0===g?void 0:g.chat)||void 0===m?void 0:m.enableSend)),A=(null==o?void 0:o.id)||"",D=!!(0,h.YP)(e),N=(0,x.NF)(e),E=(0,x.gS)(e),P=((e,t,n,i,r,o,s)=>{var l,d,c;const{id:u,lastMessage:g}=e,m=He(g,i,!!(null===(d=null===(l=null==n?void 0:n.get(a.J.Messaging).expandedReactionsConfigs)||void 0===l?void 0:l.chat)||void 0===d?void 0:d.enableSend)),p=(null==o?void 0:o.id)||"",h=xt(u);if(!m)return null;let v=null!==(c=null==g?void 0:g.preview)&&void 0!==c?c:"";if("string"!=typeof v&&!v){const a=(0,M.keyBy)(t,"id");n&&s&&(v=(0,y.t)({conversation:e,profilesMap:a,coreSettings:n,i18n:s,loggerFactory:i,currentUserMri:p,currentUserTenantId:null!=r?r:"",addSenderName:!0}))}const f=(0,F.aw)(m,p);return Object.assign(Object.assign({},m),{preview:v,clientMessageId:h?Date.now().toString():null==m?void 0:m.clientMessageId,originalArrivalTime:h?e.clientArrivalTime:null==m?void 0:m.originalArrivalTime,isSystemMessage:(0,F.Ew)(m),hasMention:f,canShowEveryoneMentionBadge:(0,F.Hu)(m||void 0,p)&&!f})})(e,t,n,i,r,o,l),B=$e(t,A,r,s,e.threadProperties,null===(C=e.usersProps)||void 0===C?void 0:C.hasFederatedUser,null===(T=e.usersProps)||void 0===T?void 0:T.hasConsumerUser,n,e),R=function(e,t,n){const{id:i,properties:a,threadProperties:r}=e,o=Ae(e);return{chatSubType:ht(r.threadType),chatType:yt(r.threadType),consumptionHorizon:ke(e),consumptionHorizonBookmark:o,quickReplyAugmentation:Fe(i,a,t),creator:r[c.Q5.Creator],importState:st(r[c.Q5.ImportState]),isDisabled:Lt(r.isDisabled),disabledReason:ot(r.disabledReason),isLastMessageFromMe:r.isLastMessageFromMe,meetingInformation:ht(r.threadType)===p.k2.Channel?void 0:Ot(i,r[c.Q5.Meeting]),sensitivityLabel:r[c.Q5.SensitivityLabelId]?{id:r[c.Q5.SensitivityLabelId],isCopyBlocked:r[c.Q5.SensitivityLabelIsCopyBlocked]}:void 0,tenantId:r[c.Q5.TenantId],title:r.topic,userConsumptionHorizon:o,interopConversationStatus:Ct(a[c.Ff.InteropConversationStatus]),gapDetectionEnabled:je(r.gapDetectionEnabled),cfet:Xe(r.cfet),consumerGroupId:r[c.Q5.ConsumerGroupId],guardianChatInfo:r[c.Q5.GuardianChatInfo],groupTemplate:Ht(r[c.Q5.GroupTemplate]),themeId:r[c.Q5.ThemeId],picture:r[c.Q5.Picture],addedBy:(null==a?void 0:a.addedBy)||null,addedByTenantId:(null==a?void 0:a.addedByTenantId)||null,meetingChatPolicy:bt(r[c.Q5.MeetingChatPolicy]),chatScheduleSuggestionSuppressUntil:null==a?void 0:a.chatScheduleSuggestionSuppressUntil,isCommentStream:(0,v.Bu)(r,n,e.id),createdAt:r[c.Q5.CreatedAt],lastJoinAt:r[c.Q5.LastJoinAt],commentStreamPolicy:bt(r.liveChatPolicy)}}(e,i,n),_=e.properties.historyHiddenTime,$=(0,h.dO)(e,n).toString(),H=(0,h.ln)(e),{enableForwardMessageUnreadMarkers:j}=null!==(b=null==n?void 0:n.get(a.J.Messaging))&&void 0!==b?b:{enableForwardMessageUnreadMarkers:!1};return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},e),B),R),Ge(e.memberProperties)),{shortTitle:null===(S=e.chatTitle)||void 0===S?void 0:S.shortTitle,longTitle:null===(I=e.chatTitle)||void 0===I?void 0:I.longTitle,id:O,isRead:Yt(e,(null==o?void 0:o.id)||"",null!=j&&j),isHidden:(0,f.n)(_,null==k?void 0:k.originalArrivalTime,$),isMuted:null!==(L=(0,h.tl)(e))&&void 0!==L?L:!!(0,d.e9)(O)&&u,isOneOnOne:D,isOneOnOneBotChat:D&&B.hasBotMember,isBotBlocked:Je(null===(w=e.threadProperties)||void 0===w?void 0:w.messagingdisabled),isModerator:E,isFederated:(0,d.eX)(O),isMeeting:(0,d.e9)(O),isSfB:(0,v.Jn)(O),lastMessage:P,awarenessLiveState:We(e.threadProperties),members:[],clearHistoryTime:$,chatHistoryHiddenTime:_,type:null}),Ut(e.threadProperties.pinnedItems)),{quarantineCounter:H,replyPermission:N||null})}const Je=e=>"string"==typeof e?"true"===e.toLowerCase():Boolean(e),Ge=e=>{const t=null==e?void 0:e[c.e0.RelationshipState];return{extendedDirectoryRedemptionRequired:null==t?void 0:t.edRedemptionRequired}},Qe=(e,t)=>(0,M.map)(t,(t=>e[t.id]||function(e){return(0,k.ne)(Object.assign(Object.assign({},e),{mri:e.id,objectId:"",type:"",userPrincipalName:"",isMuted:e.isReader,displayName:e.friendlyName}))}(t))),Ve=(e,t,n,i,a,r,o,s,l)=>{try{return ze(e,Qe(t,e.members),n,i,a,r,o,s,l)}catch(t){return i.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in toConversationSchemaFromSkypeConversationLocal transformation: ${t}`),Object.assign(Object.assign({},e),{id:e.id,isUserMember:!1,members:[],membersLimited:[],memberDisplayNamesLimited:[],type:null,lastMessage:null})}},qe=e=>{const t=e.filter((e=>{var t;return!D.eo.isUnknownUser(e)&&(null===(t=e.featureSettings)||void 0===t?void 0:t.coExistenceMode)!==s.hN.TeamsOnly&&!!e.displayName}));return{nonTeamsFederatedUserLimitedNames:t.slice(0,2).map((({displayName:e})=>e||"")),nonTeamsFederatedUsersLength:t.length}},Ye=(e,t,n)=>{var i;const a=e.threadProperties.tenantid,r=null!==(i=(0,b.D)(e.threadProperties.meeting).meetingJoinUrl)&&void 0!==i?i:"";try{const n=Qe(t,e.members);return((e,t,n,i)=>({id:e,members:t,tenantId:n,meetingJoinUrl:i}))(e.id,n,a,r)}catch(t){return n.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in toConversationMembersSchemaFromSkypeConversationLocal transformation: ${t}`),Object.assign(Object.assign({id:e.id,members:[]},a&&{tenantId:a}),r&&{meetingJoinUrl:r})}},Xe=e=>"string"==typeof e?"true"===(null==e?void 0:e.toLowerCase()):!!e,Ke=e=>e.some((({id:e})=>(0,d.MR)(e))),Ze=e=>e.some((e=>D.eo.isTFLConsumerUser(e))),et=e=>e.some((e=>D.eo.isTFLSmsVerifiedMri(null==e?void 0:e.id))),tt=e=>e.some((e=>(0,d.Nl)(e.id)&&D.eo.isUnknownUser(e))),nt=e=>e.some((e=>D.eo.isEnterpriseUserMri(e.id)&&D.eo.isUnknownUser(e))),it=e=>e.some((e=>D.eo.isEnterpriseUserMri(e.id))),at=(e,t)=>{let n=!0;const i=t&&t.some((t=>{if(!t.isFederated&&t.id!==e&&t.featureSettings){const e=t.featureSettings.isPrivateChatEnabled;return null==e?(n=!1,!0):!e}return!1}));return{isPrivateChatPolicyDefinedScenario:n,isChatDisabledForRecipients:i}},rt={opted_out:O.Rd.OptedOut,claimed:O.Rd.Claimed,deprovisioned:O.Rd.Deprovisioned},ot=e=>{if(!e)return;const t=(0,b.D)(e);return{newlyCreatedUserId:t.userId,code:rt[t.code]}},st=e=>{if(e)return(0,S.j)()("Importing","Completed").find((t=>t===e))},lt=e=>Object.assign(Object.assign({},e),{preview:"",isSystemMessage:!1,canShowEveryoneMentionBadge:!1,__typename:"LastMessage"}),dt=(e,t,n,a,r)=>{var o,{id:s,members:l,consumptionHorizon:d,userConsumptionHorizon:u,lastMessage:g,creator:m,meetingInformation:p,isDisabled:h,disabledReason:v,importState:y,isMuted:f,isLastMessageFromMe:C,isRead:T,isOneOnOne:b,isOneOnOneBotChat:S,isSticky:I,isExternal:L,consumerGroupId:w,templateType:U,chatType:A,historyHiddenTime:D,createdAt:N,interopConversationStatus:E,quickReplyAugmentation:P,meetingPolicy:x,addedBy:F,addedByTenantId:B,sensitivityLabel:R}=e,_=(0,i.__rest)(e,["id","members","consumptionHorizon","userConsumptionHorizon","lastMessage","creator","meetingInformation","isDisabled","disabledReason","importState","isMuted","isLastMessageFromMe","isRead","isOneOnOne","isOneOnOneBotChat","isSticky","isExternal","consumerGroupId","templateType","chatType","historyHiddenTime","createdAt","interopConversationStatus","quickReplyAugmentation","meetingPolicy","addedBy","addedByTenantId","sensitivityLabel"]);try{const e=(0,M.map)(l,(e=>(0,k.ne)(e))),i=g&&lt(we(g,s,t)),D=p&&{id:s,subject:p.subject,startTime:p.startTime,scenario:p.scenario,endTime:p.endTime,iCalUid:p.iCalUid,location:p.location,exchangeId:p.exchangeId,meetingType:p.meetingType?Be(p.meetingType):O.wJ.Unknown,resolvedSensitivityLabelId:p.resolvedSensitivityLabelId,isCopyRestrictionEnforced:p.isCopyRestrictionEnforced,templateDetails:p.templateDetails,meetingJoinUrl:p.meetingJoinUrl,messagingPolicy:p.messagingPolicy},N=!(!b&&!I&&U!==c.Q5.ImmutableRoster),$=R&&R.id?{id:R.id,isCopyBlocked:(null===(o=R.protectTeamsLabelAction)||void 0===o?void 0:o.isCopyRestrictionEnforced)||!1}:void 0;return Object.assign(Object.assign(Object.assign({__typename:"Conversation"},$e(e,(null==a?void 0:a.id)||"",n,r)),_),{id:s,consumptionHorizon:d&&Object.assign({__typename:"ConsumptionHorizon"},Ue(s,c.i1.Chat,d)),consumptionHorizonBookmark:u&&Object.assign({__typename:"ConsumptionHorizonBookmark"},Ue(s,c.i1.Chat,u)),userConsumptionHorizon:u&&Object.assign({__typename:"ConsumptionHorizonBookmark"},Ue(s,c.i1.Chat,u)),lastMessage:i,members:[],creator:m,meetingInformation:D,isDisabled:!!h,disabledReason:ot(v),importState:st(y),isMuted:f,isLastMessageFromMe:!!C,isRead:T,isOneOnOne:N,cfet:L,consumerGroupId:w,isOneOnOneBotChat:!!S,chatType:yt(A),interopConversationStatus:Ct(E),quickReplyAugmentation:P&&Pe(s,P,t),addedBy:F,addedByTenantId:B,meetingChatPolicy:bt(x),sensitivityLabel:$})}catch(e){t.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in conversation object transformation: ${e}`);return Object.assign(Object.assign({},_),{id:s,isUserMember:!1,consumptionHorizon:null,consumptionHorizonBookmark:null,userConsumptionHorizon:null,lastMessage:null,memberIds:[],members:[],membersLimited:[],chatHistoryHiddenTime:D,memberDisplayNamesLimited:[],creator:null,meetingInformation:null,chatType:null})}},ct=({id:e,members:t,tenantId:n,meetingInformation:i},a)=>{var r;try{const a=(0,M.map)(t,(e=>(0,k.ne)(e))),o=null!==(r=null==i?void 0:i.meetingJoinUrl)&&void 0!==r?r:"";return{__typename:"ConversationMembers",id:e,tenantId:n=null!=n?n:"",meetingJoinUrl:o,members:a}}catch(t){a.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in conversation object transformation: ${t}`);return{id:e,members:[]}}},ut=(e,t,n,i,a)=>({node:dt(e,t,n,i,a),cursor:e.createdAt||e.id}),gt=e=>({activities:e.activities,callLogs:e.callLogs,chats:e.chats,total:e.total});function mt(e){return JSON.stringify((0,M.map)(e,(e=>{const t=e.mentionType,n=e.displayName;return{"@type":$,itemid:e.itemId,mri:e.userId,mentionType:t,displayName:n}})))}function pt(e){return!e||e.length<1?null:JSON.stringify(e.map((e=>{const t=e.mentionType,n=e.displayName;return{itemid:e.itemId,mri:e.userId,mentionType:t,displayName:n}})))}const ht=e=>{if(e)return"space"===e||"topic"===e?p.k2.Channel:"meeting"===e?p.k2.Meeting:p.k2.None},vt=new Map([["chat","Chat"],["phonechat","PhoneChat"],["phonelink1on1chat","Phonelink1on1Chat"],["phonelinkgroupchat","PhonelinkGroupChat"],["meeting","Meeting"],["sfbinteropchat","SfBInteropChat"]]),yt=e=>{let t=null;return null==e||(t=vt.get(e),void 0===t&&(t=null)),t},ft=new Map([["AcceptPending",O.uI.AcceptPending],["ExtendedDirectoryAcceptPending",O.uI.ExtendedDirectoryAcceptPending],["Accepted",O.uI.Accepted],["Blocked",O.uI.Blocked],["Quarantined",O.uI.Quarantined]]),Ct=e=>e&&ft.get(e)||null,Tt=new Map([["ChatEnabled",O.UO.ChatEnabled],["ChatDisabled",O.UO.ChatDisabled],["InMeeting",O.UO.InMeeting],["ChatEnabledAnonymousDisabled",O.UO.ChatEnabledAnonymousDisabled],["InMeetingAnonymousDisabled",O.UO.InMeetingAnonymousDisabled]]),bt=e=>e&&Tt.get(e)||null,St=e=>!!e&&"PhoneChat"===e,It=e=>{if(!e)return!1;switch(typeof e){case"string":e="true"===e.toLowerCase();case"boolean":return e;default:return!1}},Lt=e=>(0,M.isString)(e)?"true"===e.toLowerCase():e||!1,Mt=({id:e,conversationid:t,imdisplayname:n,from:i,composetime:a},r)=>e&&{"@type":_,mri:W(i),imdisplayname:n,messageId:e,parentMessageId:null!=r?r:e,threadId:t,isUnresolvedEmailUser:!1,originalComposeTime:a},wt=(e,t,n)=>{const i=n.find((n=>{try{const i=JSON.parse((n.properties||{}).starred),a=i&&i["@type"]===_&&i.threadId===t?i.messageId:void 0;return e===a}catch(e){return!1}}));return i&&i.id},Ot=(e,t)=>{if(!t)return;const n=JSON.parse(t);return Object.keys(t).length?Object.assign(Object.assign({id:e},n),{meetingJoinUrl:n.meetingJoinUrl||n.meetingJoinURL,meetingType:n.meetingType?Be(p.wJ[n.meetingType]):O.wJ.Unknown}):void 0},Ut=e=>{if(e)try{const t=JSON.parse(e);return{pinnedConversationItems:t.reduce(((e,t)=>(t.itemType===O.Vo.Message&&e.push({__typename:"Message",id:t.itemId}),e)),[])}}catch(e){return}},kt=e=>e.filter((({id:e})=>D.eo.isTFLOffNetworkUser(e))),At=(e,t,n)=>{const i=X(n.properties);return!!i&&i.some((n=>n.key===e&&!!n.users&&n.users.some((e=>e.id===t))))},Dt=e=>{let t;switch(e){case m.iv.Error:t=O.rJ.Error;break;case m.iv.Sending:t=O.rJ.Sending;break;default:t=O.rJ.Delivered}return t},Nt=({resourceType:e,resource:t},n,a)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){if("ThreadUpdate"===e)try{const{id:e="",members:i}=t,a=i?yield n(i,e):[];return{__typename:"ConversationMembers",id:e,members:a}}catch(e){a.newLogger("toChatMembersEvent","data-resolvers-common").error(`Failed getting thread members: ${e}`)}})),Et=e=>(0,v.Jn)(e)||(0,d.eX)(e)||(0,h.Bl)(e),Pt=(e,t)=>(0,M.filter)(e,(0,M.omit)(t,"__typename")),xt=e=>!!e&&-1!==e.indexOf(Q),Ft=e=>!!(null==e?void 0:e.startsWith("tfl:preview-")),Bt=e=>!!e&&(-1!==e.indexOf(c.X2)||-1!==e.indexOf(c.At)),Rt=e=>e===V,_t=e=>Rt(e)||xt(e),$t=e=>{switch(e){case G.FAMILY:case G.FRIENDS:case G.PROJECT:case G.WORKPLACE:case G.TRIP_PLANNING:case G.GET_TOGETHER:case G.LOCAL_COMMUNITY:case G.HOLIDAY_PLANNING:return!0}return!1},Ht=e=>{const t=e&&(0,b.D)(e).id;return $t(t)?t:void 0},jt=e=>!!e&&-1!==e.indexOf(":tflfed:preview-"),Wt=e=>!!e&&e.includes("meeting"),zt=(e,t,n,i,a,o,s,l)=>{if(!e)return;const d="Phonelink1on1Chat"===t,c="PhonelinkGroupChat"===t,u=n?r.Th.Meeting:i?a?r.Th.Botchat:St(t)?r.Th.SMSOneOnOneChat:(0,h.Bl)(e)?r.Th.SfcInteropChat:(0,v.Jn)(e)?r.Th.SfbInteropChat:o?r.Th.NativeFederatedChat:s?r.Th.FederatedChat:(0,h.j8)(e)&&d?r.Th.Phonelink1on1Chat:r.Th.OneOnOneChat:(0,h.mB)(e)?r.Th.StreamOfNotes:(0,h.j8)(e)&&c?r.Th.PhonelinkGroupChat:(e=>!!e&&e===p.k2.Channel)(l)?r.Th.Channel:r.Th.GroupChat;return u},Jt=(e,t)=>{if(!t||!t.notification)return null;try{const e=t.notification;return{alertInMeeting:e.alertInMeeting,externalResourceUrl:e.externalResourceUrl}}catch(t){return e.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in chat message notification transformation: ${t}`),null}},Gt=e=>{if((0,M.isString)(e)){return{__typename:"DimensionInString",value:e}}if((0,M.isNumber)(e)){return{__typename:"DimensionInFloat",value:e}}return null},Qt=(e,t)=>{if(!t||!t.notifications)return null;try{const e="string"==typeof t.notifications?JSON.parse(t.notifications):t.notifications;return e&&e.map((({surface:e,contentType:t,content:n})=>{var i,a,r,o,s,l,d,c,u;return{surface:e,contentType:t,content:{value:{height:null!==(a=Gt(null===(i=n.value)||void 0===i?void 0:i.height))&&void 0!==a?a:void 0,width:null!==(o=Gt(null===(r=n.value)||void 0===r?void 0:r.width))&&void 0!==o?o:void 0,title:null!==(l=null===(s=n.value)||void 0===s?void 0:s.title)&&void 0!==l?l:"",url:null!==(c=null===(d=n.value)||void 0===d?void 0:d.url)&&void 0!==c?c:""},actions:null!==(u=n.actions)&&void 0!==u?u:[]}}}))}catch(t){return e.newLogger("Chat Helper","data-resolvers-common").log(`UnhandledException in message notifications parsing: ${t}`),null}};function Vt(e){if(e)return"string"==typeof e?e:e.state}const qt=(e,t,n)=>{const i=n.get(a.J.Messaging).commCopilotSummarizationRequestConfig;return i?{gptVersion:i.gptVersion,summaryMode:i.summaryMode,input:{type:i.threadType,id:e,lookbackperiod:t},promptSetting:{temperature:"1.0"}}:null},Yt=(e,t,n=!1)=>(0,g.uy)(e,t,n),Xt=e=>e.chatSubType===p.k2.Channel,Kt=e=>{var t,n;if(Xt(e)){const i=null===(t=e.threadProperties)||void 0===t?void 0:t[c.Q5.SpaceTypes],a=i?parseInt(i,10):0;return!!!(null===(n=e.threadProperties)||void 0===n?void 0:n[c.Q5.SubstrateGroupId])&&a!==p.tG.Private}return!1};function Zt(e,t,n){if(!e.members)return!1;const i=e.members.find((e=>e.id!==n));return!!i&&(e.source===m.vO.PutConversationLie&&2===e.members.length&&!!t[i.id])}const en=e=>e.some((e=>D.eo.isExtendedDirectoryUser(e))),tn=(e,t)=>{if(Yt(e,t.currentUserMri)||!e.lastMessage)return!1;const n=e.lastMessage.properties,i=ee(n,e.lastMessage.id,t.loggerFactory),a=null==i?void 0:i.some((({mentionType:e})=>"everyone"===e)),r=e.lastMessage.from&&!e.lastMessage.from.includes(t.currentUserMri);return!(!a||!r)},nn=(e,t)=>{var n;if(Yt(e,t.currentUserMri))return!1;const i=null===(n=e.lastMessage)||void 0===n?void 0:n.properties,a=null==i?void 0:i.importance;return!(!a||!(0,U.wU)(a))},an=(e,t)=>{var n;if(Yt(e,t.currentUserMri))return!1;const i=null===(n=e.lastMessage)||void 0===n?void 0:n.properties,a=null==i?void 0:i.importance;return!(!a||!(0,U.vA)(a))},rn=(e,t)=>{if(Yt(e,t.currentUserMri)||!e.lastMessage)return!1;const n=e.lastMessage.properties,i=ee(n,e.lastMessage.id,t.loggerFactory);return!!(i&&i.length>0&&i.some((e=>e.userId===t.currentUserMri)))}},431506:(e,t,n)=>{n.d(t,{Hj:()=>i,pK:()=>c,dA:()=>g,oj:()=>m,Cv:()=>v,PQ:()=>y,xJ:()=>f,R4:()=>T,cC:()=>S,bv:()=>I});var i,a=n(740597),r=n(220180),o=n(234207),s=n(500396),l=n(516909),d=n(309303);!function(e){e.HIGH="HIGH",e.MEDIUM="MEDIUM",e.LOW="LOW"}(i||(i={}));const c=613666==n.j?new RegExp("https?://[^\\s]+","i"):null,u="-",g=e=>{if(0===(e=e.toLowerCase()).lastIndexOf("zh-",0))switch(e){case"zh-cht":case"zh-hant":case"zh-hk":case"zh-tw":return"zh-cht";default:return"zh-chs"}let t=e.indexOf(u,1);if(-1===t)return e;let n=e.indexOf(u,t+1);return-1===n&&(n=e.length),n-t==5&&(t=n),e.substring(0,t)},m=e=>{const t=e?g(e):"",n=(0,r.get)("tcurlang")||t;return{targetLanguage:n,knownLanguages:[n]}},p=(e,t)=>(e=>{switch(e){case s.AO.Success:return l.C1.Done;case s.AO.MessageNotFound:return l.C1.MessageNotFound;case s.AO.VersionNotFound:return l.C1.VersionNotFound;case s.AO.LanguageDetectionFailed:return l.C1.LanguageDetectionFailed;case s.AO.SkipTranslation:case s.AO.ContentIsEmpty:return l.C1.TranslationNotNeeded;default:return l.C1.UnknownError}})(((e,t)=>{const n=s.AO[e];return void 0!==n?n:(null==t||t.error(`Unable to parse translation result code: ${e}`),s.AO.UnknownError)})(e,t)),h=(e,t,n,i,r,o,l,d,c)=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){try{return yield e.translateMessages(t,n,i,r,o,l,c)}catch(e){return d.error(`Failed to translate ${l}: ${e}`),o.map((({id:e,version:t})=>({id:e,version:t||"",detectedLanguage:{languageId:"",score:0},resultCode:s.AO[s.AO.UnknownError],translatedContent:"",translatedSubject:"",translatedTitle:""})))}})),v=(e,t,n,i,r,s,l)=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const{targetLanguage:a,knownLanguages:d}=n,c=(0,o.v4)(),u=r.map((({messageId:e,version:t})=>t?{id:e,version:t}:{id:e})),g=yield h(e,i,t,a,d,u,c,s,l);return{convId:i,targetLangCode:a,correlationId:c,translations:g.map((e=>{var t;return{messageId:e.id,content:e.translatedContent||"",sourceLangCode:(null===(t=e.detectedLanguage)||void 0===t?void 0:t.languageId)||"",resultCode:p(e.resultCode,s),version:e.version}}))}})),y=(e,t,n)=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){try{return(yield e.getSupportedTranslationLanguages(t)).map((({languageTag:e,languageName:t})=>({languageCode:e,languageName:t})))}catch(e){return n.error(`Unable to retrieve languages: ${e}`),[]}})),f=(e,t,n,a,r)=>{var o,s,l,c;if("string"!=typeof t)return null;try{const e=(0,d.d)(t),u=null===(s=null===(o=e.languages)||void 0===o?void 0:o.split(";"))||void 0===s?void 0:s.map((e=>{const[t,n]=e.split(":");return{code:t,score:parseInt(n,10)}})),g=u[0].code;if("null"===g)return null;const m=JSON.parse(null!=r?r:"{}").settingsData,p=null==m?void 0:m.find((t=>t.detector===e.detector));if(!(p&&n&&a&&p.minConfidence))return{code:g,confidenceLevel:i.HIGH};const h=((e,t)=>{var n,i,a,r;const o=e.minCharMap,s=e.minCharMapOverrides,l=new Map([["ar","arabic"],["fa","arabic"],["ku","arabic"],["ru","cyrillic"],["uk","cyrillic"],["bg","cyrillic"],["sr","cyrillic"],["sr-cyrl","cyrillic"],["sr-latn","latin"],["mk","cyrillic"],["uz","cyrillic"],["zh","han"],["zh-chs","han"],["zh-cht","han"],["ja","han"],["ko","han"],["vi","latin"],["en","latin"],["de","latin"],["fr","latin"],["es","latin"],["it","latin"],["pt","latin"],["ca","latin"],["nl","latin"],["pl","latin"],["tr","latin"],["sv","latin"],["cs","latin"],["da","latin"],["hu","latin"],["no","latin"],["nb","latin"],["ro","latin"],["fi","latin"],["ms","latin"],["sk","latin"],["et","latin"],["hr","latin"],["lt","latin"],["sl","latin"],["id","latin"],["lv","latin"],["gl","latin"],["is","latin"],["sq","latin"],["nn","latin"],["cy","latin"],["af","latin"],["mt","latin"],["ga","latin"],["eo","latin"],["so","latin"],["sw","latin"],["bs","latin"],["eu","latin"],["az","latin"],["ht","latin"],["la","latin"],["za","latin"]]);return null!==(r=null!==(a=null!==(n=null==s?void 0:s[t])&&void 0!==n?n:null==o?void 0:o[null!==(i=l.get(t))&&void 0!==i?i:""])&&void 0!==a?a:null==o?void 0:o.others)&&void 0!==r?r:5})(p,g),v=null!==(l=p.minConfidence)&&void 0!==l?l:70,y=null===(c=u.find((e=>e.code===n)))||void 0===c?void 0:c.score;if(n!==g){if(C(a))return{code:g,confidenceLevel:i.LOW};if(a.length<h)return{code:g,confidenceLevel:i.LOW};if(y&&y>=v)return{code:n,confidenceLevel:i.LOW}}return{code:g,confidenceLevel:i.HIGH}}catch(n){return e.newLogger("toSourceLanguageCode","data-resolvers-common").error(`Failed to calculate source language code from language stamp: ${t}.`),null}},C=e=>e.includes("<blockquote"),T=(e,t,n,a)=>{const r=null==t?void 0:t.code;if(!e||!r||(null==t?void 0:t.confidenceLevel)===i.LOW)return!1;const o=e.knownLanguages;if(r===e.targetLanguageCode||o.includes(r))return!1;switch(e.translationMode){case"SUGGEST_TRANSLATION":return!0;case"ALWAYS_TRANSLATE":if(n&&a===l.C1.ShowOriginalMessage)return!0}return!1},b=(e,t)=>{if(!e)return l.C1.ShowOriginalMessage;if(!t)return l.C1.Done;switch(t){case s.AO.Success:return l.C1.Done;case s.AO.SkipTranslation:return l.C1.TranslationNotNeeded;case s.AO.MessageNotFound:return l.C1.MessageNotFound;case s.AO.VersionNotFound:return l.C1.VersionNotFound;case s.AO.LanguageDetectionFailed:return l.C1.LanguageDetectionFailed;case s.AO.UnsupportedSourceLanguage:return l.C1.UnsupportedSourceLanguage;default:return l.C1.UnknownError}},S=e=>{const{body:t,subject:n,title:i,toggled:a,detectedLanguageName:r,sourceLanguageCode:o,targetLanguageCode:s,isOnDemandTranslation:d,isInProgress:c,error:u}=e||{};if(c)return{translationStatus:l.C1.InProcess};return(void 0!==t||void 0!==u)&&r&&o&&s?{translationStatus:b(!!a,u),translatedSubject:n,translatedContent:t,translatedTitle:i,isOnDemandTranslation:d,sourceLanguageName:r,sourceLanguageCode:o}:void 0},I=(e,t,n)=>{if(!n)return!1;let i=null;return n&&(i=n.find((e=>e.languageCode===t))),!(!i||i.messageId===e)}},205480:(e,t,n)=>{n.d(t,{ne:()=>l,cx:()=>d,zP:()=>v});var i=n(982346),a=n(451567),r=n(405501),o=n(711676),s=n(74583);const l=(e,t,n,i)=>{const r=a.eo.getRequestCount(e),{accountEnabled:o,mri:s,objectId:l,displayName:d,givenName:p,surname:v,type:f,jobTitle:C,userPrincipalName:T,email:b,tenantId:S,sipProxyAddress:I,mobile:L,telephoneNumber:M,tenantName:w,decoratedDisplayName:O,cid:U,description:k,externalCalendarEmailAddress:A,homeMri:D,homeTenantId:N,mtoLabel:E,profileType:P,avatarETag:x}=e,F={__typename:"User",accountEnabled:o,id:y(e),objectId:l,mri:s,displayName:d,givenName:p,surname:v,type:f,jobTitle:C,userPrincipalName:T,email:b,tenantId:n||S||null,sipProxyAddress:I,mobile:L,telephoneNumber:M,requestCount:r,preferredUserName:t,tenantName:w||null,decoratedDisplayName:O||null,cid:U,description:k,externalCalendarEmailAddress:A,emailForQuery:i,homeMri:D,homeTenantId:N,mtoLabel:E,profileType:P,avatarETag:x};return function(e,t){const n=e.department;n&&(t.department=n)}(e,F),m(e,F),g(e,F),c(e,F),u(e,F),h(F),F},d=e=>{const{id:t,displayName:n,description:i,email:a,phone:r,mri:o,requestCount:s,syncSource:l}=e;return{__typename:"User",id:t,mri:o,objectId:o,displayName:n,userPrincipalName:o,givenName:n,surname:n,description:i,email:a,mobile:r,telephoneNumber:r,requestCount:s,syncSource:l}},c=(e,t)=>{var n;if(function(e){var t;const n=e;return void 0!==n.isFederated||void 0!==n.isAnonymousB2bUser||"federated"===(null===(t=n.type)||void 0===t?void 0:t.toLowerCase())}(e)){const{isFederated:i,fetchErrorCode:a,isAnonymousB2bUser:r}=e;t.isFederated=i||"federated"===(null===(n=e.type)||void 0===n?void 0:n.toLowerCase()),t.fetchErrorCode=a,t.isAnonymousB2bUser=r}else t.isFederated=null,t.fetchErrorCode=null,t.isAnonymousB2bUser=null},u=(e,t)=>{e.featureSettings&&(t.featureSettings=e.featureSettings),e.isBlocked&&(t.isBlocked=e.isBlocked),e.cid&&(t.cid=e.cid),e.isIbBarred&&(t.isInfoBarrierSet=e.isIbBarred),e.isAnonymousUser&&(t.isAnonymousUser=e.isAnonymousUser),e.phonesInfo&&(t.phonesInfo=(0,s.cloneDeep)(e.phonesInfo)),e.emailsInfo&&(t.emailsInfo=(0,s.cloneDeep)(e.emailsInfo)),e.xtapUser&&(t.xtapUser=e.xtapUser),e.companyName&&(t.companyName=e.companyName),e.tenantName&&(t.tenantName=e.tenantName),e.imageUri&&(t.imageUri=e.imageUri),e.selfAvatarLastupdatedTime&&(t.selfAvatarLastupdatedTime=e.selfAvatarLastupdatedTime),e.avatarUrl&&(t.avatarUrl=e.avatarUrl),t.isShortProfile=e.isShortProfile},g=(e,t)=>{(function(e){return void 0!==e.userType}(e)||function(e){const t=e;return t.type?t.type===i.t.botType:(0,o.bl)(e.mri)}(e)||function(e){var t,n;return"aduser"===(null===(t=e.type)||void 0===t?void 0:t.toLowerCase())||"aduser"===(null===(n=e.$$subType)||void 0===n?void 0:n.toLowerCase())}(e))&&(t.userType=e.userType,t.description=e.description,t.isUnified=e.isUnified,t.securityEnabled=e.securityEnabled,t.featureSettings=e.featureSettings,t.imageUri=e.imageUri,t.userLocation=e.userLocation)},m=(e,t)=>{const n=e.phones;n&&(t.phones=n.map((e=>p(e))))},p=e=>({number:e.number,type:e.type}),h=e=>{const{mri:t}=e;if((0,r.EG)(t)&&!e.displayName){const n=(0,r.Ol)(t);e.displayName=n,e.givenName=n}else if(t&&(0,o.MR)(t)&&!e.displayName){const n=(0,o.vq)(t);e.displayName=n,e.givenName=n}else e.displayName||(e.displayName="Unknown User");return e},v=e=>!!e&&!("string"!=typeof e||!a.eo.isTFLSmsVerifiedMri(e)),y=e=>e.mri||e.objectId||e.concatenatedId},762757:(e,t,n)=>{var i;n.d(t,{P:()=>i,X:()=>a}),function(e){e.DefaultDark="defaultDark",e.Default="default",e.NoLongerAllowed="noLongerAllowed"}(i||(i={}));const a={[i.DefaultDark]:"/evergreen-assets/illustrations/error/something-went-wrong-v2-dark.svg",[i.Default]:"/evergreen-assets/illustrations/error/something-went-wrong-v2.svg",[i.NoLongerAllowed]:"/evergreen-assets/illustrations/error/license-error-no-longer-allowed-hero.svg"}},74346:(e,t,n)=>{n.d(t,{aW:()=>l,Pd:()=>d,uL:()=>f,$o:()=>C,B4:()=>w,$Z:()=>O,r4:()=>U,Sz:()=>D});var i=n(88204),a=n(760005),r=n(711676),o=n(607586);const s="The row was removed for this reason -";var l;!function(e){e.Default="default",e.Voicemail="voicemail",e.CallParkService="callParkService",e.OriginalEmergencyCallParticipant="originalEmergencyCallParticipant"}(l||(l={}));const d=({messages:e,callLogsBlacklistedMRIs:t,currentUserMri:n,logger:i,options:{enableRichCallHistoryExtension:a,enableSLACallHistory:r,enableSLACallHistoryFromPersonalHistory:o,currentTabDelegatorId:s,isLogMergedWithSharedCorrelationId:l,enableRecordingAndTranscribingInCallsAppV2:d},tableType:f,callQueueId:C,keepTranscriptMessages:b})=>{const S=r?e.filter((({callLog:e})=>e&&e.isSharedLineAppearanceCallHistory)):[],I=r?e.filter((({callLog:e})=>e&&e.isDeleted)):[],L=e.filter((e=>{if(e.callLog){const l={callLog:e.callLog,logger:i,tableType:f},d=A(O(e.callLog,C).isCallQueue,e.callLog);return!(c(l)||u(l,t)||g(l,I)||m(l,n)||p(l)||h(l)||v(l,n,S,r,o,s)||y(l,n,a)||d)}return!1}));return T({allValidMessages:L,enableRecordingAndTranscribingInCallsAppV2:!!d,logger:i,isLogMergedWithSharedCorrelationId:l,tableType:f,callQueueId:C,keepTranscriptMessages:b})},c=e=>{const{callLog:t,logger:n,tableType:a}=e,r=!!t.sessionType&&t.sessionType===i.FT.ScreenSharing;return r&&n.log(`[isScreenSharingSession] [tableType=${a}] ${s} it is tied to a screensharing session`,t),r},u=(e,t)=>{const{callLog:n,logger:i,tableType:a}=e,r=!!n.targetParticipant&&t.indexOf(n.targetParticipant.id)>-1;return r&&i.log(`[isTargetBlacklisted] [tableType=${a}] ${s} it is part of the blacklisted MRIs`,n),r},g=(e,t)=>{const{callLog:n,logger:i,tableType:a}=e,r=n.isDeleted||t.find((e=>{var t;return(null===(t=e.callLog)||void 0===t?void 0:t.callId)===n.callId}));return r&&i.log(`[isCallHistoryDeleted] [tableType=${a}] ${s} it is deleted`,n),r},m=(e,t)=>{const{callLog:n,logger:i,tableType:a}=e;if(!n.participantList)return!1;const r=!n.targetParticipant&&1===n.participantList.length&&n.participantList[0].id===t;return r&&i.log(`[isGroupCallDeclinedByAllParticipants] [tableType=${a}] ${s} it is an outgoing group call with no target to display because the call was unanswered/declined by all parties`,n),r},p=e=>{var t;const{callLog:n,logger:a,tableType:r}=e,o=n.callDirection===i.kw.Outgoing&&!n.targetParticipant&&!(null===(t=n.participantList)||void 0===t?void 0:t.length);return o&&a.log(`[isOutgoingCallWithNoTarget] [tableType=${r}] ${s} it is an outgoing 1:1 call that does not have target participant to display`,n),o},h=e=>{var t;const{callLog:n,logger:i,tableType:a}=e,r=l.CallParkService.toString(),o=(null===(t=n.targetParticipant)||void 0===t?void 0:t.type)===r;return o&&i.log(`[isCallHistoryWithCallParkBot] [tableType=${a}] ${s} it is a parked call with the Call Park service bot`,n),o},v=(e,t,n,i,a,r)=>{var o;const{callLog:l,logger:d,tableType:c}=e,{isSharedLineAppearanceCallHistory:u,isSharedLineAppearanceActivated:g,targetDelegator:m,originatorDelegator:p}=l;if(!i&&u)return d.log(`[slaCallHistoryFiltering] [tableType=${c}] ${s} it is an SLA call history from shared history and enableSLACallHistory is disabled`,l),!0;if((null===(o=l.recordings)||void 0===o?void 0:o.length)||l.transcript)return!1;const h=u||g&&a;if(r){const e=!h||!m&&!p||m&&m.id!==r||p&&p.id!==r;return e&&d.log(`[slaCallHistoryFiltering] [tableType=${c}] ${s} it is an SLA call history that is not to be displayed on the current delegator's tab. [currentTabDelegatorId=${r}]`,l),e}{const e=h&&(m&&m.id!==t||p&&p.id!==t),i=!u&&n.find((e=>{var t;return(null===(t=e.callLog)||void 0===t?void 0:t.callId)===l.callId})),a=e||i;return a&&d.log(`[slaCallHistoryFiltering] [tableType=${c}] ${s} it is an SLA call history that is not to be displayed on the personal tab. [isSlaCallHistoryForDelegatorTab=${e}] [isSlaCallHistoryDuplicateOnPersonalTab=${i}]`,l),a}},y=(e,t,n)=>{const{callLog:a,logger:r,tableType:o}=e,l=!n&&f(a,t)&&a.forwardingType===i.Io.Immediate;return l&&r.log(`[tableType=${o}] ${s} it is an immediate forwarded call for the forwarder`,a),l},f=(e,t)=>{const{forwarderParticipant:n,forwardedTargetParticipant:i}=e;return!!(!n&&i||n&&n.id===t)},C=({callType:e,threadId:t,participantList:n})=>e===i.Bd.MultiParty&&(n&&n.length>1||!!t),T=({allValidMessages:e,enableRecordingAndTranscribingInCallsAppV2:t,logger:n,isLogMergedWithSharedCorrelationId:i,tableType:a,callQueueId:r,keepTranscriptMessages:o})=>{const s=b(e,!!t,n,a,o);return i&&S(a)?I(s,n,a,r):s},b=(e,t,n,i,r)=>{if(!t)return e.filter((e=>{const t=e.callLog.messageType!==a.Cs.CallTranscript&&e.callLog.messageType!==a.Cs.CallRecording&&e.callLog.messageType!==a.Cs.CallLogTranscript&&e.callLog.messageType!==a.Cs.CallLogRecording;return t||n.log(`[mergeMessagesWithRecordingsAndTranscript] [tableType=${i}] ${s} it is a call tied to transcript/recording that is filtered because enableRecordingAndTranscribingInCallsAppV2 is disabled`,e.callLog),t}));const o=new Map,l=new Map,d=new Map;e.forEach((e=>{const{messageType:t,callId:n,userParticipantId:i,isSharedLineAppearanceCallHistory:r}=e.callLog;if(!e.callLog)return;const s=r?n:`${n}-${i}`;(t===a.Cs.CallTranscript||t===a.Cs.CallLogTranscript)&&d.set(s,e),(t===a.Cs.CallRecording||t===a.Cs.CallLogRecording)&&l.set(s,[...l.get(s)||[],e]),t===a.Cs.HTML&&o.set(s,e)}));const c=[];return o.forEach(((e,t)=>{const a=d.get(t);return a&&d.delete(t),c.push(M(e,n,i,a,l.get(t)))})),r&&d.forEach((e=>c.push(e))),c},S=e=>e===i.o8.CallsApp,I=(e,t,n,i)=>{const a=[],r=new Map;return e.forEach((e=>{if(!e.callLog)return void t.warn(`[mergeMessageWithSharedCorrelationId] Did not receive a call log property or invalid messageId [messageId=${e.id}]`);if(!e.callLog.sharedCorrelationId)return void a.push(e);if(e.callLog.targetParticipant&&e.callLog.targetParticipant.id.startsWith(o.V.Bot))return void(w(e.callLog.targetParticipant.id)?a.push(e):t.log(`[mergeMessageWithSharedCorrelationId] [tableType=${n}] ${s} the target participant is a bot that isn't the VoiceApp bot`,e.callLog));const l=r.get(e.callLog.sharedCorrelationId),d=O(e.callLog,i).isCallQueue;if(!l)return void r.set(e.callLog.sharedCorrelationId,{callLog:e.callLog,id:e.callLog.messageId,isCq:d,duration:U(e.callLog)});t.log(`[mergeMessageWithSharedCorrelationId] [tableType=${n}] ${s} This call history row was merged into another because they share the same correlation id [sharedCorrelationId=${e.callLog.sharedCorrelationId}]`,e.callLog);const c=d===l.callLog.startTime<e.callLog.startTime?e.callLog:l.callLog,u=d?U(c):U(e.callLog)+l.duration,g=`${l.id}_${e.callLog.messageId}`;r.set(e.callLog.sharedCorrelationId,{callLog:c,id:g,isCq:d,duration:u})})),r.forEach((({isCq:e,id:t,callLog:n,duration:i})=>{let r=n;e||(r=n.cloneWithConnectAndEndTime?n.cloneWithConnectAndEndTime(Object.assign(Object.assign({},L(n.startTime,i)),{messageId:t})):Object.assign(Object.assign(Object.assign({},n),L(n.startTime,i)),{messageId:t})),a.push({callLog:r,id:t})})),a},L=(e,t)=>{const n=new Date(e);return{connectTime:e,endTime:new Date(n.valueOf()+t).toISOString()}},M=(e,t,n,i,a)=>{var r,o,s;let l=Object.assign({},e);const d=(e=>{const t=[];return e&&e.forEach((e=>{var n,i;(null===(i=null===(n=e.callLog)||void 0===n?void 0:n.recordings)||void 0===i?void 0:i.length)&&t.push(e.callLog.recordings[0])})),t})(a),c=null===(r=null==i?void 0:i.callLog)||void 0===r?void 0:r.transcript;return(c||d.length)&&(l.callLog.cloneWithTranscriptAndRecording?l.callLog=l.callLog.cloneWithTranscriptAndRecording({callId:l.callLog.callId,userParticipantId:l.callLog.userParticipantId,transcript:c,recordings:d}):l=Object.assign(Object.assign({},e),{callLog:Object.assign(Object.assign({},e.callLog),{transcript:c,recordings:d})})),(l.callLog.transcript||l.callLog.recordings.length)&&t.log(`[toCallHistoryRows] [tableType=${n}] ${l.callLog.transcript?"1 transcript row & ":""} ${(null===(o=l.callLog.recordings)||void 0===o?void 0:o.length)?`${null===(s=l.callLog.recordings)||void 0===s?void 0:s.length} recording row(s)`:""} were merged into this row`,l.callLog),l},w=e=>!!e&&(0,r.B4)(e,a.f0),O=({callType:e,applicationContent:t},n)=>{const a={isCallQueue:!1,isForCurrentCallQueue:!1,callQueueType:null};if((null==t?void 0:t.type)===i.G_.HuntGroup){switch(e){case i.Bd.TwoParty:a.callQueueType=i.Fk.transfer;break;case i.Bd.MultiParty:a.callQueueType=i.Fk.conference}a.isCallQueue=void 0!==a.callQueueType,a.isForCurrentCallQueue=k(n,t.configId)}else(null==t?void 0:t.type)===i.G_.CallableChannelOboCall&&(a.isCallQueue=!0,a.isForCurrentCallQueue=k(n,t.configId));return a},U=({endTime:e,connectTime:t,targetParticipant:n})=>{let i=0;if(t&&e&&(null==n?void 0:n.type)!==l.Voicemail.toString()){const n=new Date(e),a=new Date(t);i+=Math.round(n.getTime()-a.getTime())}return i},k=(e,t)=>!!e&&!!t&&e===t,A=(e,t)=>e&&t.callDirection===i.kw.Incoming&&t.callState!==i.Qv.Accepted,D=e=>{let t;return t="string"!=typeof e?"":e.includes(";ext=")?e:e.split(";")[0],t}},181620:(e,t,n)=>{n.d(t,{Fd:()=>o,s3:()=>l,HC:()=>d,wm:()=>c,LY:()=>u,vW:()=>g,Bj:()=>m});var i=n(74583);if(613666==n.j)var a=n(956255);var r=n(760005);function o(e,t){try{const n=s(e);if("https://local.teams.office.com"===new URL(e).origin)return!0;for(const e of(0,i.uniqBy)(t,(e=>e.toLowerCase()))){let t="";const i=e.split(".");for(let e=0;e<i.length;e++)t+=(e>0?"[.]":"")+i[e].replace("*","[^/^.]+");const a=new RegExp(`^https://${t}((/|\\?).*)?$`,"i");if(n.match(a))return!0}}catch(e){return!1}return!1}const s=e=>new URL(e).href,l=(e,t)=>{let n="";if(!e.id||c(e.id))return n;switch(e.type){case a.py.extensions:try{n=JSON.parse(e.id).threadId}catch(t){n=e.id}break;case a.py.chats:n=e.id.replace("replyChainId","messageid");break;case a.py.communities:case a.py.channels:let i;try{i=JSON.parse(e.id).channelId}catch(t){i=e.id}n=t?`${i};messageid=${t}`:i;break;case a.py.shareformdialog:break;case a.py.meetingcollaboration:default:n=e.id}return n},d=e=>e&&e.replace(new RegExp(`^${r.at.BotPrefix}`),""),c=e=>"newchat"===e||(null==e?void 0:e.includes("preview")),u=(e,t=r.Cs.Call)=>t===r.Cs.Call&&/<partlist/.test(e)&&!m(e,t),g=e=>e.includes('<conversationType>"huddleGroupCall"</conversationType>'),m=(e,t=r.Cs.Call)=>t===r.Cs.Call&&(-1!==e.indexOf("<ended/>")||/^<partlist[^>]*type="ended"/.test(e))},405501:(e,t,n)=>{n.d(t,{EG:()=>a,em:()=>r,of:()=>d,_7:()=>c,Ol:()=>u,DI:()=>g,gx:()=>m,bR:()=>p,TE:()=>h});var i=n(607586);const a=e=>Boolean(e&&e.startsWith(i.V.Pstn)),r=e=>!(!e||!e.startsWith(i.V.AcsUser)),o=/4:[^-_]*-[^-_]*-[^-_]*-[^-_]*-.*/,s=/^\+?\d*[ ]*(\([ ]*\d+[ ]*\))?[0-9 -]+((?:;ext=([0-9]{1,7})|[ \t,]*(?:e?xt(?:ensi(?:o?|))?n?|??|[,x#~]|int|anexo|)[:\.]?[ \t,-]*([0-9]{1,7})#?|[- ]+([0-9]{1,5})#))?$/i,l=e=>e.indexOf("_"),d=e=>{if(!a(e))return!1;const t=e.slice(i.V.Pstn.length);return-1!==l(t)},c=(e,t)=>o.test(e)&&t,u=e=>{let t=e.slice(i.V.Pstn.length);const n=l(t);return-1!==n&&(t=t.slice(0,n)),t},g=e=>e?`4:${e.replace(/-/g,"").replace(/\s/g,"")}`:"",m=e=>e.replace(/_([a-z]+\d+|\d+[a-z]+)[a-z\d]*$/gi,""),p=e=>{const t=(e=>e.replace(/[ \(\)\-_\/]+/g,""))(m(e));return t},h=e=>s.test(null==e?void 0:e.trim())},38613:(e,t,n)=>{function i(e=1){const t=new Uint32Array(e),i=n.g;if(i.msCrypto)i.msCrypto.getRandomValues(t);else if(i.crypto)i.crypto.getRandomValues(t);else{let n=e;for(;n--;){const e=4294967296;t[n]=Math.floor(Math.random()*e)}}return Array.from(t)}function a(e){return 0===(t=1/e,Math.floor(Math.random()*t));var t}n.d(t,{MX:()=>i,uE:()=>a})},533464:(e,t,n)=>{n.d(t,{hN:()=>i,jE:()=>r,mo:()=>c,PI:()=>u,Xn:()=>g,BN:()=>h,Np:()=>y,mW:()=>f,Qz:()=>C,zG:()=>T,cE:()=>b,MV:()=>S,Wg:()=>I,_Y:()=>L,cI:()=>w,t_:()=>O,gC:()=>A});var i,a,r,o=n(760005),s=n(711676),l=n(74583),d=n(982346);!function(e){e.TeamsOnly="TeamsOnly",e.SfBOnly="SfBOnly",e.SfBWithTeamsCollab="SfBWithTeamsCollab",e.SfBWithTeamsCollabAndMeetings="SfBWithTeamsCollabAndMeetings",e.Islands="Islands",e.IslandsWithTempInterop="IslandsWithTempInterop",e.IslandsWithVoipDeepLinking="IslandsWithVoipDeepLinking"}(i||(i={})),function(e){e[e.Islands=1]="Islands",e[e.IslandsWithTempInterop=2]="IslandsWithTempInterop",e[e.IslandsWithVoipDeepLinking=3]="IslandsWithVoipDeepLinking",e[e.SfBOnly=4]="SfBOnly",e[e.SfBWithTeamsCollab=5]="SfBWithTeamsCollab",e[e.SfBWithTeamsCollabAndMeetings=6]="SfBWithTeamsCollabAndMeetings",e[e.TeamsOnly=7]="TeamsOnly",e[e.Legacy=8]="Legacy"}(a||(a={})),function(e){e[e.Teams=0]="Teams",e[e.SfB=1]="SfB",e[e.Federated=2]="Federated",e[e.NativeFederated=3]="NativeFederated"}(r||(r={}));const c=e=>!!(e&&e.coExistenceMode&&i[e.coExistenceMode]),u=e=>!(e!==i.TeamsOnly),g=e=>!(-1===[i.Islands,i.IslandsWithTempInterop,i.IslandsWithVoipDeepLinking].indexOf(e)),m=e=>!(-1===[i.SfBOnly,i.SfBWithTeamsCollab,i.SfBWithTeamsCollabAndMeetings].indexOf(e)),p=(e,t,n=!1)=>{const i=[o.Jq,o.Dr,o.iO,o.TO,o.pk,o.P_],a=e.split(":");return i.some((e=>{const i=a.findIndex((t=>t===e.slice(0,-1)));return i>=0&&(n?a.splice(i+1,1):a.splice(i+1,0,t.slice(0,-1)),!0)})),a.join(":")},h=e=>!!e&&(0,l.startsWith)(e,o.at.SkypeSpacesUser+o.pW),v=e=>!!e&&e.includes(o.pW)&&!(0,l.startsWith)(e,o.at.SkypeSpacesUser+o.pW),y=e=>!e||v(e)?e:e.includes(o.at.SkypeSpacesUser)?p(e,o.pW):void 0,f=e=>!!e&&!(0,l.startsWith)(o.at.SkypeSpacesUser+o.m_,e)&&e.includes(o.m_),C=e=>!!e&&!(0,l.startsWith)(o.at.SkypeSpacesUser+o.U0,e)&&e.includes(`:${o.U0}`),T=e=>!e||C(e)?e:e.includes(o.at.SkypeSpacesUser)?p(e,o.U0):void 0,b=e=>!e||f(e)?e:e.includes(o.at.SkypeSpacesUser)?p(e,o.m_):void 0,S=e=>!e||(e=>!!e&&!e.startsWith(o.at.SkypeSpacesUser+o.fe)&&e.includes(o.fe))(e)?e:e.includes(o.at.SkypeSpacesUser)?p(e,o.fe):void 0,I=e=>{if(e){if(v(e))return p(e,o.pW,!0);if(f(e))return p(e,o.m_,!0)}return e},L=e=>e?C(e)?p(e,o.U0,!0):void 0:e,M={isAllowed:!1},w=(e,t,n,i,a,r,o,s)=>{const l=o&&o.coExistenceMode,d=r&&r.coExistenceMode;if(!l||!d)return{isAllowed:!0};if(i){const i=((e,t,n,i,a,r,o)=>{const s=o.newLogger("sfb-interop","services-utilities-sfb-interop");return r.isFederated?!i&&n?(s.log("Chat Disabled: current user is not provisioned on Sfb online"),M):r.coExistenceMode&&a.coExistenceMode?e&&n&&u(a.coExistenceMode)&&u(r.coExistenceMode)?{isAllowed:!1,mri:b(r.mri||"")}:n||t||!g(a.coExistenceMode)&&!g(r.coExistenceMode)?!n&&m(r.coExistenceMode)?{isAllowed:!1,toInterop:!0,mri:r.mri||""}:{isAllowed:!0}:{isAllowed:!1,toInterop:!0,mri:r.mri}:(s.log("Chat Enabled: TeamsUpgradePolicy is not defined for both users"),{isAllowed:!0}):(s.log("Federated Chat Disabled: recipient user is not federated"),(e=>({isAllowed:!1,toInterop:!1,mri:e.mri}))(r))})(e,t,n,a,r,o,s);if(!i.isAllowed)return i}else{const e=((e,t)=>t.coExistenceMode?e&&u(t.coExistenceMode)?{isAllowed:!1,mri:I(t.mri||"")}:!e&&m(t.coExistenceMode)?{isAllowed:!1,mri:y(t.mri||""),toInterop:!0}:{isAllowed:!0}:{isAllowed:!0})(n,o);if(!e.isAllowed)return e}return{isAllowed:!0}},O=e=>{const t=f(e);return U(e)||v(e)||t?(n=e)&&((0,l.startsWith)(n,o.at.SkypeSpacesUser+o.ng)||(0,l.startsWith)(n,o.at.SkypeSpacesUser+o.Fp)||(0,l.startsWith)(n,o.at.SkypeSpacesUser+o.cz)||(0,l.startsWith)(n,o.at.SkypeSpacesUser+o.Mt)||(0,l.startsWith)(n,o.at.SkypeSpacesUser+o.Md))?e:t?e.replace(o.m_,""):e.replace(o.pW,"").replace(o.zt,""):e;var n},U=e=>!!e&&!(0,l.startsWith)(o.at.SkypeSpacesUser+o.zt,e)&&e.includes(o.zt),k=(e,t,n,i)=>{const r=e.isFederated,o=(s=e.mri||"",(0,l.endsWith)(s,"@sfbonprem.unq.gbl.spaces"));var s;if(t&&r&&!o&&e.coExistenceMode){const t=a[e.coExistenceMode],r=n===a.TeamsOnly&&t===a.TeamsOnly;return r||i.log(`isNativeFederationMode is false - currentUserMessagingPolicyMode:${a[n]} recipientCoexistenceMode:${a[t]}`),r}return i.log(`isNativeFederationMode is false - enableNativeP2PFederatedChats:${t} isFederated:${r} isOnPremFederated:${o} coExistenceMode:${e.coExistenceMode}`),!1},A=(e,t,n,i,o,l)=>{if(!(e&&e.mri&&e.userType!==d.vf.guest&&e.type!==d.vf.skypeConsumer&&e.type!==d.vf.tflUser&&(0,s.eZ)(e.mri)))return n.log("getUserChatMode - Defaulting to teams chat mode as user profile is undefined or Guest or TFL user or is not a real user mri"),r.Teams;if(e.isFederated)return n.log(`getUserChatMode - federated user - mri: ${e.mri}, coExistenceMode: ${e.coExistenceMode}`),k(e,o,l,n)?r.NativeFederated:r.Federated;const c=((e,t,n)=>{const i=e.coExistenceMode,o=a[i];if(n.log(`getCoexistenceChatMode - caller: ${t}, mri: ${e.mri}, isShortProfile: ${e.isShortProfile}, coExistenceMode: ${a[o]}, MT coExistenceMode: ${i}`),a[o]!==i&&n.error(`getUserChatMode - Mapping error - coExistenceMode : ${a[o]}, MT coExistenceMode: ${i}`),o){const e=[a.SfBOnly,a.SfBWithTeamsCollab,a.SfBWithTeamsCollabAndMeetings],t=[a.TeamsOnly,a.Islands,a.IslandsWithVoipDeepLinking];if(e.includes(o))return r.SfB;if(t.includes(o))return r.Teams;n.warn(`getUserChatMode - unknown coExistenceMode ${a[o]}`)}else e.isShortProfile||n.warn(`getUserChatMode - full profile has no coExistenceMode for mri ${e.mri}`)})(e,t,n);if(c)return c;const u=h(e.mri),g=e.isSkypeTeamsUser,m=(e=>!(!e.isFederated&&void 0!==e.isPrivateChatEnabled)||e.isPrivateChatEnabled)(e);return n.log(`getUserChatMode - caller: ${t}, mri: ${e.mri}, isSfbMri: ${u}, isTeamsChatEnabled: ${m}, hasLoggedInToTeams: ${g}, isSipDisabled: ${e.isSipDisabled}, isSfBEligible: ${i}`),!u&&g&&m||e.isSipDisabled||!i?r.Teams:r.SfB}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/801753-3c722b658887f404.js.map