(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[219271],{545196:(e,t,i)=>{"use strict";i.d(t,{K:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"controllerConnectedServicesEnabled"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"readReceiptsEnabled"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferences"}}},arguments:[]}]}}]}},703793:(e,t,i)=>{"use strict";i.d(t,{N:()=>a});var n=i(740597),o=i(186921);let r;class s{constructor(e){this.serializeCacheKey=e=>{var t;const{typeName:i,user:n,key:o}=e;return`tmp.auth.v1.${null!==(t=null==n?void 0:n.id)&&void 0!==t?t:"GLOBAL"}.${i}.${o?o.toUpperCase():i}`},this._indexedDbProvider=e}getValue(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const t=this.serializeCacheKey(e);return yield this._indexedDbProvider.getValue(t)}catch(e){return void o.q.log(`getValue:${e}`)}}))}put(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const i=this.serializeCacheKey(e);return yield this._indexedDbProvider.put(i,t),!0}catch(e){return o.q.log(`put:${e}`),!1}}))}del(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const t=this.serializeCacheKey(e);return yield this._indexedDbProvider.del(t),!0}catch(e){return o.q.log(`delete:${e}`),!1}}))}}const a=e=>r||(r=new s(e),r)},535059:(e,t,i)=>{"use strict";i.d(t,{zF:()=>p,db:()=>v,l_:()=>y,o8:()=>f,mM:()=>S,kh:()=>k,lj:()=>b,BZ:()=>w,VT:()=>C});var n=i(740597),o=i(466094),r=i(765053),s=i(278593),a=i(588470),l=i(136613),c=i(804589),d=i(186921),u=i(928665),m=i(942209),g=i(206083),h=i(959078);const p=(e,t)=>{let i;if(t){const n=a.Jt.getAllOfType("User").filter((e=>e.profile.tid===t&&e.type!==o.Ch.Anonymous));if(n.length>1){const t=a.Jt.getValue(l.Jl.globalUser);if(i=!!e&&n.find((t=>t.id===e))||n.find((e=>e.id===t.id)),i)return i;throw{message:"Multiple users found in cache with same tenantId",errorCode:c.SM.MultipleUsersPresentWithSpecifiedIdentifier}}return n[0]}if(e){const t=a.Jt.getAllOfType("User");i=null==t?void 0:t.filter((t=>t.id===e))[0]}else i=a.Jt.getValue(l.Jl.globalUser);return i},v=e=>{if(!e)return[];return a.Jt.getAllOfType("User").filter((t=>t.id!==e&&t.homeAccountId===e))||[]},y=(e,t)=>{if(!e||!t)return;return v(e).find((e=>e.profile.tid===t))},f=(e,t)=>{if(!e||!t)return!1;return e.some((e=>e.cloud!==t&&!e.id.startsWith("dummy-user")))},S=(e,t,i,o)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){null==i||i.addScenarioMark("auth_get_encryption_key_start");const n=a.Jt.getValue(l.Jl.encryptionKey);if("object"==typeof n)return null==i||i.addScenarioMark("auth_get_encryption_key_stop"),n;let s,c;null==i||i.addScenarioMark("auth_get_exported_key_start");try{if(o&&(0,g.n)(e)){const e=yield t.loadModule(r.nM.Auth);s=(yield e.acquireEncryptionKey({correlationId:(null==i?void 0:i.correlation.id)||(0,u.pW)()})).result}else{const e=a.Jt.getValue(l.Jl.exportedEncryptionKey);s=null==e?void 0:e.exportedKey}}catch(e){return null==i||i.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Acquiring the exported key failed."},"failure"),null==i||i.addScenarioMark("auth_get_encryption_key_stop"),null}if(!s)return null==i||i.addScenarioMark("auth_get_exported_key_stop",{reason:"No exported encryption key."}),void(null==i||i.addScenarioMark("auth_get_encryption_key_stop"));try{c=yield e.crypto.subtle.importKey("raw",(0,m.k)(s),{name:"AES-CBC"},!0,["encrypt","decrypt"]),a.Jt.put(l.Jl.encryptionKey,c),null==i||i.addScenarioMark("auth_get_exported_key_stop")}catch(e){null==i||i.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Importing the key failed"},"failure"),c=null}return null==i||i.addScenarioMark("auth_get_encryption_key_stop"),c})),k=(e,t,i)=>{const n=o.JE[s.j[e]],r=p(t,void 0);if(!r)return void d.q.warn(`[AuthState] Account ${t} not found when attempting to write userAuthState`);const c=(0,h.Xx)(r),m=(0,u.u4)(null==i?void 0:i.reason)||n;a.Jt.put((0,l.VF)(c).userAuthState,{state:n,reason:m,customError:i?{errorCode:i.errorCode||i.code,message:i.message,isExpected:i.isExpected,context:i.context,subContext:i.subContext,correlationId:i.correlationId}:null}),i?d.q.warn(`[AuthState] UserAuthState updated - ${t} : ${n} errorCode: ${i.errorCode} isExpected: ${i.isExpected} correlationId: ${i.correlationId}`):d.q.log(`[AuthState] UserAuthState updated - ${t} : ${n}`)},b=()=>a.Jt.getValue(l.Jl.logoutState),w=()=>a.Jt.getValue(l.Jl.previousSignInProgressState),C=()=>a.Jt.del(l.Jl.previousSignInProgressState)},588470:(e,t,i)=>{"use strict";i.d(t,{Jt:()=>u,ky:()=>f});var n=i(740597),o=i(804589),r=i(186921),s=i(928665),a=i(959078),l=i(136613);const c=[o.aw,o.ZU,o.Fz],d={KeyVersion:"v1",UseAccountIdKey:!0};let u;const m=e=>d.UseAccountIdKey?(null==e?void 0:e.id)||"":e?JSON.stringify({tenantId:e.tenantId,oid:e.oid,accountType:e.accountType,userName:e.userName}):JSON.stringify(void 0),g=(e,t,i)=>`tmp.auth.${d.KeyVersion}.${e}.${t}.${i}`,h=e=>{const{typeName:t,user:i}=e;return{user:e.user?m(i):"GLOBAL",typeName:t,key:e.key?e.key.toUpperCase():t}},p=(e,t)=>({storageKey:d.UseAccountIdKey?g(t.user,t.typeName,t.key):`$[${t.user}][${t.typeName}][${t.key}]`,loggingKey:g(e.user?`${e.user.id}`:t.user,t.typeName,t.key)});class v{constructor(e,t){this._coreSettings=t,this._expireOffsetSeconds=o.rF.SECONDS_FIVE_MINUTES,this._expireOffsetSecondsMin=o.rF.SECONDS_PER_MINUTE,this.internalCache={GLOBAL:{User:{},Token:{},MsalAccount:{}}},this._initializeCacheForCacheItem=(e,t)=>{void 0===this.internalCache[t]?(this.internalCache[t]={},this.internalCache[t][e]={}):void 0===this.internalCache[t][e]&&(this.internalCache[t][e]={})},this._addToExternalCache=(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){let i=t;t.item.encryptedToken&&(i=this._deepCopyEncryptedToken(t));const n=h(e),{storageKey:o,loggingKey:a}=p(e,n);try{this._storage.setItem(o,(0,s.u4)(i))}catch(e){r.q.error(`error in putting key [${a}] in storage, error - [${(0,s.VK)(e)}]`)}})),this._deepCopyEncryptedToken=e=>{const t=e.item,i=Object.assign({},t);return i.skypeToken?i.skypeToken="":i.token="",{item:i,hitCount:e.hitCount,shouldRefresh:e.shouldRefresh,refreshAfter:e.refreshAfter}},this._deleteFromExternalCache=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=h(e),{storageKey:i,loggingKey:n}=p(e,t);try{this._storage.removeItem(i)}catch(e){r.q.error(`error in deleting key [${n}] in storage, error - [${(0,s.VK)(e)}]`)}})),this._flushExternalCache=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const t={};Object.keys(this._storage).forEach((i=>{c.forEach((e=>{if(-1!==i.indexOf(e)){const e=this._storage.getItem(i);e&&(t[i]=e)}})),(!e&&0===i.indexOf("$[")||!e&&0===i.indexOf("tmp.auth")||e&&(-1!==i.indexOf(e.oid)||e.id&&-1!==i.indexOf(e.id)))&&this._storage.removeItem(i)})),Object.keys(t).forEach((e=>{this._storage.setItem(e,t[e])}))}catch(e){r.q.error(`error in clearing storage, error - [${(0,s.VK)(e)}]`)}})),this._isGlobalUser=e=>{var t,i;let n=null===(i=null===(t=this.internalCache.GLOBAL)||void 0===t?void 0:t.User)||void 0===i?void 0:i.User;return n||(n=this.get(l.Jl.globalUser)),n&&(0,a.FG)((0,a.Xx)(n.item),e)},this._putGlobalUserInCache=(e,t)=>{var i,n;if((null===(n=null===(i=this.internalCache.GLOBAL)||void 0===i?void 0:i.User)||void 0===n?void 0:n.User)&&e.user&&!this._isGlobalUser(e.user))return;const o=e.user?"GLOBAL":m((0,a.Xx)(t.item));this._initializeCacheForCacheItem("User",o),this.internalCache[o].User.User=t;const r=d.UseAccountIdKey?g(o,"User","User"):`$[${o}][User][User]`;this._storage.setItem(r,JSON.stringify(t))},this._validateValue=(e,t)=>{var i,n;if(!("Token"!==e.typeName||"object"==typeof t&&t.token&&t.expires))throw new Error("Invalid value for Token.");if(!("Discover"!==e.typeName||e.key!==o.rz||"object"==typeof t&&t.skypeToken&&t.expiration))throw new Error("Invalid value for Skype token.");if("User"!==e.typeName)return;const r=t;if(!(r.userName&&r.type&&r.role&&r.profile&&void 0!==r.isAuthenticated))throw new Error(`Invalid value for user. userName exists: [${!!r.userName}], type: [${r.type}], role: [${r.role}], profile exists: [${!!r.profile}],isAuthenticated: [${r.isAuthenticated}]`);const s=null===(n=null===(i=this.internalCache.GLOBAL)||void 0===i?void 0:i.User)||void 0===n?void 0:n.User,l=(0,a.Xx)(r);if(s&&!e.user&&!this._isGlobalUser(l))throw new Error("there is already global user in auth cache")},this._storage=e.localStorage,r.q.info("auth_cache initialized")}updateSetting(e,t){r.q.log(`Updating authCache setting ${e} from ${d[e]} to ${t}.`),"KeyVersion"===e&&(t!==d.KeyVersion&&(this.internalCache={}),d.KeyVersion=t),"UseAccountIdKey"===e&&(t!==d.UseAccountIdKey&&(this.internalCache={}),d.UseAccountIdKey=t)}setExpiryOffset(e,t){e&&(this._expireOffsetSeconds=e),t&&(this._expireOffsetSecondsMin=t)}put(e,t){var i,n;y(e),this._validateValue(e,t);const{typeName:o,key:r,user:s}=h(e),a="Token"===o||"Discover"===o&&"SKYPE-TOKEN"===r;a&&(t.fromCache=!0);let l=null===(n=null===(i=this.internalCache[s])||void 0===i?void 0:i[o])||void 0===n?void 0:n[r];return l?(l.hitCount=0,l.item=t):l={item:t,shouldRefresh:!1,hitCount:0},a&&(l.refreshAfter=function(e,t,i){const n=k(e,t);if(n&&i)return w(S(),n,i);return}(o,t,this.refreshPercents)),"User"===o&&this._putGlobalUserInCache(e,l),this._initializeCacheForCacheItem(o,s),this.internalCache[s][o][r]=l,this._addToExternalCache(e,l),!0}updateGlobalUser(e){const t="GLOBAL",i={item:e,shouldRefresh:!1,hitCount:0};return this._initializeCacheForCacheItem("User",t),this.internalCache[t].User.User=i,this._addToExternalCache(l.Jl.globalUser,i),!0}get(e){var t,i,n;y(e);const o=h(e),{storageKey:a,loggingKey:l}=p(e,o),{typeName:c,key:d,user:u}=o;let m=null===(i=null===(t=this.internalCache[u])||void 0===t?void 0:t[c])||void 0===i?void 0:i[d];const g=!!m;if(!m)try{const e=null===(n=this._storage)||void 0===n?void 0:n.getItem(a);e&&(m=JSON.parse(e))}catch(e){r.q.error(`value for key [${l}] throw error. ${(0,s.VK)(e)}`)}if(m)return this._initializeCacheForCacheItem(c,u),this.internalCache[u][c][d]=m,("Token"===c||"Discover"===c&&"SKYPE-TOKEN"===d)&&(m.shouldRefresh=this._shouldRefresh(m,c),m.hitCount++,this.internalCache[u][c][d]=m,this._addToExternalCache(e,m)),void 0===m.shouldRefresh?(r.q.info(`cacheItem '[${a}]' need to refresh`),void this.del(e)):(r.q.info(`returning cacheItem '[${a}]' from cache${m.shouldRefresh?", will be refreshed in background":""}. In memory:${+g} found: [${+!!m}]`),m);r.q.info(`value for key [${l}] not found in memory or storage`)}getValue(e){const t=this.get(e);return t?this._value(t):void 0}getAllOfType(e){const t=[],i=[];return Object.keys(this.internalCache).forEach((n=>{"GLOBAL"!==n&&Object.keys(this.internalCache[n][e]||{}).forEach((o=>{const{storageKey:r}=p({},{user:n,typeName:e,key:o});i.push(r),t.push(this.internalCache[n][e][o].item)}))})),Object.keys(this._storage).forEach((n=>{var o;if(-1===i.indexOf(n)&&-1===n.indexOf(".GLOBAL.")&&-1!==n.indexOf(`.${e}.`))try{const e=this._storage.getItem(n);e&&t.push(null===(o=JSON.parse(e))||void 0===o?void 0:o.item)}catch(e){r.q.error(`value for key [${n}] throw error. ${(0,s.VK)(e)}`)}})),t}del(e){var t,i,n,o;if(!e)return r.q.error(`Invalid cacheKey: ${e}`),!1;if(!e.typeName)return r.q.error(`Invalid cacheKey type: ${e.typeName}`),!1;if("User"===e.typeName)return this.flush(e.user),!0;const s=h(e),{loggingKey:a}=p(e,s),{typeName:l,key:c,user:d}=s;(null===(i=null===(t=this.internalCache[d])||void 0===t?void 0:t[l])||void 0===i?void 0:i[c])&&r.q.info(`Value of key: [${a}] exists before deletion]`);const u=(null===(o=null===(n=this.internalCache[d])||void 0===n?void 0:n[l])||void 0===o?void 0:o[c])&&delete this.internalCache[d][l][c],m=this._deleteFromExternalCache(e);return r.q.info(`deleted from local auth-cache. key: [${a}], done - local: [${u}], storage: [${m}]`),u}delTokensWithError(e,t){var i,n,o,r;const{user:s,typeName:a}=h({user:e,typeName:"Token"});if(null===(i=this.internalCache[s])||void 0===i?void 0:i[a]){const i=this.internalCache[s][a];for(const s in i)(null===(r=null===(o=null===(n=i[s])||void 0===n?void 0:n.item)||void 0===o?void 0:o.error)||void 0===r?void 0:r.errorCode)===t&&this.del({user:e,typeName:a,key:s})}}deleteType(e,t){var i;const{user:n,typeName:o}=h({user:e,typeName:t});if(null===(i=this.internalCache[n])||void 0===i?void 0:i[o]){let t;if("Token"===o)t=this.internalCache[n][o];else{if("Discover"!==o)return;t=this.internalCache[n][o]}for(const i in t)i&&this.del({user:e,typeName:o,key:i})}}flush(e){var t,i;if(!e){r.q.info("no user provided, flushing global user from cache");const n=null===(i=null===(t=this.internalCache.GLOBAL)||void 0===t?void 0:t.User)||void 0===i?void 0:i.User;if(!n)return;e=(0,a.Xx)(n.item)}r.q.info("flushing user data from cache");const n=m(e);this.internalCache[n]={},this._flushExternalCache(e),this._isGlobalUser(e)&&(this.internalCache.GLOBAL={},this._storage.removeItem("$[GLOBAL][User][User]"),this._storage.removeItem("tmp.auth.v1.GLOBAL.User.User")),r.q.info("flushing completed")}_value(e){return e.item}_shouldRefresh(e,t){if(!["Discover","Token"].includes(t)||!e.item)return;const i=e.item,n=k(t,i);if(e.refreshAfter&&this.refreshPercents)return this._proactiveShouldRefresh(S(),e.refreshAfter,n);if(i&&n){const e=n-this._expireOffsetSeconds,t=n-this._expireOffsetSecondsMin,i=S();if(i<=t)return i>=e}}_proactiveShouldRefresh(e,t,i){return!i||i<e-this._expireOffsetSecondsMin?void 0:t<e}get refreshPercents(){var e;const t=null===(e=this._coreSettings)||void 0===e?void 0:e.call(this,"proactiveTokenRefreshPercents");return Number(null!=t?t:0)}}const y=e=>{if(!(-1===["Token","Discover"].indexOf(e.typeName)||e.key&&e.user))throw new Error(`key/user cannot be empty for type [${e.typeName}]: key: ${e.key}, user: ${+!!e.user}`)},f=(e,t)=>{var i;return u||(u=new v(e,t),(null===(i=e.localStorage)||void 0===i?void 0:i.getItem("localDebug"))&&e.loader&&(e.loader.authCache=u),u)};function S(){return Math.round(Date.now()/o.rF.MILLI_PER_SECOND)}function k(e,t){return"Discover"===e?Math.round((null==t?void 0:t.expiration)/o.rF.MILLI_PER_SECOND):"Token"===e?null==t?void 0:t.expires:void 0}const b=o.rF.SECONDS_PER_MINUTE*o.uI.TEN;function w(e,t,i=.67){const n=t-e,o=e+Math.round(n*i),r=t-b;return Math.min(o,r)}},136613:(e,t,i)=>{"use strict";i.d(t,{VF:()=>o,px:()=>r,Jl:()=>s});var n=i(804589);const o=e=>({userDetail:{user:e,typeName:"Discover",key:"discover-user-details"},regionGtm:{user:e,typeName:"Discover",key:"discover-region-gtm"},skypeToken:{user:e,typeName:"Discover",key:"skype-token"},user:{user:e,typeName:"User"},tenants:{user:e,typeName:"Tenants"},loginValidation:{user:e,typeName:"LoginValidation"},userAuthState:{user:e,typeName:"UserAuthState"},meetingDetails:{user:e,typeName:"MeetingDetails"},telemetryInfo:{user:e,typeName:"TelemetryInfo"}}),r=(e,t,i)=>({user:e,typeName:"Token",key:`${t}${i?`-external-${i}`:""}`}),s={addAccountsSuggestionCoachMarkTimeStamp:{typeName:"addAccountsSuggestionCoachMarkTimeStamp"},logoutState:{typeName:n.ZU},authSessionId:{typeName:n.Fz},globalUser:{typeName:"User"},primaryUserId:{typeName:"PrimaryUserId"},encryptionKey:{typeName:"EncryptionKey"},exportedEncryptionKey:{typeName:"ExportedEncryptionKey"},initializationVector:{typeName:"InitializationVector"},previousSignInProgressState:{typeName:"PreviousSignInProgressState"}}},608989:(e,t,i)=>{"use strict";i.d(t,{gA:()=>p,Zl:()=>v,fG:()=>y,MD:()=>f,SH:()=>S,Ri:()=>k,$R:()=>b,et:()=>w,Wh:()=>_,bO:()=>T});var n=i(466094),o=i(765053),r=i(738646),s=i(932289),a=i(403084),l=i(804589),c=i(186921),d=i(959078),u=i(928665),m=i(588470),g=i(136613),h=i(535059);const p=(e,t,i)=>{var n,o,r,s,a,l;const c=f(e,t,i);return Object.assign(Object.assign({},c),{message:c.message,stack:c.stack,errorMetaData:{accountId:null===(o=null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.profile)||void 0===o?void 0:o.id,name:null===(s=null===(r=null==t?void 0:t.result)||void 0===r?void 0:r.profile)||void 0===s?void 0:s.displayName,email:null===(l=null===(a=null==t?void 0:t.result)||void 0===a?void 0:a.profile)||void 0===l?void 0:l.email}})},v=(e,t)=>{var i,o;const r=(null==t?void 0:t("buildCloud"))||"",s=null===(i=e.extraQueryParameters)||void 0===i?void 0:i.tenantId,a=j(s,e.domainHint||r,t),l=(null===(o=e.extraQueryParameters)||void 0===o?void 0:o.accountType)||n.Ch.Aad;return{correlation:e.correlation,silent:e.silent,extraQueryParameters:Object.assign(Object.assign({},e.extraQueryParameters),{authority:a}),userIdentifier:{accountType:l,tenantId:s,id:e.accountId||"",userName:"",oid:""}}},y=e=>{var t;return e.accountId&&(null===(t=e.extraQueryParameters)||void 0===t?void 0:t.tenantId)},f=(e,t,i)=>{var n,o;const r=t.isExpected||(null===(n=t.message)||void 0===n?void 0:n.includes("657rv"))||(null===(o=t.errorMessage)||void 0===o?void 0:o.includes("657rv"))||!1;return(0,s.Tr)({context:"authentication",subContext:e,errorCode:t.errorCode||"ErrorCodeMissing",message:(null==t?void 0:t.errorMessage)||t.message||"ErrorMessageMissing",isExpected:r,correlationId:i.id})},S=(e,t,i)=>{var n;const{accountId:r,correlation:s,prompt:a,loginHint:l,extraQueryParameters:c,windowId:u}=e,m=!!(null==i?void 0:i("enableRopcFlow")),g={accountId:r,correlationId:s.id,domainHint:(null==i?void 0:i("enableAad"))?(null==i?void 0:i("enableMultiCloud"))?void 0:o.nU.prod:o.nU.life,extraQueryParameters:(0,d.nW)(c),loginHint:l,silent:"none"===a,windowId:u,useRopcFlow:m};return t.addEventData([`nativeArgs:{domainPresent:${g.domainHint}`,`extraParams:${null===(n=g.extraQueryParameters)||void 0===n?void 0:n.length}`,"idPresent:"+ +!!g.accountId,"loginHintPresent:"+ +!!g.loginHint,`silent:${g.silent}`,`useRopcFlow:${g.useRopcFlow}}`]),g},k=(e,t,i,n)=>{var o,r;const s=b(t.userIdentifier);if(!(null===(o=t.extraQueryParameters)||void 0===o?void 0:o.authority)&&(null==n?void 0:n("enableSetAuthorityAlways"))){const e=t.tenantId||s.tenantId,i=(null==n?void 0:n("buildCloud"))||"",o=j(e,i,n);t.extraQueryParameters=t.extraQueryParameters||{},t.extraQueryParameters.authority=o}const a={resource:e,correlationId:t.correlation.id,accessTokenToRenew:t.accessTokenToRenew,claim:t.claim,silent:null!==(r=t.silent)&&void 0!==r?r:"login"!==t.prompt,userIdentifier:s,tenantId:t.tenantId,extraQueryParameters:(0,d.nW)(t.extraQueryParameters),windowId:t.windowId};return i.addEventData(["nativeArgs:{","accessTokenPresent:"+ +!!a.accessTokenToRenew,"claimPresent:"+ +(0,d.WD)(t.claim),"idPresent:"+ +!!(null==s?void 0:s.id),`silent:${a.silent}`,"userToUse:"+ +!!s,"externalTenant:"+ +!!a.tenantId,"}"]),a},b=e=>({id:e.id,tenantId:e.tenantId,oid:e.oid,upn:e.userName}),w=(e,t,i)=>{var o,r;let s;c.q.info("Getting user profile");const a=null===(o=e.extendedProperties)||void 0===o?void 0:o.find((e=>"acct"===e.name));let l;a&&(s=+a.value);try{l=e.profile.id||(e.profile.oid.startsWith("000")?e.profile.oid.replace(/[0-]/g,""):e.profile.oid)}catch(t){l=e.profile.oid}const u=null===(r=e.extendedProperties)||void 0===r?void 0:r.find((e=>"isCrossCloudUser"===e.name)),h=I(e,null==u?void 0:u.value),p={tenantId:e.profile.tenantId,oid:e.profile.oid,accountType:(0,d.QG)(e.profile.tenantId),userName:e.userName,id:l};m.Jt.put((0,g.VF)(p).telemetryInfo,{isCrossCloudUser:h});const v=C(e,!!(null==t?void 0:t("enableMTO")),!!(null==t?void 0:t("enableCCM")));let y=1===s?n.w4.Guest:n.w4.Member;v===n.Yf.Ccm&&(y=n.w4.Anonymous);const f=e.profile.isHomeAccount?l:(0,d.vt)(e);return{id:l,userName:e.userName||e.profile.email,profile:{acct:s,altsecid:"",amr:[],aud:"",exp:-1,email:e.profile.email,family_name:"",given_name:e.profile.displayName,iat:1,iss:"",name:e.profile.displayName,preferred_username:e.userName||e.profile.email,nbf:-1,nonce:"",oid:e.profile.oid,onprem_sid:"",sub:"",tid:e.profile.tenantId,unique_name:e.profile.displayName,upn:e.profile.email,ver:"1.0",isHomeAccount:e.profile.isHomeAccount},isAuthenticated:!1,type:(0,d.QG)(e.profile.tenantId),cloud:(0,d.nL)(e,t,i,l,f),homeAccountId:f,role:y,subType:v}},C=(e,t,i)=>{var o;let s=n.Yf.Default;if(t||i){const c={id:(0,u.pW)(),scenarioName:r.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"},[d,m]=(0,a.OU)({options:{correlation:c},subContext:"auth-helper::getUserSubType",scenarioName:r.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"}),g=null===(o=e.extendedProperties)||void 0===o?void 0:o.find((e=>e.name===l.GA));if(g){const e=t&&g.value.indexOf(l.f)>-1,o=i&&g.value.indexOf(l.u1)>-1;e?s=n.Yf.Mto:o&&(s=n.Yf.Ccm)}m({reason:"Extended properties wids claim check done.",userSubType:s},"success")}return c.q.log(`User subType set to ${s}, enableMTO: ${t}`),s},_=e=>({token:e.result.token,idToken:e.result.idToken,expires:e.result.expires,fromCache:!1,account:e.result.account}),T=e=>e.errorCode===l.wK.ApiContractViolation&&e.message.includes(l.wK.UiAlreadyShowing),I=(e,t)=>{if(!e.homeAccountId)return!1;if(e.profile.id===e.homeAccountId)return!1;const i=(0,h.zF)(e.homeAccountId,void 0);return(!i||e.profile.sovereignty!==n.ym.gcc||i.cloud!==n.G7.prod)&&"1"===t},j=(e,t,i)=>`${(0,d.M_)(t,i)}${e}`},206083:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});const n=e=>{var t;return!!(null===(t=null==e?void 0:e.chrome)||void 0===t?void 0:t.webview)}},959078:(e,t,i)=>{"use strict";i.d(t,{tN:()=>v,b9:()=>y,b6:()=>f,yI:()=>S,B$:()=>k,vt:()=>b,LP:()=>w,QG:()=>C,M_:()=>_,nL:()=>T,$8:()=>I,Ig:()=>N,Xx:()=>D,qv:()=>F,nW:()=>O,aS:()=>M,Kv:()=>R,FG:()=>P,fM:()=>L,jV:()=>U,PU:()=>W,dW:()=>B,au:()=>$,S1:()=>H,NL:()=>q,WD:()=>z,_Z:()=>V,ps:()=>G,Fr:()=>X,N3:()=>ee,qL:()=>ie,x7:()=>ne});var n=i(740597),o=i(74583),r=i(466094),s=i(287474),a=i(186921),l=i(804589),c=i(588470),d=i(932289),u=i(928665),m=i(136613),g=i(535059),h=i(608989);var p;!function(e){e.Otp="mail",e.GFed="google.com"}(p||(p={}));const v=({type:e,profile:t})=>(e===r.Ch.Otp||e===r.Ch.GFed||t.idp===p.Otp||t.idp===p.GFed)&&t.tid===l._6.services;function y(e,t){return void 0!==t&&e!==t}const f=e=>(a.q.info(`[returnTokenForAnonUser][${e}] empty token return for anonymous user`),{token:"",expires:Math.floor((new Date).setMinutes(l.uI.FIFTEEN)/l.rF.MILLI_PER_SECOND),fromCache:!0}),S=(e,t)=>{if(!e)return"";const i=null==t?void 0:t("instanceUrl"),n=i?`${i}${null!=e?e:"common"}`:"";return a.q.log(`[getAuthorityFromCloud] Get Authority from cloud type - ${n}`),n},k=(e,t,i,n)=>{const o=(null==t?void 0:t.profile.tid)||i||(null==e?void 0:e.tenantId);if(o&&(t||n||(null==e?void 0:e.isAnonEligible)&&(null==e?void 0:e.isAnonRestrictionSatisfied)))return w(o,void 0,t)},b=e=>{const t=e.homeAccountId,i=null==t?void 0:t.split(".")[0];return(null==i?void 0:i.startsWith("00000000-0000-0000"))?i.replace("00000000-0000-0000-","").replace("-",""):i},w=(e,t,i,n)=>{var o;a.q.info("Anon flow - anonymous user created");const s=`anon.${t=t||(e===l.zP?r.G7.life:r.G7.prod)}.${e}.${n}`;return{id:s,isAuthenticated:!0,userName:(null==i?void 0:i.userName)||"anonymous",profile:{oid:F(s),tid:e,upn:(null===(o=null==i?void 0:i.profile)||void 0===o?void 0:o.upn)||"",puid:""},role:r.w4.Anonymous,type:r.Ch.Anonymous,homeAccountId:s,cloud:(null==i?void 0:i.cloud)||t,subType:r.Yf.Default}},C=e=>e===s.e0?r.Ch.MsaLife:r.Ch.Aad,_=(e,t)=>{var i,n;if(!e)return l._V;return(null===(n=(null!==(i=null==t?void 0:t("cloudAuthorityMap"))&&void 0!==i?i:l.fL).find((t=>t.cloud.toString()===e)))||void 0===n?void 0:n.authority)||l._V},T=(e,t,i,n,o)=>{if(C(e.profile.tenantId)===r.Ch.MsaLife)return r.G7.life;if(null==t?void 0:t("enableMTMAAuthDataInMaglevStorage")){const r=e.profile.sovereignty;if(o===n)return j(r);if(i)return i;const s=e.profile.environment;return I(s,e.profile.tenantId,t)}{const t=e.profile.sovereignty;return j(t)}},I=(e,t,i)=>{if("9188040d-6c67-4c5b-b112-36a304b66dad"===t)return r.G7.life;switch(e){case r.Ke.prod:return r.G7.prod;case r.Ke.gallatin:return r.G7.gallatin;case r.Ke.airgap08:return r.G7.airgap08;case r.Ke.airgap09:return r.G7.airgap09;case r.Ke.gov:return null==i?void 0:i("buildCloud");default:return r.G7.prod}},j=e=>{switch(e){case r.ym.prod:case r.ym.gcc:return r.G7.prod;case r.ym.gcch:return r.G7.gcch;case r.ym.dod:return r.G7.dod;case r.ym.ag08:return r.G7.airgap08;case r.ym.ag09:return r.G7.airgap09;case r.ym.gallatin:return r.G7.gallatin;default:return r.G7.prod}},N=(e,t,i,n)=>{var s;return(null==t?void 0:t.subType)===r.Yf.Ccm?t:!t||(0,o.isEmpty)(t.profile)||t.role===r.w4.Anonymous||t.userRole===l.uI.TWO||!t.isAuthenticated&&e.isAnonEligible||!t.isAuthenticated&&n?(a.q.info("checking anon flow"),k(e,t,i,n)):(t.role=t.role===r.w4.Guest||1===(null===(s=t.profile)||void 0===s?void 0:s.acct)?r.w4.Guest:r.w4.Member,E(t),x(t),A(t))},E=e=>{var t,i,n,o,a;if((null===(t=e.profile)||void 0===t?void 0:t.tid)===s.e0)return void(e.type=r.Ch.MsaLife);const l=[r.Ch.Msa,r.Ch.Otp,r.Ch.GFed];if(e.type&&-1!==l.indexOf(e.type))return;let c=0===(null===(n=null===(i=e.profile)||void 0===i?void 0:i.altsecid)||void 0===n?void 0:n.indexOf("1:"))?r.Ch.Msa:r.Ch.Aad;(null===(o=e.profile)||void 0===o?void 0:o.idp)&&(null===(a=e.profile)||void 0===a?void 0:a.iss)!==e.profile.idp&&(c=e.profile.idp===p.Otp?r.Ch.Otp:c,c=e.profile.idp===p.GFed?r.Ch.GFed:c),e.type=c},x=e=>{e.type!==r.Ch.MsaLife?e.cloud&&e.cloud!==r.G7.prod||(e.cloud=r.G7.prod):e.cloud=r.G7.life},A=e=>(e.profile.oid=e.profile.oid||F(e.profile.tid),!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.subType||(e.subType=r.Yf.Default),a.q.log(`User role = [${e.role}], type = [${e.type}], cloud = [${e.cloud}]`),e),D=e=>{if(!e)throw new Error("getUserIdentifier: User cannot be null");return{tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id}},F=e=>`8:defaultOid:${e}`,O=e=>{const t=[];for(const i in e)Object.hasOwnProperty.call(e,i)&&e[i]&&t.push({name:i,key:i,value:"string"==typeof e[i]?e[i]:(0,u.u4)(e[i])});return t},M=(e,t)=>{var i;t.addEventData(["update-global-user:t"]),t.addScenarioMark("auth_update_global_user_start");const n=(0,g.zF)(e,void 0);if(n)return t.addScenarioMark("auth_update_global_user_foundUser"),c.Jt.updateGlobalUser(n);throw t.addScenarioMark("auth_update_global_user_noUserFound"),o=null===(i=t.correlation)||void 0===i?void 0:i.id,(0,d.Tr)({context:"core-auth-base",subContext:"getUserFromAccountId",correlationId:o,errorCode:l.SM.UserNotFoundError,message:"Cannot update global user ude to missing user"});var o},R=e=>e?(null==e?void 0:e.id)?null==e?void 0:e.id:`${null==e?void 0:e.oid}-${null==e?void 0:e.tenantId}`:"unknown user",P=(e,t)=>!!e&&!!t&&((e.id||t.id)&&e.id===t.id||e.tenantId===t.tenantId&&e.oid===t.oid&&e.userName===t.userName),L=(e,t,i)=>{var n;const o=new CustomEvent(t,{detail:i});null===(n=null==e?void 0:e.dispatchEvent)||void 0===n||n.call(e,o)},U=(e,t,i,n,o)=>{const r=N(e,t,n,o);return r&&(a.q.info(`[auth-helper][getMappedUserAndSetItToCache][${i}] put user in cache.`),c.Jt.put((0,m.VF)(D(r)).user,r)),r},W=(e,t,i,n)=>{if(l.s9(e))throw n.addEventData(["scope_invalid:1"]),a.q.warn(`[core-auth-base][acquireToken][${i.source}][${i.id}] invalid scope. resource: [${e}]`),(0,d.Tr)({context:"core-auth-base",subContext:"acquireToken",message:`request with [${null==t?void 0:t.id}-${null==t?void 0:t.oid}-${null==t?void 0:t.tenantId}] sent from invalid resource: ${e}`,errorCode:l.SM.InvalidScopeResource,isExpected:!0,correlationId:i.id})},B=(e,t,i,n,o)=>(n.push("user_missing"),(0,d.Tr)({context:"core-auth-base",subContext:e,errorCode:l.SM.UserNotFoundError,isExpected:i,message:`request sent with [${t}] failed as user not found`,innerError:new Error("User Null or empty"),correlationId:o})),$=(e,t,i,n)=>(0,d.Tr)({context:"core-auth-base",subContext:e,errorCode:l.SM.UnsupportedParameter,isExpected:i,message:`${t} parameter is not currently supported`,innerError:new Error(`${t} parameter is not currently supported`),correlationId:n});const H=(e,t,i,n,o,r)=>{var s,c;null==n||n.push(`errorCode:${(null==t?void 0:t.errorCode)||"undefined"},errorMessage:${(null==t?void 0:t.message)||"undefined"}`),n&&n.length>0&&n.push("$");const d=function(e,t,i="",n,o){return{contentType:i,context:"core-auth-base",correlationId:null==t?void 0:t.correlationId,endpointUrl:o||"unset",errorCode:(null==t?void 0:t.errorCode)||"AcquireToken Error",innerError:t,isExpected:null==t?void 0:t.isExpected,message:(0,u.VK)(t),reason:(null==n?void 0:n.join(";"))||"",subContext:e}}(e,t,o,n,r),m=d.errorCode.includes(l.SM.InvalidScopeResource)||(null===(s=d.message)||void 0===s?void 0:s.includes(l.SM.InvalidScopeResource))||d.isExpected||(null===(c=d.innerError)||void 0===c?void 0:c.isExpected);return m?a.q.warning(`Error found ${(0,u.VK)(t)}`):a.q.error(`Error found ${(0,u.VK)(t)}`),m?null==i||i.incomplete(d):null==i||i.fail(d),d},q=JSON.stringify({access_token:{xms_cc:{values:["CP1"]}}}),z=e=>!(!e||e===q),V=(e,t,i,n,o)=>{var r,s,l,c;return i.tflClaim&&(i.accessTokenToRenew=i.tflClaim),void 0===i.prompt&&void 0===i.silent&&(!i.accessTokenToRenew&&!z(i.claim)||(null==n?void 0:n("disablePromptFor401"))&&!((e,t)=>{const i=(null==t?void 0:t("enablePromptResourcesFor401"))||[];return!(!e||!i)&&Array.isArray(i)&&i.findIndex((t=>e.includes(t)))>-1})(e,n)?(i.prompt="none",i.silent=!0):(i.prompt="login",i.silent=!1)),o&&!i.accessTokenToRenew&&(i.forceRenew||!1===i.silent||"login"===i.prompt)&&(a.q.info("[core-auth-base][acquireToken] force renewing."),i.accessTokenToRenew=o.item.token),t.addEventData(["cacheToken:"+ +!!o,"tflClaim:"+ +!!i.tflClaim,"accessTokenToRenew:"+ +!!i.accessTokenToRenew,"forceRenew:"+ +!!i.forceRenew,`prompt: ${i.prompt}`,"silent:"+ +!!i.silent]),(null===(s=null===(r=null==o?void 0:o.item)||void 0===r?void 0:r.error)||void 0===s?void 0:s.errorCode)&&t.addEventData([`errorInToken:[${(null===(c=null===(l=null==o?void 0:o.item)||void 0===l?void 0:l.error)||void 0===c?void 0:c.errorCode)||""}]`]),i},G=(e,t,i,o,s,l)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=null==l?void 0:l("buildCloud"),d=null==l?void 0:l("enableMultiCloud"),u=null==l?void 0:l("enableCCM");if(a.q.log(`starting cloud misMatch check. Env: ${i}, buildCloud: ${n}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`),!e.cloud||!n||e.cloud===n&&e.subType!==r.Yf.Ccm)return a.q.log("No cloud mismatch detected."),t.addEventData(["cloudMismatch:0"]),e;const m=((e,t)=>{const i=null==t?void 0:t("enableMSAGuest"),n=null==t?void 0:t("enableTFLOnT21");return i&&!n&&e.cloud===r.G7.life})(e,l);if(t.addEventData(["cloudMismatch:1","isMsaGuest:"+ +!!m,"enableCCM:"+ +!!u,"meetingDetails:"+ +!!s.meetingDetails]),m){t.addScenarioMark("msa_flow_start");const i=yield J(e,s,o,t,n,l);if(i)return i}if(u&&s.meetingDetails){t.addScenarioMark("ccm_flow_start");const i=yield K(e,s,o,t,n,s.meetingDetails,l);if(i)return i}if(d){t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${i}, enableMultiCloud: ${d}, buildCloud: ${n}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`});const r=yield Z(e,s.correlation,o);return Promise.reject(r)}throw c.Jt.del({user:D(e),typeName:"User"}),t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${i}, buildCloud: ${n}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`}),new Error("cloud mis-match... reboot required")})),J=(e,t,i,o,s,a)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{const n=yield Q(e,t,i,l._6.services,s,a),d=Y(n,a);if(o.addEventData(["msa-account:"+ +!!d]),o.addScenarioMark("msa_flow_end"),d){const e=yield ie(d,o.correlation,i);return c.Jt.put((0,m.VF)(D(d)).userAuthState,{state:r.JE.Unknown,customError:{errorCode:e.errorCode,isExpected:e.isExpected,message:e.message,context:e.context,subContext:e.subContext,correlationId:e.correlationId,errorMetadata:e.errorMetaData},reason:"MsaUserNotAllowed"}),d.type=r.Ch.Msa,d.homeAccountId=d.id,d}}catch(e){o.addScenarioMark("ccm_flow_end",e)}})),K=(e,t,i,o,s,a,l)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(e.subType===r.Yf.Ccm)return te(e,o,a,e.profile.name);try{const n=yield Q(e,t,i,a.tenantId,s,l),c=Y(n,l);if(o.addEventData(["account:"+ +!!c,`sub:${null==c?void 0:c.subType}`]),c)return c.subType===r.Yf.Ccm?te(c,o,a,e.profile.name):(o.addEventData(["ccgaUser:1"]),c);o.addScenarioMark("ccm_flow_end")}catch(e){o.addScenarioMark("ccm_flow_end",e)}})),Q=(e,t,i,o,r,a)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=`${_(r,a)}${o}`,l=(null==a?void 0:a("mtResource"))||s.O_.MT;return yield i.acquireToken(l,{correlation:t.correlation,silent:t.silent,userIdentifier:D(e),extraQueryParameters:{authority:n}})})),Y=(e,t)=>e&&e.account?(0,h.et)(e.account,t):void 0,X=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return new Promise((o=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(e.length<=0)return o({count:0,failure:[]});let n=0;const r=[];for(const s of e){n++;try{const i=t(s);yield i,n>=e.length&&o({count:n,failure:r})}catch(t){r.push(n),null==i||i(t,n,s),n>=e.length&&o({count:n,failure:r})}}}))))})),Z=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;const o=(yield null===(n=i.getUserImage)||void 0===n?void 0:n.call(i,{id:e.id,correlation:t}))||"",r={cloud:e.cloud,accountId:e.id,email:e.profile.email,name:e.profile.name,pictureBlob:o};return(0,d.MD)({errorMetaData:r,authSubErrorCode:"MultiCloudMismatch",name:l.SM.CloudMismatch,message:"Cloud Mismatch Detected",context:"Login",correlationId:t.id,errorCode:l.SM.CloudMismatch,subContext:"checkForCloudMismatch",isExpected:!0})})),ee=(e,t,i,n)=>{z(i)&&e.addEventData([`isSameToken: ${n===t.token}`]);const o=(e=>{const t=(e-Math.floor((new Date).getTime()/l.rF.MILLI_PER_SECOND))*l.rF.MILLI_PER_SECOND/l.rF.ONE_MINUTE;return Math.floor(t)})(t.expires);e.addEventData([`tokenLifeTime: ${o}`,`fromCache: ${t.fromCache}`])},te=(e,t,i,n)=>(t.addEventData(["ccmUser:1"]),e.id=`${e.id}_${i.conversationId}`,e.type=r.Ch.Anonymous,e.profile.name=n,c.Jt.put((0,m.VF)(D(e)).meetingDetails,i),t.addScenarioMark("ccm_flow_end"),e),ie=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;const o=(yield null===(n=i.getUserImage)||void 0===n?void 0:n.call(i,{id:e.id,correlation:t}))||"",r={cloud:e.cloud,accountId:e.id,email:e.profile.email,name:e.profile.name,pictureBlob:o};return(0,d.MD)({errorMetaData:r,authSubErrorCode:"MsaUserNotAllowed",name:l.SM.CloudMismatch,message:"msa user Detected",context:"Login",correlationId:t.id,errorCode:l.SM.MsaUserNotAllowed,subContext:"msaUserNotAllowedError",isExpected:!0})})),ne=e=>{var t,i,n,o,s,a,l,c,d;return{id:`dummy-user-${null===(t=e.profile)||void 0===t?void 0:t.tid}-${e.homeAccountId}`,userName:e.userName,profile:{acct:1,altsecid:"",amr:[],aud:"",exp:-1,email:null===(i=e.profile)||void 0===i?void 0:i.email,family_name:"",given_name:null===(n=e.profile)||void 0===n?void 0:n.given_name,iat:1,iss:"",name:null===(o=e.profile)||void 0===o?void 0:o.name,preferred_username:e.userName||(null===(s=e.profile)||void 0===s?void 0:s.email),nbf:-1,nonce:"",oid:`dummy-user-${null===(a=e.profile)||void 0===a?void 0:a.tid}`,onprem_sid:"",sub:"",tid:null===(l=e.profile)||void 0===l?void 0:l.tid,unique_name:null===(c=e.profile)||void 0===c?void 0:c.unique_name,upn:null===(d=e.profile)||void 0===d?void 0:d.email,ver:"1.0",isHomeAccount:!1},homeAccountId:e.homeAccountId||e.id,isAuthenticated:!1,type:r.Ch.Aad,cloud:e.cloud,role:e.role}}},942209:(e,t,i)=>{"use strict";i.d(t,{z:()=>o,k:()=>r});var n=i(743194);const o=e=>n.Buffer.from(e).toString("base64"),r=e=>n.Buffer.from(e,"base64")},924732:(e,t,i)=>{"use strict";function n(e){const t={};return(i,...n)=>{try{let o=t[i];return o||(o=t[i]=e(...n).then((e=>(delete t[i],e))).catch((e=>{throw delete t[i],e}))),o}catch(e){throw e}}}i.d(t,{k:()=>n})},565697:(e,t,i)=>{"use strict";i.d(t,{K_:()=>l,dt:()=>c,P0:()=>d,t8:()=>u,MH:()=>m,oO:()=>g,Kf:()=>h,TT:()=>p,jP:()=>v});var n=i(466094),o=i(535059),r=i(588470),s=i(136613),a=i(959078);const l=e=>r.Jt.getValue((0,s.VF)((0,a.Xx)(e)).userAuthState),c=e=>{if(!e)return;const t=(0,o.zF)(e,void 0);if(!t||!t.homeAccountId||t.homeAccountId===t.id)return t;return(0,o.zF)(t.homeAccountId,void 0)},d=(e,t)=>{if(!e||!t)return;return r.Jt.getAllOfType("User").find((i=>i.homeAccountId===e&&i.profile.tid===t))},u=()=>{var e,t;return null===(t=null===(e=r.Jt.getAllOfType("User"))||void 0===e?void 0:e.filter((e=>h(e)&&!g(e))))||void 0===t?void 0:t[0]},m=e=>{let t=(0,o.zF)(e,void 0);if(e||!t)return t;if(t.homeAccountId!==t.id){t=(0,o.zF)(t.homeAccountId,void 0)||t}return t},g=e=>!(!e||!e.homeAccountId||e.homeAccountId===e.id),h=e=>e.type!==n.Ch.Anonymous&&!e.id.startsWith("dummy-user-"),p=e=>{var t,i;const n=null===(i=null===(t=r.Jt.getAllOfType("User"))||void 0===t?void 0:t.filter(Boolean))||void 0===i?void 0:i.filter((t=>h(t)&&t.cloud===e)),o=null==n?void 0:n.filter((e=>!g(e)));return(null==o?void 0:o[0])||(null==n?void 0:n[0])},v=e=>({message:`user for id: '${e}' not found. if id is undefined, global user should return`,errorCode:"NoAccountFoundForLogout",isExpected:!0,context:"get-user-utilities",subContext:"getUserForLogout",correlationId:"",name:"NoAccountFoundForLogout"})},849960:(e,t,i)=>{"use strict";i.d(t,{g:()=>p});var n=i(740597),o=i(466094),r=i(932289),s=i(928665),a=i(959078),l=i(804589),c=i(186921),d=i(688834),u=i(74583);let m,g,h;function p(e,t,i,n){if(Object.getOwnPropertyDescriptor(Window,"mockApi")||Object.defineProperty(Window,"mockApi",{value:{enable:()=>{h=!0},disable:()=>{h=!1},setConfig:v}}),function(e,t){m||(m={});m[t]=e}(e,t),h=n,h){try{g="string"==typeof i?Object.assign(Object.assign({},g),JSON.parse(decodeURIComponent(i))):Object.assign(Object.assign({},g),i)}catch(e){c.q.warning(`[MOCK-API] cannot parse config: ${i}`)}y(e,t)}else g={}}function v(e,t={}){g||(g={}),g[e]=t;const i=e.split(".")[0];y(null==m?void 0:m[i],i)}function y(e,t){Object.getOwnPropertyNames(g).filter((e=>e.startsWith(`${t}.`))).map((e=>e.replace(`${t}.`,""))).forEach((i=>{var o,r;const s=(null===(o=Object.getOwnPropertyDescriptor(e,i))||void 0===o?void 0:o.value)||(null===(r=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),i))||void 0===r?void 0:r.value),a=null==g?void 0:g[`${t}.${i}`];a&&a.delay&&a.delay>0?Object.defineProperty(e,i,{configurable:!0,value:(...o)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){if(h){if(c.q.warning(`[MOCK-API] returning delayed mocked response for ${t}.${i}`),a&&a.delay){const e=void 0!==a.delay?a.delay:0;yield new Promise((t=>(0,u.delay)(t,e)))}return f(t,i)||s.apply(e,o)}return s.apply(e,o)}))}):Object.defineProperty(e,i,{configurable:!0,value:(...n)=>h?(c.q.warning(`[MOCK-API] returning mocked response for ${t}.${i}`),f(t,i)||s.apply(e,n)):s.apply(e,n)})}))}function f(e,t){var i;const n=null==g?void 0:g[`${e}.${t}`];if(n&&n.error)throw function(e,t,i){return(0,r.MD)({name:(null==e?void 0:e.name)||"",context:(null==e?void 0:e.context)||t,subContext:(null==e?void 0:e.subContext)||i,reason:null==e?void 0:e.reason,errorCode:(null==e?void 0:e.errorCode)||"ErrorCodeNotFound",correlationId:(null==e?void 0:e.correlationId)||(0,s.pW)(),isExpected:(null==e?void 0:e.isExpected)||!1,message:(null==e?void 0:e.message)||`[MockApi][${t}][${i}]`,authSubErrorCode:null==e?void 0:e.authSubErrorCode,errorMetaData:null==e?void 0:e.errorMetaData,serverResponse:null==e?void 0:e.serverResponse})}(n.error,e,t);if(n&&n.success){const e=function(e){switch(e){case"aquireToken":return k;case"user":return S();case"hostMachineUsers":return[b];case"users":return[S()];case"emptyList":return[]}return{}}(n.success.defaultValue);return Array.isArray(e)?n.success.returnValue?Array.isArray(n.success.returnValue)?[...e,...n.success.returnValue]:[...e,n.success.returnValue]:e:Object.assign(Object.assign({},e),null===(i=n.success)||void 0===i?void 0:i.returnValue)}}const S=()=>(0,a.Ig)(new d.N("https://test.msft.com"),{userName:"TestUserName@email.com",role:o.w4.Member,profile:{name:"Test",oid:(0,a.qv)("123456789"),tid:"123456789"}}),k={token:"TestToken",expires:Date.now()+l.rF.SECONDS_FIVE_MINUTES,fromCache:!1},b={accountType:"Aad",id:"TestHostMachineUserId",displayName:"Test User",emailPhone:"test@email.com",picture:""}},688834:(e,t,i)=>{"use strict";i.d(t,{N:()=>r,j:()=>c});var n=i(804589),o=i(186921);class r{constructor(e){this._hash="",this._search="",this._pathname="",this._isAnonEligible=!1,this._isAnonRestrictionSatisfied=!1,this._tid=void 0,this._queryStrings={},this._parse=e=>{let t=Object.create(null);return"string"!=typeof e?t:(e=e.trim().replace(/^[?#&]/,""))?(e.split("&").forEach((e=>{const i=e.replace(/\+/g," ").split("=");let n=i.shift();const r=i.length>0?decodeURIComponent(i.join("=")):null;if(n){if(n=decodeURIComponent(n),"context"===n&&0===(null==r?void 0:r.indexOf("{")))try{const e=JSON.parse(r);for(const t in e)!e.hasOwnProperty(t)||"tid"!==t.toLowerCase()&&"tenantid"!==t.toLowerCase()||(this._tid=e[t]);t=Object.assign(Object.assign({},t),e)}catch(e){o.q.error(e)}if(Object.prototype.hasOwnProperty.call(t,n))Array.isArray(t[n])?t[n].push(r):t[n]=[t[n],r];else{t[n]=r;const e=n.toLowerCase();!r||"tid"!==e&&"tenantid"!==e||(this._tid=r)}}})),t):t};try{this._currenttUrl=Object.freeze(new URL(e))}catch(t){throw new Error(`[TeamsUrl::ctor] - error - ${t} url ${e}`)}if(this._currenttUrl.hash&&-1!==this._currenttUrl.hash.indexOf("#/")){const e=this._currenttUrl.href.substring(this._currenttUrl.origin.length),t=e.indexOf("#");t>=0&&(this._hash=e.substr(t),this._pathname=e.substr(0,t));const i=this._hash.indexOf("?");i>=0&&(this._search=this._hash.substr(i))}this._queryStrings=this._parse(this._search||this._currenttUrl.search);const t=s(this._currenttUrl);this._isAnonEligible=t[0],this._isAnonRestrictionSatisfied=t[1]}get href(){return this._currenttUrl.href}get isLocal(){return 0===this._currenttUrl.host.indexOf("local.teams.office.com")}get hash(){return this._hash||this._currenttUrl.hash}get pathname(){return this._pathname||this._currenttUrl.pathname}get search(){return this._search||this._currenttUrl.search}get origin(){return this._currenttUrl.origin}get searchParams(){return{get:e=>this._queryStrings[e]}}get queryStrings(){return this._queryStrings}get tenantId(){return 0===this._currenttUrl.host.indexOf("teams.live.")?n.zP:this._tid}get isAnonEligible(){return this._isAnonEligible}get isAnonRestrictionSatisfied(){return this._isAnonRestrictionSatisfied}get alternateUrl(){const e=new URL(this._currenttUrl.href);return this.isLocal?(e.port?e.port="":e.port="8080",e.href):(0===e.host.indexOf("teams.live.")?e.host="teams.microsoft.com":e.host="teams.live.com",e.href)}get hasPostMessageAgent(){return"postMessage"===this._queryStrings.agent}}const s=e=>{if(!l)return[!1,!1];for(const t of l)if(t.anonUrlMatch&&e.href.indexOf(t.anonUrlMatch)>-1)return[!0,a(t,e.href)];return[!1,!1]},a=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const i of e.restrictions)if(t.indexOf(i)>-1)return!0;return!1};let l=[];const c=e=>{e&&(l=e)}},278593:(e,t,i)=>{"use strict";var n,o;i.d(t,{j:()=>n,Q:()=>o}),function(e){e.Up="Up",e.InteractionRequired="InteractionRequired",e.AADReconnecting="AADReconnecting",e.SkypeReconnecting="SkypeReconnecting",e.LicenseError="LicenseError",e.SignInRestriction="SignInRestriction"}(n||(n={})),function(e){e.Failure="Failure",e.InteractionRequired="InteractionRequired",e.Success="Success",e.LicenseError="LicenseError",e.SignInRestriction="SignInRestriction",e.Unknown="Unknown"}(o||(o={}))},765053:(e,t,i)=>{"use strict";var n,o,r,s,a;i.d(t,{oo:()=>n,nU:()=>o,O3:()=>s,nM:()=>a}),function(e){e.SUCCESS="SUCCESS",e.CANCELLED="CANCELLED",e.FAILED="FAILED",e.TIMEOUT="TIMEOUT"}(n||(n={})),function(e){e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap08="airgap08",e.airgap09="airgap09"}(o||(o={})),function(e){e.Aad="Aad",e.MsaLife="MsaLife"}(r||(r={})),function(e){e.AADReconnecting="AADReconnecting",e.Failure="Failure",e.InteractionRequired="InteractionRequired",e.SignInRestriction="SignInRestriction",e.SkypeReconnecting="SkypeReconnecting",e.Up="Up"}(s||(s={})),function(e){e.UserDataXCloud="userdataxcloud",e.Auth="auth",e.Core="core"}(a||(a={}))},287474:(e,t,i)=>{"use strict";var n,o,r,s,a;i.d(t,{hO:()=>n,Zw:()=>o,in:()=>r,s_:()=>s,O_:()=>a,e0:()=>l}),function(e){e.POP="pop",e.BEARER="Bearer"}(n||(n={})),function(e){e[e.Skype=0]="Skype",e[e.AAD=1]="AAD",e[e.CAE=2]="CAE"}(o||(o={})),function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose"}(r||(r={})),function(e){e.ag08="ag08",e.ag09="ag09",e.dod="dod",e.gcc="gcc",e.gcchigh="gcchigh",e.life="life",e.prod="prod"}(s||(s={})),function(e){e.LOKI_TFL_AUTH_TOKEN_AUDIENCE="liveprofilecard.access",e.MT="https://api.spaces.skype.com",e.GROUPS_SERVICE="https://groupssvc.fl.teams.microsoft.com/teams.readwrite",e.UNIFIED_CONSENT_WEB_AUTH_URL="https://consentservice.microsoft.com/web/UnifiedUserConsent.ReadWrite",e.UNIFIED_CONSENT_CHECKIN_AUTH_URL="https://consentservice.microsoft.com/checkin/UnifiedUserConsent.Read",e.CSA_PHONELINK_AUTH_URL="https://chatsvcagg-tfl.teams.microsoft.com/user_impersonation"}(a||(a={}));const l="9188040d-6c67-4c5b-b112-36a304b66dad"},27149:(e,t,i)=>{"use strict";var n;i.d(t,{dX:()=>n}),function(e){e.authWarmLaunch="authWarmLaunch",e.authWarmLaunchAfterLoginValidation="authWarmLaunchAfterLoginValidation",e.authAnonLaunch="authAnonLaunch",e.authLoginSsoComplete="authLoginSsoComplete",e.authDisableSsoLaunch="authDisableSsoLaunch",e.authAfterLogoutLaunch="authAfterLogoutLaunch",e.authLoginPage="authLoginPage",e.authMtoUser="authMtoUser",e.authHasMtoTenant="authHasMtoTenant"}(n||(n={}))},194232:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n,n:()=>o});const n=e=>{const t=e.requestWindowId?`:${e.requestWindowId}`:"";return`${e.requestRendererId}${t}:${e.requestId}`},o=e=>({correlationId:e.correlationId,contextId:e.requestRendererId,context:e.hostRendererId,operationName:e.operationName,operationType:e.operationType,windowId:e.requestWindowId,queryId:e.requestId,commandSource:e.callerInfo,origin:e.component})},587592:(e,t,i)=>{"use strict";var n;i.d(t,{k:()=>n}),function(e){e.auth="auth",e.appService="appService",e.appState="appState",e.control="control",e.database="database",e.diagnostics="diagnostics",e.endpointHealth="endpointHealth",e.graphql="graphql",e.networkState="networkState",e.supportedResolvers="supportedResolvers",e.syncEngine="syncEngine",e.tenantSwitch="tenantSwitch",e.telemetry="telemetry"}(n||(n={}))},861092:(e,t,i)=>{"use strict";i.d(t,{Q:()=>EP});var n,o=i(740597),r=i(38023),s=i(494853),a=i(697594),l=i(142150),c=i(130757),d=i(719695),u=i(366758),m=i(970615),g=i(688911);!function(e){e.DiagnosticsLogsMain="diagnostics-event-logs-main",e.DiagnosticsLogsWorker="diagnostics-event-logs-worker"}(n||(n={}));const h="core_life_cycle_start_",p="core_task_end_",v="core_init_complete";var y,f=i(132756),S=i(660378),k=i(955105),b=i(50805),w=i(284010),C=i(125386),_=i(749531),T=i(646388);!function(e){e.DIAGNOSTICSSERVICE="DiagnosticsService"}(y||(y={}));const I=e=>{let t;const i=[];return{newScenario:n=>{if(t)return t.newScenario(n);if(e&&i.length<20){const e=E(n,i);return i.push(e),e}},setScenarioFactory:e=>{t=e,j(i,t)}}},j=(e,t)=>{if(e.length>0)for(let i=e.length-1;i>=0;i--)N(e[i],t)&&e.splice(i,1)},N=(e,t,i)=>{var n;if(e.status){const n=t.newScenario(e.name,{startTime:e.time});if("failed"===e.status&&n.fail(Object.assign({cached:!0,overrideTimestamp:e.endtime},e.result)),"stopped"===e.status&&n.stop(Object.assign({cached:!0,overrideTimestamp:e.endtime},e.result)),i){const t=i.indexOf(e);t>=0&&i.splice(t,1)}return!0}return null===(n=e.setFactory)||void 0===n||n.call(e,t),!1},E=(e,t)=>{let i,n,o,r;const s={name:e,time:Date.now(),fail:e=>{n="failed",o=Date.now(),i=e,r&&N(s,r,t)},stop:e=>{n="stopped",o=Date.now(),i=e,r&&N(s,r,t)},get result(){return i},get status(){return n},get endtime(){return o},setFactory:e=>r=e};return s};var x=i(26618);class A{constructor(){this.eventsBufferArray=[],this.scheduledBufferArray=[],this.isForErrorLogs=!1,this.ALTCompleted=!1}addEvents(e,t=!1){e&&e.length>0&&e.forEach((e=>{this.addEvent(e,t)}))}getBufferedEvents(e){const t=this.eventsBufferArray.concat(this.scheduledBufferArray).sort(((e,t)=>{const i="function"==typeof e.timeStamp.getTime?e.timeStamp:new Date(e.timeStamp),n="function"==typeof t.timeStamp.getTime?t.timeStamp:new Date(t.timeStamp);return i.getTime()-n.getTime()}));return e&&e>0&&e<t.length?t.slice(t.length-e):t}setALTDone(){this.ALTCompleted=!0}fetchPersistedLogsFromLastSession(){var e;if(null===(e=this.host)||void 0===e?void 0:e.localStorage){const e=(0,x.yN)(this.userId,this.isForErrorLogs);try{(0,x.UL)(this,this.host.localStorage,e,!0)}catch(t){this.host.localStorage.removeItem(e);const i=`DiagnosticsService: Failed to load persisted logs from store with error: ${t}`;this.addEvent({message:i,isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date})}}}shiftBufferArray(){return 0===this.scheduledBufferArray.length?this.eventsBufferArray.shift():0===this.eventsBufferArray.length||this.scheduledBufferArray[0].timeStamp<this.eventsBufferArray[0].timeStamp?this.scheduledBufferArray.shift():this.eventsBufferArray.shift()}addIntoBufferArray(e,t){t?this.scheduledBufferArray.push(e):this.eventsBufferArray.push(e)}get bufferArraySize(){return this.eventsBufferArray.length+this.scheduledBufferArray.length}}class D extends A{constructor(e=!1,t,i,n){super(),this.isForErrorLogs=e,this.sessionId=t,this.host=i,this.maxCapacity=n,this.queueCapacity=this.maxCapacity||D.DEFAULT_QUEUE_CAPACITY}setCapacity(e){const t=e.bufferSize||0;t<1||this.queueCapacity===t||(this.queueCapacity=t,this.bufferArraySize>t&&(this.scheduledBufferArray.length>=t?(this.eventsBufferArray=[],this.scheduledBufferArray=this.scheduledBufferArray.slice(this.scheduledBufferArray.length-t)):this.eventsBufferArray=this.eventsBufferArray.slice(this.bufferArraySize-t)))}addEvent(e,t=!1){this.bufferArraySize<this.queueCapacity||this.shiftBufferArray(),this.addIntoBufferArray(e,t)}getAllEvents(e){return 0===e?Promise.resolve([]):e&&e<=this.bufferArraySize?Promise.resolve(this.getBufferedEvents().slice(this.bufferArraySize-e)):Promise.resolve(this.getBufferedEvents())}setScenarioFactory(e){}handleUserLogout(){var e;this.eventsBufferArray=[],this.scheduledBufferArray=[];const t=(0,x.yN)(this.userId);return null===(e=this.host)||void 0===e||e.localStorage.removeItem(t),Promise.resolve()}setDBInfo(e,t,i){this.tId||(this.tId=e),this.oId||(this.oId=t),this.userId||(this.userId=i,this.fetchPersistedLogsFromLastSession())}persistLogs(){var e;if(this.eventsBufferArray.length>0&&(null===(e=this.host)||void 0===e?void 0:e.localStorage)){const e=(0,x.yN)(this.userId,this.isForErrorLogs);(0,x.RA)(this,this.host.localStorage,e,this.sessionId)}}}D.DEFAULT_QUEUE_CAPACITY=1e3;var F=i(765923),O=i(656690),M=i(89062);class R{constructor(e,t,i,n){this.opener=e,this.setTimeout=t,this.clearTimeout=i,this.diagnosticsEventsBuffer=[],this.flush=()=>{if(this.diagnosticsEventsBuffer.length>0)try{this.opener.postMessage(O.rY.ActivityEvent,{action:"er:rendererDiagnosticsEvents",data:[...this.diagnosticsEventsBuffer]})}catch(e){console.error("DiagnosticsBackupService failed to send a message")}this.reset()},this.backupTimeoutMs=n&&n>0?n:R.DefaultBackupTimeoutMs,this.reset()}pushDiagnosticsEvent(e){e&&(this.diagnosticsEventsBuffer.push(this.stringifyEvent(e)),this.diagnosticsEventsBuffer.length===R.BufferCapacity&&this.flush(),!this.backupTimer&&this.diagnosticsEventsBuffer.length>0&&this.startTimer())}dispose(){this.flush()}reset(){this.diagnosticsEventsBuffer.length=0,this.stopTimer()}stopTimer(){this.backupTimer&&(this.clearTimeout(this.backupTimer),this.backupTimer=void 0)}startTimer(){this.backupTimer=this.setTimeout(this.flush,this.backupTimeoutMs)}stringifyEvent(e){return(0,M.Uw)("{0} {1}\t{2}\r\n",[e.timeStamp,e.levelName.slice(0,3),e.message])}}R.BufferCapacity=50,R.DefaultBackupTimeoutMs=100;var P,L=i(74583),U=i(738646);!function(e){e[e.ecsSetting=0]="ecsSetting",e[e.clientPreference=1]="clientPreference",e[e.error=2]="error",e[e.beforeDeletingDB=3]="beforeDeletingDB"}(P||(P={}));var W=i(575644);class B extends A{constructor(e,t,i,o){super(),this.host=e,this.experienceName=t,this.databaseName=i,this.sessionId=o,this.indexedDBVersion=1,this.storeName="LogsStore",this.timeIndexName="timeIdx",this.currentIDBItemIndex=-1,this.IDBManagementArray=[],this.IDBErrorCount=0,this.allowedIDBErrorCount=10,this.defaultAllowedBufferLength=2e3,this.defaultCountOfIDBObjects=10,this.defaultWorkerAllowedBufferLength=1e3,this.defaultWorkerMaxCountOfIndexDBObject=10,this.minBufferLength=1e3,this.maxBufferLength=5e3,this.minWorkerBufferLength=500,this.maxWorkerBufferLength=3e3,this.minCountOfIDBObjects=10,this.maxCountofIDBObjects=1e3,this.minWorkerCountOfIDBObjects=10,this.maxWorkerCountofIDBObjects=1e3,this.timeThrottlingInterval=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.disableIDBLogs=!1,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.fetchFromIDBTimeLimit=18e3,this.minFetchFromIDBTimeLimit=5e3,this.databaseName===n.DiagnosticsLogsWorker?(this.allowedCountOfIndexDBObject=this.defaultWorkerMaxCountOfIndexDBObject,this.allowedBufferLength=this.defaultWorkerAllowedBufferLength):(this.allowedCountOfIndexDBObject=this.defaultCountOfIDBObjects,this.allowedBufferLength=this.defaultAllowedBufferLength),this.scenarioFactory=I(!0)}setDBInfo(e,t,i){this.getDBName()||(this.tId=e,this.oId=t,this.userId=i,this.openIndexedDB(),this.fetchPersistedLogsFromLastSession())}setCapacity(e){if(void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingInterval=1e3*e.throttleTime),e.bufferSize){const t=this.databaseName===n.DiagnosticsLogsMain?this.minBufferLength:this.minWorkerBufferLength,i=this.databaseName===n.DiagnosticsLogsMain?this.maxBufferLength:this.maxWorkerBufferLength;e.bufferSize>=t&&e.bufferSize<=i&&(this.allowedBufferLength=e.bufferSize)}const t=this.allowPersistIntoIDB;if(e.enableIndexedDB?this.ecsEnableIDBLogs=!0:!1===e.enableIndexedDB&&this.disablePersistIntoIDB(P.ecsSetting),e.clientEnableExtendedLogs?this.isUserEnableIDBLogs=!0:!1===e.clientEnableExtendedLogs&&this.disablePersistIntoIDB(P.clientPreference),e.IDBFetchingTimeoutMs&&e.IDBFetchingTimeoutMs>this.minFetchFromIDBTimeLimit&&(this.fetchFromIDBTimeLimit=e.IDBFetchingTimeoutMs),e.IDBObjectCount){const i=this.databaseName===n.DiagnosticsLogsMain?this.minCountOfIDBObjects:this.minWorkerCountOfIDBObjects,o=this.databaseName===n.DiagnosticsLogsMain?this.maxCountofIDBObjects:this.maxWorkerCountofIDBObjects;if(e.IDBObjectCount>=i&&e.IDBObjectCount<=o){if(t&&this.allowPersistIntoIDB&&this.IDBManagementArray.length>e.IDBObjectCount){const t=this.getToBeDeletedIDs(e.IDBObjectCount);this.deleteIDBItems(t)}this.allowedCountOfIndexDBObject=e.IDBObjectCount}}!t&&this.allowPersistIntoIDB&&this.openIndexedDB()}addEvent(e,t=!1){if(this.addIntoBufferArray(e,t),this.bufferArraySize>=this.allowedBufferLength)if(this.allowPersistIntoIDB&&this.db)if(this.shouldBeThrottled()){const e=this.shiftBufferArray();this.skippedEventsCount++,void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=null==e?void 0:e.timeStamp),this.lastSkippedEventTime=null==e?void 0:e.timeStamp}else this.flushBufferIntoIndexedDB(!0);else this.allowPersistIntoIDB&&!this.ALTCompleted&&this.skippedEventsCount++,this.shiftBufferArray()}getAllEvents(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.db||e&&this.bufferArraySize>=e)return e&&this.bufferArraySize>e?Promise.resolve(this.getBufferedEvents().slice(this.bufferArraySize-e)):Promise.resolve(this.getBufferedEvents());{const t=this.getIDBStore(this.db,this.storeName,"readonly");if(t)try{const i=yield(0,W.E)(this.getAllEventsFromIDB(t,e),this.fetchFromIDBTimeLimit);return Promise.resolve(i)}catch(e){const t=this.getBufferedEvents();return t.push({message:`DiagnosticsService - fetching logs form IDB timedout with limit of ${this.timeIndexName} ms`,isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date}),Promise.resolve(t)}}return Promise.resolve(this.getBufferedEvents())}))}handleUserLogout(){this.eventsBufferArray=[],this.scheduledBufferArray=[];const e=(0,x.yN)(this.userId);return this.host.localStorage.removeItem(e),this.allowPersistIntoIDB&&this.db?this.createDeleteUserDBPromise():Promise.resolve()}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}setALTDone(){this.ALTCompleted||(this.skippedEventsCount>0&&this.addEvent({message:`DiagnosticsService - ${this.skippedEventsCount} logs skipped before client_start complete`,isPiiFree:!0,level:T.i.Info,levelName:"info",timeStamp:new Date}),this.ALTCompleted=!0,this.openIndexedDB())}persistLogs(){var e;if(this.bufferArraySize>0)if(this.allowPersistIntoIDB&&this.db)this.flushBufferIntoIndexedDB(!1);else if(null===(e=this.host)||void 0===e?void 0:e.localStorage){const e=(0,x.yN)(this.userId);(0,x.RA)(this,this.host.localStorage,e,this.sessionId)}}parseMaglevEventsFromIDB(e,t){let i="",n=[];return e.forEach((e=>{e.sessionId!==i&&""!==i&&this.addAnSeperateLogItem(n,i),i=e.sessionId,n=n.concat(e.logsArray)})),""!==i&&i!==this.sessionId&&this.addAnSeperateLogItem(n,i),n=n.concat(this.getBufferedEvents()),n.sort(x.mw),t&&n.length>t&&(n=n.slice(n.length-t)),n}parseNonMaglevEventsFromIDB(e,t){const i=new Map;e.forEach((e=>{if(e.logsArray&&e.logsArray.length>0){const t=i.get(e.sessionId)||[];i.set(e.sessionId,t.concat(e.logsArray))}}));let n=i.get(this.sessionId);if(n?(n=n.concat(this.getBufferedEvents()),i.delete(this.sessionId)):n=this.getBufferedEvents(),i.forEach(((e,t)=>{e.sort(x.mw),this.addAnSeperateLogItem(e,t)})),n.sort(x.mw),t&&n.length>=t)return n.slice(n.length-t);let o=Array.from(i.values()).sort(((e,t)=>{const i="function"==typeof e[e.length-1].timeStamp.getTime?e[e.length-1].timeStamp:new Date(e[e.length-1].timeStamp),n="function"==typeof t[t.length-1].timeStamp?t[t.length-1].timeStamp:new Date(t[t.length-1].timeStamp);return i.getTime()-n.getTime()})).flat().concat(n);return t&&o.length>t&&(o=o.slice(o.length-t)),o}createDeleteUserDBPromise(){var e;const t=(null===(e=this.host)||void 0===e?void 0:e.indexedDB)||globalThis.indexedDB;if(t&&this.db){const e=this.getDBName();if(e)return this.disablePersistIntoIDB(P.beforeDeletingDB,"Deleting user IDB"),this.db.close(),new Promise((i=>{const n=this.scenarioFactory.newScenario(U.RG.DiagnosticsDeleteIDB),o=t.deleteDatabase(e);o.onblocked=()=>{this.addEvent({message:"DiagnosticsService - Deleting user diagnostics logs IDB blocked",isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date}),null==n||n.fail({reason:`Deleting DB blocked for ${o.error}`}),i()},o.onsuccess=()=>{null==n||n.stop(),i()},o.onerror=()=>{this.addEvent({message:"DiagnosticsService - Deleting user diagnostics logs IDB error",isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date}),null==n||n.fail({reason:`Deleting DB failed for ${o.error}`}),this.increaseIDBErrorCount(),i()}}))}return Promise.resolve()}flushBufferIntoIndexedDB(e){if(this.bufferArraySize>0){const t=this.getBufferedEvents();this.eventsBufferArray=[],this.scheduledBufferArray=[];const i=this.skippedEventsCount;this.updateThrottleInfo(t);const n=this.scenarioFactory.newScenario(U.RG.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(this.getNextManagementItem(),t,!1,void 0,void 0,e),null==n||n.stop({skippedCount:i})}}updateThrottleInfo(e){var t;this.skippedEventsCount>0&&this.lastSkippedEventTime&&(e.unshift({message:`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${null===(t=this.firstSkippedEventTime)||void 0===t?void 0:t.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,level:T.i.Info,levelName:"Info",isPiiFree:!0,timeStamp:this.lastSkippedEventTime}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0),this.lastPersistTimestamp=Date.now()}openIndexedDB(){var e;if(this.allowPersistIntoIDB&&!this.db&&this.ALTCompleted){const t=(null===(e=this.host)||void 0===e?void 0:e.indexedDB)||globalThis.indexedDB;if(!t)return;const i=this.getDBName();if(i){const e=this.scenarioFactory.newScenario(U.RG.DiagnosticsOpenIDB),n=t.open(i,this.indexedDBVersion);n.onerror=()=>{this.addEvent({message:"DiagnosticsService - Open IndexedDB failed",isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date}),null==e||e.fail({reason:n.error}),this.increaseIDBErrorCount()},n.onupgradeneeded=()=>{this.createDataStores(n.result)},n.onsuccess=()=>{this.initializeManagementArray(n.result),null==e||e.stop()}}}}createDataStores(e){const t=this.scenarioFactory.newScenario(U.RG.DiagnosticsCreateIDBStore);try{e.createObjectStore(this.storeName,{autoIncrement:!0}).createIndex(this.timeIndexName,"timeStamp",{unique:!0}),null==t||t.stop()}catch(e){null==t||t.fail({reason:e}),this.addEvent({message:"DiagnosticService - Create objectStore failed",isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date})}}getDBName(){return this.tId&&this.oId&&this.experienceName&&this.sessionId?`Teams:${this.databaseName}:${this.experienceName}:${this.tId}:${this.oId}`:""}getIDBStore(e,t,i){if(e)try{const n=e.transaction(t,i);return null==n?void 0:n.objectStore(t)}catch(e){this.disablePersistIntoIDB(P.error,"getIDBStore failed")}}persistBufferIntoDB(e,t,i=!1,n,o,r=!1){if(0===t.length)return;if(e.isUpdating&&!i)return void this.disablePersistIntoIDB(P.error,"All diagnostics log indexedDB items are pending update");const s=this.getIDBStore(this.db,this.storeName,"readwrite");if(s){i||(e.isUpdating=!0,e.timeStamp=o||Date.now());const a={logsArray:t,sessionId:n||this.sessionId||"",timeStamp:e.timeStamp};let l,c;e.IDBId>0?(c=this.scenarioFactory.newScenario(U.RG.DiagnosticsUpdateIDBItem),l=s.put(a,e.IDBId)):(c=this.scenarioFactory.newScenario(U.RG.DiagnosticsAddLogsIntoIDB),l=s.add(a)),l.onsuccess=()=>{null==c||c.stop({context:this.userId,message:this.timeThrottleEnabled()?"throttle_enabled":"throttle_not_enabled",reason:r?"regular":"forced"}),t.length=0,this.isMaglev?(e.isUpdating=!1,e.IDBId=l.result):this.checkIDBItemCount()},l.onerror=()=>{null==c||c.fail({reason:`${r?"regular":"forced"} - error: ${l.error}`,retryCount:i?1:0,context:this.userId,message:this.timeThrottleEnabled()?"throttle_enabled":"throttle_not_enabled"}),i?(this.addEvent({message:`DiagnosticService - Failed adding event buffer into IDB after retry, lost ${t.length} events`,isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date}),t.length=0,e.isUpdating=!1,this.increaseIDBErrorCount()):(this.addEvent({message:"DiagnosticService - Failed adding event buffer into IDB, start retry",isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date}),this.persistBufferIntoDB(e,t,!0,n,o,r))}}}deleteIDBItems(e){if(e.length>0){const t=this.getIDBStore(this.db,this.storeName,"readwrite");t&&e.forEach((e=>{const i=this.scenarioFactory.newScenario(U.RG.DiagnosticsDeleteLogsInIDB),n=t.delete(e);n.onsuccess=()=>{null==i||i.stop()},n.onerror=()=>{null==i||i.fail({reason:n.error}),this.increaseIDBErrorCount()}}))}}clearDBStore(){const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=this.scenarioFactory.newScenario(U.RG.DiagnosticsClearIDBStore),i=e.clear();i.onsuccess=()=>{this.IDBManagementArray=[],this.currentIDBItemIndex=-1,null==t||t.stop()},i.onerror=()=>{null==t||t.fail({reason:i.error}),this.addEvent({message:"DiagnosticsService - Clear IDB store failed",isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date}),this.increaseIDBErrorCount()}}}getToBeDeletedIDs(e){const t=[];if(this.db&&e<this.IDBManagementArray.length){const i=this.IDBManagementArray.length-e;for(let e=0;e<i;e++){let e=0;this.currentIDBItemIndex<this.IDBManagementArray.length-1&&(e=this.currentIDBItemIndex+1);const i=this.IDBManagementArray[e];t.push(i.IDBId),this.IDBManagementArray.splice(e,1),0===e&&this.currentIDBItemIndex--}}return t}getNextManagementItem(){return this.isMaglev?(this.currentIDBItemIndex===this.IDBManagementArray.length-1?this.IDBManagementArray.length<this.allowedCountOfIndexDBObject?(this.addNewManagementItem(),this.currentIDBItemIndex++):this.currentIDBItemIndex=0:this.currentIDBItemIndex++,this.IDBManagementArray[this.currentIDBItemIndex]):{IDBId:0,timeStamp:0,isUpdating:!1}}initializeManagementArray(e){if(this.allowPersistIntoIDB&&e&&!this.db)if(this.isMaglev){const t=this.getIDBStore(e,this.storeName,"readwrite");if(t){const i=t.index(this.timeIndexName);if(i){const t=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetAllKeysFromIDB),n=i.getAllKeys();n.onsuccess=()=>{null==t||t.stop(),this.db=e,this.IDBManagementArray=[],n.result.forEach((e=>this.addNewManagementItem(e))),this.currentIDBItemIndex=this.IDBManagementArray.length-1,this.fetchAndPersistPreviuosSessionLogs()},n.onerror=()=>{null==t||t.fail({reason:n.error}),this.increaseIDBErrorCount()}}}}else this.db=e,this.fetchAndPersistPreviuosSessionLogs()}addNewManagementItem(e=0){this.IDBManagementArray.push({timeStamp:0,isUpdating:!1,IDBId:e})}disablePersistIntoIDB(e,t){var i;const n=this.allowPersistIntoIDB;switch(e){case P.ecsSetting:if(!this.ecsEnableIDBLogs)return;this.ecsEnableIDBLogs=!1;break;case P.clientPreference:if(!this.isUserEnableIDBLogs)return;this.isUserEnableIDBLogs=!1;break;case P.error:case P.beforeDeletingDB:if(this.disableIDBLogs)return;this.disableIDBLogs=!0}const o=`DiagnosticService - writing logs into IDB settings changed for ${P[e]}`;this.addEvent({message:o,isPiiFree:!0,level:e===P.error?T.i.Error:T.i.Info,levelName:e===P.error?"error":"info",timeStamp:new Date}),n&&!this.allowPersistIntoIDB&&(e===P.error?null===(i=this.scenarioFactory.newScenario(U.RG.DiagnosticsDisableIDB))||void 0===i||i.stop({errorReason:t}):e!==P.beforeDeletingDB&&this.clearDBStore())}increaseIDBErrorCount(){this.IDBErrorCount<this.allowedIDBErrorCount&&(this.IDBErrorCount++,this.IDBErrorCount===this.allowedIDBErrorCount&&this.disablePersistIntoIDB(P.error,"Allowed IDB error count reached"))}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingInterval}timeThrottleEnabled(){return!this.isUserEnableIDBLogs&&this.timeThrottlingInterval>0&&this.lastPersistTimestamp>0}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${x.f5} The following logs are for previous session [${t}] ${x.f5}`,isPiiFree:!0,level:T.i.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}get allowPersistIntoIDB(){return(this.ecsEnableIDBLogs||this.isUserEnableIDBLogs)&&!this.disableIDBLogs}fetchAndPersistPreviuosSessionLogs(){var e;let t=this.fetchPreviuosSessionLogsFromLocalStorage(this.userId);(0,x.uD)(this.host.localStorage,this.userId||""),void 0===t&&this.userId===x.$J&&(t=this.fetchPreviuosSessionLogsFromLocalStorage(),t&&(0,x.uD)(this.host.localStorage,"")),t&&t.sessionId&&(null===(e=t.logsArray)||void 0===e?void 0:e.length)>0&&this.persistBufferIntoDB(this.getNextManagementItem(),t.logsArray,!1,t.sessionId,t.logsArray[t.logsArray.length-1].timeStamp.getTime(),!1)}fetchPreviuosSessionLogsFromLocalStorage(e){const t=(0,x.IB)(e);return(0,x.Tx)(this.host.localStorage,t,!0)}checkIDBItemCount(){if(!this.isMaglev&&this.allowPersistIntoIDB&&this.db){const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=e.index(this.timeIndexName);if(t){const e=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetAllKeysFromIDB),i=t.getAllKeys();i.onsuccess=()=>{null==e||e.stop(),i.result.length>this.allowedCountOfIndexDBObject&&this.deleteIDBItems([i.result[0]])},i.onerror=()=>{null==e||e.fail({reason:i.error}),this.increaseIDBErrorCount()}}}}}get isMaglev(){var e,t,i;return void 0===this._isMaglev&&(this._isMaglev=null===(i=null===(t=null===(e=(0,F.J)())||void 0===e?void 0:e.loader)||void 0===t?void 0:t.getProperties())||void 0===i?void 0:i.isMaglev),this._isMaglev}getAllEventsFromIDB(e,t){return new Promise((i=>{const n=e.index(this.timeIndexName);if(!n)return i(this.getBufferedEvents());{const e=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetAllLogsFromIDB),o=n.getAll();o.onsuccess=()=>{null==e||e.stop();const n=this.isMaglev?this.parseMaglevEventsFromIDB(o.result,t):this.parseNonMaglevEventsFromIDB(o.result,t);i(n)},o.onerror=()=>{null==e||e.fail({reason:o.error}),this.increaseIDBErrorCount(),i(this.getBufferedEvents())}}}))}}var $=i(919567);class H extends A{constructor(e){super(),this.sessionId=e,this.currentIDBItemIndex=-1,this.IDBManagementArray=[],this.defaultWorkerAllowedBufferLength=1e3,this.defaultWorkerMaxCountOfIndexDBObject=10,this.minWorkerBufferLength=500,this.maxWorkerBufferLength=5e3,this.minWorkerCountOfIDBObjects=5,this.maxWorkerCountOfIDBObjects=100,this.timeThrottlingInterval=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.pushLogsOutOfOrdersFound=!1,this.disableIDBLogs=!1,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.allowedCountOfIndexDBObject=this.defaultWorkerMaxCountOfIndexDBObject,this.allowedBufferLength=this.defaultWorkerAllowedBufferLength,this.scenarioFactory=I(!0)}setDBInfo(e,t,i){this.addEvent({message:`DiagnosticsService - setDBInfo called for: tid ${e}, oid ${t}, userid ${i}`,isPiiFree:!0,level:T.i.Info,levelName:"info",timeStamp:new Date})}setCapacity(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingInterval=e.throttleTime*$.kg),e.bufferSize&&e.bufferSize>=this.minWorkerBufferLength&&e.bufferSize<=this.maxWorkerBufferLength&&(this.allowedBufferLength=e.bufferSize);const t=this.allowPersistIntoIDB;if(e.enableIndexedDB?this.ecsEnableIDBLogs=!0:!1===e.enableIndexedDB&&this.disablePersistIntoIDB(P.ecsSetting),e.clientEnableExtendedLogs?this.isUserEnableIDBLogs=!0:!1===e.clientEnableExtendedLogs&&this.disablePersistIntoIDB(P.clientPreference),e.IDBObjectCount&&e.IDBObjectCount>=this.minWorkerCountOfIDBObjects&&e.IDBObjectCount<=this.maxWorkerCountOfIDBObjects){if(t&&this.allowPersistIntoIDB&&this.IDBManagementArray.length>e.IDBObjectCount){const t=this.getToBeDeletedIDs(e.IDBObjectCount);yield this.deleteIDBItems(t)}this.allowedCountOfIndexDBObject=e.IDBObjectCount}}))}addEvent(e){if(!this.pushLogsOutOfOrdersFound&&this.eventsBufferArray.length>0&&e.timeStamp<this.eventsBufferArray[this.eventsBufferArray.length-1].timeStamp){this.pushLogsOutOfOrdersFound=!0;const t=this.scenarioFactory.newScenario(U.RG.DiagnosticsLogsAddOutOfOrder);null==t||t.fail({reason:`Add one log out of order: Current - ${e.timeStamp.toString()}, Last - ${this.eventsBufferArray[this.eventsBufferArray.length-1].timeStamp.toString()}`})}if(this.eventsBufferArray.push(e),this.eventsBufferArray.length>=this.allowedBufferLength)if(this.allowPersistIntoIDB&&this.dataManager)if(this.shouldBeThrottled()){const e=this.eventsBufferArray.shift();this.skippedEventsCount++,void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=null==e?void 0:e.timeStamp),this.lastSkippedEventTime=null==e?void 0:e.timeStamp}else this.flushBufferIntoIndexedDB(!0);else this.eventsBufferArray.shift()}getAllEvents(e){return!this.dataManager||!this.allowPersistIntoIDB||e&&this.eventsBufferArray.length>=e?e&&this.eventsBufferArray.length>e?Promise.resolve(this.eventsBufferArray.slice(this.eventsBufferArray.length-e)):Promise.resolve(this.eventsBufferArray):new Promise((t=>{var i;null===(i=this.dataManager)||void 0===i||i.getAllLogs().then((i=>{let n=[],o="",r="";null==i||i.sort(((e,t)=>e.timeStamp-t.timeStamp)),null==i||i.forEach((e=>{""!==o&&e.logsArray.length>1&&e.logsArray[0].timeStamp>e.logsArray[e.logsArray.length-1].timeStamp&&(o=`Fetch from IDB out of order: First - ${e.logsArray[0].timeStamp.toString()}, Last - ${e.logsArray[e.logsArray.length-1].timeStamp.toString()}`),e.sessionId!==r&&""!==r&&this.addAnSeperateLogItem(n,r),r=e.sessionId,n=n.concat(e.logsArray)})),""!==r&&r!==this.sessionId&&this.addAnSeperateLogItem(n,r),n=n.concat(this.eventsBufferArray),e&&n.length>e&&(n=n.slice(n.length-e)),t(n)}))}))}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}setWorkerLogsDataManager(e){this.dataManager=e}persistLogs(){this.allowPersistIntoIDB&&this.flushBufferIntoIndexedDB(!1)}handleUserLogout(e){return Promise.resolve()}flushBufferIntoIndexedDB(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.eventsBufferArray.length>0){const t=this.eventsBufferArray;this.eventsBufferArray=[];const i=this.skippedEventsCount;this.updateThrottleInfo(t);const n=yield this.getNextManagementItem(),o=this.scenarioFactory.newScenario(U.RG.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(n,t,e),null==o||o.stop({skippedCount:i})}}))}updateThrottleInfo(e){var t;this.skippedEventsCount>0&&this.lastSkippedEventTime&&(e.unshift({message:`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${null===(t=this.firstSkippedEventTime)||void 0===t?void 0:t.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,level:T.i.Info,levelName:"Info",isPiiFree:!0,timeStamp:this.lastSkippedEventTime}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0),this.lastPersistTimestamp=Date.now()}persistBufferIntoDB(e,t,i){var n;if(0===t.length||!this.allowPersistIntoIDB)return;const o={id:e.IDBId,logsArray:t,sessionId:this.sessionId||"",timeStamp:Date.now(),throttleEnabled:this.timeThrottleEnabled(),isRegularPersist:i};null===(n=this.dataManager)||void 0===n||n.persistLogs(o),e.timeStamp=o.timeStamp}deleteIDBItems(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.length>0&&this.dataManager&&e.forEach((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t;if(yield null===(t=this.dataManager)||void 0===t?void 0:t.removeOneLogItem(e)){const t=this.IDBManagementArray.findIndex((t=>t.IDBId===e));t>=0&&this.IDBManagementArray.splice(t,1)}}))))}))}clearDBStore(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.dataManager&&(yield null===(e=this.dataManager)||void 0===e?void 0:e.clearAllLogs())&&(this.IDBManagementArray=[],this.currentIDBItemIndex=-1),!0}))}getToBeDeletedIDs(e){const t=[];if(this.dataManager&&e<this.IDBManagementArray.length){const i=this.IDBManagementArray.length-e;for(let e=0;e<i;e++){let e=0;this.currentIDBItemIndex<this.IDBManagementArray.length-1&&(e=this.currentIDBItemIndex+1);const i=this.IDBManagementArray[e];t.push(i.IDBId),this.IDBManagementArray.splice(e,1),0===e&&this.currentIDBItemIndex--}}return t}getNextManagementItem(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return 0===this.IDBManagementArray.length&&this.allowedCountOfIndexDBObject>0&&(yield this.initializeManagementArray()),this.currentIDBItemIndex===this.IDBManagementArray.length-1?this.IDBManagementArray.length<this.allowedCountOfIndexDBObject?(this.addNewManagementItem(),this.currentIDBItemIndex++):this.currentIDBItemIndex=0:this.currentIDBItemIndex++,this.IDBManagementArray[this.currentIDBItemIndex]}))}addNewManagementItem(){let e=0;for(this.IDBManagementArray.length>0&&(e=this.IDBManagementArray[this.IDBManagementArray.length-1].IDBId),e++;e>this.allowedCountOfIndexDBObject||this.idExists(e);)e>this.allowedCountOfIndexDBObject?e=1:e++;this.IDBManagementArray.push({IDBId:e,timeStamp:0,isUpdating:!1})}idExists(e){return this.IDBManagementArray.filter((t=>t.IDBId===e)).length>0}initializeManagementArray(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.allowPersistIntoIDB&&this.dataManager&&0===this.IDBManagementArray.length&&this.allowedCountOfIndexDBObject>0){const t=yield null===(e=this.dataManager)||void 0===e?void 0:e.getAllKeys();null==t||t.sort(((e,t)=>e.timeStamp-t.timeStamp)),null==t||t.forEach((e=>this.IDBManagementArray.push({IDBId:e.id,timeStamp:e.timeStamp,isUpdating:!1}))),this.currentIDBItemIndex=this.IDBManagementArray.length-1}}))}disablePersistIntoIDB(e,t){var i;const n=this.allowPersistIntoIDB;switch(e){case P.ecsSetting:if(!this.ecsEnableIDBLogs)return;this.ecsEnableIDBLogs=!1;break;case P.clientPreference:if(!this.isUserEnableIDBLogs)return;this.isUserEnableIDBLogs=!1;break;case P.error:case P.beforeDeletingDB:if(this.disableIDBLogs)return;this.disableIDBLogs=!0}const o=`DiagnosticService - writing logs into IDB settings changed for ${P[e]}`;this.addEvent({message:o,isPiiFree:!0,level:e===P.error?T.i.Error:T.i.Info,levelName:e===P.error?"error":"info",timeStamp:new Date}),n&&!this.allowPersistIntoIDB&&(e===P.error?null===(i=this.scenarioFactory.newScenario(U.RG.DiagnosticsDisableIDB))||void 0===i||i.stop({errorReason:t}):e!==P.beforeDeletingDB&&this.clearDBStore())}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingInterval}timeThrottleEnabled(){return!this.isUserEnableIDBLogs&&this.timeThrottlingInterval>0&&this.lastPersistTimestamp>0}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${x.f5} The following logs are for previous session [${t}] ${x.f5}`,isPiiFree:!0,level:T.i.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}get allowPersistIntoIDB(){return(this.ecsEnableIDBLogs||this.isUserEnableIDBLogs)&&!this.disableIDBLogs}}class q{constructor(e,t){this.sessionId=e,this.allowedBufferLength=2e3,this.minBufferLength=500,this.maxBufferLength=5e3,this.timeThrottlingIntervalMs=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.disableExtendedPersistingThrottling=!1,this.fetchFromIDBTimeLimit=18e3,this.minFetchFromIDBTimeLimit=5e3,this.eventsBufferArray=[],this.updateBufferLength(t),this.scenarioFactory=I(!0)}setExtendedStorage(e){this._extendedStorage=e}setCapacity(e){void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingIntervalMs=1e3*e.throttleTime),void 0!==e.clientEnableExtendedLogs&&(this.disableExtendedPersistingThrottling=e.clientEnableExtendedLogs),this.updateBufferLength(e.bufferSize),e.IDBFetchingTimeoutMs&&e.IDBFetchingTimeoutMs>this.minFetchFromIDBTimeLimit&&(this.fetchFromIDBTimeLimit=e.IDBFetchingTimeoutMs)}addEvent(e){var t;if(this.eventsBufferArray.push(e),!(this.eventsBufferArray.length<this.allowedBufferLength)){if(!(null===(t=this._extendedStorage)||void 0===t?void 0:t.isStorageEnabled))return this.skippedEventsCount++,void this.eventsBufferArray.shift();if(this.shouldBeThrottled()){this.skippedEventsCount++;const e=this.eventsBufferArray.shift();void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=null==e?void 0:e.timeStamp),this.lastSkippedEventTime=null==e?void 0:e.timeStamp}else this.flushBufferIntoIndexedDB()}}getAllEvents(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if((null===(t=this._extendedStorage)||void 0===t?void 0:t.isStorageEnabled)&&(!e||e&&e>this.eventsBufferArray.length)){const t=e?e-this.eventsBufferArray.length:void 0,i=this._extendedStorage.getLatestLogs(t);try{const e=yield(0,W.E)(i,this.fetchFromIDBTimeLimit);return Promise.resolve(e.concat(this.eventsBufferArray))}catch(e){const t=this.eventsBufferArray;return t.push({message:`DiagnosticsService - fetching logs form IDB timedout with limit of ${this.fetchFromIDBTimeLimit} ms`,isPiiFree:!0,level:T.i.Error,levelName:"error",timeStamp:new Date}),Promise.resolve(t)}}return e&&this.eventsBufferArray.length>e?Promise.resolve(this.eventsBufferArray.slice(this.eventsBufferArray.length-e)):Promise.resolve(this.eventsBufferArray)}))}handleUserLogout(){return this.eventsBufferArray.length=0,this._extendedStorage?this._extendedStorage.clearLogs():Promise.resolve(!0)}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}getBufferedEvents(e){return e&&e>0&&e<this.eventsBufferArray.length?this.eventsBufferArray.slice(this.eventsBufferArray.length-e):this.eventsBufferArray}flushBufferIntoIndexedDB(){var e;if(this.eventsBufferArray.length>0&&(null===(e=this._extendedStorage)||void 0===e?void 0:e.isStorageEnabled)){const e=this.eventsBufferArray;this.eventsBufferArray=[];const t=this.skippedEventsCount;this.updateThrottleInfo(e),this.lastPersistTimestamp=Date.now();const i=this.scenarioFactory.newScenario(U.RG.DiagnosticsSaveIDBItemMain);this._extendedStorage.storeLogs(e,this.sessionId,Date.now(),"force"),null==i||i.stop({skippedCount:t})}}updateThrottleInfo(e){var t;if(this.skippedEventsCount>0){let i=`DiagnosticsService - skipped ${this.skippedEventsCount} event logs before extended logs storage enabled`,n=new Date;this.lastSkippedEventTime&&(i=`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${null===(t=this.firstSkippedEventTime)||void 0===t?void 0:t.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,n=this.lastSkippedEventTime),e.unshift({message:i,level:T.i.Info,levelName:"Info",isPiiFree:!0,timeStamp:n}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0}}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingIntervalMs}timeThrottleEnabled(){return!this.disableExtendedPersistingThrottling&&this.timeThrottlingIntervalMs>0&&this.lastPersistTimestamp>0}updateBufferLength(e){e&&e!==this.allowedBufferLength&&e>=this.minBufferLength&&e<=this.maxBufferLength&&(this.allowedBufferLength=e)}}class z{constructor(){this.minAllowedStorageObjectCount=3,this.allowedCountOfStorageObject=10,this.sessionId="",this.scenarioFactory=I(!0)}setCapacity(e){this.allowedCountOfStorageObject!==e&&e>=this.minAllowedStorageObjectCount&&(this.allowedCountOfStorageObject=e,this.checkStorageItemCount())}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}parseAndSortLogs(e,t){const i=new Map;e.forEach((e=>{if(e.logsArray&&e.logsArray.length>0){const t=i.get(e.sessionId)||[];i.set(e.sessionId,t.concat(e.logsArray))}}));const n=i.get(this.sessionId)||[];if(n&&i.delete(this.sessionId),i.forEach(((e,t)=>{e.sort(x.mw),this.addAnSeperateLogItem(e,t)})),n.sort(x.mw),t&&n.length>=t)return n.slice(n.length-t);let o=Array.from(i.values()).sort(((e,t)=>{const i="function"==typeof e[e.length-1].timeStamp.getTime?e[e.length-1].timeStamp:new Date(e[e.length-1].timeStamp),n="function"==typeof t[t.length-1].timeStamp?t[t.length-1].timeStamp:new Date(t[t.length-1].timeStamp);return i.getTime()-n.getTime()})).flat().concat(n);return t&&o.length>t&&(o=o.slice(o.length-t)),o}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${x.f5} The following logs are for previous session [${t}] ${x.f5}`,isPiiFree:!0,level:T.i.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}}class V extends z{constructor(e,t,i){super(),this.idbFactory=e,this.databaseName=t,this.sessionId=i,this.indexedDBVersion=1,this.storeName="LogsStore",this.timeIndexName="timeIdx",this.IDBErrorCount=0,this.allowedIDBErrorCount=10,this.disableIDBLogs=!1,this.ongoingSavingRequestCount=0,this.allowedSavingRequestCount=3}initialize(){if(this.db)return Promise.resolve(!0);if(this.disableIDBLogs)return Promise.resolve(!1);const e=this.scenarioFactory.newScenario(U.RG.DiagnosticsOpenIDB);return new Promise((t=>{const i=this.idbFactory.open(this.databaseName,this.indexedDBVersion);i.onerror=()=>{null==e||e.fail({reason:"openDB error"}),this.increaseIDBErrorCount(),t(!1)},i.onblocked=()=>{null==e||e.fail({reason:"openDB blocked",context:this.databaseName}),this.increaseIDBErrorCount(),t(!1)},i.onupgradeneeded=()=>{this.createDataStores(i.result)},i.onsuccess=()=>{this.db=i.result,null==e||e.stop({context:this.databaseName}),t(!0)}}))}getLatestLogs(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=this.getIDBStore(this.db,this.storeName,"readonly");if(t){return new Promise((i=>{const n=t.index(this.timeIndexName);if(!n)return i([]);{const t=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetAllLogsFromIDB),o=n.getAll();o.onsuccess=()=>{null==t||t.stop({context:this.databaseName});const n=this.parseAndSortLogs(o.result,e);i(n)},o.onerror=()=>{null==t||t.fail({reason:o.error,context:this.databaseName}),this.increaseIDBErrorCount(),i([])}}}))}return Promise.resolve([])}))}clearLogs(){return this.db?(this.disablePersistIntoIDB("Before clearing IDB"),this.db.close(),new Promise((e=>{const t=this.scenarioFactory.newScenario(U.RG.DiagnosticsDeleteIDB),i=this.idbFactory.deleteDatabase(this.databaseName);i.onblocked=()=>{null==t||t.fail({reason:`Deleting DB blocked for ${i.error}`,context:this.databaseName}),this.increaseIDBErrorCount(),e(!1)},i.onsuccess=()=>{null==t||t.stop({context:this.databaseName}),e(!0)},i.onerror=()=>{null==t||t.fail({reason:`Deleting DB failed for ${i.error}`,context:this.databaseName}),this.increaseIDBErrorCount(),e(!1)}}))):Promise.resolve(!0)}storeLogs(e,t,i,n="force"){if(e.length>0){const o=this.scenarioFactory.newScenario(U.RG.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(e,!1,t||this.sessionId,i||Date.now(),n),null==o||o.stop({context:this.databaseName})}}get isStorageEnabled(){return!this.disableIDBLogs&&!!this.db}checkStorageItemCount(){const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=e.index(this.timeIndexName);if(t){const e=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetAllKeysFromIDB),i=t.getAllKeys();i.onsuccess=()=>{if(null==e||e.stop({context:this.databaseName}),i.result.length>this.allowedCountOfStorageObject){const e=i.result.length-this.allowedCountOfStorageObject;for(let t=0;t<e;t++)this.deleteIDBItem(i.result[t])}},i.onerror=()=>{null==e||e.fail({reason:i.error,context:this.databaseName}),this.increaseIDBErrorCount()}}}}createDataStores(e){const t=this.scenarioFactory.newScenario(U.RG.DiagnosticsCreateIDBStore);try{e.createObjectStore(this.storeName,{autoIncrement:!0}).createIndex(this.timeIndexName,"timeStamp",{unique:!1}),null==t||t.stop({context:this.databaseName})}catch(e){null==t||t.fail({reason:e,context:this.databaseName})}}getIDBStore(e,t,i){if(e)try{const n=e.transaction(t,i);return null==n?void 0:n.objectStore(t)}catch(e){this.disablePersistIntoIDB("getIDBStore failed")}}persistBufferIntoDB(e,t=!1,i,n,o="buffer-full"){if(0===e.length)return;if(this.ongoingSavingRequestCount>this.allowedSavingRequestCount)return void this.disablePersistIntoIDB(`${this.ongoingSavingRequestCount} saving logs request are pending`);const r=this.getIDBStore(this.db,this.storeName,"readwrite");if(!r)return;const s={logsArray:e,sessionId:i||this.sessionId,timeStamp:n};this.ongoingSavingRequestCount++;const a=this.scenarioFactory.newScenario(U.RG.DiagnosticsAddLogsIntoIDB),l=r.add(s);l.onsuccess=()=>{this.ongoingSavingRequestCount--,null==a||a.stop({reason:"buffer-full"===o?"regular":"forced",context:this.databaseName}),e.length=0,this.checkStorageItemCount()},l.onerror=()=>{this.ongoingSavingRequestCount--,null==a||a.fail({reason:`${"buffer-full"===o?"regular":"forced"} - error: ${l.error}`,retryCount:t?1:0,context:this.databaseName}),t?(e.length=0,this.increaseIDBErrorCount()):this.persistBufferIntoDB(e,!0,i,n,o)}}deleteIDBItem(e){const t=this.getIDBStore(this.db,this.storeName,"readwrite");if(t){const i=this.scenarioFactory.newScenario(U.RG.DiagnosticsDeleteLogsInIDB),n=t.delete(e);n.onsuccess=()=>{null==i||i.stop({context:this.databaseName})},n.onerror=()=>{null==i||i.fail({reason:n.error,context:this.databaseName}),this.increaseIDBErrorCount()}}}increaseIDBErrorCount(){this.IDBErrorCount<this.allowedIDBErrorCount&&(this.IDBErrorCount++,this.IDBErrorCount===this.allowedIDBErrorCount&&this.disablePersistIntoIDB("Allowed IDB error count reached"))}disablePersistIntoIDB(e){var t;this.disableIDBLogs||(this.disableIDBLogs=!0,null===(t=this.scenarioFactory.newScenario(U.RG.DiagnosticsDisableIDB))||void 0===t||t.stop({errorReason:e,context:this.databaseName}))}}class G extends z{constructor(e,t,i){super(),this.host=e,this.folderName=t,this.sessionId=i,this.OPFSErrorCount=0,this.allowedOPFSErrorCount=10,this.disableOPFSLogs=!1,this.ongoingSavingRequestCount=0,this.allowedSavingRequestCount=3,this.rootFolderName="DiagnosticsLogs",this.folderName=this.folderName.split(":").join("_")}initialize(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.folderHandle)return Promise.resolve(!0);if(this.folderName){const e=this.scenarioFactory.newScenario(U.RG.DiagnosticsInitOPFS);try{const t=yield this.host.navigator.storage.getDirectory();return this.logsRootFolderHandle=yield t.getDirectoryHandle(this.rootFolderName,{create:!0}),this.folderHandle=yield this.logsRootFolderHandle.getDirectoryHandle(this.folderName,{create:!0}),null==e||e.stop({context:this.folderName}),!0}catch(t){null==e||e.fail({reason:t.errorCode||t.code})}}return!1}))}getLatestLogs(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.folderHandle?new Promise((t=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var i;const n=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetAllLogsFromOPFS);try{const o=[],r=yield null===(i=this.folderHandle)||void 0===i?void 0:i.values(),s=yield this.getAllFiles(r),a=[];for(const e of s){const t=yield e.value.getFile(),i=yield t.text();let n=!1;if(i&&i.length>0)try{const e=JSON.parse(i);o.push(e)}catch(e){n=!0}else n=!0;n&&a.push(e.value.name)}const l=this.parseAndSortLogs(o,e);null==n||n.stop({context:this.folderName}),a.length>0&&(yield this.deleteOPFSItems(a)),t(l)}catch(e){null==n||n.fail({reason:e.errorCode||e.code}),this.increaseOPFSErrorCount(),t([])}})))):Promise.resolve([])}))}clearLogs(){return this.ongoingClearLogs||(this.disablePersistIntoOPFS("Deleting user OPFS folder"),this.ongoingClearLogs=new Promise((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t;let i=!0;if(this.logsRootFolderHandle&&(null===(t=this.folderHandle)||void 0===t?void 0:t.name)){const e=this.folderHandle.name,t=this.logsRootFolderHandle,n=this.scenarioFactory.newScenario(U.RG.DiagnosticsClearOPFSFolder);try{yield t.removeEntry(e,{recursive:!0}),null==n||n.stop({context:this.folderName})}catch(e){null==n||n.fail({reason:`Deleting OPFS folder failed for ${e.errorCode||e.code}`}),this.increaseOPFSErrorCount(),i=!1}}this.ongoingClearLogs=void 0,e(i)}))))),this.ongoingClearLogs}storeLogs(e,t,i,n="force"){if(0===e.length)return;const o=this.scenarioFactory.newScenario(U.RG.DiagnosticsSaveOPFSItemMain),r=this.createLogsFile(e,t||this.sessionId,i);this.persistBufferIntoOPFS(r,!1,n),null==o||o.stop({context:this.folderName})}get isStorageEnabled(){return!this.disableOPFSLogs&&!!this.folderHandle}checkStorageItemCount(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.folderHandle){const e=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetAllKeysFromOPFS);try{const t=[],i=yield this.folderHandle.keys();let n=yield i.next();for(;void 0!==n&&!n.done&&n.value;)t.push(n.value),n=yield i.next();null==e||e.stop({context:this.folderName}),t.length>this.allowedCountOfStorageObject&&(t.sort(((e,t)=>Number(e)-Number(t))),t.slice(0,t.length-this.allowedCountOfStorageObject),this.deleteOPFSItems(t.slice(0,t.length-this.allowedCountOfStorageObject)))}catch(t){null==e||e.fail({reason:t.errorCode||t.code}),this.increaseOPFSErrorCount()}}}))}getAllFiles(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=[];if(e){let i=yield e.next();for(;i&&!i.done&&i.value;)"file"===i.value.kind&&t.push(i),i=yield e.next()}return t}))}persistBufferIntoOPFS(e,t=!1,i="buffer-full"){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(0===e.logsArray.length)return Promise.resolve();if(this.ongoingSavingRequestCount>this.allowedSavingRequestCount)return this.disablePersistIntoOPFS(`${this.ongoingSavingRequestCount} saving logs request are pending`),Promise.resolve();if(this.folderHandle){const n=e.timeStamp.toString(),o=yield this.folderHandle.getFileHandle(n,{create:!0});if(o){this.ongoingSavingRequestCount++;const n=this.scenarioFactory.newScenario(U.RG.DiagnosticsAddLogsIntoOPFS);try{const t=yield o.createWritable();yield t.write(JSON.stringify(e)),yield t.close(),this.ongoingSavingRequestCount--,null==n||n.stop({reason:"buffer-full"===i?"regular":"forced",context:this.folderName}),this.checkStorageItemCount()}catch(o){this.ongoingSavingRequestCount--,null==n||n.fail({reason:`${"buffer-full"===i?"regular":"forced"} - error: ${o.errorCode||o.code}`,retryCount:t?1:0}),t?this.increaseOPFSErrorCount():yield this.persistBufferIntoOPFS(e,!0,i)}}}}))}deleteOPFSItems(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.length>0&&this.folderHandle&&e.forEach((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t;const i=this.scenarioFactory.newScenario(U.RG.DiagnosticsDeleteLogsInOPFS);try{yield null===(t=this.folderHandle)||void 0===t?void 0:t.removeEntry(e),null==i||i.stop({context:this.folderName})}catch(e){return null==i||i.fail({reason:e.errorCode||e.code}),void this.increaseOPFSErrorCount()}}))))}))}increaseOPFSErrorCount(){this.OPFSErrorCount<this.allowedOPFSErrorCount&&(this.OPFSErrorCount++,this.OPFSErrorCount===this.allowedOPFSErrorCount&&this.disablePersistIntoOPFS("Allowed OPFS error count reached"))}disablePersistIntoOPFS(e){var t;this.disableOPFSLogs||(this.disableOPFSLogs=!0,null===(t=this.scenarioFactory.newScenario(U.RG.DiagnosticsDisableOPFS))||void 0===t||t.stop({reason:e}))}createLogsFile(e,t,i){return{logsArray:e,sessionId:t,timeStamp:i||Date.now()}}}class J{constructor(e,t,i,n,o){var r;this.sessionId=e,this.experienceName=t,this.extendedStoreName=i,this.defaultPreECSConsoleLogLevel=n,this.userECSConsoleLogLevel=o,this.userDiagnosticsMap=new Map,this._userID="",this.memoryBufferArraySize=0,this._minDurationForCountingLogLines=20,this._minThrottleWindowSize=1e4,this._minThrottleWindowCapacity=5,this._minLoggerReportTimeInterval=1e4,this._minLoggerReportCountInterval=30,this._maxCorePreviousSessionLogsLength=0,this._maxUserPreviousSessionLogsLength=0,this._cleanPreviousSessionLogsDelay=18e4,this._clearPreviousSessionLogsTimer=0,this._minLogsInLogFile=500,this._ALTCompleted=!1,this.rwcExperienceName="react-web-client",this.logsStoredAsPreviousSession=!1,this._disableGzipPreviousSessionLogs=!1,this._defaultMainBufferLength=2e3,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.extendedStorageType="None",this._loggerSettings={durationForCountingLogLines:0,loggerReportTimeInterval:0,loggerReportCountInterval:0,diagnosticsLogsThrottling:"DryRunQuiet",isUserEnableIDBLogs:!1,throttleWindowSize:0,throttleCapacity:0,consoleLogLevel:T.i.Error,throttleLoggers:new Set},this._defaultLatestErrorCount=5,this.tId="",this.oId="",this._firstUserID="",this.logsProviderName=y.DIAGNOSTICSSERVICE,this.updatedSettingsForMainThread=e=>{var t,i,n;this.diagnosticsSettings=e,(0,L.isUndefined)(e.clientExtendedDiagnosticsData)||(this.isUserEnableIDBLogs=!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle),this.updateSettingsForLogger({durationForCountingLogLines:e.logsMarkInterval||0,loggerReportTimeInterval:e.loggerReportTimeInterval||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:e.loggerReportCountInterval||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:e.throttleWindowSizeMs||0,throttleCapacity:e.throttleCapacity||0,isUserEnableIDBLogs:this.isUserEnableIDBLogs,diagnosticsLogsThrottling:e.diagnosticsLogsThrottling||"DryRunQuiet",throttleLoggers:new Set(e.loggerThrottleList||[]),consoleLogLevel:this.validateConsoleLogLevel(e.consoleLogLevel||"")});const o=(0,L.isNumber)(e.savingLogsIntoIDBThrottleTime)?e.savingLogsIntoIDBThrottleTime:void 0,r=(0,L.isNumber)(e.diagnosticsEventQueueMaxSize)?e.diagnosticsEventQueueMaxSize:0;if(void 0===e.enableStoreDiagnosticsLogsInIDB&&void 0===e.clientExtendedDiagnosticsData)this.diagnosticsEvents.setCapacity({bufferSize:r,throttleTime:o});else{(0,L.isUndefined)(e.enableStoreDiagnosticsLogsInIDB)||(this.ecsEnableIDBLogs=!!e.enableStoreDiagnosticsLogsInIDB),this.enableExtendedStorage()&&!(null===(t=this.extendedStorage)||void 0===t?void 0:t.isStorageEnabled)&&this.addAndInitExtendedStorage();const s=this.enableExtendedStorage()?(0,L.isNumber)(e.diagnosticsLogBufferArraySize)?e.diagnosticsLogBufferArraySize:0:r;this.diagnosticsEvents.setCapacity({bufferSize:s,clientEnableExtendedLogs:this.isUserEnableIDBLogs,IDBFetchingTimeoutMs:(0,L.isNumber)(e.IDBFetchingTimeoutMs)?e.IDBFetchingTimeoutMs:0,throttleTime:o}),null===(n=null===(i=this.extendedStorage)||void 0===i?void 0:i.setCapacity)||void 0===n||n.call(i,(0,L.isNumber)(e.diagnosticsLogsIDBObjectCount)?e.diagnosticsLogsIDBObjectCount:0)}this._disableGzipPreviousSessionLogs=!!e.disableGzipPreviousSessionLogs,this._maxCorePreviousSessionLogsLength=this.validateSettingNumberValue(e.corePreviousSessionLogsLength,-1,this._maxCorePreviousSessionLogsLength),this._maxUserPreviousSessionLogsLength=this.validateSettingNumberValue(e.userPreviousSessionLogsLength,-1,this._maxUserPreviousSessionLogsLength),this.isErrorDiagnosticsEnabled=!!e.errorDiagnosticsEventQueueMaxSize,e.extendedStorageType&&(this.extendedStorageType=e.extendedStorageType),this.isErrorDiagnosticsEnabled?(0,L.isNumber)(e.errorDiagnosticsEventQueueMaxSize)&&this.errorDiagnosticsEvents.setCapacity({bufferSize:e.errorDiagnosticsEventQueueMaxSize}):this.errorDiagnosticsEvents.handleUserLogout(),this._cleanPreviousSessionLogsDelay=this.validateSettingNumberValue(e.clearPreviousSessionLogsDelayMs,0,this._cleanPreviousSessionLogsDelay)},this.updatedSettingsForWorkerThread=e=>{const{workerDiagnosticsEventQueueMaxSize:t,enableWorkerStoreDiagnosticsLogsInIDB:i,workerDiagnosticsLogBufferArraySize:n,workerDiagnosticsLogsIDBObjectCount:o,logsMarkInterval:r,savingLogsIntoIDBThrottleTime:s,throttleCapacity:a,throttleWindowSizeMs:l,clientExtendedDiagnosticsData:c,disableExtendedDiagnosticsDataToggle:d,diagnosticsLogsThrottling:u,consoleLogLevel:m,loggerReportTimeInterval:g,loggerReportCountInterval:h,loggerThrottleList:p}=e;this.updateSettingsForLogger({durationForCountingLogLines:r||0,loggerReportTimeInterval:g||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:h||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:l||0,throttleCapacity:a||0,isUserEnableIDBLogs:!!c&&!d,diagnosticsLogsThrottling:u||"DryRunQuiet",throttleLoggers:new Set(p||[]),consoleLogLevel:this.validateConsoleLogLevel(m||"")});const v=(0,L.isNumber)(s)?s:void 0,y=(0,L.isNumber)(t)?t:0;this.memoryBufferArraySize=i&&(0,L.isNumber)(n)?n:y,this.diagnosticsEvents.setCapacity({bufferSize:this.memoryBufferArraySize,enableIndexedDB:(0,L.isUndefined)(i)?void 0:!!i,IDBObjectCount:(0,L.isNumber)(o)?o:0,throttleTime:v,clientEnableExtendedLogs:(0,L.isUndefined)(c)?void 0:!!c&&!d})},this.attemptToSetHost(),this.scenarioFactory=I(!1),void 0!==this.userECSConsoleLogLevel?this.loggerSettings.consoleLogLevel=this.userECSConsoleLogLevel:void 0!==n&&(this.loggerSettings.consoleLogLevel=n),this.diagnosticsEvents=new q(this.sessionId,this._defaultMainBufferLength),this.isErrorDiagnosticsEnabled=!1,this.errorDiagnosticsEvents=new D(!0,this.sessionId,this.host),(null===(r=this.host)||void 0===r?void 0:r.addEventListener)&&this.host.addEventListener("unload",(()=>{var e;this._clearPreviousSessionLogsTimer&&(null===(e=this.host)||void 0===e||e.clearTimeout(this._clearPreviousSessionLogsTimer)),this.persistDiagnosticsAsPreviousSessionLogs()}))}setScenarioFactory(e){var t;this.coreScenarioFactory=e,this.scenarioFactory.setScenarioFactory(e),this.diagnosticsEvents.setScenarioFactory(e),null===(t=this.extendedStorage)||void 0===t||t.setScenarioFactory(e),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setScenarioFactory(e)}))}setScheduler(e){}setLogsCountReporter(e){this._logsCountReporter||(this._logsCountReporter=e,this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setLogsCountReporter(e)})))}setALTDone(){var e;this._ALTCompleted||(this._ALTCompleted=!0,this.addAndInitExtendedStorage(),this._userID===x.$J&&(null===(e=this.host)||void 0===e?void 0:e.localStorage)&&this.cleanAllPreviousSessionLogsWithDelay(this.host),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>e.setALTDone())))}subscribeToCoreSettings(e){e.getObservable(b.J.Diagnostics).subscribe((e=>{this.extendedStoreName===n.DiagnosticsLogsWorker?this.updatedSettingsForWorkerThread(e):(this.updatedSettingsForMainThread(e),this.userDiagnosticsMap.size>0&&this.userDiagnosticsMap.forEach(((t,i)=>{this._firstUserID===i?t.updatedSettingsForMainThread(Object.assign(Object.assign({},e),{userPreviousSessionLogsLength:e.firstUserPreviousSessionLogsLength})):t.updatedSettingsForMainThread(e)})))})),this.logCountReporter&&this.logCountReporter.subscribeToCoreSettings(e)}updateDiagnosticInfo(e,t,i){e&&(this.tId=e),t&&(this.oId=t),i&&(this._userID=i),this.addAndInitExtendedStorage(),this.errorDiagnosticsEvents.setDBInfo(e,t,i)}handleUserLogout(e){var t;if(e){const i=this.userDiagnosticsMap.get(e);if(i){this.userDiagnosticsMap.delete(e);let t=Promise.resolve();return 0===this.userDiagnosticsMap.size&&(t=this.cleanLogsStorage()),Promise.all([i.handleUserLogout(e),t]).then()}this._clearPreviousSessionLogsTimer&&(null===(t=this.host)||void 0===t||t.clearTimeout(this._clearPreviousSessionLogsTimer))}return this.cleanLogsStorage()}createUserDiagnosticsService(e,t,i){if(this.extendedStoreName===n.DiagnosticsLogsWorker||this._userID&&this._userID!==x.$J)this.pushDiagnosticsEvent(T.i.Error,"DiagnosticsService: createUserDiagnosticsService function should only be called from the coreDiagnosticsService in the main thread",!0);else if(e&&t&&i){this._userID||this.updateDiagnosticInfo(x.zB,x.m0,x.$J),this._firstUserID||(this._firstUserID=i);let n=this.userDiagnosticsMap.get(i);return void 0===n&&(n=new J(this.sessionId,this.experienceName,this.extendedStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel),n.updateDiagnosticInfo(e,t,i),this.diagnosticsSettings&&(this._firstUserID===i?n.updatedSettingsForMainThread(Object.assign(Object.assign({},this.diagnosticsSettings),{userPreviousSessionLogsLength:this.diagnosticsSettings.firstUserPreviousSessionLogsLength})):n.updatedSettingsForMainThread(this.diagnosticsSettings)),this.coreScenarioFactory&&n.setScenarioFactory(this.coreScenarioFactory),this._logsCountReporter&&n.setLogsCountReporter(this._logsCountReporter),this._ALTCompleted&&n.setALTDone(),this.userDiagnosticsMap.set(i,n)),n}}pushDiagnosticsEvent(e,t,i,n){const o=(0,x.hR)(this.diagnosticsEvents,e,t,i,n,!1);e===T.i.Error&&this.isErrorDiagnosticsEnabled&&this.errorDiagnosticsEvents.addEvent(o,!1)}getDiagnosticsEvents(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let t=[];const i=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetLogs);try{t=(yield this.diagnosticsEvents.getAllEvents(e))||[]}catch(e){const t=`DiagnosticsService: Failed to fetch diagnostic logs: ${e}`;this.pushDiagnosticsEvent(T.i.Error,t,!0),null==i||i.fail({reason:t})}try{t=t.reverse(),null==i||i.stop()}catch(e){null==i||i.fail({reason:"Logs events array failed on reverting and sorting"})}return t}))}persistDiagnostics(){}getLogsFiles(e,t=0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){t>0&&t<this._minLogsInLogFile&&(t=this._minLogsInLogFile);const i="No logs found",n="Logging of this type is not enabled";let o="",r="",s=this.isErrorDiagnosticsEnabled&&(yield this.errorDiagnosticsEvents.getAllEvents())||[];s=(e?(0,x.Ij)(s):s).reverse();let a=(0,x.Mf)(s.slice(0,this._defaultLatestErrorCount));a&&(a=`Latest errors for ${this._userID}\r\n${a}`),this.isErrorDiagnosticsEnabled?(r=this.getPreviousSessionDiagnosticsLogsString(!0,e),o=(0,x.Mf)(s)):(r=n,o=n);const l=this.getPreviousSessionDiagnosticsLogsString(!1,e),c=yield this.getDiagnosticsLogs(!!e,t),d=x.$J===this._userID?void 0:this._userID;return Promise.resolve([Object.assign({isPiiFree:!!e,fileName:"diagnostics-error-logs-previous-session.txt",content:r||i},d?{userId:d}:{}),Object.assign({isPiiFree:!!e,fileName:"diagnostics-logs-previous-session.txt",content:l||i},d?{userId:d}:{}),Object.assign({isPiiFree:!!e,fileName:"diagnostics-error-logs.txt",content:o||i},d?{userId:d}:{}),Object.assign({isPiiFree:!!e,fileName:"diagnostics-logs.txt",content:c||i},d?{userId:d}:{}),Object.assign({isPiiFree:!!e,fileName:"latestErrors",content:a},d?{userId:d}:{})])}))}getSystemInfo(){return Promise.resolve(new Map)}get loggerSettings(){return this._loggerSettings}get logScheduler(){}get userId(){return this._userID!==x.$J?this._userID:""}get logCountReporter(){return this._logsCountReporter}persistDiagnosticsAsPreviousSessionLogs(){var e,t;if(!this.logsStoredAsPreviousSession&&(this.logsStoredAsPreviousSession=!0,null===(e=this.host)||void 0===e?void 0:e.localStorage)){const e=this.experienceName===this.rwcExperienceName?this._userID||x.$J:void 0,i=this.experienceName===this.rwcExperienceName?this.sessionId:void 0,n=e===x.$J?this._maxCorePreviousSessionLogsLength:this._maxUserPreviousSessionLogsLength;if(n<0)return;const o=this.diagnosticsEvents.getBufferedEvents(n);o.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,o,(0,x.IB)(e),i);const r=(null===(t=this.errorDiagnosticsEvents)||void 0===t?void 0:t.getBufferedEvents(n))||[];r.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,r,(0,x.IB)(e,!0),i),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnosticsAsPreviousSessionLogs()}))}}persistLogsWithErrorHandle(e,t,i,n){try{(0,x.NF)(e,t,i,n,!this._disableGzipPreviousSessionLogs)}catch(e){this.pushDiagnosticsEvent(T.i.Error,`DiagnosticsService: window_localstorage save logs failure, ${null==e?void 0:e.name}`,!0)}}enableExtendedStorage(){return this.ecsEnableIDBLogs||this.isUserEnableIDBLogs}getDiagnosticsLogs(e,t=0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.getDiagnosticsEvents(t),n=(0,x.Mf)(e?(0,x.Ij)(i):i),o=`Note: only ${this.memoryBufferArraySize||2e3} most recent logs are guaranteed to be shown due to the way logs are stored. Previous logs may have been removed\n`;return n?o+n:n}))}attemptToSetHost(){try{this.host=(0,F.J)()}catch(e){}}cleanLogsStorage(){var e;return(null===(e=this.host)||void 0===e?void 0:e.localStorage)&&((0,x.uD)(this.host.localStorage,this._userID),this._userID===x.$J&&((0,x.uD)(this.host.localStorage,""),(0,x.e2)(this.host.localStorage))),Promise.all([this.diagnosticsEvents.handleUserLogout(),this.errorDiagnosticsEvents.handleUserLogout()]).then()}updateSettingsForLogger(e){this._loggerSettings.durationForCountingLogLines=this.validateSettingNumberValue(e.durationForCountingLogLines,this._minDurationForCountingLogLines,this._loggerSettings.durationForCountingLogLines),this._loggerSettings.throttleCapacity=this.validateSettingNumberValue(e.throttleCapacity,this._minThrottleWindowCapacity,this._loggerSettings.throttleCapacity),this._loggerSettings.throttleWindowSize=this.validateSettingNumberValue(e.throttleWindowSize,this._minThrottleWindowSize,this._loggerSettings.throttleWindowSize),this._loggerSettings.isUserEnableIDBLogs=e.isUserEnableIDBLogs,this._loggerSettings.diagnosticsLogsThrottling=e.diagnosticsLogsThrottling,void 0===this.userECSConsoleLogLevel&&void 0!==e.consoleLogLevel&&null!==e.consoleLogLevel&&(this._loggerSettings.consoleLogLevel=e.consoleLogLevel),this._loggerSettings.loggerReportTimeInterval=this.validateSettingNumberValue(e.loggerReportTimeInterval,this._minLoggerReportTimeInterval,this._loggerSettings.loggerReportTimeInterval),this._loggerSettings.loggerReportCountInterval=this.validateSettingNumberValue(e.loggerReportCountInterval,this._minLoggerReportCountInterval,this._loggerSettings.loggerReportCountInterval),this._loggerSettings.throttleLoggers=e.throttleLoggers}validateSettingNumberValue(e,t,i,n=!0){return(0,L.isNumber)(e)&&(n&&e===t||e>t)?e:i}validateConsoleLogLevel(e){if(this.isValidLoglevel(e))return T.i[e]}isValidLoglevel(e){return Object.keys(T.i).includes(e)}getPreviousSessionDiagnosticsLogsString(e,t){var i;let n="";if(null===(i=this.host)||void 0===i?void 0:i.localStorage){const i=this.experienceName===this.rwcExperienceName?this._userID||x.$J:void 0,o=(0,x.IB)(i,e);n=(0,x.gE)(this.host.localStorage,o,!!t)}return n||"No logs found"}addAndInitExtendedStorage(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if((this.isUserEnableIDBLogs||this.ecsEnableIDBLogs)&&this._ALTCompleted&&this.host&&"None"!==this.extendedStorageType){const e=this.getDBName();if(!this.extendedStorage&&e){const t=this.host.indexedDB;let i;if("OriginPrivateFileSystem"===this.extendedStorageType&&"navigator"in this.host?i=new G(this.host,e,this.sessionId):"IndexedDB"===this.extendedStorageType&&"indexedDB"in this.host&&(i=new V(t,e,this.sessionId)),void 0===i)return;if(this.coreScenarioFactory&&i.setScenarioFactory(this.coreScenarioFactory),this.diagnosticsSettings){const{diagnosticsLogsIDBObjectCount:e}=this.diagnosticsSettings;i.setCapacity((0,L.isNumber)(e)?e:0)}this.extendedStorage=i,this.diagnosticsEvents.setExtendedStorage(i)}if(this.extendedStorage&&!this.extendedStorage.isStorageEnabled){(yield this.extendedStorage.initialize())&&this.fetchAndPersistPreviuosSessionLogs()}}}))}fetchAndPersistPreviuosSessionLogs(){var e,t,i;if((null===(e=this.extendedStorage)||void 0===e?void 0:e.isStorageEnabled)&&this._userID&&(null===(t=this.host)||void 0===t?void 0:t.localStorage)){const e=(0,x.IB)(this._userID),t=(0,x.Tx)(this.host.localStorage,e,!1);t&&t.sessionId&&(null===(i=t.logsArray)||void 0===i?void 0:i.length)>0&&(this.extendedStorage.storeLogs(t.logsArray,t.sessionId,t.logsArray[t.logsArray.length-1].timeStamp.getTime(),"force"),(0,x.uD)(this.host.localStorage,this._userID))}}getDBName(){return this.tId&&this.oId&&this.experienceName&&this.sessionId?`Teams:${this.extendedStoreName}:${this.experienceName}:${this.tId}:${this.oId}`:""}cleanAllPreviousSessionLogsWithDelay(e){this._clearPreviousSessionLogsTimer=e.setTimeout((()=>{(0,x.yQ)(e)}),this._cleanPreviousSessionLogsDelay)}}class K{constructor(e,t,i,o,r){var s;this.sessionId=e,this.experienceName=t,this.dbStoreName=i,this.defaultPreECSConsoleLogLevel=o,this.userECSConsoleLogLevel=r,this.diagnosticsBackupEnabled=!1,this.allowPersistUncaughtErrorLogs=!1,this.userDiagnosticsMap=new Map,this._userID="",this.memoryBufferArraySize=0,this._minDurationForCountingLogLines=20,this._minThrottleWindowSize=1e4,this._minThrottleWindowCapacity=5,this._minLoggerReportTimeInterval=1e4,this._minLoggerReportCountInterval=30,this._minLogsInLogFile=500,this._ALTCompleted=!1,this.rwcExperienceName="react-web-client",this.logsStoredAsPreviousSession=!1,this._enableScheduler=!1,this._enableSchedulerBeforeALT=!1,this._disableGzipPreviousSessionLogs=!1,this._forceUsingV1Service=!1,this._cleanPreviousSessionLogsDelay=18e4,this._clearPreviousSessionLogsTimer=0,this._firstUserID="",this._loggerSettings={durationForCountingLogLines:0,loggerReportTimeInterval:0,loggerReportCountInterval:0,diagnosticsLogsThrottling:"DryRunQuiet",isUserEnableIDBLogs:!1,throttleWindowSize:0,throttleCapacity:0,consoleLogLevel:T.i.Error,throttleLoggers:new Set},this._defaultLatestErrorCount=5,this._maxCorePreviousSessionLogsLength=0,this._maxUserPreviousSessionLogsLength=0,this.logsProviderName=y.DIAGNOSTICSSERVICE,this.updatedSettingsForMainThread=e=>{this.diagnosticsSettings=e,this.updateSettingsForLogger({durationForCountingLogLines:e.logsMarkInterval||0,loggerReportTimeInterval:e.loggerReportTimeInterval||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:e.loggerReportCountInterval||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:e.throttleWindowSizeMs||0,throttleCapacity:e.throttleCapacity||0,isUserEnableIDBLogs:!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle,diagnosticsLogsThrottling:e.diagnosticsLogsThrottling||"DryRunQuiet",throttleLoggers:new Set(e.loggerThrottleList||[]),consoleLogLevel:this.validateConsoleLogLevel(e.consoleLogLevel||"")}),this.setDiagnosticsBackupEnabled(!!e.enableDiagnosticsBackup,e.diagnosticsBackupSyncCycleMs||void 0);const t=(0,L.isNumber)(e.savingLogsIntoIDBThrottleTime)?e.savingLogsIntoIDBThrottleTime:void 0,i=(0,L.isNumber)(e.diagnosticsEventQueueMaxSize)?e.diagnosticsEventQueueMaxSize:0;if(void 0===e.enableStoreDiagnosticsLogsInIDB&&void 0===e.clientExtendedDiagnosticsData)i&&this.diagnosticsEvents.setCapacity({bufferSize:i,throttleTime:t});else{const n=e.enableStoreDiagnosticsLogsInIDB?(0,L.isNumber)(e.diagnosticsLogBufferArraySize)?e.diagnosticsLogBufferArraySize:0:i;this.diagnosticsEvents.setCapacity({enableIndexedDB:(0,L.isUndefined)(e.enableStoreDiagnosticsLogsInIDB)?void 0:!!e.enableStoreDiagnosticsLogsInIDB,bufferSize:n,IDBObjectCount:(0,L.isNumber)(e.diagnosticsLogsIDBObjectCount)?e.diagnosticsLogsIDBObjectCount:0,throttleTime:t,clientEnableExtendedLogs:(0,L.isUndefined)(e.clientExtendedDiagnosticsData)?void 0:!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle,IDBFetchingTimeoutMs:(0,L.isNumber)(e.IDBFetchingTimeoutMs)?e.IDBFetchingTimeoutMs:0})}this._enableScheduler=!!e.enableSchedulerOnLoggers,this._enableSchedulerBeforeALT=!!e.enableSchedulerOnLoggersBeforeALT,this._disableGzipPreviousSessionLogs=!!e.disableGzipPreviousSessionLogs,this.isErrorDiagnosticsEnabled=!!e.errorDiagnosticsEventQueueMaxSize,this.allowPersistUncaughtErrorLogs=!!e.allowPersistUncaughtErrorLogs,this._forceUsingV1Service=!!e.forceUsingV1Service,this._maxCorePreviousSessionLogsLength=this.validateSettingNumberValue(e.corePreviousSessionLogsLength,-1,this._maxCorePreviousSessionLogsLength),this._maxUserPreviousSessionLogsLength=this.validateSettingNumberValue(e.userPreviousSessionLogsLength,-1,this._maxUserPreviousSessionLogsLength),this._cleanPreviousSessionLogsDelay=this.validateSettingNumberValue(e.clearPreviousSessionLogsDelayMs,0,this._cleanPreviousSessionLogsDelay),this.isErrorDiagnosticsEnabled?(0,L.isNumber)(e.errorDiagnosticsEventQueueMaxSize)&&this.errorDiagnosticsEvents.setCapacity({bufferSize:e.errorDiagnosticsEventQueueMaxSize,throttleTime:t}):this.errorDiagnosticsEvents=new D(!0,this.sessionId,this.host,this._defaultLatestErrorCount)},this.updatedSettingsForWorkerThread=e=>{const{workerDiagnosticsEventQueueMaxSize:t,enableWorkerStoreDiagnosticsLogsInIDB:i,workerDiagnosticsLogBufferArraySize:n,workerDiagnosticsLogsIDBObjectCount:o,logsMarkInterval:r,savingLogsIntoIDBThrottleTime:s,throttleCapacity:a,throttleWindowSizeMs:l,clientExtendedDiagnosticsData:c,disableExtendedDiagnosticsDataToggle:d,diagnosticsLogsThrottling:u,consoleLogLevel:m,loggerReportTimeInterval:g,loggerReportCountInterval:h,loggerThrottleList:p}=e;this.updateSettingsForLogger({durationForCountingLogLines:r||0,loggerReportTimeInterval:g||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:h||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:l||0,throttleCapacity:a||0,isUserEnableIDBLogs:!!c&&!d,diagnosticsLogsThrottling:u||"DryRunQuiet",throttleLoggers:new Set(p||[]),consoleLogLevel:this.validateConsoleLogLevel(m||"")});const v=(0,L.isNumber)(s)?s:void 0,y=(0,L.isNumber)(t)?t:0;this.memoryBufferArraySize=i&&(0,L.isNumber)(n)?n:y,this.diagnosticsEvents.setCapacity({bufferSize:this.memoryBufferArraySize,enableIndexedDB:(0,L.isUndefined)(i)?void 0:!!i,IDBObjectCount:(0,L.isNumber)(o)?o:0,throttleTime:v,clientEnableExtendedLogs:(0,L.isUndefined)(c)?void 0:!!c&&!d})},this.attemptToSetHost(),this.scenarioFactory=I(!1),void 0!==this.userECSConsoleLogLevel?this.loggerSettings.consoleLogLevel=this.userECSConsoleLogLevel:void 0!==o&&(this.loggerSettings.consoleLogLevel=o),this.sessionId&&t&&i===n.DiagnosticsLogsMain?this.diagnosticsEvents=new B(this.host,t,i,this.sessionId):t&&i===n.DiagnosticsLogsWorker&&this.sessionId?this.diagnosticsEvents=new H(this.sessionId):this.diagnosticsEvents=new D(!1,this.sessionId,this.host),this.isErrorDiagnosticsEnabled=!1,this.errorDiagnosticsEvents=new D(!0,this.sessionId,this.host),this.diagnosticsBackupService=void 0,(null===(s=this.host)||void 0===s?void 0:s.addEventListener)&&this.host.addEventListener("unload",(()=>{var e;this._clearPreviousSessionLogsTimer&&(null===(e=this.host)||void 0===e||e.clearTimeout(this._clearPreviousSessionLogsTimer)),this.persistDiagnosticsAsPreviousSessionLogs()})),t!==this.rwcExperienceName&&this.loadDiagnosticsFromLocalStorage(!0)}setScenarioFactory(e){this.coreScenarioFactory=e,this.scenarioFactory.setScenarioFactory(e),this.diagnosticsEvents.setScenarioFactory(e),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setScenarioFactory(e)}))}setScheduler(e){this._scheduler||(this._scheduler=e,this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setScheduler(e)})))}setLogsCountReporter(e){this._logsCountReporter||(this._logsCountReporter=e,this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setLogsCountReporter(e)})))}setALTDone(){var e,t,i;if(!this._ALTCompleted){if(this._ALTCompleted=!0,this.diagnosticsEvents.setALTDone(),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>e.setALTDone())),this._userID===x.$J&&(null===(e=this.host)||void 0===e?void 0:e.localStorage)){if(!(null===(t=this.diagnosticsSettings)||void 0===t?void 0:t.skipCleanInvalidPreSessionLogs)){const e=Array.from(this.userDiagnosticsMap.keys());(0,x.OO)(this.host.localStorage,[...e,x.$J])}this.cleanAllPreviousSessionLogsWithDelay(this.host)}this._userID===x.$J&&this.experienceName===this.rwcExperienceName&&(null===(i=this.host)||void 0===i?void 0:i.localStorage)&&(0,x.e2)(this.host.localStorage)}}subscribeToCoreSettings(e){if(!e)return void this.pushDiagnosticsEvent(T.i.Error,"DiagnosticsService: Failed to subscribe to core settings",!0);e.getObservable(b.J.Diagnostics).subscribe((e=>{this.dbStoreName===n.DiagnosticsLogsWorker?this.updatedSettingsForWorkerThread(e):(this.updatedSettingsForMainThread(e),this.userDiagnosticsMap.size>0&&this.userDiagnosticsMap.forEach(((t,i)=>{this._firstUserID===i?t.updatedSettingsForMainThread(Object.assign(Object.assign({},e),{userPreviousSessionLogsLength:e.firstUserPreviousSessionLogsLength})):t.updatedSettingsForMainThread(e)})))})),this.logCountReporter&&this.logCountReporter.subscribeToCoreSettings(e)}updateDiagnosticInfo(e,t,i){i&&(this._userID=i),this.diagnosticsEvents.setDBInfo(e,t,i),this.errorDiagnosticsEvents.setDBInfo(e,t,i)}handleUserLogout(e){var t;if(e){const i=this.userDiagnosticsMap.get(e);if(i){this.userDiagnosticsMap.delete(e);let t=Promise.resolve();return 0===this.userDiagnosticsMap.size&&(t=this.cleanLogsStorage()),Promise.all([i.handleUserLogout(e),t]).then()}this._clearPreviousSessionLogsTimer&&(null===(t=this.host)||void 0===t||t.clearTimeout(this._clearPreviousSessionLogsTimer))}return this.cleanLogsStorage()}createUserDiagnosticsService(e,t,i){if(this.dbStoreName===n.DiagnosticsLogsWorker||this._userID&&this._userID!==x.$J)this.pushDiagnosticsEvent(T.i.Error,"DiagnosticsService: createUserDiagnosticsService function should only be called from the coreDiagnosticsService in the main thread",!0);else if(e&&t&&i){this._userID||this.updateDiagnosticInfo(x.zB,x.m0,x.$J),this._firstUserID||(this._firstUserID=i);let n=this.userDiagnosticsMap.get(i);return n||(n=this.experienceName!==this.rwcExperienceName||this._forceUsingV1Service?new K(this.sessionId||"",this.experienceName,this.dbStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel):new J(this.sessionId||"",this.experienceName,this.dbStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel),n.updateDiagnosticInfo(e,t,i),this.diagnosticsSettings&&(this._firstUserID===i?n.updatedSettingsForMainThread(Object.assign(Object.assign({},this.diagnosticsSettings),{userPreviousSessionLogsLength:this.diagnosticsSettings.firstUserPreviousSessionLogsLength})):n.updatedSettingsForMainThread(this.diagnosticsSettings)),this.coreScenarioFactory&&n.setScenarioFactory(this.coreScenarioFactory),this._scheduler&&n.setScheduler(this._scheduler),this._logsCountReporter&&n.setLogsCountReporter(this._logsCountReporter),this._ALTCompleted&&n.setALTDone(),this.userDiagnosticsMap.set(i,n),n)}}pushDiagnosticsEvent(e,t,i,n,o=!1){const r=(0,x.hR)(this.diagnosticsEvents,e,t,i,n,o);e===T.i.Error&&this.errorDiagnosticsEvents.addEvent(r,o),this.diagnosticsBackupEnabled&&this.diagnosticsBackupService&&this.diagnosticsBackupService.pushDiagnosticsEvent(r)}getDiagnosticsEvents(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let t=[];const i=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetLogs);try{t=(yield this.diagnosticsEvents.getAllEvents(e))||[]}catch(e){const t=`DiagnosticsService: Failed to fetch diagnostic logs: ${e}`;this.pushDiagnosticsEvent(T.i.Error,t,!0),null==i||i.fail({reason:t})}try{t=t.reverse(),null==i||i.stop()}catch(e){null==i||i.fail({reason:"Logs events array failed on reverting and sorting"})}return t}))}persistDiagnostics(){this.experienceName!==this.rwcExperienceName&&this.allowPersistUncaughtErrorLogs&&(this.diagnosticsEvents.persistLogs(),this.errorDiagnosticsEvents.persistLogs(),this.diagnosticsBackupEnabled&&this.diagnosticsBackupService&&this.diagnosticsBackupService.flush(),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnostics()})))}getLogsFiles(e,t=0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){t>0&&t<this._minLogsInLogFile&&(t=this._minLogsInLogFile);const i="No logs found",n="Logging of this type is not enabled";let o="",r="",s=(yield this.errorDiagnosticsEvents.getAllEvents())||[];s=(e?(0,x.Ij)(s):s).reverse();let a=(0,x.Mf)(s.slice(0,this._defaultLatestErrorCount));a&&(a=`Latest errors for ${this._userID}\r\n${a}`),this.isErrorDiagnosticsEnabled?(r=this.getPreviousSessionDiagnosticsLogsString(!0,e),o=(0,x.Mf)(s)):(r=n,o=n);const l=this.getPreviousSessionDiagnosticsLogsString(!1,e),c=yield this.getDiagnosticsLogs(!!e,t),d=x.$J===this._userID?void 0:this._userID;return Promise.resolve([Object.assign({isPiiFree:!1,fileName:"diagnostics-error-logs-previous-session.txt",content:r||i},d?{userId:d}:{}),Object.assign({isPiiFree:!1,fileName:"diagnostics-logs-previous-session.txt",content:l||i},d?{userId:d}:{}),Object.assign({isPiiFree:!1,fileName:"diagnostics-error-logs.txt",content:o||i},d?{userId:d}:{}),Object.assign({isPiiFree:!1,fileName:"diagnostics-logs.txt",content:c||i},d?{userId:d}:{}),Object.assign({isPiiFree:!1,fileName:"latestErrors",content:a},d?{userId:d}:{})])}))}getSystemInfo(){return Promise.resolve(new Map)}get loggerSettings(){return this._loggerSettings}get logScheduler(){if(this._enableScheduler&&(this._enableSchedulerBeforeALT||this._ALTCompleted))return this._scheduler}get userId(){return this._userID!==x.$J?this._userID:""}get logCountReporter(){return this._logsCountReporter}setWorkerLogsDataManager(e){"setWorkerLogsDataManager"in this.diagnosticsEvents&&this.diagnosticsEvents.setWorkerLogsDataManager(e)}persistDiagnosticsAsPreviousSessionLogs(){var e;if(!this.logsStoredAsPreviousSession&&(this.logsStoredAsPreviousSession=!0,null===(e=this.host)||void 0===e?void 0:e.localStorage)){const e=this.experienceName===this.rwcExperienceName?this._userID||x.$J:void 0,t=this.experienceName===this.rwcExperienceName?this.sessionId:void 0,i=e===x.$J?this._maxCorePreviousSessionLogsLength:this._maxUserPreviousSessionLogsLength;if(i<0)return;const n=this.diagnosticsEvents.getBufferedEvents(i);n.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,n,(0,x.IB)(e),t);const o=this.errorDiagnosticsEvents.getBufferedEvents(i);o.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,o,(0,x.IB)(e,!0),t),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnosticsAsPreviousSessionLogs()}))}}persistLogsWithErrorHandle(e,t,i,n){try{(0,x.NF)(e,t,i,n,!this._disableGzipPreviousSessionLogs)}catch(e){this.pushDiagnosticsEvent(T.i.Error,`DiagnosticsService: window_localstorage save logs failure, ${null==e?void 0:e.name}`,!0)}}setDiagnosticsBackupEnabled(e,t){var i,n,o;this.diagnosticsBackupEnabled=e,e?!this.diagnosticsBackupService&&(null===(i=this.host)||void 0===i?void 0:i.opener)&&(null===(n=this.host)||void 0===n?void 0:n.setTimeout)&&(null===(o=this.host)||void 0===o?void 0:o.clearTimeout)&&(this.diagnosticsBackupService=new R(this.host.opener,this.host.setTimeout,this.host.clearTimeout,t)):this.diagnosticsBackupService&&(this.diagnosticsBackupService.dispose(),this.diagnosticsBackupService=void 0)}getDiagnosticsLogs(e,t=0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.getDiagnosticsEvents(t),n=(0,x.Mf)(e?(0,x.Ij)(i):i),o=`Note: only ${this.memoryBufferArraySize||2e3} most recent logs are guaranteed to be shown due to the way logs are stored. Previous logs may have been removed\n`;return n?o+n:n}))}attemptToSetHost(){try{this.host=(0,F.J)()}catch(e){}}loadDiagnosticsFromLocalStorage(e=!0){var t;if((null===(t=this.host)||void 0===t?void 0:t.localStorage)&&this.experienceName!==this.rwcExperienceName){const t=this.scenarioFactory.newScenario(U.RG.DiagnosticsGetLogsFromLocalStorage);try{(0,x.UL)(this.diagnosticsEvents,this.host.localStorage,(0,x.yN)(),e),(0,x.UL)(this.errorDiagnosticsEvents,this.host.localStorage,(0,x.yN)(void 0,!0),e),null==t||t.stop()}catch(e){const i=`DiagnosticsService: Failed to load persisted logs from store with error: ${e}`;this.pushDiagnosticsEvent(T.i.Error,i,!0),null==t||t.fail({reason:i})}}}cleanLogsStorage(){var e,t,i;return(null===(e=this.host)||void 0===e?void 0:e.localStorage)&&((0,x.uD)(null===(t=this.host)||void 0===t?void 0:t.localStorage,this.userId),this.userId===x.$J&&(0,x.uD)(null===(i=this.host)||void 0===i?void 0:i.localStorage,"")),Promise.all([this.diagnosticsEvents.handleUserLogout(),this.errorDiagnosticsEvents.handleUserLogout()]).then()}updateSettingsForLogger(e){this._loggerSettings.durationForCountingLogLines=this.validateSettingNumberValue(e.durationForCountingLogLines,this._minDurationForCountingLogLines,this._loggerSettings.durationForCountingLogLines),this._loggerSettings.throttleCapacity=this.validateSettingNumberValue(e.throttleCapacity,this._minThrottleWindowCapacity,this._loggerSettings.throttleCapacity),this._loggerSettings.throttleWindowSize=this.validateSettingNumberValue(e.throttleWindowSize,this._minThrottleWindowSize,this._loggerSettings.throttleWindowSize),this._loggerSettings.isUserEnableIDBLogs=e.isUserEnableIDBLogs,this._loggerSettings.diagnosticsLogsThrottling=e.diagnosticsLogsThrottling,void 0===this.userECSConsoleLogLevel&&void 0!==e.consoleLogLevel&&null!==e.consoleLogLevel&&(this._loggerSettings.consoleLogLevel=e.consoleLogLevel),this._loggerSettings.loggerReportTimeInterval=this.validateSettingNumberValue(e.loggerReportTimeInterval,this._minLoggerReportTimeInterval,this._loggerSettings.loggerReportTimeInterval),this._loggerSettings.loggerReportCountInterval=this.validateSettingNumberValue(e.loggerReportCountInterval,this._minLoggerReportCountInterval,this._loggerSettings.loggerReportCountInterval),this._loggerSettings.throttleLoggers=e.throttleLoggers}validateSettingNumberValue(e,t,i,n=!0){return(0,L.isNumber)(e)&&(n&&e===t||e>t)?e:i}validateConsoleLogLevel(e){if(Object.keys(T.i).includes(e))return T.i[e]}getPreviousSessionDiagnosticsLogsString(e,t){var i;let n="";if(null===(i=this.host)||void 0===i?void 0:i.localStorage){const i=this.experienceName===this.rwcExperienceName?this._userID||x.$J:void 0,o=(0,x.IB)(i,e);n=(0,x.gE)(this.host.localStorage,o,!!t)}return n||"No logs found"}cleanAllPreviousSessionLogsWithDelay(e){this._clearPreviousSessionLogsTimer=e.setTimeout((()=>{(0,x.yQ)(e)}),this._cleanPreviousSessionLogsDelay)}}var Q=i(137021);class Y{constructor(e){this.globalContext=e,this.reportIntervalHandler=0,this.minReportTimeInterval=6e4,this.minReportCountInterval=200,this.minReportErrorCountInterval=10,this.reportTimeInterval=0,this.reportCountInterval=0,this.reportErrorCountInterval=0,this.lastReportTime=Date.now(),this.totalLogsCountFromLastReport=0,this.errorLogsCountFromLastReport=0,this.logsCountMap=new Map}updateLogsCounts(e){for(const[t,i]of e)this.updateLogsCountForOneLogger(t,i)}updateLogsCountForOneLogger(e,t){this.startTimer();const i=this.logsCountMap.get(e);i?(i.total+=t.total,i.error+=t.error,i.diagnostics+=t.diagnostics,i.throttled+=t.throttled):this.logsCountMap.set(e,Object.assign({},t)),this.totalLogsCountFromLastReport+=t.total,this.errorLogsCountFromLastReport+=t.error}subscribeToCoreSettings(e){if(this.coreSettingsSubscription)return;const t=e.getObservable(b.J.Diagnostics,["logReporterSendCountInterval","logReporterSendTimeInterval","logReporterSendErrorCountInterval"]);this.coreSettingsSubscription=t.subscribe((e=>{if((0===e.logReporterSendCountInterval||(e.logReporterSendCountInterval||0)>=this.minReportCountInterval)&&(this.reportCountInterval=e.logReporterSendCountInterval||0),(0===e.logReporterSendErrorCountInterval||(e.logReporterSendErrorCountInterval||0)>=this.minReportErrorCountInterval)&&(this.reportErrorCountInterval=e.logReporterSendErrorCountInterval||0),0===e.logReporterSendTimeInterval||(e.logReporterSendTimeInterval||0)>=this.minReportTimeInterval){const t=e.logReporterSendTimeInterval||0;this.reportTimeInterval!==t&&(this.reportTimeInterval=t,this.reportIntervalHandler&&(this.globalContext.clearTimeout(this.reportIntervalHandler),this.reportIntervalHandler=0,this.startTimer()))}}))}reportLogsCount(){if(this.reportIntervalHandler=0,this.shouldReport()){const e=Date.now(),t=e-this.lastReportTime;this.lastReportTime=e,this.totalLogsCountFromLastReport=0,this.errorLogsCountFromLastReport=0;const i=this.logsCountMap;this.logsCountMap=new Map;const n=this.packLogsCountInfo(i);i.clear(),n&&(0,Q.MI)("logsCountInfo",{logsCountInfo:n,delta:t},"webclient_framework_logs_count_event")}}packLogsCountInfo(e){if(e.size>0){const t=[];for(const[i,n]of e)t.push({loggerName:i,total:n.total,error:n.error,diagnostics:n.diagnostics,throttled:n.throttled});return JSON.stringify(t)}return""}shouldReport(){return this.reportCountInterval>0&&this.reportTimeInterval>0&&this.reportErrorCountInterval>0&&(this.logsCountMap.size>0&&(this.totalLogsCountFromLastReport>=this.reportCountInterval||this.errorLogsCountFromLastReport>=this.reportErrorCountInterval))}startTimer(){0===this.reportIntervalHandler&&this.reportTimeInterval>0&&(this.reportIntervalHandler=this.globalContext.setTimeout((()=>this.reportLogsCount()),this.reportTimeInterval))}}var X=i(888418),Z=i(793989),ee=i(322910);class te{constructor(){this.debugLogging=""}initialize(e){this.logger=e,this.logger.debug("Telemetry Utility-Service initialized")}static getInstance(){return this.instance}}function ie(){return te.getInstance()}te.instance=new te;class ne{constructor(e,t,i,n="",o=""){var r;this.diagnosticsService=e,this.label=t,this.loggerName=i,this.contextId=n,this.userContextId=o,this.enableDebugLogging=!1,this.cidLabel="",this.logsCount=0,this.lastReportTime=0,this.throttleAllowance=0,this.currentWindow=0,this.throttledCount=0,this.logsCountPerLoggerNameMap=new Map;try{const e=(0,F.J)();ie().debugLogging||(ie().debugLogging=null!==(r=e.localStorage.getItem("localDebug"))&&void 0!==r?r:"default"),this.enableDebugLogging="true"===ie().debugLogging}catch(e){}this.cidLabel=n?n.concat(" ",t):t}log(e,...t){return this.invoke(console.log,e,T.i.Info,!1,...t)}warn(e,...t){return this.invoke(console.warn,e,T.i.Warn,!1,...t)}error(e,...t){return this.invoke(console.error,e,T.i.Error,!1,...t)}debug(e,...t){return this.enableDebugLogging||this.consoleLogLevel>=T.i.Debug?this.invoke(console.debug,e,T.i.Debug,!1,...t):X.V.None}logNoPii(e,...t){return this.invoke(console.log,e,T.i.Info,!0,...t)}warnNoPii(e,...t){return this.invoke(console.warn,e,T.i.Warn,!0,...t)}errorNoPii(e,...t){return this.invoke(console.error,e,T.i.Error,!0,...t)}debugNoPii(e,...t){return this.enableDebugLogging||this.consoleLogLevel>=T.i.Debug?this.invoke(console.debug,e,T.i.Debug,!0,...t):X.V.None}errorToTelemetry(e,t,i,n){return this.toTelemetry(console.error,e,t,T.i.Error,i,n)}warnToTelemetry(e,t,i,n){return this.toTelemetry(console.warn,e,t,T.i.Warn,i,n)}debugToTelemetry(e,t,i,n){return this.toTelemetry(console.debug,e,t,T.i.Debug,i,n)}infoToTelemetry(e,t,i,n){return this.toTelemetry(console.log,e,t,T.i.Info,i,n)}sendToDiagnosticLogs(e,t,i,n,o,r,...s){if((0,ee.R3)(o,X.V.AddedIntoDiagnostics)||(0,ee.R3)(o,X.V.ThrottledForDiagnostics)){if((null==s?void 0:s.length)>0){e=`${e} ${s.map((e=>(0,M.XC)(e))).join(", ")}`}e=(0,M.LQ)(e),(0,ee.R3)(o,X.V.AddedIntoDiagnostics)?this.diagnosticsService.pushDiagnosticsEvent(t,e,r,i,n):["Enabled","EnabledQuiet"].includes(this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling)||this.diagnosticsService.pushDiagnosticsEvent(t,e,r,i,n)}}toTelemetry(e,t,i,n,o,r=!1){t=(0,M.LQ)(`${t}`);let s=X.V.SentToTelemetry;return r&&(s=(0,ee.Kx)(this.invoke(e,t,n,!0),X.V.SentToTelemetry)),(o=o||{}).message=t,o.logLevel=T.i[n],o.contextId=this.contextId,(0,Q.MI)(this.label,o,i,void 0,void 0,this.userContextId),s}invoke(e,t,i,n,...o){var r;const s=this.getLogResult(i);if(s!==X.V.None){let a=this.loggerName;if((null==o?void 0:o.length)>0&&o[0]&&"object"==typeof o[0]&&"loggerName"in o[0])try{a=o[0].loggerName,1===Object.keys(o[0]).length?o.shift():delete o[0].loggerName}catch(e){}if(this.increaseLogCount(i,s,a),t=`${this.cidLabel}: ${t}`,(0,ee.R3)(s,X.V.LoggedInConsole)){const i=this.diagnosticsService.userId;e.call(console,i?`[${i}] - ${t}`:t,...o)}if(i!==T.i.Error&&this.diagnosticsService.logScheduler)try{return null===(r=this.diagnosticsService.logScheduler)||void 0===r||r.schedule((()=>this.sendToDiagnosticLogs(t,i,new Date,!0,s,n,...o)),{priority:Z.vW.Background,id:"send-log-to-console-and-diagnostics",scheduledById:"logger"},""),s}catch(e){this.diagnosticsService.pushDiagnosticsEvent(T.i.Error,"Schedule logs failed",!0,new Date,!1)}this.sendToDiagnosticLogs(t,i,new Date,!1,s,n,...o)}return s}getLogResult(e){let t=X.V.None;return(e<=this.consoleLogLevel||this.enableDebugLogging)&&(t=(0,ee.Kx)(t,X.V.LoggedInConsole)),(e<T.i.Debug||e<=this.consoleLogLevel)&&!this.isLoggerThrottledForDiagnostics()&&(e===T.i.Error||this.diagnosticsService.loggerSettings.isUserEnableIDBLogs||!this.shouldThrottle()?t=(0,ee.Kx)(t,X.V.AddedIntoDiagnostics):(this.throttledCount++,t=(0,ee.Kx)(t,X.V.ThrottledForDiagnostics))),t}increaseLogCount(e,t,i){if(-1===this.diagnosticsService.loggerSettings.loggerReportCountInterval)this.updateCountToReporterForOneEvent(i,t,e);else{0===this.lastReportTime&&(this.lastReportTime=Date.now());let n=this.logsCountPerLoggerNameMap.get(i);void 0===n&&(n={total:0,error:0,diagnostics:0,throttled:0},this.logsCountPerLoggerNameMap.set(i,n)),this.logsCount++,n.total++,e===T.i.Error&&n.error++;((0,ee.R3)(t,X.V.AddedIntoDiagnostics)||(0,ee.R3)(t,X.V.ThrottledForDiagnostics))&&(n.diagnostics++,(0,ee.R3)(t,X.V.ThrottledForDiagnostics)&&(this.throttledCount++,n.throttled++)),this.updateLogsCountToReporter(e===T.i.Error)}}updateLogsCountToReporter(e){if(this.logsCount>0&&this.diagnosticsService.loggerSettings.loggerReportCountInterval>0&&this.diagnosticsService.loggerSettings.loggerReportTimeInterval>0&&this.diagnosticsService.logCountReporter){const t=Date.now();(t-this.lastReportTime>this.diagnosticsService.loggerSettings.loggerReportTimeInterval||this.logsCount>=this.diagnosticsService.loggerSettings.loggerReportCountInterval||e)&&(this.diagnosticsService.logCountReporter.updateLogsCounts(this.logsCountPerLoggerNameMap),this.logsCount=0,this.throttledCount=0,this.lastReportTime=t,this.logsCountPerLoggerNameMap=new Map)}}updateCountToReporterForOneEvent(e,t,i){if(this.diagnosticsService.logCountReporter){const n={total:1,error:0,diagnostics:0,throttled:0};((0,ee.R3)(t,X.V.AddedIntoDiagnostics)||(0,ee.R3)(t,X.V.ThrottledForDiagnostics))&&(n.diagnostics=1,(0,ee.R3)(t,X.V.ThrottledForDiagnostics)&&(n.throttled=1)),i===T.i.Error&&(n.error=1),this.diagnosticsService.logCountReporter.updateLogsCountForOneLogger(e,n)}}shouldThrottle(){const e=this.diagnosticsService.loggerSettings;if("Disabled"===e.diagnosticsLogsThrottling||0===e.throttleCapacity)return!1;const t=Date.now();return t-this.currentWindow>e.throttleWindowSize&&(this.sendThrottledCount(),this.currentWindow=t,this.throttleAllowance=e.throttleCapacity),this.throttleAllowance<1||(this.throttleAllowance-=1,!1)}sendThrottledCount(){if(!(this.throttledCount<1)&&["DryRun","Enabled"].includes(this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling)){const e="DryRun"===this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling?"would have been throttled":"were throttled",t=`${this.cidLabel}: ${this.throttledCount} logs ${e} from ${new Date(this.currentWindow).toISOString()}`;this.diagnosticsService.pushDiagnosticsEvent(T.i.Info,t,!0,new Date,!1)}}get consoleLogLevel(){const e=this.diagnosticsService.loggerSettings.consoleLogLevel;return void 0===e?T.i.Warn:e}isLoggerThrottledForDiagnostics(){var e,t,i;return!!this.loggerName&&(null===(i=null===(t=null===(e=this.diagnosticsService)||void 0===e?void 0:e.loggerSettings)||void 0===t?void 0:t.throttleLoggers)||void 0===i?void 0:i.has(this.loggerName))}}class oe{constructor(e,t,i=""){this.diagnosticsService=e,this.contextId=t,this.userContextId=i,this.newLogger=(e,t)=>{e=(0,M.LQ)(`${e}`);return new ne(this.diagnosticsService,e,t,this._contextId,this.userContextId)},this._contextId=t&&"00000000-0000-0000-0000-000000000000"!==t?(0,M.LQ)(`CID[${t}]`):""}get cID(){return this.contextId}notifyDiagnosticsALTDone(){this.diagnosticsService.setALTDone()}}var re=i(659726),se=i(905581),ae=i(540929),le=i(259429),ce=i(747862);const de=(e,t,i,n)=>(0,a.z)((0,le.fU)(((i,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return function(e,t,i,n){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=e[Symbol.iterator](),r=t[Symbol.iterator]();let s=o.next(),a=r.next();const l=[];for(;!a.done||!s.done;)a.done||!s.done&&a.value.id>s.value[0].id?(yield n(s.value[1]),s=o.next()):s.done||a.value.id<s.value[0].id?(l.push([a.value,i(a.value)]),a=r.next()):(l.push([a.value,s.value[1]]),s=o.next(),a=r.next());return l}))}(i,Array.from(r).sort(((e,t)=>e.id.localeCompare(t.id))),(t=>ue(t,e,n)),(e=>me(e,t)))}))),[]),(0,c.U)((e=>ge(e,i))),(0,ce.b)((e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const t=yield e;return Promise.all(t)}))))),ue=(e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{return{type:"value",value:yield t(e)}}catch(t){return i&&i(e,t),{type:"error",error:t}}})),me=(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const i=yield e;if("error"!==i.type)return t(Promise.resolve(i.value))})),ge=(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const i=[],n=yield Promise.all(e);for(const e of n){const n=yield e[1];"value"===n.type&&i.push(t(e[0],Promise.resolve(n.value)))}return i}));var he=i(949556),pe=i(956255),ve=i(419925);var ye=i(46120);function fe(e){return Object.keys(e).reduce(((t,i)=>(t[i]=function(e){const t=(0,ye.QS)(e);return{update:e=>t(e),read:()=>t(),ref:t}}(e[i]),t)),{})}const Se=new Set([ve.ab,ve.Xt]);class ke{constructor(e,t,i){this._logger=e.newLogger("ReactiveValuesService","core-services-activator"),this._appViewStateForWindowMap=new Map,this._servicesAppsRegistry=t,this._config=i}getAppViewStateForWindow(e,t){var i,n,o;this._config.enableEmbedDataClient&&(e=f.ew);const r=null===(i=this._appViewStateForWindowMap.get(e))||void 0===i?void 0:i.get(t);if(!r){const i=this._servicesAppsRegistry.getAppByID(t);i&&"viewStateRegistration"in i&&i.viewStateRegistration&&(null===(o=(n=this._logger).errorToTelemetry)||void 0===o||o.call(n,`Unable to find appViewState for window ${e} app ${t}, registeredApps: ${this._appViewStateForWindowMap.get(e)}`,"webclient_framework_foundation_core_services_activator"))}return r}resetAllViewState(e){const t=this._appViewStateForWindowMap.get(e);t&&t.forEach(((e,t)=>{Se.has(t)||this.resetViewStateForApp(t,e)}))}setReactiveValuesForApp(e,t,i){var n;const o=null===(n=this._appViewStateForWindowMap.get(e))||void 0===n?void 0:n.get(t);if(this._logger.log(`Setting view state to apollo cache value for windowId ${e}, app ${t}`),o){const{navigationalReactiveValues:e,nonNavigationalReactiveValues:t}=o;Object.keys(i).forEach((n=>{let o=e[n];o||(o=t[n]),o.update(i[n])}))}}getRegisteredAppsTypePolicies(e){const t={typePolicies:{},defaultTypeName:[]};return this._appViewStateForWindowMap.set(e,new Map),this._servicesAppsRegistry.registeredApps.forEach((i=>{const n=i.manifest.id,o=i;if(o.viewStateRegistration){const{computedValues:i,navigationalFieldDefaultValues:r,nonNavigationalFieldDefaultValues:s,gqlTypeName:a,queryFieldName:l}=o.viewStateRegistration,c=fe(r),d=fe(s),u=this._appViewStateForWindowMap.get(e);null==u||u.set(n,{navigationalReactiveValues:c,nonNavigationalReactiveValues:d});const m=function(...e){const[t,i,n]=e,o={};for(const e of Object.keys(i)){const t=e,n=()=>i[t].read();o[t]={read:n}}if(n)for(const e of Object.keys(n)){const t=e,r=(e,o)=>{const{args:r}=o||{};return n[t](i,r)},s=r;o[t]={read:s}}return{[t]:{fields:o}}}(a,Object.assign(Object.assign({},c),d),i);t.typePolicies=Object.assign(Object.assign({},t.typePolicies),m),t.defaultTypeName.push({gqlTypeName:a,queryFieldName:l})}})),t}removeWindowViewState(e){this._appViewStateForWindowMap.delete(e)}resetViewStateForApp(e,t,i){const n=this._servicesAppsRegistry.getAppByID(e);if(n&&t&&"viewStateRegistration"in n&&n.viewStateRegistration){this._logger.log(`Resetting view state for app ${e}`);const{navigationalFieldDefaultValues:o,nonNavigationalFieldDefaultValues:r}=n.viewStateRegistration;Object.keys(o||{}).forEach((e=>{(null==i?void 0:i.includes(e))||t.navigationalReactiveValues[e].update(o[e])})),Object.keys(r).forEach((e=>{(null==i?void 0:i.includes(e))||t.nonNavigationalReactiveValues[e].update(r[e])}))}}}const be={[pe.py.meetings]:["com.microsoft.teams.calling","com.microsoft.teams.meeting-options"]};class we{constructor(e,t,i,n){this._loadedTasksMap=new Map,this._appIdToAppMap=void 0,this._logger=e.newLogger("AppsRegistryService","core-services-activator"),this._loadedApps=[],this._entityTypeToAppMap=new Map,this._appsWithAppHistoryStored=[],this.initialize(i,n),this._reactiveValuesService=new ke(e,this,t)}get registeredApps(){return this._loadedApps}get registeredAppManifests(){return this._loadedApps.map((e=>e.manifest))}get registeredTasks(){return Array.from(this._loadedTasksMap.values())}get appsWithAppHistoryStored(){return this._appsWithAppHistoryStored}getApp({entityType:e,renderMode:t}){if(e||t)return this.registeredApps.find((i=>(!e||function({supportedEntities:e},t){return!(!e||-1===e.indexOf(t))}(i.manifest,e))&&(!t||function({supportedRenderModes:e},t){return!(!e||-1===e.indexOf(t))}(i.manifest,t))))}getAppViewStateForWindow(e,t){return this._reactiveValuesService.getAppViewStateForWindow(e,t)}getAppByID(e){var t;return null===(t=this._appIdToAppMap)||void 0===t?void 0:t.get(e)}getPlatformAppIdForEntity(e){const t=this._entityTypeToAppMap.get(e.type);if(void 0===t)return void this._logger.error("getPlatformAppIdForEntity: Platform id requested for entity which has no registered app in this experience.",{entityType:e.type});if(void 0===t.getPlatformAppIdForEntity)return void this._logger.debug("getPlatformAppIdForEntity: An app is registered for this entity but has no function for getPlatformAppIdForEntity.",{appName:t.manifest.name,entityType:e.type});let i;try{i=t.getPlatformAppIdForEntity(e)}catch(i){this._logger.error("getPlatformAppIdForEntity: Error caught from app handler while mapping the id for this entity.",{appName:t.manifest.name,entityType:e.type})}if(void 0!==i)return i;this._logger.debug("getPlatformAppIdForEntity: App mapped the id for this entity to undefined.",{appName:t.manifest.name,entityType:e.type})}getAppByActor(e){if(e)return this.registeredApps.find((t=>function({actors:e},t){return!(!e||-1===e.indexOf(t))}(t.manifest,e)))}getDefaultCommand(e,t){var i,n;const{coldBootAppId:o}=e.get(b.J.Edu),{coreColdBootAppId:r,coreColdBootFlyoutWindowAppId:s,enableEDUColdBootApp:a}=e.get(b.J.Core),l=a?o:t===ve.lO.minimode||t===ve.lO.minimal?s:r;if(l){this._logger.debug(`Using cold boot appId of ${l} with enableEDUColdBootApp ${a}`);const t=this.getAppByID(l),o=null===(n=null==t?void 0:(i=t.manifest).getDefaultCommand)||void 0===n?void 0:n.call(i,e);if(o)return o;this._logger.debug(`No default command found ${l}`)}for(const t of this.registeredAppManifests)if(t.getDefaultCommand){const i=t.getDefaultCommand(e);if(i)return this._logger.debug(`Found a default command in ${t.name}`),i}}resetAllViewState(e){this._reactiveValuesService.resetAllViewState(e)}setReactiveValuesForApp(e,t,i){this._reactiveValuesService.setReactiveValuesForApp(e,t,i)}getRegisteredAppsTypePolicies(e){return this._reactiveValuesService.getRegisteredAppsTypePolicies(e)}removeWindowViewState(e){this._reactiveValuesService.removeWindowViewState(e)}registerTask(e){this._loadedTasksMap.set(e.id,e)}initialize(e,t){const i=new Map;if(!(t&&t.length>0))throw new Error(`initialize::${f.jK.Empty} - No apps registered`);-1===t.findIndex((t=>t.manifest.id===e.manifest.id))&&t.length>0&&t.push(e),t.forEach((e=>{var t,n;if(i.has(e.manifest.id))throw new Error(`Multiple apps found for appId ${e.manifest.id}`);i.set(e.manifest.id,e),null===(t=e.manifest.supportedEntities)||void 0===t||t.forEach((t=>{const i=be[t];if(!i||!i.includes(e.manifest.id)){if(this._entityTypeToAppMap.has(t))throw new Error(`Multiple apps found for entity ${t}`);this._entityTypeToAppMap.set(t,e)}})),e.onRegister&&e.onRegister({registerTask:this.registerTask.bind(this)}),(null===(n=e.onBeforeAddToNavigation)||void 0===n?void 0:n.shouldStoreLastVisitedInAppHistory)&&this._appsWithAppHistoryStored.push(e.manifest.id)})),this._loadedApps=Array.from(i.values()),this._appIdToAppMap=i}}var Ce=i(47580),_e=i(354571);const Te={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindowForEntity"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindowForEntity"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindow"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindow"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActiveEntities"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"startTimestamp"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"source"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Correlation"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"entityFieldsForActiveWindow"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"action"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"options"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}}]}.definitions]};var Ie=i(242863),je=i(530014),Ne=i(5575),Ee=i(528714),xe=i(234207),Ae=i(238446),De=i(321781);const Fe=new Set([ve.ab,ve.Xt]),Oe=e=>"viewStateRegistration"in e,Me=e=>Fe.has(e.manifest.id),Re=e=>{var t,i,n,o,r,s,a;return null!==(s=null!==(o=null!==(i=null===(t=e.current)||void 0===t?void 0:t.subNavEntity)&&void 0!==i?i:null===(n=e.current)||void 0===n?void 0:n.headerEntity)&&void 0!==o?o:null===(r=e.current)||void 0===r?void 0:r.startEntity)&&void 0!==s?s:null===(a=e.current)||void 0===a?void 0:a.mainEntity},Pe=e=>e.manifest.id===ve.vC,Le={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"executeEntityCommand"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"executionContext"}},type:{kind:"NamedType",name:{kind:"Name",value:"ExecutionContextInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"command"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityCommandInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"clientLaunchId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"WindowOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"executeEntityCommand"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"Argument",name:{kind:"Name",value:"executionContext"},value:{kind:"Variable",name:{kind:"Name",value:"executionContext"}},__type:{kind:"NamedType",name:{kind:"Name",value:"ExecutionContextInput"}}},{kind:"Argument",name:{kind:"Name",value:"command"},value:{kind:"Variable",name:{kind:"Name",value:"command"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityCommandInput"}}}},{kind:"Argument",name:{kind:"Name",value:"clientLaunchId"},value:{kind:"Variable",name:{kind:"Name",value:"clientLaunchId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"windowOptions"},value:{kind:"Variable",name:{kind:"Name",value:"windowOptions"}},__type:{kind:"NamedType",name:{kind:"Name",value:"WindowOptionsInput"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}}]};function Ue(e){return Object.assign(Object.assign({},e),{id:(t=e,t&&t.id||(0,xe.v4)()),startTimestamp:We(e),source:(null==e?void 0:e.source)||k.D.StandAlone});var t}function We(e){return e&&e.startTimestamp||Date.now()}function Be({appName:e,commandChangeReportingService:t,entityCommand:i,getCommandScenarioName:n,logger:o,coreSettings:r,clientPreferences:s}){const a=i.command.correlation,l=void 0===a.scenarioName||a.scenarioName===U.RG.EntityCommand;if(n&&l){try{a.scenarioName=n(i,o,r,s)}catch(i){t.report({type:Ae.B.Failure,context:{errorInfo:De.y.GetCommandScenarioNameHookFailed,errorMessage:`App ${e} failed to execute entity command hook GetCommandScenarioName with ${i.name}`,target:"internal-command-handler"},correlationId:a.id})}o.log(`App ${e} is overwriting default scenario name to ${a.scenarioName} for command with entityType ${i.entity.type}`)}}function $e(e){return Object.assign(Object.assign({},e),{command:He(e.command)})}function He(e){return Object.assign(Object.assign({},e),{correlation:Ue(e.correlation)})}const qe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CoreServicesActivatorIsEntityInActiveWindowQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEntityInActiveWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}}]};function ze(e,t,i,n,r,s){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enableIsEntityInViewByFocusedWindow:o}=s.get(b.J.Core);if(!o){return Ge(yield Ve(e,t,r),n,i,r)}{const o=function(e,t,i){const n=e.getValue().find((e=>{const i=!(!e||!e.window.document.hasFocus()),n=t.getState(),o=n===_e.pk.LongInactive||n===_e.pk.Inactive;return i&&!o}));return i.log(`Current window in focus is ${null==n?void 0:n.id}`),null==n?void 0:n.id}(n,i,r);if(r.log("Window in focus: ",o),!o)return r.log("There are no windows in focus"),!1;try{return(yield t.query({query:qe,variables:{entity:e,windowId:o},fetchPolicy:"no-cache"})).data.isEntityInActiveWindow}catch(e){return r.error("isEntityInActiveWindowQuery failed"),!1}}}))}function Ve(e,t,i){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const i=yield t.query({query:Te,variables:{entity:e},fetchPolicy:"no-cache"});return null===(n=i.data.activeWindowForEntity)||void 0===n?void 0:n.id}catch(t){return void i.error(`query for entity failed. Entity: ${JSON.stringify(e)}, Error: ${t}`)}}))}function Ge(e,t,i,n){const o=t.getValue().find((t=>t.id===e)),r=!(!o||!o.window.document.hasFocus()),s=i.getState(),a=s===_e.pk.LongInactive||s===_e.pk.Inactive,l=r&&!a;return l||n.log(`isWindowInView: Window considered to be not in view. Window is inactive ${a}, window has focus: ${r}`),l}function Je(e){return function(e,t){return(0,Ie.sanitize)(e,t)}(e,function(e,t){return{ADD_ATTR:e,ADD_TAGS:t,RETURN_TRUSTED_TYPE:!0,WHOLE_DOCUMENT:!0}}(["content","focusable","nonce","onclick"],["link","meta","script","#comment","!doctype"]))}function Ke(e){var t,i;return[null!==(t=null==e?void 0:e.findScenario(U.RG.ClientStart))&&void 0!==t?t:null,null!==(i=null==e?void 0:e.findScenario(U.RG.ExperienceReady))&&void 0!==i?i:null]}function Qe(e,t){return e instanceof je.G?e:new Ne.G(Ne.$.UNKNOWN,e,t)}function Ye(e,t,i,n){return Ze.bind(void 0,e,t,i,n)}function Xe(e,t){var i;const n=null===(i=null==t?void 0:t.get(b.J.Core))||void 0===i?void 0:i.enableStackTraceCollection;return{errorCode:e instanceof je.G&&je.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():void 0,stack:n&&e instanceof je.G?e.stack:void 0}}function Ze(e,t,i,n){var r,s,a,l;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o="";const c=null==e?void 0:e.host;c&&(o=`SessionId:\t${c.sessionId}\r\nDeviceId:\t${c.deviceId}\r\nHostVersion:\t${c.hostAppVersion}\r\n`);const d=null==e?void 0:e.config;d&&(o=`${o}WebVersion:\t${null==d?void 0:d.clientVersion}\r\n`);const u=null==t?void 0:t.locale;u&&(o=`${o}Language:\t${u}\r\n`);const m=null==n?void 0:n.get(b.J.Metadata);(null===(r=null==m?void 0:m.ring)||void 0===r?void 0:r.id)&&(o=`${o}Ring:\t${m.ring.id}\r\n`),(null==d?void 0:d.vdi)&&(o=`${o}Virtualization:\t${null===(s=null==d?void 0:d.vdi)||void 0===s?void 0:s.configFilter}\r\n`,o=`${o}vdiMode:\t${null===(a=null==d?void 0:d.vdi)||void 0===a?void 0:a.mode}\r\n`);const g=yield null===(l=null==i?void 0:i.getCachedUsers)||void 0===l?void 0:l.call(i,Object.assign(Object.assign({},Ue({source:k.D.Core})),{scenarioName:U.RG.AuthWebCachedUser}));if(null==g?void 0:g.length){o=`${o}Logged in users:\r\n`;for(const e of g)o=`${o}\t${e.userName}  ${e.profile.name}  TId:${e.profile.tid}  OId:${e.profile.oid}  UserId:${e.id}\r\n`}return o}))}class et{constructor(e,t,i,n,o,r,s,a,l,c,d,u){this._loggerFactory=e,this._appsRegistryService=t,this._config=i,this._configLoader=n,this._coreTasks=r,this._diagnosticsService=s,this._logsCollectorService=a,this._waitForRenderingContextReady=l,this._isEntityInView=c,this._criticalDynamicImports=d,this._getPlatformConfigurationOverrides=u,this._logger=e.newLogger("TaskManagerService","core-services-activator"),this._appsRegistryService=t,this._taskContext=this.createNewContext(o)}notifyLifeCycleEvent(e,t={},i){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=this.extractApplicableTasks(this._appsRegistryService.registeredTasks,e),s=`notify::starting - lifeCycleEvent=${e}, taskCount=${o.length}`;this._logger.log(s);const a=Object.assign(Object.assign({},this._taskContext),t);this.markCoreLifeCycleEventStart(a,e);const l={},c=null===(n=null===performance||void 0===performance?void 0:performance.timing)||void 0===n?void 0:n.navigationStart,d=new Map,u=[];let m=0;for(const t of o){const n=null===(r=null===performance||void 0===performance?void 0:performance.now)||void 0===r?void 0:r.call(performance),o=e=>{var i,n;const o=`notify:: Task Execute Error - taskId ${f.Yg[t.id]}, code=${e.code} errorMsg=${(0,se.B9)((null==e?void 0:e.prevError)||e)}.`;null===(n=(i=this._logger).errorToTelemetry)||void 0===n||n.call(i,o,"webclient_framework_foundation_core_init",void 0,!0),d.set(t.id,e)},s=()=>t instanceof Ce.i?t.executeSafe(a,l):t.execute(a,l),g=e=>e?(0,W.E)(s(),e,`${f.Yg[t.id]} timed out.`):s(),h=yield g(this._config.coreTasksTimeoutMs).catch(o);h&&u.push({taskId:t.id,cleanupFn:h}),this.markCoreLifeCycleTaskCompleted(a,e,t,d,n,c,++m,i)}return this.logErrorSummary(e,d),this._logger.log(`notify::tasks complete - lifeCycleEvent=${e}, taskCount=${o.length}`),Object.assign(Object.assign(Object.assign({},l),a),{coreTaskErrors:Array.from(d.values()),cleanupFns:u})}))}destroyContext(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=e.cleanupFns.length;let n,o=0;for(;n=e.cleanupFns.pop();)try{yield n.cleanupFn(t),o++}catch(e){this._logger.error(`Cleanup failed for task: ${f.Yg[n.taskId]}`)}this._logger.log(`destroyContext complete: ${o}/${i} tasks succeeded.`)}))}hasTasks(e){return this.extractApplicableTasks(this._appsRegistryService.registeredTasks,e).length>0}markCoreLifeCycleEventStart(e,t){var i,n,o;const r=null===(i=e.altScenarioService)||void 0===i?void 0:i.altScenario,s=null===(n=e.altScenarioService)||void 0===n?void 0:n.clientStartScenario,a=`${h}${t}`;r||s?(r&&r.mark(a),s&&s.mark(a)):null===(o=null===performance||void 0===performance?void 0:performance.mark)||void 0===o||o.call(performance,a)}markCoreLifeCycleTaskCompleted(e,t,i,n,o,r,s,a){var l,c,d;const u=null===(l=e.altScenarioService)||void 0===l?void 0:l.altScenario,m=null===(c=e.altScenarioService)||void 0===c?void 0:c.clientStartScenario,g=n.get(i.id),h=Xe(g).errorCode,v=`${t}_${f.Yg[i.id]}`;u||m?(u&&u.mark(`core_task_${v}`,g?{errorCode:h}:void 0),m&&m.mark(`core_task_${v}`,g?{errorCode:h}:void 0)):null===(d=null===performance||void 0===performance?void 0:performance.mark)||void 0===d||d.call(performance,`${p}${v}`),this.addTaskDetailsToLocalStorage(g||{},o,r,v,s,e),null==a||a(i.id,g)}addTaskDetailsToLocalStorage(e,t,i,n,o,r){var s;try{const{windowProvider:a,config:l}=r;l.shouldTrackCoreInitTasks&&(null==a||a.localStorage.setItem(n,(0,M.u4)({index:o,startTime:new Date(i+t).toISOString(),duration:(null===(s=null===performance||void 0===performance?void 0:performance.now)||void 0===s?void 0:s.call(performance))-t,error:e})))}catch(e){e.code===DOMException.QUOTA_EXCEEDED_ERR?this._logger.error("Error: Quota exceeded while writing core task details to local storage."):this._logger.warn(`Couldn't write core init task details to local storage: ${(0,se.B9)(e)}`)}}createNewContext(e){return{correlation:e,diagnosticsService:this._diagnosticsService,logsCollectorService:this._logsCollectorService,loggerFactory:this._loggerFactory,appsRegistryService:this._appsRegistryService,config:this._config,configLoader:this._configLoader,waitForRenderingContextReady:this._waitForRenderingContextReady,isEntityInView:this._isEntityInView,criticalDynamicImports:this._criticalDynamicImports,getPlatformConfigurationOverrides:this._getPlatformConfigurationOverrides}}extractApplicableTasks(e,t){var i,n;const o=[];if(e){const i=e.filter((e=>!e.lifeCycleSubscriptions&&t===f.sM.Initialization||e.lifeCycleSubscriptions&&-1!==e.lifeCycleSubscriptions.indexOf(t)));o.push(...i)}return((null===(n=(i=this._coreTasks)[t])||void 0===n?void 0:n.call(i))||[]).concat(o)}logErrorSummary(e,t){if(t.size>0){const i=(0,se.Tr)("TaskManagerService",f.jK.NotInitialized,`lifeCycleEvent=${e}`,{failedTaskErrors:t});this._logger.error(`Failed ${t.size} core tasks: ${Array.from(t.keys()).map((e=>f.Yg[e])).join()}, lifeCycleEvent=${e}: `,i)}}}const tt={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"windowOptionsFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WindowOptions"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"left"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"top"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]}]}}]},it={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindows"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subNavEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"headerEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"startEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"monitorEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"inAppNotificationsEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"entityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActiveEntities"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"startTimestamp"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"source"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"clientLaunchId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Correlation"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"extendedEntityContainerState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"containerState"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExtendedContainerState"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isExternal"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExtendedEntityContainerState"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isMainWindow"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isNotificationsWindow"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isInitialWindowStateHidden"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"userContextId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"layoutConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layoutMode"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LayoutModes"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isFullscreen"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"slots"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"header"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"subNav"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"notifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotsLayoutConfig"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LayoutConfig"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"windowOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"windowOptionsFields"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"WindowOptions"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}}},arguments:[]}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"entityFieldsForActiveWindows"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"action"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"options"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"windowOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"windowOptionsFields"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"WindowOptions"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"linkedEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"action"},__type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"LinkedEntity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"entityState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"flushableByLinkedEntity"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityState"}}},arguments:[]}]}},...tt.definitions]}.definitions,...tt.definitions]},nt={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"authenticationUsersEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsersEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cloud"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationCloudType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tenantId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"puid"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserProfile"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"subType"},__type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserSubType"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"role"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserRole"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationAccountType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"loginUserName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"homeAccountId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUser"}}}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationServiceEvent"}}},arguments:[]}]}}]},ot={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"authenticationUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserFilter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserFilter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cloud"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationCloudType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tenantId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"puid"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserProfile"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationAccountType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"subType"},__type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserSubType"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"role"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserRole"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"loginUserName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"homeAccountId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUser"}}}}}}]}}]};var rt=i(220180);const st=new Set([S.G5.quit,S.G5.restart]);function at({hostCommunicationService:e,logger:t,reason:i,renderingContextManager:n}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let r;const s=n.getDefaultRenderingContext();switch((null==s?void 0:s.scenarioFactory)&&(r=ct(i,s.scenarioFactory)),i){case"quit":try{yield n.removeAllRenderingContexts(i),null==r||r.mark(U.ck.RemoveAllRenderingContexts),yield function(e,t,i){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o,r;try{o=yield t.loadModule("core")}catch(e){r="LoadModuleCoreFailed"}try{yield null===(n=null==o?void 0:o.reportReadyToQuit)||void 0===n?void 0:n.call(o)}catch(e){r="ReportReadyToQuitFailed"}r&&mt(r,e,i)}))}(t,e,r),null==r||r.stop()}catch(e){ut(e,t,r)}break;case"restart":try{yield n.cleanupWithPriority(i),null==r||r.stop()}catch(e){ut(e,t,r)}break;default:return}}))}function lt({coreSettings:e,logger:t,reason:i,renderingContextManager:n,user:r}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o;try{const t=r&&(0,Ee.b4)(r);if(!t)throw new Ne.G(Ne.$.CLEANUP,new Error("signout::UserContextIdNotFound"));const s=yield n.getUserRenderingContext(t);(null==s?void 0:s.scenarioFactory)&&(o=ct(i,s.scenarioFactory)),yield n.removeUserRenderingContext(i,t),null==o||o.mark(U.ck.RemoveUserRenderingContext);if(!e.get(b.J.Auth).isLegacyCleanupCodeFlag){const e=["TestCookie","ringFinder"];!function(e){try{(0,F.J)().sessionStorage.clear()}catch(t){dt(e,"ClearSessionStorageFailed")}}(o),function(e,t){try{Object.keys(rt.getJSON()).forEach((t=>{e.includes(t)||rt.remove(t)}))}catch(e){dt(t,"DeleteCookiesFailed")}}(e,o)}null==o||o.stop()}catch(e){ut(e,t,o)}}))}function ct(e,t){const i=t.newScenario(U.RG.CoreCleanup),n={reason:e};return i.appendEventData(n),i}function dt(e,t){const i={errorCode:t};e&&e.fail(i)}function ut(e,t,i){const n="UnknownCleanupFailure";let o;o=e instanceof Ne.G&&je.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():e instanceof Error?`${Ne.$.CLEANUP}::${n}::${null==e?void 0:e.name}::${null==e?void 0:e.message}`:`${Ne.$.CLEANUP}::${n}::${(0,M.u4)(e)}`,mt(o,t,i)}function mt(e,t,i){var n;i&&dt(i,e),null===(n=t.errorToTelemetry)||void 0===n||n.call(t,e,"webclient_framework_foundation_core_services",void 0,!0)}var gt=i(382433),ht=i(609901),pt=i(910512),vt=i(19740),yt=i(793377),ft=i(218551);class St{constructor(e,t,i){this.eventHandler=e,this.commandHandler=t,this.commandDelegator=i}bubble(e){return this.eventHandler(e,this.commandHandler,this.commandDelegator)}}var kt=i(243334);const bt="internal-event-handler",wt=({commandChangeReportingService:e,correlation:t,type:i})=>{if(i===Ae.B.DelegatedCommandReceived)e.report({type:i,correlationId:t.id,context:{target:bt,correlation:t}});else e.report({type:i,correlationId:t.id,context:{target:bt}})},Ct=({commandChangeReportingService:e,correlation:t,errorInfo:i=De.y.DelegatedCommandError,errorMessage:n,logger:o})=>{var r;null===(r=o.errorToTelemetry)||void 0===r||r.call(o,n,"webclient_framework_foundation_core_services_internal_command_delegator",void 0,!0),e.report({correlationId:t.id,type:Ae.B.Failure,context:{target:bt,errorMessage:n,errorInfo:i}})};var _t=i(281423);const Tt=({activeWindowsService:e,appsRegistryService:t,client:i,clientPreferences:n,commandChangeReportingService:r,commandHandler:s,commandInput:a,coreSettings:l,executionContext:c,loggerFactory:d,scenarioFactory:u,shortcutExecutionService:m,windowId:g,host:h,userBiService:p,isInSecondHopToCoreLayoutApp:v=!1})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const y=d.newLogger("internalCommandDelegator","core-services-entity-commanding"),S=a.correlation||Ue();wt({commandChangeReportingService:r,correlation:S,type:Ae.B.DelegatedCommandReceived});const k=function(e,t){return e.getAppByActor(t.command.actor)}(t,a);if(!k){const e=`Command for actor ${a.command.actor} does not map to any registered app.`;return Ct({commandChangeReportingService:r,correlation:S,errorMessage:e,logger:y}),Promise.resolve(void 0)}if(!k.onCommandReceived){const e=`Command for actor ${a.command.actor} maps to app ${k.manifest.name}, but the app hasn't registered onCommandReceived handler.`;return Ct({commandChangeReportingService:r,correlation:S,errorMessage:e,logger:y}),Promise.resolve(void 0)}const{navigationalReactiveValues:b,nonNavigationalReactiveValues:w}=t.getAppViewStateForWindow(g||f.ew,k.manifest.id)||{};let C=!1,_={};b&&(_=Object.keys(b).reduce(((e,t)=>{const i=b[t];return Object.assign(Object.assign({},e),{[t]:{read:i.read,update:e=>{e!==i.read()&&(i.update(e),C=!0)}}})}),{}));const T=function(e,t,i,n,o,r,{viewEntitiesRef:s,viewEntity:a}={},l,c){var d,u,m;const g=s&&Re(s);return{client:e,clientPreferences:t.getAllPreferences(),coreSettings:i,loggerFactory:n,scenarioFactory:o,shortcutExecutionService:c,executionContext:{viewEntities:{endEntity:null===(d=null==s?void 0:s.current)||void 0===d?void 0:d.endEntity,mainEntity:null===(u=null==s?void 0:s.current)||void 0===u?void 0:u.mainEntity},viewEntity:a,isHandlingAppActiveApp:!!g&&(null===(m=r.getApp({entityType:g.type}))||void 0===m?void 0:m.manifest.id)===l}}}(i,n,l,d,u,t,c,k.manifest.id,m);let I;try{const t={commandInput:a,requestContext:T};wt({commandChangeReportingService:r,correlation:S,type:Ae.B.BeforeOnCommandReceived});const n=Object.assign(Object.assign({},_),w);I=yield(({activeWindowsService:e,delegatedApp:t,reactiveValues:i,hookOptions:n,host:r,windowId:s,userBiService:a})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(!t.onCommandReceived)return Promise.resolve(void 0);if(Oe(t)&&Me(t)){if(i){const o=Object.assign(Object.assign({},n),{activeWindowsService:e,appViewState:i,host:r,slotDimensionsOptions:kt.Vi,windowId:s,userBiService:a});return t.onCommandReceived(o)}}else{if(!Oe(t)){if(Me(t)){const i=Object.assign(Object.assign({},n),{activeWindowsService:e,windowId:s,slotDimensionsOptions:kt.Vi});return t.onCommandReceived(i)}return t.onCommandReceived(n)}if(i){const e=Object.assign(Object.assign({},n),{appViewState:i});return t.onCommandReceived(e)}}return Promise.resolve(void 0)})))({activeWindowsService:e,delegatedApp:k,reactiveValues:n,hookOptions:t,host:h,windowId:g,userBiService:p}),C&&(i.mutate({mutation:_t.E,variables:{windowId:g,appIds:[k.manifest.id]}}).catch((e=>{y.warn(`saveReactiveVarToHistory failed ${e.message}`)})),C=!1),wt({commandChangeReportingService:r,correlation:S,type:Ae.B.AfterOnCommandReceived})}catch(e){const t=`Command for actor ${a.command.actor} encountered an error inside onCommandReceived of ${k.manifest.name}.`;return Ct({commandChangeReportingService:r,correlation:S,errorMessage:t,logger:y}),Promise.reject(e)}if(!I)return wt({correlation:S,commandChangeReportingService:r,type:Ae.B.CommandHandledByOnCommandReceived}),Promise.resolve(void 0);const j=e=>"entity"in e;if(!v&&!j(I)&&"corelayout"===I.command.actor)return y.log(`onCommandReceived for ${k.manifest.name} is requesting a second hop to CoreLayoutApp`),Tt({activeWindowsService:e,appsRegistryService:t,client:i,clientPreferences:n,commandChangeReportingService:r,commandHandler:s,commandInput:I,coreSettings:l,executionContext:c,loggerFactory:d,scenarioFactory:u,shortcutExecutionService:m,windowId:g,host:h,userBiService:p,isInSecondHopToCoreLayoutApp:!0});if(!j(I)){const e=`Command for actor ${a.command.actor} inside onCommandReceived of ${k.manifest.name}, should return an IEntityCommand or undefined.`;return Ct({commandChangeReportingService:r,correlation:S,errorMessage:e,logger:y}),Promise.reject(e)}const N=Object.assign(Object.assign({},I),{command:Object.assign(Object.assign({},I.command),{correlation:S})});s(N)}));class It{constructor(e,t){this.commandHandler=e,this.commandDelegator=t}execute(e){return this.commandDelegator(e,this.commandHandler)}}var jt=i(127097);const Nt="internal-event-handler",Et=({commandChangeReportingService:e,correlation:t,type:i})=>{if(i===Ae.B.EventBubbled)e.report({type:i,correlationId:t.id,context:{target:Nt,correlation:t}});else e.report({type:i,correlationId:t.id,context:{target:Nt}})},xt=({commandChangeReportingService:e,correlation:t,errorMessage:i,logger:n})=>{var o;const r=De.y.EventError;null===(o=n.errorToTelemetry)||void 0===o||o.call(n,i,"webclient_framework_foundation_core_services_internal_event_handler",void 0,!0),e.report({correlationId:t.id,type:Ae.B.Failure,context:{target:Nt,errorMessage:i,errorInfo:r}})},At=["MeControlCore","MeControlMeAccount","MeControlMTMA"],Dt=({appsRegistryService:e,client:t,clientPreferences:i,commandChangeReportingService:n,commandDelegator:r,commandHandler:s,coreSettings:a,eventInput:l,executionContext:c,hostCommunicationService:d,i18n:u,loggerFactory:m,notificationsHandler:g,phaseStateMachine:h,scenarioFactory:p,shortcutExecutionService:v,userBiService:y,windowId:S})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var k;const w=m.newLogger("internalEventHandler","core-services-entity-commanding");let C=function(e,t){var i;return t?t&&e.getApp({entityType:null===(i=t.viewEntity)||void 0===i?void 0:i.type}):e.getAppByID(ve.ab)}(e,c);const _=((e,t,i,n,o,r)=>{var s;const{scenarioName:a,id:l,source:c}=(null===(s=null==t?void 0:t.getEventScenarioData)||void 0===s?void 0:s.call(t,e,n,o,r))||{};let d;d=o.get(b.J.Core).enableEventTimestamp?e.source.timeStamp:Date.now();const u=Ue({id:l,scenarioName:a,source:c,startTimestamp:d});return Et({commandChangeReportingService:i,correlation:u,type:Ae.B.EventBubbled}),u})(l,C,n,w,a,i);if("com.microsoft.teams.search"===(null==C?void 0:C.manifest.id)&&At.includes(l.event.originator)&&(C=e.getApp({renderMode:jt.e.TitleBar})),"updateDialogState"===l.event.type&&(C=e.getAppByID(ve.ab)),!C){return xt({commandChangeReportingService:n,correlation:_,errorMessage:"Error mapping event to slot.",logger:w}),Promise.resolve(void 0)}if(!(null===(k=C.eventHandlers)||void 0===k?void 0:k.onEventReceived)){const e=`Event '${l.event.type}' was received for app ${C.manifest.name}, but it hasn't registered an event handler.`;return xt({commandChangeReportingService:n,correlation:_,errorMessage:e,logger:w}),Promise.resolve(void 0)}const T=function(e,t,i,n,o,r,s,{viewEntitiesRef:a,viewEntity:l}={},c,d,u,m,g){var h,p,v;const y=a&&Re(a);return{client:e,clientPreferences:t.getAllPreferences(),coreSettings:i,hostCommunicationService:u,i18n:m,loggerFactory:n,scenarioFactory:o,shortcutExecutionService:d,userBiService:r,executionContext:{viewEntities:{endEntity:null===(h=null==a?void 0:a.current)||void 0===h?void 0:h.endEntity,mainEntity:null===(p=null==a?void 0:a.current)||void 0===p?void 0:p.mainEntity},viewEntity:l,isHandlingAppActiveApp:!!y&&(null===(v=s.getApp({entityType:y.type}))||void 0===v?void 0:v.manifest.id)===c},phaseStateMachine:g}}(t,i,a,m,p,y,e,c,C.manifest.id,v,d,u,h);let I;try{const i={eventInput:l,requestContext:T};Et({correlation:_,commandChangeReportingService:n,type:Ae.B.BeforeOnEventReceived});const{navigationalReactiveValues:r,nonNavigationalReactiveValues:s}=e.getAppViewStateForWindow(S||f.ew,C.manifest.id)||{};let a=!1,c={};r&&(c=Object.keys(r).reduce(((e,t)=>{const i=r[t];return Object.assign(Object.assign({},e),{[t]:{read:i.read,update:e=>{e!==i.read()&&(i.update(e),a=!0)}}})}),{}));const d=(c||s)&&Object.assign(Object.assign({},c),s);I=yield(({sourceApp:e,reactiveValues:t,hookOptions:i,notificationsHandler:n,windowId:r})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var o;let s;if(!(null===(o=e.eventHandlers)||void 0===o?void 0:o.onEventReceived))return Promise.resolve(void 0);if(Oe(e)&&Me(e)){if(t){const n=Object.assign(Object.assign({},i),{appViewState:t,windowId:r});s=yield e.eventHandlers.onEventReceived(n)}}else if(Oe(e)){if(t){const n=Object.assign(Object.assign({},i),{appViewState:t});s=yield e.eventHandlers.onEventReceived(n)}}else if(Me(e)){const t=Object.assign(Object.assign({},i),{windowId:r});s=yield e.eventHandlers.onEventReceived(t)}else if(Pe(e)&&n){const t=Object.assign(Object.assign({},i),{notificationsHandler:n});s=yield e.eventHandlers.onEventReceived(t)}else s=yield e.eventHandlers.onEventReceived(i);return Promise.resolve(s)})))({sourceApp:C,reactiveValues:d,hookOptions:i,notificationsHandler:g,windowId:S}),a&&(t.mutate({mutation:_t.E,variables:{windowId:S,appIds:[C.manifest.id]}}).catch((e=>{w.warn(`saveReactiveVarToHistory mutation failed ${e.message}`)})),a=!1),Et({correlation:_,commandChangeReportingService:n,type:Ae.B.AfterOnEventReceived})}catch(e){const t=`Event '${l.event.type}' encountered an error inside onEventReceived of ${C.manifest.name}.`;return xt({commandChangeReportingService:n,correlation:_,errorMessage:t,logger:w}),Promise.reject(e)}if(!I)return Et({correlation:_,commandChangeReportingService:n,type:Ae.B.EventHandled}),Promise.resolve(void 0);const j=Object.assign(Object.assign({},I),{correlation:_});return r(j,s)}));var Ft=i(344207),Ot=i(923975);const Mt="DeepLink:: ";var Rt,Pt;!function(e){e.DecodeURIComponentFailed="DecodeURIComponentFailed",e.DeeplinkNotHandledByRegisteredApps="DeeplinkNotHandledByRegisteredApps",e.DeeplinkTerminatedByApp="DeeplinkTerminatedByApp",e.ExecuteFromUrlFailed="ExecuteFromUrlFailed",e.IntentServiceExecutionFailed="IntentServiceExecutionFailed",e.InvalidDeepLinkUrl="InvalidDeepLinkUrl",e.OnBeforeDeeplinkParsedFailed="OnBeforeDeeplinkParsedFailed",e.ToNavigationIntentFailed="ToNavigationIntentFailed",e.InvalidOrigin="InvalidOrigin"}(Rt||(Rt={})),function(e){e.NavigationIntentNotFound="NavigationIntentNotFound"}(Pt||(Pt={}));var Lt=i(80719),Ut=i(628556);const Wt="https://teams.microsoft.com/l",Bt="/task/",$t="/stage/",Ht="/entity/",qt="context",zt="application/vnd.microsoft.card.adaptive",Vt=(e,t,i)=>{const n=e=>null==i?void 0:i(e);return e.executeCommand(t.entity,{entityCommand:t.command,entityOptions:t.entityOptions}).subscribe({complete:n,error:n}),Promise.resolve()},Gt=(e,t,i,n,o,r)=>{const s=e.executeCommand(t.entity,{entityCommand:t.command,entityOptions:t.entityOptions}),a=i.newScenario(U.RG.ExtTaskModuleLaunch),l=Lt.gV.DeepLink;return s.subscribe({complete:()=>{n.log(`task module complete for entrypoint ${l}`),a.stop(Qt(o,l)),r&&r()},error:e=>{n.error(`error launching task module for entry point ${l}.  Error:`,e),a.fail(Qt(o,l,e)),r&&r(e)},next:e=>{e.containerState===ve.oq.Open&&a.stop(Qt(o,l))}}),Promise.resolve()},Jt=(e,t)=>{const i=new URL(e).pathname.split("/");if(i.length===t){const[,,e,t,n]=i;return!(!e||!t)}return!1},Kt=e=>!(!e||!e.startsWith(Wt)),Qt=(e,t,i)=>{const n={};return e&&(n["App.Id"]=e),t&&(n["App.EntryPoint"]=Lt.gV[t]),i&&(n.errors=i),n},Yt=(e,t)=>{if(!t)throw new Error("Could not find app context");switch(e.type){case pe.py.extensions:return Object.assign(Object.assign({},t),{type:Ut.p.tab});case pe.py.channels:return Object.assign(Object.assign({},t),{type:Ut.p.channel});case pe.py.chats:return Object.assign(Object.assign({},t),{type:Ut.p.chat});default:throw new Error("unsupported launch context")}},Xt=e=>!!e&&"0"!==e,Zt=e=>e?JSON.parse(e):{},ei=(e,t)=>{switch(e&&e.type){case pe.py.extensions:return ni(e);case pe.py.chats:return{chatId:e.id||""};case pe.py.channels:{const{channelId:i,replyChainId:n}=Zt(e.id);return{channelId:i,parentMessageId:n,chatId:ii(n,i,t),meetingId:ti(i,n),channelMeetingMessageId:n}}default:return}},ti=(e,t)=>{if(e){const i=e.split(";")[0];return Xt(t)?btoa(`0#${i}#${t}`):btoa(`0#${i}#0`)}return""},ii=(e,t,i)=>Xt(e)&&i?t.includes("messageid")?t:`${t};messageid=${e}`:t,ni=e=>{if(e.linkedEntity)switch(e.linkedEntity.type){case pe.py.chats:return{chatId:e.linkedEntity.id};case pe.py.channels:{const{channelId:t,replyChainId:i}=Zt(e.linkedEntity.id);return{channelId:t,parentMessageId:i,channelMeetingMessageId:i}}case pe.py.extensions:return e.linkedEntity.id?JSON.parse(e.linkedEntity.id):void 0}},oi=(e,t)=>{const i=e.search.indexOf("=")+1,n=e.search.substring(i)||"",o=decodeURIComponent(n),{contentUrl:r,websiteUrl:s,removeUrl:a,name:l}=JSON.parse(o);return{type:"tab/tabInfoAction",tabInfo:{contentUrl:r,websiteUrl:s,removeUrl:a,name:l,entityId:t}}},ri=e=>{const t=e.search.indexOf("?")+1;return(e.search.substring(t)||"").split("&").reduce(((e,t)=>{const[i,n]=t.split("="),o=decodeURIComponent(n);return Object.assign(Object.assign({},e),{[i]:(0,L.isString)(i)&&"card"===i.toLowerCase()?si(o):o})}),{})},si=e=>{try{const t=JSON.parse(e),i=(0,L.isString)(t.contentType)&&t.contentType.toLowerCase()===zt.toLowerCase(),n=(0,L.isString)(t.type)&&"adaptivecard"===t.type.toLowerCase();return i?{content:JSON.stringify(t.content),contentType:t.contentType}:n?{content:e,contentType:zt}:null}catch(e){return null}};class ai{constructor(e,t,i,n,o,r,s,a,l,c){this.host=e,this.commandHandler=t,this.extensionCommandingService=i,this.scenarioFactory=n,this.deeplinkService=r,this.coreSettings=s,this.executionContext=a,this.sourceViewEntity=l,this.clientLaunchId=c,this.logger=o.newLogger("DeepLinkCommandingService","core-services-entity-commanding")}checkForPendingDeeplink(e,t){return this.deeplinkService.checkForPendingIntent(e,this.clientLaunchId,null!=t?t:this.executionContext.userContextId)}launchMainApp(e,t,i){return this.deeplinkService.launchMainApp(e,this.clientLaunchId,t,i)}launchMinimode(e,t){return this.deeplinkService.launchMinimode(e,this.clientLaunchId,t)}switchAccount(e,t,i,n,o){return this.deeplinkService.switchAccount(e,t,this.clientLaunchId,i,n,o)}prewarmFlyout(e){return this.deeplinkService.prewarmFlyout(e)}prewarmMinimode(e){return this.deeplinkService.prewarmFlyout(e,!0)}executeFromUrlV2(e,t,i){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log(`executeFromUrlV2::deepLink::'${e}'`);const o=this.allowV2Flow(e),s=(0,Ot.Qb)(e,this.coreSettings);if(!o)return!1;try{return yield this.deeplinkService.executeFromUrlAsync(e,t,i,this.clientLaunchId,this.executionContext,this.sourceViewEntity,s)}catch(e){const t=`DeepLinkCommanding:: ${Rt.ExecuteFromUrlFailed} ${(0,M.u4)(e)}`;throw null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,t,"webclient_framework_foundation_core_services_deeplink",void 0,!0),new Error(t)}}))}executeDeepLinkFromUrl(e,t,i,n){var r,s,a,l;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.coreSettings.get(b.J.Core).forceHostOpenForDeepLink&&this.host.open(e);const o=!!(null===(r=this.coreSettings.get(b.J.Core))||void 0===r?void 0:r.handleInternalDeepLinks),c=!!(null===(s=this.coreSettings.get(b.J.Extensibility))||void 0===s?void 0:s.enableChatIdChangeInGetContextCall);try{if(yield this.executeFromUrlV2(e,i,void 0))return}catch(e){null===(l=(a=this.logger).errorToTelemetry)||void 0===l||l.call(a,null==e?void 0:e.message,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}const d=this.createEntityCommandFromDeepLink(e,t,c);return d?((e,t,i,n,o,r,s)=>{switch(e.entity.type){case pe.py.taskmodule:const a=new URL(t),[,,,l]=a.pathname.split("/");return Gt(n,e,r,o,l,s);case pe.py.platformStage:return Vt(n,e,s);default:return i(e)}})(d,e,this.commandHandler,this.extensionCommandingService,this.logger,this.scenarioFactory,n):o?void this.host.open(e):this.host.opener.open(Ft.B.OpenOnMainRenderer,Ft._.DeepLink,{url:e})}))}executeIntent(e){var t;return this.deeplinkService.executeIntent(Object.assign(Object.assign({},e),{metadata:Object.assign({userContextId:null!==(t=e.metadata.userContextId)&&void 0!==t?t:this.executionContext.userContextId},e.metadata)}))}createEntityCommandFromDeepLink(e,t,i){return Jt(e,4)&&(e=>{if(Kt(e))return e.substr(29).toLowerCase().substring(0,6)===Bt;return!1})(e)?((e,t,i)=>{const n=(0,xe.v4)(),o=new URL(e),[,,,r]=o.pathname.split("/"),s={entryPoint:Lt.gV.DeepLink,appId:r,taskInfo:ri(new URL(e))};return{entity:{id:n,type:pe.py.taskmodule,action:pe.uk.create},command:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.ExtensionCommanding}},entityOptions:{input:s,launchContext:Yt(t,ei(t,i))}}})(e,t,i):(e=>Jt(e,5))(e)&&(e=>!!Kt(e)&&e.substr(29).toLowerCase().substring(0,7)===$t)(e)?(e=>{try{const t=new URL(e),[,,,i]=t.pathname.split("/"),n=(0,xe.v4)();return{entity:{id:n,type:pe.py.platformStage,action:pe.uk.view},command:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.ExtensionCommanding}},entityOptions:{appId:i,tabInfo:JSON.stringify(oi(t,n))}}}catch(e){return null}})(e):null}allowV2Flow(e){var t,i;return!!(this.coreSettings.get(b.J.Extensibility).handleDeepLinkToMeetingSidePanel&&(e=>{if(!Jt(e,5))return!1;const{searchParams:t}=new URL(e),i=t.has(qt)&&t.get(qt);if(!i)return!1;try{const e=JSON.parse(decodeURIComponent(i));return!(!e||!e.chatId||"chat"!==e.contextType&&"meeting"!==e.contextType||"false"===t.get("openInMeeting"))}catch(e){return!1}})(e)&&(i=e,Kt(i)&&i.substring(29).toLowerCase().substring(0,8)===Ht))||!!(null===(t=this.coreSettings.get(b.J.Core))||void 0===t?void 0:t.handleInternalDeepLinks)}}var li=i(523197),ci=i(674481),di=i(43023),ui=i(846005),mi=i(168731),gi=i(645941);const hi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CoreServicesEntityCommandingActiveWindowContainerStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"extendedEntityContainerState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"containerState"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExtendedContainerState"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isExternal"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExtendedEntityContainerState"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActiveEntities"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}}]}}]},pi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindowBlockingExtension"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"blockingEntityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"action"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"BlockingEntityExtension"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}}]}}]},vi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"addBlockingExtension"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"removeBlock"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addBlockingExtension"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"removeBlock"},value:{kind:"Variable",name:{kind:"Name",value:"removeBlock"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}}]};class yi{constructor(e,t,i,n,o,r,s){this.commandHandler=e,this.client=t,this.windowId=i,this.scenarioFactory=n,this._coreSettings=r,this._windowLayoutService=s,this.subscribers=[],this.onDestroy=new mi.xQ,this.logger=o.newLogger("ExtensionCommandingService","core-services-entity-commanding")}destroy(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{this.onDestroy.next(),this.reset()}catch(e){this.logger.warn(`Unable to destroy, error ocurred in persisting delete of extension entity. e.name: ${e.name}, e.message: ${e.message}`)}}))}executeCommand(e,t){const i=(null==t?void 0:t.entityCommand)||{stateTransition:ve.su.none,visibilityState:ve.fe.show,correlation:{source:k.D.ExtensionCommanding}};i.stateTransition=ve.su.extend;const n={entity:e,command:i,entityOptions:null==t?void 0:t.entityOptions};return this.processRequest(n)}addBlockingExtension(e,t,i=!1){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!i&&(yield this.isWindowBlocked()))return void this.logger.log("Window is currently blocked, addBlockingExtension no-op");this.logger.log(`addBlockingExtension, requesting an extension of type ${e.type} to block the window`);const n={entity:e,entityOptions:JSON.stringify(t),windowId:this.windowId,removeBlock:i};yield this.client.mutate({mutation:vi,variables:n})}))}isBlockedByEntity(e){return this._windowLayoutService.modalManager.isBlockedByEntity(e)}isWindowBlocked(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enableDecoupleCommandingFromApollo:e}=this._coreSettings.get(b.J.Core);if(e)return this._windowLayoutService.modalManager.isBlockingEntityExtension();const{data:t}=yield this.client.query({query:pi,variables:{windowId:this.windowId}});return!!t.activeWindow.blockingEntityExtension}))}pipeWhileStateIsValid(e,t){return e.pipe((0,li.R)(this.onDestroy),(0,ci.o)((e=>e.hasEntityExtension),!0),t,(0,di.G)(),(0,ci.o)((([e,t])=>{const i=t.containerState,n=t.hasEntityExtension,o=e.containerState,r=i===ve.oq.Confirmed,s=i===ve.oq.Cancelled,a=i===ve.oq.Error,l=i===ve.oq.Closed,c=o===ve.oq.Open;return n&&!r&&!s&&!a&&!(c&&l)}),!0),(0,c.U)((([,e])=>({containerState:e.containerState}))))}processRequest(e){this.scenarioFactory.newScenario(U.RG.ExtensionOpen);const t=this._windowLayoutService.enableDecoupleCommandingFromApollo,i=t?this._windowLayoutService.modalManager.observeContainerState().pipe():this.observeContainerState(this.client,this.windowId),n=this.pipeWhileStateIsValid(i,t?(0,ui.O)({hasEntityExtension:!1,containerState:ve.oq.Closed}):(0,g.b)());this.commandHandler(e).then((()=>{n.subscribe({next:e=>{this.stopActiveScenario(e.containerState),this.nextSubscriber(e),e.containerState===ve.oq.Error&&this.resetSubscriber((0,se.Tr)("ExtensionCommanding",f.jK.Unknown,`ExtendedContainerState ${e.containerState}`,void 0,"Error processing entity extension"))},complete:()=>{this.resetSubscriber()},error:e=>{this.resetSubscriber(e)}})})).catch((e=>{this.resetSubscriber(e)}));return new gi.y((e=>{this.subscribers.push(e)}))}nextSubscriber(e){this.subscribers.forEach((t=>t.next(e)))}resetSubscriber(e){const t=this.subscribers;this.reset(),e?(this.failActiveScenarios(),t.length&&t.forEach((t=>t.error(e)))):(this.stopActiveScenarios(),t.length&&t.forEach((e=>e.complete())))}reset(){this.subscribers=[]}stopActiveScenarios(){var e,t;null===(e=this.scenarioFactory.findScenario(U.RG.ExtensionClose))||void 0===e||e.stop(),null===(t=this.scenarioFactory.findScenario(U.RG.ExtensionOpen))||void 0===t||t.stop()}failActiveScenarios(){var e,t;null===(e=this.scenarioFactory.findScenario(U.RG.ExtensionClose))||void 0===e||e.fail(),null===(t=this.scenarioFactory.findScenario(U.RG.ExtensionOpen))||void 0===t||t.fail()}stopActiveScenario(e){switch(e){case ve.oq.Error:this.failActiveScenarios();break;case ve.oq.Open:case ve.oq.Closed:case ve.oq.Cancelled:case ve.oq.Confirmed:this.stopActiveScenarios();break;default:this.logger.errorToTelemetry&&this.logger.errorToTelemetry(`Unable to stop active scenario, no case mapped to container state provided: ${e}`,"webclient_framework_foundation_core_services_extension_commanding",void 0,!0)}}observeContainerState(e,t){return(0,he.G)(this.watchActiveWindow(e,t)).pipe((0,c.U)((({data:e})=>{var t;return{containerState:e.activeWindow.extendedEntityContainerState.containerState,hasEntityExtension:!!(null===(t=e.activeWindow.activeEntities.entityExtension)||void 0===t?void 0:t.type)}})))}watchActiveWindow(e,t){return e.watchQuery({query:hi,variables:{windowId:t}})}}const fi=({activeWindowsService:e,appsRegistryService:t,authenticationUser:i,client:n,clientLaunchId:r,clientPreferences:s,commandChangeReportingService:a,coreSettings:l,entityCommandInput:c,executionContext:d,experienceChangeReportingService:u,loggerFactory:m,notificationsHandler:g,platformService:h,scenarioFactory:p,userBiService:v,userTrackingService:y,windowId:S,windowProvider:w})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var C,_;const T=m.newLogger("internalCommandHandler","core-services-entity-commanding"),I=null!==(_=null===(C=c.command)||void 0===C?void 0:C.__UNSAFE_windowId)&&void 0!==_?_:S;I!==S&&T.log(`window id overridden to ${I}`);let j=$e(function(e){const t=e.command||He({stateTransition:ve.su.none,visibilityState:ve.fe.show,correlation:{source:k.D.Unknown}});return Object.assign(Object.assign({},e),{command:t})}(c));const N=function(e,t){var i;return t&&e.getApp({entityType:null===(i=t.viewEntity)||void 0===i?void 0:i.type})}(t,d),E=function(e,t){return e.getApp({entityType:t.entity.type})}(t,j);!function({commandChangeReportingService:e,entityCommand:t,logger:i,sourceApp:n,renderingApp:o,coreSettings:r,clientPreferences:s}){t.entity.type===pe.py.default&&(t.command.correlation.scenarioName=U.RG.DefaultCommand),n&&Be({appName:n.manifest.name,commandChangeReportingService:e,entityCommand:t,getCommandScenarioName:n.getCommandScenarioNameFromSource,logger:i,coreSettings:r,clientPreferences:s}),o&&Be({appName:o.manifest.name,commandChangeReportingService:e,entityCommand:t,getCommandScenarioName:o.getCommandScenarioName,logger:i,coreSettings:r,clientPreferences:s})}({commandChangeReportingService:a,entityCommand:j,renderingApp:E,sourceApp:N,logger:T,coreSettings:l,clientPreferences:s});const x=j.command.correlation.id;if(function({commandChangeReportingService:e,entityCommand:t,executionContextEntity:i}){const n=t.command.correlation.id;e.report({type:Ae.B.CommandStart,correlationId:n,context:{target:"internal-command-handler",entityCommand:t,executionContextEntity:i}})}({commandChangeReportingService:a,entityCommand:j,executionContextEntity:null==d?void 0:d.viewEntity}),E){const e=function(e,t,i,n,o,r,s){return{client:e,coreSettings:t,loggerFactory:i,platformService:n,scenarioFactory:o,userBiService:r,userTrackingService:s}}(n,l,m,h,p,v,y),t=w||void 0,i=yield function({app:e,commandChangeReportingService:t,entityCommand:i,hookRequestContext:n,logger:r,windowProvider:s,notificationsHandler:a}){var l;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o=i;if(e.onBeforeCommandHandled){const c=i.command.correlation,d=c.id,u="internal-command-handler-execute-before-command-handled-hook";t.report({type:Ae.B.ApplicationHookReceivedCommand,context:{target:u},correlationId:d});try{const t={entityCommand:i,requestContext:n,windowProvider:s||void 0,notificationsHandler:Pe(e)&&a?a:void 0};o=yield e.onBeforeCommandHandled(t)}catch(i){const n=`Command 'onBeforeCommandHandled' rejected. An attempt to handle the command was made by app:${e.manifest.name}, but failed. Error: ${(0,re.A)((0,se.VK)(i))}`;return null===(l=r.errorToTelemetry)||void 0===l||l.call(r,n,"webclient_framework_foundation_core_services_internal_command_handler",void 0,!0),t.report({type:Ae.B.Failure,context:{errorInfo:De.y.OnBeforeCommandHandledRejected,errorMessage:n,target:u},correlationId:d}),Promise.reject(i)}void 0!==o&&(t.report({type:Ae.B.ApplicationHookContinuedCommand,context:{target:u},correlationId:d}),o.command.correlation=c,t.report({type:Ae.B.CommandStart,correlationId:d,context:{target:u,entityCommand:o}}))}return Promise.resolve(o)}))}({app:E,commandChangeReportingService:a,entityCommand:j,hookRequestContext:e,logger:T,windowProvider:t,notificationsHandler:g});j=i}if(!j)return a.report({type:Ae.B.CommandHandledPriorToResolution,context:{target:"internal-command-handler"},correlationId:x}),Promise.resolve(void 0);const{enableDecoupleCommandingFromResolvers:A}=l.get(b.J.Core);if(A){const n=yield(({activeWindowsService:e,commandChangeReportingService:t,coreSettings:i,entityCommand:n,executionContext:r,loggerFactory:s,authenticationUser:a,windowId:l=f.ew})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var o,c;const{enableDecoupleCommandingFromResolversExtend:d}=i.get(b.J.Core);if(!d)return!1;const u=s.newLogger("dispatchCommand","core-services-entity-commanding");t.report({correlationId:n.command.correlation.id,type:Ae.B.CommandResolutionStarted,context:{target:"executeEntityCommand"}}),u.log(`Command received for entity ${JSON.stringify(n.entity)}`),u.log(`Command received :${JSON.stringify(n.command)}`),u.log(`Command with id ${n.command.correlation.id} received on window context ${l}`),u.log(`Command received with execution context: ${null==r?void 0:r.viewEntityName}`);const m=(null==r?void 0:r.userContextId)||a&&(0,Ee.b4)(a)||"extend"===n.command.stateTransition&&(null===(o=e.getStandardMainWindow())||void 0===o?void 0:o.id)&&(null===(c=e.getStandardMainWindow())||void 0===c?void 0:c.userContextId)||null;if("extend"===n.command.stateTransition){const t=n.command.correlation;e.executeCommand("handleExtendCommand")({correlation:t,entity:Object.assign(Object.assign({},n.entity),{options:JSON.stringify(n.entityOptions)}),userContextId:m,windowId:l})}return!0})))({activeWindowsService:e,appsRegistryService:t,authenticationUser:i,clientLaunchId:r,clientPreferences:s,commandChangeReportingService:a,coreSettings:l,entityCommand:j,executionContext:d,experienceChangeReportingService:u,loggerFactory:m,notificationsHandler:g,scenarioFactory:p,windowId:I,windowProvider:w});if(n)return void T.log("Command was handled without resolvers")}return function({entityCommand:e,mutateContext:{client:t,executionContext:i,windowId:n,clientLaunchId:o}}){return t.mutate({mutation:Le,variables:Object.assign(Object.assign({},e),{entityOptions:JSON.stringify(e.entityOptions),executionContext:i,windowId:n,clientLaunchId:o}),fetchPolicy:"no-cache"}).then((e=>{var t,i;return null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.executeEntityCommand)||void 0===i?void 0:i.id}))}({entityCommand:j,mutateContext:{client:n,executionContext:d,windowId:I,clientLaunchId:r}})}));var Si=i(141330);class ki{constructor(e){this.commandHandler=e}trigger(e){return this.commandHandler({entity:wi(e.entity),command:Ii(e.command)})}}const bi=e=>{switch(e){case Si.uk.view:return pe.uk.view;case Si.uk.list:return pe.uk.list;case Si.uk.default:return pe.uk.default;default:throw(0,se.Tr)(f.w5.Commanding,f.jK.NotImplemented,"Nova",void 0,`Mapping for Nova action type ${e} not implemented in Teams!`)}},wi=e=>{switch(e.type){case Si.py.identity:return Ci(e);case Si.py.teams_chat:return{type:pe.py.chats,id:e.entityId,action:bi(e.action)};case Si.py.teams_channel:return{type:pe.py.channels,id:e.entityId,action:bi(e.action)};case Si.py.office_home:return{type:pe.py.communitiesonboarding,id:e.entityId,action:bi(e.action)};case Si.py.office_people:return{type:pe.py.homepage,id:e.entityId,action:bi(e.action)};case Si.py.teams_activity:return{type:pe.py.activity,id:e.entityId,action:bi(e.action)};case Si.py.teams_calendar:return{type:pe.py.calendar,id:e.entityId,action:bi(e.action)};case Si.py.teams_meet:return{type:pe.py.meet,id:e.entityId,action:bi(e.action)};case Si.py.m365_app:return{type:pe.py.extensions,id:e.entityId,action:bi(e.action)};case Si.py.teams_calling:return{type:pe.py.callsmain,id:e.entityId,action:pe.uk.view};default:throw(0,se.Tr)(f.w5.Commanding,f.jK.NotImplemented,"Nova",void 0,`Mapping for Nova entity type ${e.type} not implemented in Teams!`)}},Ci=e=>{switch(e.action){case Si.uk.signout:return{type:pe.py.signoutdialog,id:e.entityId,action:pe.uk.view};case Si.uk.updateProfilePicture:return{type:pe.py.updatemsaprofileavatardialog,id:e.entityId,action:pe.uk.view};case Si.uk.updateDisplayName:return{type:pe.py.updatemsaprofilenamedialog,id:e.entityId,action:pe.uk.view};default:throw(0,se.Tr)(f.w5.Commanding,f.jK.NotImplemented,"Nova",void 0,`Mapping for Nova identity entity with action type ${e.action} not implemented in Teams!`)}},_i=e=>{switch(e){case Si.fe.hide:return ve.fe.hide;case Si.fe.show:return ve.fe.show;case Si.fe.toggle:return ve.fe.toggle}},Ti=e=>{switch(e){case Si.su.extend:return ve.su.extend;case Si.su.flush:return ve.su.flush;case Si.su.forceFlush:return ve.su.forceFlush;case Si.su.new:return ve.su.new;case Si.su.none:return ve.su.none}},Ii=e=>({visibilityState:_i(e.visibilityState),stateTransition:Ti(e.stateTransition),correlation:{source:k.D.Nova}});var ji=i(388522),Ni=i(257558),Ei=i(781662);class xi{constructor(e,t,i,n,o,r,s){this.commandHandler=e,this.extensionCommanding=t,this.hostCommunicationService=i,this.windowId=n,this.host=o,this.coreSettings=r,this._logger=s.newLogger("ShellCommandingService","core-services-entity-commanding")}bringWindowToFront(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.hostCommunicationService.loadModule("osutils");return this._logger.log(`Performing action: bringWindowToFront on ${e}`),(null===(t=null==i?void 0:i.bringWindowToFront)||void 0===t?void 0:t.call(i,e))||Promise.resolve(!1)}))}desktopActiveCallDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.appswitcherdesktopactivecalldialog,action:pe.uk.view},{entityCommand:e})}desktopNotice(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.hostCommunicationService.loadModule("osutils");return this._logger.log("Performing action: desktopNotice"),null===(e=null==t?void 0:t.openThirdPartyNotice)||void 0===e?void 0:e.call(t)}))}dismissBanner(e,t=k.D.Unknown){return this.dismissNotification(e,pe.py.bannerNotification,t)}dismissToast(e,t=k.D.Unknown){return this.dismissNotification(e,pe.py.inAppToast,t)}executeNotificationAction(e,t,i,n,o){var r,s;let a;try{a=JSON.parse(n)}catch(e){return null===(s=(r=this._logger).errorNoPii)||void 0===s||s.call(r,`Notification command can't be parsed: ${n}`),Promise.resolve()}return o?this.dismissNotification(e,t,i):t===pe.py.bannerNotification&&(a.entityOptions=Object.assign(Object.assign({},a.entityOptions),{bannerId:e})),this.commandHandler(a)}exitFullscreen(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.coreSettings.get(b.J.Core).routeWindowActionsThroughHostComms)return this.host.exitFullscreen(),Promise.resolve();this.host.document.exitFullscreen().then((()=>(this._logger.log("WindowAction[exitFullscreen] succeeded."),Promise.resolve()))).catch((e=>{const t=(0,re.A)(null==e?void 0:e.message);return this._logger.error(`WindowAction[exitFullscreen] failed due to: ${t}.`),Promise.reject(t)}))}))}getScreenshots(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: getScreenshots on ${this.windowId}`),null===(i=null==n?void 0:n.getScreenshots)||void 0===i?void 0:i.call(n,e,t)}))}installAndLaunchT1(){var e,t,i,n,r,s,a;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield this.hostCommunicationService.loadModule("appswitcher"),l=yield null===(e=null==o?void 0:o.downloadAndInstallPearApp)||void 0===e?void 0:e.call(o,ji.OP.Teams1);switch(null==l?void 0:l.status){case ji.cw.DownloadedAndInstalled:yield this.launchT1AndQuitT2(!0),this._logger.log("T1 is downloaded and installed");break;case ji.cw.FailedToDownload:null===(i=(t=this._logger).errorNoPii)||void 0===i||i.call(t,`T1 failed to download: ${null==l?void 0:l.errorMessage}`);break;case ji.cw.FailedToInstall:null===(r=(n=this._logger).errorNoPii)||void 0===r||r.call(n,`T1 failed to install: ${null==l?void 0:l.errorMessage}`);break;default:null===(a=(s=this._logger).errorNoPii)||void 0===a||a.call(s,`T1 download and install failed: ${null==l?void 0:l.errorMessage}`)}}))}joinLinkDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.joinlinkdialog,action:pe.uk.view},{entityCommand:e,entityOptions:t})}launchT1AndQuitT2(e,t){var i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield this.hostCommunicationService.loadModule("appswitcher");e&&(this._logger.log("launchT1AndQuitT2, Switcher default app to T1"),yield null===(i=null==o?void 0:o.switchDefaultAppTo)||void 0===i?void 0:i.call(o,ji.OP.Teams1)),this._logger.log("launchT1AndQuitT2, launch T1"),yield null===(n=null==o?void 0:o.launchPearApp)||void 0===n?void 0:n.call(o,ji.OP.Teams1,t),this._logger.log("Flushing T2 telemetry events"),yield(0,Ei.G)().flush(),this._logger.log("launchT1AndQuitT2, quit T2"),yield null===(r=null==o?void 0:o.quitApp)||void 0===r?void 0:r.call(o)}))}setWindowControlsTheme(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.hostCommunicationService.loadModule("windowcontrols");return null===(t=null==i?void 0:i.setCustomFrameOptions)||void 0===t?void 0:t.call(i,this.windowId,{titleBarMode:Ni.i$.ButtonsOnly,theme:e})}))}licenseRequestDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.licenserequestdialog,action:pe.uk.view},{entityCommand:e,entityOptions:t})}maximizeWindow(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.coreSettings.get(b.J.Core).routeWindowActionsThroughHostComms)return this.host.maximize();const t=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: maximizeWindow on ${this.windowId}`),null===(e=null==t?void 0:t.maximize)||void 0===e?void 0:e.call(t,this.windowId)}))}minimizeWindow(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.coreSettings.get(b.J.Core).routeWindowActionsThroughHostComms)return this.host.minimize();const t=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: maximizeWindow on ${this.windowId}`),null===(e=null==t?void 0:t.minimize)||void 0===e?void 0:e.call(t,this.windowId)}))}msaProfileAvatarUpdateDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.updatemsaprofileavatardialog,action:pe.uk.view},{entityCommand:e})}msaProfileNameUpdateDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.updatemsaprofilenamedialog,action:pe.uk.view},{entityCommand:e})}noticeDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.tpndialog,action:pe.uk.view},{entityCommand:e})}openFreDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.officeintegrationfredialog,action:pe.uk.info},{entityCommand:e})}premiumTrialDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.premiumtrialdialog,action:pe.uk.view},{entityCommand:e,entityOptions:t})}requestFullscreen(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.coreSettings.get(b.J.Core).routeWindowActionsThroughHostComms)return this.host.requestFullscreen(),Promise.resolve();this.host.document.documentElement.requestFullscreen().then((()=>(this._logger.log("WindowAction[requestFullscreen] succeeded."),Promise.resolve()))).catch((e=>{const t=(0,re.A)(null==e?void 0:e.message);return this._logger.error(`WindowAction[requestFullscreen] failed due to: ${t}.`),Promise.reject(t)}))}))}restoreWindow(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: restoreWindow on ${this.windowId}`),null===(e=null==t?void 0:t.restore)||void 0===e?void 0:e.call(t,this.windowId)}))}setMinimumWindowSize(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.hostCommunicationService.loadModule("windowcontrols");return null===(i=null==n?void 0:n.setMinimumWindowSize)||void 0===i?void 0:i.call(n,this.windowId,e,t)}))}setWindowBounds(e,t,i,n){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield this.hostCommunicationService.loadModule("windowcontrols");return null===(r=null==o?void 0:o.setWindowBounds)||void 0===r?void 0:r.call(o,this.windowId,Math.trunc(e),Math.trunc(t),Math.trunc(i),Math.trunc(n))}))}showContextMenu(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: showContextMenu on ${this.windowId} and position ${e}`),null===(t=null==i?void 0:i.showTitleBarContextMenu)||void 0===t?void 0:t.call(i,this.windowId,e)}))}showBanner(e){var{id:t,dismissable:i=!0,duration:n=4,source:r=k.D.Unknown}=e,s=(0,o.__rest)(e,["id","dismissable","duration","source"]);return this.commandHandler({command:{correlation:{source:r},stateTransition:ve.su.none,visibilityState:ve.fe.show},entity:{type:pe.py.bannerNotification,action:pe.uk.create,id:t},entityOptions:Object.assign(Object.assign({},s),{dismissable:i,duration:n})})}showToast(e){var{id:t,duration:i=7e3,source:n=k.D.Unknown}=e,r=(0,o.__rest)(e,["id","duration","source"]);return this.commandHandler({command:{correlation:{source:n},stateTransition:ve.su.none,visibilityState:ve.fe.show},entity:{type:pe.py.inAppToast,action:pe.uk.create,id:t},entityOptions:Object.assign(Object.assign({},r),{duration:i})})}signOutDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.signoutdialog,action:pe.uk.view},{entityCommand:e})}startWindowDragListener(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: startWindowDragListener on ${this.windowId}`),null===(e=null==t?void 0:t.startWindowDragListener)||void 0===e?void 0:e.call(t,this.windowId)}))}swapMeetingRoomFrontOfRoomWindows(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log("Performing action: swapMeetingRoomFrontOfRoomWindows"),null===(e=null==t?void 0:t.swapMeetingRoomFrontOfRoomWindows)||void 0===e?void 0:e.call(t)}))}switchDefaultAppTo(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.hostCommunicationService.loadModule("appswitcher");this._logger.log(`switchDefaultAppTo ${e}`),yield null===(t=null==i?void 0:i.switchDefaultAppTo)||void 0===t?void 0:t.call(i,e)}))}t1DownloadDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.appswitchert1downloaddialog,action:pe.uk.view},{entityCommand:e})}webActiveCallDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.appswitcherwebactivecalldialog,action:pe.uk.view},{entityCommand:e})}webMultipleTabsDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.appswitcherwebmultipletabsdialog,action:pe.uk.view},{entityCommand:e})}zoomInWindow(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomInWindow on ${this.windowId}`),null===(e=null==t?void 0:t.zoomIn)||void 0===e?void 0:e.call(t,this.windowId)}))}zoomOutWindow(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomOutWindow on ${this.windowId}`),null===(e=null==t?void 0:t.zoomOut)||void 0===e?void 0:e.call(t,this.windowId)}))}zoomResetWindow(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomResetWindow on ${this.windowId}`),null===(e=null==t?void 0:t.zoomReset)||void 0===e?void 0:e.call(t,this.windowId)}))}dismissNotification(e,t,i=k.D.Unknown){return this.commandHandler({command:{correlation:{source:i},stateTransition:ve.su.none,visibilityState:ve.fe.hide},entity:{type:t,action:pe.uk.delete,id:e}})}}var Ai,Di=i(661424),Fi=i(469980);!function(e){e.unknown="unknown",e.toast="toast",e.activity="activity"}(Ai||(Ai={}));var Oi=i(653266),Mi=i(428768);class Ri{constructor(e,t){this.commandHandler=e,this.userContextId=t}showMessage(e,{collectionId:t,conversationId:i,mainImage:n,discardDuringMeetingsAndCalls:o,messageId:r,quickReply:s,quickReplyButton:a,quickReplyPlaceholder:l,text:c,time:d,title:u,isUrgent:m,isFromPriorityContact:g,externalAppIconType:h}){const p={collectionId:t,isUrgent:g||m,mainImage:n,discardDuringMeetingsAndCalls:o,targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,messageId:r,userContextId:this.userContextId,toastType:Pi(i)?"phoneLinkSmsToast":void 0},id:i,type:S.dt.chats},textInput:s?Li(i,a,l,this.userContextId):void 0,text:c,time:d,title:u,telemetryClientId:e,externalAppIconType:h},v={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:d.valueOf(),scenarioName:U.RG.CrossClientToastView},stateTransition:ve.su.new,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:p};return this.commandHandler(v)}showReminder(e,{collectionId:t,conversationId:i,mainImage:n,messageId:o,text:r,time:s,title:a,buttonText:l,type:c}){const d={collectionId:t,mainImage:n,targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,messageId:o,userContextId:this.userContextId,toastType:c},id:i,type:S.dt.reminders},textInput:void 0,text:r,time:s,title:a,telemetryClientId:e,buttons:[{targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,messageId:o,userContextId:this.userContextId},id:i,type:S.dt.reminders},text:l}]},u={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:s.valueOf()},stateTransition:ve.su.new,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:d};return this.commandHandler(u)}showChatTabEntityNotification(e,{collectionId:t,conversationId:i,mainImage:n,tabId:o,text:r,time:s,title:a}){const l={collectionId:t,mainImage:n,targetEntity:{id:o,type:S.dt.extensions,action:S.A$.view,dataOptions:{actionType:Di.u.unknown,userContextId:this.userContextId},linkedEntity:{id:i,action:S.A$.view,type:S.dt.chats}},text:r,time:s,title:a,telemetryClientId:e},c={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:s.valueOf()},stateTransition:ve.su.flush,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:l};return this.commandHandler(c)}showChannelsNotification(e,{collectionId:t,conversationId:i,mainImage:n,discardDuringMeetingsAndCalls:o,messageId:r,text:s,time:a,title:l,replyChainId:c}){const d={collectionId:t,mainImage:n,discardDuringMeetingsAndCalls:o,targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,messageId:r,userContextId:this.userContextId,focusOnLoad:Fi.t.DoNotMove},id:JSON.stringify({channelId:i,replyChainId:c,deepLinkId:c}),type:S.dt.channels},text:s,time:a,title:l,telemetryClientId:e},u={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:a.valueOf(),scenarioName:U.RG.CrossClientToastView},stateTransition:ve.su.new,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:d};return this.commandHandler(u)}showCommunitiesNotifications(e,{collectionId:t,conversationId:i,mainImage:n,messageId:o,text:r,time:s,title:a,replyChainId:l,type:c}){const d={collectionId:t,mainImage:n,targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,messageId:o,userContextId:this.userContextId,toastType:c,teamId:i,deepLinkId:o},id:JSON.stringify({channelId:i,replyChainId:l}),type:S.dt.communities},text:r,time:s,title:a,telemetryClientId:e},u={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:s.valueOf()},stateTransition:ve.su.new,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:d};return this.commandHandler(u)}showCommunitiesMembersViewNotifications(e,{collectionId:t,conversationId:i,mainImage:n,text:o,time:r,title:s,type:a}){const l={collectionId:t,mainImage:n,targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,userContextId:this.userContextId,toastType:a,teamId:i},id:i,type:S.dt.communitiesmembers},text:o,time:r,title:s,telemetryClientId:e},c={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:r.valueOf()},stateTransition:ve.su.new,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:l};return this.commandHandler(c)}showCommunitiesMemberRequestsNotifications(e,{collectionId:t,conversationId:i,mainImage:n,text:o,time:r,title:s,type:a}){const l={collectionId:t,mainImage:n,targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,userContextId:this.userContextId,toastType:a,teamId:i},id:i,type:S.dt.communitiesjoinrequest},text:o,time:r,title:s,telemetryClientId:e},c={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:r.valueOf()},stateTransition:ve.su.new,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:l};return this.commandHandler(c)}showCommunitiesCalendarEventsNotifications(e,{collectionId:t,conversationId:i,mainImage:n,text:o,time:r,title:s}){const a={collectionId:t,mainImage:n,targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,userContextId:this.userContextId},id:JSON.stringify({channelId:i}),type:S.dt.communitiesevents},text:o,time:r,title:s},l={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:r.valueOf()},stateTransition:ve.su.new,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:a};return this.commandHandler(l)}showEspSyntheticNotification(e,{collectionId:t,mainImage:i,text:n,time:o,title:r,campaignType:s}){let a;if(s){if(s===Oi.mL.files){const l="newchat";a={collectionId:t,mainImage:i,targetEntity:{type:S.dt.chats,action:S.A$.view,id:l,dataOptions:{actionType:Ai.toast,userContextId:this.userContextId,campaignType:s}},text:n,time:o,title:r,telemetryClientId:e}}else a={collectionId:t,mainImage:i,targetEntity:{type:S.dt.campaignnotifications,action:S.A$.view,id:s,dataOptions:{actionType:Ai.toast,userContextId:this.userContextId}},text:n,time:o,title:r,telemetryClientId:e};const l={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:o.valueOf()},stateTransition:ve.su.flush,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:a};return this.commandHandler(l)}{const t={targetEntity:{dataOptions:{actionType:Di.u.view,userContextId:this.userContextId,focusOnLoad:Fi.t.DeeplinkedMessage},action:S.A$.list,type:S.dt.activity},textInput:void 0,text:n,time:o,title:r,mainImage:i,telemetryClientId:e},s={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:o.valueOf()},stateTransition:ve.su.flush,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:t};return this.commandHandler(s)}}showGraphItemNotification(e,{collectionId:t,mainImage:i,discardDuringMeetingsAndCalls:n,text:o,time:r,title:s}){const a={collectionId:t,mainImage:i,discardDuringMeetingsAndCalls:n,targetEntity:{action:S.A$.list,dataOptions:{actionType:Di.u.view,userContextId:this.userContextId,focusOnLoad:Fi.t.DeeplinkedMessage},id:"msGraph",type:S.dt.activity},text:o,time:r,title:s,telemetryClientId:e},l={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:r.valueOf(),scenarioName:U.RG.CrossClientToastView},stateTransition:ve.su.flush,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:a};return this.commandHandler(l)}showReEngageNudge(e,{conversationId:t,text:i,time:n,title:o,type:r}){const s={targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.u.view,userContextId:this.userContextId,toastType:r},id:t,type:S.dt.reminders},textInput:void 0,text:i,time:n,title:o,telemetryClientId:e},a={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:n.valueOf()},stateTransition:ve.su.new,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:s};return this.commandHandler(a)}showLocalRecordingAssemblyNotification(e,{text:t,time:i,title:n,mainImage:o},r){const s={targetEntity:{action:S.A$.view,dataOptions:{actionType:Di.E.openInExplorer,userContextId:this.userContextId,fileId:r},id:"localRecordingAssembly",type:S.dt.activity},mainImage:o,textInput:void 0,text:t,time:i,title:n,telemetryClientId:e},a={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:i.valueOf()},stateTransition:ve.su.none,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:s};return this.commandHandler(a)}showMeetNowNudge(e,{conversationId:t,text:i,time:n,title:o,type:r,deeplinkUrl:s,deepLinkId:a}){const l={targetEntity:{action:S.A$.join,dataOptions:{actionType:Di.u.view,userContextId:this.userContextId,toastType:r,deeplinkUrl:s,coordinates:{joinType:"MeetingData",meetingData:{meetingUrl:s}},deepLinkId:a},id:t,type:S.dt.callingdeeplink},textInput:void 0,text:i,time:n,title:o,telemetryClientId:e},c={command:{correlation:{id:e,source:k.D.Notifications,startTimestamp:n.valueOf()},stateTransition:ve.su.flush,visibilityState:ve.fe.show},entity:{action:pe.uk.view,type:pe.py.toasts},entityOptions:l};return this.commandHandler(c)}}const Pi=e=>!!(null==e?void 0:e.startsWith(Mi.a.PhonelinkSmsPrefix)),Li=(e,t,i,n)=>({placeholderText:i||"Send a quick reply",sendButton:{text:t||"Send",targetEntity:{action:S.A$.mutate,type:S.dt.chats,dataOptions:{actionType:Di.u.quickReply,convId:e,userContextId:n,toastType:Pi(e)?"phoneLinkSmsToast":void 0}}}});class Ui{constructor(e){this.commandHandler=e}showAccounts(){return this.commandHandler({entity:{type:pe.py.accounts,action:pe.uk.list}})}}class Wi{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}default(e){return this.commandHandler({entity:{type:pe.py.activity,action:pe.uk.default},command:e})}empty(e){return this.commandHandler({entity:{type:pe.py.activity,action:pe.uk.empty},command:e})}launchDeleteActivityFeedItemDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.activity,action:pe.uk.delete},{entityCommand:e})}launchActivityErrorDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.activity,action:pe.uk.error},{entityCommand:t})}openEmptyFeedMainPane(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.activity,action:pe.uk.empty},command:t,scenarioEventData:i})}}var Bi=i(804589),$i=i(932289);const Hi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataAuthUserAuthStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAuthState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"state"},__type:{kind:"NamedType",name:{kind:"Name",value:"UserAuthState"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"reason"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isExpected"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"message"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"context"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"errorMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accountId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"cloud"},__type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationCloudType"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"IAuthLoginError"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"CustomError"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"UserAuthStateData"}}}]}}]},qi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataAuthEndPagesQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMRU"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userEndPageData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"Argument",name:{kind:"Name",value:"isMRU"},value:{kind:"Variable",name:{kind:"Name",value:"isMRU"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"email"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"pictureBlob"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"context"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"correlationId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"message"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"subContext"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"CustomError"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"UserEndPageData"}}}]}}]};class zi{constructor(e,t,i,n){this.commandHandler=e,this.extensionCommanding=t,this.deeplinkCommandingService=i,this.client=n}signinPage(e){return this.commandHandler({entity:{type:pe.py.identity,action:pe.uk.default},command:e})}accountList(e){return this.commandHandler({entity:{type:pe.py.identity,action:pe.uk.list},command:e})}switchAccount({correlation:e,userContextId:t,targetEntity:i,cloud:n,entityOptions:r}){var s,a,l;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.client)throw new Error("client missing in switch account commanding");const{data:o}=(yield this.client.query({query:Hi,variables:{userContextId:t},context:{correlation:e}}))||{},c=null==o?void 0:o.userAuthState;if(c&&"Up"!==c.state){let i,r;const d=null===(s=c.customError)||void 0===s?void 0:s.errorCode;if("UnRedeemed"===c.state&&(i=pe.uk.tenantRedemption),"LoginError"===c.state)switch(null===(a=c.customError)||void 0===a?void 0:a.errorCode){case Bi.SM.TenantUnredeemed:i=pe.uk.tenantRedemption;break;case Bi.SM.InteractionRequired:i=pe.uk.tenantLogin;break;case Bi.SM.CloudMismatch:const e=null===(l=c.customError)||void 0===l?void 0:l.errorMetadata;n=null==e?void 0:e.cloud,t=null==e?void 0:e.accountId;break;default:i=pe.uk.error}if("LicenseError"===c.state||"SignInRestriction"===c.state||"MsaUserNotAllowed"===d){const n=yield this.client.query({query:qi,variables:{userContextId:t,isMRU:!1},context:{correlation:e}}),o="MsaUserNotAllowed"===d?d:"LicenseError"===c.state?"LicenseError":"SignInRestriction",s=n.data.userEndPageData;i=pe.uk.error,r=(0,$i.fj)(s,o,t)}if(i)return this.commandHandler({entity:{type:pe.py.identitydialog,action:i},command:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:e},entityOptions:{correlation:e,userContextId:t,userAuthState:null==o?void 0:o.userAuthState,error:r}})}return this.deeplinkCommandingService.switchAccount(e,t,i,n,r)}))}signOutDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.signoutdialog,action:pe.uk.view},{entityCommand:e})}smartDeviceSignOutDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.smartdevicelogoutdialog,action:pe.uk.view},{entityCommand:e})}addAccountDialog(e){return this.commandHandler({entity:{type:pe.py.identitydialog,action:pe.uk.create},command:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,layoutMode:ve.lO.focus,correlation:e.correlation},entityOptions:e})}accountSelectionDialog(e){return this.commandHandler({entity:{type:pe.py.accountselectiondialog,action:pe.uk.create},command:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,layoutMode:ve.lO.focus,correlation:e.correlation},entityOptions:e})}addAccount(e){return this.commandHandler({entity:{type:pe.py.identity,action:pe.uk.create},command:{visibilityState:ve.fe.show,stateTransition:ve.su.new,layoutMode:ve.lO.focus,correlation:e},entityOptions:{correlation:e}})}closeAccountListDialog(e){return this.commandHandler({entity:{type:pe.py.identitydialog,action:pe.uk.create},command:{visibilityState:ve.fe.hide,stateTransition:ve.su.flush,layoutMode:ve.lO.focus,correlation:{source:e}}})}closeEntity(e,t){return this.commandHandler({entity:t,command:{visibilityState:ve.fe.hide,stateTransition:ve.su.flush,layoutMode:ve.lO.focus,correlation:{source:e}}})}executeEntity(e){return this.commandHandler(e)}closeAccountLoginDialog(e){return this.commandHandler({entity:{type:pe.py.identitydialog,action:pe.uk.tenantLogin},command:{visibilityState:ve.fe.hide,stateTransition:ve.su.flush,layoutMode:ve.lO.focus,correlation:{source:e}}})}closeAddAccountListWindow(e){return this.commandHandler({entity:{type:pe.py.identity,action:pe.uk.create},command:{visibilityState:ve.fe.hide,stateTransition:ve.su.flush,layoutMode:ve.lO.focus,correlation:{source:e}}})}closeAccountListWindow(e){return this.commandHandler({entity:{id:ve.lO.focus,type:pe.py.identity,action:pe.uk.list},command:{visibilityState:ve.fe.hide,stateTransition:ve.su.flush,layoutMode:ve.lO.focus,correlation:{source:e}}})}showAuthEndPage(e,t,i){return this.commandHandler({entity:{type:i?pe.py.identitydialog:pe.py.identity,action:pe.uk.error},command:{visibilityState:ve.fe.show,stateTransition:i?ve.su.extend:ve.su.flush,layoutMode:i?ve.lO.focus:ve.lO.standard,correlation:{source:e}},entityOptions:{error:t.error}})}showRefreshModal(e){return this.commandHandler({entity:{type:pe.py.authrefreshdialog,action:pe.uk.view},command:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,layoutMode:ve.lO.standard,correlation:{source:e}}})}}class Vi{constructor(e){this.commandHandler=e}viewAutoInstallNotification(e,t){return this.commandHandler({entity:{type:pe.py.autoinstallnotification,action:pe.uk.view},command:t,entityOptions:e})}}class Gi{constructor(e){this.commandHandler=e}navigateToFaceEnrollment(){return this.commandHandler({entity:{type:pe.py.faceenrollment,action:pe.uk.view},command:{visibilityState:ve.fe.show,stateTransition:ve.su.flush,correlation:{startTimestamp:Date.now(),source:k.D.FaceEnrollmentGetStartedButton}}})}navigateToVoiceEnrollment(){return this.commandHandler({entity:{type:pe.py.voiceenrollment,action:pe.uk.view},command:{visibilityState:ve.fe.show,stateTransition:ve.su.flush,correlation:{startTimestamp:Date.now(),source:k.D.VoiceEnrollmentGetStartedButton}}})}}class Ji{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}brbFeedbackDialogInMainWindow(e,t){return this.commandHandler({entity:{type:pe.py.brbfeedbackdialog,action:pe.uk.view},command:e,entityOptions:t})}brbFeedbackDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.brbfeedbackdialog,action:pe.uk.view},{entityCommand:e,entityOptions:t})}autoBrbConfirmationDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.autobrbconfirmationdialog,action:pe.uk.view},{entityCommand:e,entityOptions:t})}autoBrbFlowDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.autobrbflowdialog,action:pe.uk.view},{entityCommand:e,entityOptions:t})}}class Ki{constructor(e){this.commandHandler=e}openBreakoutRooms(e,t){return this.commandHandler({entity:{type:pe.py.breakoutrooms,action:pe.uk.view},entityOptions:t,command:e})}openBreakoutRoomsInChat(e,t){return this.commandHandler({entity:{type:pe.py.breakoutrooms,action:pe.uk.view,linkedEntity:{type:pe.py.chats,id:e}},command:t})}showAssignmentDialog(e){return this.showDialog(pe.py.breakoutroomsassignment,e)}showAssignmentTypeDialog(e){return this.showDialog(pe.py.breakoutroomsassignmenttype,e)}showCreateRoomsDialog(e){return this.showDialog(pe.py.breakoutroomscreaterooms,e)}showDeleteRoomDialog(e){return this.showDialog(pe.py.breakoutroomsdeleteroom,e)}showDeleteRoomsDialog(e){return this.showDialog(pe.py.breakoutroomsdeleterooms,e)}showEditRoomDialog(e){return this.showDialog(pe.py.breakoutroomseditroom,e)}showSettingsDialog(e){return this.showDialog(pe.py.breakoutroomssettings,e)}showDialog(e,t){return this.commandHandler({entity:{type:e,action:pe.uk.view},command:{stateTransition:ve.su.extend,correlation:{source:k.D.ExtensionCommanding},visibilityState:t}})}}class Qi{constructor(e){this.commandHandler=e}qnaPanelById(e,t){return this.commandHandler({entity:{type:pe.py.broadcastqna,action:pe.uk.view,id:e,linkedEntity:{type:pe.py.calls,id:e}},command:t})}broadcastQnaPanelById(e,t){return this.commandHandler({entity:{type:pe.py.eventsbroadcastqna,action:pe.uk.view,id:e,linkedEntity:{type:pe.py.calls,id:e}},command:t})}infoPanelById(e,t){return this.commandHandler({entity:{type:pe.py.broadcasts,action:pe.uk.info,id:e,linkedEntity:{type:pe.py.calls,id:e}},command:t})}broadcastById(e,t,i){return this.commandHandler({entity:{type:pe.py.broadcasts,action:pe.uk.view,id:e},command:t,entityOptions:i})}broadcastFeedbackById(e,t,i){return this.commandHandler({entity:{type:pe.py.broadcastfeedback,action:pe.uk.view,id:e},command:t,entityOptions:i})}broadcastLeave(e,t,i){return this.commandHandler({entity:{type:pe.py.broadcasts,action:pe.uk.leave,id:e},command:t,entityOptions:i})}joinBroadcastAsAttendee(e){return this.commandHandler(e)}leaveBroadcastQualtityFeedback(){return this.commandHandler({entity:{type:pe.py.default,action:pe.uk.view},command:{stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.BroadcastLeaveButton}}})}}class Yi{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}meetingDetails(e,t,i,n){const o=n||pe.py.schedulingform;return this.commandHandler({entity:{type:o,action:pe.uk.view,id:e},command:t,entityOptions:i})}openCalendarSurface(e,t,i,n){return this.commandHandler({entity:{type:pe.py.calendar,action:pe.uk.view,id:e,linkedEntity:n},command:t,entityOptions:i})}openM365CalendarSurface(e){return this.commandHandler({entity:{type:pe.py.extensions,action:pe.uk.view,id:JSON.stringify({appId:"5966c135-e05f-4ce0-81e0-e138fe8e9583"})},command:{stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:e||k.D.Calendar}}})}openCalendarAgendaView(e,t,i){return this.commandHandler({entity:{type:pe.py.calendar,action:pe.uk.list,linkedEntity:i},command:e,entityOptions:t})}openChannelCalendarSurface(e,t,i,n){const o={entity:{action:pe.uk.view,id:e,linkedEntity:n,type:pe.py.channelcalendar},command:t,entityOptions:i};return this.commandHandler(o)}openSchedulingFormInMainWindow(e,t,i){return this.commandHandler({entity:{type:pe.py.schedulingform,action:pe.uk.create,id:e},command:t,entityOptions:i})}openBroadcast(e,t,i,n){const o={type:pe.py.broadcastliveevent,id:e,action:t};return this.extensionCommanding.executeCommand(o,{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.none,correlation:{source:i}},entityOptions:n})}closeSchedulingForm(e,t,i){return this.commandHandler({entity:e,command:t,entityOptions:i})}showCalendarErrorModal(e){return this.extensionCommanding.executeCommand({type:pe.py.calendar,action:pe.uk.error},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.CalendarEventAction}},entityOptions:e})}addBlockingConfirmationDialog(e,t){return this.extensionCommanding.addBlockingExtension({type:pe.py.calendar,action:pe.uk.confirm},e,t)}isBlockedByCalendar(){return this.extensionCommanding.isBlockedByEntity(pe.py.calendar)}showConfirmationDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.calendar,action:pe.uk.confirm},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:k.D.CalendarEventAction}},entityOptions:e})}showShareDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.calendar,action:pe.uk.share},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:k.D.CalendarEventAction}},entityOptions:e})}showEmbedDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.calendar,action:pe.uk.info},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:k.D.CalendarEventAction}},entityOptions:e})}openConnectedCalendarDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.connectedcalendardialog,action:pe.uk.view},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:k.D.CalendarSettings}},entityOptions:e})}openConnectedCalendarSurfaceDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.connectedcalendarsurfacedialog,action:pe.uk.view},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:k.D.Calendar}},entityOptions:e})}}class Xi{constructor(e,t,i=void 0){this.commandHandler=e,this.extensionCommanding=t,this.userContextId=i}call(e,t){return this.commandHandler({entity:{type:pe.py.calls,action:pe.uk.list,id:e},command:t})}callDebug(e){return this.commandHandler({entity:{type:pe.py.calls,action:pe.uk.info},command:e})}dialPad(e){return this.commandHandler({entity:{type:pe.py.calls,action:pe.uk.join},command:e})}callById(e,t,i,n,o){let r;return i&&(r={type:pe.py.chats,id:i}),o&&(r={type:pe.py.callingdeeplink,id:o}),this.commandHandler({entity:{type:n||pe.py.calls,action:pe.uk.view,id:e,linkedEntity:r},command:t})}callStageContentById(e,t){return this.commandHandler({entity:{type:pe.py.stagecontent,action:pe.uk.view},entityOptions:t,command:e})}callList(e){return this.commandHandler({entity:{type:pe.py.calls,action:pe.uk.list},command:e})}deviceSettingsById(e,t,i={useCall:!0}){return this.commandHandler({entity:{type:pe.py.devicesettings,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},entityOptions:i,command:t})}audioSettingsById(e,t,i={useCall:!0}){return this.commandHandler({entity:{type:pe.py.audiosettings,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},entityOptions:i,command:t})}extensibilityAppPickerCallingPanel(e,t,i,n){return this.commandHandler({entity:{type:pe.py.extensibilityapppickercallingpanel,action:pe.uk.info,id:e},command:t,entityOptions:{messageId:n,conversationId:e,config:i}})}callNotification(e,t,i,n){var o;const r=e.entityOptions;return r.targetEntity.dataOptions.userContextId=this.userContextId,r.telemetryClientId=i,null===(o=r.buttons)||void 0===o||o.forEach((e=>{e.targetEntity.dataOptions.userContextId=this.userContextId})),"Hide"===n?this.commandHandler({entity:{id:t,action:pe.uk.view,type:pe.py.toasts},command:{correlation:{id:i,source:k.D.Calling},stateTransition:ve.su.new,visibilityState:ve.fe.hide},entityOptions:r}):this.commandHandler({entity:{action:pe.uk.view,type:pe.py.toasts,id:t},command:e.command,entityOptions:r})}cameraEffectsSettingsById(e,t){return this.commandHandler({entity:{type:pe.py.cameraeffects,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},entityOptions:{commandSource:null==t?void 0:t.correlation.source},command:t})}customVideoBackgroundSettingsById(e,t){return this.commandHandler({entity:{type:pe.py.videobackgrounds,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}styleMyRoomPanelById(e,t){return this.commandHandler({entity:{type:pe.py.stylemyroom,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}callRosterById(e,t,i){const n={entity:{type:pe.py.roster,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t};return i&&(n.entityOptions={isBYODAttendeeView:i}),this.commandHandler(n)}callByodRosterById(e,t){return this.commandHandler({entity:{type:pe.py.byodroster,action:pe.uk.view,linkedEntity:{type:pe.py.byodattendeewindow,id:e}},command:t})}callDetailsById(e,t,i){return this.commandHandler({entity:{type:pe.py.meetingdetails,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e},id:e},entityOptions:{didMeetingNotesAutoOpen:i},command:t})}callInfoById(e,t){return this.commandHandler({entity:{type:pe.py.calls,action:pe.uk.info,linkedEntity:{type:pe.py.calls,id:e}},command:t})}callNotesById(e,t){return this.commandHandler({entity:{type:pe.py.notes,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}transcriptPanelById(e,t){return this.commandHandler({entity:{type:pe.py.transcript,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}callHealthPanelById(e,t){return this.commandHandler({entity:{type:pe.py.calls,action:pe.uk.health,linkedEntity:{type:pe.py.calls,id:e}},command:t})}mediaStreamsPanelById(e,t){return this.commandHandler({entity:{type:pe.py.mediastreams,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}callBreakoutRoomById(e,t){return this.commandHandler({entity:{type:pe.py.breakoutroomspanel,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e},id:e},command:t})}callDeeplinkDialog(e){return this.commandHandler({entity:{type:pe.py.callingdeeplinkDialog,action:pe.uk.view},command:e})}createById(e,t,i,n){return this.commandHandler({entity:{id:e,type:t,action:pe.uk.create},command:i,windowOptions:n})}callMonitorById(e,t,i){return this.commandHandler({entity:{type:pe.py.callsmonitor,action:pe.uk.view},entityOptions:e&&{callingIntentId:e},command:t,windowOptions:i})}callShareMeetingInviteDialogById(e,t,i){return this.extensionCommanding.executeCommand(e,{entityOptions:t,entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:i}}})}callsKeypad(e,t){return this.commandHandler({entity:{type:pe.py.callskeypad,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}callMeetingOptionsById(e,t){return this.commandHandler({entity:{type:pe.py.meetings,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}callsTransfer(e,t){return this.commandHandler({entity:{type:pe.py.callstransfer,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}contentCameraSetupDialog(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.contentcamerasetup,action:pe.uk.create},{entityOptions:t,entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.none,correlation:{source:i}}})}startMeetingStream(e,t){return this.extensionCommanding.executeCommand({type:pe.py.meetingstream,action:pe.uk.create},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.none,correlation:{source:e}},entityOptions:t})}stagingRoomStartMeetingConfirmationDialog(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.stagingroomstartmeetingconfirmationdialog,action:pe.uk.create},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:t}},entityOptions:i})}openDialog(e,t,i){return this.extensionCommanding.executeCommand(e,{entityOptions:i,entityCommand:t})}dialogContainer({command:e,viewOptions:t}){return this.commandHandler({entity:{type:pe.py.callingdialog,action:pe.uk.view},command:Object.assign(Object.assign({},e),{stateTransition:ve.su.new}),entityOptions:t})}callableChannelById(e,t,i){return this.commandHandler({entity:{id:t,type:pe.py.callablechannels,action:pe.uk.list,linkedEntity:{id:e,type:pe.py.channels,action:pe.uk.view}},command:i})}toggleRoomRemote(e,t,i){return this.commandHandler({entity:{type:pe.py.roomremote,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},entityOptions:i,command:t})}accessibilityPanelById(e,t){return this.commandHandler({entity:{type:pe.py.accessibilitypanel,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}closedCaptionsSettingsPanelById(e,t,i={allowTranslatedCaptions:!1}){return this.commandHandler({entity:{type:pe.py.closedcaptionssettings,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},entityOptions:i,command:t})}openCopilot(e,t,i){return this.commandHandler({entity:{type:pe.py.meetingcollaboration,action:pe.uk.view,id:t||e.callId||e.threadId,linkedEntity:{type:pe.py.calls,id:t||e.callId}},entityOptions:e,command:i})}presenterToolbarById(e,t){return this.commandHandler({entity:{type:pe.py.presentertoolbar,action:pe.uk.view},entityOptions:e&&{callingIntentId:e},command:t})}floatingUfdById(e,t,i){return this.commandHandler({entity:{type:pe.py.floatingufd,action:pe.uk.view},entityOptions:{callingIntentId:e,teamsCallId:t},command:i})}pstnCallMeDialogToggle(e,t,i){return this.extensionCommanding.executeCommand(e,{entityOptions:i,entityCommand:t})}openStageCustomizationPanel(e,t){return this.commandHandler({entity:{type:pe.py.stagecustomizationpanel,action:pe.uk.view},entityOptions:{teamsCallId:e},command:t})}openBYODAttendeeView(e,t){return this.commandHandler({entity:{type:pe.py.byodattendeewindow,action:pe.uk.view,id:null==t?void 0:t.intentId},entityOptions:t,command:e})}closedCopilotPanelById(e,t,i){return this.commandHandler({entity:{type:pe.py.meetingcollaboration,action:pe.uk.view,id:e,linkedEntity:{type:pe.py.calls,id:e}},entityOptions:i,command:t})}}class Zi{constructor(e){this.commandHandler=e}navigateById(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.commandHandler({entity:{type:pe.py.campaignnotifications,action:pe.uk.view,id:e},entityOptions:null==t?void 0:t.entityOptions,command:null==t?void 0:t.entityCommand,scenarioEventData:null==t?void 0:t.scenarioEventData})}))}}var en=i(431447),tn=i(281710);class nn{constructor(e,t,i,n){this.commandHandler=e,this.extensionCommanding=t,this.coreSettings=i,this._logger=n.newLogger("ChatCommandingService","core-services-entity-commanding")}default(e){return this.handleCommandWithChecks({entity:{type:pe.py.chats,action:pe.uk.default},command:e})}empty(e){return this.handleCommandWithChecks({entity:{type:pe.py.chats,action:pe.uk.empty},command:e})}chatList(e,t){return this.handleCommandWithChecks({entity:{type:pe.py.chats,action:pe.uk.list},entityOptions:null==t?void 0:t.entityOptions,command:e})}getChatByIdCommand(e,t,i){var n;const o=i&&(null===(n=null==t?void 0:t.entityOptions)||void 0===n?void 0:n.isBYODMode)?{type:pe.py.calls,id:i}:null,r={entity:{type:pe.py.chats,action:pe.uk.view,id:e,linkedEntity:o},entityOptions:null==t?void 0:t.entityOptions,command:null==t?void 0:t.entityCommand,scenarioEventData:null==t?void 0:t.scenarioEventData};return this.checkPolicies(r),r}chatById(...e){const t=this.getChatByIdCommand(...e);return this.commandHandler(t)}byodChatById(...e){const t=this.getByodChatByIdCommand(...e);return this.commandHandler(t)}chatChannelConversationById(e,t,i){const n={channelId:e,replyChainId:t};return this.handleCommandWithChecks({entity:{type:pe.py.chatschannelconv,action:pe.uk.view,id:JSON.stringify(n)},entityOptions:null==i?void 0:i.entityOptions,command:null==i?void 0:i.entityCommand,scenarioEventData:null==i?void 0:i.scenarioEventData})}chatWithUsers(e){const t=(0,tn.Mf)((null==e?void 0:e.userIds)||[],null==e?void 0:e.entityCommand);return this.handleCommandWithChecks(Object.assign(Object.assign({},t),{entityOptions:null==e?void 0:e.entityOptions}))}chatWithGuardians(e,t,i,n,o,r){const s=(0,tn.Mf)(t||[],r),a={groupName:i,isGuardiansChat:!0,guardiansChatGroupId:e,guardiansChatStudentId:n,guardiansPreferredToAlternateMriMappings:o};return this.handleCommandWithChecks(Object.assign(Object.assign({},s),{entityOptions:a}))}orgChat(e,t){return this.handleCommandWithChecks({entity:{type:pe.py.extensions,action:pe.uk.view,id:ve.oz.organization,linkedEntity:{type:pe.py.chats,id:(0,tn.f$)([e])}},command:t})}linkedIn(e,t){return this.handleCommandWithChecks({entity:{type:pe.py.extensions,action:pe.uk.view,id:ve.oz.linkedin,linkedEntity:{type:pe.py.chats,id:(0,tn.f$)([e])}},command:t})}openLpcInMainWindow(e,t){return this.commandHandler({entity:{type:pe.py.livepersonacard,action:pe.uk.view},command:t,entityOptions:e})}launchAltText(e,t){return this.extensionCommanding.executeCommand({type:pe.py.alttext,action:pe.uk.view},{entityCommand:t,entityOptions:{element:e}})}launchAddNewComponentFluid(e){return this.extensionCommanding.executeCommand({type:pe.py.fluid,action:pe.uk.confirm},{entityCommand:e})}launchInsertHyperlink(e,t,i){return this.extensionCommanding.executeCommand({type:pe.py.hyperlink,action:pe.uk.view},{entityCommand:i,entityOptions:{displayText:e,address:t}})}launchDiscardCodeSnippet(e){return this.extensionCommanding.executeCommand({type:pe.py.codesnippet,action:pe.uk.delete},{entityCommand:e})}launchTranslationFeedbackDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.translationfeedback,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchTwoWaySmsFriendlyNameDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.twowaysmsfriendlyname,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchDeleteChat(e,t){return this.extensionCommanding.executeCommand({type:pe.py.deletechat,action:pe.uk.delete},{entityCommand:t,entityOptions:e})}launchDiscardFluid(e,t){return this.extensionCommanding.executeCommand({type:pe.py.fluid,action:pe.uk.delete},{entityCommand:t,entityOptions:{isCompose:e}})}launchPastePermissionsFluid(e,t,i,n,o){return this.extensionCommanding.executeCommand({type:pe.py.fluid,action:pe.uk.manage},{entityCommand:o,entityOptions:{displayTitle:e,displayText:t,cancelButtonContent:i,confirmButtonContent:n}})}launchUpdatePermissionsFluid(e,t){return this.extensionCommanding.executeCommand({type:pe.py.fluid,action:pe.uk.update},{entityCommand:t,entityOptions:{recipientList:e}})}launchUnpinMessageFromChat(e){return this.extensionCommanding.executeCommand({type:pe.py.pinnedconversationitems,action:pe.uk.delete},{entityCommand:e})}launchReplaceMessageFromChat(e){return this.extensionCommanding.executeCommand({type:pe.py.pinnedconversationitems,action:pe.uk.update},{entityCommand:e})}launchDiscardMessageDraft(e,t,i,n){return this.extensionCommanding.executeCommand({type:pe.py.messagedraft,action:pe.uk.delete},{entityCommand:n,entityOptions:{isBranded:e,workload:t,isEditing:i}})}launchGiphyConsent(e){return this.extensionCommanding.executeCommand({type:pe.py.giphyconsent,action:pe.uk.view},{entityCommand:e})}launchLeaveChat(e,t){return this.extensionCommanding.executeCommand({type:pe.py.leavechat,action:pe.uk.delete},{entityCommand:e,entityOptions:t})}launchSendFeedback(e,t,i,n,o,r,s,a){return this.extensionCommanding.executeCommand({type:e,action:pe.uk.view},{entityCommand:t,entityOptions:{convId:i,serverMessageId:n,traceId:o,bizChatConversationId:r,endpoint:s,utteranceTimestamp:a}})}launchChatInviteConfirmation(e){return this.extensionCommanding.executeCommand({type:pe.py.chatInviteConfirmation,action:pe.uk.view},{entityCommand:e})}launchMaxPinnedChatsReached(e,t){return this.extensionCommanding.executeCommand({type:pe.py.pinnedchatsmaxreached,action:pe.uk.view},{entityCommand:t,entityOptions:{maxPinnedChats:e}})}launchUpdateGroupChatAvatar(e,t){return this.extensionCommanding.executeCommand({type:pe.py.updategroupchatavatar,action:pe.uk.view},{entityCommand:t,entityOptions:{threadId:e}})}launchTfwUpdateGroupChatAvatar(e,t,i){return this.extensionCommanding.executeCommand({type:pe.py.tfwupdategroupchatavatar,action:pe.uk.view},{entityCommand:i,entityOptions:{threadId:e,avatarUrl:t}})}launchRemoveChatUser(e,t,i){return this.extensionCommanding.executeCommand({type:pe.py.removechatuser,action:pe.uk.delete},{entityCommand:i,entityOptions:{userName:e,isRemoveTfwUserInTflChat:t}})}launchShareChatLink(e,t,i,n,o,r,s,a){return this.extensionCommanding.executeCommand({action:pe.uk.view,id:e,type:pe.py.sharechatlink},{entityCommand:a,entityOptions:{chatTitle:t,tenantId:i,hasError:n,sharedLink:o,cfet:r,panelType:s}})}launchChatError(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.chats,action:pe.uk.error},{entityCommand:t})}launchStreamCamera(e){return this.extensionCommanding.executeCommand({type:pe.py.streamcamera,action:pe.uk.default,id:null==e?void 0:e.correlation.id},{entityCommand:e})}launchStreamCameraInChannels(e){return this.extensionCommanding.executeCommand({type:pe.py.streamcamerainchannels,action:pe.uk.default,id:null==e?void 0:e.correlation.id},{entityCommand:e})}launchMaxPinnedMesssagesReachedDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.chatmaxmultiplepinnedmessages,action:pe.uk.view},{entityCommand:e})}launchStreamCameraInCommunities(e){return this.extensionCommanding.executeCommand({type:pe.py.streamcameraincommunities,action:pe.uk.default,id:null==e?void 0:e.correlation.id},{entityCommand:e})}meetingRecapTab(e,t,i){return this.handleCommandWithChecks({entity:{type:i||pe.py.meetingrecaptab,action:pe.uk.view,id:e.threadId},command:t,entityOptions:e})}transcriptTab(e,t,i,n,o,r,s,a,l,c,d,u){return this.handleCommandWithChecks({entity:{type:pe.py.transcripttab,action:pe.uk.view,id:t},entityOptions:{conversationId:e,storageId:i,teamsCallId:n,meetingOrganizerId:o,meetingTenantId:r,eventId:s,isOdspTranscript:a,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u}})}launchReportConcern(e,t){return this.extensionCommanding.executeCommand({type:pe.py.reportConcern,action:pe.uk.create},{entityCommand:t,entityOptions:e})}launchForwardMessage(e,t){return this.extensionCommanding.executeCommand({type:pe.py.forwardMessage,action:pe.uk.create},{entityCommand:t,entityOptions:e})}launchReportConcernV2(e,t){return this.extensionCommanding.executeCommand({type:pe.py.reportConcernForTFW,action:pe.uk.create},{entityCommand:t,entityOptions:e})}launchReportConcernTY(e){return this.extensionCommanding.executeCommand({type:pe.py.reportConcern,action:pe.uk.info},{entityCommand:e})}launchReportConcernV2Confirmation(e){return this.extensionCommanding.executeCommand({type:pe.py.reportConcernForTFW,action:pe.uk.info},{entityCommand:e})}launchDlpDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.dlp,action:pe.uk.view},{entityCommand:t,entityOptions:e})}chatInfoPane(e,t,i){return this.handleCommandWithChecks({entity:{type:pe.py.chatsInfoView,action:pe.uk.info,id:e},command:t,entityOptions:i})}extensibilityAppPickerSidePanel(e,t){return this.handleCommandWithChecks({entity:{type:pe.py.extensibilityapppickersidepanel,action:pe.uk.info,id:e},command:t})}chatContextualSearch(e,t,i){return this.handleCommandWithChecks({entity:{type:pe.py.chatContextualSearch,action:pe.uk.info,id:e},command:t,entityOptions:i})}chatHighlightsDetails(e,t,i){return this.handleCommandWithChecks({entity:{type:pe.py.chatHighlightsDetails,action:pe.uk.info,id:e},command:t,entityOptions:i})}chatFluidThread(e,t){return this.handleCommandWithChecks({entity:{type:pe.py.chatfluidthread,action:pe.uk.info,id:e},command:t})}manage(e,t){return this.handleCommandWithChecks({entity:{type:pe.py.chatManageApps,action:pe.uk.manage,id:e,linkedEntity:{type:pe.py.chats,id:e}},command:t})}chatInfoPaneDetails(e,t,i,n){return this.handleCommandWithChecks({entity:{type:n||pe.py.chatsInfo,action:pe.uk.infoDetails,id:e},command:t,entityOptions:i})}launchBlockChatDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.blockChat,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchMultiStepAcceptChatDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.multiStepAcceptChat,action:pe.uk.view},{entityCommand:e})}launchLeaveGroupAndBlockUserDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.leaveGroupAndBlockUser,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchCustomizeReactions(e){return this.extensionCommanding.executeCommand({type:pe.py.customizereactions,action:pe.uk.view},{entityCommand:e})}launchCustomEmojiUpload(e,t){return this.extensionCommanding.executeCommand({type:pe.py.customemojiupload,action:pe.uk.view},{entityCommand:t,entityOptions:{blobUrl:e}})}handleCommandWithChecks(e){return this.checkPolicies(e),this.commandHandler(e)}checkPolicies(e){var t,i,n;if(this.coreSettings.get(b.J.Messaging).allowUserChat||(null===(t=e.entity.id)||void 0===t?void 0:t.startsWith("19:meeting")))return;const{type:o,action:r}=e.entity,s=`${f.w5.Commanding}::${f.jK.PolicyCheckFailed}::Chat command not allowed due to policy (allowUserChat=false)`;null===(n=(i=this._logger).errorToTelemetry)||void 0===n||n.call(i,s,"messaging_command_policy_violation",{mainEntityType:o,mainEntityAction:r})}getByodChatByIdCommand(e,t,i){const n={entity:{type:pe.py.byodchat,action:pe.uk.view,id:e,linkedEntity:{type:pe.py.byodattendeewindow,id:i||""}},entityOptions:null==t?void 0:t.entityOptions,command:null==t?void 0:t.entityCommand,scenarioEventData:null==t?void 0:t.scenarioEventData};return this.checkPolicies(n),n}}class on{constructor(e){this.commandHandler=e}coachReport(e,t){return this.commandHandler({entity:{type:pe.py.coachreport,action:pe.uk.view,linkedEntity:{type:pe.py.chats,id:t?t.threadId:""}},command:e,entityOptions:t})}}class rn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}showAddMemberDialog(e,t){return this.commandHandler({entity:{id:e,type:pe.py.communitiesaddmember,action:pe.uk.view},entityOptions:{},command:t})}showCreateChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:pe.py.communitiescreatechannel,action:pe.uk.view},entityOptions:{},command:t})}showEditChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:pe.py.communitieseditchannel,action:pe.uk.view},entityOptions:{},command:t})}showDeleteChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:pe.py.communitiesdeletechannel,action:pe.uk.view},entityOptions:{},command:t})}showCommunityLinkDialog(e,t,i){var n;const o=null!=i?i:{};return this.commandHandler({entity:{action:pe.uk.view,id:e,type:pe.py.sharecommunitieslink},entityOptions:Object.assign(Object.assign({},o),{source:null===(n=null==t?void 0:t.correlation)||void 0===n?void 0:n.source}),command:t})}showEmbedCommunityCodeDialog(e,t){return this.commandHandler({entity:{action:pe.uk.view,id:e,type:pe.py.embedcommunitycodedialog},entityOptions:{},command:t})}showCommunityGuidelinesDialog(e,t){return this.commandHandler({entity:{action:pe.uk.view,id:e,type:pe.py.communitiesguidelinesdialog},entityOptions:{},command:t})}showCommunityGetAppDialog(e){return this.commandHandler({entity:{action:pe.uk.view,type:pe.py.communitiesgetappdialog},entityOptions:{},command:e})}showCommunitiesCreateDialog(e,t){return this.commandHandler({entity:{action:pe.uk.view,type:pe.py.communitiescreatedialog},entityOptions:{templateId:t},command:e})}showCommunitiesEditDialog(e,t){return this.commandHandler({entity:{action:pe.uk.view,type:pe.py.communitieseditdialog,id:e},entityOptions:{},command:t})}showReportConcernDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.reportconcerncommunities,action:pe.uk.create},{entityCommand:t})}showRemoveMemberDialog(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.communitiesremovemember,action:pe.uk.view},{entityOptions:Object.assign({},t),entityCommand:i})}showNicknameDialog(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.communitiesnickname,action:pe.uk.view},{entityOptions:Object.assign({},t),entityCommand:i})}showReportConcernTY(e,t){return this.commandHandler({entity:{type:pe.py.reportconcerncommunities,action:pe.uk.view,id:e},entityOptions:{},command:t})}showSendPostAsEmailDialog(e,t){return this.commandHandler({entity:{type:pe.py.communitiessendpostasemaildialog,action:pe.uk.view,id:e},entityOptions:{},command:t})}showWelcomeBotConfigDialog(e,t){return this.commandHandler({entity:{type:pe.py.communitieswelcomebotconfigdialog,action:pe.uk.view,id:e},entityOptions:{},command:t})}showLeaveCommunityDialog(e,t){return this.commandHandler({entity:{id:e,type:pe.py.leavecommunity,action:pe.uk.view},entityOptions:{},command:t})}showOwnerLeaveCommunityDialog(e,t){return this.commandHandler({entity:{id:e,type:pe.py.ownerleavecommunity,action:pe.uk.view},entityOptions:{},command:t})}openDialog(e,t,i,n){return this.commandHandler({entity:{id:t,type:e,action:null!=n?n:pe.uk.view},entityOptions:{},command:i})}communityMessagesById(e,t,i,n,o,r,s){const a={channelId:e,replyChainId:t};return localStorage.setItem("communities-selected-id",e),localStorage.setItem("communities-selected-reply-id",t||""),this.commandHandler({entity:{type:pe.py.communities,action:null!=s?s:pe.uk.view,id:JSON.stringify(a)},command:n,entityOptions:Object.assign(Object.assign({},o),{source:null==n?void 0:n.correlation.source,deepLinkId:i}),scenarioEventData:null==r?void 0:r.scenarioEventData})}getCommunityEvents(e,t){return this.commandHandler({entity:{type:pe.py.communitiesevents,action:pe.uk.view,id:JSON.stringify({channelId:e})},command:Object.assign({stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.CommunitiesEventsButton}},t)})}showCreateCommunityEvent(e){const t={stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.CommunitiesCreateEventButton}};return this.commandHandler({entity:{type:pe.py.communitiescreateevent,action:pe.uk.view,id:JSON.stringify({channelId:e})},command:t,entityOptions:{isGroup:!0,conversationId:e}})}getOnboardingView(e,t,i){return this.getView(pe.py.communitiesonboarding,null!=e?e:pe.uk.view,t,k.D.CommunitiesOnboarding,i)}getCommunitiesJoinView(e,t,i,n){const o={channelId:e,replyChainId:t},r=e?JSON.stringify(o):void 0;return this.commandHandler({entity:{type:null!=n?n:pe.py.communities,action:pe.uk.join,id:r},command:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.CommunitiesInviteLink}},entityOptions:{messageId:t,inviteLinkUrl:i}})}navigateToCommunityId(e,t,i,n,o){const r={stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:i||k.D.Unknown}};return this.communityMessagesById(e,n,void 0,r,o?{enqueSwitch:!0}:void 0,void 0,t?pe.uk.default:void 0)}showCommunitiesManage(e,t,i,n){var o;localStorage.setItem("current-enitity-type",pe.py.communitiesmembers);const r=(null==i?void 0:i.source)||(null===(o=null==t?void 0:t.correlation)||void 0===o?void 0:o.source)||k.D.CommunitiesManage;return this.commandHandler({entity:{type:pe.py.communitiesmembers,action:pe.uk.view,id:e},entityOptions:Object.assign(Object.assign({},i),{source:r}),command:Object.assign({stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:r}},t),scenarioEventData:null==n?void 0:n.scenarioEventData})}showCommunitiesBlockMembers(e,t){var i;return this.commandHandler({entity:{type:pe.py.communitiesblockmembers,action:pe.uk.view,id:e},command:Object.assign({stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:(null===(i=null==t?void 0:t.correlation)||void 0===i?void 0:i.source)||k.D.CommunitiesManage}},t)})}showCommunitiesSettings(e,t){return this.commandHandler({entity:{type:pe.py.communitiessettings,action:pe.uk.view,id:e},command:Object.assign({stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.CommunitiesManageLink}},t)})}showCommunitiesManageMemberRequests(e,t,i,n){var o;const r=(null==i?void 0:i.source)||(null===(o=null==t?void 0:t.correlation)||void 0===o?void 0:o.source)||k.D.CommunitiesManage;return this.commandHandler({entity:{type:pe.py.communitiesjoinrequest,action:pe.uk.view,id:e},command:Object.assign({stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:r}},t),entityOptions:Object.assign(Object.assign({},i),{source:r}),scenarioEventData:null==n?void 0:n.scenarioEventData})}showCommunityJoinView(e,t,i,n,o){return this.commandHandler({entity:{type:pe.py.communitiesjoininviteview,action:pe.uk.join,id:e},command:t,entityOptions:Object.assign(Object.assign({},i),{activityId:o}),scenarioEventData:null==n?void 0:n.scenarioEventData})}showPerCommunityNotificationSettingsDialog(e,t){return this.commandHandler({entity:{action:pe.uk.view,id:e,type:pe.py.percommunitynotificationsettingsdialog},entityOptions:{},command:t})}showCommunityDeleteReplyChainDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.communitiesreplychain,action:pe.uk.delete},{entityOptions:Object.assign({},e),entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.CommunitiesDeleteReplyChainDialogButton}}})}toggleCommunitiesCopilotView(e,t,i){return this.commandHandler({entity:{type:i,action:pe.uk.info,id:e,linkedEntity:{id:e,type:pe.py.communities}},command:t,entityOptions:{source:k.D.CommunitiesCopilot}})}showCommunitiesGallery(e,t){return this.commandHandler({entity:{type:pe.py.communitiesgallery,action:pe.uk.view,id:e},command:t})}getView(e,t,i,n,o,r){const s={channelId:r,replyChainId:o},a=r?JSON.stringify(s):void 0;return this.commandHandler(Object.assign({entity:{id:a,type:e,action:null!=t?t:pe.uk.default},command:{stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:n||k.D.ChannelListItem}}},t===pe.uk.join||t===pe.uk.update?{entityOptions:{inviteLinkUrl:i,messageId:o}}:{}))}}class sn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}openContactsSyncPopout(e){return this.commandHandler({entity:{type:pe.py.contactssync,action:pe.uk.default,id:"default"},command:(null==e?void 0:e.entityCommand)||{stateTransition:ve.su.new,visibilityState:ve.fe.show,correlation:{source:k.D.Flyout}},windowOptions:null==e?void 0:e.windowOptions})}openContactsSyncModal(){return this.extensionCommanding.executeCommand({type:pe.py.contactssync,action:pe.uk.view,id:"default"})}launchContactsModal(e,t){return this.extensionCommanding.executeCommand({type:pe.py.contactssync,action:pe.uk.info,id:e},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:t}})}showHideContactsView(e,t,i){return this.commandHandler({entity:{type:pe.py.contactssync,action:pe.uk.view,id:e},command:{stateTransition:ve.su.flush,visibilityState:i?ve.fe.show:ve.fe.hide,correlation:t}})}}class an{constructor(e){this.commandHandler=e}discoverApps(e,t){return this.commandHandler({entity:{type:pe.py.discoverappsnotifications,action:pe.uk.view},command:t,entityOptions:e})}}class ln{constructor(e,t){this.commandHandler=e,this.loggerFactory=t,this.logger=this.loggerFactory.newLogger("DiscoverSurfaceCommandingService","core-services-entity-commanding")}showDiscoverSurface(e){return this.logger.log(`showDiscoverSurface: called with - ${pe.py.discoversurface}:${pe.uk.view}`),this.commandHandler({entity:{type:pe.py.discoversurface,action:pe.uk.view},command:null==e?void 0:e.entityCommand,entityOptions:null==e?void 0:e.entityOptions})}showDiscoverSurfaceSettings(e){var t;return this.logger.log(`showDiscoverSurfaceSettings: called with - ${pe.py.discoversurface}:${pe.uk.view}`),this.commandHandler({entity:{type:pe.py.discoversurfacesettings,action:pe.uk.view},command:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:null!==(t=null==e?void 0:e.commandSource)&&void 0!==t?t:k.D.DiscoverSurfaceHeader}},entityOptions:null==e?void 0:e.entityOptions})}}class cn{constructor(e){this.commandHandler=e}launchErrorApp(e){return this.commandHandler({entity:{type:pe.py.error,action:pe.uk.view},command:{stateTransition:ve.su.forceFlush,visibilityState:ve.fe.show,correlation:{source:k.D.LayoutError}},entityOptions:{errorReason:e.code}})}}class dn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t,this.entityAllowList=[pe.py.esp,pe.py.help,pe.py.storefre,pe.py.whatsnewdialog]}displaySurface(e,t,i){return this.commandHandler({entity:{type:pe.py.esp,action:pe.uk.create,id:e},entityOptions:{forceShow:t,customParams:i}})}displayFollowUpSurface(e,t){return this.commandHandler({entity:{type:pe.py.esp,action:pe.uk.create,id:e},entityOptions:{forceShow:t,espTrigger:"FollowUp"}})}launchDialog(e,t){let i=pe.py.esp;if(t){if(!this.entityAllowList.includes(t))throw new Error("launchDialog must be called with Entity from the allow list.");i=t}return this.extensionCommanding.executeCommand({id:e,type:i,action:pe.uk.view})}closeDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:null!=t?t:pe.py.esp,action:pe.uk.view},{entityCommand:{visibilityState:ve.fe.hide,stateTransition:ve.su.extend,correlation:{source:k.D.ExtensionCommanding}}})}navigate(e,t,i){return this.commandHandler({entity:e,command:t,entityOptions:i})}}class un{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}surveyDialogWithObserver(e,t,i){var n;const o=Object.assign(Object.assign({},i),{source:null===(n=null==t?void 0:t.correlation)||void 0===n?void 0:n.source,entityStateTransition:null==t?void 0:t.stateTransition});return this.extensionCommanding.executeCommand({action:pe.uk.view,type:pe.py.survey,id:e},{entityCommand:t,entityOptions:o})}surveyDialog(e,t,i){var n;const o=Object.assign(Object.assign({},i),{source:null===(n=null==t?void 0:t.correlation)||void 0===n?void 0:n.source,entityStateTransition:null==t?void 0:t.stateTransition});return this.commandHandler({entity:{type:pe.py.survey,action:pe.uk.view,id:e},command:t,entityOptions:o})}giveFeedbackDialog(e){return this.commandHandler({entity:{type:pe.py.givefeedbackchoices,action:pe.uk.view},command:e})}}class mn{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}galleryImage(e,t){const i=e.galleryId,n={type:pe.py.galleryImages,action:pe.uk.view,id:i};return this.commandHandler({entity:n,command:t,entityOptions:e})}galleryImageExtended(e,t){const i=e.galleryId,n={type:pe.py.galleryImages,action:pe.uk.view,id:i};return this.extensionCommanding.executeCommand(n,{entityCommand:t,entityOptions:e})}fileById(e){const t=e.fileId;return this.commandHandler({entity:{type:pe.py.file,action:pe.uk.view,id:t},entityOptions:e})}launchFileViewApp(e,t,i=k.D.FileViewer){const n={subEntityId:JSON.stringify(t)};return this.commandHandler({entity:{type:pe.py.extensions,action:pe.uk.view,id:JSON.stringify({appId:e,fileId:t.fileId.toLowerCase()}),linkedEntity:{id:JSON.stringify(n),type:pe.py.extensions}},command:{visibilityState:ve.fe.show,stateTransition:t.shouldOpenInMultiWindow?ve.su.new:ve.su.flush,correlation:{source:i}},entityOptions:{entryPoint:"personalApp"}})}openInOneup(e,t=k.D.FileViewer){const i=e.fileId;let n,o;switch(e.context){case"channelsPDFTab":{const t={channelId:e.threadId,replyChainId:void 0};o={type:pe.py.filesoneupviewer,action:pe.uk.view,id:e.entityId,linkedEntity:{id:JSON.stringify(t),type:pe.py.channels}},n=k.D.ChannelHeader;break}case"chatPDFTab":o={type:pe.py.filesoneupviewer,action:pe.uk.view,id:e.entityId,linkedEntity:{id:e.threadId?e.threadId:"",type:pe.py.chats}},n=k.D.ChatHeader;break;case"ChannelMakeAsATab":{const t={channelId:e.threadId,replyChainId:void 0};o={type:pe.py.extensions,action:pe.uk.view,id:e.entityId,linkedEntity:{id:JSON.stringify(t),type:pe.py.channels}},n=k.D.ChannelHeader;break}default:o={type:pe.py.filesoneupviewer,action:pe.uk.view,id:i},n=t}return this.commandHandler({entity:o,command:{visibilityState:ve.fe.show,stateTransition:e.shouldOpenInMultiWindow?ve.su.new:ve.su.flush,correlation:{id:(0,xe.v4)(),source:n}},entityOptions:e})}closeOneup(e,t=k.D.FileViewer){return this.commandHandler({entity:{type:pe.py.filesoneupviewer,action:pe.uk.view,id:e},command:{visibilityState:ve.fe.hide,stateTransition:ve.su.flush,correlation:{source:t}}})}fileOpenSettingsSuggestion(e){return this.commandHandler({entity:{type:pe.py.fileopensettings,action:pe.uk.info},entityOptions:e})}fileOpenSettingsUpdate(e){return this.commandHandler({entity:{type:pe.py.fileopensettings,action:pe.uk.update},entityOptions:e})}fileOpenSettingsUpdateV2(e,t){return this.commandHandler({entity:{type:pe.py.fileopensettings,action:pe.uk.update},entityOptions:e,command:t})}chatFilesList(e,t){return this.commandHandler({entity:{id:null,type:pe.py.file,action:pe.uk.list,linkedEntity:{type:pe.py.chats,id:e}},command:t})}photosList(e,t){return this.commandHandler({entity:{id:null,type:pe.py.gallery,action:pe.uk.view,linkedEntity:{type:pe.py.chats,id:e}},command:t})}launchFilePicker(e,t,i,n){return this.extensionCommanding.executeCommand({type:pe.py.filepicker,action:pe.uk.view},{entityCommand:i,entityOptions:{fileContainerKey:e,filePickerContext:t,filePickerConfigurationOverrides:n}})}launchCloudStorageDialog(e,t,i){return this.extensionCommanding.executeCommand({type:pe.py.cloudStorageDialog,action:pe.uk.view},{entityCommand:i,entityOptions:{isClassMaterialRequired:e,channelId:t}})}}class gn{constructor(e){this.commandHandler=e}launchFlyoutHomePage(){const e={id:(0,xe.v4)(),source:k.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:pe.py.flyout,action:pe.uk.default},command:{correlation:e,stateTransition:ve.su.flush,visibilityState:ve.fe.show,layoutMode:ve.lO.minimal}})}showPhonelinkPairingPage(e){const t={id:(0,xe.v4)(),source:k.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{id:e,type:pe.py.flyoutphonelink,action:pe.uk.default},command:{correlation:t,stateTransition:ve.su.flush,visibilityState:ve.fe.show,layoutMode:ve.lO.minimal}})}showFlyoutWhatsNew(){const e={id:(0,xe.v4)(),source:k.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:pe.py.flyoutwhatsnew,action:pe.uk.default},command:{correlation:e,stateTransition:ve.su.flush,visibilityState:ve.fe.show,layoutMode:ve.lO.minimal}})}openMinimodeMeetingScheduler(){const e={id:(0,xe.v4)(),source:k.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:pe.py.minimodeMeetingScheduler,action:pe.uk.view},command:{correlation:e,stateTransition:ve.su.new,visibilityState:ve.fe.show}})}closeMinimodeMeetingScheduler(){const e={id:(0,xe.v4)(),source:k.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:pe.py.minimodeMeetingScheduler,action:pe.uk.view},command:{correlation:e,visibilityState:ve.fe.hide,stateTransition:ve.su.forceFlush}})}}class hn{constructor(e){this.commandHandler=e}freemiumUpgrade(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.commandHandler({entity:{type:pe.py.freemiumupgrade,action:pe.uk.view},command:e,entityOptions:t})}))}}class pn{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}guardiansTabInChannelById(e,t,i,n){const o={type:pe.py.guardians,action:pe.uk.list,id:e,linkedEntity:i};return this.commandHandler({entity:o,command:t,entityOptions:n})}showGuardiansApprovalRequestDialog(e,t){const i={type:pe.py.guardiansapprovalrequest,action:pe.uk.create};return this.commandHandler({entity:i,command:e,entityOptions:t})}showSendApprovalSuccessDialog(e){const t={type:pe.py.guardianssendapprovalsuccess,action:pe.uk.create};return this.extensionCommanding.executeCommand(t,{entityCommand:e})}showSendApprovalErrorDialog(e){const t={type:pe.py.guardianssendapprovalerror,action:pe.uk.create};return this.extensionCommanding.executeCommand(t,{entityCommand:e})}}class vn{constructor(e){this.commandHandler=e}launchTflHomepage(){const e={id:(0,xe.v4)(),source:k.D.Homepage,startTimestamp:Date.now()};return this.commandHandler({entity:{type:pe.py.homepage,action:pe.uk.default},command:{correlation:e,stateTransition:ve.su.flush,visibilityState:ve.fe.show}})}}class yn{constructor(e){this.extensionCommanding=e}showCreatePostDialog(e,t,i,n){return this.extensionCommanding.executeCommand({type:pe.py.classesintegrationcontent,action:pe.uk.create},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.LmsCourseTeams}},entityOptions:{teamId:e,teamName:t,groupId:i,tenantId:n}})}}class fn{constructor(e){this.commandHandler=e}viewLobNotifications(e,t){return this.commandHandler({entity:{type:pe.py.lobnotifications,action:pe.uk.view},command:t,entityOptions:e})}}class Sn{constructor(e){this.commandHandler=e}analytics(e,t){return this.commandHandler({entity:{type:pe.py.meetinganalytics,action:pe.uk.view},command:e,entityOptions:t})}openAttendanceTabInSchedulingForm(e,t,i="",n=0){return this.commandHandler({entity:{type:pe.py.attendancereport,action:pe.uk.view,linkedEntity:{type:pe.py.schedulingform,action:pe.uk.view,id:JSON.stringify({eventId:(0,tn.cW)(i),providerType:n})}},command:e,entityOptions:Object.assign(Object.assign({},t),{eventId:(0,tn.cW)(i)})})}openAnalyticsInSchedulingForm(e,t,i="",n=0){return this.commandHandler({entity:{type:pe.py.meetinganalytics,action:pe.uk.view,linkedEntity:{type:pe.py.schedulingform,action:pe.uk.view,id:JSON.stringify({eventId:(0,tn.cW)(i),providerType:n,tabId:"Attendance",key:(0,xe.v4)()})}},command:e,entityOptions:Object.assign(Object.assign({},t),{eventId:(0,tn.cW)(i)})})}openAttendanceTabInMeetingChat(e,t){return this.commandHandler({entity:{type:pe.py.meetinganalytics,action:pe.uk.view},command:e,entityOptions:{threadId:t,subType:"meetingchat"}})}openAttendanceTabInMeetingRecapOfChat(e,t){return this.commandHandler({entity:{type:pe.py.meetinganalytics,action:pe.uk.view,linkedEntity:{type:pe.py.chats,action:pe.uk.view,id:(null==t?void 0:t.threadId)||""}},command:e,entityOptions:t})}}class kn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}meetingOptionsFormView(e,t,i,n,o,r){return this.commandHandler({entity:{type:pe.py.meetings,action:pe.uk.view,id:this.serializeMeetingCoordinates(e,t,i,n,o)},command:r})}meetingOptionsCreateViewDialog(e,t,i){const n={type:pe.py.meetingoptionscreatedialog,id:e.id,action:e.action};return this.extensionCommanding.executeCommand(n,{entityCommand:t,entityOptions:i})}serializeMeetingCoordinates(e,t,i,n,o){return JSON.stringify({tenantId:e,organizerId:t,threadId:i,messageId:n,additionalMessageId:o})}}class bn{constructor(e){this.commandHandler=e}recapTabInMeetingChat(e,t,i){return this.commandHandler({entity:{type:pe.py.meetingrecap,action:pe.uk.view,linkedEntity:i?{type:pe.py.chats,action:pe.uk.view,id:(null==t?void 0:t.threadId)||""}:null},command:e,entityOptions:t})}recapTabInSchedulingForm(e,t,i){return this.commandHandler({entity:{type:pe.py.meetingrecap,action:pe.uk.view,linkedEntity:{type:pe.py.schedulingform,action:pe.uk.view,id:JSON.stringify({eventId:(0,tn.cW)((null==t?void 0:t.externalEntityKey)||""),providerType:i,tabId:"Recap",key:(0,xe.v4)()})}},command:e,entityOptions:t})}popOutMeetingRecap(e){const t={id:(0,xe.v4)(),source:k.D.ChatListItem,startTimestamp:Date.now()},{externalEntityKey:i,threadId:n}=e||{};return this.commandHandler({entity:{type:pe.py.meetingrecap,action:pe.uk.view,id:i||n},command:{stateTransition:ve.su.new,visibilityState:ve.fe.show,correlation:t},entityOptions:Object.assign(Object.assign({},e),{subType:"popup"})})}recapPageInChannel(e,t){const{externalEntityKey:i,threadId:n}=t||{};return this.commandHandler({entity:{type:pe.py.meetingrecap,action:pe.uk.view,id:i||n},command:e,entityOptions:t})}}var wn;!function(e){e.JoinByCode="JoinByCode",e.Dialpad="Dialpad",e.Cortana="Cortana",e.SmartDeviceJoinByCode="SmartDeviceJoinByCode"}(wn||(wn={}));class Cn{constructor(e){this.commandHandler=e}meetingRoomConsoleInCallById(e,t,i,n){return this.commandHandler({entity:{type:e,action:pe.uk.view,id:t},entityOptions:i,command:n})}meetingRoomNewCall(e){return this.commandHandler({entity:{type:e,action:pe.uk.create},entityOptions:{stateParams:{isPstnCall:!0},createCallType:wn.Dialpad},command:{stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.Calling}}})}meetingRoomBroadcast(e,t){return this.commandHandler({entity:{type:e,action:pe.uk.share},command:t})}meetingRoomSmartDeviceJoinByCode(e){return this.commandHandler({entity:{type:pe.py.meetingroomconsolecall,action:pe.uk.create},entityOptions:{createCallType:wn.SmartDeviceJoinByCode},command:e})}meetingRoomJoinByCode(e,t){return this.commandHandler({entity:{type:e,action:pe.uk.create},entityOptions:{createCallType:wn.JoinByCode},command:t})}meetingRoomHome(e,t){return this.commandHandler({entity:{type:e,action:pe.uk.list},entityOptions:{},command:t})}meetingRoomPostCall(e,t,i){return this.commandHandler({entity:{type:e,action:pe.uk.health},entityOptions:i,command:t})}meetingRoomFrontOfRoom(e,t,i){return this.commandHandler({entity:{id:e,type:t,action:pe.uk.create},command:i})}}class _n{constructor(e){this.commandHandler=e}viewOnboardingNotifications(e,t){return this.commandHandler({entity:{type:pe.py.onboardingnotifications,action:pe.uk.view},command:t,entityOptions:e})}}var Tn=i(554404);class In{constructor(e,t,i){this.commandHandler=e,this.extensionCommanding=t,this.coreSettings=i}launchTaskModule(e,t){const i=(null==t?void 0:t.entityCommand)||this.getDefaultExtensionCommand();return i.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.taskmodule,action:pe.uk.create},{entityCommand:i,entityOptions:null==t?void 0:t.taskModuleOptions})}launchHWCTaskModule(e,t){const i=(null==t?void 0:t.entityCommand)||this.getDefaultExtensionCommand();return i.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.hwctaskmodule,action:pe.uk.create},{entityCommand:i,entityOptions:null==t?void 0:t.taskModuleOptions})}launchStage(e){const t=(null==e?void 0:e.entityCommand)||this.getDefaultExtensionCommand();return t.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({type:pe.py.platformStage,action:pe.uk.view},{entityCommand:t,entityOptions:null==e?void 0:e.stageOptions})}launchReactStageModal(e,t,i){const n=i||this.getDefaultExtensionCommand();return this.extensionCommanding.executeCommand({id:e,type:pe.py.platformstagemodal,action:pe.uk.view},{entityCommand:n,entityOptions:t})}launchStageMW(e){return this.commandHandler({entity:{id:e.id,type:pe.py.platformStage,action:pe.uk.create,linkedEntity:e.linkedEntity},command:{stateTransition:ve.su.new,visibilityState:ve.fe.show,correlation:{source:e.commandSource||k.D.PlatformExtension,startTimestamp:e.stageOptions.scenarioStartTime}},entityOptions:e.stageOptions})}launchStageMWWithoutChat(e){return this.commandHandler({entity:{id:e.id,type:pe.py.platformstagewithoutchat,action:pe.uk.view},command:{stateTransition:ve.su.new,visibilityState:ve.fe.show,correlation:{source:e.commandSource||k.D.PlatformExtension,startTimestamp:e.stageOptions.scenarioStartTime}},entityOptions:e.stageOptions})}launchAppEnableDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.enableappdialog,action:pe.uk.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchTabGallery(e){const t=(null==e?void 0:e.entityCommand)||this.getDefaultExtensionCommand();return t.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({type:pe.py.platformTabGallery,action:pe.uk.view},{entityCommand:t,entityOptions:null==e?void 0:e.tabGalleryOptions})}launchUnsupportedDeeplinkDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.unsupporteddeeplinkdialog,action:pe.uk.view},{entityOptions:{originalDeeplink:e}})}launchAppDetails(e,t){const i=(null==t?void 0:t.entityCommand)||this.getDefaultExtensionCommand();return i.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.platformapp,action:pe.uk.create},{entityCommand:i,entityOptions:null==t?void 0:t.platformAppDetailsOptions})}launchAppDetailsTutorial(e){return this.extensionCommanding.executeCommand({type:pe.py.platformappdetails,action:pe.uk.info},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchAppRevokeConsent(e){return this.extensionCommanding.executeCommand({type:pe.py.platformappconsent,action:pe.uk.delete},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}appDetailsPostInstall(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=ve.su.none,this.commandHandler({entity:{type:pe.py.platformappdetails,action:pe.uk.config},command:t,entityOptions:e})}appDetailsPostInstallV2(e){return this.extensionCommanding.executeCommand({type:pe.py.platformappdetails,action:pe.uk.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}appDetailsOnDone(e,t){const i=this.getDefaultExtensionCommand();return i.stateTransition=ve.su.none,this.commandHandler({entity:{id:e,type:pe.py.platformappdetails,action:pe.uk.update},command:i,entityOptions:t})}launchInContextStore(e){return this.extensionCommanding.executeCommand({type:pe.py.incontextstore,action:pe.uk.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}inContextStorePostInstall(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=ve.su.none,this.commandHandler({entity:{type:pe.py.incontextstore,action:pe.uk.config},command:t,entityOptions:e})}inContextStoreOnDone(e,t){const i=this.getDefaultExtensionCommand();return i.stateTransition=ve.su.none,this.commandHandler({entity:{id:e,type:pe.py.incontextstore,action:pe.uk.update},command:i,entityOptions:t})}launchAppStore(e,t){return this.commandHandler({entity:{type:pe.py.platformapps,action:pe.uk.list},command:t,entityOptions:e})}launchDefaultPersonalApp(){return this.commandHandler({entity:{type:pe.py.default,action:pe.uk.view},command:{stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.Unknown}}})}launchPersonalApp(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=ve.su.none,this.commandHandler({entity:{type:pe.py.platformapp,action:pe.uk.view},command:t,entityOptions:e})}launchAppUninstall(e,t){const i=(null==t?void 0:t.entityCommand)||this.getDefaultExtensionCommand();return i.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.platformapp,action:pe.uk.delete},{entityCommand:i,entityOptions:null==t?void 0:t.uninstallOptions})}launchAppError(e){return this.extensionCommanding.executeCommand({type:pe.py.platformapp,action:pe.uk.error},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchContextlessConfigDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.platformapp,action:pe.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchManifestParsingErrorDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.customapp,action:pe.uk.error},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchUploadCustomApp(){return this.extensionCommanding.executeCommand({type:pe.py.customapp,action:pe.uk.view},{entityCommand:this.getDefaultExtensionCommand()})}launchRequestSubmittedDialog(){return this.extensionCommanding.executeCommand({type:pe.py.customapp,action:pe.uk.info},{entityCommand:this.getDefaultExtensionCommand()})}launchLocationDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.locationapi,action:pe.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchSelectMediaDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.selectMediaApi,action:pe.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchViewImagesDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.viewImagesApi,action:pe.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchSelectPeoplePickerDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.selectpeoplepicker,action:pe.uk.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchAppRatingCoachmark(e){return this.extensionCommanding.executeCommand({type:pe.py.platformappratingcoachmark,action:pe.uk.view},{entityCommand:null!=e?e:this.getDefaultExtensionCommand()})}launchAppConfig(e,t){const i=(null==t?void 0:t.entityCommand)||this.getDefaultExtensionCommand();return i.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.platformapp,action:pe.uk.config},{entityCommand:i,entityOptions:null==t?void 0:t.launchAppConfigOptions})}launchTabInfo(e,t){const i=(null==t?void 0:t.entityCommand)||this.getDefaultExtensionCommand();return i.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.platformtab,action:pe.uk.info},{entityCommand:i,entityOptions:null==t?void 0:t.launchTabInfoOptions})}launchStagedApps(e){const t=(null==e?void 0:e.entityCommand)||this.getDefaultExtensionCommand();return t.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({type:pe.py.stagedapps,action:pe.uk.info},{entityCommand:t,entityOptions:null==e?void 0:e.launchStagedAppsOptions})}launchAppAuthConsent(e,t){const i=(null==t?void 0:t.entityCommand)||this.getDefaultExtensionCommand();return i.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.platformauthconsentdialog,action:pe.uk.create},{entityCommand:i,entityOptions:null==t?void 0:t.launchAuthConsentOptions})}platformTabById(e,t,i,n){return this.commandHandler({entity:{id:e,type:pe.py.extensions,action:pe.uk.view,linkedEntity:i},command:t,entityOptions:n})}launchPersonalPlatformApp(e,t,i,n,o){return this.commandHandler({entity:{id:JSON.stringify({appId:e,tabEntityId:i}),type:pe.py.extensions,action:pe.uk.view,linkedEntity:o},command:{visibilityState:ve.fe.show,stateTransition:t?ve.su.new:ve.su.flush,correlation:{source:null!=n?n:k.D.AppBar,startTimestamp:Date.now()}},entityOptions:{isMultiWindow:t,entryPoint:Tn.mQ.personalApp}})}platformAppById(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.extensions,action:pe.uk.view,linkedEntity:i},command:t})}navigateToManageApps(e){return this.commandHandler({entity:{type:pe.py.platformapps,action:pe.uk.manage},entityOptions:e})}launchSubscriptionPlansDialog(e,t,i){const n=i||this.getDefaultExtensionCommand();return n.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.platformsubscriptionplans,action:pe.uk.info},{entityCommand:n,entityOptions:t})}launchAngularAppDetails(e,t,i){const{enableAppDetailsAngularFeatureParity:n}=this.coreSettings.get(b.J.Host);if(n)return this.launchAppDetails(e,{platformAppDetailsOptions:t,entityCommand:i});const o=i||this.getDefaultExtensionCommand();return o.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({id:e,type:pe.py.platformapp,action:pe.uk.info},{entityCommand:o,entityOptions:t})}launchCustomAppFilePicker(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.customapp,action:pe.uk.create},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:i||k.D.Store}},entityOptions:t})}launchWorkflowsDialog(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.workflows,action:pe.uk.create},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:i||k.D.Store}},entityOptions:t})}launchWorkflowSelectionDialog(e,t,i,n){let o=pe.py.chatworkflows;const r=pe.uk.view;switch(t){case k.D.ChatListItem:o=pe.py.chatworkflows;break;case k.D.ChannelListItem:o=pe.py.channelworkflows}return this.extensionCommanding.executeCommand({id:e,type:o,action:r},{entityCommand:i,entityOptions:n})}launchManageWorkflows(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.workflows,action:pe.uk.manage},entityOptions:t,command:{visibilityState:ve.fe.show,stateTransition:ve.su.none,correlation:{source:i||k.D.Store}}})}launchSettingsDialog(e,t,i){const n={visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:i||k.D.Card}};return this.extensionCommanding.executeCommand({id:e,type:pe.py.settingsdialog,action:pe.uk.view},{entityCommand:n,entityOptions:t})}updatePlatformTabById(e,t,i,n){return this.commandHandler({entity:{id:e,type:pe.py.extensions,action:pe.uk.update,linkedEntity:i},command:t,entityOptions:n})}videoEffectsCustomizationPanelById(e,t){return this.commandHandler({entity:{type:pe.py.videoeffectscustomization,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}videoEffectsMoreViewPanelById(e,t,i){return this.commandHandler({entity:{type:pe.py.videoeffectsmoreview,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t,entityOptions:i})}videoEffectsAndAvatarPanelById(e,t,i){return this.commandHandler({entity:{type:pe.py.videoeffectsandavatar,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t,entityOptions:i})}videoEffectsAndSettingsPanelById(e,t,i){return this.commandHandler({entity:{type:pe.py.videoeffectsandsettings,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t,entityOptions:i})}meshAvatarPanelById(e,t){return this.commandHandler({entity:{type:pe.py.meshavatar,action:pe.uk.view,linkedEntity:{type:pe.py.calls,id:e}},command:t})}launchManageAppsUninstall(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.manageapps,action:pe.uk.delete},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchManageAppsWebhook(e,t){const i=t.editMode?pe.uk.update:pe.uk.create;return this.extensionCommanding.executeCommand({id:e,type:pe.py.manageappswebhook,action:i},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchManageAppsWebhookConfirmation(e){const t={webhookToken:e};return this.extensionCommanding.executeCommand({type:pe.py.manageappswebhook,action:pe.uk.info},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}selectAppEntity(e){const t=(null==e?void 0:e.entityCommand)||this.getDefaultExtensionCommand();return t.visibilityState=ve.fe.show,this.extensionCommanding.executeCommand({type:pe.py.platformTabGallery,action:pe.uk.create},{entityCommand:t,entityOptions:null==e?void 0:e.selectAppEntityOptions})}launchAppDevicePermissions(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.platformappdevicepermissions,action:pe.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchAppDevicePermissionsFirstRun(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.platformappdevicepermissions,action:pe.uk.update},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchRefreshConfirmationAfterAppDevicePermissionsUpdate(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.platformappdevicepermissions,action:pe.uk.confirm},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}hideExtension(e){return this.extensionCommanding.executeCommand(e,{entityCommand:{visibilityState:ve.fe.hide,stateTransition:ve.su.extend,correlation:{source:k.D.ExtensionCommanding}}})}getDefaultExtensionCommand(){return{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.ExtensionCommanding}}}}class jn{constructor(e,t){this.commandHandler=e,this.coreSettings=t}registration(e){const{enableMultiWindowWebinarRegistration:t}=this.coreSettings.get(b.J.WebinarRegistration);return t?this.commandHandler({entity:{action:pe.uk.view,id:e,type:pe.py.registration},command:{visibilityState:ve.fe.show,stateTransition:ve.su.new,correlation:{source:k.D.Calendar}}}):((0,F.J)().open(`${(0,F.J)().location.origin}/registration/${e}?mode=edit`,"_blank"),Promise.resolve())}}class Nn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}showTeamsGrid(e){return this.commandHandler({entity:{type:pe.py.schoolteams,action:pe.uk.list},command:{visibilityState:ve.fe.show,stateTransition:ve.su.flush,correlation:{source:k.D.SchoolTeams}},entityOptions:{lastVisitedTeamId:e}})}gridTeamDiscover(){return this.commandHandler({entity:{type:pe.py.schoolteams,action:pe.uk.join},command:{stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.SchoolTeams}}})}showSingleTeam(e){return this.commandHandler({entity:{type:pe.py.channels,action:pe.uk.view,id:e},command:{visibilityState:ve.fe.show,stateTransition:ve.su.flush,correlation:{source:k.D.SchoolTeams}}})}showUnlockDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.schoolteams,action:pe.uk.update,id:e},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.UnlockTeam}}})}}class En{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t,this.updateSearchState=(e,t,i,n)=>{const o={type:pe.py.search,action:pe.uk.view};let r;const s=i?`${null==e?void 0:e.searchQuery}${(null==e?void 0:e.currentTab)?` | ${null==e?void 0:e.currentTab}`:""}`:null==e?void 0:e.searchQuery;return r=t?Object.assign({},o):n&&n.type===pe.py.search&&n.action===pe.uk.view?Object.assign(Object.assign({},n),i?{id:s}:{}):Object.assign(Object.assign({},o),{id:s}),this.commandHandler({entity:r,command:{correlation:{id:(0,xe.v4)(),startTimestamp:Date.now(),source:k.D.Search},stateTransition:i?ve.su.flush:ve.su.none,visibilityState:ve.fe.show},entityOptions:e})},this.updateSearchStateRW=(e,t,i)=>this.commandHandler({entity:{id:t||e&&e.searchQuery,type:pe.py.search,action:pe.uk.view},command:{correlation:{id:(0,xe.v4)(),startTimestamp:Date.now(),source:k.D.Search},stateTransition:i||ve.su.flush,visibilityState:ve.fe.show},entityOptions:e}),this.sendSearchStateToMetaOSSearchService=(e,t)=>this.commandHandler({entity:{id:JSON.stringify({appId:t}),type:pe.py.extensions,action:pe.uk.view},command:{correlation:{id:(0,xe.v4)(),startTimestamp:Date.now(),source:k.D.Search},stateTransition:ve.su.flush,visibilityState:ve.fe.show},entityOptions:e}),this.open3SFeedback=e=>this.commandHandler({entity:{type:pe.py.open3sfeedback,action:pe.uk.view},command:{correlation:{source:k.D.Search},stateTransition:ve.su.new,visibilityState:ve.fe.show},entityOptions:e}),this.exitSearchState=()=>this.commandHandler({entity:{type:pe.py.search,action:pe.uk.view,id:"search"},command:{correlation:{source:k.D.Search},stateTransition:ve.su.forceFlush,visibilityState:ve.fe.hide}})}openFeedback(e,t){return this.extensionCommanding.executeCommand({type:pe.py.openfeedbackdialog,action:pe.uk.view},{entityCommand:e,entityOptions:t})}}class xn{constructor(e){this.commandHandler=e}launch(e,t){return this.commandHandler({entity:{type:pe.py.settingsstore,action:pe.uk.default,id:t},command:e})}launchSection(e,t,i,n){return this.commandHandler({entity:{type:null!=n?n:pe.py.settingsstore,action:pe.uk.view,id:e},command:t,entityOptions:Object.assign(Object.assign({},i),{commandSource:null==t?void 0:t.correlation.source})})}}class An{constructor(e){this.extensionCommanding=e}launchShareFormDialog(e,t){const i=(null==t?void 0:t.entityCommand)||this.getDefaultCommand();return i.visibilityState=ve.fe.show,i.stateTransition=ve.su.extend,this.extensionCommanding.executeCommand({id:e,type:pe.py.shareformdialog,action:pe.uk.view},{entityCommand:i,entityOptions:null==t?void 0:t.entityOptions})}getDefaultCommand(){return{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.ExtensionCommanding}}}}class Dn{constructor(e){this.commandHandler=e}viewStore(e,t,i){return this.commandHandler({entity:{type:pe.py.store,action:pe.uk.view,id:e},command:i,entityOptions:t})}showStoreFre(e,t){return this.commandHandler({entity:{type:pe.py.storefre,action:pe.uk.view,id:t},command:{visibilityState:e?ve.fe.show:ve.fe.hide,stateTransition:ve.su.extend,correlation:{source:k.D.ExtensionCommanding}}})}viewManageAppsTab(e,t){return this.commandHandler({entity:{type:pe.py.store,action:pe.uk.manage},command:t,entityOptions:e})}}var Fn,On=i(551675);function Mn(e){return{id:e||"",type:pe.py.channels,action:pe.uk.list}}function Rn(e,t=ve.su.flush){return{stateTransition:t,visibilityState:ve.fe.show,correlation:{source:e}}}!function(e){e.User="user",e.Team="team",e.TeamOwned="teamowned"}(Fn||(Fn={}));class Pn{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}editTeamPicture(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teampicture,action:pe.uk.view})}viewTeamJoinCode(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teamjoincode,action:pe.uk.view},{entityOptions:{teamJoinCode:t}})}viewTeamRenewal(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teamrenewal,action:pe.uk.view},{entityOptions:{expiryTime:t}})}editTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teamedit,action:pe.uk.view},{entityOptions:t})}addMember(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.addmember,action:pe.uk.view})}addMemberToTeamDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.addmembertoteamdialog,action:pe.uk.view},{entityOptions:t})}addMemberToPrivateChannelDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.addmembertoprivatechanneldialog,action:pe.uk.view},{entityOptions:t})}shareChannelWithUserDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.sharechannelwithuserdialog,action:pe.uk.view},{entityOptions:t})}addMemberToNewTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.addmembernewteam,action:pe.uk.view},{entityOptions:t})}addChannel(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.addchannel,action:pe.uk.view})}createChannel(e){return this.extensionCommanding.executeCommand({type:pe.py.createchanneldialog,action:pe.uk.view},{entityOptions:e})}createChannelOnLeftRail(e){return this.extensionCommanding.executeCommand({type:pe.py.createchannelleftraildialog,action:pe.uk.view},{entityOptions:e})}manageApps(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.teammanageapps,action:pe.uk.view,linkedEntity:Mn(e)},command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData,entityOptions:null==i?void 0:i.entityOptions})}manageTags(e,t,i,n){return this.commandHandler({entity:{id:e,type:pe.py.teammanagetags,action:pe.uk.view,linkedEntity:Mn(e)},entityOptions:Object.assign(Object.assign({},null==n?void 0:n.entityOptions),{tagId:i}),scenarioEventData:null==n?void 0:n.scenarioEventData,command:(null==n?void 0:n.entityCommand)||Rn(null!=t?t:k.D.ChannelListItem)})}leaveTeam(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teamleave,action:pe.uk.view})}createTeam(){return this.extensionCommanding.executeCommand({type:pe.py.teamcreate,action:pe.uk.view})}archiveTeam(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teamarchive,action:pe.uk.view})}restoreTeam(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teamrestore,action:pe.uk.view})}launchConfirmPinUnpinPost(e,t){return this.extensionCommanding.executeCommand({type:pe.py.pinunpinpost,action:pe.uk.view},{entityCommand:t,entityOptions:e})}createTeamOnMainView(e,t){const i=(null==e?void 0:e.source)||On.IC.template;return this.commandHandler({entity:{id:i,type:pe.py.teams,action:pe.uk.create},entityOptions:e,command:Rn(null!=t?t:k.D.ChannelList)})}createTeamV2(){return this.extensionCommanding.executeCommand({type:pe.py.teamcreatedialog,action:pe.uk.view})}showListView(){return this.commandHandler({entity:{type:pe.py.channels,action:pe.uk.view},command:Rn(k.D.SchoolTeams)})}teamDiscover(){return this.commandHandler({entity:{type:pe.py.teamdiscover,action:pe.uk.view},command:Rn(k.D.ChannelListItem)})}manageTeam(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.teammanage,action:pe.uk.view,linkedEntity:Mn(e)},command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData,entityOptions:null==i?void 0:i.entityOptions})}manageTeams(e){return this.commandHandler({entity:{type:pe.py.teams,action:pe.uk.config},command:Rn(e)})}manageSharedChannelsPendingInvites(e,t,i){return this.commandHandler({entity:{id:i,type:pe.py.sharedchannelspendinginvites,action:pe.uk.view,linkedEntity:Mn(i)},command:(null==t?void 0:t.entityCommand)||Rn(e,ve.su.flow),scenarioEventData:null==t?void 0:t.scenarioEventData,entityOptions:(null==t?void 0:t.entityOptions)||{commandSource:e}})}manageTeamsList(e,t,i){return this.commandHandler({entity:{id:i,type:pe.py.teamslist,action:pe.uk.view,linkedEntity:Mn(i)},command:(null==t?void 0:t.entityCommand)||Rn(e,ve.su.flow),scenarioEventData:null==t?void 0:t.scenarioEventData,entityOptions:(null==t?void 0:t.entityOptions)||{commandSource:e}})}crossTeamAnalytics(e,t,i){return this.commandHandler({entity:{id:i,type:pe.py.crossteamanalytics,action:pe.uk.view,linkedEntity:Mn(i)},command:(null==t?void 0:t.entityCommand)||Rn(e),scenarioEventData:null==t?void 0:t.scenarioEventData,entityOptions:null==t?void 0:t.entityOptions})}acceptInvitation(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.sharedchannelacceptinvitation,action:pe.uk.view},{entityOptions:t})}declineInvitation(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.sharedchanneldeclineinvitation,action:pe.uk.view},{entityOptions:t})}teamDeepLink(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teamdeeplink,action:pe.uk.view})}channelDeepLink(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channeldeeplink,action:pe.uk.view})}viewChannelEmail(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channelemail,action:pe.uk.view})}viewChannelEmailV2(e,t){return this.extensionCommanding.executeCommand({type:pe.py.channelemailv2,action:pe.uk.view},{entityCommand:t,entityOptions:e})}removeChannelEmail(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.removechannelemail,action:pe.uk.view},{entityCommand:t})}launchChannelEmailErrorDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.channelemailerror,action:pe.uk.view},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.ChannelEmail}},entityOptions:{errorCode:e}})}manageChannelConnectors(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channelconnectors,action:pe.uk.view},{entityCommand:i,entityOptions:t})}connectorInstanceConfiguration(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.connectorinstanceconfiguration,action:pe.uk.view},{entityCommand:i,entityOptions:t})}deleteChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channeldelete,action:pe.uk.view},{entityOptions:t})}editChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channeledit,action:pe.uk.view},{entityOptions:t})}channelModerators(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channelmoderators,action:pe.uk.view})}manageChannel(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.channelmanage,action:pe.uk.view,linkedEntity:Mn(e)},entityOptions:{parentTeamId:null==t?void 0:t.parentTeamId},command:Rn(i||k.D.ChannelListItem)})}manageChannelApps(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.channelapps,action:pe.uk.view,linkedEntity:Mn(e)},entityOptions:Object.assign(Object.assign({},null==i?void 0:i.entityOptions),{parentTeamId:null==i?void 0:i.parentTeamId}),command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData})}manageChannelAnalytics(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.channelanalytics,action:pe.uk.view,linkedEntity:Mn(e)},entityOptions:Object.assign(Object.assign({},null==i?void 0:i.entityOptions),{parentTeamId:null==i?void 0:i.parentTeamId}),command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData})}manageChannelMembers(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.channelmembers,action:pe.uk.view,linkedEntity:Mn(e)},entityOptions:Object.assign(Object.assign({},null==i?void 0:i.entityOptions),{parentTeamId:null==i?void 0:i.parentTeamId}),command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData})}manageChannelSettings(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.channelsettings,action:pe.uk.view,linkedEntity:Mn(e)},entityOptions:Object.assign(Object.assign({},null==i?void 0:i.entityOptions),{parentTeamId:null==i?void 0:i.parentTeamId}),command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData})}manageChannelInvitations(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.channelinvitations,action:pe.uk.view},entityOptions:Object.assign(Object.assign({},null==i?void 0:i.entityOptions),{parentTeamId:null==i?void 0:i.parentTeamId}),command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData})}manageChannelTags(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.channeltags,action:pe.uk.view,linkedEntity:Mn(e)},entityOptions:Object.assign(Object.assign({},null==i?void 0:i.entityOptions),{parentTeamId:null==i?void 0:i.parentTeamId,tagId:null==i?void 0:i.tagId}),command:(null==i?void 0:i.entityCommand)||Rn(null!=t?t:k.D.ChannelListItem),scenarioEventData:null==i?void 0:i.scenarioEventData})}addChannelMember(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channelroster,action:pe.uk.manage})}leaveChannel(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channels,action:pe.uk.leave})}showHideGeneralChannel(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channels,action:pe.uk.confirm})}channelNotificationSettings(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channelnotificationsettings,action:pe.uk.view},{entityCommand:Rn(t||k.D.ChannelListItem),entityOptions:{commandSource:t||k.D.ChannelListItem,teamName:null==i?void 0:i.teamName,channelName:null==i?void 0:i.channelName}})}shareChannelWithUser(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channels,action:pe.uk.share},{entityOptions:{shareWith:Fn.User}})}shareChannelWithTeam(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channels,action:pe.uk.share},{entityOptions:{shareWith:Fn.Team}})}shareChannelWithTeamOwned(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.channels,action:pe.uk.share},{entityOptions:{shareWith:Fn.TeamOwned}})}manageTeamSettings(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.teamsettings,action:pe.uk.view,linkedEntity:Mn(e)},command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData,entityOptions:null==i?void 0:i.entityOptions})}manageTeamAnalytics(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.teamanalytics,action:pe.uk.view,linkedEntity:Mn(e)},command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData,entityOptions:null==i?void 0:i.entityOptions})}manageTeamChannels(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.teamchannels,action:pe.uk.view,linkedEntity:Mn(e)},command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData,entityOptions:null==i?void 0:i.entityOptions})}manageTeamPendingJoinRequest(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.teampendingrequests,action:pe.uk.view,linkedEntity:Mn(e)},command:(null==i?void 0:i.entityCommand)||Rn(t),scenarioEventData:null==i?void 0:i.scenarioEventData,entityOptions:null==i?void 0:i.entityOptions})}deleteTeam(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teams,action:pe.uk.delete})}restoreChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.restorechannel,action:pe.uk.view},{entityOptions:null==t?void 0:t.entityOptions})}showChannelOwners(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.showChannelOwners,action:pe.uk.view},{entityOptions:t})}showChannelOwnersReactDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.showchannelownersreactdialog,action:pe.uk.view},{entityOptions:e})}showForMemberDialog(e){return this.extensionCommanding.executeCommand({id:e,type:pe.py.showformemberdialog,action:pe.uk.view})}userOnboardingTeam(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.useronboardingteam,action:pe.uk.view},command:(null==i?void 0:i.entityCommand)||Rn(t||k.D.ChannelList),scenarioEventData:null==i?void 0:i.scenarioEventData,entityOptions:null==i?void 0:i.entityOptions})}}class Ln{constructor(e){this.commandHandler=e}openTranscriptTab({entityCommand:e,messageId:t,threadId:i,transcriptId:n,isOrganizer:o,meetingOrganizerId:r,meetingTenantId:s},a){return this.commandHandler({entity:{type:pe.py.transcriptcontent,action:pe.uk.view},command:e,entityOptions:{messageId:t,threadId:i,transcriptId:n,isOrganizer:o,meetingOrganizerId:r,meetingTenantId:s,eventId:a}})}openTranscriptInSchedulingForm({entityCommand:e,messageId:t,threadId:i,transcriptId:n,isOrganizer:o,meetingOrganizerId:r,meetingTenantId:s},a,l){return this.commandHandler({entity:{type:pe.py.transcriptcontent,action:pe.uk.view,linkedEntity:{type:pe.py.schedulingform,action:pe.uk.view,id:JSON.stringify({eventId:(0,tn.cW)(a),providerType:l,tabId:"Recordings & Transcripts",key:(0,xe.v4)()})}},command:e,entityOptions:{messageId:t,threadId:i,transcriptId:n,isOrganizer:o,eventId:(0,tn.cW)(a),meetingOrganizerId:r,meetingTenantId:s}})}openTranscriptInChatApp({entityCommand:e,messageId:t,threadId:i,transcriptId:n,isOrganizer:o,meetingOrganizerId:r,meetingTenantId:s,isOdspTranscript:a,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u},m,g){return this.commandHandler({entity:{id:n,type:pe.py.transcriptcontent,action:pe.uk.view,linkedEntity:g?{type:pe.py.chats,action:pe.uk.view,id:i||""}:null},command:e,entityOptions:{eventId:m?(0,tn.cW)(m):"",isOrganizer:o,meetingOrganizerId:r,meetingTenantId:s,messageId:t,threadId:i,transcriptId:n,isOdspTranscript:a,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u}})}}class Un{constructor(e,t,i,n){this.extensionCommanding=e,this.commandHandler=t,this.host=i,this.coreSettings=n}virtualEventsList(e){return this.commandHandler({entity:{type:pe.py.virtualevents,action:pe.uk.list},command:e})}virtualEventById(e,t){const{useMeetingExperienceForSchedulingVirtualEvents:i,virtualEventByIdLinkUrl:n}=this.coreSettings.get(b.J.VirtualEvents);return i&&(null==t?void 0:t.stateTransition)===ve.su.new?(this.host.open(null==n?void 0:n.replace("{eventId}",e)),Promise.resolve()):this.commandHandler({entity:{type:pe.py.virtualevents,action:pe.uk.view,id:e},command:t})}createVirtualEvent(e,t){const{eventType:i}=e,{useMeetingExperienceForSchedulingVirtualEvents:n,createVirtualEventsLinkUrl:o}=this.coreSettings.get(b.J.VirtualEvents);return n?(this.host.open(null==o?void 0:o.replace("{eventType}",i)),Promise.resolve()):this.commandHandler({entity:{type:pe.py.virtualevents,action:pe.uk.create},command:t,entityOptions:e})}showConfirmationDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.virtualevents,action:pe.uk.confirm},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:k.D.VirtualEventDetails}},entityOptions:e})}showShareDialog(e){return this.extensionCommanding.executeCommand({type:pe.py.virtualevents,action:pe.uk.share},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:k.D.VirtualEventDetails}},entityOptions:e})}navigateVirtualEvent(e,t,i,n,o){return this.commandHandler({entity:{type:pe.py.virtualevents,action:n||pe.uk.view,id:`${e}-${i}`},command:{visibilityState:ve.fe.show,stateTransition:ve.su.forceFlush,correlation:{source:k.D.VirtualEventDetails}},entityOptions:{selectedNavItem:i,sessionId:o,eventId:e,eventType:t}})}showFormErrorsDialog(){return this.extensionCommanding.executeCommand({type:pe.py.virtualevents,action:pe.uk.error},{entityCommand:{visibilityState:ve.fe.show,stateTransition:ve.su.extend,correlation:{source:k.D.VirtualEventDetails}}})}}class Wn{constructor(e){this.commandHandler=e}openWikiTab(e,t,i,n){const o={entity:{action:pe.uk.view,id:e,linkedEntity:n,type:pe.py.wiki},command:t,entityOptions:i};return this.commandHandler(o)}}class Bn{constructor(e){this.commandHandler=e}qnaById(e,t,i){return this.commandHandler({entity:{type:pe.py.yammerqna,action:pe.uk.view,id:e},command:t,entityOptions:i})}}class $n{constructor(e){this.commandHandler=e}launch(e){return this.commandHandler({entity:{type:pe.py.teamsgallery,action:pe.uk.view},command:e})}launchSection(e){return this.commandHandler({entity:{type:pe.py.teamsgallery,action:pe.uk.view,id:e},command:{stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.TeamsGallery}}})}launchTeamsGallery(){return this.commandHandler({entity:{type:pe.py.teamsgallery,action:pe.uk.view,id:""},command:{stateTransition:ve.su.flush,visibilityState:ve.fe.show,correlation:{source:k.D.TeamsGallery}}})}manageAppsInTeam(e,t,i){return this.commandHandler({entity:{id:e,type:pe.py.teammanageapps,action:pe.uk.view,linkedEntity:{id:e||"",type:pe.py.channels,action:pe.uk.list}},command:(null==i?void 0:i.entityCommand)||this.getDefaultEntityCommand(t),scenarioEventData:null==i?void 0:i.scenarioEventData,entityOptions:null==i?void 0:i.entityOptions})}getDefaultEntityCommand(e,t=ve.su.flush){return{stateTransition:t,visibilityState:ve.fe.show,correlation:{source:e}}}}class Hn{constructor(e){this.commandHandler=e}callList(e,t){return this.commandHandler({entity:{id:e,type:pe.py.callsmain,action:pe.uk.view},command:t})}contactList(e,t){return this.commandHandler({entity:{type:pe.py.callsmain,action:pe.uk.list},command:e,entityOptions:null==t?void 0:t.entityOptions,scenarioEventData:null==t?void 0:t.scenarioEventData})}peopleAppAsContacts(e,t){return this.commandHandler({entity:{type:pe.py.peopleapp,action:pe.uk.view},command:e,scenarioEventData:null==t?void 0:t.scenarioEventData})}}class qn{constructor(e){this.extensionCommanding=e}launchUnifiedConsent(e){this.extensionCommanding.executeCommand({type:pe.py.unifiedconsentdialog,action:pe.uk.view},{entityOptions:Object.assign({},e)})}}class zn{constructor(e){this.extensionCommanding=e}stopSharingChannelWithTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.stopsharingchannelwithteam,action:pe.uk.view},{entityOptions:null==t?void 0:t.entityOptions})}createSharedChannelInvitationDialog(e,t,i){return this.extensionCommanding.executeCommand({id:e,type:pe.py.sharedchannelcreateinvitationsdialog,action:pe.uk.view,linkedEntity:this.getChannelLinkedEntity(e)},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:t}},entityOptions:i})}acceptSharedChannelInvitationDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.acceptsharedchannelinvitationdialog,action:pe.uk.view},{entityOptions:t})}shareWithTeamYouOwnDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.sharewithteamyouowndialog,action:pe.uk.view},{entityOptions:t})}archiveChannel(e,t,i,n){return this.extensionCommanding.executeCommand({id:t,type:pe.py.archivechannel,action:pe.uk.view},{entityOptions:{teamId:e,channelId:t,channelDisplayName:i,channelType:n}})}unArchiveChannel(e,t,i){return this.extensionCommanding.executeCommand({id:t,type:pe.py.unarchivechannel,action:pe.uk.view},{entityOptions:{teamId:e,channelId:t,channelDisplayName:i}})}editTeamPicture(e,t,i,n,o,r){return this.extensionCommanding.executeCommand({id:e,type:pe.py.changeteampicture,action:pe.uk.view},{entityCommand:r,entityOptions:{teamId:e,threadId:t,teamDisplayName:i,pictureETag:n,defaultTeamInitialsPicture:o}})}showForMemberDialogV2(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.showformemberdialogv2,action:pe.uk.view},{entityOptions:t})}getChannelLinkedEntity(e){return{id:e||"",type:pe.py.channels,action:pe.uk.list}}}class Vn{constructor(e){this.extensionCommanding=e}launchTeamsErrorDialog(e,t,i,n,o){return this.extensionCommanding.executeCommand({id:e,type:pe.py.teamserrordialog,action:pe.uk.view},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:o}},entityOptions:{titleString:t,contentString:i,buttonString:n}})}getLinkToTeamOrChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.getlinktoteamorchanneldialog,action:pe.uk.view},{entityCommand:t,entityOptions:e})}denyInvitationConfirmDialog(){return this.extensionCommanding.executeCommand({type:pe.py.sharedchanneldenyinvitation,action:pe.uk.view},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.ChannelInvitations}}})}launchConfirmLeaveChannel(e,t){return this.extensionCommanding.executeCommand({type:pe.py.leavechanneldialog,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchShowHideGeneralChannelWarningDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.showhidegeneralchannelwarningdialog,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchLeaveChannelLastOwnerDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.leavechannellastownerdialog,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchRestoreChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.restorechannelreactdialog,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchDeleteChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.deletechannelreactdialog,action:pe.uk.view},{entityCommand:t,entityOptions:e})}launchStopSharingChannelWithTeamDialog(e,t){return this.extensionCommanding.executeCommand({type:pe.py.stopsharingchannelwithteamreactdialog,action:pe.uk.view},{entityCommand:t,entityOptions:e})}archiveTeamT2(e,t,i,n){return this.extensionCommanding.executeCommand({id:t,type:pe.py.archiveteam,action:pe.uk.view},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:n}},entityOptions:{teamName:i,groupId:e,threadId:t}})}deleteTeamT2(e,t,i,n){return this.extensionCommanding.executeCommand({id:t,type:pe.py.deleteteam,action:pe.uk.view},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:n}},entityOptions:{teamName:i,groupId:e,threadId:t}})}leaveTeamT2(e,t,i,n){return this.extensionCommanding.executeCommand({id:t,type:pe.py.leaveteam,action:pe.uk.view},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:n}},entityOptions:{teamName:i,groupId:e,threadId:t}})}restoreTeamT2(e,t,i,n){return this.extensionCommanding.executeCommand({id:t,type:pe.py.restoreteam,action:pe.uk.view},{entityCommand:{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:n}},entityOptions:{teamName:i,groupId:e,threadId:t}})}}class Gn{constructor(e){this.extensionCommanding=e}launchAppDevicePermissionsConsent(e,t){return this.extensionCommanding.executeCommand({id:e,type:pe.py.platformappdevicepermissions,action:pe.uk.manage},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}getDefaultExtensionCommand(){return{stateTransition:ve.su.extend,visibilityState:ve.fe.show,correlation:{source:k.D.ExtensionCommanding}}}}class Jn{constructor(e){this.commandHandler=e}launch(e){return this.commandHandler({entity:{type:pe.py.cast,action:pe.uk.view},command:e})}}class Kn{constructor(e){this.commandHandler=e}acquireExploratoryLicense(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.commandHandler({entity:{type:pe.py.exploratorylicense,action:pe.uk.create},command:{visibilityState:ve.fe.show,stateTransition:ve.su.flush,correlation:{source:e}}})}))}licenseAcquirementFailed(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.commandHandler({entity:{type:pe.py.exploratorylicense,action:pe.uk.error},command:{visibilityState:ve.fe.show,stateTransition:ve.su.flush,correlation:{source:e}},entityOptions:t})}))}}class Qn{constructor(e){this.commandHandler=e}presenterChatById(e,t,i){return this.commandHandler({entity:{type:pe.py.presenterchat,action:pe.uk.view},entityOptions:e,command:t,windowOptions:i})}}class Yn{constructor(e){this.extensionCommanding=e}vdiRestartDialogWorkflow(e,t){return this.extensionCommanding.executeCommand({type:pe.py.vdirestartworkflow,action:pe.uk.view},{entityCommand:e,entityOptions:t})}}const Xn=(e,t,i,n,o,r,s,a,l,c,d,u=f.ew,m,g,h)=>{const p=new yi(e,n,u,s,a,o,m),v=new ai(r,e,p,s,a,l,o,{userContextId:d,windowId:u},g,h);return{entityCommanding:{account:new Ui(e),activity:new Wi(e,p),authentication:new zi(e,p,v,n),autoinstallnotification:new Vi(e),biometricEnrollment:new Gi(e),brbFeedback:new Ji(e,p),breakoutRooms:new Ki(e),broadcast:new Qi(e),calendar:new Yi(p,e),call:new Xi(e,p,d),callsMain:new Hn(e),campaignNotifications:new Zi(e),cast:new Jn(e),channel:new en._C(e,p),chat:new nn(e,p,o,a),coachReport:new on(e),contacts:new sn(e,p),deepLink:v,destroy:()=>p.destroy(),discoverSurface:new ln(e,a),discoverappsnotifications:new an(e),error:new cn(e),esp:new dn(e,p),exploratory:new Kn(e),feedback:new un(e,p),file:new mn(p,e),flyout:new gn(e),freemiumUpgrade:new hn(e),guardians:new pn(p,e),homepage:new vn(e),meetingAnalytics:new Sn(e),meetingRecap:new bn(e),meetingRoom:new Cn(e),meetingOptions:new kn(e,p),nova:new ki(e),platform:new In(e,p,o),platformDevicePermissionDialogs:new Gn(p),presenterTools:new Qn(e),registration:new jn(e,o),school:new Nn(e,p),search:new En(e,p),settings:new xn(e),shareForm:new An(p),shell:new xi(e,p,c,u,r,o,a),store:new Dn(e),lobnotifications:new fn(e),lms:new yn(p),onboardingnotifications:new _n(e),teamsAndChannels:new Pn(e,p),teamsAndChannelsDialogs:new zn(p),teamsAndChannelsConfirmationDialogs:new Vn(p),teamsGallery:new $n(e),toasts:new Ri(e,d),transcript:new Ln(e),unifiedConsent:new qn(p),virtualEvents:new Un(p,e,r,o),yammerQna:new Bn(e),wiki:new Wn(e),communities:new rn(e,p),vdi:new Yn(p)},eventing:new St(i,e,t),delegatedCommanding:new It(e,t)}},Zn=new Set(["com.microsoft.teams.activity","com.microsoft.teams.calling"]);class eo{constructor(e,t,i,n,o,r,s,a){this._appsRegistry=e,this._client=t,this._commandResultChangeReportingService=i,this._coreSettings=n,this._entityCommanding=o,this._loggerFactory=r,this._scenarioFactory=s,this._userContextId=a}init(){this._changes&&this.destroy(),this._changes=this._commandResultChangeReportingService.observeChanges().pipe((0,u.h)((e=>e.userContextId===this._userContextId))).subscribe((e=>this.executeOnCommandResultAppHooks(e)))}destroy(){var e;null===(e=this._changes)||void 0===e||e.unsubscribe(),this._changes=void 0}executeOnCommandResultAppHooks({context:{entityCommand:e,error:t},type:i}){var n,o;if(!e)return;const r=e.command.correlation.scenarioName===U.RG.ActivitySwitch,s=e.entity.type,a=s&&this._appsRegistry.getApp({entityType:r?pe.py.activity:s}),l=null==a?void 0:a.onCommandResult;if(a&&Zn.has(a.manifest.id)&&l)try{l({requestContext:{client:this._client,coreSettings:this._coreSettings,entityCommanding:this._entityCommanding,error:t,loggerFactory:this._loggerFactory,scenarioFactory:this._scenarioFactory},entityCommand:e,result:i})}catch(e){null===(o=(n=this._loggerFactory.newLogger("command-result-hooks-service","core-services-entity-commanding")).errorToTelemetry)||void 0===o||o.call(n,`App ${null==a?void 0:a.manifest.name} failed to execute entity command hook 'OnAfterCommandResolved' with ""${e.name}"" error`,"entity_command_hook",{errors:`${e.name}`},!0)}}}var to=i(100836);function io(e){return function(e){const t=oo(e),i=1,n=2,o=3;if(!t)return e;if(t[o])return t[i].replace(t[n],t[o]);return t[i]}(e)}function no(e){return e.message&&(e.message=io(e.message)),e.stack&&(e.stack=function(e){if(oo(e.message))return"Sanitized due to potential PII leaks.";return e.stack}(e)),e}function oo(e){return new RegExp(/(Can't find field ((chat)\(.*\)|.*) on object)/).exec(e)}const ro=/-extension:\/\//;function so(e){return e===f.jK.TimedOut}class ao{constructor(e,t,i,n,r,s){this.host=e,this.scenarioFactory=t,this.platformService=i,this.networkStateProvider=n,this.diagnosticsService=r,this.coreSettings=s,this._onWindowError=e=>{if(function(e){return e&&("resizeobserver loop limit exceeded"===e.message.toLowerCase()||ro.test(e.filename))}(e))return!0;const{colno:t,filename:i,lineno:n,message:o}=e;let{error:r}=e;const s=!!r&&so(r.code);return r=r?no(r):new Error(io(o)),this._reportError(U.RG.GlobalWindowError,Object.assign(r,{colno:t,filename:i,lineno:n}),f.jK.UndefinedWindowError,s),!0},this._onUnhandledPromiseRejection=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{reason:t}=e,i=!!t&&so(t.code);return this._reportError(U.RG.UnhandledRejection,t,f.jK.UnhandledPromiseRejection,i)})),e.addEventListener(O.cr.UnhandledRejection,this._onUnhandledPromiseRejection),e.addEventListener(O.cr.GlobalWindowError,this._onWindowError)}dispose(){this.host.removeEventListener(O.cr.UnhandledRejection,this._onUnhandledPromiseRejection),this.host.removeEventListener(O.cr.GlobalWindowError,this._onWindowError)}set error(e){this.persistDiagnostics(),void 0!==e&&(this._error=e,this._reportError(U.RG.FatalError,e,f.jK.UndefinedGlobalError,!0))}get error(){return this._error}_reportError(e,t,i,n){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{code:r=i,context:s=""}=t||{},a=""===s?`${r}`:`${s}:${r}`,l=(0,se._S)((0,re.A)((0,se.B9)(t)));let c="";try{c=this.extractError(t)}catch(e){c="Stringifying error failed"}const d=`[${c}]`,u=null==t?void 0:t.originSlotName,m=null==t?void 0:t.originAppId;this.scenarioFactory.newScenario(e).fail({message:m||u?`${m}/${u}: ${l}`:l,errorCode:a,errors:d,showOops:n,"AppInfo.NetworkState":this.networkStateProvider.isOnline()?"Online":"Offline",errorSlotName:u,errorAppId:m});let g=Promise.resolve();if(n){const e=1e3;g=(0,W.E)(Q.ip.getInstance().flush(),e),this.persistDiagnostics()}const h=this.platformService.config.clientVersion;return g.catch((()=>this.diagnosticsService.pushDiagnosticsEvent(T.i.Warn,"Could not flush telemetry logs in time",!0))).then((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{disableSendingLogsToHost:e}=this.coreSettings.get(b.J.Diagnostics);if(!e){const e=yield this.diagnosticsService.getDiagnosticsEvents(1e3);this.host.opener.postMessage(O.rY.WindowErrored,{errorCode:a,errorDescription:l,errorMsg:c,logs:e,showOops:n,clientVersion:h})}}))))}))}extractError(e){const{scrubStackTrace:t}=this.coreSettings.get(b.J.Core),i=t?[]:[to.A4.SmtpAddress,to.A4.IPV4Address,to.A4.IPv6Address,to.A4.PhoneNumber];return(0,re.A)(JSON.stringify(e,(0,se.cm)()),i)}persistDiagnostics(){this.diagnosticsService.persistDiagnostics()}}const lo={[Z.vW.Background]:"background",[Z.vW.UserVisible]:"user-visible"};class co{constructor(e,t,i){this.host=e,this.postTaskSchedulerDiagnosticsService=i,this.postTaskMap=new Map,this.logger=t.newLogger("PostTaskScheduler","core-services-scheduling")}schedule(e,t,i,n){const o=lo[t.priority],r=new AbortController;return this.host.scheduler.postTask((()=>(this.postTaskSchedulerDiagnosticsService.markTaskDequeued(n,t.id),e())),{signal:r.signal,priority:o}).then((()=>{this.postTaskMap.delete(n)})).catch((()=>{var e,i;this.postTaskMap.delete(n),null===(i=(e=this.logger).errorToTelemetry)||void 0===i||i.call(e,`PostTaskScheduler: Job failed ${n}, ${t.id}`,"webclient_framework_foundation_core_services_scheduling")})),this.postTaskMap.set(n,{controller:r}),this.postTaskSchedulerDiagnosticsService.markTaskEnqueued(n,t.id),n}cancel(e){const{controller:t}=this.postTaskMap.get(e)||{};t&&(t.abort(),this.postTaskMap.delete(e))}destroy(){this.postTaskMap.forEach(((e,t)=>{this.cancel(t),this.postTaskMap.delete(t)}))}}var uo;!function(e){e.JobChange="job_change"}(uo||(uo={}));class mo{constructor(e,t,i,n,o,r,s,a){this._jobHandle=e,this._changes=t,this._meta=i,this._job=n,this._windowId=r,this._correlationId=s,this._executeSequentially=a,this._timing={received:0,started:0,completed:0,canceled:0},this._execution=Z.Tf.None,this._logger=o.newLogger("Scheduled Job","core-services-scheduling")}receive(){this._timing.received=Date.now(),this._execution=Z.Tf.Received,this.reportJobChange()}execute(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this._execution===Z.Tf.Canceled)return;if(this._execution!==Z.Tf.Received)throw new Error("Unable to execute a job that has not been received");let e;this._timing.started=Date.now(),this._execution=Z.Tf.Started;try{this.reportJobChange();const t=this._job();e=t instanceof Promise?t:Promise.resolve(t),this._executeSequentially&&(yield e)}catch(t){this._logger.error(`Job with ID:${this._meta.id} failed to execute or rejected with error: ${t.message?t.message:t}`),e=Promise.reject(t)}this.complete(e)}))}equals(e){return this._jobHandle===e}cancel(){return this._timing.canceled=Date.now(),this._execution=Z.Tf.Canceled,this.reportJobChange(),{meta:this._meta,job:this._job}}complete(e){const t=e=>{let t;return this._timing.completed=Date.now(),this._execution=Z.Tf.Complete,this.isError(e)&&(t={message:e.message,code:e.code,context:e.context,name:e.name}),this.reportJobChange(t),e};e.then(t).catch(t)}isError(e){return!!e&&e instanceof Error}reportJobChange(e){this._changes.report({correlationId:this._correlationId,type:uo.JobChange,context:Object.assign(Object.assign({},this.toChangeState()),{target:"job",error:e}),windowId:this._windowId})}toChangeState(){return{handle:this._jobHandle,timing:this._timing,execution:this._execution,meta:this._meta}}}var go=i(268414);class ho extends go.default{remove(e,t){const i=[];let n;return this.forEach((o=>{t(o,e)?n=o:i.push(o)})),n&&(this.clear(),i.forEach((e=>this.enqueue(e)))),n}}const po=(e,t)=>e.equals(t),vo=()=>0;class yo{constructor(e,t,i,n){this._jobExecutor=e,this._supportedPriority=t,this._changes=i,this._loggerFactory=n,this._logger=n.newLogger("GreedyJobExecutionQueue","core-services-scheduling"),this._queue=new ho(vo),this._executeSequentially=t===Z.vW.MacroSequential}clearExecutionSchedule(){this._jobExecutor.clearExecutionSchedule(),this._queue.clear()}cancel(e){const t=this._queue.remove(e,po);return t&&t.cancel()}enqueue(e,t,i,n,o){if(i.priority!==this._supportedPriority)return this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job priroty [${Z.vW[i.priority]}] not supported by this queue, this queue supports [${Z.vW[this._supportedPriority]}]`,"webclient_framework_foundation_core_services_scheduling",void 0,!0),!1;const r=new mo(e,this._changes,i,t,this._loggerFactory,n,o,this._executeSequentially);return this._queue.enqueue(r)?(r.receive(),this._jobExecutor.scheduleExecution({getJob:()=>this._queue.dequeue(),executeSequentially:this._executeSequentially}),!0):(this._logger.errorToTelemetry&&this._logger.errorToTelemetry("PriorityQueue did not enqueue the job","webclient_framework_foundation_core_services_scheduling",void 0,!0),!1)}}class fo{constructor(e,t,i){this._schedule=e,this._clearSchedule=t,this._logger=i}clearExecutionSchedule(){this._executionHandle&&this._clearSchedule(this._executionHandle)}scheduleExecution(e){this._executionHandle||(this._executionHandle=this._schedule((()=>{this._executionHandle=void 0,this.execute(e)})))}execute({getJob:e,executeSequentially:t}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let i;for(;i=e();)try{const e=i.execute();t&&(yield e)}catch(e){this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job executor caught an exception executing a job. Continuing execution of remaining jobs. Error: ${e.message?e.message:e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}}))}}class So{constructor(e,t,i,n){this._changes=e,this._loggerFactory=i,this._windowId=n,this._logger=i.newLogger("QueueScheduler","core-services-scheduling"),this._queues=new Map,this.createQueues(t)}destroy(){this._queues.forEach((e=>{e.clearExecutionSchedule()}))}schedule(e,t,i,n){const o=this._queues.get(t.priority);return o?(o.enqueue(n,e,t,this._windowId,i),n):(this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job priority [${Z.vW[t.priority]}] supplied by ${t.scheduledById} not supported by scheduling`,"webclient_framework_foundation_core_services_scheduling",void 0,!0),Z.o_)}cancel(e){let t;if(e===Z.o_)return t;const i=Array.from(this._queues.values());for(const n of i)if(t=n.cancel(e),t)break;return t}createQueues(e){this.createQueue(Z.vW.Macro,(t=>e.setTimeout(t)),(t=>e.clearTimeout(t))),this.createQueue(Z.vW.RenderBlocking,(t=>e.requestAnimationFrame(t)),(t=>e.cancelAnimationFrame(t))),this.createQueue(Z.vW.MacroSequential,(t=>e.setTimeout(t)),(t=>e.clearTimeout(t)))}createQueue(e,t,i){const n=new fo(t,i,this._logger),o=new yo(n,e,this._changes,this._loggerFactory);this._queues.set(e,o)}}var ko;!function(e){e.PostTask="PostTask",e.Queue="Queue"}(ko||(ko={}));const bo={[Z.vW.Background]:ko.PostTask,[Z.vW.Macro]:ko.Queue,[Z.vW.MacroSequential]:ko.Queue,[Z.vW.RenderBlocking]:ko.Queue,[Z.vW.UserVisible]:ko.PostTask};class wo{constructor(e,t,i,n,o){const r=new So(e,t,i,n),s=new co(t,i,o);this.activeSchedulers=new Map([[ko.PostTask,s],[ko.Queue,r]])}static get nextJobHandle(){return this._nextJobHandle===Number.MAX_SAFE_INTEGER&&(this._nextJobHandle=0),++this._nextJobHandle}destroy(){this.activeSchedulers.forEach((e=>{e.destroy()}))}schedule(e,t,i){return this.findScheduler(t.priority).schedule(e,t,i,wo.nextJobHandle)}cancel(e){for(const t of this.activeSchedulers.values()){const i=t.cancel(e);if(i)return i}}findScheduler(e){const t=this.activeSchedulers.get(bo[e]);if(!t)throw new Error("No scheduler found for priority");return t}}wo._nextJobHandle=0;const Co=(e,t,i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const[o,r]=yield Promise.all([t.getUser({correlation:i}),_o(t,i,n)]);if(r)for(const t of r)e.setContext("UserInfo.IsMRU",void 0,void 0,t.id);e.setContext("UserInfo.IsMRU",!0,void 0,o.id)})),_o=(e,t,i)=>{if(i)return Promise.resolve(i);const n=e.getCachedUsers;return n?n(t):void 0},To=(e,t,i,n,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var o,s,a;const l={id:n.id,source:n.source,scenarioName:U.RG.AuthWebUser};try{const[n,r]=yield Promise.all([null===(o=i.getCachedUsers)||void 0===o?void 0:o.call(i,l,{isAllCachedUsers:!0,isAuthenticated:!0}),null===(s=i.getCachedUsers)||void 0===s?void 0:s.call(i,l,{isPrimaryUser:!0})]);if(Co(t,i,l,n),Array.isArray(n)){for(const e of n)t.setContext("UserInfo.IsPrimary",void 0,void 0,e.id);const e=n.filter((e=>e.profile.isHomeAccount)).length;t.setCoreContext("uniqueCredentialCount",e),t.setCoreContext("mtmaAccounts",n.length)}if(Array.isArray(r)){const[i,n]=r;e?t.setContext("UserInfo.IsPrimary",!0,void 0,i.id):(t.setCoreContext("primaryUserInfoId",i.profile.oid),t.setCoreContext("primaryUserInfoTenantId",i.profile.tid))}}catch(e){null===(a=r.errorToTelemetry)||void 0===a||a.call(r,"Failed to update MRU or sync mtma context","telemetry_instrumentation_update_user_context")}})),Io={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"performWindowHistoryNavigation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"navigationDirection"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NavigationDirection"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"performWindowHistoryNavigation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"navigationDirection"},value:{kind:"Variable",name:{kind:"Name",value:"navigationDirection"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NavigationDirection"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}]}}]},jo={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"navigateToWindowHistoryIndex"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowHistoryIndex"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"navigateToWindowHistoryIndex"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"windowHistoryIndex"},value:{kind:"Variable",name:{kind:"Name",value:"windowHistoryIndex"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}]}}]},No={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesWindowHistoryNavigationPushToWindowHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pushToWindowHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}]}}]},Eo={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesWindowHistoryNavigationRemoveFromWindowHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeFromWindowHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}]}}]};class xo{constructor(e,t,i,n,r){this._client=e,this._host=t,this._coreSettings=i,this._windowId=n,this._activeWindowsService=r,this.onPopState=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t;this.navigateTo((null===(t=e.state)||void 0===t?void 0:t.windowHistoryIndex)||0)}))}init(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.hostHistoryNavigationEnabled&&this._host.addEventListener("popstate",this.onPopState)}))}destroy(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.hostHistoryNavigationEnabled&&this._host.removeEventListener("popstate",this.onPopState)}))}navigate(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.mutate(Io,{navigationDirection:e})}))}navigateTo(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.mutate(jo,{windowHistoryIndex:e})}))}isEnableDecoupleCommandingFromApollo(){return this._activeWindowsService.enableDecoupleCommandingFromApollo}canNavigateObservable(){return this._activeWindowsService.getActiveWindowObservable(this._windowId).pipe((0,u.h)((e=>(null==e?void 0:e.isMainWindow)&&(null==e?void 0:e.layoutConfig.layoutMode)===ve.lO.standard||!1)),(0,c.U)((e=>{var t,i;return{canNavigateBack:(null===(t=null==e?void 0:e.windowHistoryNavigationState)||void 0===t?void 0:t.canNavigateBack)||!1,canNavigateForward:(null===(i=null==e?void 0:e.windowHistoryNavigationState)||void 0===i?void 0:i.canNavigateForward)||!1}})))}historyNavigationObservable(){return this._activeWindowsService.getActiveWindowObservable(this._windowId).pipe((0,u.h)((e=>(null==e?void 0:e.isMainWindow)&&(null==e?void 0:e.layoutConfig.layoutMode)===ve.lO.standard||!1)),(0,c.U)((e=>{var t,i;return{backHistory:(null===(t=null==e?void 0:e.windowHistoryNavigationState)||void 0===t?void 0:t.backHistory)||[],forwardHistory:(null===(i=null==e?void 0:e.windowHistoryNavigationState)||void 0===i?void 0:i.forwardHistory)||[]}})))}pushToWindowHistory(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.mutate(No,{entity:e,entityOptions:JSON.stringify(t)})}))}removeFromWindowHistory(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.hostHistoryNavigationEnabled)return this.mutate(Eo,{entity:e})}))}get hostHistoryNavigationEnabled(){var e;return(null===(e=this._coreSettings.get(b.J.Core))||void 0===e?void 0:e.enableHostHistoryNavigation)||!1}mutate(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._client.mutate({mutation:e,variables:Object.assign(Object.assign({},t),{windowId:this._windowId}),fetchPolicy:"no-cache"})}))}}var Ao=i(383392);const Do={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeWindow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}}]},Fo={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"windowStateEvent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"windowStateEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isFocused"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ServerCorrelation"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"shouldClose"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WindowStateEvent"}}}}]}}]};class Oo{report(e){if(!this._changes||0===this._changes.observers.length)return;const t=e.changeCorrelationId||(0,xe.v4)();this.changes.next(Object.assign(Object.assign({},e),{changeCorrelationId:t}))}observeChanges(){return this.changes.asObservable()}get changes(){return this._changes||(this._changes=new mi.xQ),this._changes}}class Mo{constructor(e,t){this.parentContext=e,this.pulsarLibraryInstance=t}startSignal(e,t){return this.pulsarLibraryInstance.startSignal(e,t,this.parentContext)}}class Ro{constructor(e,t,i,n){this.logger=e,this.span=t,this.pulsarLibraryInstance=n,this.pulsarLibraryInstance.otlDependencies?this.signalContext=this.pulsarLibraryInstance.otlDependencies.trace.setSpan(i,t):this.logger.error("PulsarSignal: otlDependencies is not defined")}stop(e){this.span.setStatus(e),this.span.end()}appendEventData(e,t){this.span.setAttributes(Ro.eventDataToAttributes(e,t))}addEvent(e){this.span.addEvent(e)}getPulsarContext(){return new Mo(this.signalContext,this.pulsarLibraryInstance)}propagate(){if(!this.signalContext)return void this.logger.error("propagate: signalContext is not defined");const{W3CTraceContextPropagator:e,defaultTextMapSetter:t}=this.pulsarLibraryInstance.otlDependencies,i={};return(new e).inject(this.signalContext,i,t),i}static eventDataToAttributes(e,t){const i={};return Object.keys(t).forEach((n=>{i[`${e}.${n}`]=t[n]})),i}}var Po,Lo,Uo;!function(e){e.TEAMS_CORE="Teams.Core",e.TEAMS_RENDERING="Teams.Rendering",e.TEAMS_RESOLVER="Teams.Resolver"}(Po||(Po={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(Lo||(Lo={})),function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(Uo||(Uo={}));class Wo{constructor(e,t){this.exporter=e,this.otlDependencies=t,this._shutdownOnce=new this.otlDependencies.BindOnceFuture(this._shutdown,this)}forceFlush(){return Promise.resolve()}onStart(e){this.export(e,"onStart")}onEnd(e){this._shutdownOnce.isCalled||0!=(e.spanContext().traceFlags&Uo.SAMPLED)&&this.export(e,"onEnd")}shutdown(){return this._shutdownOnce.call()}export(e,t){const{context:i,suppressTracing:n,ExportResultCode:o,globalErrorHandler:r}=this.otlDependencies;i.with(n(i.active()),(()=>{this.exporter.export([e],(e=>{var t;e.code!==o.SUCCESS&&r(null!==(t=e.error)&&void 0!==t?t:new Error(`PulsarSpanProcessor: span export failed (status ${e})`))}),t)}))}_shutdown(){return this.exporter.shutdown()}}var Bo=i(864452);class $o{constructor(e,t){this.serviceName=e,this.config=t,this.consumerNotificationObserver=new mi.xQ,this.logger=t.loggerFactory.newLogger("PulsarLib","frameworks-pulsar"),this.sessionId=t.sessionId}initialize(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield this.importOTLDependencies(),this.initOTL()}))}shutdown(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield null===(e=this.provider)||void 0===e?void 0:e.shutdown()}))}startSignal(e,t,i){if(!this.tracer)return void this.logger.error("startSignal: tracer is not initialized");const n=i||this.otlDependencies.ROOT_CONTEXT,o=this.tracer.startSpan(e,t,n);return o.setAttribute("sessionId",this.sessionId),new Ro(this.logger,o,n,this)}startSignalFromCarrier(e,t,i){if(!t)return;if(!this.otlDependencies)return void this.logger.error("startSignalFromCarrier: OTL dependencies are not initialized");const{W3CTraceContextPropagator:n,ROOT_CONTEXT:o,defaultTextMapGetter:r}=this.otlDependencies,s=(new n).extract(o,t,r);return this.startSignal(e,i,s)}observeConsumerNotifications(){return this.consumerNotificationObserver.asObservable()}initOTL(){if(!this.otlDependencies)return void this.logger.error("initOTL: OTL dependencies are not initialized");const{WebTracerProvider:e,Resource:t,SemanticResourceAttributes:i,SimpleSpanProcessor:n,OTLPTraceExporter:o}=this.otlDependencies;this.provider=new e({resource:new t({[i.SERVICE_NAME]:this.serviceName})}),this.config.spanExporter.registerConsumerNotificationCallback((e=>{this.consumerNotificationObserver.next(e)})),this.provider.addSpanProcessor(new Wo(this.config.spanExporter,this.otlDependencies)),this.config.logToOTLCollector&&this.provider.addSpanProcessor(new n(new o({url:"http://localhost:4318/v1/traces"}))),this.tracer=this.provider.getTracer("pulsar-tracer")}importOTLDependencies(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.otlDependencies=yield(0,Bo.m)()}))}}class Ho{constructor(){this.hasShutdown=!1,this.telemetryProvider=(0,Ei.G)(),this.telemetryProvider.registerPulsarBackchannelListener(this.notify.bind(this))}export(e,t,i){this.hasShutdown||e.forEach((e=>{switch(i){case"onStart":this.telemetryProvider.sendPulsarSignal({type:"onStart",span:this.sanitizeSpan(e)});break;case"onEnd":this.telemetryProvider.sendPulsarSignal({type:"onEnd",span:this.sanitizeSpan(e)})}}))}registerConsumerNotificationCallback(e){this.consumerNotificationCallback=e}shutdown(){return this.hasShutdown=!0,Promise.resolve()}notify(e){var t;null===(t=this.consumerNotificationCallback)||void 0===t||t.call(this,e)}sanitizeSpan(e){return Object.assign(Object.assign({},e),{_spanProcessor:void 0,_clock:void 0})}}const qo=(e,t,i)=>{const{enableThemePreferenceResolution:n}=t.get(b.J.Core),{environment:o}=t.get(b.J.Metadata);if(n){const t=(0,Ao.R6)(null!=o?o:yt.s.prod);return(0,Ao.u_)(e,i,t)}return t.get(b.J.Host).theme||"default"},zo=(e,t)=>e.subscribe({query:Fo,variables:{windowId:t}}),Vo=(e,t,i,n,o,r,s)=>{const{isFocused:a,shouldClose:l,correlation:c}=e&&e.data&&e.data.windowStateEvent;let d;const u=null==c?void 0:c.id;l?(t.close(),s.log(`host.close() called through window state event with correlationId ${u}`),d=Ae.B.Close):a&&(t.isFocused()?(s.log(`host.isFocused() returns true with correlationId ${u}`),d=Ae.B.AlreadyFocused):(t.focus(),s.log(`host.focus() called through window state event with correlationId ${u}`),d=Ae.B.Focus,r.loadModule("windowcontrols").then((e=>{var t;null===(t=null==e?void 0:e.focus)||void 0===t||t.call(e,i),s.log(`HostComms focus() called through window state event with correlationId ${u}`)})))),d&&u&&(n.report({context:{target:"handle-window-state-event"},correlationId:u,type:d}),o.report({type:ft.FV.WindowStateChange,context:{target:"context-providers-handle-window-event"},correlationId:u,windowId:i}))},Go=(e,t)=>(0,c.U)((i=>((e,t,i)=>(i&&(e._cleanupFns||(e._cleanupFns=[]),e._cleanupFns.push(i)),Object.assign(Object.assign({},e),t)))(i,e(i),t))),Jo=e=>Go((t=>({regenerateEntityCommandingServices:(i,n,o,r)=>(({activeWindowsService:e,appsRegistryService:t,authenticationUser:i,client:n,clientLaunchId:o,clientPreferences:r,commandChangeReportingService:s,coreSettings:a,deeplinkService:l,experienceChangeReportingService:c,hostCommunicationService:d,i18n:u,loggerFactory:m,notificationsHandler:g,phaseStateMachine:h,platformService:p,scenarioFactory:v,shortcutExecutionService:y,userBiService:f,userContextId:S,userTrackingService:k,viewEntitiesRef:b,viewEntity:w,viewEntityName:C,windowId:_,windowLayoutService:T,windowProvider:I})=>Xn((l=>fi({experienceChangeReportingService:c,activeWindowsService:e,authenticationUser:i,appsRegistryService:t,client:n,clientLaunchId:o,commandChangeReportingService:s,coreSettings:a,entityCommandInput:l,loggerFactory:m,platformService:p,scenarioFactory:v,windowId:_,executionContext:{userContextId:S,viewEntity:w,viewEntityName:C},windowProvider:I,userBiService:f,notificationsHandler:g,clientPreferences:r,userTrackingService:k})),((i,l)=>Tt({activeWindowsService:e,appsRegistryService:t,client:n,clientPreferences:r,clientLaunchId:o,commandChangeReportingService:s,coreSettings:a,commandInput:i,commandHandler:l,loggerFactory:m,scenarioFactory:v,shortcutExecutionService:y,windowId:_,executionContext:{userContextId:S,viewEntitiesRef:b,viewEntity:w,viewEntityName:C},host:I,userBiService:f})),((e,i,l)=>Dt({appsRegistryService:t,client:n,clientLaunchId:o,clientPreferences:r,commandChangeReportingService:s,commandDelegator:l,commandHandler:i,coreSettings:a,eventInput:e,executionContext:{userContextId:S,viewEntitiesRef:b,viewEntity:w,viewEntityName:C},hostCommunicationService:d,i18n:u,loggerFactory:m,notificationsHandler:g,phaseStateMachine:h,scenarioFactory:v,shortcutExecutionService:y,userBiService:f,windowId:_})),n,a,I,v,m,l,d,S,_,T,w,o))({activeWindowsService:t.activeWindowsService,appsRegistryService:t.appsRegistryService,authenticationUser:t.authenticationUser,client:t.client,clientPreferences:t.clientPreferences,clientLaunchId:t.correlation.clientLaunchId||void 0,commandChangeReportingService:t.commandChangeReportingService,coreSettings:t.coreSettings,deeplinkService:t.deeplinkService,experienceChangeReportingService:t.experienceChangeReportingService,hostCommunicationService:t.hostCommunicationService,i18n:t.i18n,loggerFactory:t.loggerFactory,notificationsHandler:t.notificationsHandler,platformService:t.platformService,scenarioFactory:t.scenarioFactory,shortcutExecutionService:t.shortcutExecutionService,userContextId:t.authenticationUser?(0,Ee.b4)(t.authenticationUser):void 0,viewEntitiesRef:i,viewEntity:n,viewEntityName:o,cdlWorkerRegistrarService:t.cdlWorkerRegistrarService,windowId:e,windowProvider:t.windowProvider,userBiService:t.userBiService,windowLayoutService:t.activeWindowsService.getWindowLayoutService(e),userTrackingService:t.userTrackingService,phaseStateMachine:r})}))),Ko=(e,t,i,n,o,r,s,a)=>e.pipe((e=>e.pipe((e=>Go((()=>({windowProvider:e}))))(r),(e=>Go((t=>({loggerFactory:new oe(t.diagnosticsService,e)}))))(i),((e,t)=>Go((({loggerFactory:i,postTaskSchedulerDiagnosticsService:n})=>({scheduler:new wo(new Oo,t,i,e,n)})),(({scheduler:e})=>e.destroy())))(i,r),((e,t)=>Go((i=>{const n=i.windowProvider.viewportContext,o=t.type,r=i.coreSettingsContext.createContextForViewport({id:e,viewportContext:n,entityType:o}),s=r.getCoreSettings();return{coreSettingsContext:r,coreSettings:s}}),(({coreSettingsContext:e})=>e.cleanup())))(i,a),(e=>Go((()=>({scenarioFactory:e})),(({scenarioFactory:e})=>e.destroy())))(t),(e=>Go((t=>({userBiService:t.telemetryService.createUserBiService(t,e,{id:t.correlation.id,startTimestamp:+t.correlation.startTimestamp||0,source:t.correlation.source})})),(({userBiService:e})=>e.destroy())))(i),((e,t)=>Go((({experienceChangeReportingService:i,authenticationUser:n})=>({experienceChangeReportingService:Object.assign(Object.assign({},i),{report:o=>{i.report(Object.assign({windowId:e,isMainWindow:t,userContextId:n?(0,Ee.b4)(n):void 0},o))}})}))))(i,n),((e,t)=>Go((({activeWindowsService:i,appBarService:n,appsRegistryService:o,appStateService:r,appSwitcherPolicyCheckService:s,authenticationService:a,authenticationUser:l,cacheStorage:c,cdlWorkerService:d,client:u,clientPreferences:m,clientState:g,commandChangeReportingService:h,coreSettings:p,dataCleanupService:v,discover:y,experienceChangeReportingService:f,hostCommunicationService:S,localStorage:k,loggerFactory:w,notificationsHandler:C,offlineCacheManager:_,platformService:T,rebootService:I,scenarioFactory:j,user:N,userBiService:E,windowProvider:x,i18n:A,brbServiceManager:D,entityCommanding:F,pulsar:O,cdlAppStateService:M})=>{var R,P;const L=u,U={activeWindowsService:i,appBarService:n,appsRegistryService:o,appStateService:r,appSwitcherPolicyCheckService:s,authenticationService:a,authenticationUser:l,cacheStorage:c,cdlWorkerService:d,clientPreferences:m,clientState:g,commandChangeReportingService:h,coreSettings:p,dataCleanupService:v,discover:y,entityType:t,experienceChangeReportingService:f,hostCommunicationService:S,localStorage:k,loggerFactory:w,notificationsHandler:C,offlineCacheManager:_,platformService:T,pubsub:L.getServices().pubsub,rebootService:I,scenarioFactory:j,user:N,userBiService:E,windowId:e,windowProvider:x,i18n:A,brbServiceManager:D,entityCommanding:F,pulsar:O,cdlAppStateService:M},{enableViewSchema:W}=p.get(b.J.Core);return{client:L.clone(U),viewSchemaClient:W?null===(P=(R=L).cloneForViewSchema)||void 0===P?void 0:P.call(R,U):null}}),(({client:e,entityCommanding:t,viewSchemaClient:i,coreSettings:n})=>(null==i||i.destroy(),e.destroy(),n.get(b.J.Core).enableMTMA&&(null==e||e.clearCache()),t.destroy()))))(i,a.type))),(e=>e.pipe(((e,t,i)=>Go((n=>(e&&n.notificationsHandler.initializeWithWindow(t,i,n.client),{notificationsHandler:n.notificationsHandler})),(()=>{})))(o,i,r),((e,t)=>Go((i=>{var n;const{appsRegistryService:o,authenticationUser:r,client:s,commandResultChangeReportingService:a,coreSettings:l,correlation:{clientLaunchId:c},deeplinkService:d,hostCommunicationService:u,loggerFactory:m,scenarioFactory:g}=i,{delegatedCommanding:h,entityCommanding:p,eventing:v}=Xn((t=>fi({activeWindowsService:i.activeWindowsService,appsRegistryService:i.appsRegistryService,authenticationUser:i.authenticationUser,client:i.client,clientLaunchId:i.correlation.clientLaunchId||void 0,commandChangeReportingService:i.commandChangeReportingService,coreSettings:i.coreSettings,entityCommandInput:t,experienceChangeReportingService:i.experienceChangeReportingService,loggerFactory:i.loggerFactory,notificationsHandler:i.notificationsHandler,platformService:i.platformService,scenarioFactory:i.scenarioFactory,executionContext:{userContextId:i.authenticationUser?(0,Ee.b4)(i.authenticationUser):void 0},windowId:e,userBiService:i.userBiService,clientPreferences:i.clientPreferences,userTrackingService:i.userTrackingService}).then()),((n,o)=>Tt({activeWindowsService:i.activeWindowsService,appsRegistryService:i.appsRegistryService,client:i.client,clientPreferences:i.clientPreferences,commandChangeReportingService:i.commandChangeReportingService,coreSettings:i.coreSettings,commandInput:n,commandHandler:o,loggerFactory:i.loggerFactory,scenarioFactory:i.scenarioFactory,shortcutExecutionService:i.shortcutExecutionService,windowId:e,host:t,userBiService:i.userBiService})),((t,n,o)=>Dt({appsRegistryService:i.appsRegistryService,client:i.client,clientPreferences:i.clientPreferences,commandChangeReportingService:i.commandChangeReportingService,commandDelegator:o,commandHandler:n,coreSettings:i.coreSettings,eventInput:t,hostCommunicationService:i.hostCommunicationService,i18n:i.i18n,loggerFactory:i.loggerFactory,notificationsHandler:i.notificationsHandler,scenarioFactory:i.scenarioFactory,shortcutExecutionService:i.shortcutExecutionService,userBiService:i.userBiService,windowId:e})),s,l,t,g,m,d,u,r?(0,Ee.b4)(r):void 0,e,i.activeWindowsService.getWindowLayoutService(e),void 0,c||void 0);let y=i.commandResultHooksService;return y&&(null===(n=l.get(b.J.Core))||void 0===n?void 0:n.enableStandaloneCommandReportingService)&&(y=new eo(o,s,a,l,p,m,g,i.authenticationUser&&(0,Ee.b4)(i.authenticationUser)),y.init()),{entityCommanding:p,eventing:v,commandResultHooksService:y,delegatedCommanding:h}}),(({commandResultHooksService:e})=>null==e?void 0:e.destroy())))(i,r),Go((e=>({errorState:new ao(e.windowProvider,e.scenarioFactory,e.platformService,e.networkState,e.diagnosticsService,e.coreSettings)})),(({errorState:e})=>e.dispose())),(e=>Go((()=>({clientState:e}))))(s),Jo(i),(e=>Go((t=>{const i=new xo(t.client,t.windowProvider,t.coreSettings,e,t.activeWindowsService);return i.init(),{windowHistoryNavigationService:i}}),(({windowHistoryNavigationService:e})=>e.destroy())))(i),Go((e=>{const{enablePulsarTelemetry:t,logToOTLCollector:i}=e.coreSettings.get(b.J.Pulsar),n=new $o(Po.TEAMS_RENDERING,{sessionId:e.platformService.host.sessionId,spanExporter:new Ho,loggerFactory:e.loggerFactory,logToOTLCollector:!!i});return t&&n.initialize(),{pulsar:n}}),(({pulsar:e})=>e.shutdown())))),(e=>e.pipe(((e,t,i)=>Go((n=>(n.authenticationUser&&n.experienceLifecycleManager.manageWindow(e,n.authenticationUser.id,Object.assign(Object.assign({},n),{isMainWindow:t,isNotificationsWindow:i})),{})),(t=>t.authenticationUser&&t.experienceLifecycleManager.removeWindow(t.authenticationUser.id,e,"window_closed"))))(i,n,o)))),Qo=(e,t,i,n,o,r,s,a,l,d)=>{const u=l.pipe((0,pt.g)("userContextId"),(0,vt.w)((({userContextId:e,correlation:t})=>d(e||void 0).pipe((0,c.U)((e=>({context:e,correlation:t})))))),(0,pt.g)("context"),(0,g.b)((({context:e,correlation:t})=>(r||s)&&Yo(e,t))),(0,c.U)((({context:e,correlation:t})=>Object.assign(Object.assign({},e),{correlation:t}))));return Ko(u,e,t,r,a,i,n,o)},Yo=(e,t)=>{var i,n,o,r;const{coreSettings:s,cdlWorkerRegistrarService:a}=e,l=null===(i=null==s?void 0:s.get(b.J.Core))||void 0===i?void 0:i.enableMTMA,c=!!(null===(n=null==s?void 0:s.get(b.J.CdlWorker))||void 0===n?void 0:n.enableUserContextWorkerRegistration),d={id:t.id,source:t.source,scenarioName:t.scenarioName||"auth_switch_account"};e.authenticationUser&&l&&(null===(r=(o=e.authenticationService).updateMostRecentUser)||void 0===r||r.call(o,{accountId:(0,Ee.b4)(e.authenticationUser),correlation:d}).then((()=>{d.scenarioName=U.RG.AuthWebUser,Co(e.telemetryContextService,e.authenticationService,d)})).then((()=>{c&&e.authenticationUser&&a.setMainWindowWorkerByUserId((0,Ee.b4)(e.authenticationUser))})))},Xo=(e,t,i)=>{i.log(`Removing window ${e} from apollo cache`),t.client.mutate({mutation:Do,variables:{windowId:e}}).catch((e=>i.error("Error in removing window: ",e)))},Zo=(e,t,i,n,o="")=>{var r;return e.telemetryService.createScenarioFactory(e,t,{id:i.id,startTimestamp:parseInt(i.startTimestamp,10)||0,source:i.source},null!==(r=i.clientLaunchId)&&void 0!==r?r:void 0,n,o)},er=(e,t)=>e.markStep(U.RG.WindowLaunchTime,t);var tr=i(301835);const ir={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"setWindowFullscreen"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isFullscreen"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setWindowFullscreen"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"isFullscreen"},value:{kind:"Variable",name:{kind:"Name",value:"isFullscreen"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}}]};var nr=i(101027);const or=(e,t)=>e.opener.postMessage(O.Gx.Destroy,{windowId:t});function rr(e,t,i,n,r,s,a,l){return(0,o.__awaiter)(this,void 0,void 0,(function*(){er(n,U.ck.BeginWindowCreation);const o=e.windowProvider;if(t===f.ew)return o;const c=yield function(e,t,i,n){return new Promise(((o,r)=>{const s=e.setTimeout((()=>{r("New Frame did not report in 10000ms")}),1e4),a=e.self;return a.frameResolvers=a.frameResolvers||{},a.frameResolvers[t]=i=>{e.clearTimeout(s),gr(e,t),o(i)},e.opener.postMessage(O.Gx.Create,{windowId:t,correlation:i,activeEntities:n})}))}(o,t,r,l);if(!c)return o;const d=(0,tr.dP)(c,e,t,s,a),u=d.getHostedWindowContext();return Object.assign(d,{getHostedWindowContext:()=>Object.assign(Object.assign({},u),{windowId:t}),viewportContext:gt.R.iFrame}),er(n,U.ck.EndWindowCreation),pr(c,t,d.viewportContext,l),pr(d,t,d.viewportContext,l),sr(c,d,e,t,i),d.close=()=>or(o,t),d}))}const sr=(e,t,i,n,o,r)=>{ar(i,e,t);const s="onpagehide"in t?"pagehide":"unload",a=t.onFullscreen().subscribe((e=>{i.client.mutate({mutation:ir,variables:{isFullscreen:e,windowId:n}})})),l=()=>{e&&vr(e),vr(t),Xo(n,i,o),r&&r(),t.removeEventListener(s,l),a.unsubscribe()};t.addEventListener(s,l)},ar=(e,t,i)=>{var n;const o=null===(n=e.leakDetectorService)||void 0===n?void 0:n.create();null==o||o.track(nr.I.UnwrappedIFrame,t),null==o||o.track(nr.I.IFrameWrapper,i)},lr=({id:e,activeEntities:t},i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{window:n,context$:o}=yield i;return{id:e,window:n,context$:o,activeEntities:t}})),cr=(e,t,i)=>(0,a.z)(de((n=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return ur(n,e,t,i)}))),(e=>function(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{window:n,subscription:o,clientState:r}=yield t,s=null===(i=n.location.hash)||void 0===i?void 0:i.slice(1);s?or(n,s):n.close(),o&&o.unsubscribe(),r&&r.dispose(),null==e||e.cleanup(),n.destroy(0)}))}(t.leakDetectorService,e)),lr,((e,i)=>((e,t,i)=>{const n=i.loggerFactory.newLogger("IframeStateManager","core-services-activator");n.error(`Creation for window ${e.id} failed with ${t}. Removing window from cache`),i.commandChangeReportingService.report({context:{target:"iframe-state-manager",errorInfo:De.y.CreateWindowError},correlationId:e.correlation.id,type:Ae.B.Failure}),Xo(e.id,i,n)})(e,i,t)))),dr=(e,t,i,n,r,s,a,l,c,d,u)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return e&&t?Promise.resolve(((e,t,i,n,o,r,s)=>{const a=t.windowProvider,l=a.open(void 0,e,"width=600px,height=500px,toolbar=no,menubar=no,location=no");if(s){const{clientPreferences:e,coreSettings:i}=t,n=s({theme:qo(e,i,a),viewportContext:gt.R.iFrame});l.document.write(n),l.document.close()}const c=()=>{const e=new URL(a.location.href);e.searchParams.append("random",Date.now().toString()),e.hash=[a.location.pathname,n.mainEntity.type,encodeURIComponent(n.mainEntity.id)].join("/"),l.location.href=decodeURIComponent(e.href)};a.addEventListener("unload",c);let d=(0,tr.dP)(l,t,e,o,r);return d=Object.assign(d,{getHostedWindowContext:()=>({startReason:ht.zF.userInitiated,panelContext:ht.QP.secondary})}),pr(l,e,d.viewportContext,n),pr(d,e,d.viewportContext,n),sr(l,d,t,e,i,(()=>{a.removeEventListener("unload",c)})),d})(n,i,r,l,c,d,u)):rr(i,n,r,s,a,c,d,l)})),ur=(e,t,i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{id:o,correlation:r,activeEntities:s,isMainWindow:a,layoutConfig:{layoutMode:l}}=e,{coreSettings:c}=i,d=r.source===k.D.PopOutButton,{enablePopOutChats:u}=c.get(b.J.Messaging),m=new oe(i.diagnosticsService,o),g=m.newLogger("IframeStateManager","core-services-activator"),h=Object.assign(Object.assign({},i),{loggerFactory:m}),p=Zo(h,o,r,gt.R.iFrame);return mr(t,h,g,o,r,s,d,u,p,a,l,n)})),mr=(e,t,i,n,r,s,a,l,c,d,u,m)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const o=yield dr(l,a,t,n,i,c,r,s,d,u,m),g=zo(t.client,n).subscribe((e=>Vo(e,o,n,t.commandChangeReportingService,t.experienceChangeReportingService,t.hostCommunicationService,i))),h=t.clientState.getChildWindowStateProvider(o,t.loggerFactory,t.coreSettings),{mainEntity:p}=s,v=hr(o,n,d,g,h,e,c,r,p);return er(c,U.ck.WindowContextProvider),v})),gr=(e,t)=>e.opener.postMessage(O.Gx.Acquired,{windowId:t}),hr=(e,t,i,n,o,r,s,a,l)=>({window:e,subscription:n,clientState:o,context$:Ko(r(void 0).pipe((0,c.U)((e=>Object.assign(Object.assign({},e),{correlation:a})))),s,t,i,!1,e,o,l)}),pr=(e,t,i,n)=>{e.iframeLeakInfo={iframeLeakInfoStartTime:(new Date).toISOString(),iframeLeakInfoEntities:Object.keys(n).reduce(((e,t)=>{const i=n[t],o=i&&"object"==typeof i&&"type"in i?null==i?void 0:i.type:void 0;return o&&(e[t]=o),e}),{}),iframeLeakInfoViewportContext:i,iframeLeakInfoWindowId:t}},vr=e=>{e.iframeLeakInfo||(e.iframeLeakInfo={}),e.iframeLeakInfo.iframeLeakInfoEndTime=(new Date).toISOString()};var yr=i(206688),fr=i(401363);const Sr=(e,t,i)=>{e.opener.postMessage(O.rY.ShouldShowChatNotification,{shouldShowChatNotification:t,windowId:i})};var kr=i(714612),br=i(248187),wr=i(446652),Cr=i(558632),_r=i(23669),Tr=i(929778);const Ir=(e,t)=>!!(e===t||!e&&!t||e&&t&&e.id===t.id&&e.type===t.type&&e.action===t.action);function jr(e,t){var i,n;if(!t||!t.activeEntities)return!1;const o=null===(i=t.activeEntities)||void 0===i?void 0:i.mainEntity,r=null===(n=e.activeEntities)||void 0===n?void 0:n.mainEntity;return!Ir(r,o)&&!function(e,t){const i=["subNavEntity","headerEntity","startEntity","mainEntity","endEntity"];for(const n of i)if(e[n]||t[n])return Ir(e[n],t[n]);return!1}(e.activeEntities,t.activeEntities)}const Nr=e=>({isChanged:Er,execute:t=>{e.dataCleanupService.markDataForWindowAsInactive(t.id)}});function Er(e,t){return function(e){var t;return!!e.isMainWindow&&(null===(t=e.layoutConfig)||void 0===t?void 0:t.layoutMode)===ve.lO.standard}(e)&&function(e,t){var i,n;if(!t||!t.activeEntities)return!1;const o=null===(i=t.activeEntities)||void 0===i?void 0:i.mainEntity,r=null===(n=e.activeEntities)||void 0===n?void 0:n.mainEntity;return!Ir(r,o)}(e,t)}const xr=e=>({isChanged:(e,t)=>!e.isMainWindow&&!e.isNotificationsWindow&&jr(e,t),execute:(t,i)=>function(e,t,i){var n;const o=t.activeEntities.mainEntity,r=null==i?void 0:i.activeEntities.mainEntity,s=e.appsRegistryService.getApp({entityType:o.type});if(!s)throw new Error("Entity does not match to an existing app");const a=null===(n=s.getAppWindowFeatures)||void 0===n?void 0:n.call(s,{coreServices:e,host:t.window,isResize:!0,prevEntityType:null==r?void 0:r.type,entityType:null==o?void 0:o.type});if(!a)return;const{width:l,height:c,minWidth:d,minHeight:u}=a,{window:m}=t,g=e.loggerFactory.newLogger("WindowResizeCommand","core-services-activator");g.log(`From ${null==r?void 0:r.type} of height ${m.innerHeight} and width ${m.innerWidth}, to ${o.type} of height ${c} and width ${l}`),d&&u&&(m.setMinimumSize&&m.setMinimumSize(d,u),e.hostCommunicationService.loadModule("windowcontrols").then((e=>{var i;return null===(i=null==e?void 0:e.setMinimumWindowSize)||void 0===i?void 0:i.call(e,t.id,d,u)})));l&&c&&(m.setBounds&&m.setBounds({x:m.screenX,y:m.screenY,width:l,height:c}),e.hostCommunicationService.loadModule("windowcontrols").then((e=>{var i;return null===(i=null==e?void 0:e.setWindowBounds)||void 0===i?void 0:i.call(e,t.id,void 0,void 0,Math.trunc(l),Math.trunc(c))})))}(e,t,i)});const Ar=e=>({isChanged:(e,t)=>!(!e.isMainWindow||e.layoutConfig&&e.layoutConfig.layoutMode!==ve.lO.standard||e.userContextId===(null==t?void 0:t.userContextId)),execute:t=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var i;if((0,_r._)(e.coreSettings,e.platformService)&&t.userContextId){const n=yield e.hostCommunicationService.loadModule("core");null===(i=null==n?void 0:n.setUserContextIdOnWindow)||void 0===i||i.call(n,t.userContextId,t.id)}}))});var Dr=i(1831);const Fr=e=>({isChanged:(e,t)=>jr(e,t),execute:t=>{const{enableUpdateViewportOverride:i}=e.coreSettings.get(b.J.Core);if(!i)return;const n=e.windowProvider.viewportContext;e.coreSettingsContext.updateViewportOverrideProviderSettings({id:t.id,viewportContext:n,entityType:t.activeEntities.mainEntity.type})}});function Or(e,t,i,n,r,s,a,l,c){var d;let u={},m={};if(c)u=c({coreServices:e,host:t,screenState:r,windowOptions:n,entityType:i,entityOptions:l})||{};else{const o=e.appsRegistryService.getApp({entityType:i});if(!o)throw new Error("Entity does not match to an existing app");m=(null===(d=o.getAppWindowFeatures)||void 0===d?void 0:d.call(o,{coreServices:e,host:t,screenState:r,windowOptions:n,entityType:i,entityOptions:l}))||{}}const g=Object.assign(Object.assign({},u),m),{additionalFeatures:h={}}=g,p=(0,o.__rest)(g,["additionalFeatures"]),{width:v,height:y,minWidth:f,minHeight:S}=p;void 0!==v&&void 0!==f&&v<f&&(p.width=f),void 0!==y&&void 0!==S&&y<S&&(p.height=S);let k=Object.keys(p).reduce(((e,t)=>`${e}${e?",":""}${t}=${p[t]}`),"");return k=e.platformService.config.clientType===wr.Bh.Web?`${k},toolbar=no,menubar=no,location=no`:k,a=Object.keys(h).reduce(((e,t)=>h?(0,Cr.ZN)(e,t,h[t]):e),a),s.log(`windowFeatures: ${k}, url: ${a}`),{url:a,windowFeatures:k}}const Mr=(e,t)=>{switch(t){case"standard":return(0,Cr.ZN)(e,"window",ht.d.main);case"minimal":return(0,Cr.ZN)(e,"window",ht.d.flyout);case"minimode":return(0,Cr.ZN)(e,"window",ht.d.minimode);default:return e}},Rr=(e,t,i,n,o,r,s,a,l,c,d,u,m,g,h,p)=>{var v,y,f;let S="",k="about:blank";const{coreSettings:w,platformService:C}=t;"minimode"!==d&&(k=C.config.clientType!==wr.Bh.Web?(0,Cr.ZN)(k,"entityType",s.type):k);const _={url:k,windowId:i,windowFeatures:S,globalWindow:e,coreServices:t,logger:n,scenarioFactory:o,windowState:r,isMainWindow:l,isNotificationsWindow:c,layoutMode:d,userContextId$:m,templateGenerator:h};if(C.config.clientType===wr.Bh.Maglev){const{addWindowIdQsp:o}=t.coreSettings.get(b.J.Core),{enablePinchToZoomTouchpad:r}=t.coreSettings.get(b.J.Calling);o&&(k=(0,Cr.ZN)(k,"windowId",i)),r&&(k=(0,Cr.ZN)(k,"pinchzoom","true"));const h=m.value.userContextId;if((0,_r._)(w,C)&&h&&(k=(0,Cr.ZN)(k,"userContextId",h)),k=((e,t)=>t?(0,Cr.ZN)(e,"show","false"):e)(k,u),l){if("standard"===d){const{flushViewSchemaClient:e}=t.coreSettings.get(b.J.Core);e&&(null===(y=null===(v=t.client)||void 0===v?void 0:v.viewSchemaClient)||void 0===y||y.clearStore()),k=(0,Cr.ZN)(k,"customframetheme","main")}else"minimode"===d&&(({url:k,windowFeatures:S}=Or(t,e,s.type,null!=g?g:s.windowOptions,a,n,k,null)),k=(0,Cr.ZN)(k,"customframetheme","nobuttons"),null===(f=S.split(","))||void 0===f||f.forEach((e=>{k=(0,Cr.ZN)(k,e.split("=")[0],e.split("=")[1])})));return Pr(Object.assign(Object.assign({},_),{url:Mr(k,d),windowFeatures:S}))}c&&(k=(0,Cr.ZN)(k,"window",ht.d.notifications),k=(0,Cr.ZN)(k,"show","false")),k=(0,Cr.ZN)(k,"customframetheme","default")}return({url:k,windowFeatures:S}=Or(t,e,s.type,null!=g?g:s.windowOptions,a,n,k,s.options,p)),Pr(Object.assign(Object.assign({},_),{url:k,windowFeatures:S}))},Pr=({url:e,windowId:t,windowFeatures:i,globalWindow:n,coreServices:o,logger:r,scenarioFactory:s,windowState:a,isMainWindow:l,isNotificationsWindow:c,layoutMode:d,userContextId$:u,templateGenerator:m})=>{let g=n.open(e,t,i||void 0);const{enableRetryWindowOpen:h}=o.coreSettings.get(b.J.Core);if(h){const o=(e,t)=>{var i;const n=e;let o=!1;try{o=!n||!n.ResizeObserver||!n.caches}catch(e){o=!0}return null===(i=null==r?void 0:r.errorToTelemetry)||void 0===i||i.call(r,`${t}, window is ${o?"":"not"} missing APIs.`,"webclient_framework_foundation_core_services_activator",void 0,!0),o};if(o(g,"Initial window.open")&&(g=n.open(e,t,i||void 0),o(g,"Retried window.open"))){const r=1e3,s=n.setTimeout((()=>{n.clearTimeout(s);const r=n.open(e,t,i||void 0);o(r,"Delayed window.open")}),r)}}if(!g)throw new Ne.G(Ne.$.WINDOW_UNDEFINED);(0,Dr.c)(g);const p=(0,tr.dP)(g,o,t,l,d);Xr(g,t,p.viewportContext,e),Xr(p,t,p.viewportContext,e),r.log(`windowState: ${JSON.stringify(a)}`);const{minWidth:v=0,minHeight:y=0}=a;p.setMinimumSize&&p.setMinimumSize(v,y),Lr(n,p,o,m),er(s,U.ck.EndWindowCreation),Ur(g,p,o,d,s,u,t,r),Wr(o,p,g);const{enableHostHistoryNavigation:f}=o.coreSettings.get(b.J.Core);return f||c||p.history.pushState("defaultBrowserHistory",""),p},Lr=(e,t,i,n)=>{if(!n)return;if(!!t.document.getElementById("app"))return;const{clientPreferences:o,coreSettings:r,platformService:s}=i,a=s.config.clientVersion.split("/").pop(),l=Je(n({theme:qo(o,r,e),osPlatform:s.config.osPlatform,cspNonce:e.__webpack_nonce__,publicPathScript:`window.__webpack_public_path__="${s.config.publicPath}"`,containerVer:a,environment:r.get(b.J.Metadata).environment||"",viewportContext:t.viewportContext,shouldStubConsoleError:!0}));t.document.write(l),t.document.close()},Ur=(e,t,i,n,o,r,s,a)=>{const{disableMainWindowMouseListeners:l,enableActiveWindowsHistoryRecovery:c}=i.coreSettings.get(b.J.Core),{interactionToNextPaintService:d}=i,u=null==d?void 0:d.track(t),m=()=>{t.opener.postMessage(O.rY.UnhandledMouseEvent,{type:"mousemove"})},g=()=>{t.opener.postMessage(O.rY.UnhandledMouseEvent,{type:"click"})},h=e=>{if(!(e=>{var t,i;const n=e.target,o=null===(t=n.nodeName)||void 0===t?void 0:t.toLowerCase(),r=null===(i=n.type)||void 0===i?void 0:i.toLowerCase();return!(!n||!(n.isContentEditable||"textarea"===o||"input"===o&&/^(?:text|email|number|search|tel|url|password)$/i.test(r)))})(e))return e.preventDefault(),!1},p="onpagehide"in t?"pagehide":"unload",v=(e=>{const{disableContextMenu:t}=e.coreSettings.get(b.J.Core);return!!t})(i),y=t.onFullscreen().subscribe((e=>{i.client.mutate({mutation:ir,variables:{isFullscreen:e,windowId:s}})})),S=()=>{if(r.isStopped)return;const{correlation:{id:e},userContextId:n}=r.value;i.experienceChangeReportingService.report({correlationId:e,type:ft.FV.WindowOptionsChange,userContextId:n||void 0,windowId:s,context:{target:"window-state-manager",height:t.innerHeight,left:t.screenX,top:t.screenY,width:t.innerWidth}})},k=c&&i.platformService.config.clientType===wr.Bh.Maglev&&"focus"===n&&s!==f.ew,w=k&&(0,yr.R)(t,"resize").pipe((0,kr.b)(500)).subscribe(S),C=k&&r.pipe((0,kr.b)(500)).subscribe(S),_=()=>{a.log(`${p} called for window ${s}`),e&&Zr(e),Zr(t),Qr(o),Xo(s,i,a),t.document.removeEventListener("mouseenter",m),t.document.removeEventListener("click",g),v&&t.removeEventListener("contextmenu",h),t.removeEventListener(p,_),a.log(`blur/unload listeners removed for windowId: ${s}`),Yr(i,t,a,s),y.unsubscribe(),w&&w.unsubscribe(),C&&C.unsubscribe(),null==u||u()};s!==f.ew||l||(t.document.addEventListener("mouseenter",m),t.document.addEventListener("click",g)),t.addEventListener(p,_),v&&t.addEventListener("contextmenu",h)},Wr=(e,t,i)=>{var n;const o=null===(n=e.leakDetectorService)||void 0===n?void 0:n.create();null==o||o.track(nr.I.UnwrappedWindow,i),null==o||o.track(nr.I.WindowWrapper,t)},Br=(e,t,i,n)=>{return(0,a.z)((0,Tr.j)((o=>$r(o,e,t,i,n)),(e=>zr(e,t)),Vr,((e,i)=>((e,t,i)=>{let n,o;const r=i.loggerFactory.newLogger("WindowStateManager","core-services-activator");t instanceof Ne.G&&je.G.isFunction(t.toTelemetryEntry)?(n=t.code,o=t.toTelemetryEntry()):(n=De.y.CreateWindowError,o=(0,M.u4)(t)),r.error(`Creation for window ${e.id} failed with ${o}. Removing window from cache`),i.commandChangeReportingService.report({context:{target:"window-state-manager",errorInfo:n,errorMessage:o},correlationId:e.correlation.id,type:Ae.B.Failure}),Xo(e.id,i,r)})(e,i,t))),Kr([Ar(t),xr(t),Fr(t),Nr(t)]),(o=t.platformService.config.clientType===wr.Bh.Web,r=e=>Jr(e,t),e=>o?e.pipe((0,g.b)((e=>r(e)))):e));var o,r},$r=(e,t,i,n,o)=>{const{id:r,activeEntities:s,correlation:a,screenState:l,isMainWindow:c,isNotificationsWindow:d,layoutConfig:{layoutMode:u},isInitialWindowStateHidden:m,userContextId:g,windowOptions:h}=e,{mainEntity:p,endEntity:v}=s,y=new oe(i.diagnosticsService,r),f=y.newLogger("WindowStateManager","core-services-activator"),S=Object.assign(Object.assign({},i),{loggerFactory:y}),k=Zo(S,r,a,(0,tr.YR)(c,u),g||""),b=k.findScenario(U.RG.WindowLaunchTime);let w;return null==b||b.appendEventData({mainEntityType:p.type,endEntityType:null==v?void 0:v.type}),w=o?o({coreServices:i,isResize:!0,entityType:p.type,windowOptions:h})||{}:((e,t,i)=>{var n;const o=e.appsRegistryService.getApp({entityType:t.type});return(null===(n=null==o?void 0:o.getAppWindowFeatures)||void 0===n?void 0:n.call(o,{coreServices:e,isResize:!0,entityType:t.type,windowOptions:i}))||{}})(S,p,null!=h?h:p.windowOptions),Hr(t,g,S,r,p,f,k,w,a,l,c,d,u,m,h,n,o)},Hr=(e,t,i,n,o,s,a,l,c,d,u,m,g,h,p,v,y)=>{const S=new r.X({userContextId:t,correlation:c}),k=((e,t,i,n,o,r,s,a,l,c,d,u,m,g,h)=>{er(n,U.ck.BeginWindowCreation),i.log(`mainEntityId: ${r.id}, mainEntityType: ${r.type}, mainEntityAction: ${r.action}`);const p=e.windowProvider;return t===f.ew?(Ur(void 0,p,e,c,n,u,t,i),p):Rr(p,e,t,i,n,o,r,s,a,l,c,d,u,m,g,h)})(i,n,s,a,l,o,d,u,m,g,h,S,p,v,y),b=((e,t,i,n)=>zo(e.client,t).subscribe((o=>Vo(o,i,t,e.commandChangeReportingService,e.experienceChangeReportingService,e.hostCommunicationService,n))))(i,n,k,s),w=i.clientState.getChildWindowStateProvider(k,i.loggerFactory,i.coreSettings),C=qr(k,n,S,b,w,e,a,o,u&&"standard"===g,u&&"minimode"===g,m,i.loggerFactory,i.leakDetectorService);return er(a,U.ck.WindowContextProvider),i.commandChangeReportingService.report({context:{target:"window-state-manager-create-window",layoutMode:g},correlationId:c.id,type:Ae.B.WindowCreated,isMainWindow:u,userContextId:t}),C},qr=(e,t,i,n,o,r,s,a,l,c,d,u,m)=>({id:t,window:e,windowStateSubscription:n,clientState:o,leakDetectorService:m,loggerFactory:u,userContextId$:i,context$:Qo(s,t,e,o,a,l,c,d,i,r)}),zr=({clientState:e,id:t,window:i,windowStateSubscription:n,loggerFactory:o,leakDetectorService:r},s)=>{const a=o.newLogger("WindowStateManager","core-services-activator");a.log(`Destroy called on window ${t}`),t!==f.ew&&(i&&i.close(),a.log(`Window.close() called for window ${t}`),null==i||i.destroy(500)),null==n||n.unsubscribe(),null==r||r.cleanup(),e.dispose(),s.appsRegistryService.removeWindowViewState(t)},Vr=({activeEntities:e,correlation:t,id:i,isMainWindow:n,isNotificationsWindow:o,layoutConfig:r,userContextId:s},{context$:a,window:l,userContextId$:c})=>(c.next({userContextId:s,correlation:t}),{activeEntities:e,context$:a,id:i,isMainWindow:n,isNotificationsWindow:o,layoutConfig:r,userContextId:s,window:l});let Gr;const Jr=(e,t)=>{const i=t.loggerFactory.newLogger("WindowStateManager","core-services-activator"),{isChatHybridArchitectureEnabled:n}=t.coreSettings.get(b.J.Host);if(n){if(!e.find((e=>e.id===f.ew)))return}const o=t.windowProvider,r="onpagehide"in o?"pagehide":"unload";o.removeEventListener(r,Gr),Gr=()=>{i.log(`Global window unload handler called for ${e.length} windows`),e.forEach((e=>{e.id!==f.ew&&e.window.close()}))},o.addEventListener(r,Gr,{once:!0})},Kr=e=>(0,br.R)(((t,i)=>(i.forEach((i=>{const n=t.find((e=>e.id===i.id));e.forEach((e=>{e.isChanged(i,n)&&e.execute(i,n)}))})),i)),[]),Qr=e=>{e.stopScenarioIfActive(U.RG.WindowLaunchTime,{},"abandoned")},Yr=(e,t,i,n)=>{(e=>{const{enableCdlRegistration:t}=e.coreSettings.get(b.J.Core);return!!t})(e)&&(t.opener.postMessage(O.rY.CdlRegistration,{childWindowId:n,eventType:"unregister"}),i.log(`CdlRegistration: windowId: '${n}', eventType: unregister`))},Xr=(e,t,i,n)=>{const o=new URL(n);e.windowLeakInfo={windowLeakInfoStartTime:(new Date).toISOString(),windowLeakInfoEntityType:o.searchParams.get("entityType")||n,windowLeakInfoViewportContext:i,windowLeakInfoWindowId:t}},Zr=e=>{e.windowLeakInfo||(e.windowLeakInfo={}),e.windowLeakInfo.windowLeakInfoEndTime=(new Date).toISOString()};var es=i(898293);class ts extends Ce.i{constructor(){super(f.Yg.ClearStoreCartTask,["authenticationService","coreSettings","scenarioFactory","loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:i,loggerFactory:n,scenarioFactory:o}=e,r=n.newLogger("ClearStoreCartTask","core-services-tasks"),{appManifestUC:s}=i.get(b.J.Marketplace);return e=>{if("signout"===e)s&&(0,es.Dj)(s.id,t,o).catch((e=>r.log(`ClearStoreCartTask: ${e.message}`)))}}))}}var is=i(699355),ns=i(328942),os=i(846311);const rs=new Map,ss=1e3,as=/^\/|\/$/g,ls=0,cs=1,ds=2,us=3;function ms(e,t){return new URL(e,t.get(b.J.Host).deepLinkDomain||void 0)}function gs(e){return e.toLowerCase()}function hs(e){const{hash:t,search:i}=e;let n=i;if(t&&!(0,L.isEmpty)(t)){const e=t.indexOf("?");e>=0&&(n=t.substr(e+1,t.length-1))}const o=function(e){return(0,os.parse)(e||"")}(n),r=o;let s;return r.correlationId&&r.startTimestamp&&r.source&&(s={id:r.correlationId,startTimestamp:r.startTimestamp,source:r.source}),s}function ps({clientLaunchId:e,location:t}){var i;return null!==(i=null!=e?e:t&&fs(t,"clientId"))&&void 0!==i?i:(0,xe.v4)()}function vs(e,t){let i=hs(e);return i=i||Ue({id:fs(e,"deeplinkId"),scenarioName:U.RG.NavigationCommand,source:t,externalId:ys(e,"correlationId")}),i}function ys(e,t){const{hash:i}=e;if(i){const e=ws(i);if(e)try{const i=new URL(e.deepLink,void 0);return(0,os.parse)(i.search)[t]}catch(e){return}}}function fs(e,t){const{hash:i}=e;if(i){const e=ws(i);return e&&e[t]}}function Ss(e){const{action:t,id:i,type:n}=e;if(t===pe.uk.default)switch(e.type){case pe.py.default:return is.n0.default;case pe.py.flyout:return is.n0.flyout}return i?`/${n}/${i}/${t}`:`/${n}/${t}`}function ks(e){const{experienceBasePath:t,location:i,loggerFactory:n}=e,{hash:o,href:r,pathname:s}=i,a=n.newLogger(Mt,"core-services-deeplink");if(!o&&!r&&!s)return;const l=function(e,t){return!(!t||!e.pathname)&&bs(e.pathname)===bs(t)}(i,t);if(o||!l){if(o){a.log("generateDeepLinkFromLocation::hash");const{deepLink:e,crash:t,relaunch:i,source:n,userContextId:r,windowType:s,homeCloud:c}=ws(o);if(e)return{deepLink:e,homeCloud:c,crash:t,relaunch:i,relaunchSource:n,isDesktopDeeplink:!0,userContextId:r,windowType:s};if(l)return{deepLink:o.startsWith("#")?o.substring(1):o,isDesktopDeeplink:!1}}return r?(a.log("generateDeepLinkFromLocation::href"),{deepLink:r,crash:!1,relaunch:!1,relaunchSource:void 0}):void 0}}function bs(e){return e.replace(/^\/|\/$/g,"")}function ws(e){const{deepLink:t,crash:i,relaunch:n,source:o,clientId:r,deeplinkId:s,userContextId:a,window:l,homeCloud:c}=(0,os.parse)(e);return{deepLink:"string"==typeof t?t:"",crash:"true"===i,relaunch:"true"===n,source:"string"==typeof o?ns.d[o]:void 0,clientId:"string"==typeof r?r:void 0,deeplinkId:"string"==typeof s?s:void 0,userContextId:"string"==typeof a?a:void 0,windowType:"string"==typeof l?l:void 0,homeCloud:"string"==typeof c?c:void 0}}function Cs(e){if(!e||0===e.length)return;const t=rs.get(e);if(t)return t;const i=e.replace(as,"");if(0===i.length)return;const n=i.split("/");try{let t;if(n){let e=n.length-1;for(;e>=0;){const t=n[e].toLowerCase();if(pe.py[t]&&(!pe.uk[t]||e!==n.length-1))break;e--}e>=0&&(t=function(e){let t;switch(e.length){case us:t={type:gs(e[ls]),id:e[cs],action:gs(e[ds])};break;case ds:{const i=e[cs].toLowerCase();t=pe.uk[i]?{type:gs(e[ls]),action:gs(e[cs])}:{type:gs(e[ls]),id:e[cs],action:pe.uk.view};break}default:throw new Error("Invalid entity fragment format found. Valid type, id or action is required.")}return t}(n.splice(e)))}return rs.size<=ss&&t&&rs.set(e,t),t}catch(e){throw new Error(`Unable to parse path into proper command. ${e.message}`)}}var _s=i(838440);const Ts=new Set(["chats","channels"]),Is="active_windows_history",js="ActiveWindowsHistoryService:: ";class Ns{constructor(e,t,i,n,o,r,s,a,l){this._client=t,this._experienceChangeReportingService=i,this._localStorage=n,this._rebootService=o,this._scenarioFactory=r,this._userContextId=s,this._windowProvider=a,this._activeWindowsService=l,this.cleanup=e=>{switch(e){case"quit":case"restart":this.unsubscribe();break;default:this.unsubscribe(),this.clearCache()}},this.unsubscribe=()=>{var e,t;null===(e=this._activeWindowsSubscription)||void 0===e||e.unsubscribe(),null===(t=this._windowOptionsSubscription)||void 0===t||t.unsubscribe()},this._logger=e.newLogger("ActiveWindowsHistoryService","core-services-active-windows-history"),this._logger.log(`${js}constructed`)}initialize(){const e=this.cleanup;this._rebootService.registerCleanupCallback(e);const{crash:t,relaunch:i}=ws(this._windowProvider.location.hash);this._logger.log(`${js}crash: ${t} or relaunch: ${i}`),this.restoreWindows(t||i)&&this.subscribeWindows()}restoreWindows(e){if(!e)return this.clearCache(),!0;const t=this._scenarioFactory.newScenario(U.RG.ActiveWindowsHistoryRestore),i=e=>{this.cleanup();const i={reason:e};t.fail(i)};let n;if(n=this._activeWindowsService.enableDecoupleCommandingFromApollo?this._activeWindowsService.getActiveWindows():(0,_s.F$)(this._client),!n)return i("Failed to read activeWindows from Apollo."),!1;const o=this.filterWindows(n),r=this.readCache();if(!r)return i("Failed to read from localStorage."),!1;const s=r.filter((e=>!o.find((t=>t.activeEntities.mainEntity.id===e.activeEntities.mainEntity.id))));if(s.length)if(s.forEach((e=>{e.activeEntities.entityExtension=null})),this._activeWindowsService.enableDecoupleCommandingFromApollo)this._activeWindowsService.setActiveWindows(n.concat(s));else if(!(0,_s.bF)(this._client,n.concat(s)))return i("Failed to write activeWindows to Apollo."),!1;return o.length&&!this.persistCache(o.concat(s))?(i("Failed to write to localStorage."),!1):(t.stop(),!0)}persistActiveWindowsInCache(e){var t,i;const n=this.filterWindows(e);this.persistCache(n)||(this.cleanup(),null===(i=(t=this._logger).errorToTelemetry)||void 0===i||i.call(t,`Failed to write ${n.length} windows to localStorage.`,"webclient_framework_foundation_core_services_active_windows_history",void 0,!0))}subscribeWindows(){this._activeWindowsService.enableDecoupleCommandingFromApollo?this._activeWindowsSubscription=this._activeWindowsService.getActiveWindowsObservable().subscribe((e=>{this.persistActiveWindowsInCache(e)})):this._activeWindowsSubscription=(0,_s.OB)(this._client).subscribe((({errors:e,loading:t,data:i})=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var n,o;if(t)return;if(e)return void(null===(o=(n=this._logger).errorToTelemetry)||void 0===o||o.call(n,`subscribeWindows::watchActiveWindows::${(0,M.u4)(e)}`,"webclient_framework_foundation_core_services_active_windows_history",void 0,!0));const{activeWindows:r=[]}=i;this.persistActiveWindowsInCache(r)})))),this._windowOptionsSubscription=this._experienceChangeReportingService.observeChanges().subscribe((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e.type!==ft.FV.WindowOptionsChange||!e.windowId||this._userContextId&&e.userContextId!==this._userContextId)return;const t=e=>{var t,i;this.cleanup(),null===(i=(t=this._logger).errorToTelemetry)||void 0===i||i.call(t,e,"webclient_framework_foundation_core_services_active_windows_history",void 0,!0)},i=this.readCache();if(!i)return void t("subscribeWindows::windowOptions::Failed to read from localStorage.");const n=i.find((t=>t.id===e.windowId));if(!n)return;const{height:o,left:r,top:s,width:a}=e.context;n.windowOptions={__typename:"WindowOptions",height:o,left:r,top:s,width:a},this.persistCache(i)||t(`subscribeWindows::windowOptions::Failed to write ${i.length} windows to localStorage.`)}))))}filterWindows(e){return e.filter((e=>((e,t)=>"focus"===e.layoutConfig.layoutMode&&!e.isMainWindow&&(!t||t===e.userContextId)&&Ts.has(e.activeEntities.mainEntity.type))(e,this._userContextId)))}clearCache(){this._logger.log("ClearCache::ACTIVE_WINDOWS_HISTORY_STORAGE_KEY"),this._localStorage.remove(Is,"UserAndExperience")}persistCache(e){return this._logger.debug(`Persist ${e.length} windows to cache.`),this._localStorage.trySet(Is,JSON.stringify(e),"Framework","UserAndExperience")}readCache(){try{const e=JSON.parse(this._localStorage.get(Is,"UserAndExperience")||"[]");return this._logger.debug(`Read ${e.length} windows from cache.`),e}catch(e){return}}}var Es=i(466094);class xs extends Ce.i{constructor(){super(f.Yg.CreateActiveWindowsHistoryTask,["activeWindowsService","authenticationUser","client","coreSettings","experienceChangeReportingService","localStorage","loggerFactory","rebootService","scenarioFactory","windowProvider"]),this.isAuthenticatedUser=e=>(null==e?void 0:e.role)===Es.w4.Member||(null==e?void 0:e.role)===Es.w4.Guest}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,coreSettings:i}=e,n=null==i?void 0:i.get(b.J.Core);if(!(null==n?void 0:n.enableActiveWindowsHistoryRecovery)||!this.isAuthenticatedUser(t))return;const{activeWindowsService:o,client:r,experienceChangeReportingService:s,localStorage:a,loggerFactory:l,rebootService:c,scenarioFactory:d,windowProvider:u}=e,m=(0,Ee.b4)(t);e.activeWindowsHistoryService=new Ns(l,r,s,a,c,d,m,u,o)}))}}var As=i(532666);const Ds={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationIsInUse"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365Application"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isInUse"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]}]}}]},Fs={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365Apps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationsWithInUseStatus"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationConnection"}}},arguments:[]}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationsWithInUseStatus"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationConnection"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationIsInUse"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"M365Application"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationEdge"}}}}},arguments:[]}]}},...Ds.definitions]}.definitions]};function Os(e,t,i,n){e.writeFragment({id:`${i}:${t}`,fragment:Ds,data:{__typename:i,id:t,isInUse:n}})}class Ms{constructor(e,t,i,n){this._experienceChangeReportingService=e,this._userContextId=t,this._client=i,this._logger=n,this._appBarObservable=this._experienceChangeReportingService.observeChanges().pipe((0,u.h)((e=>e.userContextId===this._userContextId&&e.type===ft.yU.AppSelectionChanged&&e.context.appId!==this._currentValue)),(0,c.U)((e=>{this._previousValue=this._currentValue;const t=e;return this._currentValue=t.context.appId,this._client.viewSchemaClient?function(e,t,i){try{const t=e.readQuery({query:Fs});if(t){let n,o;for(const[,e]of(0,L.entries)(t))if(n||(n=e.edges.find((e=>e.node.isInUse))),o||(o=e.edges.find((e=>e.node.id===i))),n&&o)break;if((null==n?void 0:n.node.id)===(null==o?void 0:o.node.id))return;n&&Os(e,n.node.id,n.node.__typename,!1),o&&Os(e,o.node.id,o.node.__typename,!0)}}catch(e){t.error("Error thrown updating Nova AppBar selection.")}}(this._client.viewSchemaClient,this._logger,this._currentValue):this._logger.error("Viewclient store isn't available for updating  AppBar selection."),{previousApplicationSelection:this._previousValue,newApplicationSelection:this._currentValue}}))).pipe((0,As.B)()),this._appBarSubscription=this._appBarObservable.subscribe()}cleanup(){var e;null===(e=this._appBarSubscription)||void 0===e||e.unsubscribe()}observe(){return this._appBarObservable}current(){return this._currentValue}}class Rs extends Ce.i{constructor(){super(f.Yg.CreateAppBarServiceTask,["client","authenticationUser","experienceChangeReportingService","loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,experienceChangeReportingService:i,client:n,loggerFactory:o}=e,r=o.newLogger("AppBarService","core-services-tasks"),s=new Ms(i,(0,Ee.b4)(t),n,r);return e.appBarService=s,()=>{s.cleanup()}}))}}var Ps=i(961614);function Ls(e){switch(e){case f.eT.InCall:case f.eT.InBroadcast:case f.eT.Presenting:return _e.pk.VeryActive;case f.eT.Interactive:return _e.pk.Active;case f.eT.Inactive:return _e.pk.Inactive;case f.eT.LongInactive:return _e.pk.LongInactive;case f.eT.Disabled:return _e.pk.Unrecoverable;default:return}}var Us,Ws=i(22085);class Bs{constructor(e,t,i,n,o){this._host=t,this.timesToSendUntilIdle=2,this._logger=i.newLogger("ClientStateSender","core-services-client-state");const{appIdleTimeoutInMs:r}=n.get(b.J.Core);this.msUntilResend=r?Math.round(r/this.timesToSendUntilIdle):o,this._subscriptionToStateChange=e.pipe((0,Ws.x)()).subscribe((e=>this.handleStateChange(e))),this._logger.log("Initialized")}dispose(){this.stopRecurringSending(),this._subscriptionToStateChange.unsubscribe()}handleStateChange(e){try{e===_e.pk.Active||e===_e.pk.VeryActive?this.sendStateRecurringly(e):(this.stopRecurringSending(),this.sendState(e))}catch(t){this._logger.error(`Failed to send client state update: ClientState=${e}, Error: ${t}`)}}sendStateRecurringly(e){this._logger.log(`Starting recurring sending of client state: ${e}`);try{this.sendStateAndStartTimer(e)}catch(t){this._logger.error(`Failed to start recurring sending of client state: ClientState=${e}, Error: ${t}`)}}stopRecurringSending(){this.stopTimer(),this._logger.log("Stopped recurring client state sending")}stopTimer(){if(void 0!==this._recurringSendCountdownTimer)try{this._host.clearInterval(this._recurringSendCountdownTimer),this._recurringSendCountdownTimer=void 0}catch(e){this._logger.error(`Failed to stop sending of client state: ${e}`)}}sendStateAndStartTimer(e){this.sendState(e),this.stopTimer(),this._recurringSendCountdownTimer=this._host.setInterval((()=>this.sendState(e)),this.msUntilResend)}sendState(e){const t=function(e){switch(e){case _e.pk.Unrecoverable:return f.eT.Disabled;case _e.pk.Inactive:return f.eT.Inactive;case _e.pk.LongInactive:return f.eT.LongInactive;case _e.pk.VeryActive:return f.eT.InCall;default:return f.eT.Interactive}}(e);this._logger.log(`Sending state to main window: ${t} (ClientState=${e})`),this._host.opener.postMessage(O.rY.UpdateWindowState,{childSettings:{appState:t}})}}class $s{constructor(e,t,i,n){this._coreClientStateObservable=e,this._idleTracker=i,this._initialClientState=n,this._coreClientStateSubscription=null,this._logger=t.newLogger("ChildClientStateProvider","core-services-client-state"),this._logger.log(`Initializing clientState with state=${this._initialClientState}`),this._childClientStateBehaviorSubject=new r.X(this._initialClientState),this._coreClientStateSubscription=this._coreClientStateObservable.subscribe((e=>{e!==this.getState()&&(this._logger.log(`Client state is ${e}.`),this._childClientStateBehaviorSubject.next(e))})),this._logger.log("Initialized")}observe(){return this._childClientStateBehaviorSubject.asObservable()}getState(){return this._childClientStateBehaviorSubject.value}getChildWindowStateProvider(e,t,i){const n=this._idleTracker.createChildWindowIdleTracker(e,t,i);return new $s(this._coreClientStateObservable,t,n,this.getState())}dispose(){var e;this._idleTracker.dispose(),null===(e=this._coreClientStateSubscription)||void 0===e||e.unsubscribe(),this._childClientStateBehaviorSubject.complete()}}class Hs{constructor(e,t,i,n,o,s){this._host=e,this._idleTracker=i,this._defaultClientState=_e.pk.Active,this._initializing=!0,this._clientStateSubscription=null,this._idleTrackerStateSubscription=null,this.handleAppStateSyncMessage=e=>{var t;const i=null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.appState;void 0!==i&&(this._logger.log(`Handling pushed host appState update change to ${i}.`),this.handleMainWindowStateChange(i))},this._logger=t.newLogger("ClientStateProvider","core-services-client-state");let a=this._defaultClientState;if(void 0!==s){const e=Ls(s);void 0!==e&&(a=e)}this._logger.log(`Initializing clientState with state=${a}`),this._clientStateBehaviorSubject=new r.X(a),this._setupEventHandlers(t,n,o),this.restartIdleTimerWhenActiveState(),this._initializing=!1,this._logger.log("Initialized")}observe(){return this._clientStateBehaviorSubject.asObservable()}getState(){return this._clientStateBehaviorSubject.value}getChildWindowStateProvider(e,t,i){const n=this._idleTracker.createChildWindowIdleTracker(e,t,i);return new $s(this.observe(),t,n,this.getState())}dispose(){var e,t;this._host.opener.removeEventListener(O.rY.AppStateSyncMessage,this.handleAppStateSyncMessage),this._idleTracker.dispose(),this._stateSender&&this._stateSender.dispose(),this._clientStateBehaviorSubject.complete(),null===(e=this._clientStateSubscription)||void 0===e||e.unsubscribe(),null===(t=this._idleTrackerStateSubscription)||void 0===t||t.unsubscribe()}startVeryActive(e){this._logger.log(`startVeryActive(): Client state is set to very active by ${e}.`),this.setClientState(_e.pk.VeryActive)}stopVeryActive(e){this._logger.log(`stopVeryActive(): Client state is set to active by ${e}.`),this.setClientState(_e.pk.Active)}_setupEventHandlers(e,t,i){var n;this._clientStateSubscription=this.observe().subscribe((e=>{this._logger.log(`Client state is ${e}.`)})),this._host.opener.addEventListener(O.rY.AppStateSyncMessage,this.handleAppStateSyncMessage),this._idleTrackerStateSubscription=this._idleTracker.observe().subscribe((e=>this.handleIdleChange(e))),i&&t&&(null===(n=t.get(b.J.Core))||void 0===n?void 0:n.enableUpdateAngularOnClientStateChange)&&(this._stateSender=new Bs(this.observe(),this._host,e,t,Ps.u.MsUntilIdleDefault))}handleIdleChange(e){this._logger.log(`Handling idleness change to ${e}.`),this._clientStateBehaviorSubject.value!==_e.pk.VeryActive&&(this._initializing||this.setClientState(function(e){switch(e){case Ps.R.Inactive:return _e.pk.Inactive;case Ps.R.LongInactive:return _e.pk.LongInactive;default:return _e.pk.Active}}(e),!1))}setClientState(e,t=!0){e!==_e.pk.Active&&e!==_e.pk.VeryActive||!t||this._idleTracker.restartIdleTimer(),e===_e.pk.Inactive&&this._clientStateBehaviorSubject.value===_e.pk.LongInactive||this._clientStateBehaviorSubject.value!==e&&(this._logger.log(`Updating client state from=${this._clientStateBehaviorSubject.value} to=${e}.`),this._clientStateBehaviorSubject.next(e))}handleMainWindowStateChange(e){const t=Ls(e);t!==_e.pk.Active&&t!==_e.pk.VeryActive||this.setClientState(t)}restartIdleTimerWhenActiveState(){this.getState()!==_e.pk.Active&&this.getState()!==_e.pk.VeryActive||this._idleTracker.restartIdleTimer()}}!function(e){e.Initializing="Initializing",e.Unrecoverable="Unrecoverable",e.LongInactive="LongInactive",e.Inactive="Inactive",e.Active="Active",e.VeryActive="VeryActive"}(Us||(Us={}));class qs{constructor(e=f.eT.Interactive){this._appState$=new r.X(e);(0,F.J)().opener.addEventListener(O.rY.AppStateSyncMessage,(e=>{var t;const i=null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.appState;this.setAppState(i)}))}observe(){return this._appState$.asObservable().pipe((0,Ws.x)())}getState(){return this._appState$.value}setAppState(e){void 0!==e&&e!==this.getState()&&this._appState$.next(e)}}const zs="HostComms:: ";var Vs,Gs;!function(e){e.LoadModuleCoreFailed="LoadModuleCoreFailed",e.LoadModuleOsUtilsFailed="LoadModuleOsUtilsFailed",e.LoadModuleScenarioFailed="LoadModuleScenarioFailed",e.LoadModuleTelemetryFailed="LoadModuleTelemetryFailed",e.LoadModuleWebClientStatesFailed="LoadModuleWebClientStatesFailed",e.ExecuteCommandFailed="ExecuteCommandFailed",e.RegisterForAppStateChangedFailed="RegisterForAppStateChangedFailed",e.ReportReadyToQuitFailed="ReportReadyToQuitFailed"}(Vs||(Vs={})),function(e){e.LoadModuleCoreSuccess="LoadModuleCoreSuccess",e.ExecuteCommandSuccess="ExecuteCommandSuccess"}(Gs||(Gs={}));var Js=i(665380);class Ks{constructor(e,t,i,n,o,s){this._host=e,this._logger=t,this._hostCommunicationService=i,this._clientStateProvider=o,this._getMachineLockState=s,this._machineIdleThresholdMs=3e5,this._machineIdlePollingIntervalMs=2e4,this._disableSystemIdlePolling=void 0,this._machineIdleStateSubject=new r.X(_e.fI.Active),this.subscribeToSettingsChanges(n),this.subscribeMachineIdleToClientState()}observe(){return this._machineIdleStateSubject.asObservable()}getState(){return this._machineIdleStateSubject.getValue()}handleMachineLockStateChange(e){this.evaluateCurrentState()}dispose(){var e,t;this.stopPollingSystemIdleTime(),null===(e=this._clientStateSubscription)||void 0===e||e.unsubscribe(),this._clientStateSubscription=void 0,null===(t=this._settingsSubscription)||void 0===t||t.unsubscribe(),this._settingsSubscription=void 0}evaluateCurrentState(){return this._getMachineLockState()===_e.UV.Locked?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(_e.fI.Idle)):this._clientStateProvider.getState()===_e.pk.VeryActive||this._clientStateProvider.getState()===_e.pk.Active?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(_e.fI.Active)):this._disableSystemIdlePolling?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(_e.fI.Idle)):void this.pollSystemIdleTime()}subscribeToSettingsChanges(e){this._settingsSubscription=e.getObservable(b.J.Core,["machineIdleThresholdMs","disableSystemIdlePolling","machineIdlePollingIntervalMs"]).subscribe((({machineIdleThresholdMs:e,disableSystemIdlePolling:t,machineIdlePollingIntervalMs:i})=>{null!=e&&(this._machineIdleThresholdMs=e),null!==t&&(this._disableSystemIdlePolling=t,this._disableSystemIdlePolling&&this.stopPollingSystemIdleTime()),null!=i&&(this._machineIdlePollingIntervalMs=i)}))}checkSystemIdleTime(){if(this._checkSystemIdleTimePromise)return this._checkSystemIdleTimePromise;const{promise:e,cancel:t}=this.getSystemIdleTime(),i=e.then((e=>this.handleSystemIdleTime(e)),(()=>{})).finally((()=>{this._checkSystemIdleTimePromise=void 0}));return this._checkSystemIdleTimePromise={promise:i,cancel:()=>null==t?void 0:t()},this._checkSystemIdleTimePromise}getSystemIdleTime(){let e;this._logger.debug("getting system idle time");const t=new Promise(((t,i)=>{e=i,this._hostCommunicationService.loadModule("osutils").then((e=>{void 0===(null==e?void 0:e.getSystemIdleTime)?t(void 0):null==e||e.getSystemIdleTime().then((e=>{this._logger.debug(`system idle time=${e}sec`),t(e)}))})).catch((()=>{var e,i;null===(i=(e=this._logger).errorToTelemetry)||void 0===i||i.call(e,'Error happened while loading "osutils"',"webclient_framework_host_comms",void 0,!0),t(void 0)}))}));return{promise:t,cancel:()=>null==e?void 0:e()}}subscribeMachineIdleToClientState(){this._clientStateSubscription=this._clientStateProvider.observe().subscribe((()=>this.evaluateCurrentState()))}handleSystemIdleTime(e){if(this._getMachineLockState()===_e.UV.Locked)return void this.updateMachineIdleState(_e.fI.Idle);if(this._clientStateProvider.getState()===_e.pk.VeryActive||this._clientStateProvider.getState()===_e.pk.Active)return void this.updateMachineIdleState(_e.fI.Active);if(!e&&0!==e)return void this.updateMachineIdleState(_e.fI.Idle);1e3*e>=this._machineIdleThresholdMs?this.updateMachineIdleState(_e.fI.Idle):this.updateMachineIdleState(_e.fI.Active)}updateMachineIdleState(e){const t=this._machineIdleStateSubject.getValue();e!==t&&(this._logger.log(`Updating machine idle state from=${t} to=${e}.`),this._machineIdleStateSubject.next(e))}pollSystemIdleTime(){this._disableSystemIdlePolling?this.handleSystemIdleTime(void 0):void 0===this._pollSystemIdleTimeInterval&&(this._pollSystemIdleTimeInterval=this._host.setInterval((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.checkSystemIdleTime()}))),this._machineIdlePollingIntervalMs),this.checkSystemIdleTime())}stopPollingSystemIdleTime(){var e,t;void 0!==this._pollSystemIdleTimeInterval&&(this._host.clearInterval(this._pollSystemIdleTimeInterval),this._pollSystemIdleTimeInterval=void 0),this._checkSystemIdleTimePromise&&(null===(t=(e=this._checkSystemIdleTimePromise).cancel)||void 0===t||t.call(e),this._checkSystemIdleTimePromise=void 0)}}class Qs{constructor(e,t,i,n,o){this.handleMachineLockUpdate=e=>{var t;const i=null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.isMachineLocked;void 0!==i&&(this._logger.log(`Handling pushed machineLock update change: isMachineLocked = ${i}.`),this.updateMachineLockState(i))},this._logger=t.newLogger("HostStateProvider","core-sercices-host-state"),this._hostStateSubject=new r.X({windowState:_e.kZ.InFocus,machineLockState:_e.UV.Active,machineIdleState:_e.fI.Active,suspendedState:_e.V9.Initialized}),this.registerForStateChanges(e,i),this._machineIdleTracker=new Ks(e,this._logger,i,n,o,(()=>this.getState().machineLockState)),this._machineIdleSubscription=this._machineIdleTracker.observe().subscribe((e=>{this.updateMachineIdleState(e)}))}observe(){return this._hostStateSubject.asObservable()}getState(){return Object.assign({},this._hostStateSubject.value)}dispose(){var e;null===(e=this._machineStateChangedSubscription)||void 0===e||e.call(this),this._machineIdleSubscription.unsubscribe(),this._machineIdleTracker.dispose()}registerForStateChanges(e,t){e.opener.addEventListener(O.rY.AppStateSyncMessage,this.handleMachineLockUpdate),t.loadModule("osutils").then((e=>{var t;this._machineStateChangedSubscription=null===(t=null==e?void 0:e.registerForSessionStateChanged)||void 0===t?void 0:t.call(e,(e=>{this._logger.log(`Handling pushed machineLock update change: machine SessionStatus= ${e.status}.`),e.status===Js.$y.Suspending||e.status===Js.$y.Resumed?this.updateSuspendedState(e.status===Js.$y.Suspending):this.updateMachineLockState(e.status===Js.$y.Locked)}))})).catch((()=>{var e,t;null===(t=(e=this._logger).errorToTelemetry)||void 0===t||t.call(e,'Error happened while loading "osutils"',"webclient_framework_host_comms",void 0,!0)}))}updateMachineLockState(e){const t=e?_e.UV.Locked:_e.UV.Active,i=this.getState().machineLockState;if(t!==i){this._logger.log(`Updating machine lock state from=${i} to=${t}.`);const e=this.getState();e.machineLockState=t,this._hostStateSubject.next(e),this._machineIdleTracker.handleMachineLockStateChange(t)}}updateSuspendedState(e){const t=e?_e.V9.Suspending:_e.V9.Resumed,i=this.getState().suspendedState;if(t!==i){this._logger.log(`Updating machine suspended state from=${i} to=${t}.`);const e=this.getState();e.suspendedState=t,this._hostStateSubject.next(e)}}updateMachineIdleState(e){const t=this.getState().machineIdleState;if(e!==t){this._logger.log(`Updating machine idle state from=${t} to=${e}.`);const i=this.getState();i.machineIdleState=e,this._hostStateSubject.next(i)}}}var Ys=i(109062);class Xs{constructor(e,t,i){this.scenarioFactory=i,this.observe=()=>this.networkStateBehaviorSubject.asObservable(),this.getState=()=>this.networkStateBehaviorSubject.getValue(),this.observeIsOnline=()=>this.isOnlineObservable,this.isOnline=()=>this.convertToIsOnline(this.getState()),this.observeDetailedNetworkState=()=>this.detailedNetworkStateBehaviorSubject.asObservable(),this.convertToIsOnline=e=>e===Ys.G.Online,this.getDetailedState=()=>this.detailedNetworkStateBehaviorSubject.getValue(),this.logger=e.newLogger(t,"core-services-network-state");const n=Ys.G.Online,o=Ys.T.Unknown;this.networkStateBehaviorSubject=new r.X(n),this.isOnlineObservable=this.networkStateBehaviorSubject.asObservable().pipe((0,c.U)((e=>this.convertToIsOnline(e))),(0,Ws.x)()),this.logger.log(`Network state is initialized as ${Ys.G[n]}`),this.sendStateChangeTelemetry(n),this.detailedNetworkStateBehaviorSubject=new r.X(o)}dispose(){this.networkStateBehaviorSubject.complete(),this.detailedNetworkStateBehaviorSubject.complete(),this.previousNetworkStateChangeTime=void 0}setNetworkState(e,t){this.logger.log(`Set network state to ${Ys.G[e]}${t?` due to ${t}`:""}`),this.setDetailedNetworkState(this.convertToIsOnline(e)?Ys.T.Online:Ys.T.Offline),this.getState()!==e&&(this.networkStateBehaviorSubject.next(e),this.logger.log(`Network is ${Ys.G[e]}`),this.sendStateChangeTelemetry(e,t))}setDetailedNetworkState(e){this.getDetailedState()!==e&&this.detailedNetworkStateBehaviorSubject.next(e)}sendStateChangeTelemetry(e,t){if(!this.scenarioFactory)return;let i=-1;const n=(new Date).getTime();if(this.previousNetworkStateChangeTime&&(i=n-this.previousNetworkStateChangeTime),this.previousNetworkStateChangeTime=n,-1===i)return;const o=e===Ys.G.Online?U.RG.NetworkOnline:U.RG.NetworkOffline;this.scenarioFactory.newScenario(o).stop({offsetCurrentTimeInMs:i,reason:t})}}class Zs{constructor(e){this.logger=e,this.subscriptions=[],this.currentState=void 0}getLastState(){return this.currentState}subscribeToStateChange(e){const t=this;t.subscriptions.push(e);return()=>{const i=t.subscriptions.indexOf(e);i>=0&&t.subscriptions.splice(i,1)}}cleanUpSubscriptions(){this.subscriptions=[],this.currentState=void 0}notifyAboutStateChange(e){this.currentState=e,this.subscriptions.forEach((t=>t(e)))}doOverrideOfLastState(e){this.currentState=e}}class ea extends Zs{constructor(e,t,i){super(e),this.label=t,this.onOverrideLastState=i,this.handleNetworkStateNotification=e=>{this.logger.debug(`${this.label} received ${Ys.G[e]}`),this.getLastState()!==e&&(this.logger.log(`${this.label} network state is ${Ys.G[e]}`),this.notifyAboutStateChange(e))}}overrideLastState(e){const t=this.getLastState();this.logger.debug(`NetworkStateTracker state is overriden from ${void 0===t?"undefined":Ys.G[t]} to ${Ys.G[e]}`),this.doOverrideOfLastState(e),this.onOverrideLastState(e)}cleanUpSubscriptions(){super.cleanUpSubscriptions()}}class ta extends Zs{constructor(e,t){super(e),this.handleNetworkStateNotification=e=>{const t=e?Ys.G.Online:Ys.G.Offline;this.logger.debug("Endpoints network state is "+(e?"online":"offline")),this.getLastState()!==t&&(this.logger.log("Endpoints network state is "+(e?"online":"offline")),this.notifyAboutStateChange(t))};const i={next:this.handleNetworkStateNotification,complete:()=>{var e;return null===(e=this.subscription)||void 0===e?void 0:e.unsubscribe()}};this.subscription=t.observeIsOnline().subscribe(i)}overrideLastState(e){const t=this.getLastState();this.logger.debug(`EndpointsNetworkStateListener state is overriden from ${void 0===t?"undefined":Ys.G[t]} to ${Ys.G[e]}`),this.doOverrideOfLastState(e)}cleanUpSubscriptions(){var e;super.cleanUpSubscriptions(),this.subscription&&!this.subscription.closed&&(null===(e=this.subscription)||void 0===e||e.unsubscribe()),this.subscription=void 0}}var ia=i(974509),na=i(500254);class oa extends Zs{constructor(e){super(e),this.failed_to_fetch_subContext="rejectHttpError",this.processResponse=e=>{e.status===ia.qb.NETWORK_AUTHENTICATION_REQUIRED?this.handleNetworkStateNotification(Ys.G.Offline):void 0!==e.status&&e.status!==ia.qb.NOT_MODIFIED&&e.status!==ia.qb.GATEWAY_TIMEOUT&&this.handleNetworkStateNotification(Ys.G.Online)},this.processResponseError=e=>{e&&(e.serverResponse?this.handleNetworkStateNotification(Ys.G.Online):e.context===f.w5.RejectHttpError&&e.code===f.jK.RemoteOperationFailed&&e.subContext===this.failed_to_fetch_subContext?this.handleNetworkStateNotification(Ys.G.Offline):this.logger.log(`Not network related error: ${e.message||e}`))},this.handleNetworkStateNotification=e=>{this.logger.debug(`Send network state is ${Ys.G[e]}`),this.getLastState()!==e&&(this.logger.log(`Send network state listener is ${Ys.G[e]}`),this.notifyAboutStateChange(e))},this.unsubscribeFromSendTracking=(0,na.z)(this.processResponse,this.processResponseError)}overrideLastState(e){const t=this.getLastState();this.logger.debug(`Send state listener's state is overriden from ${void 0===t?"undefined":Ys.G[t]} to ${Ys.G[e]}`),this.doOverrideOfLastState(e)}cleanUpSubscriptions(){super.cleanUpSubscriptions(),this.unsubscribeFromSendTracking&&this.unsubscribeFromSendTracking(),this.unsubscribeFromSendTracking=void 0}}var ra=i(8122);const sa=(e,t)=>Promise.resolve({apiName:t,constructRequest:(i,n)=>{const o=e();return o.searchParams.set("cb",Date.now().toString()),{apiName:t,url:o.href,method:"HEAD",timeout:1e4,headers:{"cache-control":"no-store"},cancellationToken:i.token,correlationId:n}},transformResponse:e=>e.status===ia.qb.GATEWAY_TIMEOUT?Promise.reject("GATEWAY_TIMEOUT"):e.status===ia.qb.NETWORK_AUTHENTICATION_REQUIRED?Promise.reject("NETWORK_AUTHENTICATION_REQUIRED"):Promise.resolve()}),aa=e=>{const{coreSettings:t,platformService:i}=e;return{serviceName:ra.E.NetworkPing,models:{getNetworkStatus:sa((()=>new URL(t.get(b.J.Core).networkPingUrl||"/diagnostics/network",i.config.currentUrl)),"networkPing"),getNetworkStatusFallback:sa((()=>new URL(t.get(b.J.Core).networkPingFallbackPingUrl||"/evergreen-assets/icons/1x1-000000ff.png",i.config.staticsPath)),"networkFallbackPing")}}};var la=i(223005),ca=i(145279);function da(e,t,i,n=la.A.TimedOut){let o;const r=new Promise((e=>{o=t.setTimeout(e,i)}));return Promise.race([e,r.then((()=>{throw(0,ca.T)(n)}))]).then((e=>(t.clearTimeout(o),e)))}function ua(e,t){return new Promise(((i,n)=>{if(e<0)n((0,ca.T)(la.A.InvalidParameters));else{let n=0;n=t.setTimeout((()=>{t.clearTimeout(n),i()}),e)}}))}const ma=[5e3,1e4,3e4],ga="cancelled_ping";class ha{constructor(e,t,i,n,r){this.coreSettings=e,this.endpointsManager=t,this.scenarioFactory=i,this.host=n,this.ping=e=>{const t=this.coreSettings.get(b.J.Core).networkPingDisableFallback||!1,i=this.scenarioFactory.newScenario(U.RG.NetworkPing);i.appendEventData({correlationId:e});let n=this.endpointsManager.createCancelToken(),o=!1;const r=()=>o;return{promise:this.pingEndpoint("initial ping",(()=>this.endpoints.getNetworkStatus(n,e)),i,!t,r).then((o=>o||t?Promise.resolve(o):(n=this.endpointsManager.createCancelToken(),this.pingEndpoint("fallback ping",(()=>this.endpoints.getNetworkStatusFallback(n,e)),i,!1,r)))),cancel:()=>(n.cancel(),void(o=!0))}},this.pingEndpoint=(e,t,i,n,r)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){i.appendEventData({operation:e});try{return yield t(),r()?this.markPingScenarioCancelled(e,i):this.markPingScenarioSuccess(e,i)}catch(t){return r()?this.markPingScenarioCancelled(e,i):(null==t?void 0:t.serverResponse)?this.markPingScenarioSuccess(e,i):((null==t?void 0:t.reason)===la.A.TimedOut?this.logger.log(`${e} timed out`):this.logger.log(`${e} failed`),!n&&this.markPingScenarioFailed(e,t,i))}})),this.getRetryIntervals=()=>{const e=this.coreSettings.get(b.J.Core).networkPingRetryIntervals||ma;return Object.assign([],e)},this.updatePingResult=e=>{this.latestPingResult={isOnline:e,timestamp:Date.now()}},this.logger=r.newLogger("NetworkPingService","core-services-network-state"),this.endpoints=t.createApi(aa),this.logger.log("Initialized")}detectCurrentNetworkStatus(e){const t=this.coreSettings.get(b.J.Core).networkPingDebounceDelay||3e4;return!(this.coreSettings.get(b.J.Core).networkPingDisableDebounce||!1)&&this.latestPingResult&&this.latestPingResult.isOnline&&this.latestPingResult.timestamp&&Date.now()-this.latestPingResult.timestamp<t?(this.logger.log(`Skipping network detection as last online check succeeded less than ${t}ms ago.`),{promise:Promise.resolve(!0),cancel:()=>{}}):(this.logger.log("doing network ping"),this.ping(e))}whenNetworkOnline(e){if(this.whenNetworkOnlinePromise)return this.whenNetworkOnlinePromise;const t=this.getRetryIntervals();let i=!1;const n=()=>{this.whenNetworkOnlinePromise=void 0,i=!0};let r;const s=new Promise(((s,a)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){let o;r=()=>{null==o||o(),n(),a(ga)};let l=t[0];for(let n=0;!i;n++){const{promise:r,cancel:s}=this.ping(e);o=()=>{null==s||s(),o=()=>{}};try{const e=yield r;if(o=()=>{},e||i)break;n<t.length&&(l=t[n]),yield ua(l,this.host)}catch(e){this.logger.log("whenNetworkOnline ping rejected")}}n(),s()}))));return this.whenNetworkOnlinePromise={promise:s,cancel:()=>null==r?void 0:r()},this.whenNetworkOnlinePromise}markPingScenarioSuccess(e,t){return t.stop({message:`${e} successful!`},"success"),this.logger.log(`${e} successful!`),this.updatePingResult(!0),!0}markPingScenarioFailed(e,t,i){var n;const o=(null==t?void 0:t.reason)?t.reason:"undefined",r=null===(n=null==t?void 0:t.serverResponse)||void 0===n?void 0:n.status;return i.fail({errors:`${e} failed. error reason: ${o}. Response status: ${r}`}),this.updatePingResult(!1),!1}markPingScenarioCancelled(e,t){return t.stop({message:`${e} cancelled`},"abandoned"),this.logger.log(`${e} cancelled`),this.updatePingResult(!0),Promise.reject(ga)}}class pa extends Xs{constructor(e,t,i,n,o,r,s,a){var l,c;super(e,"NetworkStateProvider",i),this.loggerFactory=e,this.coreSettings=t,this.host=n,this.clientStateProvider=o,this._defaultNetworkOnlineDetectionTimeoutInMs=15e3,this.coreContextID="",this._contextListeners=new Map,this._skipNetworkDetectionDelay=!0,this.authStateSubscriptions=[],this.createNetworkStateTracker=(e,t,i)=>{const n=new ea(this.logger,t,i),o={next:n.handleNetworkStateNotification,dispose:n.cleanUpSubscriptions};return this._addToContextListeners(e,n),n.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`${t} network state is ${Ys.G[e]}`))),o},this._handleNetworkStateUpdate=(e,t)=>{if(this.logger.debug(`Update network to ${Ys.G[e]} due to ${t}`),e===Ys.G.Offline){if(this.getState()===Ys.G.Offline)return;this._suspectOffline()}else this._cancelNetworkOnlineDetection(t),this.getState()!==e?this.setNetworkState(e,t):(this.setDetailedNetworkState(Ys.T.Online),this._updateAllListenersTo(Ys.G.Online));this._skipNetworkDetectionDelay&&(this._skipNetworkDetectionDelay=!1)},this._handleWindowOnline=()=>{this.logger.log("browser network online"),this.isOnline()||(this._updateAllListenersTo(Ys.G.Offline),this._kickOffNetworkOnlineDetection(Ys.G.Online))},this._handleWindowOffline=()=>{if(this.logger.log("browser network offline"),this.coreSettings.get(b.J.Core).disableWindowEventsNetworkDetectionV2){if(this.getState()===Ys.G.Offline)return;this.setNetworkState(Ys.G.Offline,"browser offline"),this._updateAllListenersTo(Ys.G.Offline),this._kickOffNetworkOnlineDetection(Ys.G.Offline)}else this._suspectOffline()};try{this._networkPingService=new ha(this.coreSettings,r,i,this.host,this.loggerFactory)}catch(e){null===(c=(l=this.logger).errorNoPii)||void 0===c||c.call(l,"NetworkPingService initialization has failed")}this._subscribeToSendNetworkState(),this.subscribeToEndpointsNetworkStateTracking(this.coreContextID,r.networkState),this._subscribeToWindowNetworkEvents(),this._subscribeToSuspendedStateResumeEvent(s),this.subscribeAuthStateEvent(a)}dispose(){var e;super.dispose(),this._cancelNetworkOnlineDetection("dispose"),this.disposeAllContexts(),this._unsubscribeFromWindowNetworkEvents(),null===(e=this.suspendedStateSubscription)||void 0===e||e.unsubscribe(),this.suspendedStateSubscription=void 0,this.authStateSubscriptions.forEach((e=>e.unsubscribe())),this.authStateSubscriptions=[]}disposeContext(e){const t=this._contextListeners.get(e);t&&(t.forEach((e=>{e.cleanUpSubscriptions()})),this._contextListeners.delete(e))}subscribeToEndpointsNetworkStateTracking(e,t){const i=new ta(this.logger,t);return this._addToContextListeners(e,i),i.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`Endpoints network state is ${Ys.G[e]}`)))}subscribeAuthStateEvent(e){if(this.coreSettings.get(b.J.Core).disableNetworkDetectionOnResume)return;const t=null==e?void 0:e.observe();t&&this.authStateSubscriptions.push(t.subscribe((e=>{var t;switch(null===(t=e.customError)||void 0===t?void 0:t.errorCode){case"NoNetwork":case"NetworkOffline":case"NetworkTemporarilyUnavailable":this._skipNetworkDetectionDelay=!0,this._handleNetworkStateUpdate(Ys.G.Offline,"auth state network related error")}})))}setNetworkState(e,t){super.setNetworkState(e,t),this._updateAllListenersTo(e)}_subscribeToSendNetworkState(){const e=new oa(this.logger);this._addToContextListeners(this.coreContextID,e),e.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`Send network state is ${Ys.G[e]}`)))}_subscribeToWindowNetworkEvents(){this.host.addEventListener("online",this._handleWindowOnline),this.host.addEventListener("offline",this._handleWindowOffline),this.host.navigator&&(this.host.navigator.onLine?this._handleWindowOnline():this._handleWindowOffline())}_unsubscribeFromWindowNetworkEvents(){this.host.removeEventListener("online",this._handleWindowOnline),this.host.removeEventListener("offline",this._handleWindowOffline)}_subscribeToSuspendedStateResumeEvent(e){if(!e||this.coreSettings.get(b.J.Core).disableNetworkDetectionOnResume)return;const t=null==e?void 0:e.observe().pipe((0,c.U)((e=>e.suspendedState)),(0,Ws.x)());this.suspendedStateSubscription=null==t?void 0:t.subscribe((e=>{e===_e.V9.Resumed&&(this._skipNetworkDetectionDelay=!0,this._handleNetworkStateUpdate(Ys.G.Offline,"resumed from suspended"))}))}_updateAllListenersTo(e){this._contextListeners.forEach((t=>t.forEach((t=>{var i;return null===(i=t.overrideLastState)||void 0===i?void 0:i.call(t,e)}))))}_addToContextListeners(e,t){var i;this._contextListeners.has(e)?null===(i=this._contextListeners.get(e))||void 0===i||i.push(t):this._contextListeners.set(e,[t])}_suspectOffline(){const{enableSkipNetworkDetectionTimeoutOnOfflineStart:e,useVeryActiveForNetworkOnlineDetection:t,enableNetworkOnlineDetectionTimeout:i,networkOnlineDetectionTimeoutInMs:n}=this.coreSettings.get(b.J.Core);if(t&&this.clientStateProvider.getState()===_e.pk.VeryActive)return this.logger.log("Network detection cancelled due to VeryActive client state."),this._updateAllListenersTo(Ys.G.Online),void this.setDetailedNetworkState(Ys.T.Online);const o=this._skipNetworkDetectionDelay&&!!e;if(!(this._networkDetectionTimeout&&!o||this._detectCurrentNetworkStatusPromise||this._networkPing))if(this._updateAllListenersTo(Ys.G.Offline),this.setDetailedNetworkState(Ys.T.SuspectedOffline),i&&!o){const e=n||this._defaultNetworkOnlineDetectionTimeoutInMs;void 0!==this._networkDetectionTimeout||this._detectCurrentNetworkStatusPromise||(this.logger.log(`Starting ${e}ms timeout before kicking off network online detection.`),this._networkDetectionTimeout=this.host.setTimeout((()=>{this._networkDetectionTimeout=void 0,this.logger.log("Timeout expired."),this._kickOffNetworkOnlineDetection(Ys.G.Offline)}),e))}else this._kickOffNetworkOnlineDetection(Ys.G.Offline)}_kickOffNetworkOnlineDetection(e){if(!this._networkPingService||!this._canPerformPing())return void(this.getState()!==e&&this.setNetworkState(e));if(this._detectCurrentNetworkStatusPromise||this._networkPing)return;this.logger.log("Kicking off network status detection.");const t=(0,xe.v4)(),i=this._networkPingService;this._detectCurrentNetworkStatusPromise=i.detectCurrentNetworkStatus(t),this._detectCurrentNetworkStatusPromise.promise.then((e=>{void 0!==this._detectCurrentNetworkStatusPromise?(this._detectCurrentNetworkStatusPromise=void 0,e?(this.logger.log("Network status verified as online."),this.setNetworkState(Ys.G.Online,"http online")):(this.setNetworkState(Ys.G.Offline,"http offline"),this._startNetworkPing(i,t))):this.logger.log("Network detection cancelled, ignoring result.")})).catch((e=>{e===ga?this.logger.log("Network detection is cancelled"):this.logger.warn(`Network status verification error: ${e}`),this._detectCurrentNetworkStatusPromise=void 0}))}_canPerformPing(){const{enablePingService:e}=this.coreSettings.get(b.J.Core);return!!e||(this.logger.warn("Network detection is disabled."),!1)}_startNetworkPing(e,t){this.logger.log("Started recurring network ping."),this._networkPing=e.whenNetworkOnline(t),this._networkPing.promise.then((()=>{this._networkPing?(this._networkPing=void 0,this.getState()!==Ys.G.Online&&this.setNetworkState(Ys.G.Online,"Network ping succeded")):this.logger.log("Network ping cancelled, ignoring result.")})).catch((e=>{this.logger.log(`network detection by ping terminated due to ${(null==e?void 0:e.message)?e.message:e}`)}))}_cancelNetworkPing(e){var t,i;this._networkPing&&(this.logger.log(`Cancelling network ping due to ${e}`),null===(i=(t=this._networkPing).cancel)||void 0===i||i.call(t),this._networkPing=void 0)}_cancelNetworkOnlineDetection(e){var t,i;void 0!==this._networkDetectionTimeout&&(this.logger.log(`Cancelling network detection timeout due to ${e}`),this.host.clearTimeout(this._networkDetectionTimeout),this._networkDetectionTimeout=void 0),this._detectCurrentNetworkStatusPromise&&(this.logger.log(`Cancelling network detection due to ${e}`),null===(i=(t=this._detectCurrentNetworkStatusPromise).cancel)||void 0===i||i.call(t),this._detectCurrentNetworkStatusPromise=void 0),this._cancelNetworkPing(e)}disposeAllContexts(){this._contextListeners.forEach((e=>{e.forEach((e=>{e.cleanUpSubscriptions()}))})),this._contextListeners.clear()}}class va extends Zs{constructor(e,t){super(e),this.handleLegacyApplicationStateChange=e=>{const t=this.isOnlineAndConnectedInternal(e);this.logger.log(`LegacyApplicationState changed to ${f.eT[e]}`),this.notifyAboutStateChange(t)},this.isOnlineAndConnectedInternal=e=>{switch(e){case f.eT.Disabled:case f.eT.Offline:return Ys.G.Offline;default:return Ys.G.Online}},this.legacyApplicationStateSubscription=t.observe().pipe((0,Ws.x)()).subscribe(this.handleLegacyApplicationStateChange)}cleanUpSubscriptions(){super.cleanUpSubscriptions(),this.legacyApplicationStateSubscription&&(this.legacyApplicationStateSubscription.unsubscribe(),this.legacyApplicationStateSubscription=void 0)}}class ya extends Xs{constructor(e,t,i,n,r,s){super(t,"LegacyNetworkStateProvider",i),this.hostCommunicationService=s,this._legacyAppStateListener=void 0,this._suspectedStateListeners=[],this._handleNetworkListenerUpdate=(e,t)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){e!==this.getState()?(this.logger.debug(`Network suspected ${Ys.G[e]}${t?" due to ":""}${t}`),yield this._sendSuspectedNetworkStateThrottled(this._convertToIsOnline(e))):void 0!==this._suspectedIsOnline&&this.convertToIsOnline(e)!==this._suspectedIsOnline&&this._resetSuspectedState()})),this._sendSuspectedNetworkState=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log(`Sending network state to main window: ${e}`);const t=yield this.hostCommunicationService.loadModule("core");(null==t?void 0:t.notifyCoreStateChanged)?t.notifyCoreStateChanged({isNetworkOnline:e}):this.logger.warn("notifyCoreStateChanged is missing in HostComms")})),this._initSuspectedThrottleFunc=()=>{this._throttledSuspectedIsOnline=(0,L.throttle)(this._sendSuspectedNetworkState,2e3)},this._convertToIsOnline=e=>e!==Ys.G.Offline,this._updateSuspectedStateListenersTo=e=>this._suspectedStateListeners.forEach((t=>{var i;return null===(i=t.overrideLastState)||void 0===i?void 0:i.call(t,e)})),this._subscribeToLegacyAppStateTracking(e),this._subscribeToSuspectedNetworkState(r,n)}dispose(){var e;super.dispose(),null===(e=this._legacyAppStateListener)||void 0===e||e.cleanUpSubscriptions(),this._legacyAppStateListener=void 0,this._suspectedStateListeners.forEach((e=>e.cleanUpSubscriptions())),this._suspectedStateListeners=[],this._clearSuspectedState(),this._throttledSuspectedIsOnline=void 0}_subscribeToLegacyAppStateTracking(e){this._legacyAppStateListener=new va(this.logger,e);const t=this;this._legacyAppStateListener.subscribeToStateChange((e=>t._updateNetworkState(e,`LegacyApplicationState changed to ${Ys.G[e]}`)));const i=this._legacyAppStateListener.getLastState();void 0!==i&&this._updateNetworkState(i,"initial LegacyApplicationState")}_subscribeToSuspectedNetworkState(e,t){const{enableNetworkTrackingForLegacyNetworkState:i}=t.get(b.J.Core);i&&(this._initSuspectedThrottleFunc(),this._subscribeToSendNetworkState(),this._subscribeToEndpointsNetworkStateTracking(e.networkState))}_subscribeToSendNetworkState(){const e=new oa(this.logger);this._suspectedStateListeners.push(e),e.subscribeToStateChange((e=>this._handleNetworkListenerUpdate(e,`Send network state is ${Ys.G[e]}`)))}_subscribeToEndpointsNetworkStateTracking(e){const t=new ta(this.logger,e);this._suspectedStateListeners.push(t),t.subscribeToStateChange((e=>this._handleNetworkListenerUpdate(e,`Endpoints network state is ${Ys.G[e]}`)))}_updateNetworkState(e,t){this.logger.log(`Update network to ${Ys.G[e]}${t?" due to ":""}${t}`),this.getState()!==e&&(this.setNetworkState(e),this._resetSuspectedState())}_sendSuspectedNetworkStateThrottled(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e!==this._suspectedIsOnline?(this._resetSuspectedState(),this._suspectedIsOnline=e):this._updateSuspectedStateListenersTo(this.getState()),this._throttledSuspectedIsOnline&&(yield this._throttledSuspectedIsOnline(e))}))}_clearSuspectedState(){var e;void 0!==this._suspectedIsOnline&&(this._suspectedIsOnline=void 0),null===(e=this._throttledSuspectedIsOnline)||void 0===e||e.cancel(),this._updateSuspectedStateListenersTo(this.getState())}_resetSuspectedState(){this._clearSuspectedState(),this._initSuspectedThrottleFunc()}}class fa extends Ce.i{constructor(){super(f.Yg.CreateAppState,[]),this.clientStateStorageKey="tmp.clientState",this._updateTelemetryOnClientStateChange=(e,t)=>{e.observe().subscribe((e=>{t.setCoreContext("AppInfo.ClientState",e)}))},this._updateTelemetryOnNetworkStateChange=(e,t)=>{e.observeIsOnline().subscribe((e=>{const i=e?"Online":"Offline";t.setCoreContext("AppInfo.NetworkState",i)}));e.observeDetailedNetworkState().subscribe((e=>{t.setCoreContext("AppInfo.DetailedNetworkState",e)}))},this._updateTelemetryOnHostStateChange=(e,t)=>{e.observe().pipe((0,c.U)((e=>e.suspendedState)),(0,Ws.x)()).subscribe((e=>{t.setCoreContext("AppInfo.Suspended",e)}));e.observe().pipe((0,c.U)((e=>e.machineLockState)),(0,Ws.x)()).subscribe((e=>{t.setCoreContext("AppInfo.MachineLock",e)}))},this._updateHostOnClientStateChange=(e,t,i)=>{const n=i.newLogger("updateHostOnClientStateChange","core-services-tasks");e.observe().subscribe((e=>t.loadModule("webclientstates").then((t=>{if(t&&t.notifyWebClientStateChange){const i=Us[e];t.notifyWebClientStateChange(i),n.log(`messaged host new ClientState (${e}). WebClientState sent: ${i}`)}else n.warn(`${Vs.LoadModuleWebClientStatesFailed} or webclientstates.notifyWebClientStateChange is not loaded`)})).catch((e=>{n.errorToTelemetry&&n.errorToTelemetry(`Error happened: ${e.message||e}`,"webclient_framework_host_comms",void 0,!0)}))))},this._trackClientStateForGlassjar=(e,t)=>{e.observe().subscribe((e=>t.localStorage.setItem(this.clientStateStorageKey,e)))}}execute(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:i,hostCommunicationService:n,hostSettings:o,loggerFactory:r,platformService:s,scenarioFactory:a,telemetryService:l,windowProvider:c}=e,d=null===(t=null==o?void 0:o.hostSettings)||void 0===t?void 0:t.appState,u=void 0!==d?d:f.eT.Inactive;e.appStateService=new qs(u);const m=new Ps.u(c,r,i);e.clientState=new Hs(c,r,m,i,!0,d);const g=new Qs(c,r,n,i,e.clientState);e.hostState=g;const h=this._createNetworkStateProvider(e,e.clientState,e.appStateService);e.networkState=h,e.errorState=new ao(c,a,s,h,e.diagnosticsService,i),this._updateTelemetryOnClientStateChange(e.clientState,l),this._updateTelemetryOnNetworkStateChange(h,l),this._updateTelemetryOnHostStateChange(g,l);const{enableUpdateHostOnClientStateChange:p}=i.get(b.J.Core);p&&this._updateHostOnClientStateChange(e.clientState,n,r);const{isRunningGlassjar:v}=i.get(b.J.Test);v&&this._trackClientStateForGlassjar(e.clientState,c)}))}_createNetworkStateProvider(e,t,i){const{coreSettings:n,loggerFactory:o,scenarioFactory:r,windowProvider:s,endpointsManager:a,hostCommunicationService:l,hostState:c,authStateProvider:d}=e,{enableNetworkOnlineDetection:u}=n.get(b.J.Core);return u?new pa(o,n,r,s,t,a,c,d):new ya(i,o,r,n,a,l)}}var Sa=i(308794),ka=i(588470),ba=i(136613),wa=i(959078),Ca=i(278593),_a=i(403084),Ta=i(928665),Ia=i(535059);class ja{constructor(e,t,i){var n;this._coreSettings=t,this._accountId=i,this._criticalResources=[],this.cleanup=new mi.xQ,this.currentAuthState=new r.X({state:Ca.j.Up}),this.resourceTokenStates=new Map,this.logSubscriptions=[],this.stateChangeLogs=[],this.skypeState=Ca.Q.Success,this.skypeTokenState=new r.X(Ca.Q.Unknown),this._logger=e.newLogger("AuthStateProvider","core-services-auth"),this._logger.log("[AuthState] Initializing auth state to Up.");const{criticalResources:o,authStateChangeTimeout:s}=(null===(n=this._coreSettings)||void 0===n?void 0:n.get(b.J.Auth))||{};this._criticalResources=o||[],this._authStateChangeTimeout=null!=s?s:3e4,this.badTokenStates=new Map,this.skypeLogSubscription=this.skypeTokenState.pipe((0,li.R)(this.cleanup)).pipe((0,Ws.x)()).subscribe((e=>{this._logger.log(`[AuthState] Skype token state changed to: ${e}`),this.recordStateChange("SkypeToken",e)})),this.telemetryInterval=globalThis.window.setInterval((()=>{this.publishAuthStateTelemetry()}),Bi.rF.ONE_HOUR),i&&(0,Ia.kh)(this.currentAuthState.value.state,i)}observe(){return this.currentAuthState}getState(){return this.currentAuthState.value}getInteractionRequiredResource(){const e=this.badTokenStates.entries();let t=e.next();for(;!t.done;){if(t.value[1]===Ca.Q.InteractionRequired)return t.value[0];t=e.next()}}reportResourceTokenState(e,t,i){(this._criticalResources.includes(e)||e===Bi.ej.SIGNIN_RESTRICTIONS_KEY)&&(this.updateTokenStateMap(e,t),t===Ca.Q.Success?this.badTokenStates.has(e)&&(this.badTokenStates.clear(),this.skypeState=t):this.badTokenStates.set(e,t),this.evaluateCurrentState(i))}observeResourceTokenState(e){if(!this._criticalResources.includes(e)&&e!==Bi.ej.SIGNIN_RESTRICTIONS_KEY)throw new Error("Unsupported resource, contact Auth team if you need your resource added.");let t=this.resourceTokenStates.get(e);return t||(t=this.updateTokenStateMap(e,Ca.Q.Unknown)),t.pipe((0,li.R)(this.cleanup)).pipe((0,Ws.x)())}reportSkypeTokenState(e,t){this.skypeTokenState.next(e),e!==this.skypeState&&(this.skypeState=e,this.evaluateCurrentState(t))}observeSkypeTokenState(){return this.skypeTokenState.pipe((0,li.R)(this.cleanup)).pipe((0,Ws.x)())}getSkypeTokenState(){return this.skypeTokenState.value}cleanupObservables(){var e;this._logger.log("[AuthState] Cleanup function called."),this.publishAuthStateTelemetry(),null===(e=null===globalThis||void 0===globalThis?void 0:globalThis.window)||void 0===e||e.clearInterval(this.telemetryInterval),this.cleanup.next(!0),this.cleanup.complete(),this.skypeTokenState.complete(),this.resourceTokenStates.forEach((e=>e.complete())),this.resourceTokenStates.clear(),this.skypeLogSubscription.unsubscribe(),this.logSubscriptions.forEach((e=>e.unsubscribe())),this.logSubscriptions=[]}recordStateChange(e,t){t!==Ca.Q.Unknown&&this.stateChangeLogs.push(`${Date.now()}|${e}->${t}`)}publishAuthStateTelemetry(){if(this.stateChangeLogs.length<1)return;const e=_a.cv.create({subContext:"AuthState",correlation:{id:(0,Ta.pW)(),source:"auth-state-provider",scenarioName:U.RG.AuthPublishState}});e.addEventData(this.stateChangeLogs),e.closeScenario(),this.stateChangeLogs=[]}updateTokenStateMap(e,t){let i=this.resourceTokenStates.get(e);return i?i.next(t):(i=new r.X(t),this.resourceTokenStates.set(e,i),this.logSubscriptions.push(i.pipe((0,li.R)(this.cleanup)).pipe((0,Ws.x)()).subscribe((t=>{this._logger.log(`[AuthState] ${e} token state changed to: ${t}`),this.recordStateChange(e,t)})))),i}evaluateCurrentState(e){let t;if(0===this.badTokenStates.size)t=this.skypeState===Ca.Q.LicenseError?Ca.j.LicenseError:this.skypeState!==Ca.Q.Success?Ca.j.SkypeReconnecting:Ca.j.Up;else{const e=this.badTokenStates.values();let i=e.next();for(;!i.done;){if(i.value===Ca.Q.InteractionRequired){t=Ca.j.InteractionRequired;break}t=i.value===Ca.Q.SignInRestriction?Ca.j.SignInRestriction:Ca.j.AADReconnecting,i=e.next()}}t&&this.changeAuthState(t,e)}changeAuthState(e,t){if(this.shouldChangeStateToImmediately(e))this.pendingStateClearTimeout&&(globalThis.window.clearTimeout(this.pendingStateClearTimeout),this.pendingState=void 0,this.pendingStateClearTimeout=void 0),this.changeTo({state:e,customError:Na(t)});else if(this.pendingState)this.pendingState={state:e,customError:Na(t)};else{if(e===this.currentAuthState.value.state)return;this.pendingState={state:e,customError:Na(t)},this.pendingStateClearTimeout=globalThis.window.setTimeout((()=>{this.pendingState&&this.changeTo(this.pendingState),this.pendingState=void 0,this.pendingStateClearTimeout=void 0}),this._authStateChangeTimeout)}}shouldChangeStateToImmediately(e){switch(e){case Ca.j.Up:case Ca.j.InteractionRequired:case Ca.j.LicenseError:case Ca.j.SignInRestriction:return!0;default:return!1}}changeTo(e){e.state!==this.currentAuthState.value.state&&(this._logger.warn(`[AuthState] Transition from ${this.currentAuthState.value} to ${e}`),this.recordStateChange("AuthState",e.state),this.currentAuthState.next(e),this._accountId&&(0,Ia.kh)(e.state,this._accountId,e.customError))}}const Na=e=>e&&{errorCode:e.errorCode||e.code,message:e.message,context:e.context,isExpected:e.isExpected,correlationId:e.correlationId,subContext:e.subContext};var Ea=i(916836),xa=i(726727),Aa=i(400871),Da=i(341830),Fa=i(827748),Oa=i(236380),Ma=i(793441);const Ra="Login Rate limit exceeded",Pa={AdminUserLicenseNotPresentForbidden:"AdminUserLicenseNotPresentForbidden",AdminTeamsDisabledForTenantForbidden:"AdminTeamsDisabledForTenantForbidden",UserLicenseNotPresentForbidde:"UserLicenseNotPresentForbidde",TeamsDisabledForTenantForbidden:"TeamsDisabledForTenantForbidden",UserLicenseNotPresentTrialEligible:"UserLicenseNotPresentTrialEligible",TrialLicenseTenantNotReady:"TrialLicenseTenantNotReady",NewFederatedUsersNotAllowed:"NewFederatedUsersNotAllowed"},La=(e,t)=>(t<0||Date.now()-t>=xa.gT.MILLISECONDS_PER_HOUR)&&((0,se.o7)(e)||[ia.qb.THROTTLED,ia.qb.NOT_AUTHORIZED,-1].indexOf(e)>-1),Ua=(e,t,i,n,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var o;const s=(0,Da.uc)(n),{serverResponse:{status:a,body:l}={}}=e;null==s||s.appendEventData({statusCode:a}),(0,se.o7)(null!=a?a:0)?null==s||s.fail({message:(0,Ta.VK)(e),errorCode:f.jK.ServiceUnavailable,statusCode:a}):-1!==a?((null===(o=l.message)||void 0===o?void 0:o.indexOf(Ra))>-1&&(null==s||s.incomplete({message:(0,Ta.VK)(e),errorCode:Ra,statusCode:a}),r.error(`DiscoverRetryPolicy: Delaying skype token fetch for ${Ma.b3.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD}' .`),(0,Fa._)(Ma.b3.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD)),yield Wa(e,t,i,n,r)):null==s||s.incomplete({message:(0,Ta.VK)(e),errorCode:f.jK.TimedOut,statusCode:a})})),Wa=(e,t,i,n,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var o,s;const a=(0,Da.uc)(n),{serverResponse:{status:l,body:c,headers:d}={}}=e;let u;try{const e=yield c.json();u=null===(o=null==e?void 0:e.error)||void 0===o?void 0:o.code}catch(e){r.error(`Body jsonify failed: ${e}`)}switch(r.error(`Getting errorCode: [${u}] from response`),l){case ia.qb.NOT_AUTHORIZED:yield $a(d,i,r,null===(s=t.options)||void 0===s?void 0:s.userIdentifier),null==a||a.incomplete({message:(0,Ta.VK)(e),errorCode:null!=u?u:f.jK.Unauthorized,statusCode:l});break;case ia.qb.FORBIDDEN:((e,t)=>e===ia.qb.FORBIDDEN&&!!t&&t in Pa)(l,u)&&Ba(u,t,n),null==a||a.cancel({message:(0,Ta.VK)(e),errorCode:null!=u?u:f.jK.Forbidden,statusCode:l});break;case ia.qb.THROTTLED:default:null==a||a.incomplete({message:(0,Ta.VK)(e),errorCode:null!=u?u:f.jK.Throttled,statusCode:l})}})),Ba=(e,t,i)=>{const n=(0,Da.uc)(i);if(e===Pa.NewFederatedUsersNotAllowed)return t.headerUpdate||(t.headerUpdate={strongConsistencyValue:(o=Ma.vu.strongConsistencyMsInternalUserSignup,Ma.vu.strongConsistencyDefaultValue.replace("{id}",o))}),void(null==n||n.mark(Pa.NewFederatedUsersNotAllowed));var o;e===Pa.UserLicenseNotPresentTrialEligible?(null==n||n.mark(Pa.UserLicenseNotPresentTrialEligible),t.lastLicenseErrorTime=-1):t.lastLicenseErrorTime=Date.now()},$a=(e,t,i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var o;e&&0!==(null===(o=Object.keys(e))||void 0===o?void 0:o.length)?yield t(e,n):i.error("DiscoverUnauthorizeError: header is empty")}));const Ha=(e,t,i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return qa(e,t,za)({policy:i,delay:i.createDelay(),retryCount:0,retriesTable:{},startTime:Date.now().valueOf(),forever:i.foreverCheck,headerUpdate:void 0,lastLicenseErrorTime:-1,options:{userIdentifier:null!=n?n:void 0}})})),qa=(e,t,i)=>n=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){for(var o;;){const r=t;(null===(o=n.headerUpdate)||void 0===o?void 0:o.strongConsistencyValue)&&(r.headers||(r.headers={}),r.headers.ConsistencyLevel=n.headerUpdate.strongConsistencyValue);try{return yield e(r)}catch(e){yield i(e,n)}}})),za=(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(!e.serverResponse)throw e;const i=!(yield t.forever()),{serverResponse:{status:n}}=e;if(-1!==t.startTime&&Date.now().valueOf()-t.startTime>=t.policy.retryMaxTimeMs&&(t.startTime=-1,t.policy.retryMaxTimeCallback(i)),n&&t.policy.isOnline()&&(t.retryCount++<t.policy.maxRetryCount&&!i||i)&&t.policy.shouldRetry(n,t.lastLicenseErrorTime))return t.retriesTable[n]=(t.retriesTable[n]||0)+1,t.policy.errorHandler(e,t);throw e}));var Va=i(296249),Ga=i(849960),Ja=i(924732),Ka=i(561849),Qa=i(935232);class Ya{constructor(e,t,i,n,s,a,l,c,d,u,m,g,h,p=(0,F.J)()){var v,y,S,w,C,_;this._authenticationService=e,this._coreSettings=n,this._scenarioFactory=s,this._networkStateProvider=a,this._hostCommunicationService=l,this._i18n=c,this._authStateProvider=d,this.onDiscoverSuccess=u,this.onDiscoverFail=m,this.isCDLWorker=g,this.cdlAuthClient=h,this.globalScope=p,this._skypeToken=new r.X(null),this._localStorageKeys=[],this._firstMTTokenEstablished=!1,this.cleanup=()=>{var e,t;null===(e=this._onlineSubscription)||void 0===e||e.unsubscribe(),this._onlineSubscription=void 0,null===(t=this._awakeSubscription)||void 0===t||t.unsubscribe(),this._awakeSubscription=void 0},this.clearDiscoveryCacheForLogout=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=(0,wa.Xx)(e);this.clearDiscoveryCache(t,["^fn:clearDiscoveryCacheForLogout"])})),this.clearDiscoveryCache=(e,t,i)=>{this._skypeToken.next(null),ka.Jt.del((0,Da.Z2)(e)),null==t||t.push("skypeCacheClear"),i||(ka.Jt.del((0,Da.Mu)(e)),null==t||t.push("userDetailsCacheClear"),ka.Jt.del((0,Da.S9)(e)),null==t||t.push("regionGtmsCacheClear")),this._clearFromLocalStorage(i),null==t||t.push("localstorageCacheClear"),this._logger.log(`[clearDiscoveryCache] Discover cache cleared, tokenOnly: ${!!i}.`)},this._getDiscoverResponse=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t,i,n,o,r,s;const{correlationId:a=(0,Ta.pW)(),eventData:l=[]}=e;null==l||l.push("_getDiscoverResponse|startScenario");const c=this._scenarioFactory.newScenario(U.RG.GetSkypeToken);let d;try{if(!this._isAppOnline())throw(0,$i.Tr)(Object.assign(Object.assign({},Da.bO),{correlationId:a}));if(!this._coreSettings.get(b.J.Auth).ignoreInteractionRequiredCache&&(null===(i=null===(t=this._authStateProvider)||void 0===t?void 0:t.getState())||void 0===i?void 0:i.state)===Ca.j.InteractionRequired)throw(0,$i.Tr)(Object.assign(Object.assign({},Da.BD),{correlationId:a}));d=yield this._discoverProvider(Object.assign(Object.assign({},e),{eventData:l})),(0,Da.nH)(d,this._coreSettings,this._telemetryProvider,this._logger,this._authenticationService)}catch(e){const t=e.errorCode||e.code,{serverResponse:{status:i}={}}=e;throw i===ia.qb.FORBIDDEN?(null===(n=this._authStateProvider)||void 0===n||n.reportSkypeTokenState(Ca.Q.LicenseError,e),null==l||l.push("authState:license-error")):t===Bi.SM.InteractionRequired?(null===(o=this._authStateProvider)||void 0===o||o.reportSkypeTokenState(Ca.Q.InteractionRequired,e),null==l||l.push("authState:interactionRequired")):(null===(r=this._authStateProvider)||void 0===r||r.reportSkypeTokenState(Ca.Q.Failure,e),null==l||l.push("authState:failure")),this.onDiscoverFail&&this.onDiscoverFail(!!this._bootstrapData),(0,Da.lm)(e,l,this._isAppOnline(),c,this._logger,this._coreSettings)}null===(s=this._authStateProvider)||void 0===s||s.reportSkypeTokenState(Ca.Q.Success);const u=(0,Da.ZC)(d,this._logger);yield(0,Da.ut)(e.userIdentifier,u,l,a,this._logger,this._scenarioFactory,this.globalScope,this._hostCommunicationService,this._coreSettings);const m=yield(0,Da.qW)(this._authenticationService,this._logger,l);return(0,wa.FG)(null==e?void 0:e.userIdentifier,m)||!(null==e?void 0:e.userIdentifier)?this._skypeToken.next(d.skypeToken):this._logger.error(`[_getDiscoverResponse][${a}] option uid:${null==e?void 0:e.userIdentifier}`),null==c||c.stop({reason:l.join(";")}),this.onDiscoverSuccess&&this.onDiscoverSuccess(),d})),this._isSkypeTokenValidInMemory=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=null!=e?e:yield(0,Da.qW)(this._authenticationService,this._logger,[]);return!!ka.Jt.getValue((0,Da.Z2)(t))})),this._retryMaxTimeCallback=e=>{var t;return e?(null===(t=this._authStateProvider)||void 0===t||t.reportSkypeTokenState(Ca.Q.Failure),this._logger.error("[_retryMaxTimeCallback]Reporting skype token failure to authState"),!1):(this._logger.warn("[_retryMaxTimeCallback] Reached retry max time."),!1)},this._getResponseFromLocalStorage=(e,t)=>{if(!t||!e)return;const i=this._getFromLocalStorage(e,t,"auth.gtm.table"),n=this._getFromLocalStorage(e,t,"auth.skype.token");return i&&n?Object.assign(Object.assign({},n.userDetails),{skypeToken:n.skypeToken,expires:new Date(n.expiration),regionGtms:i}):void 0},this._getCachedResponseWrapper=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t,i;return this._getResponseFromLocalStorage(null===(t=null==e?void 0:e.profile)||void 0===t?void 0:t.oid,null===(i=null==e?void 0:e.profile)||void 0===i?void 0:i.tid)})),this._acquireSkypeTokenWeb=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t,i,n;null===(t=e.eventData)||void 0===t||t.push("fn:_acquireSkypeTokenWeb");let o=yield this._authenticationService.getUser({accountId:e.userIdentifier.id,userIdentifier:e.userIdentifier,correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:U.RG.AuthWebUser}});if(null===(i=e.eventData)||void 0===i||i.push("user:"+ +!!o,"uid:"+ +!!e.userIdentifier,"currentToken:"+ +!!e.currentSkypeToken),!o){if(o=yield this._authenticationService.getUser({correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:U.RG.AuthWebUser}}),!o)throw(0,$i.Tr)({context:Ma.xm,subContext:"_acquireSkypeTokenWeb",errorCode:Bi.SM.UserNotFoundError,message:"User not found for provided userIdentifier nor globally.",correlationId:e.correlationId,isExpected:!1});(0,Da.nD)(e,o,this._logger)}const r=yield this._getCachedResponseWrapper(o);if(r)return null===(n=e.eventData)||void 0===n||n.push("cache:1"),r;const s=ka.Jt.getValue((0,Da.Mu)((0,wa.Xx)(o))),a=(0,Da.TB)(o,e.correlationId,this._coreSettings,this._logger,this._i18n,!!s),l=this._scenarioFactory.findScenario(U.RG.GetSkypeToken);let c=yield this._sendRequest(e,a,l);return this._coreSettings.get(b.J.Auth).disableRetryOnSameTokenFromAuthZ||c.skypeToken!==e.currentSkypeToken||(e.eventData.push("same-token"),null==l||l.mark(Ma.j.SKYPE_RECEIVED_SAME_TOKEN,(0,Da.nd)(e.eventData,this._isAppOnline(),this._coreSettings)),a.authOptions=Object.assign(Object.assign({},a.authOptions),{forceRenew:!0}),c=yield this._sendRequest(e,a,l)),c})),this._sendRequest=(e,t,i)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var n;null==i||i.mark(Ma.j.SKYPE_SEND_REQUEST,(0,Da.nd)(e.eventData,this._isAppOnline(),this._coreSettings));const o=yield this.send({userIdentifier:e.userIdentifier,correlationId:e.correlationId})(t);return null===(n=e.eventData)||void 0===n||n.push("response:1"),null==i||i.mark(Ma.j.SKYPE_RECEIVED_RESPONSE,(0,Da.nd)(e.eventData,this._isAppOnline(),this._coreSettings)),i&&(i.eventData.authzCorrelationId=o.headers["correlation-id"],i.eventData.correlationTags=o.headers["correlation-tags"],i.eventData.correlationId=null==e?void 0:e.correlationId),(0,Da.Qe)(o,e,this._logger)})),this._acquireSkypeTokenDesktop=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t,i,n,o;null===(t=e.eventData)||void 0===t||t.push("fn:_acquireSkypeTokenDesktop");const r=yield this._authenticationService.getUser({accountId:e.userIdentifier.id,userIdentifier:e.userIdentifier,correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:U.RG.AuthWebUser}}),s=yield this._getCachedResponseWrapper(r);if(s)return s;null===(i=e.eventData)||void 0===i||i.push("cache:0");const a=this._scenarioFactory.findScenario(U.RG.GetSkypeToken);null==a||a.mark(Ma.j.SKYPE_SEND_REQUEST_DESKTOP);const l=yield this.globalScope.opener.requestMessage(O.rY.GetStateData,{requestType:"skypeToken",timeout:xa.lP.ACQUIRE_TOKEN_TIMEOUT});null==a||a.mark(Ma.j.SKYPE_RECEIVED_RESPONSE);const c=null==l?void 0:l.skypeTokenData;a&&(a.eventData.correlationId=null==l?void 0:l.correlationId);return{userId:(0,Da.LO)(null===(n=null==c?void 0:c.token)||void 0===n?void 0:n.skypeToken,this._logger),userDetails:null==c?void 0:c.userDetails,skypeToken:null===(o=null==c?void 0:c.token)||void 0===o?void 0:o.skypeToken,regionGtms:null==c?void 0:c.regionGtms,expires:new Date(null==c?void 0:c.token.expiration)}})),this._acquireSkypeTokenWorker=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{eventData:t}=e;if(t.push("fn:_acquireSkypeTokenWorker"),!this.cdlAuthClient)throw(0,$i.Tr)({context:Ma.xm,subContext:"_acquireSkypeTokenWorker",errorCode:f.jK.NotPresent,message:"CDL worker auth client unavailable",correlationId:e.correlationId,isExpected:!1});const i=!1!==e.forceRenew,n=this._scenarioFactory.findScenario(U.RG.GetSkypeToken);null==n||n.mark(Ma.j.SKYPE_SEND_REQUEST_WORKER);const o=yield this.cdlAuthClient.getSkypeToken(i);return null==n||n.mark(Ma.j.SKYPE_TOKEN_RECEIVED_WORKER),Object.assign(Object.assign({userId:(0,Da.LO)(o.skypeToken,this._logger)},o.userDetails),{skypeToken:o.skypeToken,regionGtms:o.regionGtms,expires:new Date(o.expiration)})})),this._getRetryForSend=e=>{const{authzResource:t,disableRetryInDiscoverV2:i}=this._coreSettings.get(b.J.Auth);return n=>{var r;if(!this._authenticationService.authorizeV2)throw(0,$i.Tr)({context:Ma.xm,subContext:"_getRetryForSend",errorCode:"AuthorizeV2NotFound",message:"AuthorizeV2 endpoint not accessible",correlationId:null!==(r=n.correlationId)&&void 0!==r?r:(0,Ta.pW)(),isExpected:!1});const s=this._authenticationService.authorizeV2.bind(this._authenticationService),a=()=>(0,Aa.B)(s(e,t||xa.ej.MT_AAD_KEY,{userIdentifier:n.userIdentifier}),ia.qb.OK);return i?a():function(e,t,i){return n=>Ha(e,n,t,i)}(a(),((e,t,i,n,r,s)=>({shouldRetry:La,errorHandler:(n,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const o=(0,Da.uc)(t),{serverResponse:{status:s,headers:a}={}}=n;if(!s||!r.retriesTable[s])throw n.reason=Object.assign(Object.assign({},n.reason),{scenarioStep:"fail"}),n.message=`dicoverRetryPolicy: retry count for ${s} is empty`,n;const l=null==a?void 0:a["correlation-id"],c=null==a?void 0:a["correlation-tags"];null==o||o.appendEventData({authzCorrelationId:l,correlationTags:c}),r.headerUpdate=void 0,yield Ua(n,r,i,t,e),e.error(`[DiscoverRetryPolicy]: retrying '[${r.retryCount}]' times due to response status - '[${s}], wait for '[${r.delay.next()}] for next retry..'`);const d=yield r.forever();if(r.retryCount>=r.policy.maxRetryCount&&d)throw e.log(`[DiscoverRetryPolicy]: maxTimeReached count: ${r.retryCount} and tokenValid, cancel forever`),n.reason=["LoggedAlready"],n;return(0,Fa._)(r.delay.next())})),retryMaxTimeMs:xa.lP.DEFAULT_SKYPE_MAX_RETRY_DURATION_MS,maxRetryCount:xa.lP.DEFAULT_SKYPE_MAX_RETRY_COUNT,createDelay:()=>new Oa.df(xa.lP.DEFAULT_SKYPE_MIN_RETRY_INTERVAL_MS,xa.lP.DEFAULT_SKYPE_EXP_DELAY_FACTOR,xa.lP.DEFAULT_SKYPE_MAX_DELAY_TIME_MS),isOnline:n,retryMaxTimeCallback:r,foreverCheck:s}))(this._logger,this._scenarioFactory,this.unauthorizedErrorHandler,this._isAppOnline,this._retryMaxTimeCallback,this._isSkypeTokenValidInMemory),n.userIdentifier)}},this._isRefreshInBackgroundRequired=(e,t,i,n)=>{(null==e?void 0:e.shouldRefresh)&&(null==i||i.push("shouldrefreshbg"),this._debouncedGetDiscoverResponse((0,M.u4)(t),{userIdentifier:t,correlationId:n,eventData:i}).catch((e=>{(0,Da.H)(e,null==e?void 0:e.message,i,this._logger)})))},this._populateDiscoverResponseFromBootstrapdata=()=>{this._bootstrapData=this._coreSettings.get(b.J.Host).authBootstrapData,this._bootstrapData},this._isAppOnline=()=>this._networkStateProvider.getState()===Ys.G.Online,this.unauthorizedErrorHandler=(e,t)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){(0,Da.qO)(e,t,this._authenticationService,this._coreSettings,this._logger)})),this._logger=t.newLogger(Ma.xm,"core-services-discover"),(0,Ga.g)(this,"DiscoverV2",this._getConfig("mockApi"),this._getConfig("enableMockApi")),this.send=this._getRetryForSend(i),this._debouncedGetDiscoverResponse=(0,Ja.k)(this._getDiscoverResponse);(0,ka.ky)(p,(e=>{var t;return null===(t=null==n?void 0:n.get(b.J.Auth,[e]))||void 0===t?void 0:t[e]})),this._populateDiscoverResponseFromBootstrapdata(),this._discoverProvider=this.resolveProvider(),null===(y=null===(v=this._authenticationService)||void 0===v?void 0:v.registerCleanUpOnLogoutCallback)||void 0===y||y.call(v,k.D.Discover,this.clearDiscoveryCacheForLogout),this._tokenObserver=null===(C=null===(w=(S=this._authenticationService).observeMiddleTierToken)||void 0===w?void 0:w.call(S))||void 0===C?void 0:C.subscribe((e=>{if(void 0===e)this._logger.log("MT token appears as undefined, deleting skype token for relevant user."),(0,Da.qW)(this._authenticationService,this._logger,[]).then((e=>{e&&ka.Jt.del((0,Da.Z2)(e))}));else if(""!==e){const e=this._firstMTTokenEstablished;this._firstMTTokenEstablished=!0,this._logger.log(`Get Skype token on new MT token forceRenew: ${e}.`),this.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:e})}}));const{enableTokenRefreshOnOnline:T,enableTokenRefreshOnWakeUp:I}=null===(_=this._coreSettings)||void 0===_?void 0:_.get(b.J.Auth);T&&(this._logger.log("Subscribing to Online state for Skype token."),this._onlineSubscription=Qa._i.observeMachineOnline().subscribe((()=>{this._logger.log("Getting skype token on Online."),this.getSkypeTokenInfoFromDiscoveryResponse()}))),I&&(this._logger.log("Subscribing to Suspended state for Skype token."),this._awakeSubscription=Qa._i.observeMachineAwake().subscribe((()=>{this._logger.log("Getting skype token on Suspended."),this.getSkypeTokenInfoFromDiscoveryResponse()}))),this._telemetryProvider=(0,Ei.G)(),this._logger.log("[ctor]Service initialized.")}observeSkypeToken(){return this._skypeToken.pipe((0,u.h)((e=>null!==e)),(0,Ws.x)())}shouldThrowErrorIfSkypeTokenIsEmpty(){return!this._coreSettings.get(b.J.Auth).disableThrowingErrorIfSkypeTokenIsEmpty}getSettingToDisableSkypeTokenValidation(e,t){return(0,Da.wh)(e,t,this._coreSettings,this._logger,this._scenarioFactory)}shouldSkipTokenRefreshForAnon(){return!this._coreSettings.get(b.J.Auth).disableSkipTokenRefreshForAnon}regionGtm(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=(0,Ta.pW)(),n=["^fn:regionGtm:uid:"+ +!!t];try{const o=yield this.regionGtmTable(t,i,n),r=null==o?void 0:o[e];if(r)return r===Ma.sW?r:(0,Cr.m)(r);throw(0,$i.Tr)({correlationId:i,message:`${Ma.xm}[regionGtm][${i}] ${e} not found in regionGtms table`,isExpected:!0,context:Ma.xm,subContext:"regionGtm",errorCode:"RegionGtmNotFoundInRespone"})}catch(e){throw(0,Da.WA)(e,"regionGtm",i),(0,Da.H)(e,null==e?void 0:e.message,n,this._logger)}}))}regionGtmTable(e,t=(0,Ta.pW)(),i=[]){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=null!=e?e:yield(0,Da.qW)(this._authenticationService,this._logger,i);let o=ka.Jt.getValue((0,Da.S9)(n));if(!o){this._logger.log(`[regionGtm][${t}] No cached regionGtm, start network call..`),i.push("cache:0");const e=yield this._debouncedGetDiscoverResponse((0,M.u4)(n),{userIdentifier:n,correlationId:t,eventData:i});o=null==e?void 0:e.regionGtms,i.push(`InResponse:${!!o}`)}return o}))}skypeid(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=(0,Ta.pW)(),i=["^fn:skypeid:uid:"+ +!!e];try{const i=yield this.getUser(t,e);if(!i){const e=`[skypeid][${t}] No userDetail for getting skypeId`;throw this._logger.error(e),new Error(`${Ma.xm} No user for getting skypeId`)}return i.id}catch(e){throw(0,Da.WA)(e,"skypeid",t),(0,Da.H)(e,null==e?void 0:e.message,i,this._logger)}}))}validateSkypeToken(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield this.validateSkypeTokenV2(e)).skypeToken}))}validateSkypeTokenV2(e){var t,i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=(0,Ta.pW)(),r=["^fn:validateSkypeToken:uid:"+ +!!(null==e?void 0:e.userIdentifier)];try{const s=null!==(t=null==e?void 0:e.userIdentifier)&&void 0!==t?t:yield(0,Da.qW)(this._authenticationService,this._logger,r),a=ka.Jt.get((0,Da.Z2)(s)),l=null==a?void 0:a.item;if(r.push(`cache:${!!l}`),l&&(yield(0,Va.p)(l,this.globalScope,this._scenarioFactory,this._hostCommunicationService,this._coreSettings)),(null==s?void 0:s.accountType)===Es.Ch.Anonymous&&(null==l?void 0:l.skypeToken)&&!this._coreSettings.get(b.J.Auth).disableIgnoringForceRenewForAnon)return null===(i=this._authStateProvider)||void 0===i||i.reportSkypeTokenState(Ca.Q.Success),{skypeToken:l.skypeToken,fromCache:!0};const c=null==e?void 0:e.forceRenew,d=null==e?void 0:e.invalidSkypeToken;if(!c&&l&&l.skypeToken&&l.skypeToken!==d&&l.expiration&&l.expiration>Date.now())return this._isRefreshInBackgroundRequired(a,s,r,o),this._skypeToken.value||this._skypeToken.next(l.skypeToken),null===(n=this._authStateProvider)||void 0===n||n.reportSkypeTokenState(Ca.Q.Success),{skypeToken:l.skypeToken,fromCache:!0};this.clearDiscoveryCache(s,r,!0),this._logger.log(`[validateSkypeToken][${o}] Skype token not valid during ping of forceRenew:${c}, clear old cache and start wire request.`);const u=yield this._debouncedGetDiscoverResponse((0,M.u4)(s),{userIdentifier:s,correlationId:o,eventData:r,currentSkypeToken:null==l?void 0:l.skypeToken});return this._logger.log(`[validateSkypeToken][${o}] SkypeToken fetched from network.`),r.push(`InResponse:${!!u.skypeToken}`),{skypeToken:u.skypeToken,fromCache:!1}}catch(e){throw(0,Da.WA)(e,"validateSkypeToken",o),(0,Da.H)(e,null==e?void 0:e.message,r,this._logger)}}))}getRegion(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=(0,Ta.pW)(),i=["^fn:getRegion:uid:"+ +!!e];try{const n=null!=e?e:yield(0,Da.qW)(this._authenticationService,this._logger,i),o=ka.Jt.getValue((0,Da.Mu)(n));if(o)return o.region;i.push("cache:0"),this._logger.log(`[getRegion][${t}] No user details found in cache. Getting it from request.`);const r=yield this._debouncedGetDiscoverResponse((0,M.u4)(n),{userIdentifier:n,correlationId:t,eventData:i});return i.push(`InResponse:${!!r.region}`),r.region}catch(e){throw(0,Da.WA)(e,"getRegion",t),(0,Da.H)(e,null==e?void 0:e.message,i,this._logger)}}))}getUserRegionAndPartitionForMultiGeo(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=(0,Ta.pW)(),i=["^fn:getUserRegionAndPartitionForMultiGeo:uid:"+ +!!e];try{const n=null!=e?e:yield(0,Da.qW)(this._authenticationService,this._logger,i),o=ka.Jt.getValue((0,Da.Mu)(n));if(o)return{userRegion:null==o?void 0:o.userRegion,partition:null==o?void 0:o.partition,userPartition:null==o?void 0:o.userPartition};i.push("cache:0"),this._logger.log(`[getUserRegionAndPartitionForMultiGeo][${t}] No user details found in cache. Getting it from request.`);const r=yield this._debouncedGetDiscoverResponse((0,M.u4)(n),{userIdentifier:n,correlationId:t,eventData:i});return i.push(`InResponse|userRegion:${!!r.userRegion}|partition:${!!r.partition}|userPartition:${!!r.userPartition}`),{userRegion:null==r?void 0:r.userRegion,partition:null==r?void 0:r.partition,userPartition:null==r?void 0:r.userPartition}}catch(e){throw(0,Da.WA)(e,"userRegionAndPartition",t),(0,Da.H)(e,null==e?void 0:e.message,i,this._logger)}}))}getUser(e=(0,Ta.pW)(),t){var i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=["^fn:getUser:uid:"+ +!!t];try{const r=null!=t?t:yield(0,Da.qW)(this._authenticationService,this._logger,o);let s=ka.Jt.getValue((0,Da.Mu)(r));if(s||(this._logger.log(`[getUser][${e}]No cache, start network call...`),o.push("cache:0"),o.push(`IsCDL:${this.isCDLWorker&&this.cdlAuthClient}`),s=this.isCDLWorker&&this.cdlAuthClient?null===(i=yield this.cdlAuthClient.getUserDetails())||void 0===i?void 0:i.userDetails:(0,Da.br)(o,this._bootstrapData,this._logger)||(null===(n=yield this.getSkypeTokenInfoFromDiscoveryResponse({silent:!1,correlationId:e,userIdentifier:t,eventData:o}))||void 0===n?void 0:n.userDetails)),!s)throw new Error(`${Ma.xm}[getUser][${e}] UserDetails fetched failure from network request`);return(0,Da.wC)(s,this._logger)}catch(t){(0,Da.WA)(t,"getUser",e);const i=(0,Da.H)(t,null==t?void 0:t.message,o,this._logger);throw new Ka.l(i)}}))}getSkypeTokenInfoFromDiscoveryResponse(e){var t,i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{correlationId:o=(0,Ta.pW)(),userIdentifier:s}=e||{},a=null!==(t=null==e?void 0:e.eventData)&&void 0!==t?t:[];null==a||a.push("fn:getSkypeTokenInfoFromDiscoveryResponse");try{const t=null!=s?s:yield(0,Da.qW)(this._authenticationService,this._logger,a),l=null==e?void 0:e.forceRenew,c=ka.Jt.get((0,Da.Z2)(t));if((null==t?void 0:t.accountType)===Es.Ch.Anonymous&&(null===(i=null==c?void 0:c.item)||void 0===i?void 0:i.skypeToken)&&!this._coreSettings.get(b.J.Auth).disableIgnoringForceRenewForAnon)return null===(n=this._authStateProvider)||void 0===n||n.reportSkypeTokenState(Ca.Q.Success),c.item;let d;if(c&&c.item&&!l)this._isRefreshInBackgroundRequired(c,t,a,o),d=c.item;else{null==a||a.push("cache:"+ +!!(null==c?void 0:c.item),`forceRenew:${l}`),this._logger.log(`[getSkypeTokenInfoFromDiscoveryResponse][${o}] No response retrieved from cache.`),this.clearDiscoveryCache(t,a,!0);const i=yield this._debouncedGetDiscoverResponse((0,M.u4)(t),Object.assign(Object.assign({},e),{userIdentifier:t,eventData:a,currentSkypeToken:null==c?void 0:c.item.skypeToken}));d=(0,Da.ZC)(i,this._logger)}return null===(r=this._authStateProvider)||void 0===r||r.reportSkypeTokenState(Ca.Q.Success),d}catch(e){throw(0,Da.WA)(e,"getSkypeTokenInfoFromDiscoveryResponse",o),(0,Da.H)(e,null==e?void 0:e.message,a,this._logger)}}))}unsubscribeMtToken(){var e;null===(e=this._tokenObserver)||void 0===e||e.unsubscribe()}getConsumerLicenseDetails(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=(0,Ta.pW)(),n=["^fn:getConsumerLicenseDetails:uid:"+ +!!e];try{const o=null!=e?e:yield(0,Da.qW)(this._authenticationService,this._logger,n);if(!(o.accountType===Es.Ch.MsaLife))return this._logger.log(`[getConsumerLicenseDetails][${i}] User account type is not MsaLife.`),Promise.resolve(void 0);const r=ka.Jt.getValue((0,Da.Mu)(o)),s=null===(t=null==r?void 0:r.licenseDetails)||void 0===t?void 0:t.consumerLicenseDetails;if(s)return s;n.push("cache:0"),this._logger.log(`[getConsumerLicenseDetails][${i}] No user license details found in cache. Getting it from request.`);const a=yield this._debouncedGetDiscoverResponse((0,M.u4)(o),{userIdentifier:o,correlationId:i,eventData:n});return n.push(`InResponse:${!!(null==a?void 0:a.consumerLicenseDetails)}`),null==a?void 0:a.consumerLicenseDetails}catch(e){throw(0,Da.WA)(e,"getConsumerLicenseDetails",i),(0,Da.H)(e,null==e?void 0:e.message,n,this._logger)}}))}_clearFromLocalStorage(e){var t;(null===(t=this.globalScope)||void 0===t?void 0:t.localStorage)&&(e?this._localStorageKeys.forEach((e=>{e.indexOf("auth.skype.token")>-1&&this.globalScope.localStorage.removeItem(e)})):this._localStorageKeys.forEach((e=>{this.globalScope.localStorage.removeItem(e)})),this._localStorageKeys=[])}resolveProvider(){return this._bootstrapData?this._acquireSkypeTokenDesktop:this.isCDLWorker?this._acquireSkypeTokenWorker:this._acquireSkypeTokenWeb}_getFromLocalStorage(e,t,i){var n;if(!(null===(n=this.globalScope)||void 0===n?void 0:n.localStorage))return;let o=`ts.${t}-${e}.${i}`,r=this.globalScope.localStorage.getItem(o);if(r||(o=`ts.${e}.${i}`,r=this.globalScope.localStorage.getItem(o)),r){this._localStorageKeys.push(o);try{return JSON.parse(r)}catch(e){this._logger.error(`[_getFromLocalStorage] ${e}`)}}}_getConfig(e){return this._coreSettings.get(b.J.Auth,[e])[e]}}const Xa=(e,t,i,n,o,r,s,a,l,c,d,u,m,g,h,p)=>{const{enableRequireDiscoverV2:v}=n.get(b.J.Auth);return v?new Ya(e,t,i,n,o,s,a,l,c,u,m,g,h,p):new Ea.Jq(e,t,i,n,o,r,d,u,m,g,h,p)};var Za=i(283722),el=i(891772);class tl extends Ce.i{constructor(){super(f.Yg.CreateAuthMTMA,["appStateService","loggerFactory","scenarioFactory","networkState","coreSettings","authenticationService","authenticationUser","telemetryService","i18n","deeplinkService","userBiService","hostCommunicationService"])}execute(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{appStateService:n,loggerFactory:o,scenarioFactory:r,networkState:s,coreSettings:a,authenticationService:l,authenticationUser:c,telemetryService:d,i18n:u,deeplinkService:m,userBiService:g,hostCommunicationService:h}=e,{enableUserAuthT2:p}=a.get(b.J.Auth)||{};if(!p)return;(0,_a.u)(null==c?void 0:c.id,g);const v=il(c);try{if(!c)throw new Error("No AuthenticationUserContext found during User Auth init.");if(!l.createUserAuth)throw new Error("No User Auth Creation API exposed.");const i=new ja(o,a,c.id);e.authStateProvider=i,v.addEventData(["authState:created"]);const g=null===(t=l.createUserAuth)||void 0===t?void 0:t.call(l,c,"create-auth-mtma-task",i,m);e.authenticationService=g,v.addEventData(["userAuth:created"]);const p=(0,Za.Gg)(n);let y;if(a.get(b.J.Telemetry).useTelemetryServicesCache){y=d.getTelemetryServicesCache().get(c.id);const e=ka.Jt.getValue((0,ba.VF)({id:c.id}).telemetryInfo);v.setUserToTelemetryContext({id:c.id,oid:c.profile.objectId,tid:c.profile.tenantId,type:c.type,role:c.role,subType:c.subType,isCrossCloudUser:!!(null==e?void 0:e.isCrossCloudUser),isExternal:(0,wa.b9)(c.id,c.homeAccountId)})}const f=Xa(g,o,el.l,a,(null==y?void 0:y.coreScenarioFactory)||r,p,s,h,u,i,void 0,void 0,void 0,void 0,void 0);return e.discover=f,v.addEventData(["discover:created"]),f.validateSkypeToken(),a.get(b.J.Telemetry).useTelemetryServicesCache&&f.getRegion().then((e=>v.setUserDetailsToTelemetryContext({region:e||""}))),v.closeScenario(),nl(i,d,c.id),e=>{var t;switch(e){case"quit":case"restart":break;default:null===(t=f.cleanup)||void 0===t||t.call(f),null==i||i.cleanupObservables()}}}catch(e){const t=e instanceof Ka.l?e:new Ka.l(e);throw v.closeScenario({error:null!==(i=t.prevError)&&void 0!==i?i:e}),t}}))}}const il=e=>{const t={id:(0,Ta.pW)(),scenarioName:U.RG.AuthUserInit,source:"create-auth-mtma-task::execute"};return _a.cv.create({correlation:t,subContext:"createAuthMTMATask",timeoutMs:Bi.rF.ONE_HOUR,scenarioEventData:{context:`id:${!!(null==e?void 0:e.id)}`,accountId:null==e?void 0:e.id}})},nl=(e,t,i)=>{e.observe().subscribe((e=>{t.setContext("UserInfo.AuthState",e.state,void 0,i)}))},ol="auth-cache",rl="key",sl=(e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return new Promise(((n,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{const o=yield ll(e),s=al(o,"readwrite",n,r),a=((e,t)=>({[rl]:t,value:e}))(t,i),l=s.put(a);l.onerror=e=>{o.close(),r(`[putToIDB] error: ${e}`)},l.onsuccess=()=>{o.close(),n()}}catch(e){r(`[putToIDB][catch] error: ${e}`)}}))))})),al=(e,t,i,n)=>{cl(e,n)||n("Transaction not valid");const o=e.transaction(ol,t);return o.onerror=t=>{e.close(),n(t)},o.oncomplete=()=>{e.close(),i()},o.onabort=t=>{e.close(),n(t)},o.objectStore(ol)},ll=e=>new Promise(((t,i)=>{const n=e.open("Teams:auth",1);n.onsuccess=()=>{const e=n.result;t(e)},n.onerror=()=>{i(`IndexedDB error: ${n.error}`)},n.onblocked=()=>{i("IndexedDB error: BLOCKED")},n.onupgradeneeded=e=>{const t=n.result;if(!t.objectStoreNames.contains(ol)||e.oldVersion<1){const e=t.createObjectStore(ol,{keyPath:rl});e&&!e.indexNames.contains("key")&&e.createIndex("key",rl)}t.close()}})),cl=(e,t)=>e?!!e.objectStoreNames.contains(ol)||(t(`objectStore does not exists: ${ol}`),!1):(t("You need to use the openDatabase function to create a database before you query it!"),!1);class dl{constructor(e){this._indexedDbStorage=e.indexedDB}put(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield sl(this._indexedDbStorage,t,e)}))}getValue(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return new Promise(((i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{const o=yield ll(e),r=al(o,"readonly",i,n).get(t);r.onerror=e=>{o.close(),n(`[IndexDB][getFromIDB] error: ${e}`)},r.onsuccess=e=>{var t,n;o.close(),i(null===(n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.result)||void 0===n?void 0:n.value)}}catch(e){n(`[getFromIDB][catch] error: ${e}`)}}))))})))(this._indexedDbStorage,e)}))}del(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return new Promise(((i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{const o=yield ll(e),r=al(o,"readwrite",i,n).delete(t);r.onsuccess=e=>{o.close(),i(null==e?void 0:e.target)},r.onerror=e=>{o.close(),n(`Error in deleteRequest: ${e}`)}}catch(e){n(`[deleteFromIDB][catch] error: ${e}`)}}))))})))(this._indexedDbStorage,e)}))}}var ul=i(703793),ml=i(59482),gl=i(332507),hl=i(451249);const pl=(e,t,i)=>{var n;const{environment:o}=null!==(n=i.get(b.J.Metadata,["environment"]))&&void 0!==n?n:{},{clientType:r,currentUrl:s,hostingParent:a,isInIframe:l,isInCypressFrame:c,browser:d,browserVersion:u,osPlatform:m,osVersion:g}=t.config;return Object.assign(Object.assign({},e),{clientType:r,currentUrl:s,hostingParent:a,isInIframe:l,isInCypressFrame:c,browser:d,browserVersion:u,osPlatform:m,osVersion:g,environment:o})},vl=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){e.initializeAuthenticationService&&(yield e.initializeAuthenticationService())})),yl=(e,t,i,n)=>{const o={id:(0,Ta.pW)(),scenarioName:U.RG.AuthStart,source:"core-auth-tasks::init"};return ka.Jt.put(ba.Jl.authSessionId,o.id),_a.cv.create({correlation:o,subContext:"createAuthenticationServiceInstance",timeoutMs:Bi.rF.ONE_HOUR,scenarioEventData:{context:`env:${e}||host:${t}||v2:${+!!i}||global:${+!!n}`}})},fl=(e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var n;null===(n=e.registerCleanUpOnLogoutCallback)||void 0===n||n.call(e,"BatchAuthTelemetry",(e=>(0,ml.mM)(t,i,(0,wa.Xx)(e))))}));class Sl extends Ce.i{constructor(){super(f.Yg.CreateAuth,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.authenticationService=yield(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var t,n,o;const{loggerFactory:r,scenarioFactory:s,config:a,appStateService:l,coreSettings:c,windowProvider:d,platformService:u,authStateProvider:m,hostCommunicationService:g,telemetryService:h,i18n:p,rebootService:v,userBiService:y,endpointsManager:f,crossTabsService:S,networkState:k,hostState:w}=e,C=(0,ka.ky)(d,(e=>{var t;return null===(t=null==c?void 0:c.get(b.J.Auth,[e]))||void 0===t?void 0:t[e]})),_=new dl(d),T=(0,ul.N)(_);(0,_a.Tu)(s,T,h),(0,Qa.rt)(w,k),(0,_a.u)(void 0,y);const I=(0,hl.fZ)(r,S),j=pl(a,u,c),N=(0,Za.Gg)(l),{enableAuthV2:E,enableUserAuthT2:x,deleteBatchScenarioFromStorage:A,enableAsyncBatchScenario:D}=(null==c?void 0:c.get(b.J.Auth,["enableAuthV2","enableUserAuthT2","deleteBatchScenarioFromStorage","enableAsyncBatchScenario"]))||{},F=yl(null!==(t=j.environment)&&void 0!==t?t:"",null===(n=null==d?void 0:d.location)||void 0===n?void 0:n.hostname,!!E,!!x);let O;try{O=E?x?new((yield(0,gl.mT)((()=>Promise.all([i.e(825779),i.e(59938),i.e(608983)]).then(i.bind(i,429883))),"global-auth",s)).GlobalAuthService)(r,s,j,d,g,I,p,c,v,f):new((yield(0,gl.mT)((()=>Promise.all([i.e(825779),i.e(59938),i.e(496106)]).then(i.bind(i,943470))),"auth_v2",s)).AuthenticationService)(r,s,j,d,g,I,p,m,c):new((yield(0,gl.mT)((()=>Promise.all([i.e(416777),i.e(159818)]).then(i.bind(i,35901))),"auth",s)).AuthenticationService)(r,s,N,j,d,h,c,g),yield vl(O),D&&(yield fl(O,s,T)),A&&(0,ml.Q7)(C),F.closeScenario()}catch(e){const t=e instanceof Ka.l?e:new Ka.l(e);throw F.closeScenario({error:null!==(o=t.prevError)&&void 0!==o?o:e}),t}return O})))(e)}))}}var kl=i(27149),bl=i(565697);const wl=(e,t,i,n)=>{var o;if(null===(o=null==n?void 0:n.get(b.J.Auth))||void 0===o?void 0:o.enableMtoCoachMark){(null==t?void 0:t.some((e=>"DefaultHidden"===(null==e?void 0:e.userTenantState)&&"MTO"===(null==e?void 0:e.tenantRelationship))))&&(null==e||e.recordAuthUserBiTelemetry(i,{scenario:kl.dX.authMtoUser}))}(null==t?void 0:t.some((e=>"MTO"===(null==e?void 0:e.tenantRelationship))))&&(null==e||e.recordAuthUserBiTelemetry(i,{scenario:kl.dX.authHasMtoTenant}))},Cl=(e,t)=>_a.cv.create({correlation:e,subContext:"createAuthTenantsTask",timeoutMs:Bi.rF.ONE_HOUR,scenarioEventData:{accountId:null==t?void 0:t.id}});class _l extends Ce.i{constructor(){super(f.Yg.CreateAuthTenants,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=e;yield(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var t;const{coreSettings:i,authenticationUser:n,endpointsManager:o,authenticationService:r}=e,{enableUserAuthT2:s,enableMultiTenants:a}=i.get(b.J.Auth)||{};if(!n)throw new Error("No AuthenticationUserContext found during OnUserAuthenticated_MTMA hook");const{testAutomation:l}=i.get(b.J.Test)||{};if(!s||!a||!(0,bl.Kf)(n))return;const c={id:(0,Ta.pW)(),scenarioName:U.RG.AuthWebSetUpTenants,source:"create-auth-tenants-task::setupTenantService"},d=Cl(c,n);try{if(!r.setUpTenantsService||!r.getTenants)throw new Error("No TenantsService Set Up found duringGetTenants Task");const e={accountId:n.id,correlation:d.correlation,forceRefresh:!l};try{yield r.setUpTenantsService(o,e)}catch(e){return void d.closeScenario({error:e})}d.addEventData(["tenantService:created"]),r.getTenants(e).then((e=>{d.appendScenarioEventData({tenantCount:null==e?void 0:e.length}),wl(d,e,n.id,i),d.closeScenario()})).catch((e=>{d.closeScenario({error:e})}))}catch(e){const i=e instanceof Ka.l?e:new Ka.l(e);throw d.closeScenario({error:null!==(t=i.prevError)&&void 0!==t?t:e}),i}})))(t);const{enableTenantPolling:i}=t.coreSettings.get(b.J.Auth);if(!i)return;const n=yield(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var t;const{coreSettings:i,authenticationService:n,windowProvider:r,authenticationUser:s,correlation:a}=e;if(!s)throw new Error("No AuthenticationUserContext found during OnUserAuthenticated_MTMA hook");if(s.homeAccountId!==s.id||!(0,bl.Kf)(s))return;const l=(null===(t=i.get(b.J.Auth))||void 0===t?void 0:t.tenantPollingMiliseconds)||Bi.rF.ONE_DAY,c=r.setInterval((()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const e={id:a.id,scenarioName:U.RG.AuthWebGetTenantsInterval,source:"create-auth-tenants-task::tenantPollingInterval"},t=Cl(e,s);try{const o={accountId:s.id,forceRefresh:!0,correlation:e};if(!n.getTenants)throw new Error("No valid getTenants function inside tenant polling interval");const r=yield n.getTenants(o);wl(t,r,s.id,i),t.addEventData(["tenantService:AuthWebTenantPolling"]),t.appendScenarioEventData({tenantCount:null==r?void 0:r.length}),t.closeScenario()}catch(e){t.closeScenario({error:e}),r.clearInterval(c)}}))),l);return Promise.resolve(c)})))(t);return e=>{n&&"signout"===e&&t.windowProvider.clearInterval(n)}}))}}var Tl=i(462410),Il=i(287474),jl=i(747741);class Nl{constructor(e,t,i){this.aad=e,this.discover=t,this.coreSettings=i,this.cmdMTAuthResource=e=>this._cmdMtAuthorize(e),this.mtAuthResource=e=>{const{requireSkypetokenForMT:t}=this.coreSettings.get(b.J.Auth);return this._mtAuthorize(e,t||!1)},this.skypeAuthResource=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._authorizeWithSkypeTokenMigration(e)})),this.skypeAuthorizeAuthResource=e=>this._authorizeWithSkypeTokenMigration(e,"Authorization"),this.skypeXTokenAuthResource=e=>this._authorizeWithSkypeTokenMigration(e,"x-skypetoken"),this.mtAuthWithSkypeXTokenResource=e=>this._mtAuthorize(e,!0),this.authorizeByUrl=(e,t)=>{const i=new URL(e.url),n=t?"/":"",o=`${i.protocol}//${i.host}${n}`;return this.aad.authorizeRequest(e,o)},this._migrateSkypeToken=(e,t,i)=>{e.headers&&(e.headers[Bi.kI]="True");const{ic3NonCaeResource:n,ic3CaeResource:o}=this.coreSettings.get(b.J.Auth),r=t===Il.Zw.CAE?null!=o?o:Bi.ej.IC3_GATEWAY_CAE_KEY:null!=n?n:Bi.ej.IC3_GATEWAY_AAD_KEY,s=this._composeAuthResourcesForStm((e=>this.aad.authorizeRequest(e,r)),i);return s(e)},this._cmdMtAuthorize=e=>this.aad.getUser().then((()=>{const{cmdMeetingArtifactsServiceResource:t}=this.coreSettings.get(b.J.CMDMeetingArtifactsService);return(e=>this.aad.authorizeRequest(e,null!=t?t:""))(e)})),this._mtAuthorize=(e,t)=>this.aad.getUser().then((()=>{const{enableSkypeTokenMigrationForMT:i}=this.coreSettings.get(b.J.Auth);if(i&&t){const{stmHeader:i,overwrittenRequireSkypetokenForMT:n}=this._getStmInfoForSources(e);t=n,e.headers=Object.assign(Object.assign({},e.headers),i)}const n=(0,Da.JY)(this.coreSettings),o=e=>this.aad.authorizeRequest(e,n);return(t?this.composeAuthResources(o,this.skypeXTokenAuthResource):o)(e)})),this._getStmInfoForSources=e=>{const{stmSourceList:t=[]}=this.coreSettings.get(b.J.Auth),i=e.authOptions||{},n={stmHeader:{},overwrittenRequireSkypetokenForMT:!0},o=null==t?void 0:t.find((e=>(null==e?void 0:e.source)===(null==i?void 0:i.source)));return o?(n.stmHeader={[Bi.kI]:"True"},(null==o?void 0:o.disableSkypeTokenInHeader)&&(n.overwrittenRequireSkypetokenForMT=!1),n):n},this.skype=new Tl.q(this.discover)}composeAuthResources(e,t){return i=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return e(i).then((e=>t(e.request).then((t=>({request:t.request,resolver:(i,n)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield t.resolver(i,n);return yield e.resolver(i,o||n)}))})))))}))}_authorizeWithSkypeTokenMigration(e,t){const{skypeTokenMigrationEnabled:i}=this.coreSettings.get(b.J.Auth);return i?this.aad.getUser().then((i=>{const n=e.authOptions||{};let o=(null==n?void 0:n.source)?(0,jl.xT)(null==n?void 0:n.source,this.coreSettings,void 0,i):Il.Zw.Skype;const{disableSTMFallback:r}=this.coreSettings.get(b.J.Auth),{skypeTokenFallbackMap:s}=this.aad;if(!r&&(null==n?void 0:n.source)&&s){const e=(0,jl.eH)(s,null==n?void 0:n.source,this.coreSettings);void 0!==e&&(o=(0,jl.JX)([e],o))}return(null==n?void 0:n.source)&&o!==Il.Zw.Skype?this._migrateSkypeToken(e,o,t):this.skype.authorizeRequest(e,t)})).catch((()=>{const{disableSTMFallback:i}=this.coreSettings.get(b.J.Auth);if(i)throw(0,$i.Tr)({context:"authentication-resources",subContext:"disableSTMFallback",errorCode:Bi.SM.InvalidToken,message:"disableSTMFallback: true, STM fallback logic blocked",correlationId:"",isExpected:!0});return this.skype.authorizeRequest(e,t)})):this.skype.authorizeRequest(e,t)}_composeAuthResourcesForStm(e,t){return i=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return e(i).then((e=>({request:e.request,resolver:(i,n)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield e.resolver(i,n)}catch(e){if((null==e?void 0:e.errorCode)===Bi.SM.FallbackWithSkypeToken){(null==n?void 0:n.headers)&&delete n.headers.Authorization;return(yield this.skype.authorizeRequest(n,t)).request}throw e}}))})))}))}}class El extends Ce.i{constructor(){super(f.Yg.CreateAuthenticationResources,["authenticationService","discover","coreSettings"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.authenticationResources=new Nl(e.authenticationService,e.discover,e.coreSettings)}))}}class xl extends Ce.i{constructor(){super(f.Yg.CreateAuthStateTask,["loggerFactory","coreSettings","telemetryService"]),this._updateTelemetryOnClientStateChange=(e,t)=>{e.observe().subscribe((e=>{t.setCoreContext("AppInfo.AuthState",e)}))}}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{loggerFactory:t,coreSettings:i,telemetryService:n}=e,{enableAuthState:o,enableUserAuthT2:r}=i.get(b.J.Auth);if(!o||r)return;const s=new ja(t,i);e.authStateProvider=s,this._updateTelemetryOnClientStateChange(s,n)}))}}class Al extends Ce.i{constructor(){super(f.Yg.CreateCacheClearing,["clientState","windowProvider"]),this._clearCacheOnClientStateChangeToInactive=(e,t)=>{e.observe().subscribe((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var i;e===_e.pk.Inactive&&(yield null===(i=this.dataEvictionService)||void 0===i?void 0:i.evict(),t.clearCache())}))))}}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{clientState:t,windowProvider:i,dataEvictionService:n}=e;this.dataEvictionService=n,this._clearCacheOnClientStateChangeToInactive(t,i)}))}}class Dl{constructor(e,t,i,n){this._caches=e,this._tenantId=t,this._userId=i,this._experienceName=n}setUserAndTenantIds(e,t){this._tenantId=e,this._userId=t}createRequest(e,t,i,n,o=!1,r=this._experienceName){const s=this._getFormatKey(t,r,i,o);return{cacheName:e,request:new Request(s,n)}}add({cacheName:e,request:t}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield this._caches.open(e)).add(t)}))}addAll(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{cacheName:t}=e[0],i=e.map((({request:e})=>e));return(yield this._caches.open(t)).addAll(i)}))}delete({request:e,cacheName:t},i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield this._caches.open(t)).delete(e,i)}))}keys(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield this._caches.open(e)).keys(t,i)}))}match({request:e,cacheName:t},i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield this._caches.open(t)).match(e,i)}))}matchAll({request:e,cacheName:t},i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield this._caches.open(t)).matchAll(e,i)}))}put({request:e,cacheName:t},i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield this._caches.open(t)).put(e,i)}))}clear(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._caches.delete(e)}))}_getFormatKey(e,t,i,n){try{return new URL(e),e}catch(o){let r="";switch(i){case"Experience":r=`${t}/${e}`;break;case"User":if(!this._tenantId||!this._userId)throw new Error("tenantId and userId must be defined for storage scope User.");r=`${this._tenantId}/${this._userId}/${e}`;break;case"Global":r=e;break;case"UserAndExperience":if(!this._tenantId||!this._userId)throw new Error("tenantId and userId must be defined for storage scope UserAndExperience.");r=`${this._tenantId}/${this._userId}/${this._experienceName}/${e}`;break;default:return`/${e}`}return n?`//${r}`:r}}}class Fl{constructor(e,t){this._cacheStorage=e,this._cacheName="offline-cache-manager",this._logger=t.newLogger("OfflineCacheManager","services-io-browser-cache-storage")}setUserAndTenantIds(e,t){this._cacheStorage.setUserAndTenantIds(e,t)}save(e,t,i,n=!0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!e)throw this._error("get","Invalid key");try{this._logger.log(`saving item to offline cache: ${e}`);const o=this._getScopedRequest(e,i,n);return yield this._cacheStorage.put(o,t),o.request.url}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name}, message${e.message}`),this._error("save","Failed to save object to cache")}}))}saveDynamic(e,t,i=!0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=(0,xe.v4)();return[n,yield this.save(n,e,t,i)]}))}get(e,t,i,n=!0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!e)throw this._error("get","Invalid key");try{const i=this._getScopedRequest(e,t,n),o=yield this._cacheStorage.match(i);if(!o)throw this._error("get","Object not found");return o}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name}, message${e.message}`),this._error("get","Failed to get item from cache")}}))}getAll(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield this._cacheStorage.keys(this._cacheName,e?this._getScopedRequest(e,t).request:void 0,i)}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name} code:${e.code}`),this._error("getAll","Failed to get keys from cache")}}))}delete(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!e)throw this._error("get","Invalid key");this._logger.log(`deleting item from offline cache: ${e}`);const i=this._getScopedRequest(e,t);return this._cacheStorage.delete(i)}))}clear(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._logger.log("clearing offline cache"),this._cacheStorage.clear(this._cacheName)}))}getCachedUrlByKey(e,t){return this._getScopedRequest(e,t).request.url}_error(e,t){const i=(0,se.Tr)("OfflineCacheManager",f.jK.Undefined,e,void 0,t);return this._logger.error(i.message),i}_getScopedRequest(e,t,i=!0){return this._cacheStorage.createRequest(this._cacheName,`${this._cacheName}/${e}`,"UserAndExperience",t,i)}}class Ol extends Ce.i{constructor(){super(f.Yg.CreateCacheStorageAndCacheManagers,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,windowProvider:i,config:n,loggerFactory:o}=e;t&&(e.cacheStorage=new Dl(i.caches,t.profile.tenantId,t.profile.objectId,n.experienceName)),e.cacheStorage&&(e.offlineCacheManager=new Fl(e.cacheStorage,o))}))}}var Ml=i(173962),Rl=i(845279);class Pl{constructor(e){this.context=e,this._appServiceStateMap=this._newAppServiceStateMap(),this._logger=e.loggerFactory.newLogger("CDLApplicationStateService","core-services-app-state")}notifyServiceUp(e,t,i){this.notifyAppServiceStateChange(e,t,Rl.l.ONLINE,i)}notifyServiceDown(e,t,i,n){this.notifyAppServiceStateChange(e,t,Rl.l.OFFLINE,i,n)}observeAppServiceState(){const e=Array.from(Object.values(this._appServiceStateMap)).map((e=>e.asObservable().pipe((0,pt.g)("currentState"))));return(0,Ml.T)(...e)}_newAppServiceStateMap(){return Object.values(Rl.Q).reduce(((e,t)=>{var i;return e[t]=(i=t,new r.X({appService:i,currentState:Rl.l.UNKNOWN})),e}),{})}notifyAppServiceStateChange(e,t,i,n,o){var r,s,a,l,c;if(!!this.context.coreSettings.get(b.J.CdlWorker).enableUserContextWorkerRegistration&&(null===(r=this.context.cdlWorkerRegistrarService)||void 0===r?void 0:r.mainWindowWorkerId)!==e.workerId)return void(null===(a=(s=this._logger).infoToTelemetry)||void 0===a||a.call(s,`Filtered out appService state changed from worker (originating worker = ${e.workerId}, main window worker id = ${this.context.cdlWorkerRegistrarService.mainWindowWorkerId})`,"cdl_app_state_notification_filtered_out",{origin:e.workerId,target:this.context.cdlWorkerRegistrarService.mainWindowWorkerId,context:t},!0));const d=this._appServiceStateMap[t],u={appService:t,previousState:d.getValue().currentState,currentState:i,currentStateChangeTimestamp:new Date,currentStateChangeReason:n,currentStateChangeCode:o};null===(c=(l=this._logger).infoToTelemetry)||void 0===c||c.call(l,`Received appService state change for ${t} (current state = ${u.currentState}, previous state = ${u.previousState}) from worker '${e.workerId}'`,"cdl_app_state_change_notification",{origin:e.workerId,target:this.context.cdlWorkerRegistrarService.mainWindowWorkerId,context:t},!0),d.next(u)}}class Ll{constructor(e){this.logger=e}log(e,t){return e?this.safeWrapILoggerCall(((e,t)=>this.logger.log(e,t)),e,t):X.V.None}warn(e,t){return e?this.safeWrapILoggerCall(((e,t)=>this.logger.warn(e,t)),e,t):X.V.None}debug(e,t){return this.safeWrapILoggerCall(((e,t)=>this.logger.debug(e,t)),e,t)}error(e,t,i){return e&&i?this.safeWrapILoggerCall(((e,t)=>this.logger.error(e,t)),e,t,i):X.V.None}errorToTelemetry(e,t,i,n){return this.logger.errorToTelemetry?this.logger.errorToTelemetry(e,t,i,n):this.logger.error(e)}warnToTelemetry(e,t,i,n){return this.logger.warnToTelemetry?this.logger.warnToTelemetry(e,t,i,n):this.logger.warn(e)}debugToTelemetry(e,t,i,n){return this.logger.debugToTelemetry?this.logger.debugToTelemetry(e,t,i,n):this.logger.debug(e)}infoToTelemetry(e,t,i,n){return this.logger.infoToTelemetry?this.logger.infoToTelemetry(e,t,i,n):this.logger.log(e)}safeWrapILoggerCall(e,t,i,n){return function(e){return(0,L.isObject)(e)&&"hostRendererId"in e&&"component"in e}(i)?e(this.serializeMessageFromParams(t,i,n),{loggerName:i.component}):e(t,{loggerName:"CDLNoLoggingContext"})}serializeMessageFromParams(e,t,i){const n=Object.assign(Object.assign(Object.assign(Object.assign({},i?{errorCode:i}:{}),t?{requestId:t.requestId,component:t.component,requestRendererId:t.requestRendererId,requestWindowId:t.requestWindowId,operationType:t.operationType,operationName:t.operationName,requestType:t.requestType,timeOfRequest:t.timeOfRequest,correlationId:t.correlationId,callerInfo:t.callerInfo,callerScenarioId:t.callerScenarioId}:{}),{message:e}),t);return JSON.stringify(n,void 0,"").replace(/\\|"/g,"")}}var Ul=i(46484),Wl=i(85015);class Bl{constructor(e,t){this.logger=e,this.loggingContext=t,this.isCompleted=!1,this.subscriptions=new Set,this.observable$=new Wl((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e){return this.isCompleted&&this.logger.error("Subject - tried to subscribe to a complete observable",this.loggingContext,f.jK.NotPresent),this.observable$.subscribe(e)}onNext(e){this.subscriptions.forEach((t=>{t.next(e)}))}onComplete(){this.isCompleted=!0,this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.isCompleted=!0,this.subscriptions.forEach((t=>{t.error(e)}))}}class $l{constructor(e){this._state=null,this._checkpoints=new Set,this._context={bootstrapServices:e.bootstrapServices,loggingContext:{hostRendererId:e.loggingContext.hostRendererId,component:"CDLGlobalState"}},this.subject=new Bl(e.bootstrapServices.logger,this._context.loggingContext)}get current(){return this._state}setState(e,t){if(!e)throw new TypeError("state should have name specified");this.hasReachedCheckpoint(e)||(this._context.bootstrapServices.logger.log(`Global state has reached checkpoint ${e}`,this._context.loggingContext),this._checkpoints.add(e),this._state=e,this.subject.onNext({newState:e,args:t}))}subscribe(e){return this.subject.subscribe(e)}hasReachedCheckpoint(e){if(!e)throw new TypeError("state should have name specified");return this._checkpoints.has(e)}}var Hl=i(587592),ql=i(194232);class zl{constructor(e,t,i,n){var o;this._context=n,this._clients=new Map,t.forEach(((t,o)=>{const r=new t((t=>e(t)),i,n,o);this._clients.set(o,r)})),null===(o=n.bootstrapServices.workerCacheManager)||void 0===o||o.saveWorkerStatusToCacheStorage({state:"Success",stepName:"ClientResponseRouterCreated"})}get cdlControlClient(){return this._clients.get(Hl.k.control)}get cdlDiagnosticsClient(){return this._clients.get(Hl.k.diagnostics)}get cdlAuthClient(){return this._clients.get(Hl.k.auth)}get cdlAppServiceClient(){return this._clients.get(Hl.k.appService)}get cdlAppStateClient(){return this._clients.get(Hl.k.appState)}get cdlDatabaseClient(){return this._clients.get(Hl.k.database)}get cdlSyncEngineClient(){return this._clients.get(Hl.k.syncEngine)}get cdlGraphQLClient(){return this._clients.get(Hl.k.graphql)}get cdlNetworkStateClient(){return this._clients.get(Hl.k.networkState)}get cdlEndpointsHealthClient(){return this._clients.get(Hl.k.endpointHealth)}get telemetryClient(){return this._clients.get(Hl.k.telemetry)}handleResponse(e){var t,i;const n=this._clients.get(e.type);if(!n)throw null===(i=(t=this._context.bootstrapServices.logger).errorToTelemetry)||void 0===i||i.call(t,`no client is configured for response type ${e.type}`,"cdl_client_no_client_configured_error",Object.assign(Object.assign({},(0,ql.n)(this._context.loggingContext)),{queryId:e.requestId,windowId:e.windowId,origin:"CDLClientResponseRouter",errorCode:f.jK.Unknown}),!0),new TypeError(`no client is configured for response type ${e.type}`);return n.handleResponse(e)}cleanup(){this._clients.forEach((e=>{Object.keys(e).forEach((t=>e[t]=void 0))})),Object.keys(this).forEach((e=>this[e]=void 0))}}class Vl{constructor(e,t,i,n){var o;this._bootstrapServices=e,this._stateAndRequestHandlers=n,this._globalState=i,this._context={component:"CDLServer",hostRendererId:t},this._bootstrapServices.logger.log("Booted up server",this._context),null===(o=this._bootstrapServices.workerCacheManager)||void 0===o||o.saveWorkerStatusToCacheStorage({state:"Success",stepName:"CDLServerCreated"})}handleRequest(e,t,i){const n=performance.now(),o=this._stateAndRequestHandlers.get(e.type);return o?o.stateMachine.isCompleted().then((r=>{const s=performance.now(),a={requestStartTime:n,stateMachineTime:s-n};return this._handleMessage(e,t,o.requestHandler,a,i,r).catch((t=>{var i,n;!!(0,se.Wc)(t)||null===(n=(i=this._bootstrapServices.logger).errorToTelemetry)||void 0===n||n.call(i,`Failed to process request due to error ${(0,se.VK)(t)}`,"cdl_server",Object.assign(Object.assign({},(0,ql.n)(this._context)),{origin:e.requestId,correlationId:e.rendererId,conversationId:e.windowId,type:e.type}),!0)}))})).catch((i=>this._returnCriticalError(e,t,`State machine init failed for request of type ${e.type} with error ${(0,se.VK)(i)}`,i))):this._returnCriticalError(e,t,`StateMachine and requestHandler not defined for request of type ${e.type}`)}start(){this._globalState.setState("Server_Start")}cleanup(){this._stateAndRequestHandlers.forEach((e=>{Object.keys(e).forEach((t=>e[t]=void 0))})),Object.keys(this).forEach((e=>this[e]=void 0))}_handleMessage(e,t,i,n,o,r){const s=this._decorateResponseCallback(e,t,n);return i.handle(e,s,{bootstrapServices:this._bootstrapServices,loggingContext:{hostRendererId:this._context.hostRendererId,requestId:e.requestId,requestRendererId:e.rendererId,requestWindowId:e.windowId,requestType:e.type},portId:o},r)}_decorateResponseCallback(e,t,i){return n=>{const o=performance.now()-i.requestStartTime,r=o-i.stateMachineTime;if(i=Object.assign(Object.assign({},i),{handlerResponseTime:r}),"graphql"===e.type){const i=n.response;i.extensions=Object.assign({},i.extensions),i.extensions.perfStats=Object.assign(Object.assign({},i.extensions.perfStats),{workerResponseTime:o,dataStorePerfStats:[]}),t(Object.assign({requestId:e.requestId,rendererId:e.rendererId,windowId:e.windowId,type:e.type,extensions:i.extensions},n))}else t(Object.assign(Object.assign(Object.assign({requestId:e.requestId,rendererId:e.rendererId,windowId:e.windowId,type:e.type},n),i),{extensions:{},workerResponseTime:o}))}}_returnCriticalError(e,t,i,n){return Promise.reject(t({windowId:e.windowId,requestId:e.requestId,type:e.type,response:{errors:i,errorCode:(null==n?void 0:n.errorCode)||(null==n?void 0:n.code),error:n},status:"failure",rendererId:e.rendererId,extensions:{},workerResponseTime:-1}))}}function Gl(e,t,i,n){var o,r;null===(o=e.workerCacheManager)||void 0===o||o.saveWorkerStatusToCacheStorage({state:"InProgress",stepName:"CDLPeerCreated"});const s=new zl((e=>t.postMessageCallback(JSON.stringify(e))),t.clients,{rendererId:n},{bootstrapServices:e,loggingContext:{hostRendererId:n}}),a=new Vl(e,n,i.globalState,i.requestAndStateHandlers);return null===(r=e.workerCacheManager)||void 0===r||r.saveWorkerStatusToCacheStorage({state:"Success",stepName:"CDLPeerCreated"}),{workerServer:a,workerClientResponseRouter:s,onMessageCallback:(t,i,o)=>{var r,l,c,d,u,m;const g=Date.now(),h=t.data&&JSON.parse(t.data);if(h&&h.rendererId===n){const e=null===(l=null===(r=h.response)||void 0===r?void 0:r.extensions)||void 0===l?void 0:l.perfStats;e&&(e.payloadLength=t.data.length),s.handleResponse(h)}else h&&h.status?null===(d=(c=e.logger).errorToTelemetry)||void 0===d||d.call(c,`Received response with rendererId mismatch ${JSON.stringify(t)}`,"cdl_peer_creation",{origin:"CDLPeer",correlationId:n},!0):h?a.handleRequest(h,(e=>(e=>{var t;const n=Date.now();if("graphql"===e.type){const i=e.response;(null===(t=i.extensions)||void 0===t?void 0:t.perfStats)&&(i.extensions.perfStats.requestReceivedTime=g,i.extensions.perfStats.responseSendTime=n),e.extensions.perfStats&&(e.extensions.perfStats.requestReceivedTime=g,e.extensions.perfStats.responseSendTime=n)}else e.requestReceivedTime=g,e.responseSendTime=n;i(JSON.stringify(e))})(e)),o):null===(m=(u=e.logger).errorToTelemetry)||void 0===m||m.call(u,`Unknown message received that doesn't conform to CDL format ${JSON.stringify(t)}`,"cdl_peer_creation",{origin:"CDLPeer",correlationId:n},!0)}}}var Jl=i(507829);class Kl{constructor(){this.isSubscriptionRequest=e=>e instanceof Bl,this._rendererRequestMap=new Map}addRequest(e,t){if(!e.rendererId)throw new TypeError("No rendererId in request");if(!e.requestId)throw new TypeError("No requestId in request");const i=this.getRequestRegistrationKey(e);let n=this._rendererRequestMap.get(i);if(n||(n=new Map,this._rendererRequestMap.set(i,n)),n.has(e.requestId))throw new Error(`Request ${e.requestId} for renderer ${i} already exists, something is off here`);if(t&&this.isSubscriptionRequest(t))return n.set(e.requestId,{resolution:t,request:e}),Promise.resolve(void 0);const o=(0,Jl.P)();return n.set(e.requestId,{resolution:o,request:e}),o.promise}reconcileResponse(e){if(!e.rendererId)throw new TypeError("No rendererId in response");if(!e.requestId)throw new TypeError("No requestId in response");const t=this.getRequestRegistrationKey(e);if(!this._rendererRequestMap.has(t))throw new Error(`Response ${t} is not found in map`);const i=this._rendererRequestMap.get(t);if(!i)throw new Error(`Request map for renderer/window ${t} does not exist`);const n=i.get(e.requestId);if(!n)throw new Error(`Request ${e.requestId} for renderer/window ${t} does not exist`);"success"===e.status?this.handleSuccessResponse(e,n):this.handleErrorResponse(e,n),this.isSubscriptionRequest(n.resolution)&&"failure"!==e.status||i.delete(e.requestId),0===i.size&&this._rendererRequestMap.delete(t)}handleSuccessResponse(e,t){this.isSubscriptionRequest(t.resolution)?t.resolution.onNext(e):t.resolution.resolve(e)}handleErrorResponse(e,t){this.isSubscriptionRequest(t.resolution)?t.resolution.onError(e):t.resolution.reject(e)}getRequestRegistrationKey(e){return`${e.rendererId}${e.windowId?`_${e.windowId}`:""}`}}class Ql{constructor(e){this.requestType=e,this.counter=0}toString(){return`${this.getOperationPrefix(this.currentCounterRequestType)||this.requestType}-${this.counter}`}next(e){return this.safeIncrementCounter(),this.currentCounterRequestType=e,this.toString()}getOperationPrefix(e){switch(e){case"mutation":return"m";case"subscription":return"s";case"query":return"q";default:return e}}safeIncrementCounter(){return this.counter===Ql.MAX_COUNTER_VALUE&&(this.counter=0),this.counter++}}Ql.MAX_COUNTER_VALUE=Number.MAX_SAFE_INTEGER;class Yl{constructor(e,{rendererId:t,windowId:i},n,o){this._context=n,this._loggingContext={component:"CDLClient",hostRendererId:t,requestWindowId:i},this._rendererId=t,this._windowId=i,this._clientRequestType=o,this._postMessage=t=>e(t),this._requestRegistrar=new Kl,this.requestId=new Ql(o)}sendRequest(e,t){const i={rendererId:this._rendererId,windowId:this._windowId,requestId:this.requestId.next(),type:this._clientRequestType,payload:e},n=this._requestRegistrar.addRequest(i,t);return this._postMessage(i),n}handleResponse(e){return new Promise(((t,i)=>{var n,o;try{this._requestRegistrar.reconcileResponse(e),t()}catch(t){null===(o=(n=this._context.bootstrapServices.logger).errorToTelemetry)||void 0===o||o.call(n,`Error occurred on reconciling response ${t}`,"cdl_client_response_error",Object.assign(Object.assign({},(0,ql.n)(this._loggingContext)),{correlationId:e.requestId,windowId:e.windowId,errorCode:f.jK.Unknown}),!0),i(t)}}))}}const Xl="MainRenderer",Zl="GQL_STOP";class ec extends Yl{constructor(e,{rendererId:t,windowId:i},n,o){super(e,{rendererId:t,windowId:i},n,o)}sendFilteredAppStateRequest(e){const t=e.context.appState;return this._rendererId===Xl&&(e.context.appState=this.filterWorkerAppState(t)),super.sendRequest(e)}filterWorkerAppState(e){return e}}class tc{constructor(){this.onResponseReceived=e=>{if(this.onMessage){const t=this.transformLegacyClientFields(e.payload.dataLayer);this.onMessage(t)}}}transformLegacyClientFields(e){return e.error&&(e.errors=e.error),e.extensions||(e.extensions={}),e.perfStats&&(e.extensions.perfStats=e.perfStats),e}}class ic extends tc{constructor(e,{rendererId:t,windowId:i},n,o){super(),this._context=n,this._loggingContext={hostRendererId:t,component:"CDLClient",requestWindowId:i},this.sendMessage=t=>e({requestId:t.requestId,rendererId:t.rendererId,windowId:t.windowId,payload:t.request,operationName:t.operationName,type:o,cdlOperationCustomContext:t.cdlOperationCustomContext})}handleResponse(e){var t;return this._context.bootstrapServices.logger.debug("Received message",Object.assign(Object.assign({},this._loggingContext),{requestId:e.requestId,requestRendererId:e.rendererId,requestWindowId:e.windowId})),Promise.resolve(this.onResponseReceived({payload:{dataLayer:{rendererId:e.rendererId,requestId:e.requestId,windowId:e.windowId,data:e.response.data,errors:e.response.errors?e.response.errors:void 0,errorCode:null===(t=e.response)||void 0===t?void 0:t.errorCode,extensions:e.response.extensions}}}))}}class nc{constructor(e,t,i,n,o){var r;this.stateMachineName=o,this.completionAwaiter=(0,Jl.P)(),this.completedStates=[],this.bootstrapContext=Object.assign(Object.assign({},n),{loggingContext:Object.assign(Object.assign({},n.loggingContext),{component:"CDLStateMachine"})}),this.actionStateMap=t,this.globalState=e,this._currentState=e.current,null===(r=this.workerStartupTelemetryService)||void 0===r||r.onStart(this.stateMachineName),this.completedStates.push(i),this.globalState.hasReachedCheckpoint(i)?this.transitionToNextState(i):this.subscribeToGlobalState()}isCompleted(){return this.completionAwaiter.promise}hasCompletedState(e){return-1!==this.completedStates.indexOf(e)}get currentState(){return this._currentState}errorStateMachine(e){var t,i,n,o;this.unsubscribeStateTransition&&this.unsubscribeStateTransition.unsubscribe(),this.completionAwaiter.reject(e),"coreGraphql"===this.stateMachineName&&(null===(t=this.bootstrapContext.bootstrapServices.workerCacheManager)||void 0===t||t.saveWorkerStatusToCacheStorage({error:JSON.stringify(e),state:"Failure",stepName:`${this.currentState}::Fail`})),e&&e.code===f.jK.Disabled?this.bootstrapContext.bootstrapServices.logger.log(e.message,this.bootstrapContext.loggingContext):null===(n=(i=this.bootstrapContext.bootstrapServices.logger).errorToTelemetry)||void 0===n||n.call(i,`State machine is erroring out: ${(0,se.VK)(e)}`,"cdl_state_managers",Object.assign({},(0,ql.n)(this.bootstrapContext.loggingContext)),!0),null===(o=this.workerStartupTelemetryService)||void 0===o||o.onFail(this.stateMachineName,e)}completeStateMachine(e){var t;this.unsubscribeStateTransition&&this.unsubscribeStateTransition.unsubscribe(),this.completionAwaiter.resolve(e),this.bootstrapContext.bootstrapServices.logger.log("State machine is reaching completion",this.bootstrapContext.loggingContext),null===(t=this.workerStartupTelemetryService)||void 0===t||t.onComplete(this.stateMachineName)}execute(e,t,i){var n;null===(n=this.workerStartupTelemetryService)||void 0===n||n.onStepStart(this.stateMachineName,e);const o=e,r=this.actionStateMap.get(o);if(!r)return this.bootstrapContext.bootstrapServices.logger.log(`State machine is transitioning from ${this.currentState} to ${e}, skipping action invoke as none is defined`,this.bootstrapContext.loggingContext),this.emitState(e,i);this.bootstrapContext.bootstrapServices.logger.log(`State machine is invoking action for transition state ${this.currentState} to ${e}`,this.bootstrapContext.loggingContext),r.action(t,i).then((t=>{var i;this.bootstrapContext.bootstrapServices.logger.log(`State machine is transitioning from ${this.currentState} to ${e}`,this.bootstrapContext.loggingContext),r.eventData&&(null===(i=this.workerStartupTelemetryService)||void 0===i||i.appendEventData(this.stateMachineName,r.eventData)),this.emitState(e,t)})).catch((e=>{this.errorStateMachine(e)}))}transitionToNextState(e,t){this._currentState=e,this.completedStates.push(e),this.transitionState(e,t)}subscribeToGlobalState(){this.unsubscribeStateTransition=this.globalState.subscribe({next:e=>{const{newState:t,args:i}=e;this.transitionToNextState(t,i)}})}emitState(e,t){this.globalState.hasReachedCheckpoint(e)?this.transitionToNextState(e,t):(this.unsubscribeStateTransition||this.subscribeToGlobalState(),this.globalState.setState(e,t))}get workerStartupTelemetryService(){return this.bootstrapContext.bootstrapServices.workerStartupTelemetryService}}class oc extends nc{transitionState(e,t){switch(e){case"authLoaded":this.execute("authServiceInjected",t,void 0);break;case"authServiceInjected":this.completeStateMachine(!0)}}}class rc extends nc{transitionState(e,t){switch(e){case"appService:Loaded":this.execute("appService:Injected",t,void 0);break;case"appService:Injected":this.completeStateMachine(!0)}}}class sc{constructor(e){this._componentName=e,this._handlerMap=new Map}addHandlers(e){e.forEach((e=>{this._handlerMap.set(e.requestType,e.handlerFunc)}))}handle(e,t,i,...n){const o=e.payload;return new Promise(((e,r)=>{var s,a;const l=this._handlerMap.get(o.requestOperationtype);if(!l){null===(a=(s=i.bootstrapServices.logger).errorToTelemetry)||void 0===a||a.call(s,`No handler found for request type ${o.requestOperationtype}`,"cdl_request_handler_no_handler_error",Object.assign({origin:this._componentName,errorCode:f.jK.NotImplemented},(0,ql.n)(i.loggingContext)),!0);const e={response:{statusMsg:`Unknown request type: ${o.requestOperationtype}`,data:void 0},status:"failure"};return t(e),r(e)}l(o,i,...n,t).then((i=>e(sc.callResponseCallback(t,i,"success")))).catch((e=>{const i={response:e,status:"failure"};return t(i),r(i)}))}))}static callResponseCallback(e,t,i){e({response:t,status:i})}static onHandlerError(e,t,i,n,o,r=!1){var s,a;r?null===(a=(s=e.bootstrapServices.logger).errorToTelemetry)||void 0===a||a.call(s,i,"cdl_request_handler_on_error",Object.assign({origin:o,errorCode:t},(0,ql.n)(e.loggingContext)),!0):e.bootstrapServices.logger.error(i,Object.assign({component:o},e.loggingContext),t);const l={statusMsg:n,data:void 0};return Promise.reject(l)}}var ac,lc,cc,dc;!function(e){e.AadGetToken="aadGetToken",e.AadGetCurrentUser="aadCurrentUser",e.AadClearCache="aadClearCache",e.StartupApiToken="startupApiToken",e.GetSkypeTokens="getSkypeTokens",e.GetUserDetails="getUserDetails",e.SubscribeToAuthState="subscribeToAuthState"}(ac||(ac={}));class uc{constructor(e){this._requestUtility=new sc("CDLAuthHandler");let t=[];t=e===Xl?[{requestType:ac.AadGetToken,handlerFunc:uc.getAadTokensAngular},{requestType:ac.AadGetCurrentUser,handlerFunc:uc.getUserInformationAngular},{requestType:ac.GetSkypeTokens,handlerFunc:uc.getSkypeTokensAngular},{requestType:ac.GetUserDetails,handlerFunc:uc.getUserDetailsAngular},{requestType:ac.SubscribeToAuthState,handlerFunc:uc.subscribeToAuthState}]:[{requestType:ac.AadGetToken,handlerFunc:uc.getAadTokens},{requestType:ac.AadGetCurrentUser,handlerFunc:uc.getUserInformation},{requestType:ac.GetSkypeTokens,handlerFunc:uc.getSkypeTokens},{requestType:ac.GetUserDetails,handlerFunc:uc.getUserDetails},{requestType:ac.SubscribeToAuthState,handlerFunc:uc.subscribeToAuthState}],this._requestUtility.addHandlers(t)}injectDependentServices(e){return new Promise((t=>{if(!e)throw new TypeError("Cannot injectDependentServices of undefined");if("function"==typeof e.getAuthTokens&&(e={authenticationService:e,discover:void 0}),!e.authenticationService)throw new TypeError("Cannot inject authentication service that is not defined");if(this._authenticationService)throw new TypeError("injectDependentServices has been called again, even though it's already initialized");return this._authenticationService=e.authenticationService,this._discover||(this._discover=e.discover),this._authStateProvider||(this._authStateProvider=e.authStateProvider),t()}))}handle(e,t,i){return this._requestUtility.handle(e,t,i,this._authenticationService,this._discover,this._authStateProvider)}static convertAngularPromise(e){return new Promise(((t,i)=>{e.then((e=>t(e))).catch((e=>i(e)))}))}static handleAuthResult(e,t,i){const n=t.bootstrapServices.newScenario(U.RG.AuthHandlerRequest);n.appendEventData({operation:i}),n.mark("handle_auth_result_start");const o=performance.now();return e.then((e=>{if(null==e){n.mark("handle_auth_result_returns_undefined_or_null",{arrivalTime:performance.now()-o});const e="response payload is empty";throw n.fail({message:e,commandSource:i}),new Error(e)}n.mark("handle_auth_result_returns_defined_value",{arrivalTime:performance.now()-o});const t={statusMsg:`${i} request in main renderer has been processed`,data:e};return n.stop({message:t.statusMsg,commandSource:i}),t})).catch((e=>{n.mark("handle_auth_result_error_caught");const o=uc.getErrorMessage(i,e),r=!!(0,se.Wc)(e);sc.onHandlerError(t,f.jK.UnhandledPromiseRejection,"the auth handler has exception",o,"CDLAuthHandler",!r&&"response payload is empty"!==(null==e?void 0:e.message)),e.isExpected?n.incomplete({message:o,commandSource:i}):n.fail({message:o,commandSource:i});try{"string"==typeof e&&(e=new Error(e)),e.reason||(e.reason={}),e.reason.cdlClient="auth"}catch(i){t.bootstrapServices.logger.warn(`Failed to handle auth error. Original error: ${(0,se.VK)(e)}. Handling error: ${(0,se.VK)(i)}`,Object.assign({component:"CDLAuthHandler"},t.loggingContext))}throw e}))}static getAadTokensAngular(e,t,i){var n;const o=e.context.resource,r=e.context.options;return uc.logStartHandle(e,t,o),uc.handleAuthResult(uc.convertAngularPromise(i.getAuthToken(o,null==r?void 0:r.claim,null==r?void 0:r.silent,null===(n=e.context)||void 0===n?void 0:n.forceRenew)).then((e=>{if(!e)return;return{token:e.token,expires:e.expiration,tokenType:e.tokenType,fromCache:!1}})),t,ac.AadGetToken)}static getAadTokens(e,t,i){const{resource:n,options:o}=e.context;let r;return uc.logStartHandle(e,t,n),r=i.acquireTokenV2?i.acquireTokenV2(n,o):i.acquireToken(n,o).then((e=>({token:e}))),uc.handleAuthResult(r,t,ac.AadGetToken)}static getUserInformationAngular(e,t,i){return uc.logStartHandle(e,t),uc.handleAuthResult(uc.convertAngularPromise(i.getUserInformation()),t,ac.AadGetCurrentUser)}static getUserDetailsAngular(e,t,i){return uc.logStartHandle(e,t),uc.handleAuthResult(uc.convertAngularPromise(i.getUserDetails()),t,ac.GetUserDetails)}static getUserDetails(e,t,i,n){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){uc.logStartHandle(e,t);const i=yield n.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:!!(null===(r=e.context)||void 0===r?void 0:r.forceRenew)}),o=i?{userDetails:i.userDetails,id:i.userDetails.id}:void 0;return uc.handleAuthResult(Promise.resolve(o),t,ac.GetUserDetails)}))}static subscribeToAuthState(e,t,i,n,r,s){var a;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!r){t.bootstrapServices.logger.log("Auth-Handler - auth state provider not provided. Not subscribing.",Object.assign({component:"CDLAuthHandler"},t.loggingContext));const e=(0,se.Tr)("AuthStateProvider not provided - This will should be an error in the RWC experience",f.jK.MissingParameter,"Auth-Handler");return Promise.reject(e)}const e=r.observe().subscribe((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield uc.handleAuthResult(Promise.resolve(null==e?void 0:e.state),t,ac.SubscribeToAuthState);sc.callResponseCallback(s,i,"success")}))),(e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){sc.callResponseCallback(s,{statusMsg:uc.getErrorMessage(ac.SubscribeToAuthState,e),data:e},"failure")}))),(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){e.unsubscribe(),sc.callResponseCallback(s,{statusMsg:"AuthStateProvider Completed",data:void 0},"failure")}))));return uc.handleAuthResult(Promise.resolve(null===(a=r.getState())||void 0===a?void 0:a.state),t,ac.SubscribeToAuthState)}))}static getSkypeTokensAngular(e,t,i){var n;uc.logStartHandle(e,t);const o=i.getSkypeTokens(!!(null===(n=e.context)||void 0===n?void 0:n.forceRenew)).then((e=>{if(!e)return;return{expiration:e.tokenExpiration||0,skypeToken:e.skypeToken,userDetails:e.userDetails,regionGtms:e.regionGtms}}));return uc.handleAuthResult(o,t,ac.GetSkypeTokens)}static getSkypeTokens(e,t,i,n){var o;return uc.logStartHandle(e,t),uc.handleAuthResult(n.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:!!(null===(o=e.context)||void 0===o?void 0:o.forceRenew)}),t,ac.GetSkypeTokens)}static getUserInformation(e,t,i){return uc.logStartHandle(e,t),uc.handleAuthResult(i.getUser({correlation:{source:"AuthHandlerRequest",id:"na",scenarioName:"CentralDataLayerBootstrapAuthGetUser"}}),t,ac.AadGetCurrentUser)}static logStartHandle(e,t,i){const n=i?` for resource ${i}`:"";t.bootstrapServices.logger.log(`Auth handler started serving request ${e.requestOperationtype}${n}`,Object.assign({component:"CDLAuthHandler"},t.loggingContext))}}uc.getErrorMessage=(e,t)=>`the request type for ${e} failed due to ${(0,se.VK)(t)}`,function(e){e.MachineActive="MachineActive",e.MachineInactive="MachineInactive",e.MachineLongInactive="MachineLongInactive",e.MachineLocked="MachineLocked"}(lc||(lc={})),function(e){e.NotifyAppState="NotifyAppState",e.NotifyTokenRefresh="NotifyTokenRefresh",e.NotifyCoreClientState="NotifyCoreClientState",e.NotifyCoreMachineState="NotifyCoreMachineState",e.NotifyCoreSuspendedState="NotifyCoreSuspendedState",e.NotifyCoreMachineIdleState="NotifyCoreMachineIdleState",e.NotifyServiceUp="NotifyServiceUp",e.NotifyServiceDown="NotifyServiceDown"}(cc||(cc={})),function(e){e[e.ChatSync=0]="ChatSync",e[e.Presence=1]="Presence",e[e.Files=2]="Files",e[e.OneNote=3]="OneNote",e[e.Groups=4]="Groups",e[e.Video=5]="Video",e[e.MasterTab=6]="MasterTab",e[e.IndexDb=7]="IndexDb",e[e.AdalTokens=8]="AdalTokens",e[e.AdalLogin=9]="AdalLogin",e[e.AdalReauth=10]="AdalReauth",e[e.SkypeTokens=11]="SkypeTokens",e[e.SkypeLicense=12]="SkypeLicense",e[e.SupportedBrowser=13]="SupportedBrowser",e[e.MSAGuestLicense=14]="MSAGuestLicense",e[e.AppSession=15]="AppSession",e[e.CSAStartup=16]="CSAStartup"}(dc||(dc={}));class mc{constructor(e,t){this.workerId=t,this._requestUtility=new sc("CDLAppServiceHandler");let i=[];i=e===Xl?[{requestType:cc.NotifyServiceUp,handlerFunc:mc.notifyServiceUpAngular},{requestType:cc.NotifyServiceDown,handlerFunc:mc.notifyServiceDownAngular}]:[{requestType:cc.NotifyServiceUp,handlerFunc:mc.notifyServiceUp},{requestType:cc.NotifyServiceDown,handlerFunc:mc.notifyServiceDown}],this._requestUtility.addHandlers(i)}injectAppState(e){return new Promise((t=>{if(this.appService)throw new TypeError("injectAppStateService has been called again, even though it's already initialized");return this.appService=e,t()}))}handle(e,t,i){return this._requestUtility.handle(e,t,i,this.appService,this.workerId)}static notifyServiceUp(e,t,i,n){return new Promise((o=>{t.bootstrapServices.logger.log(`App service change is received (worker ${n}), ${e.context.appService} is up and running`,Object.assign({component:"CDLAppStateHandler"},t.loggingContext));const{appService:r,reason:s}=e.context,a={workerId:n};return i.notifyServiceUp(a,r,s),o()}))}static notifyServiceUpAngular(e,t,i){return new Promise((n=>{t.bootstrapServices.logger.log(`App service change is received, ${e.context.appService} is up and running. Notifying Angular.`,Object.assign({component:"CDLAppStateHandler"},t.loggingContext));const{appService:o,reason:r}=e.context,s=dc[o];return i.notifyServiceUp(s,r),n()}))}static notifyServiceDown(e,t,i,n){return new Promise((o=>{t.bootstrapServices.logger.log(`App service change is received (worker ${n}), ${e.context.appService} is down`,Object.assign({component:"CDLAppStateHandler"},t.loggingContext));const{appService:r,reason:s,code:a}=e.context,l={workerId:n};return i.notifyServiceDown(l,r,s,a),o()}))}static notifyServiceDownAngular(e,t,i){return new Promise((n=>{t.bootstrapServices.logger.log(`Angular app service change is received, ${e.context.appService} is down. Notifying Angular.`,Object.assign({component:"CDLAppStateHandler"},t.loggingContext));const{appService:o,reason:r,code:s}=e.context,a=dc[o];return i.notifyServiceDown(a,r,s),n()}))}}class gc{constructor(e){this.workerId=e}handle(e,t,i){return new Promise((n=>{var o;i.bootstrapServices.logger.log(`Network state received from CDL worker ${this.workerId}. Network state: ${e.payload.networkState}`,Object.assign({component:"NetworkStateHandler"},i.loggingContext)),null===(o=this.networkStateChangeHandler)||void 0===o||o.next(e.payload.networkState);n(t({response:{statusMsg:"Network state received success.",data:void 0},status:"success"}))}))}injectNetworkStateTracker(e){return new Promise((t=>{if(this.networkStateChangeHandler)throw new TypeError("injectNetworkStateTracker has been called again, even though it's already initialized");return this.networkStateChangeHandler=e,t()}))}}class hc extends nc{transitionState(e,t){switch(e){case"networkState:Loaded":this.execute("networkState:Injected",t,void 0);break;case"networkState:Injected":this.completeStateMachine(!0)}}}class pc{constructor(){this._componentName="EndpointsHealthMessageHandler"}handle(e,t,i){return new Promise((n=>{var o,r;(!e.payload||void 0===e.payload.healthState&&void 0===e.payload.endpointHealth)&&(this.log("Endpoints health message received from CDL. Payload is empty.",i),n(t(this.getSuccessMessage()))),e.payload.endpointHealth&&(this.log(`Endpoints health message received from CDL. Update: ${JSON.stringify(e.payload.endpointHealth)}.`,i),null===(o=this.endpointsHealthUpdateHandler)||void 0===o||o.handleEndpointHealthUpdate(e.payload.endpointHealth),n(t(this.getSuccessMessage()))),e.payload.healthState&&(this.log("Endpoints state dump message received from CDL.",i),null===(r=this.endpointsHealthUpdateHandler)||void 0===r||r.handleStateDump(e.payload.healthState),n(t(this.getSuccessMessage())))}))}injectEndpointsHealthUpdateHandler(e){return new Promise((t=>{if(this.endpointsHealthUpdateHandler)throw new TypeError("injectEndpointsHealthUpdateHandler has been called again, even though endpointsHealthUpdateHandler is already initialized");return this.endpointsHealthUpdateHandler=e,t()}))}log(e,t){t.bootstrapServices.logger.log(e,Object.assign({component:this._componentName},t.loggingContext))}getSuccessMessage(){return{response:{statusMsg:"Endpoints health received success.",data:void 0},status:"success"}}}class vc extends nc{transitionState(e,t){switch(e){case"endpointsHealthUpdateHandler:Loaded":this.execute("endpointsHealthUpdateHandler:Injected",t,void 0);break;case"endpointsHealthUpdateHandler:Injected":this.completeStateMachine(!0)}}}function yc(e,t,i,n){const{authStateMachine:o,authHandler:r}=fc(e,t,n),{appServiceStateMachine:s,appServiceMessageHandler:a}=Sc(e,t,n,i),{networkStateHandlerStateMachine:l,networkStateHandler:c}=kc(e,t,n,i),{endpointsHealthHandlerStateMachine:d,endpointsHealthHandler:u}=bc(e,t,n);return new Map([[Hl.k.auth,{stateMachine:o,requestHandler:r}],[Hl.k.appService,{stateMachine:s,requestHandler:a}],[Hl.k.networkState,{stateMachine:l,requestHandler:c}],[Hl.k.endpointHealth,{stateMachine:d,requestHandler:u}]])}const fc=(e,t,i)=>{const n=new uc(t),o={action:n.injectDependentServices.bind(n)},r=new Map;r.set("authServiceInjected",o);return{authHandler:n,authStateMachine:new oc(i,r,"authLoaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:"auth",component:"CreateWorkerStateAndRequestHandlers"}},"auth")}},Sc=(e,t,i,n)=>{const o=new mc(t,n),r={action:o.injectAppState.bind(o)},s=new Map;s.set("appService:Injected",r);return{appServiceMessageHandler:o,appServiceStateMachine:new rc(i,s,"appService:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:"appService",component:"CreateWorkerStateAndRequestHandlers"}},"appService")}},kc=(e,t,i,n)=>{const o=new gc(n),r={action:o.injectNetworkStateTracker.bind(o)},s=new Map;s.set("networkState:Injected",r);return{networkStateHandler:o,networkStateHandlerStateMachine:new hc(i,s,"networkState:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:Hl.k.networkState,component:"CreateWorkerStateAndRequestHandlers"}},"networkState")}},bc=(e,t,i)=>{const n=new pc,o={action:n.injectEndpointsHealthUpdateHandler.bind(n)},r=new Map;r.set("endpointsHealthUpdateHandler:Injected",o);return{endpointsHealthHandler:n,endpointsHealthHandlerStateMachine:new vc(i,r,"endpointsHealthUpdateHandler:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:Hl.k.endpointHealth,component:"CreateWorkerStateAndRequestHandlers"}},"endpointsHealth")}};var wc=i(523998),Cc=i(781388);const _c=-1,Tc=e=>({loaded:e.hasReachedCheckpoint("loaded")?1:0,healthCheck:e.hasReachedCheckpoint("health_checked")?1:0,syncEngine:e.hasReachedCheckpoint("syncEngine:Initialized")?1:e.hasReachedCheckpoint("syncEngine:FailedToInitialize")?2:0,authLoaded:e.hasReachedCheckpoint("authLoaded")?1:0}),Ic=e=>{const t=Tc(e);return`LD${t.loaded}:HC${t.healthCheck}:SE${t.syncEngine}:AL${t.authLoaded}`},jc=e=>{const t=Tc(e);return{"WorkerStartupState.Loaded":1===t.loaded,"WorkerStartupState.HealthCheck":1===t.healthCheck,"WorkerStartupState.SyncEngine":t.syncEngine,"WorkerStartupState.AuthLoaded":1===t.authLoaded}},Nc=(e,t)=>{if(e.hasOwnProperty("code")){const t=e;if(t.code!==f.jK.Unknown)return t.code}return t.hasReachedCheckpoint("loaded")?t.hasReachedCheckpoint("syncEngine:FailedToInitialize")?f.jK.NotInitialized:t.hasReachedCheckpoint("health_checked")&&t.hasReachedCheckpoint("syncEngine:Initialized")?f.jK.UnhandledRuntimeException:f.jK.TimedOut:f.jK.ScriptLoadError},Ec=e=>e&&e.message&&e.message.includes("AsyncIterableObserver buffer is full")?"AsyncIterableBufferOverflow":"Unknown",xc=120*xa.gT.MILLI_PER_SECOND,Ac="CDLWorkerManager",Dc="default";function Fc(e,t,i,n,o,r,s,a,l,c,d,u,m){var g,h;let p;const v=function(){const e=new Map;return e.set(Hl.k.appState,ec),e.set(Hl.k.control,Yl),e.set(Hl.k.database,Yl),e.set(Hl.k.diagnostics,Yl),e.set(Hl.k.endpointHealth,Yl),e.set(Hl.k.graphql,ic),e.set(Hl.k.networkState,Yl),e.set(Hl.k.syncEngine,Yl),e.set(Hl.k.supportedResolvers,Yl),e.set(Hl.k.telemetry,Yl),e}();return null===(g=e.workerCacheManager)||void 0===g||g.saveWorkerStatusToCacheStorage({state:"InProgress",stepName:"CreateCDLWorker"}),void 0!==(null==c?void 0:c.telemetryWorkerBroadcast)&&(null===(h=null==u?void 0:u.localStorage)||void 0===h||h.setItem("tmp.telemetryBroadcastEnabledCache",c.telemetryWorkerBroadcast.toString())),p=i?function(e,t,i,n,o,r,s,a,l,c,d,u,m,g){var h,p;if(l){(0,Ul.Hq)(e.logger,l,!0,e.hostRendererId,Ac);const c=null===(p=null===(h=null==m?void 0:m.loader)||void 0===h?void 0:h.getSharedWorker)||void 0===p?void 0:p.call(h),v=c||new SharedWorker(l);return Oc(e,n,o,a,t,i,(e=>v.port.postMessage(e)),(e=>{v.port.onmessage=t=>e(t,(e=>v.port.postMessage(e)))}),(e=>{v.onerror=t=>e(t)}),"shared-worker",r,s,u,g,null==d?void 0:d.workerId)}const v=(0,Ul.p4)(null==d?void 0:d.experienceName,null==d?void 0:d.ring,null==d?void 0:d.environment,null==d?void 0:d.sessionId,null==d?void 0:d.platformId,null==d?void 0:d.buildVersion,null==d?void 0:d.localeCode,null==d?void 0:d.workerId,void 0,null==d?void 0:d.preECSConsoleLogLevel,null==d?void 0:d.userConsoleLogLevel,null==d?void 0:d.publicPath,void 0,null==d?void 0:d.telemetryWorkerBroadcast),y=SharedWorker;SharedWorker=(0,Ul.JB)(y,e.logger,Ac,v,c);const f=new wc.Z;return SharedWorker=y,Oc(e,n,o,a,t,i,(e=>f.port.postMessage(e)),(e=>{f.port.onmessage=t=>e(t,(e=>f.port.postMessage(e)))}),(e=>{f.onerror=t=>e(t)}),"shared-worker",r,s,u,g,null==d?void 0:d.workerId)}(e,t,v,n,o,r,s,a,l&&l.cdlSharedWorkerUrl,(e=>{l&&(l.cdlSharedWorkerUrl=e)}),c,d,u,m):function(e,t,i,n,o,r,s,a,l,c,d,u,m,g){var h,p;if(l){(0,Ul.Hq)(e.logger,l,!0,e.hostRendererId,Ac);const c=null===(p=null===(h=null==m?void 0:m.loader)||void 0===h?void 0:h.getWorker)||void 0===p?void 0:p.call(h),v=c||new Worker(l);return Oc(e,n,o,a,t,i,(e=>v.postMessage(e)),(e=>{v.onmessage=t=>e(t,(e=>v.postMessage(e)))}),(e=>{v.onerror=t=>e(t)}),"web-worker",r,s,u,g,null==d?void 0:d.workerId)}const v=(0,Ul.p4)(null==d?void 0:d.experienceName,null==d?void 0:d.ring,null==d?void 0:d.environment,null==d?void 0:d.sessionId,null==d?void 0:d.platformId,null==d?void 0:d.buildVersion,null==d?void 0:d.localeCode,null==d?void 0:d.workerId,null==d?void 0:d.preAuthUserId,null==d?void 0:d.preECSConsoleLogLevel,null==d?void 0:d.userConsoleLogLevel,null==d?void 0:d.publicPath,null==d?void 0:d.deviceId,null==d?void 0:d.telemetryWorkerBroadcast),y=Worker;Worker=(0,Ul.JB)(y,e.logger,Ac,v,c);const f=new Cc.Z;return Worker=y,Oc(e,n,o,a,t,i,(e=>f.postMessage(e)),(e=>{f.onmessage=t=>e(t,(e=>f.postMessage(e)))}),(e=>{f.onerror=t=>e(t)}),"web-worker",r,s,u,g,null==d?void 0:d.workerId)}(e,t,v,n,o,r,s,a,l&&l.cdlWebWorkerUrl,(e=>{l&&(l.cdlWebWorkerUrl=e)}),c,d,u,m),p}function Oc(e,t,i,n,r,s,a,l,c,d,u,m,g,h,p=Dc){return new Promise(((v,y)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const f={hostRendererId:r,component:"CDLWorker"},S=new $l({bootstrapServices:e,loggingContext:f});S.setState("bootstrapped"),null==g||g.mark(U.ck.CdlWorkerBootstrapped);const k=Gl(e,{postMessageCallback:e=>a(e),clients:s},{globalState:S,requestAndStateHandlers:yc(e,r,p,S)},r);k.workerServer.start(),l(((e,t)=>k.onMessageCallback(e,t,_c))),c((t=>{y(Mc(t,e,f,"workerOnError",m,b.state))}));const b={workerServer:k.workerServer,workerClientResponseRouter:k.workerClientResponseRouter,state:S,workerType:d,syncEngineInitializationPromise:u};b.state.setState("loaded");try{yield function(e,t,i,n,r){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=t.workerClientResponseRouter.cdlControlClient.sendRequest({type:"health_check",bootstrapData:n,initiatorExperience:i});let s;s=r?(yield o).response:(yield(0,W.E)(o,e)).response,t.cdlWorkerSessionId=s.cdlWorkerSessionId,t.cdlWorkerSupportedResolvers=s.cdlWorkerSupportedResolvers,t.state.setState("health_checked")}))}(t||xc,b,i,n,h)}catch(t){y(Mc(t,e,f,"healthCheckException",m,b.state))}v(b)}))))}function Mc(e,{logger:t,workerCacheManager:i},n,o,r,s){const a=Nc(e,s),l=Ic(s),c=`err: ${(0,se.VK)(e.error)};message: ${(0,se.VK)(e.message)}`,d=(0,se.Tr)(f.w5.DataLayerClient,a,c,void 0,`Uncaught ${o} in Worker: ${(0,se.VK)(e.message)} Auth: ${r} WorkerState: ${l}`),u=`CDL Worker OnError for ${o}::Auth${r}::workerState:${l}::${Ec(e)}`;return t.errorToTelemetry?t.errorToTelemetry(u,"cdl_worker_startup_error",jc(s),!0):t.error(u,n,a),null==i||i.saveWorkerStatusToCacheStorage({state:"Failure",stepName:"CDLWorkerOnError",error:c}),d}const Rc=e=>{switch(e){case"clean":return"Clean";case"upgrade:blocking":return"UpgradeBlocking";case"upgrade:non-blocking":return"UpgradeNonBlocking";case"warm":return"Warm"}};var Pc=i(907550),Lc=i(535674),Uc=i(649247);const Wc=(0,Pc.p)(Lc.A),Bc=()=>{let e;return(t,i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(void 0===e){const o=yield $c(t,i,n);return e=o,o}return e}))},$c=(e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var n,o,r,s,a;if(!e)return t.log("WebWorkerURL is undefined",i),!0;let l;null===(n=t.infoToTelemetry)||void 0===n||n.call(t,"Pinging PDS / ServiceWorker to verify if worker script is up","cdl_worker_startup_error_verify_worker_script",{endpointUrl:e},!0);const c=new Date,d=performance.now();try{l=yield Wc({url:e,method:"HEAD"})}catch(e){return null===(o=t.errorToTelemetry)||void 0===o||o.call(t,e.toString(),"cdl_worker_startup_error_verify_worker_script",{statusCode:-1},!0),!1}const u={totalRequestTime:performance.now()-d,statusCode:l.status,size:Number(null!==(r=l.headers["content-length"])&&void 0!==r?r:-1),correlationId:l.headers["x-msedge-ref"],callId:l.headers["x-ms-request-id"],contentType:l.headers["x-cache"]};return null===(s=t.infoToTelemetry)||void 0===s||s.call(t,"Finished pinging PDS / ServiceWorker","cdl_worker_startup_error_verify_worker_script",u,!0),t.log(`precompiled-web-worker header x-msedge-ref: ${l.headers["x-msedge-ref"]}`,i),function(e,t){const i="Ref C: ";if(!e)return!0;let n;if(!(n=e.indexOf(i)))return!0;const o=e.slice(n+i.length),r=new Date(o);if(!(0,Uc.q)(r))return!0;return t.getTime()<r.getTime()}(l.headers["x-msedge-ref"],c)||t.log("Request is likely served from service worker, since PDS response time is before the request time",i),l.status!==ia.qb.OK?(null===(a=t.errorToTelemetry)||void 0===a||a.call(t,`PDS returned ${l.status} for worker script`,"cdl_worker_startup_error_verify_worker_script",u,!0),!1):(t.log("Worker script fetched successfully.",i),!0)}));const Hc=(e,t,i,n,r,s,a,l,c,d,u,m,g,h,p,v,y,S)=>new Promise(((k,b)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var w,C;const _=performance.now();"sharedworker"===t&&(null==y||y.setContext("cdlSharedWorkerSessionId",null==c?void 0:c.sessionId));let T=null==g?void 0:g.workerStartupScenario,I=null==g?void 0:g.workerStartupScenarioTimeout;const j=qc(t);if(!T){const e=zc(i.newScenario,s,j,i.workerCacheManager,u,m,p,i.logger);T=e.workerStartupScenario,I=e.workerStartupScenarioTimeout}if(T.appendEventData({origin:a}),S&&(null==p?void 0:p.getUser)&&!T.isPaused){(yield null==p?void 0:p.getUser())||T.pause({reason:f.jK.Authentication,pauseReason:"AuthNoUser_InteractionRequired"})}null==y||y.setCoreContext("AppInfo.CDLState","Initializing");const N=Gc(e);(null===(w=null==m?void 0:m.getState())||void 0===w?void 0:w.state)===Ca.j.InteractionRequired&&(i.logger.warn("Worker startup - User is in InteractionRequired state. pausing worker startup scenario",N),null==T||T.pause({reason:f.jK.Authentication,pauseReason:"InteractionRequired"}));const E=null===(C=null==m?void 0:m.observe())||void 0===C?void 0:C.subscribe({next:e=>{e.state!==Ca.j.InteractionRequired||(null==T?void 0:T.isPaused)?e.state===Ca.j.Up&&(null==T?void 0:T.isPaused)&&(i.logger.log("Worker startup - User came out of InteractionRequired state. Resuming worker startup scenario",N),null==T||T.resume({reason:"ValidToken"})):(i.logger.warn("Worker startup - User is in InteractionRequired state. Pausing worker startup scenario",N),null==T||T.pause({reason:f.jK.Authentication,pauseReason:"InteractionRequired"}))}}),x=T;u&&i.logger.log(`Initializing worker manager from renderer with host: ${u.location.host} protocol: ${u.location.protocol} port: ${u.location.port}`,N);const A=Bc();let D;h||(D=null==u?void 0:u.setTimeout((()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const t=Gc(e);x.mark("ScriptLoadTimedOut"),(yield A(j?null==n?void 0:n.cdlSharedWorkerUrl:null==n?void 0:n.cdlWebWorkerUrl,i.logger,t))||x.mark("ScriptPingFailed")}))),4e4)),function(e,t,i,n,r,s,a,l,c,d,u,m,g,h,p,v,y,S,k){var b;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let w=!1;p&&t.logger.log(`Initializing worker manager from renderer with host: ${p.location.host} protocol: ${p.location.protocol} port: ${p.location.port}`,{hostRendererId:e,component:"CDLWorkerManager"});try{const u=(0,Jl.P)();d.appendEventData({newState:"beforeCreateCDLWorker"});const y=yield Fc(t,e,s,n,r,u.promise,v?null===(b=v.getState())||void 0===b?void 0:b.state:Ca.j.Up,m,i,g,d,p,S).finally((()=>{var e,t,i;null===(e=null==p?void 0:p.clearTimeout)||void 0===e||e.call(p,c),null==p||p.clearTimeout(l),null===(i=null===(t=null==p?void 0:p.loader)||void 0===t?void 0:t.clearWorker)||void 0===i||i.call(t)}));return w=!0,d.appendEventData({newState:U.ck.CdlWorkerManagerHealthChecked,searchSessionId:y.cdlWorkerSessionId}),y.state.setState("initialized"),null==k||k.setCoreContext("AppInfo.CDLState","Running"),Jc(d),d.mark("CDLWorkerManagerInitialized"),function(e,t,i,n,r,s,a,l,c){var d,u,m,g,h,p,v,y,S,k,b,w,C,_;(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=Gc(i);try{const{response:i}=yield e.workerClientResponseRouter.cdlSyncEngineClient.sendRequest({type:"startup_info",subType:"Messaging",params:void 0}),s=i;if(s&&"string"!=typeof s&&"error"===s.type){const e="string"==typeof s.details?s.details:JSON.stringify(s.details);throw t.logger.warn(`Sync engine for Messaging strategy: ${e}`,o),e}const d="clean"===s?"cold":"warm";null==l||l.appendEventData({messagingSyncEngineStartupMode:s,appLaunchMode:d,workerResponseTime:performance.now()-a}),r.resolve({isSyncEngineInitialized:!0,bootType:Rc(s)}),null==c||c.setCoreContext("AppInfo.LaunchMode",d),e.state.setState("syncEngine:Initialized"),Jc(n),n.stop({dataSource:s})}catch(i){const a=yield Vc(s,t.workerCacheManager),l="Init SyncEngine failed",c=`err: ${(0,se.VK)(i)}`,T=i.code||(null===(u=null===(d=i.response)||void 0===d?void 0:d.error)||void 0===u?void 0:u.code)||f.jK.Unknown;null===(g=(m=t.logger).errorToTelemetry)||void 0===g||g.call(m,`${l}:: ${c}`,"cdl_worker_manager_get_messaging_sync_engine_startup_info_error",Object.assign(Object.assign({},(0,ql.n)(o)),{errorCode:T}),!0),null===(p=(h=t.logger).errorToTelemetry)||void 0===p||p.call(h,`${l}:: WSM: ${a}`,"cdl_worker_manager_get_messaging_sync_engine_startup_info_error",Object.assign(Object.assign({},(0,ql.n)(o)),{errorCode:T}),!0),Jc(n);const I=`${l}:: WSM: ${a}:: ${c}`,j=(null===(y=null===(v=i.response)||void 0===v?void 0:v.error)||void 0===y?void 0:y.isExpected)||!1,N={errors:I,isAccepted:j,errorCode:T,dataSource:null===(k=null===(S=i.response)||void 0===S?void 0:S.error)||void 0===k?void 0:k.startupMode,reason:null===(w=null===(b=i.response)||void 0===b?void 0:b.error)||void 0===w?void 0:w.message,statusCode:null===(_=null===(C=i.response)||void 0===C?void 0:C.error)||void 0===_?void 0:_.statusCode};j?n.cancel(N):n.fail(N),e.state.setState("syncEngine:FailedToInitialize"),r.resolve({isSyncEngineInitialized:!1})}}))}(y,t,e,d,u,s,a,h,k),y}catch(n){const r=yield function(e,t,i,n,r,s,a,l,c,d,u){var m,g,h,p,v;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield Vc(r,t.workerCacheManager),y=`Failed to initialize CDL Worker :: err: ${(0,se.VK)(e)}`,S=`${y}, workerResponseTime: ${performance.now()-d}ms, ${o}`;null==u||u.setCoreContext("AppInfo.CDLState","Failed");const k=Gc(i);let b={errors:S,errorCode:t.workerCacheManager?e.code:f.jK.NotInitialized};if(l&&!c)try{if(!(yield a(r?null==s?void 0:s.cdlSharedWorkerUrl:null==s?void 0:s.cdlWebWorkerUrl,t.logger,k))){e.code=f.jK.ScriptLoadError;b={errors:"CDL Worker Script load error",errorCode:f.jK.ScriptLoadError}}}catch(t){e.code=f.jK.ScriptLoadError;b={errors:`CDL Worker Script load error :: ${t.message}`,errorCode:f.jK.ScriptLoadError}}const w=(0,se.Tr)("CDLWorkerManager",e.code,JSON.stringify(k),void 0,S);return null===(g=(m=t.logger).errorToTelemetry)||void 0===g||g.call(m,y,"cdl_worker_manager_handle_initialize_worker_manager_failure_error",Object.assign(Object.assign({},(0,ql.n)(k)),{errorCode:w.code}),!0),null===(p=(h=t.logger).errorToTelemetry)||void 0===p||p.call(h,o,"cdl_worker_manager_handle_initialize_worker_manager_failure_error",Object.assign(Object.assign({},(0,ql.n)(k)),{errorCode:w.code}),!0),Jc(n),e&&e.code===f.jK.TimedOut?n.stop(b,"timeout"):n.fail(b),null===(v=t.workerCacheManager)||void 0===v||v.saveWorkerStatusToCacheStorage({state:"Failure",stepName:"CreateCDLWorker",error:S}),w}))}(n,t,e,d,s,i,u,!w,!!y,a,k);throw r}}))}(e,i,n,r,a,j,_,D,I,T,A,l,c,d,u,m,h,v,y).then((e=>k(e))).catch((e=>{null==E||E.unsubscribe(),b(e)})).finally((()=>null==E?void 0:E.unsubscribe()))})))),qc=e=>"electron"===e||"sharedworker"===e;function zc(e,t,i,n,o,r,s,a){var l;const c=300*$.kg,d=t||c,u=e(U.RG.CentralDataLayerWorkerManagerStartup,d);let m=!0;(null==s?void 0:s.getUser)&&(m=!1,null==s||s.getUser().then((()=>m=!0)));const g=null===(l=null==o?void 0:o.setTimeout)||void 0===l?void 0:l.call(o,(()=>{var e;m||(null==a||a.warn("Worker startup - getUser is still not available. Cancelling Worker Scenario"),u.cancel({reason:"GetUser"}));(r?null===(e=r.getState())||void 0===e?void 0:e.state:Ca.j.Up)===Ca.j.InteractionRequired&&(null==a||a.warn("Worker startup - User is in InteractionRequired state. Cancelling Worker Scenario"),u.cancel({reason:"InteractionRequired"})),Vc(i,n).then((e=>{u.appendEventData({errors:e})}))}),d-500);return{workerStartupScenario:u,workerStartupScenarioTimeout:g}}function Vc(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=e?"shared-worker":"web-worker";let n="";if(t)try{const e=yield t.getWorkerStartupStatus(i);return"WorkerStartupStatus: "+(e?`lastError: ${JSON.stringify(e.lastError)}:: lastState: ${JSON.stringify(e.lastState)}`:"Unable to get CDL worker startup status")}catch(e){n=`Unable to get CDL worker startup status. Reason: ${(0,se.VK)(e)}`}else n="Unable to get CDL worker startup status. Reason: workerCacheManager is undefined";return n}))}function Gc(e){return{hostRendererId:e,component:"CDLWorkerManager"}}function Jc(e){e.appendEventData({"Thread.Id":"",threadId:""})}var Kc=i(246632);class Qc{constructor(e,t,i){this._cacheStorage=e,this._cacheName="cdl-worker-cache-manager",this.lastSavePromise=Promise.resolve(null),this._logger=t,this._scenarioFactory=i}save(e,t,i,n,r){var s,a;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o="";try{if(!e)throw this._error("get","Invalid key");null==r||r.appendEventData({context:n}),o=JSON.stringify(t),this._logger.log(`[CDLWorkerCacheManager]: Saving item to ${this._cacheName} key: ${e}`);const s=new Response(o),a=this._getScopedRequest(e,i,n);return yield this._cacheStorage.put(a,s),null==r||r.stop(),a.request.url}catch(t){const i=this._error("save",`[CDLWorkerCacheManager]: Failed to save object to cache, err: ${null==t?void 0:t.message}, key: ${e}, experienceName: ${n}`);return null===(a=(s=this._logger).warnToTelemetry)||void 0===a||a.call(s,i.message,"cdl_worker_cache_manager_save_error",{origin:e,context:n},!0),null==r||r.fail({message:i.message,errorCode:i.name,errors:i.message}),null}}))}get(e,t,i,n){var r,s;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{if(!e)throw this._error("get","Invalid key");null==n||n.appendEventData({context:i});const o=this._getScopedRequest(e,t,i),r=yield this._cacheStorage.match(o);return r&&r.body?(null==n||n.stop({cached:!0}),yield r.json()):(this._logger.log(`[CDLWorkerCacheManager]: Get from cache for key ${e} could not find a result, returning null.`),null==n||n.stop({cached:!1}),null)}catch(t){const o=this._error("get",`[CDLWorkerCacheManager]: Failed to get item from cache for key ${e}, err: ${null==t?void 0:t.message}`);throw null===(s=(r=this._logger).errorToTelemetry)||void 0===s||s.call(r,o.message,"cdl_worker_cache_manager_get_error",{origin:e,context:i},!0),null==n||n.fail({errors:o.message,errorCode:o.code,message:o.message}),o}}))}delete(e,t,i){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{if(!e)throw this._error("get","Invalid key");this._logger.log(`[CDLWorkerCacheManager]: Deleting item from cdl worker cache key: ${e}, experienceName: ${i}`);const n=this._getScopedRequest(e,t,i),o=yield this._cacheStorage.delete(n);return Promise.resolve(o)}catch(t){const o=this._error("delete",`[CDLWorkerCacheManager]: Failed to delete item from cache key: ${e}, experienceName: ${i}, err: ${null==t?void 0:t.message}`);return null===(r=(n=this._logger).errorToTelemetry)||void 0===r||r.call(n,o.message,"cdl_worker_cache_manager_delete_error",{origin:e,context:i},!0),!1}}))}clear(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return this._logger.log("[CDLWorkerCacheManager]: Clearing cdl-worker cache"),this._cacheStorage.clear(this._cacheName)}catch(i){const n=this._error("clear",`[CDLWorkerCacheManager]: Failed to clear the cache: ${this._cacheName}, err: ${null==i?void 0:i.message}`);return null===(t=(e=this._logger).errorToTelemetry)||void 0===t||t.call(e,n.message,"cdl_worker_cache_manager_clear_error",{origin:this._cacheName},!0),!1}}))}getCachedUrlByKey(e,t){return this._getScopedRequest(e,t).request.url}saveWorkerStatusToCacheStorage(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let t;return yield this.lastSavePromise,this.lastSavePromise=this.get(Kc.QC).then((e=>{t=e})).catch((()=>{this._logger.warn(`WorkerCacheManager couldn't get cache key ${Kc.QC}, setting to default`)})).then((()=>{t||(t={}),"Failure"===e.state?t.lastError=e:t.lastState=e,t.statusLogs=t.statusLogs||[];const i={timestamp:(new Date).getTime(),status:e};return t.statusLogs.push(i),this.save(Kc.QC,t)})),this.lastSavePromise}))}getWorkerStartupStatus(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.get(Kc.QC,void 0,e)}))}saveWorkerVerboseLog(e){return this.save(Kc._1,e,void 0)}getWorkerVerboseLog(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const t=yield this.get(Kc._1,void 0,e);return t||""}catch(e){return""}}))}getAggregatedUserData(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const i=null===(t=this._scenarioFactory)||void 0===t?void 0:t.newScenario(U.RG.MTMAAggregatorUserDataRead);return yield this.get(`${Kc.fl}/${e}`,void 0,"cdl-worker",i)}catch(e){return null}}))}getGlobalUserData(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield this.get(Kc.nx,void 0,"cdl-worker")}catch(i){const n=this._error("getGlobalUserData",`[CDLWorkerCacheManager]: Failed to get global user data from cache, err: ${null==i?void 0:i.message},`);return null===(t=(e=this._logger).errorToTelemetry)||void 0===t||t.call(e,n.message,"cdl_worker_cache_manager_get_global_user_data_error",void 0,!0),null}}))}getAllKeys(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const t=yield this._cacheStorage.keys(this._cacheName);if(null==e||e.stop(),!t)return[];return t.map((e=>e.url))}catch(n){const o=this._error("getAllKeys",`[CDLWorkerCacheManager]: Failed to get all keys from cache, err: ${null==n?void 0:n.message},`);return null===(i=(t=this._logger).warnToTelemetry)||void 0===i||i.call(t,o.message,"cdl_worker_cache_manager_get_all_keys_error",{origin:this._cacheName},!0),null==e||e.fail({message:o.message,errorCode:o.code,errors:o.message}),[]}}))}_error(e,t){return(0,se.Tr)("CDLWorkerCacheManager",f.jK.Undefined,e,void 0,t)}_getScopedRequest(e,t,i){return this._cacheStorage.createRequest(this._cacheName,`${this._cacheName}/${e}`,"Experience",t,!0,i)}}const Yc=(e,t,i)=>{try{const n=new Qc(new Dl(caches,"","",e),t,i);return n.delete(Kc.QC),n}catch(e){return void t.error(`[createCDLWorkerCacheManager]: Error occurred while creating CDLWorkerCacheManager: ${(0,se.VK)(e)}`)}};function Xc(e,t,i,n,r,s,a,l,c,d,u,m,g,h,p,v,y){var f,S,k,w,C,_,T,I,j,N;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{workerStartScenarioTimeoutInMs:E}=s.get(b.J.CdlWorker),x=(e,t,i)=>r.newScenario(e,{callback:i,timeoutMs:t}),A=Yc(t.experienceName,n.newLogger("CDL:DataClientCoreWorkerManager","core-services-cdl-worker"),r),D=td(c,s),F=zc(x,E,qc(D),A,e,m,a,d),O=(null===(f=e.loader)||void 0===f?void 0:f.getCdlSharedWorkerUrl)?null===(S=e.loader)||void 0===S?void 0:S.getCdlSharedWorkerUrl():id(s,e,r,d),M=(null===(k=e.loader)||void 0===k?void 0:k.getCdlWorkerUrl)?null===(w=e.loader)||void 0===w?void 0:w.getCdlWorkerUrl():void 0,R=Zc(c,s,r,e,d);F.workerStartupScenario.appendEventData({contentType:R.toString(),newState:"beforeBootstrapData"}),function(e,t,i,n){n.log(`Initializing workerType ${e} ${t?"as Worker host":`as non-Worker host with sharedWorkerUrl ${i}`}`)}(D,R,O,d);try{let r;if(R){const e=x(U.RG.CentralDataLayerBootstrapData);try{r=yield function(e,t,i,n,r,s,a){return(0,o.__awaiter)(this,void 0,void 0,(function*(){s.mark("getBootstrapDataStart");const l=yield function(e,t,i,n,r,s){var a;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o;r.appendEventData({newState:"beforeAuthUserData"});const l=1e4,c=s.get(b.J.CdlWorker).timeToGetUserFromAuthMs||l;try{o=yield(0,W.E)(e.getUser(),c)}catch(e){i.error(`Worker bootstrap authentication error - cannot authenticationService.getUser: ${null==e?void 0:e.code}`)}if(!o)return{};let d;r.appendEventData({newState:"beforeDiscoverUserData"});try{d=yield(0,W.E)(t.getUser(),c)}catch(e){i.error(`Worker bootstrap authentication error - cannot discover.getUser: ${null==e?void 0:e.code}`)}if(!d)return{userInformation:o};const u=null==d?void 0:d.id;return{userInformation:o,userDetails:{userDetails:{licenseDetails:Object.assign(Object.assign({},d),{trialLicenseEndDate:ed(null==d?void 0:d.trialLicenseEndDate)}),region:null==d?void 0:d.region,userRegion:null==d?void 0:d.userRegion,partition:null==d?void 0:d.partition,userPartition:null==d?void 0:d.userPartition,id:u},id:u},authState:(null===(a=null==n?void 0:n.getState())||void 0===a?void 0:a.state)||Ca.j.Up}}))}(e,t,i,n,s,a);return a.get(b.J.CdlWorker).enableGtmTableInWorkerBootstrapData&&(s.mark("getGtmTable"),l.gtm=yield function(e,t,i,n){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=3e3,s=t.get(b.J.CdlWorker).timeToGetGtmTableMs||o;try{return yield(0,W.E)((null===(r=e.regionGtmTable)||void 0===r?void 0:r.call(e))||Promise.resolve(void 0),s)}catch(e){n.mark("getGtmTableError",{errors:(null==e?void 0:e.code)||"no error code"}),i.error(`Worker bootstrap authentication error - cannot get GTM table from Discover: ${null==e?void 0:e.code}`)}}))}(t,a,i,s),s.mark("getBootstrapDataComplete")),{hostSettings:r.hostSettings,auth:l}}))}(a,l,d,m,i,e,s),e.stop()}catch(t){throw e.fail({error:"Unexpected error getting worker bootstrap data"}),t}}F.workerStartupScenario.appendEventData({newState:"beforeInitializeWorkerManagerFromDataClientCore"});const f=yield function(e,t,i,n,r,s,a,l,c,d,u,m,g,h,p,v,y,f,S,k){var w,C;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{ring:o,environment:_}=u.get(b.J.Metadata),{enableWorkerBroadcast:T}=u.get(b.J.Telemetry),{sessionId:I}=u.get(b.J.Platform),{enablePassingPlatformIdInWorkerUrlHash:j}=u.get(b.J.Core),{workerStartTimeoutInMs:N,workerStartScenarioTimeoutInMs:E,disablePingingPDSIfWorkerStartupFails:x,shouldDisableHealthCheckTimeout:A,enablePausingWorkerScenarioWhenAuthDoesNotHaveUser:D}=u.get(b.J.CdlWorker),F=_?(0,L.get)(yt.s,_):void 0;return v.workerStartupScenario.appendEventData({newState:"beforeInitializeWorkerManager"}),Hc(e,t,{logger:new Ll(l.newLogger("CDL:DataClientCoreWorkerManager","core-services-cdl-worker")),newScenario:p,offlineCacheManager:a,workerCacheManager:d,hostRendererId:e},{cdlSharedWorkerUrl:i||"",cdlWebWorkerUrl:n||""},N||void 0,E||void 0,r,s,{experienceName:r,ring:(null==o?void 0:o.id)||void 0,environment:F,platformId:j?c.config.platformId:void 0,sessionId:I||void 0,buildVersion:c.config.buildVersion,localeCode:y,workerId:h,publicPath:m.__webpack_public_path__,preECSConsoleLogLevel:null===(w=m.defaultConsoleLogLevel)||void 0===w?void 0:w.preECSConsoleLogLevel,userConsoleLogLevel:null===(C=m.defaultConsoleLogLevel)||void 0===C?void 0:C.userConsoleLogLevel,deviceId:c.host.deviceId,telemetryWorkerBroadcast:!!T},f,m,g,v,!!x,S,!!A,k,!!D)}))}(t.clientId,D,O,M,t.experienceName,r,u,n,c,A,s,e,m,h,x,F,p,v,a,y);return!!(null===(C=null==s?void 0:s.get(b.J.CdlWorker))||void 0===C?void 0:C.enableUserContextWorkerRegistration)&&(h&&(null===(_=null==r?void 0:r.auth.userDetails)||void 0===_?void 0:_.id)?g.mapUserIdToRegisteredWorker(h,r.auth.userDetails.id):null===(T=d.errorToTelemetry)||void 0===T||T.call(d,`Unable to register worker '${h}' to user through worker registrar for userId '${null===(I=null==r?void 0:r.auth.userDetails)||void 0===I?void 0:I.id}'`,"cdl_worker_init_register_user_context",{origin:h,userId:null===(j=null==r?void 0:r.auth.userDetails)||void 0===j?void 0:j.id},!0)),f}catch(e){return void(null===(N=d.errorToTelemetry)||void 0===N||N.call(d,`Failed to start CDL Worker from DataClientCore: ${(0,se.VK)(e)}`,"cdl_services_worker_worker_service_start_client_core_cdl_worker_error",void 0,!0))}}))}const Zc=(e,t,i,n,o)=>{const r=td(e,t),s=id(t,n,i,o);return"webworker"===r||"web"===r||!s};function ed(e){try{return null==e?void 0:e.toISOString()}catch(e){return}}function td(e,t){let i=e.config.clientType===wr.Bh.Web?"webworker":"sharedworker";const n=t.get(b.J.Host).cdlWorkerType,o=t.get(b.J.CdlWorker).cdlWorkerType;return n?i=n:o&&(i=o),i}function id(e,t,i,n){var o;let{cdlSharedWorkerUrl:r}=e.get(b.J.Host);const s=t.localStorage.getItem("ts.cdlSharedWorkerJsUrl");if(r&&s&&r!==s){null===(o=n.errorToTelemetry)||void 0===o||o.call(n,`Worker URL saved in TSW:${r} is different from worker url in TMP:${s}`,"cdl_services_worker_worker_service_get_cdl_shared_worker_url_error",void 0,!0);i.newScenario(U.RG.HostSettingsSync).fail({reason:JSON.stringify({cdlSharedWorkerUrl:r,storedWorkerUrl:s})}),r=s}return r}var nd=i(368310);class od extends Ce.i{constructor(){super(f.Yg.CreateCDLWorkerAppServiceTask,["windowProvider","scenarioFactory","coreSettings","platformService","loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=(0,nd.Q6)(e.coreSettings),i=!!e.coreSettings.get(b.J.CdlWorker).enableCdlAppStateService;if(!t||!i)return Promise.resolve();const n=new Pl(e);return e.cdlAppStateService=n,function(e,t,i,n,o,r,s){Zc(n,i,t,e,o)&&r.getCDLWorkerManager().then((e=>{null==e||e.state.setState("appService:Loaded",s)}))}(e.windowProvider,e.scenarioFactory,e.coreSettings,e.platformService,e.loggerFactory.newLogger("CDLWorkerManager","core-services-tasks"),e.cdlWorkerService,n)}))}}class rd extends Ce.i{constructor(){super(f.Yg.CreateCDLWorkerAuthTask,["cdlWorkerRegistrarService","cdlWorkerService","scenarioFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=(0,nd.Q6)(e.coreSettings),{cdlWorkerService:i,cdlWorkerRegistrarService:n,scenarioFactory:r}=e;if(t&&i){const{enableCleanUpOnLogout:t,enablePausingWorkerScenarioWhenAuthDoesNotHaveUser:s}=e.coreSettings.get(b.J.CdlWorker);if(s){const e=r.findScenario(U.RG.CentralDataLayerWorkerManagerStartup);(null==e?void 0:e.isPaused)&&e.resume({reason:"UserAuthenticated"})}if(function(e,t,i,n,o,r,s,a,l,c){Zc(r,i,t,e,s)&&a.getCDLWorkerManager().then((e=>{null==e||e.state.setState("authLoaded",{authenticationService:n,discover:o,authStateProvider:c,cdlWorkerRegistrarService:l})}))}(e.windowProvider,e.scenarioFactory,e.coreSettings,e.authenticationService,e.discover,e.platformService,e.loggerFactory.newLogger("CDLWorkerManager","core-services-tasks"),i,n,e.authStateProvider),!t)return;return t=>(0,o.__awaiter)(this,void 0,void 0,(function*(){"signout"===t&&(yield i.logoutCurrentUser(e.coreSettings))}))}}))}}class sd{constructor(e,t,i,n){this.cdlWorkerService=n,this._logger=i.newLogger("CDLWorkerStateSender","core-services-cdl-worker"),this._clientStateSubscription=e.observe().subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:cc.NotifyCoreClientState,context:{appState:e}}))),this._machineLockStateSubscription=t.observe().pipe((0,Ws.x)(((e,t)=>e.machineLockState===t.machineLockState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:cc.NotifyCoreMachineState,context:{appState:e.machineLockState}}))),this._suspendedStateSubscription=t.observe().pipe((0,Ws.x)(((e,t)=>e.suspendedState===t.suspendedState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:cc.NotifyCoreSuspendedState,context:{appState:e.suspendedState}}))),this._machineIdleStateSubscription=t.observe().pipe((0,Ws.x)(((e,t)=>e.machineIdleState===t.machineIdleState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:cc.NotifyCoreMachineIdleState,context:{appState:e.machineIdleState}})))}dispose(){this._clientStateSubscription&&(this._clientStateSubscription.unsubscribe(),this._clientStateSubscription=void 0),this._machineLockStateSubscription&&(this._machineLockStateSubscription.unsubscribe(),this._machineLockStateSubscription=void 0),this._suspendedStateSubscription&&(this._suspendedStateSubscription.unsubscribe(),this._suspendedStateSubscription=void 0),this._machineIdleStateSubscription&&(this._machineIdleStateSubscription.unsubscribe(),this._machineIdleStateSubscription=void 0)}sendAppStateChangeToWorker(e){var t,i,n,r,s,a;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=(0,M.u4)(e);let l;try{l=yield this.getCdlAppStateClient()}catch(e){return void(null===(i=(t=this._logger).errorToTelemetry)||void 0===i||i.call(t,`Failed to send app state change ${o} to CDL. Reason: failed to obtain a CDLAppStateClient. See initialization failures earlier in the logs.`,"cdl_services_worker_worker_state_sender_send_app_state_get_client_error",void 0,!0))}if(l){this._logger.log(`Alerting CDL Worker of host state change: ${o}`);try{yield l.sendFilteredAppStateRequest(e)}catch(e){null===(a=(s=this._logger).errorToTelemetry)||void 0===a||a.call(s,`Failed to send app state change ${o} to CDL. Reason: ${(0,M.u4)(e)}`,"cdl_services_worker_worker_state_sender_send_app_state_send_request_error",void 0,!0)}}else null===(r=(n=this._logger).errorToTelemetry)||void 0===r||r.call(n,`Failed to send app state change ${o} to CDL. Reason: CDLAppStateClient does not exist. See initialization failures earlier in the logs.`,"cdl_services_worker_worker_state_sender_send_app_state_get_client_undefined_error",void 0,!0)}))}getCdlAppStateClient(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.cdlWorkerService.getCDLWorkerManager();return null==e?void 0:e.workerClientResponseRouter.cdlAppStateClient}))}}class ad extends tc{constructor(e,t){super(),this.workerClientResponseRouter=e,this.logger=t.loggerFactory.newLogger("CDLControlPlaneCommunicator","cdl-control-plane-communicator")}sendMessage(e){this.getRequestForOperationName(e).then((t=>this.handleResponse(e.rendererId,e.requestId,this.extractPerfStats(t)))).catch((t=>this.handleResponse(e.rendererId,e.requestId,void 0,(0,M.u4)(t)||"Unknown Error")))}getRequestForOperationName(e){const t=e.operationName;if(!t)return Promise.reject(`Request could not be sent: operationName unavailable. RequestId: ${e.requestId}.`);switch(this.logger.log(`Converting GQL operation ${t} to CDL Worker control plane message.`),t){case"notifyWorkerSyncCanStart":return this.workerClientResponseRouter.cdlControlClient.sendRequest({type:"sync_can_start"});case"AppsChatNotifyActiveContextChangedMutation":const t=e.request.variables;return this.workerClientResponseRouter.cdlControlClient.sendRequest({type:"active_context_changed",activeContextChangedData:{activeContextId:t.activeContextId,activeContextType:t.activeContextType}})}}handleResponse(e,t,i,n){return Promise.resolve(this.onResponseReceived({payload:{dataLayer:{rendererId:e,requestId:t,data:!n,errors:n,extensions:{perfStats:i}}}}))}extractPerfStats(e){return{workerResponseTime:e.workerResponseTime||0,dataStorePerfStats:[]}}}var ld=i(232894),cd=i(458561);const dd={activity:["activityCustomizations","enableActivityAppCommandResultHook","enableActivityDotBadge","enableActivityFeedForSubCommunity","enableActivityFeedItemDeletion","enableActivityFeedItemDeletionOnUI","enableActivityFeedItemDeletionWithToast","enableAvatarUrlResolutionInActivityFeeds","enableCommunitiesCalendarEventsFeedItems","enableCommunitiesFeedItems","enableCommunitiesInviteAcceptedActivity","enableCommunitiesOwnerPromotionActivity","enableEnhancedFilters","enableMTMAMissedNotificationsDotBadge","enableMTMAMissedNotificationsInTrustedUI","enableMTMANotificationsReadFromMaglevStorage","enableMTMANotificationsUnseenBehavior","enableRealTimeUpdatesToMissedMTMANotifications","enableUnreadToggle","enableVoicemailFeedItems","enabledCommunitiesActivities","enabledGenericActivities","mtmaNotificationsFetchMoreDebounceInterval","mtmaNotificationsPublishDebounceInterval"],activityNotification:["enableActivitySettingsV2","enableEnhancedSettingsExperience","enableEnhancedSettingsExperienceForApps","notificationFeedSettingsNoiseThreshold"],ageConsent:["ageGroup"],artifactsPlatform:["enable3SRTelemetry"],auth:["allowCdlWorkerToUpdateSetting","claimsChallenge401RetryMax","disableSTMFallback","disableSkipTokenRefreshForAnon","disableSkypeTokenOnCsa","disableSkypeTokenToMtInGtm","enableAsyncBatchScenario","enableCachedUser","enableMTO","enableRegionAndSTMHeadersOnCsa","enableSTMHeaderForAuthZ","enableSkypeTokenMigrationForMT","enableSkypeTokenMigrationForTrouter","forceRenewForAADToken","sendMigrationHeaderToMtInGtm","skypeTokenMigrationEnabled","skypeTokenMigrationServiceInfo","stmFallbackMapTimerInHr","stmSourceList"],autosuggest:["enable3SMessagesInQf","enable3SSharedChannelSuggestion","enable3sQueryTextSuggestionDelete","enableCenteredEchoQuery","enableContextualSearchEntryPointInASTypeahead","enableContextualSearchEntryPointInZQ","enableDomainScopingV1","enableEDUSersInAutosuggest","enableExternalSearchSuggestions","enableMirroringDomainScoping","enableQuickActions","enableSearchBoxAlignmentWithSerp","enableSearchV2ForGuestInAutosuggest","enableSeeMoreForMessages","enableSerpCorsPreload","enableSlashCommand","enableSubstrateInstrumentation","learningSlotConfig","serpCorsPreloadScenarioName","wpsSearchConfig"],calendar:["enableCalendarInviteRouting","enableM365Calendar","enableM365CalendarToggle","enableRememberAnonymousExternalContacts","enableRememberingExternalUsersInCalendar","enableResolvingInTenantEmailsInPasting","enableWhiteboardCalendarTab"],calling:["addCountryCodeDuringNormalization","allowNonE164Mri","allowPrivateCallingPolicy","callHistorySettings","callLogsBlacklistedMRIs","commentStreamFetchPageSize","delegationSettingsPolicy","dialPlanPolicy","enableCallHistoryExternalTagging","enableCallsAppPhaseStateMachine","enableCapiV3Contacts","enableDialPlans","enableFixForDtmfTone","enableFormatNumberV2ForUI","enableFormattingFixForExtension","enableMaskAttendeesInMeetings","enableMeetingChatAcceptBlockFlow","enableMeetingChatAcceptBlockFlowUI","enableMeetingDataAdditionalTelemetry","enableMeetingStartedNotificationV2","enableNewCallsBadging","enableNovaSpeedDial","enablePrivateLine","enablePstnWithExtnFix","enableRichCallHistory","enableRichCallHistoryExtension","enableSLABossTabsForMW","enableSLACallHistory","enableSLACallHistoryCount","enableSLACallHistoryFromPersonalHistory","enableStarfieldBackgroundsPromo","enableStreamChatFeature","enableUpdatedGetVoicemailsPath","enableWhiteboardAG08","enableWhiteboardAG09","enableWhiteboardPolicy","forceCommentStreamForConversations","isFluidDefaultOn","meetingPolicy","sharedVoicemailServiceSettings","showCustomChatPaneErrorForNonChannelMember","stopNormalizationOnPlus","teamsVoiceApplicationsPolicy","useFluidWhiteboard","userIdPrefix","voicemailServiceSettings","yammerQnaGraphqlAuthEndpoint","yammerQnaGraphqlEndpoint"],cdlWorker:["conversationUpdatesBatchingConfig","currentConversationTableVersionGCC","disableLiveMessageUpdatesOverPNH","disableUnreadCountCalculationInChannelActivitiesPublisher","enableAvatarUserInfoCache","enableConversationFolderManagerStore","enableConversationTableVersionGCC","enableConversationUpdatesBatching","enableLiveMessagesNotificationsOverANS","enableLiveMessagesNotificationsOverTrouter","enableLoggingMissingMessagesBetweenSyncAndWritingToStore","enableMTMAUserDataInMaglevStorage","enableTelemetryOnMachineActive","forceGroupChatSync","maxMissingMessagesToReportToTelemetry","shouldSkipGroupChatSyncBasedOnIsPartialData","telemetryOnMachineActiveScenarioTimeoutMs"],channels:["enableAtMentionManyRecipientsWarningBanner","enableChannelCopilotInL1MessageAction","enableChannelCopilotInL2Header","enableChannelMessagesUserResolutionByUserDataLoader","enableInfoPaneUserFetchingByUserDataLoader"],chat:["enableNewChatOnAppBarContextMenu","enableNewChatPopOut","enableRoleBasedChatPermissions"],chatList:["bizChatMetaOSAppId","disablePinnedChatsInUserPreferences","enableBizChatMetaOSChatListEntryPoint","enableChatListRawErrorLogging","enableGroupChatActiveCallIndicator","enableShowMissedActivitiesInChatList","enableSmbAllDirectorySuggestedContacts","enableSmbChatListSuggestedContacts","enableSmbExternalChatListSuggestedContacts","enableSuggestedOrgGroupChats","enableSuggestedProjectGroupChats"],communities:["atMentionsSearchMembersLimit","atMentionsStorageExpiryTime","atMentionsStorageInvalidateTimeInMinutes","communitiesDeletedDanglingReplyRetentionInMinutes","enableCommunitiesApp","enableCommunitiesAtMentionsEveryone","enableCommunitiesAtMentionsWorkerResolver","enableCommunitiesCreate","enableCommunitiesDetailedBadgeCount","enableCommunitiesJoinDialogForPostlink","enableCommunitiesJoinFlyout","enableCommunitiesNicknames","enableCommunitiesNicknamesActivityFeed","enableCommunitiesNicknamesToast","enableCommunitiesOnNetworkInviteEmailToggle","enableCommunitiesReportAConcernTombstone","enableDeltaProfilesFetchAtMention","enableDeltaProfilesFetchAtMentionUsingRosterDiff","enableMediaScanDeleteTombStone","enableMemberThreadDetailsSync","hideCommunitiesDeletedDanglingReplies","nicknameExpiryTimeout","removeAdminCheckFromShareJoinLink","showTextScanDeletedPost","updateCommunitiesAtMentionLabelToEveryone"],compose:["enableDesignerInChannelAnnouncementPost","enableSendPostAsEmail"],core:["coreColdBootAppId","disableAppBarAppsSubscriptionThrottling","disableCachingM365SuggestedApps","disableTrouterConnectivityTracker","enable1JSEcsClient","enable1JSGraphqlSearchBox","enableAppBarPinning","enableCommunitiesBadgeCount","enableLocaleFilterForFeatureFlags","enablePersonalFlyoutSearch","enablePersonalFlyoutSuggestions","enablePlatformAppsBadgeCount","enablePoliciesPushUpdates","enableSupermassiveCDL","enableSupermassiveResolverTracing","searchBoxSuggestions"],csaService:["apiConstantsGCC","chatsStartupCallMaxRetryCount","chatsStartupCallMaxRetryInterval","chatsStartupCallMinRetryInterval","chatsStartupCallStalledInterval","enableChatsStartupCallStalledTimeout"],diagnostics:["clientExtendedDiagnosticsData","consoleLogLevel","diagnosticsLogsThrottling","disableExtendedDiagnosticsDataToggle","enableWorkerStoreDiagnosticsLogsInIDB","logReporterSendCountInterval","logReporterSendErrorCountInterval","logReporterSendTimeInterval","loggerReportCountInterval","loggerReportTimeInterval","loggerThrottleList","logsMarkInterval","savingLogsIntoIDBThrottleTime","throttleCapacity","throttleWindowSizeMs","workerDiagnosticsEventQueueMaxSize","workerDiagnosticsLogBufferArraySize","workerDiagnosticsLogsIDBObjectCount"],discoverSurface:["disableDiscoverForGuestUsers","enableHybridDiscoverSurface"],edu:["enableAssignmentsApp"],esp:["enableEspDLSurfaces","irisEspCacheRefreshIntervalHours"],extensibility:["appStudioServiceAuthResource","appStudioServiceBaseURL","appSuggestionsExperiments","appsTenantSettingsLastUpdatedTimestamp","botDynamicCommandDebounceMaxWaitMs","botDynamicCommandDebounceMs","botDynamicCommandsSyncStrategyRefreshIntervalInMs","disableMessageExtensionsInMeeting","disabledTabAppIds","eduSelectAppEntityAllowList","enableAppEntitlementsEtag","enableAppServiceInPlatformService","enableBotDynamicCommandsSyncEngine","enableBotSsoV2","enableFilterPinnedAppsBasedOnPolicy","enableMessageExtensionInTFLCommunities","enablePowerbarMESearch","enablePowerbarUninstalledAppsSearch","enableReactTaskModuleForBIM","enableStoreApiCapabilities","enableStoreAppPolicyCheck","enableSuggestionsServiceOdataEndpoints","enableSynchronizedSyncAndStorePut","includeOpenAIPlugins","isSideLoadingInteractionEnabled","isUserPinningAllowed","ratingsOnRankingExperiment","sharedChannelSupportedAppIds","storeApiCategoryMaxAgeInMinutes","storeApiMaxBackoffInMinutes","storeApiMinBackoffInMinutes","storeSearchSettings","teamsAppPermissionPolicyHash","teamsAppSetupPolicyHash","workflowApp"],files:["enableFilesPolicy","nativeFileEntryPoints"],flyout:["enableOverflowMenuInFlyout","enablePeopleExperience","enableScheduledMeetingsInForYou","enableTflFeaturedCommunitiesSync","frequentlyUsedContactsListSize","tflFeaturedCommunitiesSyncIntervalInMs"],homepage:["enableTflHomepage"],host:["enableProfilePicturesWithObjectId","enableRecordingAndTranscribingInCallsAppV2"],hostCapabilities:["phoneLinkingBlocked","storagePartition"],localization:["enableLocaleSyncWithMSAccount","userAccountLocaleCodePolicy"],marketplace:["defaultMarket","deviceStoreCatalogCDNHost","enableDeviceStoreMetadataFetch"],meet:["busyUserInsightCountPerWeek","busyUserMeetingCountPerWeek","checkUserTypeThreshold","diffFetchBusyUser","disableArtifactsStoreSubscription","disableDynamicJobQueuePriority","disableLazyLoadUpcomingEventDetails","disableMCUMeetAppScenario","disableMeetForWorkManager","disableMeetForWorkRecentRefreshStrategy","disableMeetForWorkScenarioDetails","disableReduceCalendarCallOnIntervalForUpcoming","disableThumbnailFromMCO","disableUpcomingPagination","enableCalendarEventCountTelemetry","enableCalendarTPSForRecent","enableFetchBeforeEnterMeetApp","enableFetchUserProfilesInBatch","enableFileRecommendation","enableMCUMeetAppScenario","enableMeetForWork","enableMeetForWorkCDL","enableMeetForWorkPrePin","enableMeetForWorkRecentRefreshStrategy","enableMockCalendarFetchError","enableMockMCOFetchError","enableMockMCUFetchError","enableMockMREFetchError","enableNativeMeetApp","enablePrefetchOnInterval","enableRecentShortSummary","enableSubstrateEventSearch","getThumbnailIgnoringMCU","graphqlBaseUrl","insightsProviderVersion","isMailboxDiscoverable","isOnCloud","maxRecentSyncingDays","maxStepForBusyUser","maxStepForNonBusyUser","mcuFlights","meetForWorkCDLSettings","mockFeatureForABTest","moreTelemetryForFetch","preFetchRecentAttendee","substrateBaseUrl","throttlePublishTime"],meetingArtifacts:["allowEngagementReportPolicy","enableBypassingEngagementReportPolicy","enableCheckCoOrganizerInRecentAttendanceReport","enableHidingOneOnOneMeetingAttendanceReportEntrances"],meetingRecap:["blockedMeetingTypesTemplateIds","convertROnlyToRnT","enableMergeSeriesMasterCollabObject","enableRecapForChannelMeetings","enableRecapTranscriptOnly","getDateOffset","recapDurationDaysOffset"],messaging:["allowUserChat","commCopilotSummarizationRequestConfig","copilotPluginServiceAuthUrl","copilotPluginServiceUrl","emergencySmsNumbers","enableAutoDeleteV2","enableAutoEditV2","enableAutomaticTranslationV2","enableCallKMApiDirectly","enableChatPinEventErrorMessageLogging","enableChatWithMtoFederatedIdentity","enableConsumerConversations","enableForwardMessageUnreadMarkers","enableGroupChatAudioDropin","enableHasTeamsProProtectionLicenseCheck","enableHideExternalLabelForMTOUsers","enableInOrganizationChatControl","enableInOrganizationChatControlFeature","enableLicenseCheckForM365ChatBot","enableMarkAllChannelsAsRead","enableMarkAllChatsAsRead","enableMeetingChatAutoUnmute","enableMtoUserChatBanner","enableOnDemandTranslation","enablePaidSmsChat","enableRoamMessageDraft","enableTogetherEmojisV2","enableTopicAnnotationLogMismatch","enableTopicInline","enableTopicInlinePreview","enableTopicSmartReplies","enableTopicSmartRepliesPreview","enableTopicsSdkWebWorker","enableTranslationIntelligentSuggestions","enablefeatureSettingManager","hotlineSMSNumbers","inOrganizationChatControl","isMultiWindowSendPipeline","markAllAsReadBatchSize","msgEnableSfbCloudFromBVD","rejectNonAmsURLFromAsyncMediaService","shouldOverrideM365ChatBotLicense","sydneyPromptServiceAuthUrl","sydneyPromptServiceUrl","topicAnnotationsMaxParticipants","topicAnnotationsMinParticipants","topicSmartRepliesMinAnnotationScore","topicSmartRepliesMinRelevanceScore","translationLanguageStampingTunerSettings","useKServingInTopicsSDK","userFeatureSettingsConfig","vivaTopicsAriaCollectorUri"],metadata:["region"],notifications:["enableSubCommunitiesToastNotifications","enableThrottleNotifications","enableUrgentToastsContentFixes","notificationThrottleTimeMs","showGenericNotificationsSoundSetting","showNotificationsCallsSoundSetting"],onboarding:["enableSignInToTflMobileWhatsNew"],people:["allowScopedPeopleSearchandAccess","enableAdditionalRequestHeadersToUPS","enableAtMentionInStatusNote","enableCapiv3MigrationStateCheckInLPC","enableDDRForProfileAndAvatarFreshness","enableExtendedDirectory","enableExternalTagForPSTNUsers","enableInitialsImageForPstn","enableLPCOneGQLPerson","enableLPCPhotoViaOneGQLPerson","enableLabelingUsersByTrustLevel","enableLokiContactModifiedOnPersonMutation","enableMTOLabel","enableNativeAvatarForMTO","enablePBCCreation","enablePBCsForEnterpriseOutTenantUsers","enablePeopleApp","enablePeopleAppPresence","enableSearchV2SearchForGuests","enableSilentLokiAuthTokenRetrieval","enableTfwUpdateGroupChatAvatar","experimentalPeoplePickerOrderChanges","hotlineNumbersMapping","lokiTokenResourceUrl","lpcOneGQLPersonDebugPrefix","topNSuggestionsExpiryCheckIntervalMiliseconds"],peopleTargeting:["customTagMode","disallowedSources","enableOwnersTag","enableOwnersTagInPrivateChannel","enableScheduledTags","enableTagsInPrivateChannels","ownersCanOverwriteTagSettings","suggestedTags","tagPermissions"],phonelinkSms:["csaPhonelinkSmsRequestTimeout","enablePhoneLinkSmsWhatsNew","enablePhonelinkAltMeetLink","enablePhonelinkEUDMAContent","enablePhonelinkErrorStopSyncing","enablePhonelinkOobeFlow","enablePhonelinkRichTextProcessing","enablePhonelinkSms","enablePhonelinkSmsDismissUpsells","onlySkypeTokenForPhonelinkAPIsPlaywright","phonelinkSmsDCGEndpoint","phonelinkSmsDCGResource"],platform:["deviceInfo"],presence:["createEndpointAfterTrouterConnectsDelayInMs","enableAlwaysIncludeSelfInPresenceSubscription","enableAlwaysProcessUpdatePresence","enableAnonymousRequestsFiltering","enableAvailabilityComputationInCreateEndpointWorkflow","enableCallingClientState","enableCreateEndpointAfterTrouterConnects","enableMultipleGetPresenceFix","enablePresenceServiceRetries","enableRefreshPresenceSubscriptions","enableRetrievingEndpointIdOnlyFromPresenceManager","enableSkipPresenceSyncWhileLongInactive","enableUnknownPresenceAppOffline","enableUnknownPresenceFix","enableUnknownPresenceFixTest","presenceServiceMaxRetries","presenceSubscribeIntervalInMs","removePresenceDbProvider","shouldCheckMachineIdleState"],queues:["enableRealTimeStatsForQueuesApp","enableRealTimeStatsForQueuesAppOnStartUp","queuesRtaSignalRServiceSettings","queuesRtaVoiceAppsServiceSettings"],search:["enablePeopleSearchV2"],serp:["enableBackButtonFixForTabSwitch","enableClientVersionHeader","groupChatSettingConfig","substrateInstrumentationClientVersion","substrateTokenUrl","teamChannelSearchConfig"],simpleCollab:["enableSimpleCollabApp","simpleCollabAppECSOverride"],smb:["enableTenantDirectoryStateMachine","externalTopNSuggestionsCacheExpiry","tenantDirectoryCacheExpiryMinutes"],sync:["disableUserActivityReportingOnTrouterConnect","enablePrefetchUnreadMessages","messageSyncColdBootMaxCallCount","unreadMessageMaxCallCount","unreadMessageSequenceIdGapThresholdForBackwardSync","unreadMessagesBidirectionalFetchLimit"],teamsAndChannels:["allowEmailIntoChannel","enableArchiveChannel","enableAutoFavoriteChannel","enableChannelActiveCallsResolver","enableGeneralChannelShowHide","enableLegacyChannelConnectorsToWorkflows","enablePrivateAndSharedChannelUseTeamMention","enablePrivateChannelOnLWGT2","enableReactJoinTeamsGallery","enableRecommendedTeamsSync","enableSensitivityLabelPrivacyValidationOptInBehavior","enableShareWithTeamSensitivityLabelEnforcementReact","enableSharedChannelLieCreation","enableStaleChannelsFlow","enableStaleTeamsFlow","enableT2ChannelsAtMentionBadging","enableT2ChannelsBadgingAppBar","enableTeamsAndChannelsUserResolutionByUserDataLoader","enableUserFetchForJoinTeamGallery","enableUserResolutionForChannelModeratorList","lastTimeFavoritedPropertyBatchSize","privateChannelsOnLWGAllowedGroupsListT2","recommendedTeamsCacheIntervalInHours","staleTeamsAbsentTotalDays","staleTeamsCalculationChannelsLimit","staleTeamsCalculationTeamsLimit","staleTeamsFavoritedTotalDays","staleTeamsInactiveTotalDays","staleTeamsMinimumTotalTeams","staleTeamsRunJobInterval"],telemetry:["enableToolingSamplingRules","enableWorkerBroadcast","samplingRules","toolingSamplingRules"],test:["testAutomation"],userResources:["isSfbCloud","isSfbCloudInBVD","isSipEnabled","isSipEnabledInBVD","isTenantAdmin"],whatsNew:["chatViaSms","communities5k","communitiesBeta","communitiesCreate","contactsSync","designerInChannelAnnouncementPost","enableEntryPointPromotions","enableWhatsNew","flyoutInlineChat","flyoutV2","gamebarWidget","maxFeaturesInOverlayCount","maxValidFromDaysToBeShown","mobileDownloadQrPromo","onDemandTranslations","peopleExperience","phonelinkSms","polls","sendPostAsEmail","signInToMobile","starfieldBackgroundsPromo","togetherEmojisHighFive","togetherEmojisV2","uploadCustomBackground"],windowsSignatureExperiences:["enableGamebarWidgetWhatsNew","enableHighFiveTogetherEmojis"]};var ud=i(891822);class md{constructor(e,t,i,n,o,r,s,a,l){this.configLoader=e,this.coreSettings=t,this.coreSettingsContext=i,this.platformService=o,this.primaryUser=r,this.locale=s,this.osLocale=a,this.osLocaleInfo=l,this._settings={},this.cdlWorkerSettingsAllowlist=dd,this.logger=n.newLogger("CDLWorkerHostSettingsAggregator","core-services-cdl-worker")}get hostSettings(){return 0===Object.keys(this._settings).length&&(this._settings=this.getAllWorkerSettings()),this._settings}startNotifyingCDLWorkerForHostSettingsChanges(e){const t=this.coreSettings.getObservableForAnySettingsChangeForCdlWorker();this.settingsChangedSubscription=t.subscribe((()=>{this.notifyCDLWorkerForSettingsChanges(e)}))}cleanup(){var e;null===(e=this.settingsChangedSubscription)||void 0===e||e.unsubscribe(),this.settingsChangedSubscription=void 0}notifyCDLWorkerForSettingsChanges(e){const t=this.getAllWorkerSettings();(0,L.isEqual)(this._settings,t)||(this._settings=t,this.logger.log("Notifying CDL Worker of host settings changes: ",t),e.sendRequest({type:"host_settings_updated",hostSettings:t}))}getAllWorkerSettings(){const e=this.getCdlWorkerSettings(this.coreSettings);return Object.assign(Object.assign({},e),{[b.J.Host]:(0,L.mergeWith)(e.host||{},this.aggregateHostSettings(),cd.g)})}aggregateHostSettings(){var e;this.logger.debug("aggregateHostSettings called...");const{enableNetworkStateCommsBetweenCoreAndWorker:t,enableMTMA:i}=this.coreSettings.get(b.J.Core),{electronVersion:n,enableHybridChannelList:o=!1,msgEnableChannelsV2:r=!1,msgEnableChannelsV2Header:s=!1,msgEnableSelfChat:a=!1,userType:l="",windowsInsiderChannel:c}=this.coreSettings.get(b.J.Host),d=this.coreSettingsContext,{enableTPSSyncStrategy:u,enableTPSUpdatesOverTrouter:m,tpsSyncStrategyPollingIntervalMs:g,enablePinnedChannelUpdatesOverTPS:h}=this.coreSettings.get(b.J.CdlWorker);let p=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({enableNetworkStateCommsBetweenCoreAndWorker:!!t,enableMTMA:!!i,policiesNamespaces:(0,ud.z$)(this.configLoader,this.coreSettings),enableSyncEngine:(0,nd.Q6)(this.coreSettings),enableProfileManagerStore:(0,nd.bE)(this.coreSettings),enableMessagingNotificationsOverTrouter:this.isMessagingNotificationsOverTrouterEnabled(),imageCookieAuthEnabled:!this.coreSettings.get(b.J.Auth).skipAmsAuthRequest,msgEnableChannelsV2:r,msgEnableChannelsV2Header:s,msgEnableSelfChat:a,enableHybridChannelList:o,enableEspInWorker:!!this.coreSettings.get(b.J.Esp).enableEsp,espIrisExperimentFlightIds:this.coreSettings.get(b.J.Esp).espIrisExperimentFlightIds,espIrisPlacementId:this.coreSettings.get(b.J.Esp).espIrisPlacementId,ecsHostUrl:this.platformService.ecsOverrides.hostUrl,desktopVersion:this.platformService.host.hostAppVersion,initialWorkerHostLocationUrl:this.platformService.config.currentUrl,serviceSwitcherSelectedServiceId:d.getServiceSwitcherApiKey(),electronVersion:n,locale:this.locale||f.ZW,osLocale:this.osLocale,osLocaleInfo:this.osLocaleInfo,userType:l,windowsInsiderChannel:c,enableTPSSyncStrategy:!!u,enableTPSUpdatesOverTrouter:!!m,enablePinnedChannelUpdatesOverTPS:!!h,tpsSyncStrategyPollingIntervalMs:g},this.getCdlWorkerHostSettings(this.coreSettings)),this.getActivityHostSettings(this.coreSettings)),this.getActivityNotificationHostSettings(this.coreSettings)),this.getEndpointsHealthHostSettings(this.coreSettings)),this.getPeopleHostSettings(this.coreSettings)),this.getMessagingHostSettings(this.coreSettings)),this.getTeamsAndChannelsHostSettings(this.coreSettings)),this.getCalendarHostSettings(this.coreSettings)),this.getExternalAccountHostSettings(this.coreSettings)),this.getPresenceHostSettings(this.coreSettings)),this.getDataStoreHostSettings(this.coreSettings)),this.getFilesHostSettings(this.coreSettings)),this.getAuthHostSettings(this.coreSettings)),this.getDiscoverSurfaceHostSettings(this.coreSettings)),this.getMtmaSpecificHostSettings()),this.getGuardiansHostSettings(this.coreSettings)),v=this.getCoreSettingsTestOverrides(this.coreSettingsContext);const{isRunningGlassjar:y}=this.coreSettings.get(b.J.Test);if(this.platformService.config.isInCypressFrame||y){const t={authOverrides:{authzEndpointUrl:this.coreSettings.get(b.J.Auth).authzEndpointUrl},csaOverrides:{csaHostUrl:null===(e=this.coreSettings.get(b.J.CsaService).apiConstants)||void 0===e?void 0:e.host}};p=Object.assign(Object.assign({},p),t),v={localStorageTestOverrides:Object.assign(Object.assign({},v.localStorageTestOverrides),{test:{}}),qspTestOverrides:v.qspTestOverrides}}return Object.assign(Object.assign({},p),v)}getCdlWorkerSettings(e){var t;const i=this.getAllowlistedCdlWorkerSettings(),n={[b.J.Messaging]:{allowUserChat:this.getAllowUserChat(e)},[b.J.Calling]:{callGroupMembershipSettings:null===(t=this.coreSettings.get(b.J.Calling).voiceAdminSettings)||void 0===t?void 0:t.callGroupMembershipSettings}};let o={};return Object.values(b.J).forEach((e=>{const t=(0,L.merge)({},i[e],n[e]);Object.keys(t).length>0&&(o=Object.assign(Object.assign({},o),{[e]:t}))})),o}getAllowlistedCdlWorkerSettings(){const e={};return Object.keys(this.cdlWorkerSettingsAllowlist).forEach((t=>{var i;const n=this.coreSettings.get(t),o={};null===(i=this.cdlWorkerSettingsAllowlist[t])||void 0===i||i.forEach((e=>{const t=(0,L.get)(n,e);(0,L.isNil)(t)||(0,L.set)(o,e,t)})),Object.keys(o).length>0&&(e[t]=o)})),e}getAllowUserChat(e){const{allowUserChat:t,messagingPolicy:i}=e.get(b.J.Messaging);return"boolean"==typeof t||!!i?!!t:void 0}getPresenceHostSettings(e){const{enablePresenceInWorker:t,enablePresenceNotificationsOverTrouter:i,enableReportingUserActivityThroughTrouterByPresence:n,enablePriorityContactsSettings:o,enableSendPresenceTokenToUPS:r,upsTrouterConnectEndpointRecreateDelayInMs:s,priorityContactsRefreshIntervalInMs:a}=e.get(b.J.Presence);return{enablePresenceInWorker:Boolean(t),enablePresenceNotificationsOverTrouter:Boolean(i),enableReportingUserActivityThroughTrouterByPresence:Boolean(n),enablePriorityContactsSettings:Boolean(o),enableSendPresenceTokenToUPS:Boolean(r),upsTrouterConnectEndpointRecreateDelayInMs:null!=s?s:0,priorityContactsRefreshIntervalInMs:null!=a?a:0}}getAuthHostSettings(e){const{skypeTokenValidationDisabled:t}=e.get(b.J.Auth);return{skypeTokenValidationDisabled:!!t}}getCdlWorkerHostSettings(e){const t=e.get(b.J.CdlWorker);return{enableClassBasedErrors:!!t.enableClassBasedErrors,enablePoliciesSyncEngine:!!t.enablePoliciesSyncEngine,enableCrossTenantPoliciesSyncEngine:!!t.enableCrossTenantPoliciesSyncEngine,enableOpenWindowsSettingsMaglev:!!t.enableOpenWindowsSettingsMaglev,enableSendNudgeAfterInactivityPeriod:!!t.enableSendNudgeAfterInactivityPeriod,enableMeetNowLinksReminder:!!t.enableMeetNowLinksReminder,enableNotificationsEngine:!!t.enableNotificationsEngine,enableAppsUsageSyncEngine:!!t.enableAppsUsageSyncEngine,enableUserPreferencesWorkerFetch:!!t.enableUserPreferencesWorkerFetch,enableAppsPlatformSyncEngine:!!t.enableAppsPlatformSyncEngine,enableAppsPlatformTrouterUpdates:this.isMessagingNotificationsOverTrouterEnabled()&&!!t.enableAppsPlatformTrouterUpdates,enableChatWithUserNetworkFetch:!!t.enableChatWithUserNetworkFetch,enableOfflineActionsSyncEngine:!!t.enableOfflineActionsSyncEngine,enableStartupDeferral:!!t.enableStartupDeferral,enableTenantSyncStrategy:!!t.enableTenantSyncStrategy,enableSearchTopNPopulateStrategy:!!t.enableSearchTopNPopulateStrategy,enableSensitivityLabelSync:!!t.enableSensitivityLabelSync,enableWaitOnAuthUp:!!t.enableWaitOnAuthUp,enableStartupUsingPartialData:!!t.enableStartupUsingPartialData,enableNonRecentChatsStartup:!!t.enableNonRecentChatsStartup,nonRecentChatsStartupPageSize:t.nonRecentChatsStartupPageSize,nonRecentChatsStartupMaxCalls:t.nonRecentChatsStartupMaxCalls,nonRecentChatsStartupWorkflowTimeoutInMS:t.nonRecentChatsStartupWorkflowTimeoutInMS,chatsStartupJobPageSize:t.chatsStartupJobPageSize,chatListCacheDaysThreshold:t.chatListCacheDaysThreshold,partialDataStartupChatsLimit:t.partialDataStartupChatsLimit,partialDataStartupSkipNonRecentMeeting:t.partialDataStartupSkipNonRecentMeeting,skipMeetingChatsInGroupChatSync:!!t.skipMeetingChatsInGroupChatSync,enableChatTitleCache:!!t.enableChatTitleCache,enableMruChannelsMemoryPruning:!!t.enableMruChannelsMemoryPruning,disableUnknownTitleFallback:!!t.disableUnknownTitleFallback,disableTitleCacheRefreshOnDisplayNameChange:!!t.disableTitleCacheRefreshOnDisplayNameChange,disablePartialLoadConversationNetworkFetch:!!t.disablePartialLoadConversationNetworkFetch,enableMultipleReplyChainsUpdatesFromWorker:!!t.enableMultipleReplyChainsUpdatesFromWorker,enableMTMAAggregator:!!t.enableMTMAAggregator,disablePingingPDSIfWorkerStartupFails:t.disablePingingPDSIfWorkerStartupFails,currentConversationTableVersion:t.currentConversationTableVersion,disableMessageContentWrapperDiv:t.disableMessageContentWrapperDiv,enablePriorityJobRunner:!!t.enablePriorityJobRunner,scheduleChannelsConversationSyncAtBackgroundPriority:!!t.scheduleChannelsConversationSyncAtBackgroundPriority,trouterNotifyServiceDownTimerMs:t.trouterNotifyServiceDownTimerMs,chatServiceMaxPageSize:t.chatServiceMaxPageSize,chatReplyChainsToFetch:t.chatReplyChainsToFetch,preloadNamespaces:t.preloadNamespaces}}getActivityHostSettings(e){const t=e.get(b.J.Activity);return{enableActivityManagerStore:!!t.enableActivityManagerStore,enableActivityBellCount:!!t.enableActivityBellCount,feedItemsCountOnAppLoad:t.paginationFirstLoad||0,enableOrderFeedsReplyChainsByMaxVersion:!!t.enableOrderFeedsReplyChainsByMaxVersion,enableChannelFeedItems:!!t.enableChannelFeedItems,enableActivityTranslationInCDL:!!t.enableActivityTranslationInCDL,enableMarkAllAsReadLogic:!!t.enableMarkAllAsReadLogic,enableSharedChannelFeedItems:!!t.enableSharedChannelFeedItems,enableUrgentFeedItems:!!t.enableUrgentFeedItems,enableSyntheticNotificationProcessor:!!t.enableSyntheticNotificationProcessor,enableGraphFeedItems:!!t.enableGraphFeedItems,disableIncomingPstnActivityFeed:!!t.disableIncomingPstnActivityFeed,enableMTMAMissedNotifications:!!t.enableMTMAMissedNotifications,mtmaNotificationsPollingInterval:t.mtmaNotificationsPollingInterval||md.mtmaNotificationsPollingIntervalDefault}}getActivityNotificationHostSettings(e){const{enableNewSettingsApiUse:t,enableMissedActivityEmails:i}=e.get(b.J.ActivityNotification);return{enableNewSettingsApiUse:!!t,enableMissedActivityEmails:!!i}}getPeopleHostSettings(e){const t=e.get(b.J.People);return{enableBuddyListService:!!t.enableBuddyListService,buddyListRefreshTimeoutInMilliSeconds:t.buddyListRefreshTimeoutInMilliSeconds||0,blockedListRefreshIntervalInMs:t.blockedListRefreshIntervalInMs||0,blockedListPendingActionQueueChunkSize:t.blockedListPendingActionQueueChunkSize||0,enableContactsSync:!!t.enableContactsSync,enableMultipleAliasesForContactsSync:!!t.enableMultipleAliasesForContactsSync,maxNumberOfRoamingDevices:t.maxNumberOfRoamingDevices||0,enableInstantSyncForRoamingDevices:!!t.enableInstantSyncForRoamingDevices,fetchTFLContactsRefreshInterval:t.fetchTFLContactsRefreshInterval||[],enableEndpointsManagerOnAcceptListService:!!t.enableEndpointsManagerOnAcceptListService,enableEndpointsManagerOnBuddyService:!!t.enableEndpointsManagerOnBuddyService,enableEndpointsManagerOnBlockService:!!t.enableEndpointsManagerOnBlockService,contactsSyncDeltaRefreshIntervalInMs:t.contactsSyncDeltaRefreshIntervalInMs||0,contactsSyncFullRefreshIntervalInMs:t.contactsSyncFullRefreshIntervalInMs||0,contactsSyncKeepAliveIntervalInMs:t.contactsSyncKeepAliveIntervalInMs||0,maxBatchSizeforSCDDeletion:t.maxBatchSizeforSCDDeletion||0,lokiTokenResourceUrl:t.lokiTokenResourceUrl||"",buddyServiceEndpointManagerMaxRetries:t.buddyServiceEndpointManagerMaxRetries||0,enableTflTfwFederation:!!t.enableTflTfwFederation,enableProfilePicturesWithObjectId:!!t.enableProfilePicturesWithObjectId,enableMeProfileSyncStrategy:!!t.enableMeProfileSyncStrategy,checkProfileExpiryAndRefreshIntervalInMs:t.checkProfileExpiryAndRefreshIntervalInMs||0,enableTfwToTfwFederatedInviteFree:!!t.enableTfwToTfwFederatedInviteFree,enableBlockedContactsDataStore:!!t.enableBlockedContactsDataStore,enableM365Endpoint:!!t.enableM365Endpoint,enableExtendedDirectory:!!t.enableExtendedDirectory,enableCapiv3ContactsSync:!!t.enableCapiv3ContactsSync,enableSharedChannelPeoplePickerErrorMessages:!!t.enableSharedChannelPeoplePickerErrorMessages,enableProfileFetchFromWorkingSet:!!t.enableProfileFetchFromWorkingSet,enableAtMentionEveryoneInGroupChat:!!t.enableAtMentionEveryoneInGroupChat,enableAtMentionEveryoneInMeetingChat:!!t.enableAtMentionEveryoneInMeetingChat,enableAddAnonDisplayNameTagsInProfile:!!t.enableAddAnonDisplayNameTagsInProfile}}getMessagingHostSettings(e){const t=e.get(b.J.Messaging);return{enableChatWithNonTflUsers:!!t.enableChatWithNonTflUsers,enableCSAChatSummarization:!!t.enableCSAChatSummarization,enableCSAChatSummarizationV2:!!t.enableCSAChatSummarizationV2,chatSummarizationTimeoutOverride:t.chatSummarizationTimeoutOverride,enableTflSmsCreate:!!t.enableTflSmsCreate,enableTfwTflFederation:!!t.enableTfwTflFederation,enableTfwFederationOnTfl:!!t.enableTfwFederationOnTfl,enableTFLSmsFriendlyNameSearch:!!t.enableTFLSmsFriendlyNameSearch,tflSmsAllowedPhoneNumberRegionCodes:t.tflSmsAllowedPhoneNumberRegionCodes||[],disableMessagingSyncEngine:!!t.disableMessagingSyncEngine,enableAutoSendV2:!!t.enableAutoSendV2,disableRendererSideSanitization:!!t.disableRendererSideSanitization,enableTranslationSettings:!!t.enableTranslationSettings,enableSingleInbox:!!t.enableSingleInbox,enableTagsMention:!!t.enableTagsMention}}getTeamsAndChannelsHostSettings(e){const t=e.get(b.J.Channels),i=e.get(b.J.TeamsAndChannels);return{enablePinnedChannelsSyncEngine:!!i.enablePinnedChannelsSyncEngine,maximumPinnedChannelLimit:i.maximumPinnedChannelLimit,pinnedChannelsSyncIntervalInMs:i.pinnedChannelsSyncIntervalInMs,enableFixingPinnedChannelsConflict:!!i.enableFixingPinnedChannelsConflict,enableUserResolutionForChannelModeratorList:!!i.enableUserResolutionForChannelModeratorList,enableRecommendedTeamsSync:!!i.enableRecommendedTeamsSync,allowChannelSharingToExternalUser:!!i.allowChannelSharingToExternalUser,enableChannelInfoPane:!!t.enableChannelInfoPane,enableUseT1LocaleInTranslation:!!t.enableUseT1LocaleInTranslation,enableChannelsUserResolutionInT21:!!t.enableChannelsUserResolutionInT21,allowGuestUser:!!i.allowGuestUser}}getCalendarHostSettings(e){const t=e.get(b.J.Calendar);return{autodiscoverSettings:t.autodiscoverSettings,calendarRESTEnabledAPIs:t.calendarRESTEnabledAPIs,connectedCalendarSettingsRefreshIntervalInMs:t.connectedCalendarSettingsRefreshIntervalInMs||0,enableCalendarSyncEngine:!!t.enableCalendarSyncEngine,enableCalendarV2ApiService:!!t.enableCalendarV2ApiService,enableCalendarV2ApiServiceEnterprise:!!t.enableCalendarV2ApiServiceEnterprise,enableCalendarManagerPrefetchInMemoryData:!!t.enableCalendarManagerPrefetchInMemoryData,enableClientStateCheckForCalendarPolling:!!t.enableClientStateCheckForCalendarPolling,enableMultipleCalendarSyncEngine:!!t.enableMultipleCalendarSyncEngine,enableUnifiedCalendarSyncEngine:!!t.enableUnifiedCalendarSyncEngine,enableConnectedCalendar:!!t.enableConnectedCalendar,enableConnectedCalendarSettingsSync:!!t.enableConnectedCalendarSettingsSync,enableCourseCalendarSyncEngine:t.enableCourseCalendarSyncEngine,enableEventFetchOptimizationUsingLastSync:t.enableEventFetchOptimizationUsingLastSync,enableMeetingArtifactsCollaborationData:t.enableMeetingArtifactsCollaborationData,enablePrefetchCourseCalendarEventsOnStartUp:t.enablePrefetchCourseCalendarEventsOnStartUp,isOnCloud:t.isOnCloud,maxRoomListsToFetch:t.maxRoomListsToFetch,maxRoomsInRoomListToFetch:t.maxRoomsInRoomListToFetch,maxRoomsToFetch:t.maxRoomsToFetch,enableThirdPartyCalendar:!!t.enableThirdPartyCalendar,calendarEventsPollIntervalInMs:t.calendarEventsPollIntervalInMs,calendarEventsPollIntervalWithPushInMs:t.calendarEventsPollIntervalWithPushInMs,isLmsCourseCalendar:!!t.isLmsCourseCalendar,enablePrefetchCalendarEventsOnStartUp:!!t.enablePrefetchCalendarEventsOnStartUp,enableSensitivityLabelInCalendar:!!t.enableSensitivityLabelInCalendar,enableCalendarPushNotifications:!!t.enableCalendarPushNotifications,enableCalendarPollingWithPushNotifications:!!t.enableCalendarPollingWithPushNotifications,enableCalendarGCVOptimizations:!!t.enableCalendarGCVOptimizations,enableCalendarMailBoxDiscoveryHandler:!!t.enableCalendarMailBoxDiscoveryHandler,enablePushCalendarEventsOnSubscription:!!t.enablePushCalendarEventsOnSubscription}}getExternalAccountHostSettings(e){const{enableExternalAccounts:t,requestSource:i,enableUnifiedHardDelete:n}=e.get(b.J.ExternalAccounts);return{enableExternalAccounts:!!t,requestSource:i,enableUnifiedHardDelete:!!n}}getEndpointsHealthHostSettings(e){const{enableWorkerEndpointsHealthMonitor:t,enableWorkerEndpointsHealthService:i}=e.get(b.J.Core);return{enableWorkerEndpointsHealthMonitor:!!t,enableWorkerEndpointsHealthService:!!i}}getDataStoreHostSettings(e){const t=e.get(b.J.CdlWorker);return{enableDbOpenTimeout:!!t.enableDbOpenTimeout,dbOpenTimeoutLengthSeconds:t.dbOpenTimeoutLengthSeconds||60,dataStoreMapType:t.dataStoreMapType||"",disableDataStoreInMemoryProvider:!!t.disableDataStoreInMemoryProvider,disableDataStoreDbProvider:!!t.disableDataStoreDbProvider,rollbackSupportInDataStoreInMemoryProvider:!!t.rollbackSupportInDataStoreInMemoryProvider,disableReplyChainManagerPrefetch:!!t.disableReplyChainManagerPrefetch,dataStoreCreationResiliencyConfig:t.dataStoreCreationResiliencyConfig||{enable:!1},disableRetryOnStoreMissing:!!t.disableRetryOnStoreMissing,dataStoreDbOperationResiliencyConfig:t.dataStoreDbOperationResiliencyConfig,enableConversationTypeIndex:!!t.enableConversationTypeIndex}}getCoreSettingsTestOverrides(e){const t=e;return{localStorageTestOverrides:t.getLocalStorageTestOverrides()||{},qspTestOverrides:t.getQspTestOverrides()||{}}}getFilesHostSettings(e){const{preferGraphOverVroom:t,vroomEndpointBaseUrl:i,graphEndpointBaseUrl:n,graphAuthScope:o,vroomAuthScope:r}=e.get(b.J.Files);return{filesOverrides:{preferGraphOverVroom:!!t,vroomEndpointBaseUrl:i||"",graphEndpointBaseUrl:n||"",graphAuthScope:o||"",vroomAuthScope:r||""}}}getDiscoverSurfaceHostSettings(e){const t=e.get(b.J.DiscoverSurface);return{enableHybridDiscoverSurface:!!t.enableHybridDiscoverSurface,discoverSurfaceTopItemsCount:t.discoverSurfaceTopItemsCount||ld.$O.defaultItemsToFetch,enableNewPollingChanges:!!t.enableNewPollingChanges,disableDiscoverNetworkCall:!!t.disableDiscoverNetworkCall,discoverSurfaceDefaultSection:t.discoverSurfaceDefaultSection||ld.$O.defaultSection,enableDiscoverSurfaceDebugMenu:!!t.enableDiscoverSurfaceDebugMenu,serverCacheRetentionTimeInHrsSinceFirstCall:t.serverCacheRetentionTimeInHrsSinceFirstCall||ld.$O.defaultServerCacheRetentionTimeInHrsSinceFirstCall,enableDiscoverBadging:!!t.enableDiscoverBadging,dataSyncIntervalTime:t.dataSyncIntervalTime||ld.$O.defaultDataSyncIntervalTime,enableDiscoverSurfaceSyncEngine:!!t.enableDiscoverSurfaceSyncEngine}}getMtmaSpecificHostSettings(){const{enableMTMA:e}=this.coreSettings.get(b.J.Core);return e&&this.primaryUser&&this.primaryUser.profile?{primaryUserProfile:{oid:this.primaryUser.profile.objectId,tid:this.primaryUser.profile.tenantId}}:{}}isMessagingNotificationsOverTrouterEnabled(){const e=this.coreSettings.get(b.J.Host).enableMessagingNotificationsOverTrouter;return(0,L.isNil)(e)?!!this.coreSettings.get(b.J.CdlWorker).enableMessagingNotificationsOverTrouter:e}getGuardiansHostSettings(e){const{enableGuardiansPreferredMethodAndSmsInvite:t}=e.get(b.J.Guardians);return{enableGuardiansPreferredMethodAndSmsInvite:t}}}md.mtmaNotificationsPollingIntervalDefault=3e5;class gd{constructor(){this.perfDataByOperationName=new Map,this.cdlSubscriptionAggregatorAllowList=["chatServiceEvent","DataResolversBrowserChatServiceEventsChatServiceBatchEventSubscription","DataResolversBrowserChatServiceEventsChatServiceEventSubscription"]}static getInstance(){return this.subscriptionEventAggregatorSingleton||(this.subscriptionEventAggregatorSingleton=new gd),this.subscriptionEventAggregatorSingleton}init(e,t,i,n){var o;this.logger=e.newLogger("SubscriptionEventAggregator","core-cdl-data-layer-client"),i&&(this.cdlSubscriptionAggregatorAllowList=i),null===(o=this.logger)||void 0===o||o.log(`Initialized CDLSubscriptionEventAggregator Allow List: ${this.cdlSubscriptionAggregatorAllowList.join(",")}`),this.intervalCancellationToken=setInterval((()=>{this.logStats(t)}),n||$.A_)}addToTimeline(e,t,i,n,o,r,s){if(this.intervalCancellationToken||this.init(i,n,o,s),!t)return void(this.logger&&this.logger.log("Received subscription perf stat without responseSendTime. Ignoring."));const a=Date.now()-t;if(!(a<0)&&(e&&!this.perfDataByOperationName.has(e)&&this.perfDataByOperationName.set(e,{ipcTimes:[],customIdentifierCount:{}}),e)){const t=this.perfDataByOperationName.get(e);if(!t)return void(this.logger&&this.logger.warn(`SubscriptionEventAggregator: No perf data found for operationName ${e}`));if(t.ipcTimes.push(a),r){let e={};e="string"==typeof r?{[r]:1}:r,Object.keys(e).forEach((i=>{const n=e[i];t.customIdentifierCount[i]||(t.customIdentifierCount[i]=0),t.customIdentifierCount[i]+=n}))}}}logStats(e){const t=Array.from(this.perfDataByOperationName.entries());this.perfDataByOperationName.clear();for(const[i,n]of t){if(!this.cdlSubscriptionAggregatorAllowList.includes(i))continue;const t={operationName:i,numberOfRequests:n.ipcTimes.length,averageIPCTimeOneWay:n.ipcTimes.reduce(((e,t)=>e+t),0)/n.ipcTimes.length},o=e.newScenario(U.RG.CentralDataLayerSubscription);(0,L.keys)(n.customIdentifierCount).forEach((e=>{o.mark(e,{size:n.customIdentifierCount[e],type:e})})),o.stop(t)}}}var hd=i(918905);class pd{constructor(e,t,i){this.isResponse=t,this.internalPerfStat={operationName:i,requestStartTime:{perf:performance.now(),date:Date.now()},responseReceivedTime:{perf:performance.now(),date:Date.now()},workerResponseTime:0,dataStorePerfStats:[]},this.operationName=i||"",this.operationType=e,performance.mark(`${this.getPerformanceName()}-start`)}stopMeasurement(e,t,i){this.internalPerfStat=Object.assign(Object.assign(Object.assign({},this.internalPerfStat),e),{responseReceivedTime:{perf:performance.now(),date:Date.now()}});const n=this.getPerformanceName(),o=`${n}-start`,r=`${n}-end`;(0,hd.DW)(o,performance),performance.mark(r),(0,hd.bu)(performance,n,o,r);const{requestStartTime:s,requestReceivedTime:a,responseSendTime:l,responseReceivedTime:c,workerResponseTime:d}=this.internalPerfStat,u={totalRequestTime:Math.round(c.perf-s.perf),workerResponseTime:Math.round(d),requestTime:Math.round(s.perf),responseTime:Math.round(c.perf)};return(null==t?void 0:t.length)&&(u.otherResponsesReceivedWhileInTransit=t),i&&(u.responseReceiveLatency=i),a&&(u.requestIPCTime=a-s.date),l&&(u.responseIPCTime=c.date-l),u}static markSubscriptionRequest(e){const t=`subscription_request_start_${e}`,i=`subscription_request_${e}`;performance.mark(t),(0,hd.bu)(performance,i,t)}static addSubscriptionResponse(e,t,i,n,o,r,s){gd.getInstance().addToTimeline(e,t,i,n,r,o,s)}getPerformanceName(){return`cdl-${this.isResponse?"response":"request"}-${this.operationName||this.operationType}`}}const vd=["callParticipantsVoiceLevelsChangedEvent","callParticipantsChangedEvent"],yd=["callingIntent","chat","messageList"],fd=["putConversations"],Sd="debug";class kd{constructor(e,t,i,n,o,r,s,a,l,c,d,u=[],m,g,h,p,v,y){var f;if(this.variables=i,this._logger=r,this.loggerFactory=s,this.scenarioFactory=a,this.syncEngineInitializationPromise=l,this.rendererId=c,this.requestHealthMonitor=m,this.enableClassBasedErrors=g,this.cdlOperationCustomContext=p,this.splitFetchWaitMarkerInWLT=v,this.dataLayerClientSettings=y,this._perfStats=null,this._perfStatsForResponseProcessing=null,this._scenario=void 0,this._startTime=Date.now(),this._lastUpdateTime=null,this._requestId=e,this._windowId=d,this._requestType=t,"subscription"!==t?this._perfStats=new pd(t,!1,o):pd.markSubscriptionRequest(o),this._requestComplete=!1,this._operationName=o,this._loggingContext={requestId:e,component:"RequestHandler",requestRendererId:this.rendererId,requestWindowId:this.windowId,hostRendererId:n,operationType:t,operationName:o},u=u&&u.length?u:fd,this.subject=new Bl(this._logger,this._loggingContext),this.logRequest(),o&&!u.includes(o)&&"subscription"!==t){this._scenario=this.scenarioFactory.newScenario(U.RG.CentralDataLayerRequest),this._scenario.clientName=o;const e=this.getActiveCPM();if(this._scenario.appendEventData({operationName:o,operationType:t,context:this.rendererId,"Panel.WindowID":this.windowId,target:h,correlationId:null==p?void 0:p.callerScenarioId,origin:null==p?void 0:p.callerInfo,activeCPM:e}),this.isRequestFromWindowLaunch(o,a)){a.startStep(U.RG.WindowLaunchTime,U.ck.FetchWait);const e=this.scenarioFactory.findScenario(U.RG.WindowLaunchTime);this._wltTimestampsAtInit=null==e?void 0:e.timestamps.length}}null===(f=this.requestHealthMonitor)||void 0===f||f.requestCreated(this),this.syncEngineInitializationPromise.then((e=>{var t;if(!e.isSyncEngineInitialized)throw Error();null===(t=this._scenario)||void 0===t||t.appendEventData({messagingSyncEngineStartupMode:e.bootType})})).catch((()=>{var e;null===(e=this._scenario)||void 0===e||e.appendEventData({messagingSyncEngineStartupMode:"Error"})}))}get requestId(){return this._requestId}get windowId(){return this._windowId}get response(){return this.subject.observable}get requestType(){return this._requestType}get operationName(){return this._operationName}isComplete(){return this._requestComplete}setResponseAndEndScenario(e,t,i){var n,o,r;const s=!e.errors&&e.data;this._otherResponsesReceivedWhileInTransit=t,this._responseReceiveLatency=i,s?(this._perfStatsForResponseProcessing=new pd(this.requestType,!0,this.operationName),this.onSuccess(e)):this.onError(e),this.onComplete(s?"success":"error"),s&&(null===(n=e.extensions)||void 0===n?void 0:n.perfStats)&&(null===(o=this._perfStatsForResponseProcessing)||void 0===o||o.stopMeasurement(null===(r=e.extensions)||void 0===r?void 0:r.perfStats,t,i))}cancel(){this._requestComplete||(this._requestComplete=!0,this._scenario&&this._scenario.incomplete(),this.onComplete("cancelled"))}toLog(){return{requestId:this.requestId,requestType:this.requestType,operationName:this.operationName,isComplete:this.isComplete(),variables:(0,L.mapValues)(this.variables,((e,t)=>this.variableToLog(t,e))),customContext:this.cdlOperationCustomContext,startTime:this._startTime,lastUpdateTime:this._lastUpdateTime}}onComplete(e){var t;this._requestComplete&&(this.subject.onComplete(),null===(t=this.requestHealthMonitor)||void 0===t||t.requestCompleted(this,e))}onSuccess(e){this.mergeAndEndStatsSnapshot(e.extensions),this.logResponse(),this.subject.onNext(e)}onError(e){var t;this._requestComplete=!0;const i=(null==e?void 0:e.errors)||"Unexpected: data layer query response missing both data and error",n=Array.isArray(i)?i.map((e=>(0,se.VK)(e))).join():(0,se.VK)(i);if(this.mergeAndEndStatsSnapshot(e.extensions,n),this.enableClassBasedErrors)this.subject.onNext(e);else{let i=e.errorCode;!i&&(null===(t=e.errors)||void 0===t?void 0:t.length)&&(i=e.errors[0].name||f.jK.RemoteOperationFailed),i||(i=f.jK.InvalidResponse);const o=(0,se.Tr)(f.w5.DataLayerClient,i,"onError",void 0,n);this._logger.error(`error while processing ${this._requestId}: ${o.message} (reason: ${o.reason})`,this._loggingContext,i),this.subject.onError(o)}}mergeAndEndStatsSnapshot(e,t){var i,n,o,r;let s;e&&e.perfStats&&(this._perfStats&&(s=this._perfStats.stopMeasurement(e.perfStats,this._otherResponsesReceivedWhileInTransit,this._responseReceiveLatency)),"subscription"===this.requestType&&(this._lastUpdateTime=Date.now(),pd.addSubscriptionResponse(this.operationName,e.perfStats.responseSendTime,this.loggerFactory,this.scenarioFactory,e.subscriptionCustomIdentifier,null===(i=this.dataLayerClientSettings)||void 0===i?void 0:i.cdlSubscriptionAggregatorAllowList,null===(n=this.dataLayerClientSettings)||void 0===n?void 0:n.cdlSubscriptionAggregatorLogIntervalMS))),e&&(null===(o=this._scenario)||void 0===o||o.appendEventData({dataSource:e.dataSource,size:null===(r=e.perfStats)||void 0===r?void 0:r.payloadLength})),this._scenario&&(t?this.syncEngineInitializationPromise.then((e=>{var i,n,o;null===(i=this._scenario)||void 0===i||i.appendEventData(Object.assign(Object.assign({},s),{errors:(0,re.A)(t)})),e.isSyncEngineInitialized?null===(n=this._scenario)||void 0===n||n.fail():null===(o=this._scenario)||void 0===o||o.incomplete()})):(this._scenario.stop(s),this.isRequestFromWindowLaunch(this.operationName,this.scenarioFactory)&&this.createWltSteps(s)))}logResponse(){this._logger[this.getLogLevel()]("Received response data for request",this._loggingContext)}createWltSteps(e){const t=this.scenarioFactory.findScenario(U.RG.WindowLaunchTime);if(t&&t.currentStep!==U.ck.FetchProcessResponse){if(e){const{requestIPCTime:i,responseIPCTime:n,workerResponseTime:o}=e;if(i&&n&&this.splitFetchWaitMarkerInWLT){if(this._wltTimestampsAtInit&&t.timestamps.length>this._wltTimestampsAtInit)return;t.mark(U.ck.FetchWaitRequestIPC,{offsetCurrentTimeInMs:Math.round(o)+n}),t.mark(U.ck.FetchWaitWorker,{offsetCurrentTimeInMs:n}),t.mark(U.ck.FetchWaitResponseIPC)}else t.mark(U.ck.FetchWaitIPC,{offsetCurrentTimeInMs:Math.round(o)}),t.mark(U.ck.FetchWaitWorker)}t.startStep(U.ck.FetchProcessResponse)}}isRequestFromWindowLaunch(e,t){return!!t.findScenario(U.RG.WindowLaunchTime)&&yd.indexOf(e)>-1}logRequest(){this._logger[Sd]("Created new request",this._loggingContext)}getLogLevel(){var e;return vd.indexOf(null!==(e=this._loggingContext.operationName)&&void 0!==e?e:"")>=0?Sd:"log"}getActiveCPM(){const e=[U.RG.ChatSwitch,U.RG.ChannelSwitchL1,U.RG.ChannelSwitchL2,U.RG.ChannelL1Deeplink,U.RG.ChannelL2Deeplink,U.RG.ActivitySwitch,U.RG.ApplicationLaunchTime,U.RG.WindowLaunchTime];if(this.scenarioFactory.doesScenariosExist){const t=this.scenarioFactory.doesScenariosExist(e);if(t.length)return t.join(",")}}variableToLog(e,t){var i,n;return(null===(n=null===(i=this.dataLayerClientSettings)||void 0===i?void 0:i.loggableOperationVariablesAllowList)||void 0===n?void 0:n.includes(e))||(0,L.isBoolean)(t)||(0,L.isNumber)(t)||(0,L.isNil)(t)?t:"N/A"}}class bd extends kd{onSuccess(e){super.onSuccess(e),this._requestComplete=!0}}class wd extends kd{onSuccess(e){super.onSuccess(e),this._requestComplete=!0}}class Cd extends kd{onSuccess(e){super.onSuccess(e)}}class _d{static createDataLayerRequest(e,t,i,n,o,r,s,a,l,c,d,u,m,g,h,p,v){const y=[e,t,i,n,o,r,s,a,l,c,d,void 0,u,m,g,h,p,v];switch(t){case"mutation":return new bd(...y);case"query":return new wd(...y);case"subscription":return new Cd(...y)}}}var Td=i(61754);class Id{constructor(e,t,i,n,o){this.config=t,this.timeoutProvider=i,this.syncEngineInitializationPromise=n,this.dataLayerTarget=o,this.isRequestInProcess=!1,this.requestTimer=null,this.openRequests=new Map,this.timedOutDistinctRequestCount=0,this.failedDistinctRequestCount=0,this.timedOutOperationNames=new Set,this.failedOperationNames=new Set,this.lastSucceededRequest=this.firstTimedOutRequest=Id.DefaultRequestLoggingData,this.logger=e.newLogger("RequestHealthMonitor","core-cdl-data-layer-client")}requestCreated(e){if(!this.shouldMonitor(e))return;let t;null!==this.requestTimer||this.isRequestInProcess?t=!1:(this.startTimer(),t=!0),this.openRequests.set(e.requestId,{operationName:e.operationName,shouldTimeout:t,timeAdded:Date.now()})}requestCompleted(e,t){if(!this.shouldMonitor(e))return;this.openRequests.delete(e.requestId)||this.logger.warn(`Unknown request completed. Possibly timed out. RequestId ${e.requestId}, OperationName ${e.operationName}, Target ${this.dataLayerTarget}.`),0===this.openRequests.size&&null!==this.requestTimer&&this.clearTimer(),"success"===t&&this.onSuccess(e),"error"===t&&this.onError(e)}onSuccess(e){this.lastSucceededRequest={requestId:e.requestId,operationName:e.operationName},this.timedOutDistinctRequestCount=0,this.failedDistinctRequestCount=0,this.timedOutOperationNames.clear(),this.failedOperationNames.clear(),this.firstTimedOutRequest=Id.DefaultRequestLoggingData}onError(e){this.failedOperationNames.has(e.operationName)||(this.failedDistinctRequestCount++,this.failedOperationNames.add(e.operationName),this.failedDistinctRequestCount===this.failureCountThreshold&&this.indicateTargetUnhealthy("error"))}onTimeout(){let e=Id.DefaultRequestLoggingData,t=Number.MAX_SAFE_INTEGER;this.openRequests.forEach(((i,n)=>{if(i.shouldTimeout){const o=i.operationName;i.timeAdded<t&&(t=i.timeAdded,e={operationName:o,requestId:n}),this.logger.warn(`Request reached time out in health monitor. RequestId ${n}, OperationName ${o}, Target ${this.dataLayerTarget}.`),this.openRequests.delete(n),this.timedOutOperationNames.has(o)||(this.timedOutDistinctRequestCount++,this.timedOutOperationNames.add(o),this.timedOutDistinctRequestCount===this.timedOutCountThreshold&&this.indicateTargetUnhealthy("timedOut"))}else i.shouldTimeout=!0})),this.firstTimedOutRequest===Id.DefaultRequestLoggingData&&(this.firstTimedOutRequest=e),this.requestTimer=null,this.isRequestInProcess=!1,this.openRequests.size>0&&this.startTimer()}startTimer(){null!==this.requestTimer&&(this.logger.warn(`Health monitor timer already running when attempting to start new. Clearing old timer. Target ${this.dataLayerTarget}.`),this.timeoutProvider.clearTimeout(this.requestTimer)),this.isRequestInProcess=!0,this.syncEngineInitializationPromise.then((e=>{e.isSyncEngineInitialized&&(this.requestTimer=this.timeoutProvider.setTimeout((()=>this.onTimeout()),this.timeOutLengthMs))}))}clearTimer(){null!==this.requestTimer?(this.timeoutProvider.clearTimeout(this.requestTimer),this.requestTimer=null,this.isRequestInProcess=!1):this.logger.warn(`Health monitor timer tried to cancel non-existent timer. Ignoring. Target ${this.dataLayerTarget}.`)}indicateTargetUnhealthy(e){var t,i,n,o;let r="error"===e?`ErrorCount: ${this.failureCountThreshold}.`:`TimedOutCount: ${this.timedOutCountThreshold}. TimeOutMs: ${this.timeOutLengthMs}.`;this.config.memoryMapType&&(r=`${r} MemoryMapType: ${this.config.memoryMapType}.`);const s=`Last succeeded operation: ${this.lastSucceededRequest.operationName}, ${this.lastSucceededRequest.requestId}.`,a=`First timeout operation: ${this.firstTimedOutRequest.operationName}, ${this.firstTimedOutRequest.requestId}`,l=`RequestHealthMonitor: DataLayer is unhealthy due to successive requests failing with ${e}. Target: ${this.dataLayerTarget}. ${r} ${s} ${a}`;null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,l,"cdl_data_layer_client_request_health_monitor_unhealthy_target",void 0,!0),null===(o=(n=this.config).unhealthyDataLayerCallback)||void 0===o||o.call(n,l)}shouldMonitor(e){return"subscription"!==e.requestType}get failureCountThreshold(){return this.config.failureCountThreshold||Id.DefaultFailureCountThreshold}get timeOutLengthMs(){return(this.config.timeoutLengthSeconds||Id.DefaultTimeoutLengthSeconds)*$.NO}get timedOutCountThreshold(){return this.config.timeoutCountThreshold||Id.DefaultTimeoutCountThreshold}}Id.DefaultFailureCountThreshold=5,Id.DefaultTimeoutCountThreshold=5,Id.DefaultTimeoutLengthSeconds=60,Id.DefaultRequestLoggingData={operationName:"na",requestId:"na"};class jd{constructor(e,t,i,n,o,r,s,a,l,c,d,u,m){var g;this.logger=e,this.scenarioFactory=i,this.syncEngineInitializationPromise=o,this.leakDetectorService=r,this.dataLayerCommunicatorTarget=s,this.timeoutProvider=a,this.enableClassBasedErrors=c,this.trackingOperationsDuringWaitConfig=d,this.dataClientTrackingService=u,this.dataLayerClientSettings=m,this.requestMap=new Map,this.recentlyCancelledRequests=new Map,this.loggingContext={hostRendererId:t,component:"RequestRegistrar"},this.leakDetector=null===(g=this.leakDetectorService)||void 0===g?void 0:g.create(),l&&l.enableRequestHealthMonitor&&a&&(this.requestHealthMonitor=new Id(n,l,a,this.syncEngineInitializationPromise,s))}createRequest(e,t,i,n,o,r,s,a,l){var c;const d=_d.createDataLayerRequest(e,t,n,this.loggingContext.hostRendererId,i,this.logger,o,this.scenarioFactory,this.syncEngineInitializationPromise,r,s,this.requestHealthMonitor,this.enableClassBasedErrors,this.dataLayerCommunicatorTarget,a,l,this.dataLayerClientSettings);return null===(c=this.leakDetector)||void 0===c||c.track(`Request-${d.requestType}-${i}`,d),this.requestMap.set(e,d),Td.Q.Instance.processRequest(t,i,e),d}reconcileResponse(e,t){var i,n,o,r,s;const a=this.requestMap.get(e),l=t.data?t.data&&Object.keys(t.data).toString():"";if(this.recentlyCancelledRequests.has(e))return void this.logger.log(`Received response to a requestId that was recently cancelled. RequestId: ${e}. OperationNameHints: ${l}.`,this.loggingContext);if(!a)return void(null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`Received response to a requestId that cannot be found in the map. operationName ${l}`,"cdl_request",{operationName:l,windowId:t.windowId,callId:t.requestId,target:this.dataLayerCommunicatorTarget},!0));const c=t.extensions&&t.extensions.perfStats;let d,u;if(c||this.logger.warn(`Received response without perfStats for request. RequestId: ${e} RendererId: ${t.rendererId}, WindowId: ${t.windowId}, Target ${this.dataLayerCommunicatorTarget}`,this.loggingContext),(null===(o=this.trackingOperationsDuringWaitConfig)||void 0===o?void 0:o.enableTrackingCdlOperationsDuringWait)&&c&&c.responseSendTime){this.markResponse(a);const e=c.responseSendTime,t=Date.now();if(u=t-e,u>((null===(r=this.trackingOperationsDuringWaitConfig)||void 0===r?void 0:r.trackingCdlOperationsDuringWaitThresholdInMs)||100)){d=this.getResponsesBetweenStartAndLast(e);const i=null==d?void 0:d.reduce(((e,t)=>{const i=e.find((e=>(null==e?void 0:e.name)===t));return i?i.count++:e.push({name:t,count:1}),e}),[]);(null===(s=this.trackingOperationsDuringWaitConfig)||void 0===s?void 0:s.enableLoggingCdlOperationsDuringWait)&&this.logger.log(`${null==a?void 0:a.operationName}, sendtime: ${e}, receivetime: ${t}, latency: ${t-e}, responses received between send and receive: ${JSON.stringify(i)}`,this.loggingContext)}}const m=c;a.setResponseAndEndScenario(t,d,u),a.isComplete()&&(this.requestMap.delete(e),Td.Q.Instance.processResponse(e,m&&m.workerResponseTime))}cancelRequest({requestId:e,rendererId:t,windowId:i}){const n=this.requestMap.get(e);n?(n.cancel(),this.requestMap.delete(e),this.recentlyCancelledRequests.set(e,(new Date).getTime()),this.scheduleCancelledRequestsMapCleanup()):this.logger.debug(`Nothing to cancel, request no longer in map. RequestId: ${e} RendererId: ${t}, WindowId: ${i}, Target ${this.dataLayerCommunicatorTarget}`,this.loggingContext)}getLogs(){return JSON.stringify((0,L.map)(Array.from(this.requestMap.values()),(e=>e.toLog())),null,2)}scheduleCancelledRequestsMapCleanup(){var e;if(!this.recentlyCancelledRequestsTimer){const t=2,i=(new Date).getTime();this.recentlyCancelledRequestsTimer=null===(e=this.timeoutProvider)||void 0===e?void 0:e.setTimeout((()=>this.cleanRecentlyCancelledRequestsMap(i)),t*$.A_)}}cleanRecentlyCancelledRequestsMap(e){this.recentlyCancelledRequests.forEach(((t,i)=>{t<e&&this.recentlyCancelledRequests.delete(i)})),this.recentlyCancelledRequestsTimer=void 0}markResponse(e){var t;null===(t=this.dataClientTrackingService)||void 0===t||t.markResponse(e.operationName)}getResponsesBetweenStartAndLast(e){var t;return(null===(t=this.dataClientTrackingService)||void 0===t?void 0:t.getResponsesBetweenStartAndLast(e))||[]}}var Nd,Ed=i(109458),xd=i(696758);class Ad{constructor(e,t,i,n,o,r,s,a,l=!1,c=Promise.resolve({isSyncEngineInitialized:!0}),d,u,m,g){this.hostRendererId=e,this.loggerFactory=t,this.scenarioFactory=i,this.dataLayerCommunicator=n,this.leakDetectorService=o,this.splitFetchWaitMarkerInWLT=m,this.loggingContext={component:"DataLayerClient",hostRendererId:e},this.logger=new Ll(t.newLogger("CDL","core-cdl-data-layer-client")),this.logger.log("logger created for renderer",this.loggingContext),this.dataLayerCommunicator.onMessage=this.onMessageReceived.bind(this),this.requestRegistrar=new jd(this.logger,e,this.scenarioFactory,this.loggerFactory,c,this.leakDetectorService,r,s,a,l,d,u,g),this.requestId=new Ql("graphql")}execute(e,t,i,n,o,r){const s=(0,Ed.S)(e,i),a=s&&s.operation||"query";return this.executeWithQueryText(a,(0,xd.S)(e),t,i,n,o,r)}executeWithQueryText(e,t,i,n,o,r,s){const a=this.requestId.next(e),l=this.requestRegistrar.createRequest(a,e,n||e,i,this.loggerFactory,o,r,s,this.splitFetchWaitMarkerInWLT);this.logger.log("executing graphql request to data layer",Object.assign(Object.assign({requestId:l.requestId},this.loggingContext),{operationType:e,operationName:n,hostRendererId:this.hostRendererId,requestRendererId:o,requestWindowId:r})),this.dataLayerCommunicator.sendMessage({requestId:a,windowId:r,rendererId:this.hostRendererId,request:{graphqlQuery:t,variables:i},cdlOperationCustomContext:s,operationName:n});return function(e,t){const i=e.subscribe;return e.subscribe=n=>{const o=i.call(e,n),r=o.unsubscribe;return o.unsubscribe=()=>(t(),r.call(o)),o},e}(l.response,this.onUnsubscribe(l,n))}getRequestLogs(){return this.requestRegistrar.getLogs()}onUnsubscribe(e,t){return()=>{e.isComplete()||(this.logger.log("Notifying server of unsubscription",Object.assign(Object.assign({},this.loggingContext),{requestId:e.requestId,requestType:Zl,operationName:t})),this.dataLayerCommunicator.sendMessage({requestId:e.requestId,rendererId:this.hostRendererId,windowId:e.windowId,request:{graphqlQuery:Zl,variables:void 0},operationName:t}),this.requestRegistrar.cancelRequest({requestId:e.requestId,rendererId:this.hostRendererId,windowId:e.windowId}))}}onMessageReceived(e){this.requestRegistrar.reconcileResponse(e.requestId,e)}}class Dd{constructor(e,t,i,n,o,r,s,a,l,c,d,u,m,g,h,p,v,y,f,S,k,w,C){this.host=e,this.config=t,this.loggerFactory=n,this.scenarioFactory=o,this.coreSettings=r,this.dataClientTrackingService=k,this.isDisposed=!1,this.logger=n.newLogger("DataClientCoreCDLWorkerService","core-services-cdl-worker"),this.cdlWorkerHostSettingsAggregator=new md(i,r,s,n,c,m,g,h,p),this.cdlWorkerManagerInitializationPromise=Xc(e,t,this.cdlWorkerHostSettingsAggregator,n,o,r,a,l,c,this.logger,v,y,f,S,g,C,w);if(Zc(c,r,o,e,this.logger)){this.cdlWorkerStateSender=new sd(d,u,n,this);const{disableCDLWorkerHostSettingsUpdates:e}=r.get(b.J.Core);e||this.startNotifyingCDLWorkerForHostSettingsChanges()}}getCDLWorkerManager(){return this.cdlWorkerManagerInitializationPromise}getDataLayerClient(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.dataLayerClient){const e=yield this.getCDLWorkerManagerOrThrow("getDataLayerClient"),t=this.coreSettings.get(b.J.CdlWorker),{logCdlOperationsDuringWaitSettings:i}=this.coreSettings.get(b.J.Core);this.dataLayerClient=new Ad(this.config.clientId,this.loggerFactory,this.scenarioFactory,e.workerClientResponseRouter.cdlGraphQLClient,void 0,"Worker",this.host,{enableRequestHealthMonitor:!!t.enableRequestHealthMonitor,failureCountThreshold:t.requestHealthMonitorFailureCountThreshold,timeoutCountThreshold:t.requestHealthMonitorTimeoutCountThreshold,timeoutLengthSeconds:t.requestHealthMonitorTimeoutLengthSeconds,memoryMapType:(0,nd.qo)(this.coreSettings)},!!t.enableClassBasedErrors,e.syncEngineInitializationPromise,{enableLoggingCdlOperationsDuringWait:null==i?void 0:i.enableLoggingCdlOperationsDuringWait,enableTrackingCdlOperationsDuringWait:null==i?void 0:i.enableTrackingCdlOperationsDuringWait,trackingCdlOperationsDuringWaitThresholdInMs:null==i?void 0:i.trackingCdlOperationsDuringWaitThresholdInMs},this.dataClientTrackingService,!!t.splitFetchWaitMarkerInWLT,{cdlSubscriptionAggregatorAllowList:t.cdlSubscriptionAggregatorAllowList||void 0,loggableOperationVariablesAllowList:t.loggableOperationVariablesAllowList||void 0,cdlSubscriptionAggregatorLogIntervalMS:t.cdlSubscriptionAggregatorLogIntervalMS||void 0})}return this.dataLayerClient}))}getControlPlaneCommunicator(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.controlPlaneCommunicator){const e=yield this.getCDLWorkerManagerOrThrow("getControlPlaneCommunicator");this.controlPlaneCommunicator=new ad(e.workerClientResponseRouter,{loggerFactory:this.loggerFactory})}return this.controlPlaneCommunicator}))}dispose(){this.cdlWorkerStateSender&&this.cdlWorkerStateSender.dispose(),this.cdlWorkerHostSettingsAggregator.cleanup(),this.isDisposed=!0}logoutCurrentUser(e){var t,i,n,r,s,a;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=e.get(b.J.CdlWorker).maxLogoutTime||5e3;if(this.isDisposed)return void(null===(i=(t=this.logger).warnToTelemetry)||void 0===i||i.call(t,"Unable to cleanup CDL Worker: Already disposed.","cdl_services_worker_worker_service_logout_current_user_error",void 0,!0));const l=yield this.getCDLWorkerManager();if(l)try{yield(0,W.E)(l.workerClientResponseRouter.cdlSyncEngineClient.sendRequest({type:"logout",subType:"",params:void 0}),o,`logout request to CDL worker timed out after ${o} ms`)}catch(e){null===(a=(s=this.logger).errorToTelemetry)||void 0===a||a.call(s,`Failed to cleanup CDL Worker on logout. ${e&&e.code===f.jK.TimedOut?e.message:""}`,"cdl_services_worker_worker_service_logout_current_user_error",void 0,!0)}else null===(r=(n=this.logger).warnToTelemetry)||void 0===r||r.call(n,"Unable to cleanup CDL Worker: Worker manager not available.","cdl_services_worker_worker_service_logout_current_user_error",void 0,!0)}))}getDebugService(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.debugService){const{DataClientCoreCDLWorkerDebugService:e}=yield i.e(583194).then(i.bind(i,156780));this.debugService=new e(this.loggerFactory,this)}return this.debugService}))}getDataLayerRequestLogs(){var e,t;if(!this.dataLayerClient)return"Data layer client unavailable.";if(this.coreSettings.get(b.J.CdlWorker).disableOperationsInLogFiles)return"Data layer request logs disabled by setting 'disableOperationsInLogFiles'.";try{return(null===(t=(e=this.dataLayerClient).getRequestLogs)||void 0===t?void 0:t.call(e))||"Data layer client has not implemented request logs."}catch(e){return`Data layer client failed to get logs: ${(0,se.VK)(e)}.`}}startNotifyingCDLWorkerForHostSettingsChanges(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let i;try{i=yield this.getCDLWorkerManager()}catch(i){return void(null===(t=(e=this.logger).errorToTelemetry)||void 0===t||t.call(e,`Unable to start notifying CDL Worker for host settings changes: getCDLWorkerManager failed: ${i.message}.`,"cdl_services_worker_worker_service_notify_worker_host_settings_changes_error",void 0,!0))}i?(this.cdlWorkerHostSettingsAggregator.startNotifyingCDLWorkerForHostSettingsChanges(i.workerClientResponseRouter.cdlControlClient),this.logger.log("Start notifying CDL Worker for host settings changes.")):this.logger.log("Unable to start notifying CDL Worker for host settings changes: Worker manager not available.")}))}getCDLWorkerManagerOrThrow(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.getCDLWorkerManager();if(!t)throw(0,se.Tr)(Dd.ComponentName,f.jK.NotInitialized,e,void 0,"Worker manager is not initialized");return t}))}}Dd.ComponentName="DataClientCoreCDLWorkerService",function(e){e.NoLog="no_logs",e.Activities="activities_logs",e.AllConversations="all_conversations_logs",e.AppsPlatform="apps_platform_logs",e.Calendar="calendar_logs",e.ChannelInfoPane="channel-info-pane",e.ChatInfoPane="chat-info-pane",e.ConversationFolder="conversation-folder",e.Diagnostics="diagnostics_logs",e.Files="files_logs",e.Messaging="messaging_logs",e.People="people_logs",e.Presence="presence_logs",e.MTMAAggregator="mtma_aggregator",e.UserPreferences="user_preferences_logs",e.TeamsAndChannels="teams_and_channels_logs",e.MeetForWork="meet_for_work_logs",e.Discover="discover_logs"}(Nd||(Nd={}));class Fd{constructor(e,t,i,n,o){this.cdlWorkerManager=e,this.logger=t,this.authenticationService=i,this.getDataLayerRequestLogs=n,this.cacheStorage=o,this.workerGetLogsTimeoutMs=18e3,this.logsProviderName="CdlWorkerLogsProvider"}getLogsFiles(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let t;const i=this.getWorkerDiagnosticsLogsFromCdlWorkerManager(),n=this.getVerboseWorkerLogs(this.cdlWorkerManager.workerType),o=yield this.authenticationService.getUser();if(o&&o.isAuthenticated)t=this.getSyncEngineLogsFromCdlWorkerManager();else{const e="Sync logs cannot be retrieved for unauthenticated users.";t=Promise.resolve([{isPiiFree:!0,fileName:"sync-failure-logs.txt",content:e}]),this.logger.warn(e)}const[r,s,a]=yield Promise.all([this.timeoutSafeGetLogsFiles(i,{diagnosticsEvents:void 0,coreSettingsSnapshot:""},"workerDiagnostics"),this.timeoutSafeGetLogsFiles(n,[],"workerVerboseDiagnostics"),this.timeoutSafeGetLogsFiles(t,[],"workerSyncDiagnostics")]);return[{isPiiFree:!r.diagnosticsEvents||!!e,fileName:"cdl-worker-diagnostics-logs.txt",content:r.diagnosticsEvents?(0,x.Mf)(e?r.diagnosticsEvents.filter((e=>e.isPiiFree)):r.diagnosticsEvents):"No logs found"},{isPiiFree:!0,fileName:"cdl-worker-settings.json",content:r.coreSettingsSnapshot},{isPiiFree:!1,fileName:"cdl-worker-requests.txt",content:this.getDataLayerRequestLogs()},...a,...s]}))}subscribeToCoreSettings(e){if(!e)return void this.logger.error("Failed to subscribe to core settings");e.getObservable(b.J.Diagnostics,["workerGetLogsTimeoutMs"]).subscribe((({workerGetLogsTimeoutMs:e})=>{e&&(this.workerGetLogsTimeoutMs=e)}))}getVerboseWorkerLogs(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.cacheStorage){const t=new Qc(this.cacheStorage,this.logger),i=yield t.getWorkerVerboseLog(e);if(""!==i)return Promise.resolve([{isPiiFree:!1,fileName:"verbose-worker-logs.txt",content:i}])}return Promise.resolve([])}))}getWorkerDiagnosticsLogsFromCdlWorkerManager(){var e,t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=this.cdlWorkerManager.workerClientResponseRouter.cdlDiagnosticsClient;try{const t=yield n.sendRequest("get_logs");if(null===(e=null==t?void 0:t.response)||void 0===e?void 0:e.data)return t.response.data;this.logger.warn("Diagnostic event list empty or ill-formed")}catch(e){const n=yield this.getSyncEngineInitResultFromCdlWorkerManager(),o=`Unable to retrieve worker diagnostics logs. ${(0,se.VK)(e)}.`,r=`syncEnginePromiseResult: ${n}`;return null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`${o}::${r}`,"cdl_worker_diagnostics_logs_error",{errorMessage:o,errors:r},!0),{diagnosticsEvents:[{message:o,level:T.i.Error,isPiiFree:!0,levelName:"error",timeStamp:new Date},{message:r,level:T.i.Error,isPiiFree:!0,levelName:"error",timeStamp:new Date}],coreSettingsSnapshot:""}}return{diagnosticsEvents:void 0,coreSettingsSnapshot:""}}))}getSyncEngineInitResultFromCdlWorkerManager(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const e=yield this.cdlWorkerManager.syncEngineInitializationPromise;return JSON.stringify(e)}catch(e){return(0,se.VK)(e)}}))}getSyncEngineLogsFromCdlWorkerManager(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=[];for(const t of(0,L.values)(Nd))t!==Nd.NoLog&&t!==Nd.Diagnostics&&e.push(this.getSyncEngineLogsForTypeFromCdlWorkerManager(t));return Promise.all(e)}))}getSyncEngineLogsForTypeFromCdlWorkerManager(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=this.cdlWorkerManager.workerClientResponseRouter.cdlSyncEngineClient;let i;try{const n=yield t.sendRequest({type:"get_logs",subType:e,params:{conversationId:void 0}});(null==n?void 0:n.response)?i=n.response:(this.logger.warn(`Sync engine logs empty. LogType: ${e}`),i="No logs available.")}catch(e){const t=`Unable to retrieve sync diagnostics logs. ${(0,se.VK)(e)}`;this.logger.error(t),i=t}return{isPiiFree:!1,fileName:`sync-${this.syncEngineLogTypeToFileName(e)}-logs.txt`,content:i}}))}syncEngineLogTypeToFileName(e){switch(e){case Nd.Messaging:return"messaging";case Nd.AllConversations:return"all_conversations";case Nd.People:return"people";case Nd.Presence:return"presence";case Nd.Calendar:return"calendar";case Nd.AppsPlatform:return"apps-platform";case Nd.Activities:return"activities";case Nd.ChannelInfoPane:return"channel-info-pane";case Nd.ChatInfoPane:return"chat-info-pane";case Nd.ConversationFolder:return"conversation-folder";case Nd.MTMAAggregator:return"mtma-aggregator";case Nd.UserPreferences:return"user-preferences";case Nd.TeamsAndChannels:return"teams-and-channels";case Nd.Files:return"files";case Nd.MeetForWork:return"meet-for-work";case Nd.Discover:return"discover"}}timeoutSafeGetLogsFiles(e,t,i){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield(0,W.E)(e,this.workerGetLogsTimeoutMs)}catch(e){let t=`Failed fetching logs files from CDL Worker Logs Provider - ${i}`;(0,W.T)(e)&&(t=`Timed out fetching logs files from CDL Worker Logs Provider - ${i}`),null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,t,"cdl_get_logs_error")}return t}))}}function Od(e){var t,i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield null===(t=e.i18NextWrapper)||void 0===t?void 0:t.osLocale,s=new Dd(e.windowProvider,e.config,e.configLoader,e.loggerFactory,e.scenarioFactory,e.coreSettings,e.coreSettingsContext,e.authenticationService,e.discover,e.platformService,e.clientState,e.hostState,e.primaryUser,null===(i=e.i18NextWrapper)||void 0===i?void 0:i.locale,o,null===(n=e.i18NextWrapper)||void 0===n?void 0:n.osLocaleInfo,e.offlineCacheManager,e.authStateProvider,e.cdlWorkerRegistrarService,e.workerId,e.dataClientTrackingService,e.telemetryService,null===(r=e.altScenarioService)||void 0===r?void 0:r.altScenario);return function(e,t){const i=null==e?void 0:e.altScenario;i&&i.appendEventData({dataStoreName:(0,nd.qo)(t)})}(e.altScenarioService,e.coreSettings),s.getCDLWorkerManager().then((t=>{if(t){const{authenticationService:i,authenticationUser:n,cacheStorage:o,cdlWorkerRegistrarService:r,loggerFactory:a,logsCollectorService:l,workerId:c}=e,d=new Fd(t,a.newLogger("CdlWorkerLogsProvider","core-services-tasks"),i,(()=>s.getDataLayerRequestLogs()),o);d.subscribeToCoreSettings(e.coreSettings);const u=n&&(0,Ee.b4)(n);l.registerUserLogsProvider(u||"",d),r.registerWorker(c),function(e,t){var i,n;const{enableNetworkStateCommsBetweenCoreAndWorker:o}=e.coreSettings.get(b.J.Core);if(o){const o=i=>{const n={networkState:e.networkState.getState(),baselineNetworkStateOverride:i};t.workerClientResponseRouter.cdlNetworkStateClient.sendRequest(n)},r=e.authenticationUser&&(0,Ee.b4)(e.authenticationUser)||"",s=null===(n=(i=e.networkState).createNetworkStateTracker)||void 0===n?void 0:n.call(i,r,`CDL Worker EM [${r}]`,o);s&&t.state.setState("networkState:Loaded",s);return function(e,t){return()=>{e.unsubscribe(),t.dispose()}}(e.networkState.observe().subscribe((e=>{const i={networkState:e};t.workerClientResponseRouter.cdlNetworkStateClient.sendRequest(i)})),s)}}(e,t),function(e,t){const{enableEndpointsHealthCommsBetweenCoreAndWorker:i}=e.coreSettings.get(b.J.Core);if(i){const i=e.endpointsHealthService;if(null==i?void 0:i.getEndpointsHealthUpdateHandler){const e=i.getEndpointsHealthUpdateHandler();t.state.setState("endpointsHealthUpdateHandler:Loaded",e),e.onStateDumpRequest((()=>{const e="get_health_state";t.workerClientResponseRouter.cdlEndpointsHealthClient.sendRequest(e)}))}}}(e,t),function(e){(0,Ei.G)().setCdlContextCallback(((t,i,n)=>{e.workerClientResponseRouter.telemetryClient.sendRequest({requestOperationtype:"setContext",context:{[t]:i},userContextId:n})}))}(t)}})),yield(0,Fa._)(1),s}))}function Md(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield Rd(e);return!!i&&!!t&&i.id===t.id}))}function Rd(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield null===(t=null==e?void 0:e.getCachedUsers)||void 0===t?void 0:t.call(e,Object.assign(Object.assign({},Ue({source:k.D.Core})),{scenarioName:U.RG.AuthWebCachedUser}),{isPrimaryUser:!0}),n=null==i?void 0:i[0];if(n)return(0,Ee.KQ)(n)}))}class Pd extends Ce.i{constructor(){super(f.Yg.CreateCDLWorkerOnAuthUserTask,["altScenarioService","authenticationService","clientState","config","configLoader","coreSettings","coreSettingsContext","diagnosticsService","discover","endpointsHealthService","hostState","i18NextWrapper","loggerFactory","logsCollectorService","networkState","platformService","scenarioFactory","windowProvider","telemetryService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{altScenarioService:t,authenticationService:i,clientState:n,config:r,configLoader:s,coreSettings:a,coreSettingsContext:l,diagnosticsService:c,discover:d,endpointsHealthService:u,hostState:m,i18NextWrapper:g,loggerFactory:h,logsCollectorService:p,networkState:v,platformService:y,scenarioFactory:f,windowProvider:S,telemetryService:k}=e,{authenticationUser:w,authStateProvider:C,cacheStorage:_,cdlWorkerRegistrarService:T,dataClientTrackingService:I,offlineCacheManager:j}=e,N=h.newLogger("CreateCDLWorkerOnAuthUserTask","core-services-tasks"),E=(0,nd.Q6)(a),{enableMTMA:x,disableExperience:A}=a.get(b.J.Core),{crossCloudMeetingEnabled:D}=a.get(b.J.HostCapabilities),F=A&&(null==w?void 0:w.role)!==Es.w4.Anonymous,O=A&&!1===D&&(null==w?void 0:w.role)===Es.w4.Anonymous;if(!E||!x)return N.warn(`Not creating worker as cdl worker or mtma is not enabled. isCdlWorkerEnabled: ${E}, isMTMAEnabled: ${x}`),Promise.resolve();if(!w||!T)return N.warn("Not creating worker as authenticated user is not available or cdl worker registrar service is undefined."),Promise.resolve();if(F||O)return N.warn("Not creating worker as experience is disabled for the user and it is not a CCM/CCA sign in."),Promise.resolve();const M=null==w?void 0:w.id;if(T.isWorkerRegistered(M)||T.useInitTaskWorker)return N.log(`Not creating a worker as we already have created worker workerId: ${M} for the user oid: ${w.profile.objectId},\n         tid: ${w.profile.tenantId}`),void(T.useInitTaskWorker=!1);let R;return N.log(`Creating a worker with id: ${M} for the user oid: ${w.profile.objectId},\n       tid: ${w.profile.tenantId}`),x&&(R=yield Rd(i)),e.cdlWorkerService=yield Od({altScenarioService:t,authenticationService:i,authenticationUser:w,authStateProvider:C,cacheStorage:_,cdlWorkerRegistrarService:T,clientState:n,config:r,configLoader:s,coreSettings:a,coreSettingsContext:l,dataClientTrackingService:I,diagnosticsService:c,discover:d,endpointsHealthService:u,hostState:m,i18NextWrapper:g,loggerFactory:h,logsCollectorService:p,networkState:v,offlineCacheManager:j,platformService:y,primaryUser:R,scenarioFactory:f,windowProvider:S,workerId:M,telemetryService:k}),e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t;"signout"===e&&(null===(t=T.activeWorkers)||void 0===t||t.delete(M))}))}))}}class Ld extends Ce.i{constructor(){super(f.Yg.CreateCDLWorkerOnInitTask,["altScenarioService","authenticationService","clientState","config","configLoader","coreSettings","coreSettingsContext","diagnosticsService","discover","endpointsHealthService","hostState","i18NextWrapper","loggerFactory","logsCollectorService","networkState","platformService","scenarioFactory","windowProvider","cdlWorkerRegistrarService","telemetryService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{altScenarioService:t,authenticationService:i,clientState:n,config:o,configLoader:r,coreSettings:s,coreSettingsContext:a,diagnosticsService:l,discover:c,endpointsHealthService:d,hostState:u,i18NextWrapper:m,loggerFactory:g,logsCollectorService:h,networkState:p,platformService:v,scenarioFactory:y,windowProvider:f,cdlWorkerRegistrarService:S,telemetryService:k}=e,{authenticationUser:w,authStateProvider:C,cacheStorage:_,dataClientTrackingService:T,offlineCacheManager:I}=e,j=g.newLogger("CreateCDLWorkerOnInitTask","core-services-tasks");if(!(0,nd.Q6)(s))return void j.warn("Not creating worker as CDL worker is not enabled");const N=w?w.id:(0,xe.v4)();let E;const{enableMTMA:x}=s.get(b.J.Core);if(x){if(!S)return void j.warn("Not creating worker as cdlWorkerRegistrarService is undefined");j.log(`Creating CDL worker with id ${N} for user oid:${null==w?void 0:w.profile.objectId}, tid: ${null==w?void 0:w.profile.tenantId}`),E=yield Rd(i)}else j.log("MTMA is not enabled. Creating a CDL worker with default workerId");e.cdlWorkerService=yield Od({altScenarioService:t,authenticationService:i,authenticationUser:w,authStateProvider:C,telemetryService:k,cacheStorage:_,cdlWorkerRegistrarService:S,clientState:n,config:o,configLoader:r,coreSettings:s,coreSettingsContext:a,dataClientTrackingService:T,diagnosticsService:l,discover:c,endpointsHealthService:d,hostState:u,i18NextWrapper:m,loggerFactory:g,logsCollectorService:h,networkState:p,offlineCacheManager:I,platformService:v,primaryUser:E,scenarioFactory:y,windowProvider:f,workerId:N})}))}}var Ud,Wd=i(607586);class Bd{constructor({loggerFactory:e}){this.initTaskWorkerId="",this.mainWindowWorkerId=void 0,this.useInitTaskWorker=!0,this.activeWorkers=new Set,this.userRegisteredActiveWorkers=new Map,this.formatUserId=e=>e.replace(Wd.V.User,""),this.logger=e.newLogger("DataClientCoreCDLWorkerRegistrarService","core-services-cdl-worker")}setMainWindowWorkerByUserId(e){var t,i;e=this.formatUserId(e),this.userRegisteredActiveWorkers.has(e)?this.mainWindowWorkerId=this.userRegisteredActiveWorkers.get(e):null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`No registered active worker for user id ${e}`,"cdl_registrar_service_no_registered_active_worker",void 0,!0)}isWorkerRegistered(e){return this.activeWorkers.has(e)}mapUserIdToRegisteredWorker(e,t){var i,n;t=this.formatUserId(t),this.isWorkerRegistered(e)||(null===(n=(i=this.logger).warnToTelemetry)||void 0===n||n.call(i,`${e} wasn't tracked yet was registered to active user. Tracking worker.`,"cdl_registrar_service_map_user_worker_not_registered",void 0,!0),this.registerWorker(e)),this.userRegisteredActiveWorkers.set(t,e)}registerWorker(e){var t,i;this.isWorkerRegistered(e)?null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`${e} is already being tracked by cdl worker registrar service; skipping.`,"cdl_registrar_service_worker_already_registered",void 0,!0):(this.activeWorkers.add(e),this.initTaskWorkerId||(this.initTaskWorkerId=e,this.mainWindowWorkerId=e))}}class $d extends Ce.i{constructor(){super(f.Yg.CreateCDLWorkerRegistrarServiceTask,["loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{loggerFactory:t}=e;return e.cdlWorkerRegistrarService=new Bd({loggerFactory:t}),Promise.resolve()}))}}!function(e){e.LifeCycleScopeChange="LifeCycleScopeChange"}(Ud||(Ud={}));class Hd extends Ce.i{constructor(){super(f.Yg.CreateChangeReporting,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.schedulerChangeReporting=new Oo,e.experienceChangeReportingService=new Oo,e.lifeCycleScopeChangeReportingService=new Oo,e.commandResultChangeReportingService=new Oo,e.commandChangeReportingService=new Oo}))}}const qd="local-user-preferences",zd={theme:{userTheme:"light",followOsTheme:!0,isClassicTheme:!1,isCallingWindowDarkTheme:!1},animation:{disableAnimations:void 0},infoPane:{chatContextualSearch:"closed",channelcontextualsearch:"closed",chatHighlightsDetails:"closed",chatfluidthread:"closed"},flyoutCamera:{cameraState:"notSet"},promo:{badgeActionComplete:!1,labelActionComplete:!1,teamsInsiderLabelActionComplete:!1,teamsInsiderBadgeActionComplete:!1},density:{chatDensity:"comfy"},performance:{mode:"normal"},appSwitcher:{checkboxChecked:!1,multipleTabsCheckboxChecked:!1},videoEffect:{lastUsedVideoFilter:void 0,lastUsedBackgroundImage:void 0},backgroundEffect:{lastUsedBackgroundEffect:void 0},avatar:{lastUsedAvatarFilter:void 0,hasUsedInMeeting:!1},teamLayout:{currentLayout:void 0},diagnosticsLogs:{shouldPersistLogsIntoIDB:!1},windowing:{shouldOpenContentInNewWindow:!1},lockScreenInCall:{turnOffMediaOnDeviceLock:!1},messagePreviews:{messagePreviewsSetting:"default"},composeSpellcheck:{disableDefaultSpellcheck:!1},copilotInChatList:{shouldShowMetaOSCopilotApp:!0},peopleAppColumns:{persistentPeopleAppColumns:[]},simpleCollab:{hasUserEnabledSimpleCollabApp:!1}},Vd={get:()=>null,set:()=>{}};class Gd{constructor(e,t=Vd){this.storage=t,this.subjectCache=new Map,this.logger=e.newLogger("ClientPreferencesService","services-io-browser-client-preferences"),this.clientPreferences=this.hydrateClientPreferences()}getPreferences(e){return this.clientPreferences[e]}getAllPreferences(){return this.clientPreferences}updatePreferences(e){const t=this.clientPreferences;this.clientPreferences=(0,L.merge)({},this.clientPreferences,e),this.storage.set(qd,JSON.stringify(this.clientPreferences)),this.subjectCache.forEach(((e,i)=>{(0,L.isEqual)(t[i],this.clientPreferences[i])||(this.logger.log(`Notifying subscribers of: '${i}', settings changed to: `,this.clientPreferences[i]),e.next(this.clientPreferences[i]))}))}getPreferenceObservable(e){return this.createOrGetSubjectFromCache(e).asObservable()}createOrGetSubjectFromCache(e){const t=this.subjectCache.get(e);if(t)return t;const i=this.getPreferences(e),n=new r.X(i);return this.subjectCache.set(e,n),this.logger.log(`Creating subject for '${e}' category, settings:`,i),n}hydrateClientPreferences(){try{const e=this.storage.get(qd);if(!e)return this.logger.log("Client preferences were not found in local storage; returning defaults."),zd;this.logger.log("Client preferences was found in local storage.");const t=JSON.parse(e);return(0,L.defaultsDeep)(t,zd)}catch(e){return this.logger.error("Unable fetch client preferences from local storage. ",e),zd}}}class Jd extends Ce.i{constructor(){super(f.Yg.CreateClientPreferences,["localStorage","loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{localStorage:t,loggerFactory:i}=e;e.clientPreferences=new Gd(i,{set:(e,i)=>t.set(e,i,"Framework","Experience"),get:e=>t.get(e,"Experience")})}))}}class Kd extends Ce.i{constructor(){super(f.Yg.CreateCommandDelegator,["activeWindowsService","appsRegistryService","client","clientPreferences","commandChangeReportingService","commandHandler","coreSettings","loggerFactory","scenarioFactory","shortcutExecutionService","userBiService","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,appsRegistryService:i,client:n,clientPreferences:o,commandChangeReportingService:r,commandHandler:s,coreSettings:a,loggerFactory:l,scenarioFactory:c,shortcutExecutionService:d,userBiService:u,windowProvider:m}=e,g=(e,s)=>Tt({activeWindowsService:t,appsRegistryService:i,client:n,clientPreferences:o,commandChangeReportingService:r,commandHandler:s,commandInput:e,coreSettings:a,loggerFactory:l,scenarioFactory:c,shortcutExecutionService:d,host:m,userBiService:u});e.delegatedCommanding=new It(s,g),e.commandDelegator=g}))}}class Qd extends Ce.i{constructor(){super(f.Yg.CreateCommandHandler,["activeWindowsService","appsRegistryService","client","commandChangeReportingService","coreSettings","experienceChangeReportingService","loggerFactory","platformService","scenarioFactory","userBiService","notificationsHandler","clientPreferences","userTrackingService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,appsRegistryService:i,authenticationUser:n,client:o,commandChangeReportingService:r,coreSettings:s,experienceChangeReportingService:a,loggerFactory:l,platformService:c,scenarioFactory:d,userBiService:u,notificationsHandler:m,clientPreferences:g,userTrackingService:h}=e;e.commandHandler=(e,p)=>fi({activeWindowsService:t,appsRegistryService:i,authenticationUser:n,client:o,commandChangeReportingService:r,coreSettings:s,entityCommandInput:e,experienceChangeReportingService:a,loggerFactory:l,platformService:c,scenarioFactory:d,clientLaunchId:p,userBiService:u,notificationsHandler:m,clientPreferences:g,userTrackingService:h})}))}}var Yd=i(342737);const Xd=[Ae.B.Abandoned,Ae.B.Close,Ae.B.IntentTransferredCrossCloud],Zd=[Ae.B.Incomplete,Ae.B.WindowNotUpdated],eu=[Ae.B.Blanked,Ae.B.CommandHandledByOnCommandReceived,Ae.B.CommandHandledPriorToResolution,Ae.B.EventHandled,Ae.B.Hidden,Ae.B.LayoutRendered,Ae.B.LayoutRenderUpdated,Ae.B.NotHandled,Ae.B.Toggled],tu=[Ae.B.Failure,Ae.B.SlotPhasedRenderingTimedOut];function iu(e){switch(e){case Ae.B.ApplicationHookReceivedCommand:case Ae.B.CommandBeforeGetAppViewEntities:case Ae.B.RenderStarted:case Ae.B.ChunkLoadStarted:case Ae.B.ChunkLoadSucceeded:case Ae.B.Rendered:return!0;default:return!1}}const nu={[U.RG.ClientStart]:24e4},ou="command-result-service";class ru{constructor(e,t,i,n){this.commandChangeReportingService=t,this.commandResultChangeReportingService=i,this.host=n,this.logger=e.newLogger(ou,"core-services-entity-commanding"),this.pendingCommands=new Map}init(){this.commandChangeSubscription=this.setUpCommandChangeSubscriptions()}destroy(){var e;this.pendingCommands.clear(),null===(e=this.commandChangeSubscription)||void 0===e||e.unsubscribe()}registerForCommandTimeOut(e,t){const i=this.pendingCommands.get(e);i&&(i.onCommandTimeOut=t)}unRegisterForCommandTimeOut(e){const t=this.pendingCommands.get(e);t&&(t.onCommandTimeOut=void 0)}onCommandChange(e){switch(e.type){case Ae.B.ScenarioEventDataAppended:case Ae.B.ScenarioMarked:case Ae.B.Rendered:break;case Ae.B.CommandMetaDataAdded:{const{context:{contentExistsAndHasChanged:t},correlationId:i}=e,n=this.pendingCommands.get(i);n&&void 0!==t&&(this.logger.log(`CommandMetaDataAdded: contentExistsAndHasChanged=${t}`),n.contentExistsAndHasChanged=t);break}case Ae.B.DelegatedCommandReceived:case Ae.B.EventBubbled:{const{context:{correlation:t},correlationId:i}=e;let n=this.pendingCommands.get(i);n||(n=this.createPendingCommand({correlation:t}),this.pendingCommands.set(i,n));break}case Ae.B.CommandStart:{const{correlationId:t,context:{entityCommand:i},userContextId:n}=e;let o=this.pendingCommands.get(t);o?o.entityCommand=i:o=this.createPendingCommand({entityCommand:i,userContextId:n}),this.pendingCommands.set(t,o);break}case Ae.B.NavigationCommandStart:{const{correlationId:t,context:{correlation:i},userContextId:n}=e;let o=this.pendingCommands.get(t);o||(o=this.createPendingCommand({correlation:i,userContextId:n})),this.pendingCommands.set(t,o);break}case Ae.B.Incomplete:case Ae.B.Failure:{const{correlationId:t,context:{errorInfo:i,errorMessage:n,showOops:o,eventData:r},userContextId:s}=e,a=this.pendingCommands.get(t);a&&this.calculateCommandResult(a,e.type,s,{errorInfo:i,errorMessage:n,showOops:o,eventData:r});break}default:{const{type:t,correlationId:i,context:{eventData:n}}=e,o=this.pendingCommands.get(i);if(o&&o.previousEvents.has(t))break;o&&this.calculateCommandResult(o,e.type,e.userContextId,{eventData:n});break}}}createPendingCommand({correlation:e,entityCommand:t,userContextId:i}){if(!(e=null!=e?e:null==t?void 0:t.command.correlation)){const e=new Error("correlation cannot be undefined. A valid entityCommand or correlation should be passed.");throw this.logger.errorToTelemetry&&this.logger.errorToTelemetry(e.message,"webclient_framework_foundation_command_reporting_service_event",void 0,!0),e}const n=e.id,o=this.host.setTimeout(this.getCommandTimeoutHandler(n,i),this.getCommandTimeout(e));return{contentExistsAndHasChanged:void 0,correlation:e,entityCommand:t,previousEvents:new Set,timeoutId:o}}getCommandTimeoutHandler(e,t){return()=>{var i;const n=this.pendingCommands.get(e);if(n){const{previousStep:o}=n,r=function(e){return e&&iu(e)?De.y.TimeoutRunningApp:De.y.TimeoutRunningCore}(o);null===(i=n.onCommandTimeOut)||void 0===i||i.call(n),this.logger.error(`Command error, correlationId: ${e}, reason ${r}, previousStep: ${o}`),this.onCommandResult(Yd.P.Failure,e,r,o,t,{errorCode:r})}}}setUpCommandChangeSubscriptions(){return this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e)))}getCommandTimeout({id:e,scenarioName:t}){return t&&nu[t]?(this.logger.log(`Increasing the command timeout (${nu[t]}) during ${t}, correlationId: ${e}`),nu[t]):12e4}calculateCommandResult(e,t,i,n){var o;const{previousStep:r,correlation:{id:s}}=e;if(e.previousEvents.add(t),e.previousStep=t,function(e){return eu.includes(e)}(t))this.onCommandResult(Yd.P.Success,s,t,r,i,{eventData:null==n?void 0:n.eventData});else if(function(e){return tu.includes(e)}(t)){const e=(a=t,l=null==n?void 0:n.errorInfo,a===Ae.B.SlotPhasedRenderingTimedOut?De.y.SlotPhasedRenderingTimedOut:l||De.y.UnknownCommandError),c=(null==n?void 0:n.errorMessage)||(null===(o=null==n?void 0:n.eventData)||void 0===o?void 0:o.errors);this.logger.error(`Command error, correlationId: ${s}, reason ${e}, previousStep: ${r}`),this.onCommandResult(Yd.P.Failure,s,e,r,i,{errorCode:e,errorMessage:c,eventData:null==n?void 0:n.eventData})}else if(function(e,t){return e===Ae.B.RenderStarted&&!1===t}(t,e.contentExistsAndHasChanged)){const e=De.y.AlreadyRendered;this.onCommandResult(Yd.P.Incomplete,s,e,r,i,{errorCode:e,eventData:null==n?void 0:n.eventData})}else if(function(e){return Xd.includes(e)}(t)){const e=function(e,t){return e===Ae.B.Close?t&&iu(t)?De.y.WindowCloseRunningApp:De.y.WindowCloseRunningCore:e===Ae.B.Abandoned?Ae.B.Abandoned:e===Ae.B.IntentTransferredCrossCloud?Ae.B.IntentTransferredCrossCloud:De.y.UnknownCommandError}(t,r);this.onCommandResult(Yd.P.Canceled,s,e,r,i,{errorCode:e,eventData:null==n?void 0:n.eventData}),this.logger.log(`Command abandoned, correlationId: ${s}, reason ${e}, previousStep: ${r}`)}else if(function(e){return Zd.includes(e)}(t)){const e=(null==n?void 0:n.errorInfo)||t;this.onCommandResult(Yd.P.Incomplete,s,e,r,i,{errorCode:e,eventData:null==n?void 0:n.eventData}),this.logger.log(`Command incomplete, correlationId: ${s}, reason ${t}, previousStep: ${r}`)}var a,l}onCommandResult(e,t,i,n,o,r){const s=this.pendingCommands.get(t);s&&(this.reportCommandResult(t,o,e,i,n,s,r),this.cleanUpPendingCommand(t,s))}cleanUpPendingCommand(e,{timeoutId:t}){this.host.clearTimeout(t),this.pendingCommands.delete(e)}reportCommandResult(e,t,i,n,o,r,s){const{entityCommand:a}=r;this.commandResultChangeReportingService.report({correlationId:e,userContextId:t,context:{entityCommand:a,error:(null==s?void 0:s.errorCode)||(null==s?void 0:s.errorMessage)?{errorCode:null==s?void 0:s.errorCode,errorMessage:null==s?void 0:s.errorMessage}:void 0,previousStep:o,reason:n,target:ou,eventData:null==s?void 0:s.eventData},type:i})}}var su=i(818442),au=i(878652);const lu={eventId:"executeEntityCommand"};function cu(e,t,i,n){const{replyContent:o}=e,{id:r,type:s}=t;if(n)switch(s){case pe.py.chats:return function({actionType:e,convId:t,userContextId:i,toastType:n},o,r){let s=Di.u.unknown;if("quickReply"===e)s=Di.u.quickReply;else{const e=`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host with unknown chats action Type`;r.errorToTelemetry&&r.errorToTelemetry(e,"webclient_framework_host_comms",void 0,!0)}return{actionType:s,convId:t||void 0,message:o,userContextId:i,toastType:n}}(n,o,i);case pe.py.calls:return function({actionType:e,userContextId:t,toastType:i},n,o){return e||(o.errorToTelemetry&&o.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host with unknown calls action type`,"webclient_framework_host_comms",void 0,!0),e="Unknown"),{actionType:e,toastId:n||void 0,toastType:i,userContextId:t}}(n,r,i);case pe.py.communities:case pe.py.communitiesjoinrequest:case pe.py.communitiesmembers:return function({actionType:e,userContextId:t,toastType:i,teamId:n,messageId:o},r){return i||(r.errorToTelemetry&&r.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host with unknown communities toast type`,"webclient_framework_host_comms",void 0,!0),i="Unknown"),{actionType:e,toastType:i,userContextId:t,messageId:o,teamId:n}}(n,i);case pe.py.callingdeeplink:return function({actionType:e,userContextId:t,toastType:i},n,o){return e||(o.errorToTelemetry&&o.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host with unknown calls action type`,"webclient_framework_host_comms",void 0,!0),e=Di.u.unknown),{actionType:e,toastId:n||void 0,toastType:i,userContextId:t}}(n,r,i);default:return void(i.errorToTelemetry&&i.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Unkown target entity type received from host for toast activation command`,"webclient_framework_host_comms",void 0,!0))}else i.errorToTelemetry&&i.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host without target host entity options`,"webclient_framework_host_comms",void 0,!0)}function du(e,t){switch(e){case S.A$.mutate:return pe.uk.mutate;case S.A$.view:return pe.uk.view;case S.A$.list:return pe.uk.list;case S.A$.join:return pe.uk.join;default:return t.errorToTelemetry&&t.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host with unknown entity action. Defaulting to view.`,"webclient_framework_host_comms",void 0,!0),pe.uk.view}}function uu(e,t){const{entity:i,entityOptions:n,command:o}=e,{visibilityState:r,correlation:s}=o,{id:a,startTimestamp:l,source:c}=s,d=null==n?void 0:n.toastActivationEntityOptions;if(t.log(`Converting host entity command, type ${null==i?void 0:i.type}, action ${null==i?void 0:i.action}, id ${null==i?void 0:i.id}`),t.log(`toastActivationEntityOptions ${d}, visibilityState ${r}`),!d)return lu;if(!i)return lu;const{optionsJson:u}=i,m=function(e,t){const{id:i,type:n,action:o,linkedEntity:r}=e;return{action:du(o,t),id:i,linkedEntity:Cu(r,t),type:gu(n,t)}}(i,t),g=u?(0,au.D)(u,void 0):void 0;return Object.assign(Object.assign({},lu),{payload:{entity:m,command:{visibilityState:hu(r,t),correlation:{id:a,startTimestamp:l?l.getTime():void 0,source:c,scenarioName:U.RG.ToastActivation},stateTransition:_u(i.type,t)},entityOptions:mu(g),dataOptions:i.action===S.A$.mutate||i.type===S.dt.communities||i.type===S.dt.reminders||i.type===S.dt.callingdeeplink||i.type===S.dt.communitiesjoinrequest||i.type===S.dt.communitiesmembers?cu(d,m,t,g):{userContextId:g.userContextId}}})}function mu(e){if((null==e?void 0:e.deepLinkId)&&!(null==e?void 0:e.coordinates))return{deepLinkId:e.deepLinkId};if((null==e?void 0:e.deepLinkId)&&(null==e?void 0:e.coordinates))return{deepLinkId:e.deepLinkId,deeplinkId:e.deepLinkId,coordinates:e.coordinates};if(null==e?void 0:e.campaignType)return{campaignType:e.campaignType};if(!(null==e?void 0:e.messageId))return;const{messageId:t,focusOnLoad:i}=e;return{messageId:t,focusOnLoad:i}}function gu(e,t){switch(e){case S.dt.chats:case S.dt.reminders:return pe.py.chats;case S.dt.calls:return pe.py.calls;case S.dt.extensions:return pe.py.extensions;case S.dt.activity:return pe.py.activity;case S.dt.campaignnotifications:return pe.py.campaignnotifications;case S.dt.channels:return pe.py.channels;case S.dt.communities:return pe.py.communities;case S.dt.communitiesevents:return pe.py.communitiesevents;case S.dt.callingdeeplink:return pe.py.callingdeeplink;case S.dt.communitiesjoinrequest:return pe.py.communitiesjoinrequest;case S.dt.communitiesmembers:return pe.py.communitiesmembers;default:return t.errorToTelemetry&&t.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host with unknown entity type. Defaulting to chats`,"webclient_framework_host_comms",void 0,!0),pe.py.chats}}function hu(e,t){switch(e){case S.S1.show:return ve.fe.show;case S.S1.hide:return ve.fe.hide;default:return t.errorToTelemetry&&t.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host with unknown visibility state. Defaulting to show`,"webclient_framework_host_comms",void 0,!0),ve.fe.show}}function pu(e,t){var i;const{command:n}=e,{correlation:o,visibilityState:r}=n;let s;return(null==o?void 0:o.startTimestamp)&&(s=new Date(+o.startTimestamp),s=ju(s)?s:void 0),{correlation:{id:null!==(i=null==o?void 0:o.id)&&void 0!==i?i:(0,xe.v4)(),startTimestamp:s,source:S.tq.toastFromWeb},visibilityState:wu(r,t)}}function vu(e,t){try{const{entity:i}=e,{action:n,id:o,type:r}=i;return{action:yu(n,t),id:o,type:ku(r)}}catch(e){throw t.errorToTelemetry&&t.errorToTelemetry(`${zs}${(0,M.u4)(e)}`,"webclient_framework_host_comms",void 0,!0),e}}function yu(e,t){switch(e){case pe.uk.mutate:return S.A$.mutate;case pe.uk.view:return S.A$.view;case pe.uk.list:return S.A$.list;case pe.uk.join:return S.A$.join;default:return t.errorToTelemetry&&t.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing}: EntityAction. Defaulting to HostEntityAction.view`,"webclient_framework_host_comms",void 0,!0),S.A$.view}}function fu(e){const{id:t,linkedEntity:i,action:n,type:o,dataOptions:r}=e;return{action:n,id:t,linkedEntity:i,type:o,optionsJson:(0,M.u4)(r)}}function Su(e){!function(e){if(!e)throw(0,se.Tr)(f.w5.Commanding,Mi.f.RequiredFieldMissing,pe.py.toasts,void 0,`${Mi.f.RequiredFieldMissing}: entityOptions`);const t=e;if(!(t.targetEntity&&t.targetEntity.action&&t.targetEntity.type&&t.targetEntity.dataOptions&&t.time&&(t.title||""===t.title)))throw(0,se.Tr)(f.w5.Commanding,Mi.f.RequiredFieldMissing,pe.py.toasts,void 0,`${Mi.f.RequiredFieldMissing}: hostEntityOptions?.toastEntityOptions`)}(e);const{buttons:t,targetEntity:i,textInput:n,time:o,isUrgent:r,bypassOsLevelDoNotDisturb:s}=e;return{toastEntityOptions:Object.assign(Object.assign({},e),{isUrgent:r||s,targetEntity:fu(i),time:o,buttons:Iu(t),textInput:bu(n)})}}function ku(e){if(e===pe.py.toasts)return S.dt.toasts;throw(0,se.Tr)(f.w5.Commanding,Mi.f.RequiredFieldMissing,pe.py.toasts,void 0,`${Mi.f.RequiredFieldMissing}: EntityType`)}function bu(e){if(!e)return;const{placeholderText:t,sendButton:i}=e;return{placeholderText:t,sendButton:i?Tu(i):void 0}}function wu(e,t){switch(e){case ve.fe.hide:return S.S1.hide;case ve.fe.show:return S.S1.show;default:return t.errorToTelemetry&&t.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing}: EntityVisibilityState. Defaulting to HostEntityVisibilityState.show`,"webclient_framework_host_comms",void 0,!0),S.S1.show}}function Cu(e,t){if(!e)return;const{id:i,type:n,action:o}=e;return{action:o?du(o,t):void 0,id:i,type:gu(n,t)}}function _u(e,t){switch(e){case S.dt.chats:case S.dt.channels:case S.dt.calls:case S.dt.campaignnotifications:return ve.su.new;case S.dt.extensions:case S.dt.reminders:case S.dt.activity:case S.dt.communities:case S.dt.communitiesevents:case S.dt.callingdeeplink:case S.dt.communitiesjoinrequest:case S.dt.communitiesmembers:return ve.su.flush;default:return t.errorToTelemetry&&t.errorToTelemetry(`${zs}${Mi.f.RequiredFieldMissing} Toast activation command received from host with unhandled host entity type - ${e}.`,"webclient_framework_host_comms",void 0,!0),ve.su.new}}function Tu(e){const{image:t,targetEntity:i,text:n,preferImageOnly:o,style:r}=e;return{image:t,preferImageOnly:o,style:r,targetEntity:fu(i),text:n}}function Iu(e){if(e)return e.map(Tu)}const ju=e=>e instanceof Date&&!isNaN(e.getTime());function Nu(e,t,i,n){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e.entity.type!==pe.py.toasts)return;let s,a,l;if((null===(r=e.command.correlation)||void 0===r?void 0:r.id)&&(s=n.findScenarioByNameAndId(U.RG.CrossClientToastView,e.command.correlation.id),a=n.findScenarioByNameAndId(U.RG.WebToastShow,e.command.correlation.id)),e.entityOptions){const t=e.entityOptions;(null==t?void 0:t.crossClientScenarioName)&&(null==t?void 0:t.callId)&&(l=n.findScenarioByNameAndId(null==t?void 0:t.crossClientScenarioName,null==t?void 0:t.callId))}const c=yield function(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let i;try{i=yield e.loadModule("core"),t.log(`${zs}${Gs.LoadModuleCoreSuccess}`)}catch(e){const i=`${zs}${Vs.LoadModuleCoreFailed} ${(0,M.u4)(e)}`;t.errorToTelemetry&&t.errorToTelemetry(i,"webclient_framework_host_comms",void 0,!0)}return i}))}(t,i);if(!c||!c.executeCommand)return i.errorToTelemetry&&i.errorToTelemetry(`${zs}${Vs.LoadModuleCoreFailed}`,"webclient_framework_host_comms",void 0,!0),null==s||s.fail({errorCode:Vs.LoadModuleCoreFailed}),null==a||a.fail({errorCode:Vs.LoadModuleCoreFailed}),void(null==l||l.fail({errorCode:Vs.LoadModuleCoreFailed}));try{const t=function(e,t){return{command:pu(e,t),entity:vu(e,t),entityOptions:Su(null==e?void 0:e.entityOptions)}}(e,i);yield null==c?void 0:c.executeCommand(t),i.log(`${zs}${Gs.ExecuteCommandSuccess}`),null==s||s.mark(U.ck.CrossClientHostEventSent),null==l||l.mark(U.ck.CrossClientHostEventSent),null==a||a.stop()}catch(e){i.errorToTelemetry&&i.errorToTelemetry(`${zs}${Vs.ExecuteCommandFailed} ${(0,M.u4)(e)}`,"webclient_framework_host_comms",void 0,!0),null==s||s.fail({errorCode:Vs.ExecuteCommandFailed}),null==a||a.fail({errorCode:Vs.ExecuteCommandFailed}),null==l||l.fail({errorCode:Vs.ExecuteCommandFailed})}}))}class Eu{constructor(e,t,i,n){this.commandChangeReportingService=e,this.commandResultChangeReportingService=t,this.scenarioFactory=i,this.pendingCommands=new Map,this.logger=n.newLogger("CommandTelemetryService","core-services-entity-commanding"),this.commandSequence=0}init(){this.commandChangeSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e))),this.commandResultChangeSubscription=this.commandResultChangeReportingService.observeChanges().subscribe((e=>this.onCommandResultChange(e)))}destroy(){var e,t,i;this.pendingCommands.clear(),null===(e=this.commandChangeSubscription)||void 0===e||e.unsubscribe(),null===(t=this.commandResultChangeSubscription)||void 0===t||t.unsubscribe(),null===(i=this.lifeCycleScopeChangeSubscription)||void 0===i||i.unsubscribe()}onCommandChange(e){switch(e.type){case Ae.B.ScenarioEventDataAppended:{const{correlationId:t,context:{eventData:i}}=e;this.appendScenarioEventData(t,i);break}case Ae.B.ScenarioMarked:{const{correlationId:t,context:{step:i,eventData:n,status:o,monitoringData:r}}=e;this.addScenarioMark(t,i,e.type,n,o,r);break}case Ae.B.Rendered:case Ae.B.CommandMetaDataAdded:break;case Ae.B.DelegatedCommandReceived:case Ae.B.EventBubbled:{const{context:{correlation:t}}=e;this.startCommandTelemetry(t.id,{correlation:t});break}case Ae.B.CommandStart:{const{correlationId:t,context:{entityCommand:i}}=e,{scenarioEventData:n}=i;this.startCommandTelemetry(t,{entityCommand:i}),n&&this.appendScenarioEventData(t,n);break}case Ae.B.NavigationCommandStart:{const{correlationId:t,context:{clientLaunchId:i,correlation:n,eventData:o}}=e;this.startCommandTelemetry(t,{correlation:n,clientLaunchId:i}),o&&this.appendScenarioEventData(t,o);break}default:{const{type:t,correlationId:i,context:{eventData:n}}=e,o=this.pendingCommands.get(i);if(o&&o.previousEvents.has(t))break;null==o||o.previousEvents.add(t),iu(t)&&(null==o||o.commandScenario.appendEventData({scenarioPhase:su.M.App})),n&&this.appendScenarioEventData(i,n),this.addScenarioMark(i,t,t,n);break}}}findExistingNavigationCommandScenario(e,t){const i=t.scenarioName||U.RG.NavigationCommand;let n=this.scenarioFactory.findScenarioByNameAndId(i,e);return(null==n?void 0:n.eventData["EventInfo.CorrelationId"])!==t.id&&(n=null),n||t.scenarioName!==U.RG.ClientStart||(n=this.scenarioFactory.findScenario(U.RG.ClientStart)),n||void 0}findExistingActivitySwitchScenario(e){const t=null==e?void 0:e.id;if((null==e?void 0:e.source)===k.D.ActivityFeedBellClick){const e=Array.from(this.pendingCommands.values());for(const i of e)if(i.correlation.scenarioName===U.RG.ActivitySwitch||i.correlation.scenarioName===U.RG.NavigationCommand){const e=i.correlation.id;this.logger.log(`Command was sent by activity app as a result of a bell click, correlationId ${t}. Combining scenario with existing ${i.correlation.scenarioName} of correlationId ${e}`);const n=i.commandScenario;return this.pendingCommands.delete(e),n}}}startCommandTelemetry(e,{entityCommand:t,correlation:i,clientLaunchId:n}){let o,r=this.pendingCommands.get(e);if(n&&i&&(o=this.findExistingNavigationCommandScenario(n,i)),!o&&t){const{scenarioName:e,id:i}=t.command.correlation;e&&(o=this.scenarioFactory.findScenarioByNameAndId(e,i))}o||(o=this.findExistingActivitySwitchScenario(i||(null==t?void 0:t.command.correlation))),r?t&&(this.logger.log(`Updating command\n\tscenarioName: ${r.commandScenario.name}\n\tcorrelationId: ${e}\n\tentityType: ${t.entity.type}\n\tentityAction: ${t.entity.action}`),r.commandScenario.appendEventData({mainEntityAction:t.entity.action,mainEntityType:t.entity.type})):r=this.createPendingCommand(e,{commandScenario:o,entityCommand:t,correlation:i,clientLaunchId:n}),this.pendingCommands.set(e,r)}createPendingCommand(e,{entityCommand:t,correlation:i,clientLaunchId:n,commandScenario:o}){var r;if(!(i=null!=i?i:null==t?void 0:t.command.correlation)){const e=new Error("correlation cannot be undefined. A valid entityCommand or correlation should be passed.");throw this.logger.errorToTelemetry&&this.logger.errorToTelemetry(e.message,"webclient_framework_foundation_command_reporting_service_event",void 0,!0),e}if(i.scenarioName=null!==(r=i.scenarioName)&&void 0!==r?r:U.RG.EntityCommand,!o){this.logger.log(`Creating new scenario with scenarioName: ${i.scenarioName}, correlationId ${e}`);const{startTimestamp:r}=i,s=r&&ju(new Date(+r))?+r:void 0,a=n;(o=this.scenarioFactory.newScenario(i.scenarioName,{startTime:s,clientId:a})).appendEventData({"EventInfo.CorrelationId":e,commandSequence:++this.commandSequence,commandSource:i.source,mainEntityAction:null==t?void 0:t.entity.action,mainEntityType:null==t?void 0:t.entity.type,scenarioPhase:su.M.Core})}return this.logger.log(`Starting to track a new command\n\tscenarioName: ${i.scenarioName}\n\tcorrelationId: ${e}\n\tentityType: ${null==t?void 0:t.entity.type}\n\tentityAction: ${null==t?void 0:t.entity.action}\n\tclientId: ${n}`),{correlation:i,commandScenario:o,previousEvents:new Set}}appendScenarioEventData(e,t){const i=this.pendingCommands.get(e);i&&i.commandScenario.appendEventData((0,L.omitBy)(t,L.isUndefined))}addScenarioMark(e,t,i,n,o,r){const s=this.pendingCommands.get(e);s&&(i!==Ae.B.ScenarioMarked&&this.logger.log(`${s.commandScenario.name} addScenarioMark, correlationId: ${e}, step: ${t}, eventData: ${JSON.stringify(n)}`),s.commandScenario.mark(t,n&&(0,L.omitBy)(n,L.isUndefined),o,r))}onCommandResultChange(e){const{context:{error:t,reason:i,previousStep:n,eventData:o,entityCommand:r},correlationId:s,type:a}=e,l=this.pendingCommands.get(s);if(!l)return void this.logger.error(`Command Result of ${i} and correlationId ${s} was reported but no pending command was found`);const c=null==l?void 0:l.commandScenario,d=(0,L.omitBy)(r&&Eu.overrideMainEntityForExtensionCommand(o,r)||o,L.isUndefined);switch(a){case Yd.P.Canceled:{const{errorCode:e}=t||{};this.logger.warn(`${c.name} Cancelled, correlationId: ${s}, reason: ${e}, previousStep: ${n}`),c.cancel(Object.assign({errorCode:e,reason:e},d));break}case Yd.P.Failure:{const{errorCode:e,errorMessage:i}=t||{};this.logger.error(`${c.name} Failed, correlationId: ${s}, reason: ${e}, errorMessage: ${i}, previousStep: ${n}`),c.fail(Object.assign({errorCode:e,reason:e,errors:i&&(0,re.A)(i)},d));break}case Yd.P.Incomplete:{const{errorCode:e}=t||{};this.logger.warn(`${c.name} Incomplete, correlationId: ${s}, reason: ${e}, previousStep: ${n}`),c.incomplete(Object.assign({errorCode:e,reason:e},d));break}case Yd.P.Success:this.logger.log(`${c.name} Successful, correlationId: ${s}, reason: ${i}, previousStep: ${n}`),c.stop(Object.assign({reason:i},d))}this.pendingCommands.delete(s)}static overrideMainEntityForExtensionCommand(e,t){return t.command.stateTransition!==ve.su.extend?e:Object.assign(Object.assign({},e),{modalEntityType:t.entity.type,modalEntityAction:t.entity.action})}}const xu=[Ae.B.ApplicationHookReceivedCommand,Ae.B.ApplicationHookContinuedCommand],Au=[Ae.B.ChunkLoadStarted,Ae.B.ChunkLoadSucceeded,Ae.B.ScenarioEventDataAppended,Ae.B.ScenarioMarked];class Du{constructor(e,t){this._host=t,this.commandTimedOutAtHostHandler=e=>{const{correlationId:t,reason:i}=e.payload,n=this._pendingCommands.get(t);n&&(n.onCommandTimeOut&&n.onCommandTimeOut(i),this.cleanUpPendingCommand(t))},this._logger=e.newLogger("CommandReportingServiceHybrid","core-services-entity-commanding"),this._pendingCommands=new Map,this._host.opener.addEventListener(O.rY.EntityCommandTimedOutAtHost,this.commandTimedOutAtHostHandler)}registerNavigationCommandStart(){}registerCommandStart(e){var t;const i=e.command.correlation.id;if(!i)return void this._logger.error("registerCommandStart called without a command correlation id");const n=this._pendingCommands.get(i);n&&(this._logger.log(`registerCommandStart called with a pending command with correlation id ${i}, overwriting and starting new timeout interval`),this._host.clearTimeout(n.timeoutId));const o=null===(t=null==n?void 0:n.entityCommand.entityOptions)||void 0===t?void 0:t.timeout,r=o||9e4,s=this._host.setTimeout((()=>{this.reportCommandEvent(i,Ae.B.CommandReportingTimedOut),this.cleanUpPendingCommand(i)}),r);this._logger.log(`Starting to track command with correlation Id ${i}`),this._pendingCommands.set(i,{entityCommand:e,timeoutId:s,previousEvents:new Set})}appendCommandEventData(e,t){const i=this._pendingCommands.get(e);i?this._pendingCommands.set(e,Object.assign(Object.assign({},i),{eventData:Object.assign(Object.assign({},i.eventData),t)})):this._logger.warn(`appendCommandEventData called with correlationId ${e}, but there was no such pending command`)}reportCommandEvent(e,t,i,n,o,r){const s=this._pendingCommands.get(e);if(!s)return;if(!Au.includes(t)&&s.previousEvents.has(t))return;s.previousEvents.add(t);const{entityCommand:a,eventData:l}=s,c=Object.assign(Object.assign(Object.assign({entityCommand:a,commandEvent:t},l),i),{timestamp:Date.now(),scenarioEventData:n,step:o,status:r});t===Ae.B.CommandReportingTimedOut||xu.includes(t)||this._logger.log(`Command event reported ${t} for correlation id ${e}`),xu.includes(t)||this._host.opener.postMessage(C.W.CommandChangeType,c)}registerForCommandTimeOut(e,t){const i=this._pendingCommands.get(e);i&&(i.onCommandTimeOut=t)}unRegisterForCommandTimeOut(e){const t=this._pendingCommands.get(e);t&&(t.onCommandTimeOut=void 0)}appendScenarioEventData(e,t){this.reportCommandEvent(e,Ae.B.ScenarioEventDataAppended,void 0,t)}addScenarioMark(e,t,i,n){this.reportCommandEvent(e,Ae.B.ScenarioMarked,void 0,i,t,n)}cleanUpPendingCommand(e){const t=this._pendingCommands.get(e);t&&(this._host.clearTimeout(t.timeoutId),this._pendingCommands.delete(e))}}class Fu{constructor(e,t){this.legacyCommandReportingService=e,this.commandChangeReportingService=t,this.commandChangeSubscription=this.setUpCommandChangeSubscriptions()}destroy(){this.commandChangeSubscription.unsubscribe()}changeToCommandReportingService(e){switch(e.type){case Ae.B.AfterOnCommandReceived:case Ae.B.AfterOnEventReceived:case Ae.B.BeforeOnCommandReceived:case Ae.B.BeforeOnEventReceived:case Ae.B.CommandHandledByOnCommandReceived:case Ae.B.EventBubbled:case Ae.B.EventHandled:case Ae.B.DelegatedCommandReceived:break;case Ae.B.ScenarioEventDataAppended:{const{context:{eventData:t},correlationId:i}=e;this.legacyCommandReportingService.appendScenarioEventData(i,t);break}case Ae.B.ScenarioMarked:{const{context:{step:t,eventData:i,status:n,monitoringData:o},correlationId:r}=e;this.legacyCommandReportingService.addScenarioMark(r,t,i,n,o);break}case Ae.B.CommandStart:{const{context:{entityCommand:t,executionContextEntity:i},correlationId:n}=e,{scenarioEventData:o}=t;this.legacyCommandReportingService.registerCommandStart(t),o&&this.legacyCommandReportingService.appendScenarioEventData(n,o),this.legacyCommandReportingService.reportCommandEvent(n,Ae.B.CommandReceived,{executionContextEntity:i});break}case Ae.B.NavigationCommandStart:{const{context:{clientLaunchId:t,correlation:i,eventData:n},correlationId:o}=e;this.legacyCommandReportingService.registerNavigationCommandStart(t,i),this.legacyCommandReportingService.addScenarioMark(o,Ae.B.DeeplinkReceived),n&&this.legacyCommandReportingService.appendScenarioEventData(o,n);break}case Ae.B.CommandMetaDataAdded:{const t=e.context,{target:i}=t,n=(0,o.__rest)(t,["target"]),{correlationId:r}=e;this.legacyCommandReportingService.appendCommandEventData(r,n);break}case Ae.B.NotHandled:{const{correlationId:t,type:i}=e;this.legacyCommandReportingService.reportCommandEvent(t,i);break}default:{const t=e.context,{target:i,eventData:n}=t,r=(0,o.__rest)(t,["target","eventData"]),{correlationId:s,type:a}=e;this.legacyCommandReportingService.reportCommandEvent(s,a,r,n);break}}}setUpCommandChangeSubscriptions(){return this.commandChangeReportingService.observeChanges().subscribe((e=>this.changeToCommandReportingService(e)))}}class Ou{constructor(e,t,i){this.commandChangeReportingService=e,this.lifeCycleScopeChangeReportingService=t,this.logger=i.newLogger("CommandAppLifeCycleListenerService","core-services-entity-commanding"),this.lifeCycleScopeChangeSubscription=this.subscribeToLifeCycleScopeChange()}destroy(){var e;null===(e=this.lifeCycleScopeChangeSubscription)||void 0===e||e.unsubscribe()}subscribeToLifeCycleScopeChange(){return this.lifeCycleScopeChangeReportingService.observeChanges().pipe((0,c.U)((({correlationId:e,context:{apps:t}})=>{let i=!1;return t.forEach((({id:t,type:n})=>{n===ft.c4.Initialized&&(i=!0,this.logger.log(`${t} initialized, correlationId: ${e}`))})),{appInitialized:i,correlationId:e}})),(0,u.h)((({appInitialized:e})=>e))).subscribe((({correlationId:e,appInitialized:t})=>{this.commandChangeReportingService.report({correlationId:e,type:Ae.B.ScenarioEventDataAppended,context:{target:"commandAppLifeCycle",eventData:{appInitialized:t}}})}))}}class Mu{constructor(e){this._cap=e,this._map=new Map}entries(){return this._map.entries()}get(e){return this._map.get(e)}set(e,t){if(this._map.size>=this._cap){const e=this._map.keys().next().value;this._map.delete(e)}return this._map.set(e,t)}}class Ru{constructor(e){this.commandChangeReportingService=e}init(){this.commandsHistory&&this.destroy(),this.commandsHistory=new Mu(30),this.initCommandChangeReportingSubscription()}destroy(){var e;null===(e=this.commandChangeReportingSubscription)||void 0===e||e.unsubscribe(),this.commandChangeReportingSubscription=void 0,this.commandsHistory=void 0}get CommandsHistory(){return this.commandsHistory}initCommandChangeReportingSubscription(){this.commandChangeReportingSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e)))}onCommandChange(e){const{correlationId:t}=e;if(this.commandsHistory)if(e.type===Ae.B.CommandStart){const{context:{entityCommand:i}}=e;let n=this.commandsHistory.get(t);const o={entityCommand:i,isCommandTargetedToMainWindow:!1,steps:[]};n=n?Object.assign(Object.assign({},n),{entityCommand:i}):o,this.commandsHistory.set(t,n)}else if(e.type===Ae.B.CommandMetaDataAdded){const{correlationId:t,context:{isCommandTargetedToMainWindow:i}}=e,n=this.commandsHistory.get(t);n&&i&&this.commandsHistory.set(t,Object.assign(Object.assign({},n),{isCommandTargetedToMainWindow:i}))}else{const i=this.commandsHistory.get(t);null==i||i.steps.push({event:e.type,timestamp:Date.now()-(parseInt(i.entityCommand.command.correlation.startTimestamp,10)||0)})}}}var Pu=i(818997);function Lu(e,t,...i){var n;const{coreSettings:o}=t,r=null!==(n=null==o?void 0:o.get(b.J.Core).enableCoreErrorsV2)&&void 0!==n&&n,s=[];for(const n of i)if(!t[n]&&(s.push(n),!r)){const t=`${e}: ${n} is missing`;throw(0,se.Tr)(f.w5.Core,f.jK.CoreServiceMissing,e,void 0,t)}if(r&&s.length>0)throw Pu.x.fromMissingDependencies(e,s);return t}class Uu extends Ce.i{constructor(){super(f.Yg.CreateCommandReportingService,[])}execute(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i="CreateCommandReportingServiceTask",{commandChangeReportingService:n,coreSettings:o,lifeCycleScopeChangeReportingService:r,loggerFactory:s,scenarioFactory:a,windowProvider:l}=Lu(i,e,"coreSettings","commandChangeReportingService","lifeCycleScopeChangeReportingService","loggerFactory","scenarioFactory","windowProvider");if(null===(t=o.get(b.J.Core))||void 0===t?void 0:t.enableStandaloneCommandReportingService){const{commandResultChangeReportingService:t}=Lu(i,e,"commandResultChangeReportingService"),r=new ru(s,n,t,l);r.init(),e.commandResultService=r,new Eu(n,t,a,s).init(),this.initCommandHistoryService(e,n,o)}else e.commandReportingService=new Du(s,l),new Fu(e.commandReportingService,n);new Ou(n,r,s),this.initCommandHistoryService(e,n,o)}))}initCommandHistoryService(e,t,i){e.commandHistoryService=new Ru(t),(null==i?void 0:i.get(b.J.Diagnostics).isDiagnosticsPanelEnabled)&&e.commandHistoryService.init()}}class Wu extends Ce.i{constructor(){super(f.Yg.CreateCommandResultHooksService,[])}execute(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{appsRegistryService:i,coreSettings:n,client:o,commandResultChangeReportingService:r,entityCommanding:s,loggerFactory:a,scenarioFactory:l}=Lu("CreateCommandReportingServiceTask",e,"appsRegistryService","client","commandResultChangeReportingService","coreSettings","entityCommanding","loggerFactory","scenarioFactory");return(null===(t=n.get(b.J.Core))||void 0===t?void 0:t.enableStandaloneCommandReportingService)&&(e.commandResultHooksService=new eo(i,o,r,n,s,a,l,e.authenticationUser&&(0,Ee.b4)(e.authenticationUser)),e.commandResultHooksService.init()),Promise.resolve()}))}}var Bu=i(682265);const $u=(e,t,i,n)=>{const o=`${e}::TypeError::`;try{return new URL(t,i||void 0)}catch(e){let r=`${o}base::${i}`;throw n&&(r=r.concat(`::url::${t}`)),new Bu.Y("URL_PARSE_FAILED",new Error(r))}},Hu=(e,t,i)=>{let n=!1,o=!1,r=!1,s=!1,a=!1,l=`${e}::`;const c="ProtocolValidationFailed::",d="OriginValidationFailed::";if(t.protocol&&i.protocol?o=!0:l=l.concat(`${c}EmptyProtocol::'${t.protocol}'::'${i.protocol}'`),t.protocol!==i.protocol?l=l.concat(`${c}'${t.protocol}' !== '${i.protocol}'`):r=!0,t.origin&&i.origin?s=!0:l=l.concat(`${d}EmptyOrigin::'${t.origin}'::'${i.origin}'`),t.origin!==i.origin?l=l.concat(`${d}'${t.origin}' !== '${i.origin}'`):a=!0,n=o&&r&&s&&a,!n)throw new Bu.Y("URL_VALIDATION_FAILED",new Error(l))},qu={id:"@msteams/components-calling-ppt-sharing#components-calling-ppt-sharing",getConfig:e=>({createScriptURL:(t,i)=>{var n;const o="pptLivePolicy",r=null!==(n=e.get(b.J.Security).pptLiveAllowedOrigin)&&void 0!==n?n:[];if(!Array.isArray(r)||0===r.length)throw new Bu.Y("URL_VALIDATION_FAILED",new Error(`${o}::TypeError::allowedOriginList pptLiveAllowedOrigin is undefined or empty`));let s;const a=$u(o,t,i,!0);for(const e of r)try{const t=$u(o,e,void 0,!0);return Hu(o,a,t),a.href}catch(e){s=e}throw s}})},zu={id:"@msteams/services-utilities-google-authentication#google-client-library-loader",getConfig:e=>({createScriptURL:(t,i)=>{var n;const o="googleClientLibraryLoaderPolicy",r=null!==(n=e.get(b.J.Security).googleClientLibraryLoaderAllowedOrigin)&&void 0!==n?n:[];if(!Array.isArray(r)||0===r.length)throw new Bu.Y("URL_VALIDATION_FAILED",new Error(`${o}::TypeError::allowedOriginList googleClientLibraryLoaderAllowedOrigin is undefined or empty`));let s;const a=$u(o,t,i,!0);for(const e of r)try{const t=$u(o,e,void 0,!0);return Hu(o,a,t),a.href}catch(e){s=e}throw s}})},Vu=[{id:"@msteams/services-io-calling-service-adapters#cmdb-calling-bundle-loader-service-adapter",getConfig:e=>({createScriptURL:(t,i)=>{const n="callingBundleLoaderPolicy",o=e.get(b.J.Security).callingBundleLoaderAllowedOrigin;if(!o)throw new Bu.Y("URL_VALIDATION_FAILED",new Error(`${n}::TypeError::allowedOriginList callingBundleLoaderAllowedOrigin is undefined or empty`));let r;const s=$u(n,t,i,!0);try{const e=$u(n,o,void 0,!0);return Hu(n,s,e),s.href}catch(e){r=e}throw r}})},zu,{id:"@msteams/components-location-bing-map#location-sdk-api",getConfig:e=>({createScriptURL:(t,i)=>{const n="locationSdkApiPolicy",o=e.get(b.J.Security).bingApiAllowedOrigin;if(!o)throw new Bu.Y("URL_VALIDATION_FAILED",new Error(`${n}::TypeError::allowedOriginList bingApiAllowedOrigin is undefined or empty`));let r;const s=$u(n,t,i,!0);try{const e=$u(n,o,void 0,!0);return Hu(n,s,e),s.href}catch(e){r=e}throw r}})},qu],Gu={id:"@msteams/services-utilities-common#ChunkLoader",getConfig:e=>({createScriptURL:(t,i)=>{var n;const o="chunkLoaderPolicy";let r,s,a,l=!1,c=!1;const d=$u(o,t,i,!0),u=null!==(n=e.get(b.J.Platform).staticsPath)&&void 0!==n?n:"";if(!u)throw new Bu.Y("URL_PARSE_FAILED",new Error(`${o}::TypeError::allowListUrl staticsPath is undefined`));try{a=$u(o,u,void 0,!0),Hu(o,d,a),l=!0}catch(e){r=e}if(l)return d.href;try{a=$u(o,Qu,void 0,!0),Hu(o,d,a),c=!0}catch(e){s=e}if(c)return d.href;if(r)throw r;throw s}})},Ju=[{id:"@msteams/no-op",getConfig:()=>({createHTML:e=>e,createScriptURL:e=>e})},Gu,{id:"@msteams/services-io-browser-web-client-update#register-service-worker",getConfig:()=>({createScriptURL:(e,t)=>{const i="registerServiceWorkerPolicy";let n,o,r=!1;const s=$u(i,e,t,!0);try{o=$u(i,Qu,void 0,!0),Hu(i,s,o),r=!0}catch(e){n=e}if(r)return s.pathname;throw n}})},{id:"@msteams/core-services-telemetry-worker#TelemetryWorker",getConfig:e=>({createScriptURL:(e,t)=>{const i="telemetryWorkerPolicy";let n,o,r=!1;const s=$u(i,e,t,!0);try{o=$u(i,Qu,void 0,!0),Hu(i,s,o),r=!0}catch(e){n=e}if(r)return s.pathname+s.hash;throw n}})}];function Ku(){return window}const Qu=Ku().location.origin;class Yu{constructor(e,t){this.coreSettings=e,this.logger=t.newLogger("CoreSecurityService","core-services-security"),this.configMap=new Map,this.policyMap=new Map,this.initializeTrustedTypeConfigMap(),this.setIsTrustedTypePoliciesEnabled()}getTrustedTypePolicy(e){var t,i,n;let o;if(this.isTrustedTypePoliciesEnabled||(e="@msteams/no-op"),o=this.policyMap.get(e),o)return o;if(o=this.createTrustedTypePolicyOnDemand(e),o)return this.policyMap.set(e,o),o;const r=new Bu.Y("POLICY_NOT_FOUND",new Error(`${e}`));throw null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`${r.code}::${null===(n=r.prevError)||void 0===n?void 0:n.message}`,"webclient_framework_foundation_core_services_security",void 0,!0),r}createTrustedTypePolicyOnDemand(e){var t,i,n;const o=this.configMap.get(e);if(!o)return;const r=Ku().trustedTypes;if(!this.isTrustedTypePoliciesEnabled||!r)return this.getOptionsAsTrustedTypePolicy(o);try{return r.createPolicy(o.id,o.getConfig(this.coreSettings))}catch(o){const r=new Bu.Y("CREATE_POLICY_FAILED",new Error(`${e}${null==o?void 0:o.message}`));throw null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`${r.code}::${null===(n=r.prevError)||void 0===n?void 0:n.message}`,"webclient_framework_foundation_core_services_security",void 0,!0),r}}getOptionsAsTrustedTypePolicy(e){return e.getConfig(this.coreSettings)}initializeConfigs(){Vu.forEach((e=>{this.setConfig(e)}))}initializeCoreConfigs(){Ju.forEach((e=>{this.setConfig(e)}))}initializeTrustedTypeConfigMap(){this.initializeCoreConfigs(),this.initializeConfigs()}setConfig(e){if(this.configMap.has(e.id))throw new Bu.Y("DUPLICATE_POLICY_FOUND",new Error(`CoreSecurityService::${e.id}`));this.configMap.set(e.id,e)}setIsTrustedTypePoliciesEnabled(){const{enableTrustedTypePolicies:e}=this.coreSettings.get(b.J.Core);this.isTrustedTypePoliciesEnabled=!!e}}class Xu extends Ce.i{constructor(){super(f.Yg.CreateCoreSecurityTask,["coreSettings","loggerFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,loggerFactory:i,windowProvider:n}=e,o=i.newLogger("CoreSecurityService","core-services-tasks"),r=new Yu(t,i);e.coreSecurityService=r,n.chunkLoader.configureCoreSecurityService(r),o.log("CoreSecurityService Initialized")}))}}var Zu,em,tm;!function(e){e.Merge="merge",e.Override="override"}(Zu||(Zu={})),function(e){e[e.Configuration=0]="Configuration",e[e.Override=1]="Override",e[e.ClientFilters=2]="ClientFilters",e[e.Policy=3]="Policy",e[e.TestOverride=4]="TestOverride"}(em||(em={}));class im{constructor(){this.providers={[em.Configuration]:[],[em.Override]:[],[em.ClientFilters]:[],[em.Policy]:[],[em.TestOverride]:[]}}registerProvider(e,t){this.providers[t].push(e)}getSettings(e){const t=this.mergeProviders(em.Configuration,e),i=this.mergeProviders(em.Override,e,t),n=this.mergeProviders(em.ClientFilters,e),o=this.combineConfigs(i,n,this.filterAndConfigMergeRule),r=this.mergeProviders(em.Policy,e),s=this.combineConfigs(o,r,this.policyAndConfigMergeRule);return this.mergeProviders(em.TestOverride,e,s)}mergeProviders(e,t,i={}){return this.providers[e].map((e=>e.getSettings())).filter((e=>!!e)).map((e=>(0,L.pick)(e,t))).reduce(((e,t)=>((0,L.mergeWith)(e,t,cd.g),e)),i)}combineConfigs(e,t,i){return Object.keys(t).map((n=>{const o=(0,L.get)(e,n)||{},r=(0,L.get)(t,n)||{};Object.keys(r).map((t=>{const s=(0,L.get)(o,t),a=(0,L.get)(r,t),l=i(s,a);(0,L.set)(o,t,l),(0,L.set)(e,n,o)}))})),e}policyAndConfigMergeRule(e,t){return(0,L.isNil)(e)?t:(0,L.isNil)(t)?void 0:(0,L.isBoolean)(t)?e&&t:t}filterAndConfigMergeRule(e,t){return(0,L.isNil)(e)?t:(0,L.isBoolean)(t)?t&&e:t}}class nm{constructor(e){this.value=e,this.observers=new Map}getObservable(e){return new gi.y((t=>(e.forEach((e=>this.getOrCreateObservers(e).push(t))),t.next(this.value),{unsubscribe:()=>{e.forEach((e=>{const i=this.getOrCreateObservers(e),n=i.indexOf(t);n>=0&&i.splice(n,1)}))}})))}next(e,t){this.value=t;const i=(0,L.reduce)(e.map((e=>this.getOrCreateObservers(e))),((e,t)=>e.concat(t)));new Set(i).forEach((e=>e.next&&e.next(t)))}getOrCreateObservers(e){let t=this.observers.get(e);return void 0===t&&(t=[],this.observers.set(e,t)),t}}class om{constructor(e,t){this.cachedCategorySettings=new Map,this.categoryBehaviorSubjectMap=new Map,this.perCategoryFilteredSubjects={},this.behaviorSubjectForAnySettingsChangeForCdlWorker=new r.X(void 0),this.providerSubscriptions=[],this.enableFilteredSettingsSubject=!1,this.notifySettingsChanged=()=>{var e;const t=Array.from(this.cachedCategorySettings.keys());this.logger.log("Settings have changed, checking for differences in these categories:",t);const i=this.ruleEngine.getSettings(t),n={};t.forEach((e=>{const t=this.cachedCategorySettings.get(e)||{},o=i[e]||{},r=this.getKeysForUpdatedSettingsInCategory(t,o);r.length>0&&(n[e]=r,this.cachedCategorySettings.set(e,o))})),this.logger.log("Updated settings:",i),Object.keys(n).length>0&&this.behaviorSubjectForAnySettingsChangeForCdlWorker.next();const o=null===(e=this.scenarioFactory)||void 0===e?void 0:e.newScenario(U.RG.SettingsChangedNotificationSync);try{this.getObservedCategories().forEach((e=>{const t=this.createOrGetBehaviorSubjectFromCache(e),r=i[e]||{},s=n[e]||[];0!==s.length&&(this.logger.log(`Notifying subscribers of: '${e}', settings changed to: `,r),t.next(r),null==o||o.mark(U.ck.SettingsChangedNotificationSyncCategoryNotified,{category:e,selectedSettings:!1}),this.getOrCreateFilteredSubject(e).next(s,r),null==o||o.mark(U.ck.SettingsChangedNotificationSyncCategoryNotified,{category:e,selectedSettings:!0}))}))}finally{null==o||o.stop()}},this.logger=t.newLogger(`CoreSettings/Service(${e})`,"core-services-settings"),this.ruleEngine=new im,this.logger.log("Created.")}cleanup(){this.logger.log("Cleaning up."),this.providerSubscriptions.forEach((e=>e.unsubscribe())),this.categoryBehaviorSubjectMap.clear(),this.perCategoryFilteredSubjects={}}get(e,t){const i=this.cachedCategorySettings.get(e);if(i)return i;const n=this.getLatestSettingsForCategory(e);return this.cachedCategorySettings.set(e,n),this.logger.log(`Creating cache for '${e}' category, settings:`,n),n}getObservable(e,t){const i=this.createOrGetBehaviorSubjectFromCache(e);return this.enableFilteredSettingsSubject&&void 0!==t?this.getOrCreateFilteredSubject(e).getObservable(t):i.asObservable()}getObservableForAnySettingsChangeForCdlWorker(){return this.behaviorSubjectForAnySettingsChangeForCdlWorker.asObservable()}registerProvider(e,t){this.ruleEngine.registerProvider(e,t);const i=e.subscribe(this.notifySettingsChanged);this.providerSubscriptions.push(i)}setScenarioFactory(e){this.scenarioFactory=e}readEnableFilteredSettingsSubject(){this.enableFilteredSettingsSubject=!!this.getLatestSettingsForCategory(b.J.Core).enableFilteredSettingsSubject}createOrGetBehaviorSubjectFromCache(e){let t=this.categoryBehaviorSubjectMap.get(e);if(!t){const i=this.get(e);t=new r.X(i),this.categoryBehaviorSubjectMap.set(e,t),this.logger.log(`Creating subject for '${e}' category, settings:`,i)}return t}getOrCreateFilteredSubject(e){let t=this.perCategoryFilteredSubjects[e];return void 0===t&&(t=new nm(this.get(e)),this.perCategoryFilteredSubjects[e]=t),t}getLatestSettingsForCategory(e){return this.ruleEngine.getSettings([e])[e]||{}}getKeysForUpdatedSettingsInCategory(e,t){return(0,L.reduce)(t,((t,i,n)=>(0,L.isEqual)(i,e[n])?t:t.concat(n)),[])}getObservedCategories(){let e=Array.from(this.categoryBehaviorSubjectMap.keys());return e=e.concat(Object.keys(this.perCategoryFilteredSubjects)),e=Array.from(new Set(e)),e}}class rm{constructor(e,t){this.coreSettingsContext=t,this.providers=[],this.logsProviderName="CoreSettingsLogsProvider",this.logger=e.newLogger("CoreSettingsLogsProvider","core-services-settings")}getLogsFiles(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return[{isPiiFree:!1,fileName:"settings.json",content:(yield this.getCurrentSettingsSnapshot())||"Could not fetch settings"}]}))}registerProvider(e,t){this.providers.push({provider:e,type:t})}getCurrentSettingsSnapshot(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const e=yield this.coreSettingsContext.getDebugService(),t=e.getSettings(!0),i=new Map;this.providers.forEach((({provider:e})=>{const t=e.getDiagnosticsInfo();t&&i.set(e.providerName,t)}));const n={settings:this.getGroupedSettings(t),rawPolicies:e.getRawPolicies()||"",providersInfo:[...i.entries()]};return JSON.stringify(n)}catch(e){this.logger.error("Diagnostics: Failed to get settings snapshot: ",e)}return""}))}getGroupedSettings(e){if(!e||0===e.length)return"";const t=e.reduce(((e,t)=>{var i;if(void 0===t.value&&(!t.providers||0===t.providers.length))return e;e[t.category]=e[t.category]||{},e[t.category][t.key]={};let n=!1;return null===(i=t.providers)||void 0===i||i.forEach((i=>{e[t.category][t.key][i.shortName]=i.value,(0,L.isEqual)(t.value,i.value)||(n=!0)})),n&&t.providers&&(t.providers.length>1||void 0===t.value)&&(e[t.category][t.key].value=void 0===t.value?"undefined":t.value),e}),{});return t}}!function(e){e[e.Valid=0]="Valid",e[e.Expired=1]="Expired",e[e.NoData=2]="NoData",e[e.NoCache=3]="NoCache"}(tm||(tm={}));class sm{constructor(){this.callbacks=[]}subscribe(e){if(!(0,L.isFunction)(e))throw Error("Callback is not a valid function.");const t=this;t.callbacks.push(e);return{unsubscribe:()=>{const i=t.callbacks.indexOf(e);i>=0&&t.callbacks.splice(i,1)}}}getRawSettings(){}getDiagnosticsInfo(){}cleanup(){}notifySettingsChanged(e){this.callbacks.forEach((t=>t(e)))}}function am(e,t,i){const n={};return(0,L.forOwn)(e,((e,o)=>{const r={};(0,L.forOwn)(e,((e,n)=>{(0,L.forEach)(e,(e=>!function(e,t){let i=!0;return(0,L.forOwn)(t,((t,n)=>{const o=(0,L.get)(e,n)||[];return null==t?i=0===o.length:o.length>0&&(i=o.includes(t)),i})),i}(e,t)||(r[n]=e.value,!1))),!r[n]&&i&&(r[n]=!1)})),r&&!(0,L.isEmpty)(r)&&(n[o]=r)})),n}class lm extends sm{constructor(e,t,i,n,o){super(),this.providerName=e,this.configs=t,this.platformService=i,this.logger=o.newLogger("CoreSettings/ConfigProviderDynamic","core-services-settings"),this.applyFiltersAndNotify(),n&&this.setClientPreferences(n)}cleanup(){var e;null===(e=this.clientPreferencesSubscription)||void 0===e||e.unsubscribe()}getSettings(){return this.settings||{}}setLocale(e){this.locale=e,this.applyFiltersAndNotify()}setClientPreferences(e){var t,i;(null===(i=null===(t=this.settings)||void 0===t?void 0:t.core)||void 0===i?void 0:i.enableLowPerformanceModeCoreSettingsFilter)&&(this.clientPreferencesSubscription&&this.clientPreferencesSubscription.unsubscribe(),this.clientPreferencesSubscription=e.getPreferenceObservable("performance").subscribe((({mode:e})=>{this.currentPerformanceMode=e,this.applyFiltersAndNotify()})))}applyFiltersAndNotify(){const e=this.getFilters(),t=am(this.configs,e);this.logger.log("Filters:",e),this.logger.log("Filtered settings:",t),this.settings?(0,L.isEqual)(this.settings,t)||(this.settings=t,this.notifySettingsChanged()):this.settings=t}getFilters(){const{ecsOverrides:{environment:e},config:{platformId:t,vdi:i,osPlatform:n,buildType:o}}=this.platformService;return{environment:e,platform:t,buildType:o,virtualization:null==i?void 0:i.configFilter,os:n,performanceMode:this.currentPerformanceMode,locale:this.locale}}}const cm=e=>e!==_e.pk.VeryActive;function dm(e,t,i,n){let o;const r=()=>{null==o||o.unsubscribe(),o=void 0,null==a||a.cancel()},s=i=>{e(i),r(),t.debug("Notified about settings change")},a=(0,L.throttle)(((e,i)=>{cm(e)?s(i):t.log("Throttle executed with VeryActive state, waiting for next state change")}),n||0,{leading:!1,trailing:!0}),l=e=>!i||cm(i.getState())?(s(e),!0):(o||(o=i.observe().subscribe((i=>{cm(i)&&!n?s(e):n&&(t.log("Throttled function called"),a(i,e))}))),t.log(`Postponed settings change notification due to client state being ${_e.pk[i.getState()]}`),!1);return l.cancel=r,l}class um extends sm{constructor(e,t,i,n,o){var r;super(),this.settings={},this.providerName="HostProvider",this.logger=t.newLogger("CoreSettings/HostProvider","core-services-settings"),i?(this.logger.log("Host settings found."),this.updateSettingsAndCheckForChanges(i)):this.logger.log("No host settings found."),this.notifySettingsChangedDeferred=dm((()=>this.notifySettingsChanged()),this.logger,n,o),null===(r=e.opener)||void 0===r||r.addEventListener(O.rY.UpdateWindowState,(e=>{var t,i;if(null==e?void 0:e.payload){let n=e.payload;(null===(i=null===(t=e.payload)||void 0===t?void 0:t.hostSettings)||void 0===i?void 0:i.hostSettings)&&(n=e.payload.hostSettings),this.logger.log("Host settings update received, payload:",n),this.updateSettingsAndCheckForChanges(n)&&this.notifySettingsChangedDeferred()}}))}getSettings(){return this.settings}cleanup(){super.cleanup(),this.notifySettingsChangedDeferred.cancel()}updateSettingsAndCheckForChanges(e){const t=Object.assign({},this.settings.host),i=Object.assign({},this.settings.metadata);e.hostSettings&&Object.assign(t,e.hostSettings),e.desktopSettings&&Object.assign(t,e.desktopSettings),this.updateSettings(t,i,e);const n={[b.J.Host]:t,[b.J.Metadata]:i};return(0,L.isEqual)(this.settings,n)?(this.logger.log("Host settings did not change."),!1):(this.settings=n,this.logger.log("Host settings updated to:",this.settings),!0)}updateSettings(e,t,i){var n;if(i.bootstrapData&&(e.authBootstrapData=i.bootstrapData),(null===(n=i.hostSettings)||void 0===n?void 0:n.hostETag)&&(t.hostETag=i.hostSettings.hostETag),i.dataLayerSettings){const t=i.dataLayerSettings,n=t.query||[],o=t.mutation||[],r=t.subscription||[];e.dataLayerSettings={query:n,mutation:o,subscription:r}}}}const mm=e=>"localMigratedSettings"===e.name,gm=(e,t)=>{var i,n;if(null==e)return{};if("string"!=typeof e)return null===(i=t.errorNoPii)||void 0===i||i.call(t,`Failed to parse localMigratedSettings. Type is not string, got ${typeof e}.`),{};let o;try{o=JSON.parse(e)}catch(e){return null===(n=t.errorNoPii)||void 0===n||n.call(t,"Failed to parse localMigratedSettings. Value is not valid JSON."),{}}const r={chatDensity:fm(o),language:hm(o,"language"),messagePreviewShown:km(o),performanceMode:Sm(o),callingSelectedDevices:wm(o,"calling_selected_devices"),callingSelectedCameraDevice:wm(o,"calling_selected_camera_device"),callingSelectedSpeakerDevice:wm(o,"calling_selected_speaker_device"),callingSelectedMicrophoneDevice:wm(o,"calling_selected_microphone_device"),callingSelectedSecondaryRingerDevice:wm(o,"calling_selected_secondary_ringer_device"),agcEnabled:pm(o,"agcEnabled"),autoAdjustEnabled:pm(o,"call.setAutoAdjust"),hfmmEnabled:pm(o,"hfmmEnabled"),ignoreMirrorMyVideoSettingsSelected:pm(o,"ignoreMirrorMyVideoSettingsSelected"),noiseSuppressionMode:bm(o),touchUpEnabled:pm(o,"call.setTouchUp"),touchUpStrength:vm(o,"call.setTouchUpStrength"),spatialAudioEnabled:pm(o,"spatialAudioEnabled"),ttyEnabled:pm(o,"ttyEnabled"),cachedImage:Cm(o,"cachedImage"),reservedMetadata:_m(o)};return(0,L.omitBy)(r,L.isUndefined)},hm=(e,t)=>{const i=e[t];return"string"==typeof i?i:void 0},pm=(e,t)=>{const i=e[t];return"boolean"==typeof i?i:"string"==typeof i?"true"===i:void 0},vm=(e,t)=>{const i=e[t];return"number"==typeof i&&Number.isFinite(i)?i:void 0},ym=(e,t)=>{const i=e[t];try{return"string"==typeof i?new Date(i).toISOString():void 0}catch(e){return}},fm=e=>{switch(e.chatDensity){case"comfy":return"Comfy";case"compact":return"Compact";default:return}},Sm=e=>{switch(e.performanceMode){case"Normal":return"Normal";case"Low":return"Low";default:return}},km=e=>{switch(e.messagePreviewsShown){case"default":return"Default";case"show-previews":return"ShowPreviews";case"hide-previews":return"HidePreviews";default:return}},bm=e=>{switch(e.noiseSuppressionMode){case"Off":return"Off";case"Auto":return"Auto";case"Low":return"Low";case"High":return"High";case"Pns":return"Pns";case"HeadsetNS":return"HeadsetNS";default:return}},wm=(e,t)=>{const i=(0,L.pickBy)(e[t],((e,t)=>["microphone","speaker","camera","audioIngestDevice"].includes(t)&&"string"==typeof e));return Object.keys(i).length>0?i:void 0},Cm=(e,t)=>{const i=(0,L.pickBy)(e[t],((e,t)=>["imageId","path","imageSrc"].includes(t)&&"string"==typeof e));return Object.keys(i).length>0?i:void 0},_m=e=>{if(!e.reservedMetadata)return;const t=e.reservedMetadata,i=(0,L.omitBy)({version:vm(t,"version"),correlationId:hm(t,"correlationId"),created:ym(t,"created"),reason:Tm(t)},L.isUndefined);return Object.keys(i).length>0?i:void 0},Tm=e=>{switch(hm(e,"reason")){case"pear-app-install":return"PearAppInstall";case"direct-install":return"DirectInstall";default:return}};class Im extends sm{constructor(e,t){super(),this.host=e,this.settings={},this.providerName="LocalMigratedSettingsProvider",this.logger=t.newLogger("CoreSettings/LocalMigratedSettingsProvider","core-services-settings"),this.loadLocalMigratedSettings()}loadLocalMigratedSettings(){const e=this.host.localStorage.getItem("tmp.localMigratedSettings"),t=gm(e,this.logger);this.settings={[b.J.LocalMigrated]:Object.assign({},t)},this.notifySettingsChanged()}getSettings(){return this.settings}}class jm extends sm{constructor(e){super(),this.settings={},this.providerName="MaglevHostProvider",this.logger=e.newLogger("CoreSettings/MaglevHostProvider","core-services-settings")}initialize(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{windowsInsiderChannel:t,windowsInsiderRing:i,installedThroughAppSwitcher:n}=yield this.getHostSettings(e),{hostCapabilitiesSettings:o,localMigratedSettings:r}=yield this.fetchHostInitialCapabilities(e);this.settings={[b.J.Host]:{windowsInsiderChannel:t,windowsInsiderRing:i,installedThroughAppSwitcher:n},[b.J.HostCapabilities]:Object.assign({},o),[b.J.LocalMigrated]:Object.assign({},r)},this.notifySettingsChanged()}))}onPreWarm(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const n=yield e.loadModule("m365link"),o=yield null===(t=null==n?void 0:n.isBrowserPreferenceEnabled)||void 0===t?void 0:t.call(n),r=yield this.getHostCapabilities(e),s=yield this.getMemoryInfo(e);this.mergeSettings({[b.J.Host]:{enableM365LinksSettings:o},[b.J.HostCapabilities]:Object.assign({},r),[b.J.Calling]:{totalMemoryInBytes:s}}),null===(i=null==n?void 0:n.registerForIsBrowserPreferenceEnabled)||void 0===i||i.call(n,(e=>{this.mergeSettings({[b.J.Host]:{enableM365LinksSettings:e}})}))}catch(e){this.logger.warn("Unable to get host settings post alt:",e)}}))}getSettings(){return this.settings}mergeSettings(e){this.settings={[b.J.Host]:Object.assign(Object.assign({},this.settings.host),e.host),[b.J.HostCapabilities]:Object.assign(Object.assign({},this.settings.hostCapabilities),e.hostCapabilities),[b.J.Calling]:Object.assign(Object.assign({},this.settings.calling),e.calling)},this.notifySettingsChanged()}getHostSettings(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let t;try{if(t=yield e.loadModule("ecs"),null==t?void 0:t.getHostSettings)return yield null==t?void 0:t.getHostSettings()}catch(e){this.logger.warn("Unable to get host settings:",e)}return{}}))}fetchHostInitialCapabilities(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=[];try{const i=yield e.loadModule("hostcapabilities"),o=yield null===(t=null==i?void 0:i.getInitialCapabilities)||void 0===t?void 0:t.call(i);o&&n.push(...o)}catch(e){this.logger.warn("Unable to get host capabilities settings:",e)}const o=n.filter((e=>!mm(e))).reduce(((e,t)=>(Object.assign(e,{[t.name]:t.value}),e)),{}),r=null===(i=n.find((e=>mm(e))))||void 0===i?void 0:i.value;return{hostCapabilitiesSettings:o,localMigratedSettings:gm(r,this.logger)}}))}getHostCapabilities(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const n=yield e.loadModule("hostcapabilities"),o=["crossCloudMeetingEnabled","hardwareAccelerationAvailable","installedThroughAppSwitcher","storagePartition","phoneLinkingBlocked","windowsInsiderChannel","windowsInsiderRing","t1AppSwitcherEffectivePolicy","t1AppSwitcherCohort"];return(null!==(i=yield null===(t=null==n?void 0:n.getCapabilities)||void 0===t?void 0:t.call(n,o))&&void 0!==i?i:[]).reduce(((e,t)=>(Object.assign(e,{[t.name]:t.value}),e)),{})}catch(e){this.logger.warn("Unable to get host capabilities settings:",e)}return{}}))}getMemoryInfo(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const i=yield e.loadModule("osutils"),n=yield null===(t=null==i?void 0:i.getSystemMemoryInfo)||void 0===t?void 0:t.call(i),o=Number(null==n?void 0:n.totalPhysicalMemoryBytes);return isNaN(o)?void 0:o}catch(e){this.logger.warn("Unable to get memory info:",e)}}))}}class Nm extends sm{constructor(e,t,i){super(),this.loggerFactory=e,this.configLoader=t,this.resolutionStrategy=i,this.settings={},this.providerName="ClientFiltersProvider",this.logger=this.loggerFactory.newLogger("CoreSettings/ClientFiltersProvider","core-services-settings")}initialize(e){this.settings=this.filterSettings(e),this.notifySettingsChanged()}getSettings(){return this.settings}filterSettings(e){const t=am(this.configLoader(this.getConfigFileName()),e,this.resolutionStrategy===Zu.Merge);return this.logger.debug(`Calculated client ${this.resolutionStrategy} filters for ${(0,M.u4)(e)}:`,t),t}getConfigFileName(){switch(this.resolutionStrategy){case Zu.Merge:return"clientFiltersMerge";case Zu.Override:default:return"clientFiltersOverride"}}}const Em="tmp";var xm;function Am(e){return[Em,e.experienceName,e.userId,e.tenantId,e.environment,e.ring,e.virtualization,e.type].filter((e=>!(0,L.isNil)(e))).join(".")}!function(e){e.TestOverrides="settings",e.EcsCache="ecs-settings-cache",e.PolicyCache="policy-cache"}(xm||(xm={}));const Dm="CachedProvider";class Fm extends sm{constructor(e,t,i){super(),this.storage=e,this.options=i,this.providerName=Dm,this.logger=t.newLogger("CoreSettings/CachedProvider","core-services-settings")}initialize(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.settings=yield this.loadCache()}))}setProvider(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.cleanup(),this.provider=e,this.providerName=`${Dm}:${this.provider.providerName}`,this.subscription=this.provider.subscribe((e=>this.updateCache(e))),yield this.updateCache()}))}getProvider(){return this.provider}getSettings(){return this.settings}getDiagnosticsInfo(){return this.provider?this.provider.getDiagnosticsInfo():super.getDiagnosticsInfo()}get cacheState(){return this.getCacheState()}cleanup(e=!1){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.providerName=Dm,null===(t=this.provider)||void 0===t||t.cleanup(),e&&this.storage.removeItem(this.getStorageKey())}))}getCacheState(){return this.settings?tm.Valid:tm.NoData}getStorageKey(){if(!this._storageKey){if(!this.options)throw new Error("No storage options are passed to the CachedProvider.");this._storageKey=Am(this.options)}return this._storageKey}updateCache(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.provider)return;const i=null!==(t=null==e?void 0:e.settings)&&void 0!==t?t:this.provider.getSettings(),n=this.getStorageKey();i&&0!==Object.keys(i).length?(this.settings=i,yield this.storage.setItem(n,JSON.stringify(this.settings)),this.logger.log(`Cache '${n}' updated.`),this.notifySettingsChanged()):this.logger.log(`Got empty settings from provider. Cache State: ${tm[this.cacheState]} (Storage key: ${n})`)}))}loadCache(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let e;const t=this.getStorageKey();try{const i=yield this.storage.getItem(t);i?(e=JSON.parse(i),this.logger.log(`Cache successfully loaded: ${t}`)):this.logger.log(`No cached data found: ${t}`)}catch(e){this.logger.log(`Error while loading from cache '${t}', error:`,e)}return e}))}}class Om extends Fm{constructor(e,t,i){super(e,t,i)}getExpiration(){var e,t;const i=null===(t=null===(e=this.settings)||void 0===e?void 0:e.metadata)||void 0===t?void 0:t.expires;return i&&!isNaN(Date.parse(i))?new Date(i):void 0}getCacheState(){if(!this.settings)return tm.NoData;const e=this.getExpiration();return e&&e.valueOf()>Date.now()?tm.Valid:tm.Expired}}var Mm=i(867328),Rm=i(881209),Pm=i(704680),Lm=i(656618);const Um="CoreSettings/EcsClientProvider";class Wm extends sm{constructor(e,t,i){super(),this.loggerFactory=i,this.providerName="EcsClientProvider",this.clientStarted=!1,this.onEcsClientConfigurationFetch=e=>{if(!this.fetchProps)throw new Error("Must call initializeClient() before fetching");const{incompleteBootAttemptsCounter:t,notifySettingsChangedDeferred:i,scenarioFactory:n}=this.fetchProps;this.handleEcsConfigurationData(e,this.createScenario(!1,n),t,i)},this.logger=this.loggerFactory.newLogger(Um,"core-services-settings"),this.cacheOptions={storage:e,partitionBy:Mm.F4.ConsumerKey,consumerKey:Am(t)}}initializeLocal(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.ecsClient=yield(0,Rm.un)({serviceName:Um,cacheOptions:this.cacheOptions,loggerFactory:this.loggerFactory})}))}initializeClient(e,t,i,n,r,s,a,l){var c;return(0,o.__awaiter)(this,void 0,void 0,(function*(){switch(this.fetchProps={ecsParameters:e,host:i,scenarioFactory:a,incompleteBootAttemptsCounter:l,notifySettingsChangedDeferred:dm((e=>this.notifySettingsChanged(e)),this.logger,n,t.get(b.J.Core).ecsNotifySettingsChangedDelayInMs)},null===(c=this.ecsClient)||void 0===c?void 0:c.clientType){case"EcsClient":return!1;case"LocalEcsClient":return this.ecsClient=this.ecsClient.createClient({ecsParameters:e,endpointsManager:s,loggerFactory:this.loggerFactory,fetchPrecheck:this.fetchPrecheck(n,r).bind(this),transformData:this.transformDataToSettings.bind(this)}),!0;default:return this.ecsClient=yield(0,Rm.fh)({serviceName:Um,cacheOptions:this.cacheOptions,loggerFactory:this.loggerFactory,ecsParameters:e,endpointsManager:s,fetchPrecheck:this.fetchPrecheck(n,r).bind(this),transformData:this.transformDataToSettings.bind(this)}),!0}}))}startClient(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if("EcsClient"!==(null===(t=this.ecsClient)||void 0===t?void 0:t.clientType)||!this.fetchProps)throw new Error("Must call initializeClient() before startClient()");let i=!0;const n=this.fetch(!0);return e&&(i=yield n),this.ecsClient.startFetchSchedule(this.fetchProps.host,this.onEcsClientConfigurationFetch),this.clientStarted=!0,i}))}getClientType(){var e;return null===(e=this.ecsClient)||void 0===e?void 0:e.clientType}getCacheState(){return this.ecsClient?this.ecsClient.cacheState:tm.NoCache}getSettings(){var e,t;return null===(t=null===(e=this.ecsClient)||void 0===e?void 0:e.get())||void 0===t?void 0:t.ecsConfiguration}updateParametersAndFetch(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if("EcsClient"!==(null===(t=this.ecsClient)||void 0===t?void 0:t.clientType)||!this.fetchProps)throw new Error("Must call initializeClient() before updateEcsParameters()");this.fetchProps.ecsParameters=Object.assign({},e);this.ecsClient.updateParameters(this.fetchProps.ecsParameters)?(this.logger.log("Refresh required, manually fetching settings ..."),yield this.fetch(!1)):this.logger.log("No refresh required, ECS parameters haven't changed.")}))}cleanup(){var e,t;super.cleanup(),null===(e=this.fetchProps)||void 0===e||e.notifySettingsChangedDeferred.cancel(),"EcsClient"===(null===(t=this.ecsClient)||void 0===t?void 0:t.clientType)&&this.ecsClient.dispose()}fetch(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if("EcsClient"!==(null===(t=this.ecsClient)||void 0===t?void 0:t.clientType)||!this.fetchProps)throw new Error("Must call initializeClient() before fetching");const{incompleteBootAttemptsCounter:i,notifySettingsChangedDeferred:n,scenarioFactory:o}=this.fetchProps,r=this.createScenario(e,o);try{this.logger.debug("Awaiting manual ECS fetch...");const e=yield this.ecsClient.fetch();return this.logger.debug("Manual ECS fetch complete."),this.handleEcsConfigurationData(e,r,i,n)}catch(e){return r.fail({errors:e.message}),this.logger.warn("Manual ECS fetch failed.",e),!1}}))}handleEcsConfigurationData(e,t,i,n){i.markBootAttemptComplete();let o=!1,r=!1;switch(e.requestStatus){case Pm.m.Success:if(!e.ecsConfiguration){t.fail({errors:"Empty ECS configuration"});break}r=n({settings:e.ecsConfiguration}),this.logger.log("Settings updated to:",e.ecsConfiguration),t.stop({size:JSON.stringify(e.ecsConfiguration).length,message:JSON.stringify({settingsUpdated:!0,notified:r})}),o=!0;break;case Pm.m.Success_NoChanges:r=n({settings:e.ecsConfiguration}),this.logger.debug("Settings are the same."),t.stop({message:JSON.stringify({settingsUpdated:!1,headersUpdated:!0,notified:r})}),o=!0;break;case Pm.m.Abandoned_ClientVeryActive:this.logger.debug("Skipping override settings check due to app being in a very active state."),t.stop({message:"very active"},"abandoned");break;case Pm.m.Abandoned_NoNetwork:this.logger.debug("Skipping override settings check due to app being offline."),t.stop({message:"no network"},"abandoned");break;case Pm.m.Error_BrowserError:t.stop({errors:`${e.errorMessage} - BrowserError`},"abandoned");break;case Pm.m.Error_TimedOut:t.stop({errors:e.errorMessage},"timeout");break;case Pm.m.Error_TransformFailed:case Pm.m.Error_Unknown:t.fail({errors:e.errorMessage});break;case Pm.m.NotStarted:t.fail({errors:"ECS client is in a corrupt state - received a 'NotStarted' request status"});break;default:t.fail({errors:`Received unknown request status value of ${e.requestStatus}`})}return o}fetchPrecheck(e,t){return()=>t&&!1===t.isOnline()?{errorMessage:"Skipping ECS configuration fetch due to app being offline",requestStatus:Pm.m.Abandoned_NoNetwork}:!e||e.getState()!==_e.pk.VeryActive||{errorMessage:"Skipping ECS configuration fetch due to app being very active",requestStatus:Pm.m.Abandoned_ClientVeryActive}}createScenario(e,t){var i,n;const o=t.newScenario(U.RG.EcsProviderFetch);return o.appendEventData({endpointUrl:null===(i=this.ecsClient)||void 0===i?void 0:i.getDiagnosticInfo().fetchUrl,operation:e?"initial":"refresh",correlationId:o.id,timeSinceCacheExpired:(0,Lm.mN)(null===(n=this.ecsClient)||void 0===n?void 0:n.expiration)}),o}transformDataToSettings(e){const{ecsConfiguration:t,headers:i}=e;if(!this.fetchProps)throw new Error("Must call initializeClient() before transforming data");if(!t||!i)throw new Error("Data is missing ecsConfiguration or headers");if((0,L.isNil)(this.fetchProps.ecsParameters.agents))return Object.assign(Object.assign({},e),{ecsConfiguration:{}});let n={};const o=[],r=[],{agents:s=[],criticalAgents:a=[]}=this.fetchProps.ecsParameters;return s.forEach((e=>{var i;if(null==a?void 0:a.includes(e)){const i=t[e];if((0,L.isNil)(i))throw new Error(`ECS configuration is missing configurations for critical namespace '${e}'`);n=Object.assign(Object.assign({},n),i)}const s=null===(i=null==t?void 0:t.ConfigIDs)||void 0===i?void 0:i[e];if(s){const e=s.split(",");o.push(...e.filter((e=>e.startsWith("P-E")))),r.push(...e.filter((e=>e.startsWith("P-R"))))}})),n=Object.assign(Object.assign({},n),{metadata:Object.assign(Object.assign({},n.metadata),{eTag:i.ETag,expires:i.Expires.toString(),countryCode:i.CountryCode,configIds:{experiments:o,rollouts:r}})}),Object.assign(Object.assign({},e),{ecsConfiguration:n})}}class Bm extends sm{constructor(e,t){super(),this.workerHostSettings=t,this.providerName="WorkerHostProvider",this.logger=e.newLogger("CoreSettings/WorkerHostSettingsProvider","core-services-settings"),this.settings={},this.testSettings={},this.logger.log("Worker host settings is initialized",this.settings),t.subscribeToHostSettingsUpdates((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=yield t.getHostSettings();this.settings=e.settings,this.testSettings=e.testSettings,this.notifySettingsChanged()}))))}initialize(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=yield(0,W.E)(this.workerHostSettings.getHostSettings(),1e4).catch((e=>(this.logger.error(`retrieve worker host setting timed out, the error is ${e}`),{settings:{},testSettings:{}})));this.settings=e.settings,this.testSettings=e.testSettings,this.logger.log("Worker host setting is being initialized")}))}getSettings(){return Object.assign(Object.assign({},this.settings),{[b.J.Test]:this.testSettings})}}class $m extends sm{constructor(e,t,i){super(),this.loggerFactory=e,this.configLoader=i,this.providerName="ViewportOverrideProvider",this.logger=this.loggerFactory.newLogger("CoreSettings/ViewportOverrideProvider","core-services-settings"),this.settings=this.filterSettings(t)}getSettings(){return this.settings}hasOverrides(){return!(0,L.isEmpty)(this.settings)}hasDifferences(e){const t=this.filterSettings(e);return!(0,L.isEqual)(this.settings,t)}updateSettings(e){const t=this.filterSettings(e);(0,L.isEqual)(this.settings,t)||(this.settings=t,this.notifySettingsChanged())}filterSettings(e){const t=am(this.configLoader("viewportOverrides"),e);return this.logger.debug(`Calculated overrides for ${(0,M.u4)(e)}:`,t),t}}class Hm extends sm{constructor(e,t,i){super(),this.host=e,this.providerName="LocalStorageProvider",this.onStorageEvent=e=>{e.key===this.storageKey&&(this.logger.log("Local storage settings updated."),this.settings=this.loadStorageSettings(),this.notifySettingsChanged())},this.logger=t.newLogger("CoreSettings/LocalStorageProvider","core-services-settings"),this.storageKey=Am(i),this.settings=this.loadStorageSettings(),this.host.addEventListener("storage",this.onStorageEvent)}getSettings(){return this.settings}cleanup(){this.host.removeEventListener("storage",this.onStorageEvent)}setSettings(e){try{this.host.localStorage.setItem(this.storageKey,(0,M.u4)(e))}catch(e){this.logger.log("Could not write settings to local storage, error:",e)}this.settings=e,this.notifySettingsChanged()}clearSettings(){this.host.localStorage.removeItem("tmp.settings"),this.settings={}}loadStorageSettings(){const e=this.host.localStorage.getItem(this.storageKey);if(e)try{return JSON.parse(e)}catch(e){this.logger.log(`Could not parse settings stored in local storage, key: ${this.storageKey}, error: ${e}`)}return{}}}class qm extends sm{constructor(e,t){super(),this.clientPreferencesService=e,this.providerName="ClientPreferencesProvider",this.logger=t.newLogger("CoreSettings/ClientPreferencesProvider","core-services-settings"),this.settings=this.loadClientPreferences(),this.setupSubscription()}getSettings(){return this.settings}cleanup(){var e;null===(e=this.clientPreferencesSubscription)||void 0===e||e.unsubscribe()}loadClientPreferences(){const e=this.clientPreferencesService.getPreferences("diagnosticsLogs");if(void 0!==(null==e?void 0:e.shouldPersistLogsIntoIDB))try{return{diagnostics:{clientExtendedDiagnosticsData:!!(null==e?void 0:e.shouldPersistLogsIntoIDB)}}}catch(t){this.logger.log(`Could not parse client preferences, ${e}, error: ${t}`)}return{}}setupSubscription(){const e=this.clientPreferencesService.getPreferenceObservable("diagnosticsLogs");this.clientPreferencesSubscription=e.subscribe((e=>this.clientPreferenceUpdateHandler(e)))}clientPreferenceUpdateHandler(e){var t,i;!!(null==e?void 0:e.shouldPersistLogsIntoIDB)!=!!(null===(i=null===(t=this.settings)||void 0===t?void 0:t.diagnostics)||void 0===i?void 0:i.clientExtendedDiagnosticsData)&&(this.settings={diagnostics:{clientExtendedDiagnosticsData:!!(null==e?void 0:e.shouldPersistLogsIntoIDB)}},this.notifySettingsChanged())}}class zm extends sm{constructor(e){super(),this.providerName="ApiServiceProvider",this.logger=e.newLogger(this.providerName,"core-services-settings"),this.settings=this.loadApiSwitcherSettings()}getSettings(){return this.settings}setOverrides(e){this.settings=this.loadApiSwitcherSettings(e),this.notifySettingsChanged()}loadApiSwitcherSettings(e){if((null==e?void 0:e.configs)&&(null==e?void 0:e.id))try{const t=e.configs,i=e.id;return{apiService:{serviceConfig:t},auth:this.getAuthOverrides(e.configs),metadata:{serviceId:i}}}catch(e){this.logger.log(`Could not parse settings stored in local storage , error: ${e}`)}return{}}getAuthOverrides(e){return{authzEndpointUrl:null==e?void 0:e.authzEndpointUrl,authzUrl:null==e?void 0:e.authzEndpointUrl,authzResource:null==e?void 0:e.authzResource,regionGtmsEnv:null==e?void 0:e.regionGtmsEnv,ic3NonCaeResource:null==e?void 0:e.ic3NonCaeResource,ic3CaeResource:null==e?void 0:e.ic3CaeResource}}}class Vm{constructor(e){this.logger=e.newLogger("CoreSettings/QspSettingsParser","core-services-settings")}parse(e,t={}){return new URLSearchParams(e).forEach(((e,i)=>{const n=this.parseQspSetting(i,e);n&&(this.logger.log("QSP override: ",n.key,n.value),(0,L.set)(t,n.key,n.value))})),t}parseQspSetting(e,t){const i=this.extractQspKeyObject(e);if("config"===i.config)return{key:`${i.category}.${i.featureName}`,value:this.tryGetParsedValueOrReturnOriginalValue(t)}}extractQspKeyObject(e){const t=e.split(".");let i="";for(let e=2;e<t.length;e++)i+=t[e],e<t.length-1&&(i+=".");return{config:t[0],category:t[1],featureName:i}}tryGetParsedValueOrReturnOriginalValue(e){const t=e.toLowerCase();return"true"===t||"false"===t?"true"===t:e.startsWith("[")&&e.endsWith("]")?this.getStringArrayValue(e.substring(1,e.length-1)):encodeURIComponent(e)}getStringArrayValue(e){if(0===e.length)return[];const t=e.split(","),i=[];for(const e of t)i.push(encodeURIComponent(e));return i}}class Gm extends sm{constructor(e,t,i,n){super(),this.host=e,this.platformService=t,this.experienceName=n,this.providerName="QspProvider",this.settings={},(this.platformService.config.isInternalUser||"meeting-options"===this.experienceName)&&(this.parser=new Vm(i))}getSettings(){return this.parseQsp(),this.settings}parseQsp(){if(!this.parser)return;const e={};this.host.location.search&&this.parser.parse(this.host.location.search,e);const t=this.getQueryStringFromHash();t&&this.parser.parse(t,e),this.platformService.config.isInternalUser?this.settings=e:"meeting-options"===this.experienceName&&this.populateAllowList(e)}getQueryStringFromHash(){const e=this.host.location.hash;if(!e)return null;const t=e.indexOf("?");return t>-1?e.substr(t):null}populateAllowList(e){const t={};e&&(e.meetingOptions&&(t.meetingOptions={},e.meetingOptions.isClientSideInviteeListSupported&&(t.meetingOptions.isClientSideInviteeListSupported=e.meetingOptions.isClientSideInviteeListSupported),e.meetingOptions.isClientSideSensitivityLabelSupported&&(t.meetingOptions.isClientSideSensitivityLabelSupported=e.meetingOptions.isClientSideSensitivityLabelSupported)),e.host&&(t.host={},e.host.skin&&(t.host.skin=e.host.skin),e.host.headless&&(t.host.headless=e.host.headless),e.host.theme&&(t.host.theme=e.host.theme))),this.settings=t}}var Jm,Km,Qm=i(964718);!function(e){e.None="0",e.CitrixXenDesktop="1",e.CitrixXenApp="2",e.VMWare="3",e.WVD="5"}(Jm||(Jm={})),function(e){e.none="none",e.windows365="Windows365"}(Km||(Km={}));class Ym extends sm{constructor(e){var t;super(),this.platformService=e,this.providerName="PlatformProvider",this.platformSettings={[b.J.Platform]:{browser:this.getBrowser(),browserVersion:null===(t=this.platformService.config.browserVersion)||void 0===t?void 0:t.toString(),buildType:this.platformService.config.buildType,buildVersion:this.platformService.config.buildVersion,clientVersion:this.platformService.config.clientVersion,deviceInfo:this.platformService.host.deviceInfo,enableSlotBorderRadius:this.getEnableSlotBorderRadius(),isHtmlInputSelectApiSupported:this.getIsHtmlInputSelectApiSupported(),isScreenRecordingPermissionRequired:this.getIsScreenRecordingPermissionRequired(),sessionId:this.platformService.host.sessionId,staticsPath:this.platformService.config.staticsPath,thirdPartyCookieSupport:wr.Yv.Unknown,useMacKeyboardLayout:this.getUseMacKeyboardLayout(),vdi:this.getVdiSettings()},[b.J.Metadata]:{environment:this.platformService.ecsOverrides.environment,ring:{id:this.platformService.ecsOverrides.ring},isUserInTargetedRelease:this.getIsUserInTargetedRelease()},[b.J.Host]:{desktopVersion:this.platformService.host.hostAppVersion}}}getSettings(){return this.platformSettings}updateSettings(e){let t=Object.assign({},this.platformSettings.metadata);e.region&&(t=Object.assign(Object.assign({},t),{region:e.region}));let i=Object.assign({},this.platformSettings.platform);e.bootType&&(i=Object.assign(Object.assign({},i),{bootType:e.bootType})),e.localeCode&&(i=Object.assign(Object.assign({},i),{localeCode:e.localeCode})),e.thirdPartyCookieSupport&&(i=Object.assign(Object.assign({},i),{thirdPartyCookieSupport:e.thirdPartyCookieSupport})),this.platformSettings=Object.assign(Object.assign({},this.platformSettings),{[b.J.Platform]:i,[b.J.Metadata]:t}),this.notifySettingsChanged()}getBrowser(){const{browser:e}=this.platformService.config;switch(e){case wr.AR.Chrome:return"Chrome";case wr.AR.Edge:return"Edge";case wr.AR.Safari:return"Safari";case wr.AR.Firefox:return"Firefox";case wr.AR.Electron:return"Electron";default:return"Unknown"}}getVdiSettings(){const{vdi:e}=this.platformService.config;if(e){const{provider:t,mode:i,isAvRemoted:n,configFilter:o,vdiOptimizationMode:r,subProvider:s}=e,a=e=>{switch(e){case Jm.CitrixXenDesktop:return"CitrixXenDesktop";case Jm.CitrixXenApp:return"CitrixXenApp";case Jm.VMWare:return"VMWare";case Jm.WVD:return"WVD";default:return"None"}};return{provider:a(t),subProvider:s,mode:i,isAvRemoted:n,configFilter:o,vdiOptimizationMode:r}}}getIsHtmlInputSelectApiSupported(){return this.platformService.config.osPlatform!==wr.NR.IOS}getUseMacKeyboardLayout(){return this.platformService.config.osPlatform===wr.NR.Mac}getIsScreenRecordingPermissionRequired(){if(this.platformService.config.platformId===wr.us.MaglevMacT21)return!0;if(this.platformService.config.clientType===wr.Bh.Web||this.platformService.config.osPlatform!==wr.NR.Mac||!this.platformService.config.osVersion)return!1;const e=this.platformService.config.osVersion.toString();return(0,Qm.compare)(e,"10.15",">=")}getEnableSlotBorderRadius(){return this.platformService.config.osPlatform===wr.NR.Mac}getIsUserInTargetedRelease(){return"ring3_6"===this.platformService.ecsOverrides.ring&&this.platformService.ecsOverrides.isAssignedRing}}class Xm extends sm{constructor(e,t){super(),this.workerHostSettings=t,this.providerName="WorkerHostTestOverridesProvider",this.logger=e.newLogger("CoreSettings/WorkerHostTestOverridesProvider","core-services-settings"),this.settings={},t.subscribeToHostSettingsUpdates((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=yield t.getHostSettings();this.settings=(0,L.merge)({},e.localStorageTestOverrides,e.qspTestOverrides),this.notifySettingsChanged()}))))}initialize(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=yield(0,W.E)(this.workerHostSettings.getHostSettings(),1e4).catch((e=>(this.logger.error(`Retrieving worker host setting timed out, the error is ${e}`),{localStorageTestOverrides:{},qspTestOverrides:{}})));this.settings=(0,L.merge)({},e.localStorageTestOverrides,e.qspTestOverrides),this.logger.log("Worker host test overrides setting is being initialized")}))}getSettings(){return this.settings}}class Zm{constructor(e,t,i,n,o,r,s,a,l){this.id=e,this.experienceName=t,this.cache=i,this.loggerFactory=n,this.platformService=o,this.clientPreferences=r,this.configLoader=s,this.partitionCacheByExperience=a,this.localStorage=l,this.initialStateHints={primaryUserHadPolicyCache:!1},this.logger=this.loggerFactory.newLogger(`CoreSettings/Context(${e})`,"core-services-settings"),this.cleanupFunctions=[],this.settingsService=new om(this.id,this.loggerFactory),this.cleanupFunctions.push((()=>{this.settingsService.cleanup()})),this.logsProvider=new rm(this.loggerFactory,this),this.logger.log("Created.")}cleanup(e){this.cache.release(this.id,(()=>{this.logger.log("Cleaning up."),this.cleanupFunctions.forEach((t=>t(e)))}))}getCoreSettings(){return this.settingsService}getLogsProvider(){return this.logsProvider}getDebugService(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.debugSettingsService){const{DebugSettingsService:e}=yield i.e(226842).then(i.bind(i,737493));this.debugSettingsService=new e(this,this.loggerFactory,this.id)}return this.debugSettingsService}))}updatePlatformProviderSettings(e){this.platformProvider&&this.platformProvider.updateSettings(e)}updateViewportOverrideProviderSettings(e){this.viewportOverrideProvider&&this.viewportOverrideProvider.updateSettings(e)}setScenarioFactory(e){this.scenarioFactory=e,this.settingsService&&this.settingsService.setScenarioFactory(e)}setLocale(e){this.enableLocaleFilterForFeatureFlags&&(this.locale=e,this.configProvider&&this.configProvider.setLocale(e))}getInitialStateHints(){return this.initialStateHints}registerAllProviders(){this.registerProvider(em.Configuration,this.configProvider),this.registerProvider(em.Configuration,this.platformProvider),this.registerProvider(em.Configuration,this.hostProvider),this.registerProvider(em.Configuration,this.localMigratedSettingsProvider),this.registerProvider(em.Configuration,this.maglevHostProvider),this.registerProvider(em.Configuration,this.workerHostProvider),this.registerProvider(em.Configuration,this.clientPreferencesProvider),this.registerProvider(em.Configuration,this.ecsCachedProvider),this.registerProvider(em.Override,this.clientFiltersOverrideProvider),this.registerProvider(em.Override,this.viewportOverrideProvider),this.registerProvider(em.ClientFilters,this.clientFiltersMergeProvider),this.registerProvider(em.Policy,this.policyCachedProvider),this.registerProvider(em.TestOverride,this.apiServiceProvider),this.registerProvider(em.TestOverride,this.localStorageProvider),this.registerProvider(em.TestOverride,this.qspProvider),this.registerProvider(em.TestOverride,this.workerTestProvider),this.registerProvider(em.TestOverride,this.workerHostTestOverridesProvider),this.settingsService.readEnableFilteredSettingsSubject()}registerProvider(e,t){t&&(this.settingsService.registerProvider(t,e),this.getLogsProvider().registerProvider(t,e))}createConfigProviderForMainThread(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.configProvider=yield function(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=function(e){const{ecsOverrides:{environment:t}}=e;return`${t}`}(e.platformService),i=yield(0,gl.mT)((()=>e.configLoader(t)),"core-settings-base-configs");return new lm("ConfigProviderAsync",i,e.platformService,e.clientPreferences,e.loggerFactory)}))}({clientPreferences:this.clientPreferences,configLoader:this.configLoader,loggerFactory:this.loggerFactory,platformService:this.platformService}),this.locale&&this.configProvider.setLocale(this.locale),this.cleanupFunctions.push((()=>{var e;null===(e=this.configProvider)||void 0===e||e.cleanup()}))}))}createConfigProviderForCDLWorker(){this.configProvider=function(e){const t=e.configLoader("config");return new lm("ConfigProviderSync",t,e.platformService,e.clientPreferences,e.loggerFactory)}({clientPreferences:this.clientPreferences,configLoader:this.configLoader,loggerFactory:this.loggerFactory,platformService:this.platformService}),this.locale&&this.configProvider.setLocale(this.locale),this.cleanupFunctions.push((()=>{var e;null===(e=this.configProvider)||void 0===e||e.cleanup()}))}createHostProvider(e,t){this.hostProvider=new um(e,this.loggerFactory,t),this.cleanupFunctions.push((()=>{var e;null===(e=this.hostProvider)||void 0===e||e.cleanup()}))}createLocalMigratedSettingsProvider(e){this.localMigratedSettingsProvider=new Im(e,this.loggerFactory),this.cleanupFunctions.push((()=>{var e;null===(e=this.localMigratedSettingsProvider)||void 0===e||e.cleanup()}))}createMaglevHostProvider(){this.maglevHostProvider=new jm(this.loggerFactory),this.cleanupFunctions.push((()=>{var e;null===(e=this.maglevHostProvider)||void 0===e||e.cleanup()}))}createClientFiltersProviders(){this.clientFiltersMergeProvider=new Nm(this.loggerFactory,this.configLoader,Zu.Merge),this.clientFiltersOverrideProvider=new Nm(this.loggerFactory,this.configLoader,Zu.Override),this.cleanupFunctions.push((()=>{var e,t;null===(e=this.clientFiltersMergeProvider)||void 0===e||e.cleanup(),null===(t=this.clientFiltersOverrideProvider)||void 0===t||t.cleanup()}))}createEcsCachedProvider(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{ring:t,environment:i}=this.platformService.ecsOverrides,n="general"===t?void 0:t,o="prod"===i?void 0:i,r=this.partitionCacheByExperience?this.experienceName:void 0;this.ecsCachedProvider=new Om(e,this.loggerFactory,{type:xm.EcsCache,experienceName:r,ring:n,environment:o,virtualization:this.getVirtualization()}),yield this.ecsCachedProvider.initialize(),this.cleanupFunctions.push((()=>{var e;null===(e=this.ecsCachedProvider)||void 0===e||e.cleanup()}))}))}getVirtualization(){var e,t;return this.platformService.config.clientType===wr.Bh.Maglev&&null!==(t=null===(e=this.platformService.config.vdi)||void 0===e?void 0:e.configFilter)&&void 0!==t?t:void 0}createEcsClientProvider(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{ring:t,environment:i}=this.platformService.ecsOverrides,n="general"===t?void 0:t,o="prod"===i?void 0:i,r=this.partitionCacheByExperience?this.experienceName:void 0,s={type:xm.EcsCache,experienceName:r,ring:n,environment:o,virtualization:this.getVirtualization()};this.ecsClientProvider=new Wm(e,s,this.loggerFactory),yield this.ecsClientProvider.initializeLocal(),this.cleanupFunctions.push((()=>{var e;null===(e=this.ecsClientProvider)||void 0===e||e.cleanup()}))}))}createWorkerTestProvider(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.workerTestProvider=new Fm(e,this.loggerFactory,{type:xm.TestOverrides}),yield this.workerTestProvider.initialize(),this.cleanupFunctions.push((()=>{var e;null===(e=this.workerTestProvider)||void 0===e||e.cleanup()}))}))}createWorkerHostTestOverridesProvider(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.workerHostTestOverridesProvider=new Xm(this.loggerFactory,e),yield this.workerHostTestOverridesProvider.initialize(),this.cleanupFunctions.push((()=>{var e;null===(e=this.workerHostTestOverridesProvider)||void 0===e||e.cleanup()}))}))}createWorkerHostProvider(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.workerHostProvider=new Bm(this.loggerFactory,e),yield this.workerHostProvider.initialize(),this.cleanupFunctions.push((()=>{var e;null===(e=this.workerHostProvider)||void 0===e||e.cleanup()}))}))}createViewportOverrideProvider(e){this.viewportOverrideProvider=new $m(this.loggerFactory,e,this.configLoader),this.cleanupFunctions.push((()=>{var e;null===(e=this.viewportOverrideProvider)||void 0===e||e.cleanup()}))}createPolicyCachedProvider(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.policyCachedProvider=new Fm(e,this.loggerFactory,{type:xm.PolicyCache,userId:null==t?void 0:t.id}),yield this.policyCachedProvider.initialize(),this.cleanupFunctions.push((e=>{var t;const i="signout"===e;null===(t=this.policyCachedProvider)||void 0===t||t.cleanup(i)}))}))}createLocalStorageProvider(e){this.localStorageProvider=new Hm(e,this.loggerFactory,{type:xm.TestOverrides}),this.cleanupFunctions.push((()=>{var e;null===(e=this.localStorageProvider)||void 0===e||e.cleanup()}))}createClientPreferencesProvider(e){this.clientPreferencesProvider=new qm(e,this.loggerFactory),this.cleanupFunctions.push((()=>{var e;null===(e=this.clientPreferencesProvider)||void 0===e||e.cleanup()}))}createApiServiceProvider(){this.apiServiceProvider=new zm(this.loggerFactory),this.cleanupFunctions.push((()=>{var e;null===(e=this.apiServiceProvider)||void 0===e||e.cleanup()}))}createQspProvider(e){this.qspProvider=new Gm(e,this.platformService,this.loggerFactory,this.experienceName),this.cleanupFunctions.push((()=>{var e;null===(e=this.qspProvider)||void 0===e||e.cleanup()}))}createPlatformProvider(e){this.platformProvider=new Ym(e),this.cleanupFunctions.push((()=>{var e;null===(e=this.platformProvider)||void 0===e||e.cleanup()}))}populateInitialStateHints(){var e;(null===(e=this.policyCachedProvider)||void 0===e?void 0:e.cacheState)===tm.Valid&&(this.initialStateHints.primaryUserHadPolicyCache=!0)}get enableLocaleFilterForFeatureFlags(){const e=this.getCoreSettings(),{enableLocaleFilterForFeatureFlags:t}=e.get(b.J.Core,["enableLocaleFilterForFeatureFlags"]);return!!t}}var eg,tg,ig,ng=i(143285);!function(e){e[e.AbortWhenVeryActive=0]="AbortWhenVeryActive",e[e.ContinueWhenVeryActive=1]="ContinueWhenVeryActive"}(eg||(eg={})),function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online"}(tg||(tg={})),function(e){e.Initializing="Initializing",e.Unrecoverable="Unrecoverable",e.LongInactive="LongInactive",e.Inactive="Inactive",e.Active="Active",e.VeryActive="VeryActive"}(ig||(ig={}));class og{constructor(e,t,i,n,o,r,s,a=eg.AbortWhenVeryActive){this.host=n,this.applicationStateProvider=r,this.networkStateProvider=s,this.clientVeryActiveMode=a,this.ecsClient=(0,Rm.bn)({serviceName:t,ecsParameters:Object.assign(Object.assign({},e),{disableSentinelConfigValidation:!0}),loggerFactory:o,endpointsManager:i,fetchPrecheck:this.fetchPreCheck.bind(this)})}updateParameters(e){return this.ecsClient.updateParameters(e)}getDiagnosticInfo(){var e,t;return Object.assign(Object.assign({},this.ecsClient.getDiagnosticInfo()),{clientVeryActiveMode:this.clientVeryActiveMode,configIds:null===(t=null===(e=this.ecsClient.get())||void 0===e?void 0:e.ecsConfiguration)||void 0===t?void 0:t.ConfigIDs})}getConfigurationAsync(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.ecsClient.fetch()}))}startWhenExpiredFetchSchedule(e){return this.ecsClient.startFetchSchedule(this.host,e)}stopFetchSchedule(){return this.ecsClient.dispose()}fetchPreCheck(){var e;return this.networkStateProvider&&this.networkStateProvider.getState()!==tg.Online?{errorMessage:"Skipping ECS configuration fetch due to app being offline",requestStatus:Pm.m.Abandoned_NoNetwork}:this.clientVeryActiveMode!==eg.AbortWhenVeryActive||(null===(e=this.applicationStateProvider)||void 0===e?void 0:e.getState())!==ig.VeryActive||{errorMessage:"Skipping ECS configuration fetch due to app being very active",requestStatus:Pm.m.Abandoned_ClientVeryActive}}}const rg="c72ea287-ed77-4fa6-a480-3712406c367e";function sg(e){var t;return e[rg]?"ECS Sentinel Config is present in ECS response at the root level":(null===(t=e.ECS)||void 0===t?void 0:t[rg])?"ECS Sentinel Config is present in ECS response inside ECS object":"ECS Sentinel Config is missing from ECS response"}class ag extends sm{constructor(e,t,i,n,o,r,s,a,l,c){super(),this.coreSettings=t,this.loggerFactory=i,this.scenarioFactory=n,this.host=o,this.clientStateProvider=r,this.networkStateProvider=s,this.endpointsManager=a,this.incompleteBootAttemptsCounter=l,this.getExtraScenarioEventData=c,this._isInitialized=!1,this.providerName="EcsProvider",this.onEcsClientConfigurationFetch=e=>{this.handleEcsConfigurationData(e,this.createScenario(!1))};const d=`CoreSettings/${this.providerName}`;this.logger=i.newLogger(d,"core-services-settings"),this.ecsClientFetchMode=ng.z.Manual,this.ecsParameters=Object.assign({},e),this.ecsClient=new og(this.ecsParameters,d,this.endpointsManager,this.host,this.loggerFactory,this.clientStateProvider,this.networkStateProvider,eg.AbortWhenVeryActive),this.notifySettingsChangedDeferred=dm((e=>this.notifySettingsChanged(e)),this.logger,r,this.coreSettings.get(b.J.Core).ecsNotifySettingsChangedDelayInMs)}initialize(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.isInitialized)return!1;let i=!0;const n=this.performManualFetch(!0);e&&(i=yield n);const o=this.coreSettings.get(b.J.Core).ecsProviderFetchMode;if(this.ecsClientFetchMode=null!==(t=(0,Lm.JX)(o))&&void 0!==t?t:ng.z.WhenExpired,this.ecsClientFetchMode!==ng.z.WhenExpired)throw new Error(`${ng.z[this.ecsClientFetchMode]} fetch mode is not supported`);return this.ecsClient.startWhenExpiredFetchSchedule(this.onEcsClientConfigurationFetch),this._isInitialized=!0,i}))}get isInitialized(){return this._isInitialized}getSettings(){return this.settings}getParameters(){return this.ecsParameters}getDiagnosticsInfo(){return this.ecsClient.getDiagnosticInfo()}cleanup(){super.cleanup(),this.notifySettingsChangedDeferred.cancel(),this.ecsClient.stopFetchSchedule()}updateEcsParametersAndFetchSettings(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.ecsParameters=Object.assign({},e);this.ecsClient.updateParameters(e)?this.isInitialized?(this.logger.log("Refresh required, manually fetching settings ..."),yield this.performManualFetch(!1)):this.logger.log("Refresh required but provider not initialized, skipping settings fetch."):this.logger.log("No refresh required, ECS parameters haven't changed.")}))}performManualFetch(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=this.createScenario(e);try{this.logger.debug("Awaiting manual ECS fetch...");const e=yield this.ecsClient.getConfigurationAsync();return this.logger.debug("Manual ECS fetch complete."),this.handleEcsConfigurationData(e,t)}catch(e){return this.appendExtraScenarioEventData(t),t.fail({errors:e.message}),this.logger.warn("Manual ECS fetch failed.",e),!1}}))}notifyEcsFetchComplete(){this.incompleteBootAttemptsCounter.markBootAttemptComplete()}appendExtraScenarioEventData(e){var t;const i=null===(t=this.getExtraScenarioEventData)||void 0===t?void 0:t.call(this);i&&e.appendEventData(i)}handleEcsConfigurationData(e,t){var i;this.notifyEcsFetchComplete(),this.appendExtraScenarioEventData(t);let n=!1,o=!1;switch(e.requestStatus){case Pm.m.Success:if(!e.ecsConfiguration||!e.headers){t.fail({errors:"Empty headers or ECS configuration"});break}t.appendEventData({sentinelConfigLocation:sg(e.ecsConfiguration)});try{this.settings=this.extractSettings(e.ecsConfiguration,e.headers)}catch(e){t.fail({errors:`Extracting settings failed - ${(null==e?void 0:e.message)||"unknown error"}`});break}o=this.notifySettingsChangedDeferred({settings:this.settings}),this.logger.log("Settings updated to:",this.settings),t.stop({size:JSON.stringify(e.ecsConfiguration).length,message:JSON.stringify({settingsUpdated:!0,notified:o})}),n=!0;break;case Pm.m.Success_NoChanges:if(!e.headers){t.fail({errors:"Empty headers"});break}this.settings=Object.assign(Object.assign({},this.settings),{metadata:Object.assign(Object.assign({},null===(i=this.settings)||void 0===i?void 0:i.metadata),{expires:e.headers.Expires.toString()})}),o=this.notifySettingsChangedDeferred({settings:this.settings}),this.logger.debug("Settings are the same."),t.stop({message:JSON.stringify({settingsUpdated:!1,headersUpdated:!0,notified:o})}),n=!0;break;case Pm.m.Abandoned_ClientVeryActive:this.logger.debug("Skipping override settings check due to app being in a very active state."),t.stop({message:"very active"},"abandoned");break;case Pm.m.Abandoned_NoNetwork:this.logger.debug("Skipping override settings check due to app being offline."),t.stop({message:"no network"},"abandoned");break;case Pm.m.Error_BrowserError:t.stop({errors:`${e.errorMessage} - BrowserError`},"abandoned");break;case Pm.m.Error_TimedOut:t.stop({errors:e.errorMessage},"timeout");break;case Pm.m.Error_TransformFailed:case Pm.m.Error_Unknown:t.fail({errors:e.errorMessage});break;case Pm.m.NotStarted:t.fail({errors:"ECS client is in a corrupt state - received a 'NotStarted' request status"});break;default:t.fail({errors:`Received unknown request status value of ${Pm.m[e.requestStatus]}`})}return n}createScenario(e){const t=this.scenarioFactory.newScenario(U.RG.EcsProviderFetch);return t.appendEventData({endpointUrl:this.ecsClient.getDiagnosticInfo().fetchUrl,operation:e?"initial":"refresh",correlationId:t.id}),t}extractSettings(e,t){if((0,L.isNil)(this.ecsParameters.agents))return{};let i={};const n=[],o=[],{agents:r=[],criticalAgents:s=[]}=this.ecsParameters;return r.forEach((t=>{var r;if(null==s?void 0:s.includes(t)){const n=e[t];if((0,L.isNil)(n))throw new Error(`ECS payload is missing configurations for critical namespace '${t}'`);i=Object.assign(Object.assign({},i),n)}const a=null===(r=null==e?void 0:e.ConfigIDs)||void 0===r?void 0:r[t];if(a){const e=a.split(",");n.push(...e.filter((e=>e.startsWith("P-E")))),o.push(...e.filter((e=>e.startsWith("P-R"))))}})),i=Object.assign(Object.assign({},i),{metadata:Object.assign(Object.assign({},i.metadata),{eTag:t.ETag,expires:t.Expires.toString(),countryCode:t.CountryCode,configIds:{experiments:n,rollouts:o}})}),i}}class lg extends sm{constructor(e,t,i,n){super(),this.policiesDataProvider=t,this.configLoader=i,this.enablePoliciesDefaultValues=n,this.providerName="PolicyProvider",this.refreshSettings=e=>{this.rawPolicies=e;const t=this.policySettings,i=this.mapPoliciesToSettings(e);if(this.enablePoliciesDefaultValues){const e=(0,L.cloneDeep)(this.policySettingsDefaults);this.policySettings=(0,L.mergeWith)(e,i,cd.g)}else this.policySettings=i;(0,L.isEqual)(t,this.policySettings)?this.logger.log("No changes detected."):(this.logger.log("Policy settings updated to: ",this.policySettings),this.notifySettingsChanged())},this.logger=e.newLogger("CoreSettings/PolicyProvider","core-services-settings"),this.policiesDataProvider.subscribeForSettingsUpdates(this.refreshSettings),this.policySettingsDefaults={},this.rawPolicies={}}initialize(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.policiesJson=this.configLoader("policies").mappings,this.logger.log("Loaded policies mapping: ",this.policiesJson),this.enablePoliciesDefaultValues&&this.policiesJson&&(this.policySettingsDefaults=this.getPolicySettingsDefaults(this.policiesJson),this.policySettings=(0,L.cloneDeep)(this.policySettingsDefaults),this.logger.log("Loaded default for policies settings: ",this.policySettingsDefaults)),yield this.policiesDataProvider.initialize(!0),this.logger.log("Initial fetch completed.")}))}getSettings(){return this.policySettings}getRawSettings(){return this.rawPolicies}cleanup(){this.policiesDataProvider.cleanup()}getPolicySettingsDefaults(e){const t={};return Object.keys(e).map((e=>{const i={},n=(0,L.get)(this.policiesJson,e);Object.keys(n).map((e=>{const t=(0,L.get)(n,e);if(t&&(0,L.has)(t,"defaultValue")){const n=(0,L.get)(t,"defaultValue");(0,L.set)(i,e,n)}})),(0,L.set)(t,e,i)})),t}mapPoliciesToSettings(e){const t={};return this.policiesJson&&Object.keys(this.policiesJson).map((i=>{const n={},o=(0,L.get)(this.policiesJson,i);Object.keys(o).map((t=>{const i=(0,L.get)(o,t);if(i&&(0,L.has)(i,"name")){const o=(0,L.get)(i,"name"),r=(0,L.get)(e,o);(0,L.set)(n,t,r)}})),(0,L.set)(t,i,n)})),t}}class cg{constructor(e){this.host=e}setItem(e,t){return this.host.localStorage.setItem(e,t),Promise.resolve()}getItem(e){const t=this.host.localStorage.getItem(e);return Promise.resolve(t)}removeItem(e){return this.host.localStorage.removeItem(e),Promise.resolve()}}const dg=["EducationStudent","EducationFaculty","SmbLicense"],ug=["A1","A3","A5","Other"];function mg(e,t,i){const n=function(e,t){let i,n;const{isTeamsSmb:o,eduLicenseSkuAndCategory:r,region:s}=e,a=null==s?void 0:s.toLowerCase();if(o&&t)n="SmbLicense";else if(r&&r.trim().length>0&&r.includes("_")){const[e,t]=r.split("_");e&&t&&ug.find((t=>t===e))&&dg.find((e=>e===t))&&(i=e,n=t)}return{userLicenseSku:i,userLicenseCategory:n,region:a}}(e,t);return Object.assign(Object.assign({},n),i)}class gg{constructor(e){this.cacheMap=new Map,this.logger=e.newLogger("CoreSettings/ContextCache","core-services-settings")}cache(e,t){if(this.cacheMap.has(e))throw new Error(`Context '${e}' already stored.`);this.cacheMap.set(e,{context:t,refCount:1}),this.logger.debug(`Context '${e}' cached.`)}acquire(e,t){const i=this.cacheMap.get(e);if(i)return i.refCount++,this.logger.debug(`Acquiring context '${e}', ref count: '${i.refCount}'.`),i.context;if(!t)throw new Error(`Context '${e}' not found in cache.`);this.logger.debug(`Context '${e}' not found in cache, constructing...`);const n=t();return this.cache(e,n),n}release(e,t){const i=this.cacheMap.get(e);if(!i)throw new Error(`Cannot release context '${e}', not found in cache.`);i.refCount--,this.logger.debug(`Releasing context '${e}', ref count: '${i.refCount}'.`),0===i.refCount&&(t(),this.cacheMap.delete(e))}}const hg="incomplete-boot-attempts";class pg{constructor(e,t,i){if(this.coreSettings=e,this.storage=i,this.pastAttemptsCount=0,this.logger=t.newLogger("CoreSettings/IncompleteBootAttemptsCounter","core-services-settings"),!i)return void this.logger.debug("Disabled because no storage is available.");this.pastAttemptsCount=function(e){if(!e)return 0;try{return parseInt(e,10)}catch(e){return 0}}(i.get(hg));const n=this.pastAttemptsCount+1;i.trySet(hg,`${n}`,"Framework"),this.logger.debug(`Set past incomplete boot count to ${n}.`)}markBootAttemptComplete(){this.storage&&(this.pastAttemptsCount>0&&this.logger.debug("Boot attempt complete, incomplete boot counter reset to 0."),this.storage.trySet(hg,"0","Framework"),this.pastAttemptsCount=0)}get tooManyPastAttempts(){if(!this.storage)return this.logger.debug("No blocking fetch because storage is unavailable."),!1;const e=this.coreSettings.get(b.J.Core).maxBootAttemptsWithoutEcsFetch;if(!e)return this.logger.debug("No blocking fetch because incomplete boot count limit is unset or zero."),!1;const t=this.pastAttemptsCount>=e;return this.logger.debug(`Too many attempts: ${t}`),t}}const vg="cachedPrimaryUser";class yg{constructor(e,t){this.localStorage=e,this.logger=t.newLogger("CoreSettings/PrimaryUserCache","core-services-settings")}get(){return void 0===this.inMemoryCachedUser&&this.loadFromLocalStorage(),this.inMemoryCachedUser}update(e){const t=Object.assign(Object.assign({},this.inMemoryCachedUser),e),i=!(0,L.isEqual)(t,this.inMemoryCachedUser);return this.inMemoryCachedUser=t,this.persistToLocalStorage(),i}clear(){this.inMemoryCachedUser=void 0,this.clearLocalStorage()}loadFromLocalStorage(){const e=this.localStorage.get(vg,"Experience");if(e)try{return void(this.inMemoryCachedUser=JSON.parse(e))}catch(e){this.logger.warn("Cannot parse cached primary user",e)}this.inMemoryCachedUser=null}persistToLocalStorage(){try{this.localStorage.trySet(vg,(0,M.u4)(this.inMemoryCachedUser),"Settings","Experience")}catch(e){this.logger.error("Unable to cache primary user")}}clearLocalStorage(){this.localStorage.remove(vg,"Experience")}}class fg extends Zm{constructor(e,t,i,n,r,s,a,l,c,d){super(e,t,i,n,r,s,a,l,c),this.primaryUserCache=d,this.fetchEcsSettingsIfApplicable=()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var e;if(this.enable1JSEcsClient)return this.fetchEcsSettingsFromEcsClientProvider();const t=null===(e=this.ecsCachedProvider)||void 0===e?void 0:e.getProvider();if(t&&!t.isInitialized){const e=!0;yield t.initialize(e)}})),this.getServiceSwitcherApiKey=()=>{var e;return null===(e=this.localStorage)||void 0===e?void 0:e.get("serviceId","Experience")},this.getChildId=e=>`${this.id}/${e}`,this.getEcsParameters=(e,t)=>{const i=this.enableLocaleFilterForFeatureFlags?this.locale:void 0,n=(t&&t.profile?{userId:t.profile.objectId,tenantId:t.profile.tenantId}:void 0)||(()=>{var e;const t=null===(e=this.primaryUserCache)||void 0===e?void 0:e.get();return t&&t.userId&&t.tenantId?t:void 0})();return(0,Lm.xb)({coreSettings:this.getCoreSettings(),experienceName:this.experienceName,platformService:this.platformService,user:n,locale:i,logger:e})},this.fetchEcsSettingsFromEcsClientProvider=()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var e;"EcsClient"===(null===(e=this.ecsClientProvider)||void 0===e?void 0:e.getClientType())&&(this.ecsClientProvider.clientStarted||(yield this.ecsClientProvider.startClient(!0)))}))}static createContext(e,t,i,n,r,s,a,l){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=new gg(n),c=new yg(a,n),d=new fg("g",t.experienceName,o,n,r,e,i,t.partitionCacheByExperience,a,c);yield d.createConfigProviderForMainThread(),d.createHostProvider(s,l),d.createLocalMigratedSettingsProvider(s),d.createMaglevHostProvider(),d.createPlatformProvider(r),d.createViewportOverrideProvider({viewportContext:s.viewportContext,entityType:null});const u=new cg(s);return yield d.createEcsCachedProvider(u),yield d.createEcsClientProvider(u),d.createClientFiltersProviders(),yield d.createPolicyCachedProvider(u),d.createLocalStorageProvider(s),d.createApiServiceProvider(),d.createQspProvider(s),d.createClientPreferencesProvider(e),d.populateInitialStateHints(),d.registerAllProviders(),o.cache(d.id,d),d}))}static createContextForWorker(e,t,i,n,o){const r=new gg(t),s=new fg(e,e,r,t,i,n,o);return s.createConfigProviderForCDLWorker(),s.createPlatformProvider(i),s.createClientFiltersProviders(),s.registerAllProviders(),r.cache(s.id,s),s}createContextForUser(e,t){var i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if((null===(n=null===(i=this.primaryUserCache)||void 0===i?void 0:i.get())||void 0===n?void 0:n.userId)===e.profile.objectId)return this.cache.acquire(this.id);const o=this.getChildId(`u-${e.id}`),r=this.cache.acquire(o,(()=>this.clone(o)));r.createClientFiltersProviders();const s=new cg(t);return yield r.createPolicyCachedProvider(s,e),r.registerAllProviders(),r}))}createContextForViewport(e){var t;if(this.logger.log("Acquiring context for viewport params: ",e),!this.viewportOverrideProvider||(null===(t=this.viewportOverrideProvider)||void 0===t?void 0:t.hasDifferences(e))){const{enableUpdateViewportOverride:t}=this.getCoreSettings().get(b.J.Core),i=`v-${e.viewportContext}-${e.entityType}${t?e.id:""}`,n=this.getChildId(i);return this.cache.acquire(n,(()=>{const t=this.clone(n);return t.createViewportOverrideProvider(e),t.registerAllProviders(),t}))}return this.cache.acquire(this.id)}setPrimaryUser(e){var t,i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log(`Setting primary user to: ${null==e?void 0:e.id}`);let o=!1;e?o=(null===(t=this.primaryUserCache)||void 0===t?void 0:t.update({userId:null===(i=e.profile)||void 0===i?void 0:i.objectId,tenantId:null===(n=e.profile)||void 0===n?void 0:n.tenantId}))||!1:null===(r=this.primaryUserCache)||void 0===r||r.clear(),yield this.reinitializeEcsProvider(o)}))}initializeProvidersWithCachedPrimaryUser(){var e;const t=null===(e=this.primaryUserCache)||void 0===e?void 0:e.get();if(t){this.updatePlatformProviderSettings({region:t.region});const{preReleaseFeaturesAllowed:e}=this.getCoreSettings().get(b.J.Metadata),{enableSmbLicenseClientFilter:i}=this.getCoreSettings().get(b.J.Smb),n=mg(t,!!i,{preReleaseFeaturesAllowed:e});this.initializeClientFiltersProviders(n)}}initializeProvidersWithDiscoveredUser(e,t,i){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enableSmbLicenseClientFilter:o}=this.getCoreSettings().get(b.J.Smb),r=mg(e,!!o,i);if(yield this.initializeClientFiltersProviders(r),this.updatePlatformProviderSettings({region:null==e?void 0:e.region}),t){const{isTeamsSmb:t,eduLicenseSkuAndCategory:i,region:o}=e;null===(n=this.primaryUserCache)||void 0===n||n.update({isTeamsSmb:t,eduLicenseSkuAndCategory:i,region:o})}}))}initializeMaglevHostProvider(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield null===(t=this.maglevHostProvider)||void 0===t?void 0:t.initialize(e)}))}initializeMaglevHostProviderPostAltSettings(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield null===(t=this.maglevHostProvider)||void 0===t?void 0:t.onPreWarm(e)}))}initializeEcsProvider({authenticationUser:e,scenarioFactory:t,networkState:i,clientState:n,windowProvider:r,endpointsManager:s,alwaysFetchEcsSettings:a}){var l,c;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.enable1JSEcsClient)return this.initializeEcsClientProvider({authenticationUser:e,scenarioFactory:t,networkState:i,clientState:n,windowProvider:r,endpointsManager:s,alwaysFetchEcsSettings:a});const o=yield this.getEcsParameters(this.logger,e),d=this.getCoreSettings(),u=new pg(d,this.loggerFactory,this.localStorage),m=new ag(o,d,this.loggerFactory,t,r,n,i,s,u,(()=>{var e;return{timeSinceCacheExpired:(0,Lm.mN)(null===(e=this.ecsCachedProvider)||void 0===e?void 0:e.getExpiration())}})),g=(null===(l=this.ecsCachedProvider)||void 0===l?void 0:l.cacheState)!==tm.NoData,h=!g||u.tooManyPastAttempts;h||a?(this.logger.log(`Initializing ECS provider: awaitInitialSync? ${h}, hasCacheData? ${g}, alwaysFetch? ${a}`),yield m.initialize(h)):this.logger.log("Cache is valid, delaying ECS fetch until WARM."),yield null===(c=this.ecsCachedProvider)||void 0===c?void 0:c.setProvider(m)}))}initializePolicyProvider(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enablePoliciesDefaultValues:t}=this.getCoreSettings().get(b.J.Core),i=new lg(this.loggerFactory,e,this.configLoader,!!t);if(this.policyCachedProvider){const e=i.initialize();this.policyCachedProvider.cacheState===tm.NoData&&(this.logger.log("Policy cache is empty, waiting to fetch policies."),yield e),yield this.policyCachedProvider.setProvider(i)}}))}initializeWorkerProviders(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield this.createWorkerHostProvider(t),yield this.createEcsCachedProvider(e),yield this.createEcsClientProvider(e),yield this.createWorkerTestProvider(e),yield this.createWorkerHostTestOverridesProvider(t),this.registerProvider(em.Configuration,this.workerHostProvider),this.registerProvider(em.Configuration,this.ecsCachedProvider),this.registerProvider(em.TestOverride,this.workerTestProvider),this.registerProvider(em.TestOverride,this.workerHostTestOverridesProvider),this.settingsService.notifySettingsChanged()}))}initializeWorkerProvidersWithoutHostSettings(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield this.createEcsCachedProvider(e),yield this.createEcsClientProvider(e),yield this.createWorkerTestProvider(e),yield this.createWorkerHostTestOverridesProvider(t),this.registerProvider(em.Configuration,this.ecsCachedProvider),this.registerProvider(em.TestOverride,this.workerTestProvider),this.registerProvider(em.TestOverride,this.workerHostTestOverridesProvider),this.settingsService.notifySettingsChanged()}))}initializeHostWorkerProviders(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield this.createWorkerHostProvider(e),this.registerProvider(em.Configuration,this.workerHostProvider),this.settingsService.notifySettingsChanged()}))}initializeApiServiceProvider(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=this.getSelectedServiceConfigs();t&&(null===(e=this.apiServiceProvider)||void 0===e||e.setOverrides(t))}))}getLocalStorageTestOverrides(){var e;return null===(e=this.localStorageProvider)||void 0===e?void 0:e.getSettings()}getQspTestOverrides(){var e;return null===(e=this.qspProvider)||void 0===e?void 0:e.getSettings()}clone(e){const t=new fg(e,this.experienceName,this.cache,this.loggerFactory,this.platformService,this.clientPreferences,this.configLoader,this.partitionCacheByExperience);return this.scenarioFactory&&t.setScenarioFactory(this.scenarioFactory),t.getInitialStateHints=this.getInitialStateHints,t.configProvider=this.configProvider,t.ecsCachedProvider=this.ecsCachedProvider,t.ecsClientProvider=this.ecsClientProvider,t.hostProvider=this.hostProvider,t.localMigratedSettingsProvider=this.localMigratedSettingsProvider,t.maglevHostProvider=this.maglevHostProvider,t.clientFiltersMergeProvider=this.clientFiltersMergeProvider,t.clientFiltersOverrideProvider=this.clientFiltersOverrideProvider,t.policyCachedProvider=this.policyCachedProvider,t.qspProvider=this.qspProvider,t.localStorageProvider=this.localStorageProvider,t.apiServiceProvider=this.apiServiceProvider,t.platformProvider=this.platformProvider,t}initializeClientFiltersProviders(e){var t,i;const{enableClientFiltersProvider:n}=this.getCoreSettings().get(b.J.Core);n&&(null===(t=this.clientFiltersMergeProvider)||void 0===t||t.initialize(e),null===(i=this.clientFiltersOverrideProvider)||void 0===i||i.initialize(e))}getSelectedServiceConfigs(){var e,t,i,n,o,r,s,a;const l=this.getServiceSwitcherApiKey()||(null===(t=null===(e=this.getCoreSettings())||void 0===e?void 0:e.get(b.J.Host))||void 0===t?void 0:t.serviceSwitcherSelectedServiceId);if(!l)return;const c=null===(n=null===(i=this.getCoreSettings())||void 0===i?void 0:i.get(b.J.Core))||void 0===n?void 0:n.availableServiceSwitcherApis,d=null==c?void 0:c.find((e=>e.id===l));if(d)null===(a=(s=this.logger).infoToTelemetry)||void 0===a||a.call(s,"Service config found","service_switch_load",{newState:l},!0);else{const e=`No service config found for ${l}`;null===(r=(o=this.logger).errorToTelemetry)||void 0===r||r.call(o,e,"service_switch_load",{newState:l,error:e},!0)}return d}reinitializeEcsProvider(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.enable1JSEcsClient)return this.reinitializeEcsClientProvider(e);const i=null===(t=this.ecsCachedProvider)||void 0===t?void 0:t.getProvider();if(!i)return;const n=yield this.getEcsParameters(this.logger);!i.isInitialized&&e?yield i.initialize(!0):yield i.updateEcsParametersAndFetchSettings(n)}))}get enable1JSEcsClient(){const e=this.getCoreSettings(),{enable1JSEcsClient:t}=e.get(b.J.Core,["enable1JSEcsClient"]);return Boolean(t)}initializeEcsClientProvider({authenticationUser:e,scenarioFactory:t,networkState:i,clientState:n,windowProvider:r,endpointsManager:s,alwaysFetchEcsSettings:a}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.ecsClientProvider)throw new Error("initializeEcsClientProvider() called without this.ecsClientProvider present");const o=yield this.getEcsParameters(this.logger,e),l=this.getCoreSettings(),c=new pg(l,this.loggerFactory,this.localStorage);this.ecsClientProvider.initializeClient(o,l,r,n,i,s,t,c);const d=this.ecsClientProvider.getCacheState(),u=d===tm.Valid||d===tm.Expired,m=!u||c.tooManyPastAttempts;m||a?(this.logger.log(`Initializing ECS provider: awaitInitialSync? ${m}, hasCacheData? ${u}, alwaysFetch? ${a}`),yield this.ecsClientProvider.startClient(m)):this.logger.log("Cache is valid, delaying ECS fetch until WARM.")}))}reinitializeEcsClientProvider(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if("EcsClient"!==(null===(t=this.ecsClientProvider)||void 0===t?void 0:t.getClientType()))return;const i=this.getEcsParameters(this.logger);!this.ecsClientProvider.clientStarted&&e?yield this.ecsClientProvider.startClient(!0):yield this.ecsClientProvider.updateParametersAndFetch(i)}))}}class Sg extends Ce.i{constructor(){super(f.Yg.CreateSettings,[]),this.registerShellHandlers=(e,t)=>{var i;null===(i=e.opener)||void 0===i||i.addEventListener(O.rY.GetSettings,(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return t.getCurrentSettingsSnapshot().then((t=>e.opener.postMessage(O.rY.GetSettings,{settings:t})),(()=>e.opener.postMessage(O.rY.GetSettings,{settings:""})))}))))}}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{hostSettings:t}=e,{clientPreferences:i,config:n,configLoader:o,diagnosticsService:r,loggerFactory:s,logsCollectorService:a,platformService:l,windowProvider:c,localStorage:d,postTaskSchedulerDiagnosticsService:u}=Lu("CreateCoreSettingsTask",e,"clientPreferences","config","configLoader","diagnosticsService","loggerFactory","logsCollectorService","platformService","windowProvider","localStorage","postTaskSchedulerDiagnosticsService"),m=yield fg.createContext(i,n,o,s,l,c,d,t),g=m.getCoreSettings();m.initializeProvidersWithCachedPrimaryUser();const h=m.getLogsProvider();e.coreSettingsContext=m,e.coreSettings=g,r.subscribeToCoreSettings(g),a.subscribeToCoreSettings(g),u.subscribeToCoreSettings(g);g.get(b.J.Core).enableMTMA||a.registerUserLogsProvider("",h),this.registerShellHandlers(c,h)}))}}class kg extends Ce.i{constructor(){super(f.Yg.CreateSettingsUserContext,["authenticationUser","coreSettingsContext","logsCollectorService","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,coreSettingsContext:i,logsCollectorService:n,windowProvider:o}=e,r=yield i.createContextForUser(t,o);e.coreSettingsContext=r,e.coreSettings=r.getCoreSettings();const s=r.getLogsProvider();return n.registerUserLogsProvider(t.id,s),e=>{switch(e){case"quit":case"signout":r.cleanup(e);break;default:return}}}))}}class bg{constructor(e,t,i,n,o,r,s,a,l){this._commandHandler=e,this._client=t,this._experienceChangeReportingService=i,this._authenticationUser=n,this._hostCommunicationService=o,this._loggerFactory=r,this._activeWindowsService=s,this._shortcutRegistryService=a,this._config=l,this._logger=this._loggerFactory.newLogger("core-shortcut-service","core-shortcut-service"),this._registeredDesktopShortcuts=[]}addAppWideShortcut(e,t,i,n){var o;null===(o=this._shortcutRegistryService)||void 0===o||o.addAppWideShortcut(e,t,i,n)}removeAppWideShortcut(e){var t;null===(t=this._shortcutRegistryService)||void 0===t||t.removeAppWideShortcut(e)}getAppWideShortcutHandler(e){var t;return null===(t=this._shortcutRegistryService)||void 0===t?void 0:t.getAppWideShortcutHandler(e)}addDesktopClientShortcut(e,t,i,n){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;if(!n)return void this._logger.warn(`Missing windowId for command: ${t}`);const o=yield this._hostCommunicationService.loadModule("windowcontrols");try{const s=yield null===(r=null==o?void 0:o.addShortcut)||void 0===r?void 0:r.call(o,n,e);return s&&(this._logger.log(`Added desktop shortcut for command ${t} and shortuctId ${s}`),this._registeredDesktopShortcuts.push({commandId:t,shortcutId:s,commandHandler:i,windowId:n})),s}catch(i){return this._logger.error(`Failed addShortcut for command ${t} and shortuctId ${e.mac}`),""}}))}removeDesktopClientShortcut(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;this._logger.debug(`Removing desktop shortcut for commandId ${e}`);const n=this._registeredDesktopShortcuts.find((i=>i.commandId===e&&i.windowId===t));if(n){const o=yield this._hostCommunicationService.loadModule("windowcontrols");yield null===(i=null==o?void 0:o.removeShortcut)||void 0===i?void 0:i.call(o,n.windowId,n.shortcutId),this._logger.log(`Removed desktop shortcut for command ${e} and shortuctId ${n.shortcutId}`),this._registeredDesktopShortcuts=this._registeredDesktopShortcuts.filter((i=>!(i.commandId===e&&i.windowId===t)))}}))}addGlobalShortcut(e,t,i){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return null===(n=this._shortcutRegistryService)||void 0===n?void 0:n.addGlobalShortcut(e,t,i)}))}removeGlobalShortcut(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return null===(t=this._shortcutRegistryService)||void 0===t?void 0:t.removeGlobalShortcut(e)}))}addEventListener(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this._config.enableShortcutPropagation)return;const i=yield this.getMainWindow();(null==i?void 0:i.id)===e&&(this._mainShortcutServiceCallback=t)}))}processEvent(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this._config.enableShortcutPropagation)return;(yield this.getMainWindow())?null===(i=this._mainShortcutServiceCallback)||void 0===i||i.call(this,e):(this._mainShortcutServiceCallbackWithPayload=()=>{var t;null===(t=this._mainShortcutServiceCallback)||void 0===t||t.call(this,e)},this._subscribeToChangeReportingService()),yield this.openMainApp()}))}registerForDesktopClientKeyDownShortcuts(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;const t=yield this._hostCommunicationService.loadModule("windowcontrols");this._disposeDesktopShortcutKeyDowEventRegistration=null===(e=null==t?void 0:t.registerForKeyDown)||void 0===e?void 0:e.call(t,(e=>this._handleDesktopShortcut(e)))}))}registerForGlobalShortcutActivated(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return null===(e=this._shortcutRegistryService)||void 0===e?void 0:e.registerForGlobalShortcutActivated()}))}destroy(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(null===(t=this._shortcutRegistryService)||void 0===t||t.destroy(e),this._config.enableShortcutRegistrationWithDesktopClient&&(null===(i=this._disposeDesktopShortcutKeyDowEventRegistration)||void 0===i||i.call(this)),this._config.enableShortcutPropagation){const e=this._activeWindowsService.enableDecoupleCommandingFromApollo?this._activeWindowsService.getActiveWindows():yield(0,_s.XD)(this._client),t=e.find((e=>e.isMainWindow&&e.layoutConfig.layoutMode===ve.lO.standard));t||(this._mainShortcutServiceCallback=void 0),0!==e.length&&this._authenticationUser&&(null==t?void 0:t.userContextId)===(0,Ee.b4)(this._authenticationUser)||(this._mainShortcutServiceCallbackWithPayload=void 0,this._mainShortcutServiceCallback=void 0,this._subscription&&this._subscription.unsubscribe())}}))}getMainWindow(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._activeWindowsService.enableDecoupleCommandingFromApollo?this._activeWindowsService.getStandardMainWindow():yield(0,_s.jW)(this._client)}))}openMainApp(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._commandHandler({entity:{type:pe.py.default,action:pe.uk.default},command:{visibilityState:ve.fe.show,stateTransition:ve.su.flush,correlation:{source:k.D.Core}}})}))}_handleDesktopShortcut(e){const t=this._registeredDesktopShortcuts.find((t=>t.shortcutId===e.shortcutId));t?(this._logger.debug(`Executing command handler for desktop shortcut: ${t.commandId} / ${e.shortcutId}`),t.commandHandler()):this._logger.warn(`Can't execute desktop shortcut with id ${e.shortcutId}. No record found.`)}_subscribeToChangeReportingService(){const e=this._experienceChangeReportingService.observeChanges();this._subscription=e.pipe((0,c.U)((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e.type!==ft.FV.LayoutRenderComplete)return;const t=yield this.getMainWindow();e.windowId===(null==t?void 0:t.id)&&this._onMainWindowLayoutRenderComplete()}))))).subscribe()}_onMainWindowLayoutRenderComplete(){var e;null===(e=this._mainShortcutServiceCallbackWithPayload)||void 0===e||e.call(this),this._mainShortcutServiceCallbackWithPayload=void 0,this._subscription&&this._subscription.unsubscribe()}}class wg extends Ce.i{constructor(){super(f.Yg.CreateCoreShortcutService,["activeWindowsService","commandHandler","client","coreSettings","experienceChangeReportingService","hostCommunicationService","loggerFactory","shortcutRegistryService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,authenticationUser:i,commandHandler:n,client:o,coreSettings:r,experienceChangeReportingService:s,hostCommunicationService:a,loggerFactory:l,shortcutRegistryService:c}=e,{enableShortcutPropagation:d,enableShortcutRegistrationWithDesktopClient:u,enableGlobalShortcuts:m,enableAppWideShortcuts:g}=r.get(b.J.Shortcuts);(d||m||u||g)&&(e.coreShortcutService=new bg(n,o,s,i,a,l,t,c,{enableShortcutPropagation:!!d,enableShortcutRegistrationWithDesktopClient:!!u,enableGlobalShortcuts:!!m,enableAppWideShortcuts:!!g}))}))}}class Cg extends Ce.i{constructor(){super(f.Yg.CreateCoreUtilities,["isEntityInView"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{isEntityInView:t}=e;e.coreUtilities={isEntityInView:t}}))}}class _g{constructor(e,t){this.channelName=e,this.host=t,this.subscriptions=[],this.hostResumeEventHandler=()=>{this.closeChannel(),this.initializeChannel()},this.initializeChannel(),this.subcribeToHostLifecycleEvents()}canPostMessage(){return!!this.broadcastChannel}postMessage(e){return this.broadcastChannel?(this.broadcastChannel.postMessage(e),"success"):"failure"}subscribeToMessage(e){var t;this.subscriptions.push(e),null===(t=this.broadcastChannel)||void 0===t||t.addEventListener("message",(t=>e(t.data)))}dispose(){this.unsubscribeFromHostLifecycleEvents(),this.closeChannel(),this.subscriptions=[]}initializeChannel(){const e=new BroadcastChannel(this.channelName);this.broadcastChannel=e,this.subscriptions.forEach((t=>e.addEventListener("message",(e=>t(e.data)))))}closeChannel(){var e;null===(e=this.broadcastChannel)||void 0===e||e.close(),this.broadcastChannel=void 0}subcribeToHostLifecycleEvents(){this.host.addEventListener("resume",this.hostResumeEventHandler)}unsubscribeFromHostLifecycleEvents(){this.host.removeEventListener("resume",this.hostResumeEventHandler)}}class Tg{constructor(e,t){var i,n;this.logger=e,this.host=t,this.subscriptions=new Map,this.channel=new _g(Tg.CrossTabsCommsBusKey,this.host),this.initializeSubscriptions(),null===(n=(i=this.logger).logNoPii)||void 0===n||n.call(i,"Initialized")}postMessage(e,t){if(!this.channel.canPostMessage())return"failure";const i=this.toCrossTabsMessagePayload(e,t);return this.channel.postMessage(i)}subscribeToMessage(e,t){const i=this.subscriptions.get(e)||new Set;i.add(t),this.subscriptions.set(e,i);const n=()=>{const i=this.subscriptions.get(e);(null==i?void 0:i.has(t))&&i.delete(t)};return()=>n()}dispose(){this.channel.dispose(),this.subscriptions.clear()}broadcastedMessageHandler(e){var t,i;null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,`Message received: type=${e.messageType}, id={${e.messageId}}, correlationId={${e.correlationId}}`);const n=e.messageType;if(n){const t=this.subscriptions.get(n);t&&t.forEach((t=>t(Object.assign({},e))))}}initializeSubscriptions(){this.channel.subscribeToMessage((e=>this.broadcastedMessageHandler(e)))}toCrossTabsMessagePayload(e,t){return Object.assign({messageType:e,timestamp:Date.now(),messageId:(0,ee.GW)(),correlationId:(null==t?void 0:t.responseRequired)?(0,ee.GW)():void 0},t)}}Tg.CrossTabsCommsBusKey="CrossTabsBus";class Ig{constructor(e,t,i){this.baseCrossTabsService=e,this.logger=t,this.host=i,this.subscribeToTabsSearch()}areOtherTabsDetected(){return new Promise((e=>{let t=0;const i=this.baseCrossTabsService.subscribeToMessage("SearchTabsResponse",(()=>{t&&this.host.clearTimeout(t),i(),e(!0)}));"failure"===this.baseCrossTabsService.postMessage("SearchTabs",{responseRequired:!0})&&(i(),e(!1)),t=this.host.setTimeout((()=>{e(!1)}),1e3)}))}subscribeToTabsSearch(){this.baseCrossTabsService.subscribeToMessage("SearchTabs",(e=>{var t,i;this.baseCrossTabsService.postMessage("SearchTabsResponse",{correlationId:e.correlationId}),null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,`SearchTabs received. CorrelationId: ${e.correlationId}`)}))}}const jg=3e5;class Ng{constructor(e,t,i,n){this.baseCrossTabsService=e,this.logger=t,this.host=i,this.timestampOfLastCountTabsResponse=0,this.waitForTabsCountTimeoutMs=5e3,this.waitForTabsCountResponsesTimeoutMs=3e3,this.tabsRecountIntervalMs=jg,this.tabClosingEventHandler=()=>{var e,t;null===(t=(e=this.logger).logNoPii)||void 0===t||t.call(e,"Tab might to be closing. Sending TabClosed message."),this.baseCrossTabsService.postMessage("TabClosed")},this.activeTabsCountBehaviorSubject=new r.X(1);const{disableActiveTabsCounting:o,crossTabsRecountIntervalMs:s,crossTabsWaitCountTabsResponseIntervalMs:a,crossTabsWaitForTabsCountTimeoutMs:l}=n.get(b.J.Core,["disableActiveTabsCounting","crossTabsRecountIntervalMs","crossTabsWaitCountTabsResponseIntervalMs","crossTabsWaitForTabsCountTimeoutMs"]);o||(this.tabsRecountIntervalMs=null!=s?s:jg,this.waitForTabsCountResponsesTimeoutMs=null!=a?a:3e3,this.waitForTabsCountTimeoutMs=null!=l?l:5e3,this.initializeTabsCounting())}observeActiveTabsCount(){return this.activeTabsCountBehaviorSubject.asObservable()}getActiveTabsCount(){return this.activeTabsCountBehaviorSubject.getValue()}dispose(){var e,t;this.clearTabsCountingTimer(),this.clearWaitForTabsCountTimer(),null===(t=null===(e=this.countTabsPromise)||void 0===e?void 0:e.cancel)||void 0===t||t.call(e),this.unsubscribeFromHostLifecycleEvents(),this.activeTabsCountBehaviorSubject&&this.activeTabsCountBehaviorSubject.complete()}initializeTabsCounting(){this.initializeTabClosingHandlers(),this.baseCrossTabsService.subscribeToMessage("TabsCount",(e=>{var t,i;this.clearWaitForTabsCountTimer(),null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,`TabsCount ${e.tabsCount} received. CorrelationId: ${e.correlationId}`),this.updateActiveTabsCount(e.tabsCount,e.lastResponseTimestamp),this.restartTabsCountingTimer()})),this.baseCrossTabsService.subscribeToMessage("CountTabs",(e=>{var t,i;this.baseCrossTabsService.postMessage("CountTabsResponse",{correlationId:e.correlationId}),null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,`CountTabs received. CorrelationId: ${e.correlationId}`),this.startWaitForTabsCountTimer()})),this.restartTabsCountingTimer(),this.countTabs(!0)}countTabs(e=!1){if(this.countTabsPromise)return this.countTabsPromise.promise;let t;const i=new Promise((i=>{var n,o;let r=0;const s=(0,ee.GW)();let a=1,l=Date.now();const c=this.baseCrossTabsService.subscribeToMessage("CountTabsResponse",(e=>{e.correlationId===s&&(a++,l=Date.now())}));t=()=>{c(),r&&this.host.clearTimeout(r),r=0,i()};const d=this.baseCrossTabsService.postMessage("CountTabs",{correlationId:s}),u=Date.now(),m=()=>{var n,o,r,d;c();const m=this.getActiveTabsCount().toString();this.updateActiveTabsCount(a,l),this.baseCrossTabsService.postMessage("TabsCount",{tabsCount:a,correlationId:s,lastResponseTimestamp:l});const g=l>=u?l-u:-1;null===(o=(n=this.logger).infoToTelemetry)||void 0===o||o.call(n,`tabs counting timespan is ${g}`,"crosstabs_tabs_counting_timespan",{delta:g},!0),null===(d=(r=this.logger).infoToTelemetry)||void 0===d||d.call(r,`tabs count is ${a}`,"crosstabs_tabs_count",{currentState:e?void 0:m,newState:a.toString()},!0),t=void 0,i()};"failure"===d?(null===(o=(n=this.logger).errorToTelemetry)||void 0===o||o.call(n,"countTabs can't post message","crosstabs_tabs_counting_error"),m()):r=this.host.setTimeout((()=>{m()}),this.waitForTabsCountResponsesTimeoutMs)})).then((()=>{this.countTabsPromise=void 0}));return this.countTabsPromise={promise:i,cancel:()=>null==t?void 0:t()},this.countTabsPromise.promise}updateActiveTabsCount(e,t){var i,n;e&&e!==this.activeTabsCountBehaviorSubject.getValue()&&t>this.timestampOfLastCountTabsResponse?(this.timestampOfLastCountTabsResponse=t,this.activeTabsCountBehaviorSubject.next(e)):null===(n=(i=this.logger).logNoPii)||void 0===n||n.call(i,`Tabs count is not updated. timestampOfLastCountTabsResponse: ${this.timestampOfLastCountTabsResponse}, lastResponseTimestamp for update: ${t}`)}restartTabsCountingTimer(){this.clearTabsCountingTimer(),this.nextTabsRecountTimerId=this.host.setInterval((()=>{void 0===this.waitForTabsCountTimerId&&this.countTabs()}),this.tabsRecountIntervalMs)}clearTabsCountingTimer(){void 0!==this.nextTabsRecountTimerId&&(this.host.clearInterval(this.nextTabsRecountTimerId),this.nextTabsRecountTimerId=void 0)}startWaitForTabsCountTimer(){this.waitForTabsCountTimerId||(this.waitForTabsCountTimerId=this.host.setTimeout((()=>{this.waitForTabsCountTimerId=void 0,this.restartTabsCountingTimer(),this.countTabs()}),this.waitForTabsCountTimeoutMs))}clearWaitForTabsCountTimer(){void 0!==this.waitForTabsCountTimerId&&(this.host.clearTimeout(this.waitForTabsCountTimerId),this.waitForTabsCountTimerId=void 0)}initializeTabClosingHandlers(){this.host.addEventListener("beforeunload",this.tabClosingEventHandler),this.baseCrossTabsService.subscribeToMessage("TabClosed",(()=>{var e,t;this.clearWaitForTabsCountTimer(),null===(t=(e=this.logger).logNoPii)||void 0===t||t.call(e,"TabClosed received."),this.startWaitForTabsCountTimer()}))}unsubscribeFromHostLifecycleEvents(){this.host.removeEventListener("beforeunload",this.tabClosingEventHandler)}}class Eg{constructor(e,t,i){var n,o;this.logger=e.newLogger("CrosstabService","services-io-browser-crosstabs"),this.basicCrossTabsService=new Tg(this.logger,t),this.tabsFinderHelper=new Ig(this.basicCrossTabsService,this.logger,t),this.tabsCounterHelper=new Ng(this.basicCrossTabsService,this.logger,t,i),this.loggingActiveTabsCountSubsciption=this.observeActiveTabsCount().subscribe((e=>{var t,i;null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,`Active tabs count: ${e}`)})),null===(o=(n=this.logger).logNoPii)||void 0===o||o.call(n,"Initialized")}observeActiveTabsCount(){return this.tabsCounterHelper.observeActiveTabsCount()}getActiveTabsCount(){return this.tabsCounterHelper.getActiveTabsCount()}postMessage(e,t){return this.basicCrossTabsService.postMessage(e,t)}subscribeToMessage(e,t){return this.basicCrossTabsService.subscribeToMessage(e,t)}areOtherTabsDetected(){return this.tabsFinderHelper.areOtherTabsDetected()}dispose(){this.basicCrossTabsService.dispose(),this.tabsCounterHelper.dispose(),this.loggingActiveTabsCountSubsciption.unsubscribe()}}var xg=i(805012);class Ag extends Ce.i{constructor(){super(f.Yg.CreateCrossTabsService,["coreSettings","localStorage","loggerFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,localStorage:i,loggerFactory:n,windowProvider:o}=e,{enableCrossTabsCommunication:r}=t.get(b.J.Core,["enableCrossTabsCommunication"]);if(r){const r=function(e,t,i){var n;try{return new Eg(e,t,i)}catch(t){const i=e.newLogger("CrosstabService","services-io-browser-crosstabs"),o="Can't be initialized.";return void(null===(n=i.errorToTelemetry)||void 0===n||n.call(i,o,"cross_tabs_init_failed",void 0,!0))}}(n,o,t);e.crossTabsService=r,r&&r.subscribeToMessage("T2WebOptOut",(()=>this.onT2WebOptOut(n,i,r)))}}))}onT2WebOptOut(e,t,i){var n;const o=e.newLogger("T2WebOutOutMessageHandler","t2-web-opt-out-message-handler");null===(n=o.logNoPii)||void 0===n||n.call(o,"T2WebOptOut message received, redirecting this tab to T1");new xg.BZ(t,e,i).redirectThisTabToT1("CrossTabMessage")}}var Dg=i(456462),Fg=i(890105),Og=i(549426);const Mg=["activeCalls","activeMeetings","activeWindow","activeWindowForEntity","activeWindows","allClientPreferences","appsInstalledByCurrentUser","appsUsage","attendeeCaptionsVisibility","bannerNotificationQueue","byodState","cachedAppList","callingScreenLayout","callingScreenStatus","clientPreferences","currentCallingState","currentEspSurfaceId","espState","fetchDynamicCommandsV2","isEntityInActiveWindow","isUbarRenderComplete","localizationSettings","meetingRoomFrontOfRoomCallPanelsState","meetingRoomLayoutToggleState","pinnedMeetings","pptSharingSession","recentMeetings","requestImmersiveReader","shouldLaunchWhiteboardOnLoad","whiteboardSharingSession","whiteboardWalkUpState","liveStreamIdMetadata"],Rg=["addSharedPlatformCachedApps","executeEntityCommand","changeMonitorSlotContent","changeSlotsVisibility","performWindowHistoryNavigation","navigateToWindowHistoryIndex","recordAppActionUsage","recordAppSceneUsage","recordAppUsage","removeSharedPlatformCachedApps","removeUserActiveWindows","removeWindow","resizeHeaderSlot","resizeSlotDimensions","pushToWindowHistory","removeFromWindowHistory","saveReactiveVarsToHistory","setActiveCalls","setByodState","setCallingScreenLayout","setCallingScreenStatus","setDisplayMirroring","setDisplayConfigType","setUbarRenderComplete","toggleHideMyselfVideo","togglePinMyself","toggleMyselfInGrid","toggleParticipantPin","updateActiveCalls","updateAttendeeCaptionsVisibility","updateClientPreferences","updateCurrentLocale","updateEntity","updateEntityState","updateExtendedEntityContainerState","updateMeetingRoomLayoutToggleState","updateSharedPlatformCachedApps","updateShouldLaunchWhiteboardOnLoad","updateWhiteboardWalkUpState","setMeetingRoomFrontOfRoomCallPanelsState","recordEspCompletedActions","recordDisplayedSurface","recordEligibleSurface","startLiveStream","setLiveStreamCaptionsData"],Pg=["appsInstalledByCurrentUserEvent","appsUsageUpdateEvent","callParticipantPinnedEventv2","dynamicCommandsUpdateEvent"],Lg=["activeWindow","activeWindowForEntity","activeWindows","allClientPreferences","cachedAppList","clientPreferences","currentEspSurfaceId","espGlobalState","isEntityInActiveWindow","localizationSettings","poppedOutWindowState"],Ug=[...Lg,"activeCalls","activeMeetings","appsInstalledByCurrentUser","appsUsage","bannerNotificationQueue","byodState","callingScreenLayout","callingScreenStatus","currentCallingState","fetchDynamicCommandsV2","meetingRoomLayoutToggleState","meetingTemplateDescriptions","pinnedMeetings","pptSharingSession","recentMeetings","requestImmersiveReader","whiteboardSharingSession","espState"],Wg=["addSharedPlatformCachedApps","executeEntityCommand","changeMonitorSlotContent","changeSlotsVisibility","removeWindow","setPoppedOutWindowState","resizeHeaderSlot","performWindowHistoryNavigation","navigateToWindowHistoryIndex","removeSharedPlatformCachedApps","removeUserActiveWindows","resizeSlotDimensions","pushToWindowHistory","removeFromWindowHistory","saveReactiveVarsToHistory","updateClientPreferences","updateCurrentLocale","updateEntity","updateEntityState","updateExtendedEntityContainerState","updateSharedPlatformCachedApps","setEspGlobalState","createNotificationsWindow","removeNotificationsWindow"],Bg=[...Wg,"setActiveCalls","setByodState","setCallingScreenLayout","setCallingScreenStatus","setDisplayMirroring","setDisplayConfigType","toggleParticipantPin","toggleHideMyselfVideo","toggleMyselfInGrid","togglePinMyself","updateActiveCalls","updateMeetingRoomLayoutToggleState","recordEspCompletedActions","recordDisplayedSurface","recordEligibleSurface","recordAppActionUsage","recordAppSceneUsage","recordAppUsage"],$g=[],Hg=[...$g,"appsInstalledByCurrentUserEvent","appsUsageUpdateEvent","callParticipantPinnedEventv2","callHideMyselfVideoEvent","dynamicCommandsUpdateEvent","callMyselfVideoPinnedEvent"],qg=["chat","messages","installedAppsV2"],zg=[...Mg,"lpcState","pinnedChannels","joinedTeamsAndChannels"],Vg=(e,t,i)=>{const n=(0,Fg.p$)(e),{operation:o,selectionSet:{selections:r},variableDefinitions:s}=n,a=Jg[o],l=(null==s?void 0:s.some((e=>!!e.defaultValue)))?function(e,t={}){const i={};for(const n of e){const e=n.variable.name.value;t.hasOwnProperty(e)?i[e]=t[e]:n.defaultValue&&(i[e]=(0,Og.M)(n.defaultValue))}return i}(s,t):t;return r.filter((e=>"Field"===e.kind&&!zg.includes(e.name.value))).map((e=>({id:a,fieldName:e.name.value,args:Gg(e,l),schemaId:i})))};function Gg(e,t){var i;if(!(null===(i=null==e?void 0:e.arguments)||void 0===i?void 0:i.length))return;const n={};for(const i of e.arguments){const e=(0,Og.M)(i.value,t);void 0!==e&&(n[i.name.value]=e)}return n}const Jg={query:"ROOT_QUERY",mutation:"ROOT_MUTATION",subscription:"ROOT_SUBSCRIPTION"};var Kg;!function(e){e[e.DefaultSchema=0]="DefaultSchema",e[e.ViewSchema=1]="ViewSchema"}(Kg||(Kg={}));var Qg=i(925477);const Yg=i(787125);var Xg=i(948265);class Zg{constructor(e){this._inactiveOperations=new Map,this._forcedActiveOperations=new Map,this._windowToDataMap=new Map,this._dataToWindowMap=new Map,this._activeOperations=(null==e?void 0:e.activeOperationLimit)?new Xg.Z({maxSize:e.activeOperationLimit,onEviction:this.markLeastRecentlyUsedOperation.bind(this)}):new Map}trackOperation(e,t,i=Kg.DefaultSchema,n){const{fetchPolicy:o,variables:r}=e,s=e.query||e.mutation;if("no-cache"===o)return;if(e.mutation&&!e.keepRootFields)return;Vg(s,r,i).forEach((e=>{const i=(e=>{const t=Yg(e);return(0,Qg.Z)(t)})(e);this._activeOperations.set(i,e),"boolean"==typeof n&&this.forceActive(i,n),this.addDataForWindow(t,i),this._inactiveOperations.has(i)&&this._inactiveOperations.delete(i)}))}markDataForWindowAsInactive(e){const t=this._windowToDataMap.get(e)||[];this._windowToDataMap.delete(e),t.forEach((t=>{const i=this._dataToWindowMap.get(t);if(i&&(i.delete(e),i.size))return;const n=this._activeOperations.get(t);n&&this._inactiveOperations.set(t,n),this._dataToWindowMap.delete(t),this._activeOperations.delete(t)}))}flush(e=this._inactiveOperations.size){const t=[],i=[];let n=0;return this._inactiveOperations.forEach(((o,r)=>{n>=e||(t.push(o),i.push(r),qg.includes(o.fieldName)&&(n=e),n++)})),i.forEach((e=>this._inactiveOperations.delete(e))),{descriptors:t,hasMore:!!this._inactiveOperations.size}}DEBUG_ONLY_getInactiveOperations(){return this._inactiveOperations}addDataForWindow(e,t){let i=this._windowToDataMap.get(e);i||(i=new Set,this._windowToDataMap.set(e,i)),i.add(t);let n=this._dataToWindowMap.get(t);n||(n=new Set,this._dataToWindowMap.set(t,n)),n.add(e)}forceActive(e,t){var i;const n=(null!==(i=this._forcedActiveOperations.get(e))&&void 0!==i?i:0)+(t?1:-1);0!==n?this._forcedActiveOperations.set(e,n):this._forcedActiveOperations.delete(e)}markLeastRecentlyUsedOperation(e,t){var i;(null!==(i=this._forcedActiveOperations.get(e))&&void 0!==i?i:0)>0?this._activeOperations.set(e,t):this._inactiveOperations.set(e,t)}}class eh{constructor(e,t,i,n){this.dataOpsRepository=e,this.scenarioFactory=t,this.windowProvider=n,this.clients=new Set,this.logger=i.newLogger("EvictionService","data-client-core")}register(e){this.clients.add(e)}unregister(e){this.clients.delete(e)}evict(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.lastEvictionResult={entriesEvicted:0,entriesNotEvicted:0,entriesGCed:0};let e=!0;do{e=yield this.evictByWindowRequestIdleCallback()}while(e)}))}DEBUG_ONLY_getInactiveOperations(){return this.dataOpsRepository.DEBUG_ONLY_getInactiveOperations()}DEBUG_ONLY_getClients(){return this.clients}DEBUG_ONLY_lastResult(){return this.lastEvictionResult}evictByWindowRequestIdleCallback(){return new Promise((e=>{this.windowProvider.requestIdleCallback((t=>{let i=!1,n=0;do{const e=performance.now(),o=t.timeRemaining();this.logger.debug("Time remaining at start",o);const r=this.scenarioFactory.newScenario(U.RG.CacheEviction);i=this.evictInternal(r);const s=t.timeRemaining(),a=performance.now();n=s>0?s:o-(a-e);const l={"Eviction.TimeRemaining":n};r.stop(l),this.logger.debug("Time remaining at end",n)}while(i&&n>10);e(i)}))}))}evictInternal(e){const{descriptors:t,hasMore:i}=this.dataOpsRepository.flush(10);let n=0,o=0;const r=this.groupCachesBySchema(),s=new Set;t.forEach((e=>{var t;const i=null!==(t=r.get(e.schemaId))&&void 0!==t?t:[];let a=!1;i.forEach((t=>{t.evict(e)&&(s.add(t),a=!0)})),a?n++:o++}));const a={"Eviction.EntriesEvicted":n,"Eviction.EntriesNotEvicted":o};e.mark("eviction",a);let l=0;s.forEach((e=>{const t=e.gc();l+=t.length}));const c={"Eviction.EntriesCollected":l};return e.mark("gc",c),this.logger.debug("Eviction results",{entriesEvicted:n,entriesNotEvicted:o,entriesGCed:l}),this.lastEvictionResult&&(this.lastEvictionResult.entriesEvicted+=n,this.lastEvictionResult.entriesNotEvicted+=o,this.lastEvictionResult.entriesGCed+=l),i}groupCachesBySchema(){const e=new Map;return this.clients.forEach((t=>{let i=e.get(t.schemaId);i||(i=new Set,e.set(t.schemaId,i)),i.add(t.cache)})),e}}var th=i(866009),ih=i(301767),nh=i(801470),oh=i(540780),rh=i(286795),sh=i(939864),ah=i(957277),lh=i(12817),ch=i(365056);function dh(e){return function(t,{args:i,toReference:n,canRead:o}){if(o(t))return t;const r=e(i);return o(r)?n(r):void 0}}const uh={merge:["prejoinState","callTranscriptState","activeWindow","activeWindowForEntity","messages","userPreferences"],replace:["activeWindows","callingAlerts","workWeekDays","dateRange","activeCalls","listBreakoutRoomsWithDetails"]},mh={Query:{fields:Object.assign(Object.assign({user:dh((e=>({__typename:"User",id:null==e?void 0:e.userId}))),presence:dh((e=>({__typename:"Presence",id:`${null==e?void 0:e.userId}_ups`}))),call:dh((e=>({__typename:"Call",id:null==e?void 0:e.id}))),streamDetails:dh((e=>({__typename:"StreamDetailsInfo",id:null==e?void 0:e.id}))),breakoutRoomsDetails:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]],read:dh((e=>({__typename:"BreakoutRoomsDetails",id:null==e?void 0:e.coordinates.threadId})))},extensibilityAppPicker:{keyArgs:["scope","conversationId","config"]},searchForMentionV2:{keyArgs:["teamId","searchQuery","includeBots","channelText","teamText","generalText","channelType","hostTenantId","enableScheduledTags","enableOwnersTag"]},breakoutRoomSettings:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},listBreakoutRoomsWithDetails:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},breakoutRoomsClientState:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},localizationSettings:{keyArgs:["currentLocale"]},searchConversation:{keyArgs:["searchTerm","conversationId","filters"],merge:(e,t)=>t?e?Object.assign(Object.assign({},t),{Results:[...e.Results,...t.Results]}):t:e},searchConversationTopics:{keyArgs:["searchTerm","conversationId","filters","isFromTopics"],merge:(e,t)=>t?e?Object.assign(Object.assign({},t),{Results:[...e.Results,...t.Results]}):t:e},myGroupSettings:{merge:(e,t)=>{if(!t)return[...e];if(!e)return[...t];const i=t[0],n=e[0];return[Object.assign(Object.assign({},i),n)]}}},uh.merge.reduce(((e,t)=>Object.assign({[t]:{merge:!0}},e)),{})),uh.replace.reduce(((e,t)=>Object.assign({[t]:{merge:!1}},e)),{}))},Subscription:{fields:{chatServiceEvent:{merge:!1},callRecordingStateChangedEvent:{merge:!1},callingServiceEvent:{merge:!1}}},CallParticipantsCounts:{keyFields:["teamsCallId"]},ParticipantCountsChanged:{keyFields:["teamsCallId"]},ParticipantsChanged:{keyFields:["teamsCallId"]},MessagesResult:{keyFields:!1},WindowHistoryItem:{keyFields:!1},SelectedDevices:{keyFields:!1},Window:{fields:{windowHistory:{merge:!1},activeEntities:{merge:!0},correlation:{merge:!0},extendedEntityContainerState:{merge:!0}}},DeviceList:{fields:{cameras:{merge:!1},camerasSupportingAutoFraming:{merge:!1},microphones:{merge:!1},selectedDevices:{merge:!0}}},Call:{fields:{extendedCallType:{merge:!0},capabilities:{merge:!0},breakoutRoomDetails:{merge:!0}}},RoomCoordinates:{keyFields:["threadId"]},BasicParticipant:{keyFields:["participantId"]},BreakoutRoomsDetails:{fields:{breakoutRooms:{merge:!1}}},BreakoutRoom:{fields:{clientActionState:{read:e=>e||null},participants:{merge:!1}}},CalendarEvent:{keyFields:["objectId"]},InDayEvents:{keyFields:["mailboxAddress","date"],fields:{events:{merge:!1}}},AllDayEvents:{keyFields:["mailboxAddress","date"],fields:{events:{merge:!1}}},Building:{keyFields:["address"]},RecurrenceEvents:{keyFields:["mailboxAddress","cleanGlobalObjectId"]},MeetingCompositeKey:{keyFields:["conversationId","messageId","eventId","modifiedStamp"]},Translation:{keyFields:!1},DiagnosticInfo:{keyFields:!1},EmailUser:{keyFields:["smtp"]},AuthenticationUserProfile:{keyFields:["objectId","tenantId"]},FluidPendingMention:{keyFields:["atMentionId"]},Participant:{keyFields:["participantId"]},Rectangle:{keyFields:!1},AudienceSceneExtent:{keyFields:!1},AudienceSceneParticipant:{keyFields:!1},ChatMessageMentionType:{keyFields:!1},Feed:{fields:{section:{keyArgs(e,{variables:t}){if(t)return t.section},merge(e,t){var i,n,o,r;return e?(null===(i=null==t?void 0:t.deltaRequestDetails)||void 0===i?void 0:i.deltaRequestId)&&t.deltaRequestDetails.deltaRequestId===(null==e?void 0:e.requestId)?Object.assign(Object.assign({},t),{dataReceivedOnClientTimestamp:e.dataReceivedOnClientTimestamp,items:[...e.items,...t.items]}):(null===(n=null==t?void 0:t.deltaRequestDetails)||void 0===n?void 0:n.deltaRequestId)===(null===(o=null==e?void 0:e.deltaRequestDetails)||void 0===o?void 0:o.deltaRequestId)&&(null==t?void 0:t.requestId)===(null==e?void 0:e.requestId)?t:(null===(r=t.deltaRequestDetails)||void 0===r?void 0:r.deltaRequestId)?e:t:t}}}},FeedItemType:{keyFields:["uri"]},FilesListResult:{keyFields:["threadId"]},PaymentDetails:{keyFields:["eventId"]},Channel:{fields:{defaultFileSettings:{merge:!0},membershipSummary:{merge:!0},spaceAdminSettings:{merge:!0}}},Team:{fields:{membershipSummary:{merge:!0},teamSettings:{merge:!0},teamGuestSettings:{merge:!0},teamSiteInformation:{merge:!0},sensitivityLabel:{merge:!0}}},TeamSettings:{fields:{funControl:{merge:!0}}}};function gh(e,t,i,n,o){if(i){const{config:{publicPath:i,buildType:r,buildVersion:s}}=n;if(!i)return;const a=window;if(a.__APOLLO_CLIENTS__||(a.__APOLLO_CLIENTS__=[]),a.__APOLLO_KEY_FIELDS__||(a.__APOLLO_KEY_FIELDS__=function(){const e={};for(const t of Object.keys(mh))mh[t].keyFields&&(e[t]=mh[t].keyFields);return e}()),"production"===r)"multi-window"===o?a.__REMPL_APOLLO_DEVTOOLS_URL__=`/multi-window/apollo-devtools?version=${s}`:"react-web-client"===o&&(a.__REMPL_APOLLO_DEVTOOLS_URL__="/v2/apollo-devtools");else{const e=i.endsWith("/")?i:i.concat("/");a.__REMPL_APOLLO_DEVTOOLS_URL__=`${e}apollo-devtools.html`}a.__APOLLO_GLOBAL_OPERATIONS__||(a.__APOLLO_GLOBAL_OPERATIONS__={globalMutations:Rg,globalQueries:Mg,globalSubscriptions:Pg}),a.__APOLLO_CLIENTS__.push({client:e,clientId:t})}}class hh extends Error{constructor(e,t){super(`Accessing client ${e}/${t} after destroy`)}}const ph=new lh.i((()=>{throw new Error("This client has been destroyed!")}));class vh{constructor(e,t,i,n,o,r){var s,a;this.name=n,this.storeType=o,this.disposed=!1,this.schemaId=Kg.DefaultSchema,this.ctx=t,this.services=e,this._client=i,this._relayEnvironment=r,null===(s=this.services.leakDetector)||void 0===s||s.track(nr.I.DataClient,this),this.services.dataOpsTracker&&this.setupWatchQueryTracking(this.client),this.services.dataEvictionService&&(null===(a=this.services.dataEvictionService)||void 0===a||a.register(this)),this.registerClient(this.client)}get client(){if(!this._client)throw new hh(this.constructor.name,this.name);return this._client}get cache(){return this.client.cache}get link(){return this.client.link}get relayEnvironment(){return this._relayEnvironment}updateContext(e,t){var i;this.ctx=e,null===(i=this._client)||void 0===i||i.setLink(t)}destroy(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if((null===(e=this.services)||void 0===e?void 0:e.dataEvictionService)&&this.services.dataEvictionService.unregister(this),yield this.destroyClient(),this.ctx=void 0,this.services=void 0,this._relayEnvironment){this._relayEnvironment.getStore().getSource().clear()}this._relayEnvironment=void 0}))}clearCache(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield null===(e=this._client)||void 0===e?void 0:e.clearStore()}))}getServices(){return this.services}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:null,selfIsMainClient:!1}}mutate(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=this.getApolloClientInstance(e.mutation);null===(t=this.maybeGetGraphQLStoreStatsReporterService(i))||void 0===t||t.trackCall(this.storeType,ih.z.mutate);const n=this.patchOptions(e),o=yield i.mutate(n);return this.trackReadOperation(i,e),o}))}query(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=this.getApolloClientInstance(e.query);null===(t=this.maybeGetGraphQLStoreStatsReporterService(i))||void 0===t||t.trackCall(this.storeType,ih.z.query);const n=this.patchOptions(e),o=yield i.query(n);return this.trackReadOperation(i,e),o}))}readQuery(e,t){var i;const n=this.getApolloClientInstance(e.query);null===(i=this.maybeGetGraphQLStoreStatsReporterService(n))||void 0===i||i.trackCall(this.storeType,ih.z.readQuery);const o=n.readQuery(e,t);return this.trackReadOperation(n,e),o}subscribe(e){var t;const i=this.getApolloClientInstance(e.query);null===(t=this.maybeGetGraphQLStoreStatsReporterService(i))||void 0===t||t.trackCall(this.storeType,ih.z.subscribe);const n=this.patchSubscriptionOptions(e);return i.subscribe(n).map((t=>{var n;return this.trackReadOperation(i,e),null===(n=this.maybeGetGraphQLStoreStatsReporterService(i))||void 0===n||n.trackSubscribeEvent(this.storeType),t}))}watchQuery(e){var t;try{const i=this.getApolloClientInstance(e.query);null===(t=this.maybeGetGraphQLStoreStatsReporterService(i))||void 0===t||t.trackCall(this.storeType,ih.z.watchQuery);const n=this.patchOptions(e);return i.watchQuery(n)}catch(e){return new ch.y((t=>t.error(e)))}}writeQuery(e){var t;const i=this.getApolloClientInstance(e.query);return null===(t=this.maybeGetGraphQLStoreStatsReporterService(i))||void 0===t||t.trackCall(this.storeType,ih.z.writeQuery),this.trackWriteOperation(i,e),i.writeQuery(e)}writeFragment(e){var t;const i=this.getApolloClientInstance(e.fragment);return null===(t=this.maybeGetGraphQLStoreStatsReporterService(i))||void 0===t||t.trackCall(this.storeType,ih.z.writeFragment),this.trackWriteOperation(i,e),i.writeFragment(e)}readFragment(e,t){var i;const n=this.getApolloClientInstance(e.fragment);return null===(i=this.maybeGetGraphQLStoreStatsReporterService(n))||void 0===i||i.trackCall(this.storeType,ih.z.readFragment),n.readFragment(e,t)}get defaultOptions(){return this.client.defaultOptions}set defaultOptions(e){this.client.defaultOptions=e}get disableNetworkFetches(){return this.client.disableNetworkFetches}set disableNetworkFetches(e){this.client.disableNetworkFetches=e}getApolloClientInstance(e){return this.client}patchOptions(e){const{context:t,patched:i}=e,n=(0,o.__rest)(e,["context","patched"]);return i?e:Object.assign(Object.assign({},n),{context:t?Object.assign(Object.assign({},this.ctx),t):this.ctx,patched:!0})}patchSubscriptionOptions(e){var t;return e.context||(e.context={}),e.context.windowId||(e.context.windowId=null===(t=this.ctx)||void 0===t?void 0:t.windowId),e}registerClient(e){e.dataClients||(e.dataClients=[]),e.dataClients.push(this)}unregisterClient(e){var t,i,n;return e.dataClients=null===(t=e.dataClients)||void 0===t?void 0:t.filter((e=>e!==this)),0===(null!==(n=null===(i=e.dataClients)||void 0===i?void 0:i.length)&&void 0!==n?n:0)}disposeClient(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=this.unregisterClient(e);if(n&&((0,sh.$Z)(e),(0,sh.$Z)(e.cache),function(e){let t=window;for(t.__APOLLO_CLIENTS__&&(t.__APOLLO_CLIENTS__=t.__APOLLO_CLIENTS__.filter((t=>t.client!==e)));t;)t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__&&t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__.ApolloClient===e&&(t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__.ApolloClient=void 0),t.__APOLLO_CLIENT__&&t.__APOLLO_CLIENT__===e&&(t.__APOLLO_CLIENT__=void 0),t=t.parent===t?null:t.parent}(e)),n&&t){const{scenarioFactory:t}=null!==(i=this.services)&&void 0!==i?i:{},n=null==t?void 0:t.newScenario(U.RG.ApolloClientDisposion);try{e.stop(),yield e.clearStore(),e.setLink(ph),e.setResolvers([]),null==n||n.stop()}catch(e){null==n||n.fail({reason:String(e)})}}}))}disposeClients(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this._client&&(yield this.disposeClient(this._client,e),e&&(this._client=void 0))}))}destroyClient(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.disposed){this.disposed=!0;const{enableApolloClientDisposion:i}=null!==(t=null===(e=this.services)||void 0===e?void 0:e.coreSettings.get(b.J.Core))&&void 0!==t?t:{};yield this.disposeClients(null!=i&&i)}}))}setupWatchQueryTracking(e){const t=e.cache;if(vh.patchedCaches.has(t))return;const i=t.watch;t.watch=(n,...o)=>{this.trackReadOperation(e,n,!0);const r=i.call(t,n,...o);return()=>(this.trackReadOperation(e,n,!1),r())},vh.patchedCaches.set(t,i)}trackReadOperation(e,t,i){var n;this.ctx&&this.services&&(e instanceof vh||null===(n=this.services.dataOpsTracker)||void 0===n||n.trackOperation(t,this.name,this.schemaId,i))}trackWriteOperation(e,t){var i;this.ctx&&this.services&&(e instanceof vh||null===(i=this.services.dataReleaseService)||void 0===i||i.trackWriteOperation(t))}maybeGetGraphQLStoreStatsReporterService(e){var t,i;return e instanceof vh||!(null===(t=this.services)||void 0===t?void 0:t.graphqlStoreStatsReporterService)?null:null===(i=this.services)||void 0===i?void 0:i.graphqlStoreStatsReporterService}}vh.patchedCaches=new WeakMap;const yh=e=>e;class fh extends vh{constructor(e,t,i,n,o,r,s){super(e,n,i,o||"INVALID",r,s),this.parent=t}getApolloClientInstance(e){const t=(0,Fg.p$)(e);if("OperationDefinition"===t.kind||"FragmentDefinition"===t.kind){const{selectionSet:{selections:i}}=t,n=this.getSharedGlobalOperationsList(t),o=i.map((e=>"Field"===e.kind&&-1===n.indexOf(e.name.value)));if(o.every(yh))return this.client;if(o.some(yh)){const t=(0,se.Tr)(this.className,f.jK.InvalidInput,"route",{operation:e},"Operation contains mix of shared and window private selections");throw console.log(t),t}}return this.parent}getSharedGlobalOperationsList(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation?this.parentMutations:"OperationDefinition"===e.kind&&"subscription"===e.operation?this.parentSubscriptions:this.parentQueries}}class Sh extends fh{constructor(e,t,i,n,o){super(e,t,i,n,n.windowId,o)}get relayEnvironment(){return this.parent.relayEnvironment}get parentQueries(){return Mg}get parentSubscriptions(){return Pg}get parentMutations(){return Rg}get className(){return"ChildDataClient"}clone(e){throw new Error("Trying to clone child instance")}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}}class kh extends vh{constructor(e,t,i,n,o){super(e,i,t,i.windowId||"INVALID",n),this.parent=o}get relayEnvironment(){var e;return null===(e=this.parent)||void 0===e?void 0:e.relayEnvironment}clone(e){throw new Error("Trying to clone child instance")}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:null,selfIsMainClient:!!this.ctx&&this.ctx.windowId===f.ew}}}class bh extends kh{constructor(){super(...arguments),this.schemaId=Kg.ViewSchema}subscribe(e){const t=this.getApolloClientInstance(e.query),i=this.patchOptions(e);return t.subscribe(i)}}var wh=i(486331);class Ch extends vh{constructor(e,t,i,n,o){super(e,i,t({windowId:i.windowId||f.ew,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:"core",storeType:ih.t.core}),i.windowId||f.ew,ih.t.core,o),this.createApolloClient=t,this.overrideLink=null,this.viewSchemaClient=null,this.overrideLink=null,n&&(this.viewSchemaClient=n({windowId:i.windowId||f.ew,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:"core-viewSchema",storeType:ih.t.viewSchema}),this.registerClient(this.viewSchemaClient))}updateContext(e,t){super.updateContext(e,t),this.overrideLink=t}clone(e){return e.windowId===f.ew?new kh(this.getServices(),this.client,Object.assign(Object.assign({},this.ctx),e),this.storeType,this):new Sh(this.getServices(),this,this.createApolloClient({windowId:e.windowId,entityType:e.entityType,viewportContext:e.windowProvider.viewportContext,name:`child-${e.windowId}`,overrideLink:this.overrideLink,storeType:ih.t.window}),Object.assign(Object.assign({},this.ctx),e),ih.t.window)}cloneForViewSchema(e){return wh(this.viewSchemaClient,"View schema must be avaliable"),new bh(this.getServices(),this.viewSchemaClient,Object.assign(Object.assign({},this.ctx),e),ih.t.viewSchema)}disposeClients(e){const t=Object.create(null,{disposeClients:{get:()=>super.disposeClients}});return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield Promise.all([t.disposeClients.call(this,e),(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){this.viewSchemaClient&&(yield this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})))()])}))}}class _h extends vh{constructor(e,t,i){super(e,i,t,i.windowId||f.ew,ih.t.embed)}clone(e){return new kh(this.getServices(),this.client,Object.assign(Object.assign({},this.ctx),e),this.storeType)}}var Th=i(999207),Ih=i(551414),jh=i(571908);const Nh={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"WriteCallingDefaults"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingDebugTool"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"visible"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"passiveBarHiddenParticipantsCount"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"CallingDebugTool"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"streamPermissionsDebug"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"acknowledged"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"acknowledgementRequired"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"url"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"StreamPermissionsDebug"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"pptSharingSession"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"_"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ActivePptSession"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isFake"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"calls"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Call"}}}},arguments:[]}]}}]};const Eh={callingDebugTool:{__typename:"CallingDebugTool",visible:!0,passiveBarHiddenParticipantsCount:0},streamPermissionsDebug:{__typename:"StreamPermissionsDebug",acknowledged:!1,acknowledgementRequired:!1,url:"https://www.microsoft.com/"},pptSharingSession:{__typename:"ActivePptSession",id:0,_:!1},isFake:!1,calls:[]},xh={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"lpcState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"lpcState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isLivePersonaCardInitialized"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"lastLoggedInUserMri"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LpcState"}}},arguments:[]}]}}]},Ah={Query:{lpcState:(e,t,{cache:i})=>i.readQuery({query:xh})},Mutation:{setLpcState(e,{newLpcState:t},{cache:i}){const n={lpcState:Object.assign(Object.assign({},t),{__typename:"LpcState"})};return i.writeQuery({query:xh,data:n}),n.lpcState}}};var Dh=i(273586);const Fh=(e,t,i)=>{(0,Dh.k)(e),function(e,t){const i=t.newLogger("writeCallingDefaults","data-client-calling");(0,Th.tW)(e),(0,Th.bC)(e);try{e.writeQuery({query:Nh,data:Eh})}catch(e){i.error(`Fail to write calling defaults - ${e}`)}try{e.writeQuery({query:Ih.a,data:{shouldShowVideoEffectsPreview:!1}})}catch(e){i.error(`Fail to write default value of shouldShowVideoEffectsPreview - ${e}`)}try{e.writeQuery({query:jh.z,data:{shouldKeepPreviewWindowInSidePanelOpen:!1}})}catch(e){i.error(`Fail to write default value of shouldKeepPreviewWindowInSidePanelOpen - ${e}`)}}(e,t),function(e){e.writeQuery({query:xh,data:{lpcState:{__typename:"LpcState",isLivePersonaCardInitialized:!1,lastLoggedInUserMri:null}}})}(e),i&&Oh(e,i,t)},Oh=(e,t,i)=>{const n=i.newLogger("appDefaults","data-client-core"),o=t.length;n.log(`Writing ${o.toString()} app default values to the Apollo cache.`),t.forEach((t=>{var i,o;try{const{queryFieldName:i,gqlTypeName:n}=t,o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:`${n}DefaultQuery`},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:i},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]},r={[i]:{__typename:n}};e.writeQuery({query:o,data:r})}catch(e){const r=`Failed to write ${t.gqlTypeName} to cache as Query field ${t.queryFieldName}.`;null!==(o=null===(i=n.errorToTelemetry)||void 0===i?void 0:i.call(n,r,"webclient_framework_foundation_core_services_active_application_hooks",void 0,!0))&&void 0!==o||n.error(r)}}))};class Mh extends tc{constructor(e){super(),this.shellWindow=e,this.shellWindow.opener.addEventListener(O.rY.CentralDataLayerResponse,(e=>{this.onResponseReceived(e)}))}sendMessage(e){this.shellWindow.opener.postMessage(O.rY.CentralDataLayerRequest,{dataLayer:e})}}function Rh(e){return new lh.i((t=>{const{query:i,variables:n,operationName:o}=t,r=t.getContext(),s={callerInfo:null==r?void 0:r.callerInfo,callerScenarioId:null==r?void 0:r.callerScenarioId};return e.execute(i,n,o,null==r?void 0:r.rendererId,null==r?void 0:r.windowId,s)}))}const Ph={mutation:new Set(["notifyWorkerSyncCanStart","notifyActiveContextChangedToCDLWorker"]),query:new Set,subscription:new Set};var Lh=i(19184),Uh=i(632353);function Wh({resolvers:e,contextValue:t}){return new lh.i(((i,n)=>{const o=function(e,t){const{query:i}=e,n=(0,Fg.p$)(i);if("OperationDefinition"!==n.kind)return;const{operation:o,selectionSet:{selections:r}}=n;if("mutation"!==o)return;const s=function(e,t){let i;return e.forEach((e=>{if("Field"===e.kind){const n=function(e,t){let i;return t.forEach((({Mutation:t})=>{t[e]&&(i=i||t[e])})),i}(e.name.value,t);if(n){if(i)throw new Error("There cannot be more than 1 matching forward resolver for a document");i={selection:e,resolver:n}}}})),i}(r,t);if(!s)return;return function(e){if(!e.arguments.every((({name:e,value:t})=>"Variable"!==t.kind||t.name.value===e.value))){const t=e.arguments.map((e=>e.name.value)).join(","),i=e.arguments.map((e=>e.value.name.value)).join(",");throw new Error(`Argument name mismatch. Mutation queries, which have forward mutation resolvers should \n                    have a 1-1 name match between the document variable names and the field resolver variable names.\n                    Allowed argument names ${t} does not match the supplied argument names ${i}`)}}(s.selection),s.resolver}(i,e);if(!o)return n(i);const r=i.getContext();return(0,Uh.p)(o(i.variables,Object.assign(Object.assign({},t),r))).flatMap((e=>(i.variables=e,n(i))))}))}var Bh=i(513830);function $h(){return new lh.i(((e,t)=>t(e).map((t=>{if(!t.data||!e.query)return t;const{definitions:i}=e.query,n=i.find((e=>e.kind===Bh.h.OPERATION_DEFINITION));if(!n||!n.selectionSet)return t;try{const e=n.selectionSet.selections,i=Hh(qh(t.data),e);return t.data=i,t}catch(e){return t}}))))}function Hh(e,t){for(const i of t){if(i.kind!==Bh.h.FIELD)continue;const t=i.name.value;if("__typename"!==t)if(t in e){if(null!==e[t]&&i.selectionSet&&i.selectionSet.selections){e[t]=qh(e[t]);const n=i.selectionSet.selections;Hh(e[t],n)}}else e[t]=null}return e}function qh(e){return Array.isArray(e)?e.slice():"object"==typeof e?Object.assign({},e):e}var zh=i(744401);function Vh(e){return"subscription"===e.operationType}function Gh(e){const{operation:t,graphQLErrors:i,operationType:n}=e,o=t.getContext(),r={operationName:t.operationName,operationType:n,rendererId:o.windowId};return i&&i.length>0&&(r.errors=i.map((e=>function(e,t){let i=f.jK.UnhandledRuntimeException;const n={path:t};if(!e)return n;e.code?i=e.code:"Failed to fetch"===e.message&&(i=f.jK.FailedToFetch);if(n.code=i,e.hasOwnProperty("serverResponse")&&e.serverResponse){"number"==typeof e.serverResponse.status&&(n.status=e.serverResponse.status),n.mscv=e.serverResponse.headers["ms-cv"],n.xmsCorrelationId=e.serverResponse.headers["x-ms-correlation-id"];try{n.contextId=JSON.stringify(e.serverResponse.headers.contextid)}catch(e){}}return n}(e.originalError,e.path&&e.path.join("::"))))),r}function Jh(e,t,i){!Kh(e)&&i&&function(e,t,i){const n=Gh(e);if(n.errors&&n.errors.length>0){!function(e,t){const{operation:i,operationType:n}=e;t.error(`'${i.operationName}' operation of type '${n}' failed.`)}(e,t);const o=Object.assign(Object.assign({},n),{errors:"","Panel.WindowID":n.rendererId});n.errors[0].code===f.jK.FailedToFetch?i.cancel(o):i.fail(o)}else i.stop({operationName:n.operationName,operationType:n.operationType,"Panel.WindowID":n.rendererId})}(e,t,i)}function Kh(e){return Vh(e)}function Qh(e,t,i,n,o){const r=e.newLogger("TrackRequestLink","data-resolvers-browser-common");return new lh.i(((e,s)=>{const{query:a}=e,{operation:l}=(0,Ed.S)(a,null),c=s(e);let d;return i&&(null==o||o.addOperation(e.operationName,l,"Request")),n&&(d=function(e,t){let i;return Kh(e)||(i=t.newScenario(U.RG.QueryExecution)),i}({operationType:l,operation:e},t)),new ch.y((t=>{let s;try{s=c.subscribe({next:s=>{n&&(s.errors&&s.errors.length>0?Jh({operation:e,operationType:l,graphQLErrors:s.errors,response:s},r,d):function(e,t){if(!Vh(e)&&t){const i=Gh(e);t.mark(U.ck.QueryResult,{operationName:i.operationName,operationType:i.operationType,"Panel.WindowID":i.rendererId})}}({operation:e,operationType:l,response:s},d)),i&&(null==o||o.addOperation(e.operationName,l,"Response")),t.next(s)},error:s=>{const a=(e=>e&&e.result?e.result.errors:e instanceof Error?[new zh._("Unhandled exception",void 0,void 0,void 0,void 0,e)]:[new zh._("Unknown error payload provided from forward link")])(s);n&&Jh({operation:e,operationType:l,graphQLErrors:a},r,d),i&&(null==o||o.addOperation(e.operationName,l,"Error")),t.error(s)},complete:()=>{n&&Jh({operationType:l,operation:e},r,d),d=void 0,t.complete()}})}catch(t){throw n&&Jh({operationType:l,operation:e,graphQLErrors:[new zh._("Unhandled exception in forward link",void 0,void 0,void 0,void 0,t)]},r,d),d=void 0,t}return()=>{n&&Jh({operationType:l,operation:e},r,d),d=void 0,s&&s.unsubscribe()}}))}))}const Yh=new class{constructor(){this.map=new Map}destroy(e){const t=this.map.get(e);t&&(t.subscriptions.forEach((e=>{e.next(void 0),e.complete()})),t.subscriptions.length=0,this.map.delete(e))}register(e){if(!this.map.has(e)){const t=new ch.y((t=>{const{subscriptions:i}=this.map.get(e)||{};i&&i.push(t)}));this.map.set(e,{cancellationObservable:t,subscriptions:[]})}return this.map.get(e).cancellationObservable}};function Xh(e){Yh.destroy(e)}function Zh(e,t){const i=e.newLogger("TrackSubscriptionLinks","data-resolvers-browser-common");return new lh.i(((e,n)=>{const{eventsWithoutCancellationListener:o}=t.get(b.J.Calling),{operationName:r,query:s}=e,{operation:a}=(0,Ed.S)(s,null);if("subscription"!==a||(null==o?void 0:o.includes(r)))return n(e);const l=(0,xe.v4)(),c=Yh.register(l);return i.debug(`Forwarding request ${l} for operation ${r}`),e.setContext({cancellationListener:c}),new ch.y((t=>{let i;try{const o=n(e);i=o.subscribe({next:e=>{var i;(null===(i=null==e?void 0:e.errors)||void 0===i?void 0:i.length)&&Xh(l),t.next(e)},error:e=>{Xh(l),t.error(e)},complete:()=>{Xh(l),t.complete()}})}catch(e){throw Xh(l),e}return()=>{Xh(l),i&&i.unsubscribe()}}))}))}function ep(e){Yh.destroy(e)}function tp(e,t=void 0,i=!1){const n=new Map,o=new Map;if(!e)throw new Error("Need an operation name to support");return new lh.i(((r,s)=>{if(!((e,t)=>{const{query:i}=e,n=(0,Fg.p$)(i);if(!n||"OperationDefinition"!==n.kind)return!1;const{selectionSet:{selections:o}}=n,{operation:r}=(0,Ed.S)(i,null);if("subscription"!==r)return!1;if(o.length>1)throw new Error("There cannot be more than 1 selection for this link");const s=o[0];if("Field"===s.kind&&s.name.value===t){if(s.arguments.every((({name:e,value:t})=>"Variable"!==t.kind||t.name.value===e.value)))return!0;throw new Error("Argument name must match value")}return!1})(r,e))return s(r);const a=(({operationName:e,variables:t})=>`${e}.${JSON.stringify(Object.keys(t).sort().map((e=>{const i=t[e];if(-1!==["boolean","string"].indexOf(typeof i)||null===i||Number.isSafeInteger(i))return[e,i];throw new Error("Unsupported argument type")})))}`)(r);return new ch.y((e=>{const l=n.get(a);if(l)l.observersCollection.push(e),i&&o.has(a)&&e.next(o.get(a));else{let l="";if(t&&t.get(b.J.Calling).enableSubscriptionCancellationListener){l=(0,xe.v4)();const e=Yh.register(l);r.setContext((t=>Object.assign(Object.assign({},t),{cancellationListener:e})))}try{const t=s(r).subscribe({next:e=>{i&&o.set(a,e);n.get(a).observersCollection.slice().forEach((t=>{t.next(e)}))},error:e=>{const{observersCollection:t}=n.get(a);n.delete(a);for(const i of t)i.error(e)},complete:()=>{const{observersCollection:e}=n.get(a);n.delete(a);for(const t of e)t.complete()}});n.set(a,{observersCollection:[e],forwardSubscription:t,requestId:l})}catch(e){throw null!==l&&""!==l&&ep(l),e}}return()=>{const t=n.get(a);if(!t)return;const{observersCollection:i,forwardSubscription:r,requestId:s}=t,l=i.indexOf(e);-1!==l&&(i.splice(l,1),0===i.length&&(n.delete(a),o.delete(a),null!==s&&""!==s&&ep(s),r&&r.unsubscribe()))}}))}))}var ip=i(846889);function np(e){const t=e();return new lh.i(((e,i)=>{const n=t.then((t=>t.request(e,i)));return new ch.y((e=>{let t;return n.then((i=>{e.closed||(t=null==i?void 0:i.subscribe(e))}),(t=>{e.closed||e.error(t)})),()=>null==t?void 0:t.unsubscribe()}))}))}var op=i(681e3),rp=i(403588),sp=i(501052);const ap=(e,t,i)=>(0,sp.q)((({graphQLErrors:n,operation:o})=>{const r=e.newLogger(t,"data-client-core");if(n){(({graphQLErrors:e,operationName:t,logger:i,disableTelemetryLogging:n})=>{e&&e.length&&e.forEach((e=>{let o=`Uncaught error in a GraphQL resolver for operation "${t}"`;e.path&&(o=`${o}, at field selection path "${e.path.map((e=>"number"==typeof e?`[${e.toString()}]`:`${e}`)).join(".")}"`),!n&&i.errorToTelemetry&&i.errorToTelemetry(o,"cdl_links_data_client_core",void 0,!0),i.error(`${o} - ${JSON.stringify(e)}`)}))})({graphQLErrors:n,operationName:o.operationName,logger:r,disableTelemetryLogging:i})}}));function lp(e,t,i,n,o){if(!t||0===Object.keys(t).length)return!1;const{query:r}=e,s=(0,Fg.p$)(r);if(!s||s&&"OperationDefinition"!==s.kind)return!1;const{selectionSet:{selections:a}}=s,l=(0,Ed.S)(r,null);if(!l)return!1;const c=l.operation;let d=!1;return a.every((r=>{if("Field"===r.kind){if(n&&!function(e,t){if(!e.directives||0===e.directives.length||!t)return!0;const i=e.directives.find((e=>"skip"===e.name.value));if(i)return!cp(i,t);const n=e.directives.find((e=>"include"===e.name.value));if(n)return cp(n,t);return!0}(r,e.variables))return!0;if(function(e,t,i,n,o,r,s){var a;const l=e[i];if(!l){const e=s.newLogger("isDataLayerClientOperationSupported","data-client-core");return null===(a=e.errorToTelemetry)||void 0===a||a.call(e,`Missing operation type '${i}' for ${o} when looking for '${t}' for operation '${r}'`,"cdl_links_data_client_core",void 0,!0),!1}return l instanceof Set?function(e,t,i,n,o,r){var s;if(e.has(t))return!0;if(i){const e=r.newLogger("isDataLayerClientOperationSupported","data-client-core");null===(s=e.errorToTelemetry)||void 0===s||s.call(e,`Unexpected partially supported operation for '${n}' for operation '${o}' - unsupported selection = ${t}`,"cdl_links_data_client_core",void 0,!0)}return!1}(l,t,n,o,r,s):function(e,t,i,n,o,r){var s,a;if(e[t]){const a=e[t];if(a.active)return!0;if(i){const e=r.newLogger("isDataLayerClientOperationSupported","data-client-core");null===(s=e.errorToTelemetry)||void 0===s||s.call(e,`Unexpected partially supported operation for '${n}' for operation '${o}' - unsupported selection= ${t}, found only in '${a.configurationDescription}'`,"cdl_links_data_client_core",void 0,!0)}}else if(i){const e=r.newLogger("isDataLayerClientOperationSupported","data-client-core");null===(a=e.errorToTelemetry)||void 0===a||a.call(e,`Unexpected partially supported operation for '${n}' for operation '${o}' - unsupported selection = ${t} not found in any source`,"cdl_links_data_client_core",void 0,!0)}return!1}(l,t,n,o,r,s)}(t,r.name.value,c,d,o,e.operationName,i))return d=!0,!0}return!1}))}function cp(e,t){var i;const n=null===(i=e.arguments)||void 0===i?void 0:i.find((e=>"if"===e.name.value));if(!n)return!1;if("Variable"===n.value.kind){const e=n.value.name.value;if(t.hasOwnProperty(e))return!!t[e]}return!1}class dp{static createSingletonLink(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(dp._singletonLink)throw new Error("Links are already created");return dp._singletonLink=lh.i.from(yield dp.createDefaultLinks(e)),dp._singletonLink}))}static createLink(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return lh.i.from(yield dp.createDefaultLinks(e))}))}static get singletonLink(){return dp._singletonLink}static createViewSchemaLink(e){this._viewSchemaImportPromise||(this._viewSchemaImportPromise=Promise.all([i.e(137706),i.e(367463),i.e(87306),i.e(630483),i.e(110344),i.e(933181)]).then(i.bind(i,39073)));const t=!!e.coreSettings.get(b.J.Core).disableGraphQLErrorTelemetry;return lh.i.from([ap(e.loggerFactory,"viewSchema_resolverUncaughtErrorBoundary__doNotAssignToGraphQLTeam",t),this.createLazyViewSchemaTerminatingLink(e,this._viewSchemaImportPromise)])}static createLazyViewSchemaTerminatingLink(e,t){let i;return this._viewSchemaImport&&this._viewSchemaExecutor?this._viewSchemaImport.createViewSchemaTerminatingLink(e,this._viewSchemaExecutor):new lh.i(((n,o)=>new ch.y((r=>{let s,a=!1;return t.then((t=>(this._viewSchemaExecutor||(this._viewSchemaExecutor=new t.ViewSchemaExecutor),this._viewSchemaImport||(this._viewSchemaImport=t),i||(i=t.createViewSchemaTerminatingLink(e,this._viewSchemaExecutor)),i))).then((e=>{var t;a||(s=null===(t=e.request(n,o))||void 0===t?void 0:t.subscribe({next:r.next.bind(r),error:r.error.bind(r),complete:r.complete.bind(r)}))})).catch(r.error.bind(r)),()=>{a=!0,s&&s.unsubscribe()}}))))}static createPatchVariablesLink(e){return Wh({contextValue:e,resolvers:[Lh.s]})}static createTerminatingLink({config:e,contextValue:t,cdlWorkerService:n,dataClientTrackingService:r,loggerFactory:s,scenarioFactory:a,coreSettings:l,leakDetectorService:c,windowProvider:d},u){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const m=dp.createMainRendererTerminatingLink(e.clientId,s,a,d,l,c,r),{enableClassBasedErrors:g,enableSupermassiveWebLink:h,enableDirectiveCheck:p,disableEnhancedLinkDebugging:v}=l.get(b.J.Core),y={contextValue:t,enableClassBasedErrors:!!g},f=h?function(e,t){return np((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield(0,gl.mT)((()=>Promise.all([i.e(87306),i.e(101827),i.e(253506)]).then(i.bind(i,757474))),"supermassive-incremental-link",t)).supermassiveIncrementalSchemaLink(e,t)}))))}(y,a):lh.i.concat(function(e,t){return np((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield(0,gl.mT)((()=>Promise.all([i.e(367463),i.e(111077),i.e(340185),i.e(101827),i.e(4387)]).then(i.bind(i,230881))),"incremental-link",t)).incrementalSchemaLink(e,t)}))))}(y,a),(0,ip.c)()),S=s.newLogger("getAggregatedCDLAngularResolvers","data-client-core"),k=(0,rp.Om)(l,S,!!v);let w=lh.i.split((e=>function(e,t,i,n,o){const{enableCentralDataLayer:r}=i.get(b.J.Host);return!!r&&lp(e,t,n,o,"MainRenderer")}(e,k,l,s,!!p)),(0,op.z)($h(),m),f);if((0,nd.Q6)(l)&&!u){const t=s.newLogger("createCDLWorkerTerminatingLink","data-client-core");w=yield dp.createCDLWorkerTerminatingLink(n,e,s,a,l,t,w)}return w}))}static createMainRendererTerminatingLink(e,t,i,n,o,r,s){const a=o.get(b.J.Cdl),{logCdlOperationsDuringWaitSettings:l}=o.get(b.J.Core),c=this.createDataLayerClientSettings(o);return Rh(new Ad(e,t,i,new Mh((0,F.J)()),r,"Angular",n,{enableRequestHealthMonitor:!!a.enableRequestHealthMonitor,failureCountThreshold:a.requestHealthMonitorFailureCountThreshold,timeoutCountThreshold:a.requestHealthMonitorTimeoutCountThreshold,timeoutLengthSeconds:a.requestHealthMonitorTimeoutLengthSeconds},void 0,void 0,{enableLoggingCdlOperationsDuringWait:null==l?void 0:l.enableLoggingCdlOperationsDuringWait,enableTrackingCdlOperationsDuringWait:null==l?void 0:l.enableTrackingCdlOperationsDuringWait,trackingCdlOperationsDuringWaitThresholdInMs:null==l?void 0:l.trackingCdlOperationsDuringWaitThresholdInMs,trackingCdlOperationsDuringWaitBufferSize:null==l?void 0:l.trackingCdlOperationsDuringWaitBufferSize},s,void 0,c))}static createDataLayerClientSettings(e){const{cdlSubscriptionAggregatorAllowList:t,loggableOperationVariablesAllowList:i,cdlSubscriptionAggregatorLogIntervalMS:n}=e.get(b.J.CdlWorker);return{cdlSubscriptionAggregatorAllowList:t||void 0,loggableOperationVariablesAllowList:i||void 0,cdlSubscriptionAggregatorLogIntervalMS:n||void 0}}static createCDLWorkerTerminatingLink(e,t,i,n,r,s,a){var l,c,d;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!e)return null===(l=s.warnToTelemetry)||void 0===l||l.call(s,"Not creating CDL Worker terminating link. Worker is enabled, but service is unavailable.","cdl_links_data_client_core",void 0,!0),a;const o=yield e.getCDLWorkerManager();if(!o)return null===(c=s.warnToTelemetry)||void 0===c||c.call(s,"Not creating CDL Worker terminating link. Worker is enabled, service is available but workerManager is not defined.","cdl_links_data_client_core",void 0,!0),a;const u=Rh(yield e.getDataLayerClient());o.cdlWorkerSupportedResolvers||null===(d=s.errorToTelemetry)||void 0===d||d.call(s,"CDL link is configured but will not accept any operations. Worker is enabled, service is available, but workerManager.cdlWorkerSupportedResolvers is undefined.","cdl_links_data_client_core",void 0,!0);const{disableEnhancedLinkDebugging:m}=r.get(b.J.Core),g=(0,rp.Ng)(r,s,o.cdlWorkerSupportedResolvers,!!m),{enableDirectiveCheck:h}=r.get(b.J.Core);return a=lh.i.split((e=>function(e,t,i,n){return lp(e,t,i,n,"CDLWorker")}(e,g,i,!!h)),(0,op.z)($h(),u),a),r.get(b.J.CdlWorker).enableControlPlaneLink&&(a=yield dp.createCDLWorkerControlPlaneTerminatingLink(e,t,i,n,a,r)),a}))}static createCDLWorkerControlPlaneTerminatingLink(e,t,i,n,r,s){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield e.getControlPlaneCommunicator(),a=Rh(new Ad(t.clientId,i,n,o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.createDataLayerClientSettings(s))),{enableDirectiveCheck:l}=s.get(b.J.Core);return r=lh.i.split((e=>function(e,t,i){return lp(e,Ph,t,i,"CDLWorkerControl")}(e,i,!!l)),(0,op.z)($h(),a),r),r}))}}dp._singletonLink=null,dp._viewSchemaExecutor=null,dp.createDefaultLinks=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{contextValue:t,loggerFactory:i,scenarioFactory:n,coreSettings:o,noCDLTerminatingLink:r}=e,s=yield dp.createTerminatingLink(e,r),a=dp.createPatchVariablesLink(t),l=o.get(b.J.Core).enableGraphQlOpsCount,c=o.get(b.J.Core).enableTrackRequestsLink,d=l||c?[Qh(i,n,l,c,t.graphqlOpsCountService)]:[],u=o.get(b.J.Calling).enableSubscriptionCancellationListener?[Zh(i,o)]:[],m=tp("presenceUpdateEvent",o,!0),g=tp("callParticipantUpdatedEvent",o),h=tp("callParticipantsChangedEvent",o),p=tp("callParticipantsVoiceLevelsChangedEvent",o),v=tp("chatServiceEvent",o),y=tp("blockedContactChangedEvent",o,!0),f=!!o.get(b.J.Core).disableGraphQLErrorTelemetry;return[...d,...u,a,ap(i,"resolverUncaughtErrorBoundary__doNotAssignToGraphQLTeam",f),m,g,h,p,v,y,s]}));var up=i(666510);const mp=()=>(0,up.ZB)(["filter","typeFilter"]),gp=()=>(0,up.ZB)(["filter","typeFilter"]);function hp(e,t){return t("timestamp",e||{})||""}const pp=()=>{const e=(0,up.ZB)(!1),{read:t,merge:i}=e,n=(0,o.__rest)(e,["read","merge"]);return Object.assign(Object.assign({},n),{merge:(e,t,n)=>{var o,r,s;if("function"==typeof i){const a=i(e,t,n),{readField:l,mergeObjects:c}=n;let d=(0,L.uniqBy)(a.edges,(e=>l("id",e.node)));const u=[];d=d.filter((e=>{var t;const i=l("deleteTime",e.node);return i&&u.push(null!==(t=l("id",e.node))&&void 0!==t?t:""),!i}));const m=l("deletedActivityInfo",a),g=c(null!=m?m:{},{id:l("id",m),deletedActivityIds:(0,L.uniq)([...null!==(o=l("deletedActivityIds",m))&&void 0!==o?o:[],...u])});return Object.assign(Object.assign({},a),{edges:d,deletedActivityInfo:g,pageInfo:Object.assign(Object.assign({},null==a?void 0:a.pageInfo),{startCursor:l("timestamp",null===(r=(0,L.head)(d))||void 0===r?void 0:r.node),endCursor:l("timestamp",null===(s=(0,L.last)(d))||void 0===s?void 0:s.node)})})}return i},read:(...e)=>{const i=e[0],{readField:n}=e[1];if(!i||!t)return;if(!i.edges)return i;const o=[...i.edges].sort(((e,t)=>function(e,t,i){const n=null==e?void 0:e.node,o=null==t?void 0:t.node,r=hp(n,i),s=hp(o,i);return r?s?parseInt(s,10)-parseInt(r,10):-1:1}(e,t,n)));return Object.assign(Object.assign({},t(...e)),{edges:o})}})};const vp=()=>{const e=(0,up.ZB)(!1),{merge:t}=e,i=(0,o.__rest)(e,["merge"]);return Object.assign(Object.assign({},i),{merge:(e,i,n)=>{if(yp(t)){if(!e)return i;const{readField:o}=n,r=t(e,i,n),s="objectId",a=(0,L.uniqBy)(r.edges,(e=>o(s,e.node)));return Object.assign(Object.assign({},r),{edges:a,pageInfo:Object.assign({},r.pageInfo)})}return t}})},yp=e=>"function"==typeof e,fp=e=>{const t=mh.Query||{fields:{}};return Object.assign(Object.assign(Object.assign({},mh),e),{Query:Object.assign(Object.assign({},t),{fields:Object.assign(Object.assign({},t.fields),{chats:mp(),recentsChats:mp(),pinnedChats:mp(),activities:pp(),suggestedContactsInChatList:gp(),frequentlyUsedContacts:gp(),replyChainMessages:Object.assign(Object.assign({},(0,up.ZB)(["channelId","replychainId"])),{read:e=>e,merge:(e,t)=>t}),replyChainSummaries:Object.assign(Object.assign({},(0,up.ZB)(["channelId"])),{read:e=>e,merge:(e,t)=>t}),fluidMessages:{merge:(e,t)=>[...t]},feed:{merge:!0},calendarEventsV3WithPagination:vp(),pinnedChannels:{merge:!1}})})})},Sp=e=>"cache-and-network"===e||"network-only"===e?"cache-first":e;var kp=i(279746);const bp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"quotedReply"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"quotedReply"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"from"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"messageId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"preview"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"timestamp"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"QuotedReply"}}}]}}]},wp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatForwardCardQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"forwardCard"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardCardMessageFragment"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ForwardMessage"}}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardCardMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ForwardMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardCardMessageCardFragment"}}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ClientCard"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"content"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"version"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"from"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardMessageFileFragment"}}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"File"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"messageType"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isImportant"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"importance"},__type:{kind:"NamedType",name:{kind:"Name",value:"MessageImportance"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"imDisplayName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"clientMessageId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"translatedSubject"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"translatedContent"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardCardMessageCardFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ClientCard"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"cardClientId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"content"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"contentType"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"locale"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"userSpecificContent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"timeStamp"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"version"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"authBlockLastUsedOn"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ClientUserSpecificCardContent"}},arguments:[]}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardMessageFileFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"File"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"itemId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"chicletBreadcrumbs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sourceTeamName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"sourceChannelName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ChicletBreadcrumbs"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"baseUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"objectUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"shareId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"shareUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"title"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"previewUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"previewHeight"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"previewWidth"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"progressComplete"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasUploadFailed"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"serviceName"},__type:{kind:"NamedType",name:{kind:"Name",value:"FileViewServiceName"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"state"},__type:{kind:"NamedType",name:{kind:"Name",value:"FileChicletState"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"providerDataV2"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExternalCloudStorageProviderCode"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FilesProviderType"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ProviderDataV2"}},arguments:[]}]}}]}.definitions]}.definitions]};var Cp=i(711676),_p=i(708975);var Tp=i(718306);var Ip=i(719840),jp=i(914842),Np=i(995873),Ep=i(855767);const xp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chat"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"title"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isDisabled"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"chatSubType"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"chatType"},__type:{kind:"NamedType",name:{kind:"Name",value:"ChatType"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isSfB"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isMeeting"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isMuted"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isFederated"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isRetentionHorizonSet"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isModerator"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasBotMember"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"chatDisabledContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUIDisabled"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"disabledReason"},__type:{kind:"NamedType",name:{kind:"Name",value:"ChatDisabledContextReason"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"extendedData"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTime"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ChatDisabledContext"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonFields"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ConsumptionHorizon"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"consumptionHorizonBookmark"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ConsumptionHorizonBookmark"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"userConsumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ConsumptionHorizonBookmark"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"memberIds"},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"botMembers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userFields"}}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"User"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"creator"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"meetingInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"meetingInformationFields"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"MeetingInformation"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tenantId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}}}]}},...Ip.T.definitions,...jp.v.definitions,...Np.f.definitions,...Ep.qL.definitions]},Ap=e=>({__typename:"ChatDisabledContext",isUIDisabled:e.isUIDisabled,disabledReason:e.disabledReason,extendedData:e.extendedData,lastUpdatedTime:e.lastUpdatedTime}),Dp=()=>({__typename:"ChatDisabledContext",isUIDisabled:!1,disabledReason:"UnknownReason",extendedData:null,lastUpdatedTime:null}),Fp=()=>({__typename:"ChatDisabledContext",isUIDisabled:!1,disabledReason:"ChatDisabledDueToBotStatus",extendedData:null,lastUpdatedTime:null}),Op={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidMessages"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidMessages"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"messageId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FluidMessage"}}}},arguments:[]}]}}]},Mp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidManifestEntries"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locale"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidManifestEntries"},arguments:[{kind:"Argument",name:{kind:"Name",value:"locale"},value:{kind:"Variable",name:{kind:"Name",value:"locale"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locale"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"entries"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"timestamp"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"FluidManifestEntries"}}}]}}]},Rp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidPendingMentions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"componentHash"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidPendingMentions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"componentHash"},value:{kind:"Variable",name:{kind:"Name",value:"componentHash"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"atMentionId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"contentId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"navigationPath"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FluidPendingMention"}}}}}}]}}]};const Pp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"composeState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"composeState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isExpanded"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ComposeMessageState"}}}]}}]},Lp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"imageAltText"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"imageAltText"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}}]};var Up=i(63960),Wp=i(790888);const Bp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messagePaneScrolledToStartState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messagePaneScrolledToStartState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isScrolledToStart"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"MessagePaneScrolledToStartState"}}}]}}]},$p={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"messageFieldsForTranslation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"},__type:{kind:"NamedType",name:{kind:"Name",value:"TranslationStatus"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"content"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"fromLanguage"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Translation"}},arguments:[]}]}}]},Hp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"twoWaySmsFriendlyName"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"twoWaySmsFriendlyName"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}}]};var qp=i(434217);const zp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatInsertTvcComposeQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"insertTVCComposeQuery"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cacheId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"InsertedTVC"}}}}]}}]},Vp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatInsertTriggerStreamCameraQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"insertTriggerStreamCamera"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}}]},Gp={Query:{fluidManifestEntries:(e,{locale:t},{cache:i,loggerFactory:n})=>((e,t,i)=>{try{const i=e.readQuery({query:Mp,variables:{locale:t}});return null==i?void 0:i.fluidManifestEntries}catch(e){return void i.newLogger("fluid-manifest-entries","data-client-chat").error("Failed to retrieve the cached fluid manifest json")}})(i,t,n)||null,requestImmersiveReader:(e,{conversationId:t,messageId:i,setFocusOnClose:n},o)=>function(e,t,i){return(0,F.J)().opener.open(Ft.B.OpenOnMainRenderer,Ft._.ImmersiveReader,{conversationId:e,messageId:t,setFocusOnClose:i}),!0}(t,i,n)},Conversation:Object.assign({isFederated(e){var t;return null!==(t=e.isFederated)&&void 0!==t?t:(0,Cp.eX)(e.id)},isMeeting(e){var t;return null!==(t=e.isMeeting)&&void 0!==t?t:(0,Cp.e9)(e.id)},isSfB(e){var t;return null!==(t=e.isSfB)&&void 0!==t?t:(0,_p.Jn)(e.id)},chatDisabledContext:e=>(e=>{if(!e)return null;if(!e.chatDisabledContext){const t=e;return t&&t.isDisabled&&t.isOneOnOne&&t.hasBotMember?Fp():Dp()}return e.chatDisabledContext})(e)},{isHighImportance:()=>null,isUrgentImportance:()=>null,activeCallsCount:()=>null,datatid:()=>null,displayName:()=>null,hasActiveCalls:()=>null,hasFailedMessages:()=>null,otherMemberMris:()=>null,isNewChat:()=>null,isBotBlocked:()=>null,isBotUser:()=>null,isHidden:()=>null,isContactTagged:()=>null,pictureUpn:()=>null,pinnedIndex:()=>null,showAtMention:()=>null,showMarkers:()=>null,tooltipTitle:()=>null,longTitle:()=>null,pictureGroup:()=>null,lastMessageTime:()=>null,messagePreview:()=>null,messagePreviewAria:()=>null,isLastMessageText:()=>null,plGroupKey:()=>null,presenceSource:()=>null,hasActions:()=>null,canBeDiscarded:()=>null,canBotBeBlocked:()=>null,canBePinned:()=>null,canBeMuted:()=>null,canBeLeft:()=>null,canBeHidden:()=>null,canBeFavorited:()=>null,canTagContact:()=>null,canPopOut:()=>null,canManageApps:()=>null}),Mutation:{untranslateMessage:(e,{messageId:t},{cache:i,loggerFactory:n})=>function(e,t,i){if(!t)return null;const n=Tp.Ps`
    fragment originalMessageFields on Message {
      id
      content
    }
  `;try{const i=e.readFragment({id:`Message:${t}`,fragment:n});return i?i.content:null}catch(e){return i.error(`Failed to get message from cache: ${e}`),null}}(i,t,n.newLogger("untranslateMessage","data-client-chat")),updateChatDisabledContext:(e,{convId:t,isUIDisabled:i,disabledReason:n,extendedData:o},{cache:r})=>((e,t,i,n,o)=>{const r={convId:t},s={__typename:"ChatDisabledContextResponse",message:"",success:!1,chatDisabledContext:Dp()};try{const t=e.readQuery({query:xp,variables:r});if(!t||!t.chat)return s.message="Could not update chatDisabledContext for a null chat conversation",s;const a=Date.now().toString();t.chat.chatDisabledContext&&(s.chatDisabledContext=Object.assign({},t.chat.chatDisabledContext));const l={__typename:"ChatDisabledContext",isUIDisabled:i,disabledReason:n,extendedData:o,lastUpdatedTime:a},c={chat:Object.assign(Object.assign({},t.chat),{chatDisabledContext:l})};e.writeQuery({query:xp,variables:r,data:c}),s.success=!0,c&&c.chat&&c.chat.chatDisabledContext&&(s.chatDisabledContext=Ap(c.chat.chatDisabledContext))}catch(e){s.message=`Exception: Failed to update chatDisabledContext for conversation ${t}. Exception Details: ${e.message}`}return s})(r,t,i,n,o),resetQuotedReply:(e,{convId:t},{cache:i})=>((e,t)=>(t.writeQuery({query:bp,variables:{convId:e},data:{quotedReply:null}}),!0))(t,i),setQuotedReply:(e,{convId:t,quotedReply:i},{cache:n})=>((e,{displayName:t,from:i,messageId:n,preview:o,timestamp:r},s)=>{const a={quotedReply:{__typename:"QuotedReply",displayName:t,from:i,messageId:n,preview:o,timestamp:r}};return s.writeQuery({query:bp,variables:{convId:e},data:a}),!0})(t,i,n),setInsertTVCCompose(e,{convId:t,cacheId:i},{cache:n}){try{return n.writeQuery({query:zp,variables:{convId:t},data:{insertTVCComposeQuery:{__typename:"InsertedTVC",cacheId:i}}}),!0}catch(e){return!1}},setTriggerStreamCamera(e,{convId:t},{cache:i}){try{return i.writeQuery({query:Vp,variables:{convId:t},data:{insertTriggerStreamCamera:!0}}),!0}catch(e){return!1}},resetTriggerStreamCamera(e,{convId:t},{cache:i}){try{return i.writeQuery({query:Vp,variables:{convId:t},data:{insertTriggerStreamCamera:!1}}),!0}catch(e){return!1}},deleteForwardCard:(e,{convId:t},{cache:i,loggerFactory:n})=>((e,t,i)=>{const n={forwardCard:null};try{t.writeQuery({query:wp,variables:{convId:e},data:n})}catch(e){return i.error("Failed to delete forward card from cache"),!1}return!0})(t,i,n.newLogger("deleteForwardCard","data-client-chat")),saveForwardCard:(e,{convId:t,message:i},{cache:n,loggerFactory:o})=>((e,t,i,n)=>{const o={forwardCard:Object.assign(Object.assign({},t),{__typename:"ForwardMessage"})};try{i.writeQuery({query:wp,variables:{convId:e},data:o})}catch(e){return n.error("Failed to save forward card to cache"),!1}return!0})(t,i,n,o.newLogger("saveForwardCard","data-client-chat")),updateComposeState(e,{id:t,isExpanded:i},{cache:n,loggerFactory:r}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e={__typename:"ComposeMessageState",id:t,isExpanded:i};try{n.writeQuery({query:Pp,variables:{id:t},data:{composeState:Object.assign(Object.assign({},e),{__typename:"ComposeMessageState"})}})}catch(e){r.newLogger("update-compose-state","data-client-chat").error(`Failed to write to client cache the compose state query. Error: ${e.message}`)}return e}))},setImageAltText(e,{altText:t},{cache:i,loggerFactory:n}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e={imageAltText:t};try{i.writeQuery({query:Lp,data:e})}catch(e){n.newLogger("update-image-alt-text","data-client-chat").error(`Failed to write to client cache the image alt text query. Error: ${e.message}`)}return!0}))},insertHyperlink(e,{displayText:t,address:i},{cache:n,loggerFactory:r}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e={__typename:"FluidInsertedHyperlink",displayText:t,address:i};try{n.writeQuery({query:Up.D,data:{insertedHyperlink:Object.assign(Object.assign({},e),{__typename:"FluidInsertedHyperlink"})}})}catch(e){r.newLogger("insert-hyperlink-dialog-data","data-client-chat").error(`Failed to write to client cache the insert hyperlink dialog data query. Error: ${e.message}`)}return!0}))},setTwoWaySmsFriendlyName(e,{twoWaySmsFriendlyName:t},{cache:i,loggerFactory:n}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e={twoWaySmsFriendlyName:t};try{i.writeQuery({query:Hp,data:e})}catch(e){n.newLogger("update-tfl-two-way-sms-friendly-name","data-client-chat").error(`Failed to write to client cache the tfl two way sms friendly name query. Error: ${e.message}`)}return!0}))},updateMessagePaneScrolledToStartState(e,{id:t,isScrolledToStart:i},{cache:n,loggerFactory:r}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e={__typename:"MessagePaneScrolledToStartState",id:t,isScrolledToStart:i};try{n.writeQuery({query:Bp,variables:{id:t},data:{messagePaneScrolledToStartState:Object.assign(Object.assign({},e),{__typename:"MessagePaneScrolledToStartState"})}})}catch(e){r.newLogger("update-chat-bottom-state","data-client-chat").error(`Failed to write to client cache the chat bottom state query. Error: ${e.message}`)}return e}))},setDlpDialogData(e,{isReport:t,isOverride:i,justification:n},{cache:r,loggerFactory:s}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e={__typename:"DlpDialogData",isReport:t,isOverride:i,justification:n};try{r.writeQuery({query:Wp.C,data:{dlpDialogData:Object.assign(Object.assign({},e),{__typename:"DlpDialogData"})}})}catch(e){s.newLogger("set-dlp-dialog-data","data-client-chat").error(`Failed to write to client cache the set dlp dialog data query. Error: ${e.message}`)}return e}))},setFluidMessage:(e,{fluidMessage:t,remove:i},{cache:n,loggerFactory:o})=>(({messageId:e,originalArrivalTime:t},i,n,o)=>{try{const o=n.readQuery({query:Op}),r=i?function(e,t){var i;return{fluidMessages:(null===(i=null==e?void 0:e.fluidMessages)||void 0===i?void 0:i.filter((e=>e.messageId!==t)))||[]}}(o,e):function(e,t,i){const n=[],o={__typename:"FluidMessage",id:t,messageId:t,originalArrivalTime:i};let r=!1;if(null==e?void 0:e.fluidMessages)for(const t of e.fluidMessages)t.originalArrivalTime<o.originalArrivalTime&&!r&&(n.push(o),r=!0),n.push(t);return r||n.push(o),{fluidMessages:n}}(o,e,t);return n.writeQuery({query:Op,data:r}),!0}catch(e){return o.newLogger("set-fluid-messages-pending-load","data-client-chat").error(`Failed to write to client cache the set fluid message pending load query. Error: ${e.message}`),!1}})(t,!!i,n,o),setFluidManifestEntries:(e,{locale:t,entries:i},{cache:n,loggerFactory:o})=>((e,t,i,n)=>{try{const n={fluidManifestEntries:{__typename:"FluidManifestEntries",locale:e,entries:t,timestamp:Date.now()}};return i.writeQuery({query:Mp,variables:{locale:e},data:n}),!0}catch(e){return n.newLogger("fluid-manifest-entries","data-client-chat").error(`Failed to write to client cache that set fluid manifest json query. Error: ${e.message}`),!1}})(t,i,n,o),updateFluidPendingMentions:(e,{componentHash:t,pendingMention:i,remove:n},{cache:o,loggerFactory:r})=>((e,t,i,n,o)=>{try{const o=Object.assign({__typename:"FluidPendingMention"},t),r={componentHash:e},s=n.readQuery({query:Rp,variables:r}),a=((null==s?void 0:s.fluidPendingMentions)||[]).filter((e=>o.userPrincipalName!==e.userPrincipalName)),l=i?a:[...a,o];return n.writeQuery({query:Rp,variables:r,data:{fluidPendingMentions:l}}),!0}catch(e){return o.newLogger("fluid-resolvers-update-pending-fluid-mentions","data-client-chat").error(`Failed to write pending mentions to the cache, error="${e.message}"`),!1}})(t,i,!!n,o,r),clearFluidPendingMentions:(e,{componentHash:t},{cache:i,loggerFactory:n})=>((e,t,i)=>{try{const i={componentHash:e};return t.writeQuery({query:Rp,variables:i,data:{fluidPendingMentions:[]}}),!0}catch(e){return i.newLogger("fluid-resolvers-clear-fluid-pending-mentions","data-client-chat").error(`Failed to clear pending mentions from the cache, error="${e.message}"`),!1}})(t,i,n),resetSmartReplyFileSuggestion:(e,{convId:t},{cache:i,loggerFactory:n})=>((e,t,i)=>{const n={smartReplyFileSuggestion:null};try{return t.writeQuery({query:qp.v,variables:{convId:e},data:n}),!0}catch(e){return i.newLogger("ResetSmartReplyFileSuggestion","data-client-chat").error(`Failed to reset smart reply file suggestion in cache: ${e}`),!1}})(t,i,n),setSmartReplyFileSuggestion:(e,{convId:t,fileSuggestion:i},{cache:n,loggerFactory:o})=>((e,{fileName:t,url:i},n,o)=>{try{const o={smartReplyFileSuggestion:{__typename:"SmartReplyFileSuggestion",fileName:t,url:i}};return n.writeQuery({query:qp.v,variables:{convId:e},data:o}),!0}catch(e){return o.newLogger("SetSmartReplyFileSuggestion","data-client-chat").error(`Failed to set smart reply file suggestion in cache: ${e}`),!1}})(t,i,n,o)},Message:{deletionInfo:(e,t,{cache:i})=>(0,kp.sE)(i,e),translation:(e,t,{cache:i})=>{var n;try{const t=`Message:${e.id}`,o=null===(n=i.readFragment({id:t,fragment:$p}))||void 0===n?void 0:n.translation;return o?Object.assign(Object.assign({},o),{__typename:"Translation"}):null}catch(e){return null}},diagnosticInfo:()=>({__typename:"DiagnosticInfo",diagnosticErrorCode:-1,diagnosticMessage:null})}},Jp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormBlockingTasksQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormBlockingTasks"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SchedulingFormTaskType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"state"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SchedulingFormTaskState"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SchedulingFormTask"}}}}},arguments:[]}]}}]},Kp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormTerminatingActionQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormTerminatingAction"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"SchedulingFormTerminatingActionType"}},arguments:[]}]}}]},Qp={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormActiveTabQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormActiveTab"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SchedulingFormTab"}},arguments:[]}]}}]},Yp={Query:{schedulingFormActiveTab(e,t,{cache:i,loggerFactory:n}){var o,r;try{const e=i.readQuery({query:Qp});return null!==(o=null==e?void 0:e.schedulingFormActiveTab)&&void 0!==o?o:null}catch(e){const t=n.newLogger("scheduling-form-active-tab","data-client-calendar");return null===(r=t.errorToTelemetry)||void 0===r||r.call(t,"schedulingFormActiveTab: Failed to fetch scheduling form active tab from cache.","calendar_form_active_tab"),null}},schedulingFormBlockingTasks(e,t,{cache:i,loggerFactory:n}){var o,r;try{const e=i.readQuery({query:Jp});return null!==(o=null==e?void 0:e.schedulingFormBlockingTasks)&&void 0!==o?o:[]}catch(e){const t=n.newLogger("scheduling-form-blocking-task","data-client-calendar");return null===(r=t.errorToTelemetry)||void 0===r||r.call(t,"schedulingFormBlockingTasks: Failed to fetch scheduling form blocking task from cache.","calendar_form_blocking_tasks"),[]}},schedulingFormTerminatingAction(e,t,{cache:i,loggerFactory:n}){var o,r,s;try{return null!==(r=null===(o=i.readQuery({query:Kp}))||void 0===o?void 0:o.schedulingFormTerminatingAction)&&void 0!==r?r:null}catch(e){const t=n.newLogger("scheduling-form-terminating-action","data-client-calendar");return null===(s=t.errorToTelemetry)||void 0===s||s.call(t,"schedulingFormTerminatingAction: Failed to fetch scheduling form terminating action from cache.","calendar_form_terminating_action"),null}}},Mutation:{addSchedulingFormBlockingTask(e,{input:{task:t}},{cache:i,loggerFactory:n}){var o,r,s,a;const l=n.newLogger("add-scheduling-form-blocking-task","data-client-calendar"),c=(0,xe.v4)();try{const e=null!==(r=null===(o=i.readQuery({query:Jp}))||void 0===o?void 0:o.schedulingFormBlockingTasks)&&void 0!==r?r:[],n=e.find((e=>e.type===t.type));if(n&&"Active"===n.state)return null===(s=l.errorToTelemetry)||void 0===s||s.call(l,"addSchedulingFormBlockingTask: Failed to write scheduling form blocking task in cache. Existing active task of same type already exists.","calendar_form_blocking_tasks"),null;const a=(n?e.filter((e=>e.type!==t.type)):e).concat([Object.assign(Object.assign({__typename:"SchedulingFormTask"},t),{id:c})]);i.writeQuery({query:Jp,data:{schedulingFormBlockingTasks:a}})}catch(e){return null===(a=l.errorToTelemetry)||void 0===a||a.call(l,"addSchedulingFormBlockingTask: Failed to write scheduling form blocking task in cache.","calendar_form_blocking_tasks"),null}return Object.assign(Object.assign({},t),{id:c,__typename:"SchedulingFormTask"})},updateSchedulingFormBlockingTask(e,{input:{type:t,state:i}},{cache:n,loggerFactory:o}){var r,s,a,l;const c=o.newLogger("update-scheduling-form-blocking-task","data-client-calendar");try{let e=-1;const o=(null!==(s=null===(r=n.readQuery({query:Jp}))||void 0===r?void 0:r.schedulingFormBlockingTasks)&&void 0!==s?s:[]).map(((n,o)=>(null==n?void 0:n.type)===t?(e=o,Object.assign(Object.assign({},n),{state:i})):n));return-1===e?(null===(a=c.errorToTelemetry)||void 0===a||a.call(c,"updateSchedulingFormBlockingTask: Failed to update scheduling form blocking task in cache. Task does not exist.","calendar_form_blocking_tasks"),null):o[e]}catch(e){return null===(l=c.errorToTelemetry)||void 0===l||l.call(c,"updateSchedulingFormBlockingTask: Failed to update scheduling form blocking task in cache.","calendar_form_blocking_tasks"),null}},removeSchedulingFormBlockingTask(e,{input:{type:t}},{cache:i,loggerFactory:n}){var o,r,s;const a=n.newLogger("remove-scheduling-form-blocking-task","data-client-calendar");try{const e=null!==(r=null===(o=i.readQuery({query:Jp}))||void 0===o?void 0:o.schedulingFormBlockingTasks)&&void 0!==r?r:[],n=e.find((e=>e.type===t));if(!n)return null;const s=e.filter((e=>(null==e?void 0:e.type)!==t));return i.writeQuery({query:Jp,data:{schedulingFormBlockingTasks:s}}),n}catch(e){return null===(s=a.errorToTelemetry)||void 0===s||s.call(a,"removeSchedulingFormBlockingTask: Failed to remove scheduling form blocking task from cache.","calendar_form_blocking_tasks"),null}},setSchedulingFormActiveTab(e,{input:t},{cache:i,loggerFactory:n}){var o;const r=null===t?null:Object.assign(Object.assign({},t),{__typename:"SchedulingFormTab"});try{return i.writeQuery({query:Qp,data:{schedulingFormActiveTab:r}}),r}catch(e){const t=n.newLogger("scheduling-form-active-tab","data-client-calendar");return null===(o=t.errorToTelemetry)||void 0===o||o.call(t,"setSchedulingFormActiveTab: Failed to set scheduling form active tab in cache.","calendar_form_active_tab"),null}},setSchedulingFormTerminatingAction(e,{input:{type:t}},{cache:i,loggerFactory:n}){var o;const r=n.newLogger("set-scheduling-form-terminating-action","data-client-calendar");try{i.writeQuery({query:Kp,data:{schedulingFormTerminatingAction:t}})}catch(e){return null===(o=r.errorToTelemetry)||void 0===o||o.call(r,"setSchedulingFormTerminatingAction: Failed to update scheduling form terminating task in cache.","calendar_form_terminating_action"),!1}return!0}}};var Xp=i(259287),Zp=i(516909);var ev=i(454029);const tv={Mutation:{addFileUpload(e,{fileToAdd:t},{cache:i}){const{fileContainerId:n}=t,o=(({uploadId:e,fileName:t,serviceName:i,context:n})=>({title:t,status:"PROGRESS",id:e,itemId:null,type:(0,Xp.mD)(t),objectUrl:"",baseUrl:"",progress:1,fileId:"",isReferencedFile:!1,shareUrl:"",shareId:"",previewUrl:"",chicletBreadcrumbs:null,context:null!=n?n:null,permissionScope:null,previewHeight:null,previewWidth:null,progressComplete:null,state:Zp.cj.active,hasUploadFailed:!1,serviceName:i,externalFileShareInfo:"",sharepointIds:null,publication:null,site:null,__typename:"FileUpload"}))(t);return(0,ev.zz)([o],i,n),!0},removeFileUpload(e,{input:t},{cache:i}){const{uploadId:n,fileContainerId:o}=t;return(0,ev.Fj)(n,o,i),!0}}};var iv=i(47101);const nv=e=>{if(e){const{appIcon:t,appId:i,appName:n,contentType:o,content:r,locale:s}=e;return{__typename:"PlatformCard",appIcon:t||null,appId:i||null,appName:n||null,content:r,contentType:o,locale:s||null}}return null};var ov=i(381e3);var rv=i(2300);var sv=i(324029);var av=i(933246);const lv={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"platformAppsFetchPolicyFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PlatformAppsFetchPolicy"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"forceNetworkFetch"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"scope"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"convId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}}]},cv="PlatformAppsFetchPolicy",dv="PlatformAppsFetchPolicyMetadata",uv=Tp.Ps`
  fragment PlatformAppsFetchPolicyMetadata_FetchPolicyIds on PlatformAppsFetchPolicyMetadata {
    fetchPolicyIds
  }
`,mv=Tp.Ps`
  fragment PlatformAppsFetchPolicy_ForceNetwork on PlatformAppsFetchPolicy {
    forceNetworkFetch
  }
`,gv=(e,t)=>{let i=`${cv}:${e}`;return t&&(i=`${i}:${t}`),i},hv=(e,t,i,n)=>{let o=!0;try{const o=gv(t.scope,t.convId);e.writeFragment({id:o,fragment:lv,data:t});const{enableContextlessFetchPolicyUpdates:r}=i.get(b.J.Extensibility);r&&yv(e,o,n)}catch(e){o=!1}return o},pv=(e,t,i)=>{let n=`${e}`;return t&&(n=`${n}:${t}`),{__typename:cv,id:n,scope:e,forceNetworkFetch:i,convId:null!=t?t:null}},vv=e=>{var t;try{const i=e.readFragment({id:dv,fragment:uv});return null!==(t=null==i?void 0:i.fetchPolicyIds)&&void 0!==t?t:[]}catch(e){throw e}},yv=(e,t,i)=>{var n;const o=i.newLogger("updateFetchPolicyIds","data-client-platform");try{let i=vv(e);if(i.includes(t))return;i=i.concat(t),e.writeFragment({id:dv,fragment:uv,data:{__typename:dv,fetchPolicyIds:i}})}catch(e){null===(n=o.errorToTelemetry)||void 0===n||n.call(o,`updateFetchPolicyIds: failed to update fetch policy ids when adding ${t}`,"platform_apps_fetch_policy_update_ids_resolver")}};var fv=i(516102);var Sv=i(166031);var kv=i(868521);const bv={__typename:"MessageExtensionsAppsState",toggleRefetch:!1},wv=(e,t)=>{try{const i=e.readQuery({query:kv.F,variables:{convId:t}});if(!i)throw new Error("Unable to read ME apps state from cache");return i}catch(e){throw e}};var Cv=i(511523);var _v=i(612034);var Tv=i(24756);var Iv=i(56818);var jv=i(858453),Nv=i(210439);var Ev=i(534380);var xv=i(185e3);var Av=i(607036);var Dv=i(776806);var Fv=i(836666);const Ov="AppCaching resolver: ",Mv={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformCachedAppListQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cachedAppList"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"lastUpdatedSourceWindow"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"apps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"globalAppId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isCachedAndHidden"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"lastLoaded"},__type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CachedApp"}}}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CachedAppList"}}},arguments:[]}]}}]},Rv=(e,t,i,n,o)=>{if(!e)return!1;const{lastUpdatedSourceWindow:r}=e;try{const s=t.readQuery({query:Mv}),a=i({input:e,cacheData:s,coreSettings:o,logger:n});if((0,L.isEqual)(a,null==s?void 0:s.cachedAppList.apps))null==n||n.warn("cache write skipped, data unchanged");else{null==n||n.log("cached app list updated, writing query");const e={cachedAppList:{__typename:"CachedAppList",id:"appcaching",apps:a,lastUpdatedSourceWindow:r}};t.writeQuery({query:Mv,data:e})}return!0}catch(e){return!1}},Pv=e=>{const t={};return e.forEach((e=>t[e.globalAppId]=e)),t},Lv=e=>e.length&&e[0].appId?{"App.Id":e[0].appId}:void 0,Uv=e=>{var t;const{cacheData:i,input:n,logger:o}=e;return(({apps:e},t,i)=>{var n;const o=Pv(t),r=e.filter((e=>!o[e.globalAppId]));r.length!==e.length&&(null===(n=null==i?void 0:i.warnToTelemetry)||void 0===n||n.call(i,"duplicate apps found in mutation input","platform_app_caching_duplciate_apps_in_mutation_input",Lv(e),!0));const s=t.concat(r.map((e=>{var t,i,n;return Object.assign(Object.assign({},e),{__typename:"CachedApp",lastLoaded:null!==(t=e.lastLoaded)&&void 0!==t?t:null,appId:null!==(i=e.appId)&&void 0!==i?i:null,appName:null!==(n=e.appName)&&void 0!==n?n:null})})));return s})(n,null!==(t=null==i?void 0:i.cachedAppList.apps)&&void 0!==t?t:[],o)},Wv=e=>{var t;const{cacheData:i,input:{apps:n},logger:o}=e,r=Pv(n);let s=[];return(null==i?void 0:i.cachedAppList.apps)&&(s=null==i?void 0:i.cachedAppList.apps.filter((e=>!r[e.globalAppId])),s.length===(null==i?void 0:i.cachedAppList.apps.length)&&(null===(t=null==o?void 0:o.errorToTelemetry)||void 0===t||t.call(o,"app to remove is not in the cached app list","platform_app_caching_missing_cached_app_on_update",Lv(n),!0))),s},Bv=(e,t,i)=>{let n,o=-1;for(const i of e)(!n||i.lastLoaded&&i.lastLoaded<n)&&(o=t.indexOf(i),n=i.lastLoaded);const r=[...t];return-1!==o&&(r.splice(o,1),null==i||i.log("app removed from global cache due to exceeding shared cache size")),r},$v=e=>{const{cacheData:t,input:{apps:i},coreSettings:n,logger:o}=e,r=null==n?void 0:n.get(b.J.Extensibility),s=null==r?void 0:r.appCachingMaxSizeNS;let a=[];if(null==t?void 0:t.cachedAppList.apps){const e=Pv(null==t?void 0:t.cachedAppList.apps);a=i.map((t=>{var i,n,r;let s;const a=e[t.globalAppId];a?s=a:(s=t,null==o||o.log("adding app to cache that was not found during update."));const l=null!==(i=t.lastLoaded)&&void 0!==i?i:null,c=t.isCachedAndHidden,d=null!==(n=s.appId)&&void 0!==n?n:null,u=null!==(r=s.appName)&&void 0!==r?r:null;return Object.assign(Object.assign({},s),{__typename:"CachedApp",lastLoaded:l,appId:d,isCachedAndHidden:c,appName:u})}));const n=Pv(a);a=a.concat(t.cachedAppList.apps.filter((e=>!n[e.globalAppId])))}return s?((e,t,i)=>{const n=e.filter((e=>e.isCachedAndHidden));return!n.length||n.length<=t?e:Bv(n,e,i)})(a,s,o):a};var Hv=i(691584);var qv=i(315280);var zv=i(743107);const Vv={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformMetaosApplicationSearchHandlerStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"metaosApplicationSearchHandlerState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"registered"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"MetaosApplicationSearchHandlerState"}},arguments:[]}]}}]},Gv={Query:{platformAppsBatchFetchPolicy:(e,{options:t},{cache:i})=>{const n=t.map((({scope:e,convId:t})=>((e,{scope:t,convId:i})=>{let n;try{const o=gv(t,i),r=e.readFragment({id:o,fragment:lv});n=null==r?void 0:r.forceNetworkFetch}catch(e){n=!1}return pv(t,i,null!=n&&n)})(i,{scope:e,convId:t})));return n},messageExtensionsAppsState:()=>bv},Mutation:{toggleAppsRefetch:(e,{convId:t},{cache:i})=>{try{const e=wv(i,t),{messageExtensionsAppsState:n}=e,o=!n.toggleRefetch,r={messageExtensionsAppsState:Object.assign(Object.assign({},n),{toggleRefetch:o})};i.writeQuery({query:kv.F,variables:{convId:t},data:r});return wv(i,t).messageExtensionsAppsState.toggleRefetch}catch(e){throw e}},updateTaskModuleResult:(e,{text:t,taskModuleId:i,draftId:n,card:o,conversationId:r,adaptiveCardTabResult:s,reason:a,entryPoint:l},{cache:c})=>{var d;try{const e={taskModuleResult:{__typename:"TaskModuleResult",text:null!=t?t:null,card:nv(o),adaptiveCardTabResult:null!==(d=s&&s.map((e=>nv(e))))&&void 0!==d?d:null,taskModuleId:i,draftId:null!=n?n:null,conversationId:null!=r?r:null,reason:a,entryPoint:l}};return c.writeQuery({query:iv.sR,data:e}),!0}catch(e){return!1}},resetTaskModuleResult:(e,t,{cache:i})=>{try{return i.writeQuery({query:iv.sR,data:{taskModuleResult:null}}),!0}catch(e){return!1}},updateAppDetailsResult:(e,{input:t},{cache:i})=>{try{if(!t)throw new Error("No appInstallDetails input received");const{appId:e,appInstallId:n,isAppInstalled:o,errorCode:r}=t,s={appDetailsResult:{__typename:"AppDetailsResult",appInstallId:n,appId:e,isAppInstalled:o,errorCode:r||null}};return i.writeQuery({query:ov.i,data:s}),!0}catch(e){return!1}},updateInContextStoreLaunchInstalledAppResult:(e,{input:t},{cache:i})=>{try{let e;if(t){const{id:i,appId:n,capability:o,appDisplayName:r=null,draftId:s=null}=t;e={inContextStoreLaunchInstalledAppResult:{__typename:"InContextStoreLaunchInstalledAppResult",id:i,appId:n,capability:o,appDisplayName:r,draftId:s}}}else e={inContextStoreLaunchInstalledAppResult:null};return i.writeQuery({query:rv.I,data:e}),!0}catch(e){return!1}},setPlatformAppsFetchPolicy:(e,{input:t},{cache:i,loggerFactory:n,coreSettings:o})=>((e,t,i,n)=>{var o;let r=!0;for(const s of t){let t=!0;const a={__typename:cv,forceNetworkFetch:"Network"===s.fetchSource,scope:s.scope,convId:null!==(o=s.convId)&&void 0!==o?o:null};t=hv(e,a,i,n),r=r&&t}return r})(i,t,o,n),updateAllPlatformAppsFetchPolicies:(e,{fetchSource:t},{cache:i,loggerFactory:n,scenarioFactory:o})=>{var r;let s=!0;const a=n.newLogger("updateAllPlatformAppsFetchPolicies","data-client-platform"),l=o.newScenario(U.RG.UpdateAllPlatformAppsFetchPolicies),c=vv(i),d=c.length;l.appendEventData({appCount:d});for(const e of c)try{i.writeFragment({id:e,fragment:mv,data:{__typename:cv,forceNetworkFetch:"Network"===t}})}catch(i){s=!1,null===(r=a.errorToTelemetry)||void 0===r||r.call(a,`updateAllPlatformAppsFetchPolicies: failed to update fetch policy for ${e} to ${t}`,"platform_apps_fetch_policy_update_all_resolver")}return s?(l.stop(),!0):(l.fail(),!1)},updateTabConfigurationResult:(e,{id:t,tabId:i},{cache:n})=>{try{const e={tabConfigurationResult:{__typename:"tabConfigurationResult",id:t,tabId:i}};return n.writeQuery({query:Cv.s,variables:{threadId:t},data:e}),!0}catch(e){return!1}},updateTabDeletionResult:(e,{threadId:t,channelMeetingMessageId:i,tabId:n},{client:o})=>{try{const e={tabDeletionResult:{__typename:"TabDeletionResult",threadId:t,channelMeetingMessageId:i,tabId:n}};return o.writeQuery({query:_v.r,variables:{threadId:t,channelMeetingMessageId:i},data:e}),!0}catch(e){return!1}},updateMessageToParentResult:(e,{appId:t,message:i},{cache:n})=>{try{const e={messageToParentResult:{__typename:"messageToParentResult",appId:t,message:i}};return n.writeQuery({query:Tv.y,variables:{appId:t},data:e}),!0}catch(e){return!1}},updateMessageToChildResult:(e,{appId:t,message:i},{cache:n})=>{try{const e={messageToChildResult:{__typename:"messageToChildResult",appId:t,message:i}};return n.writeQuery({query:Iv.n,variables:{appId:t},data:e}),!0}catch(e){return!1}},updateAppButtonSettings:(e,{appId:t,action:i},{cache:n})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={appButtonResult:{__typename:"AppButtonResult",appId:t,action:i}};return n.writeQuery({query:Ev.E,variables:{appId:t},data:e}),!0}catch(e){return!1}},updateChangeSettings:(e,{id:t,status:i,appId:n,tabId:o},{cache:r})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={changeSettingsResult:{__typename:"ChangeSettingsResult",id:t,status:i,appId:null!=n?n:null,tabId:null!=o?o:null}};return r.writeQuery({query:jv.L,variables:{id:t},data:e}),!0}catch(e){return!1}},triggerChangeSettings:(e,{id:t,message:i,appId:n,tabId:o},{cache:r})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={changeSettingsTriggerResult:{__typename:"ChangeSettingsTriggerResult",id:t,message:i,appId:null!=n?n:null,tabId:null!=o?o:null}};return r.writeQuery({query:Nv.N,variables:{id:t},data:e}),!0}catch(e){return!1}},updateSelectMediaResult:(e,{input:t},{cache:i})=>{var n;try{const{selectMediaError:e,mediaUrls:o}=t,r={selectMediaResult:{__typename:"SelectMediaResult",selectMediaError:null!=e?e:null,mediaUrls:null!==(n=o)&&void 0!==n?n:null}};return i.writeQuery({query:fv.a,data:r}),!0}catch(e){return!1}},resetSelectMediaResult:(e,t,{cache:i})=>{try{return i.writeQuery({query:fv.a,data:{selectMediaResult:null}}),!0}catch(e){return!1}},updateViewImagesResult:(e,{input:t},{cache:i})=>{try{const{viewImagesError:e,errorCode:n}=t,o={viewImagesResult:{__typename:"ViewImagesResult",viewImagesError:null!=e?e:null,errorCode:null!=n?n:null}};return i.writeQuery({query:Sv.R,data:o}),!0}catch(e){return!1}},resetViewImagesResult:(e,t,{cache:i})=>{try{return i.writeQuery({query:Sv.R,data:{viewImagesResult:null}}),!0}catch(e){return!1}},updateMapCoordinateResult:(e,{locationApiResult:t},{cache:i})=>{try{const{latitude:e,longitude:n,locationApiError:o}=t,r={mapCoordinateResult:{__typename:"MapCoordinateResult",latitude:null!=e?e:null,longitude:null!=n?n:null,locationApiError:null!=o?o:null}};return i.writeQuery({query:sv.i,data:r}),!0}catch(e){return!1}},resetMapCoordinateResult:(e,t,{cache:i})=>{try{return i.writeQuery({query:sv.i,data:{mapCoordinateResult:null}}),!0}catch(e){return!1}},resetSelectPeoplePickerResult:(e,t,{cache:i})=>{try{return i.writeQuery({query:av.k,data:{selectPeoplePickerResult:[]}}),!0}catch(e){return!1}},updateSelectPeoplePickerResult:(e,{selectPeoplePickerResult:t},{cache:i})=>{try{const e={selectPeoplePickerResult:t.map((e=>({__typename:"SelectPeoplePickerResult",objectId:e.objectId,displayName:e.displayName||"",email:e.email||""})))};return i.writeQuery({query:av.k,data:e}),!0}catch(e){return!1}},updateCustomAppUploadResult:(e,{input:t},{cache:i})=>{try{if(!t)throw new Error("No customAppUpload input received");const{customAppType:e}=t,n={customAppUploadResult:{__typename:"CustomAppUploadResult",customAppType:e}};return i.writeQuery({query:xv.k,data:n}),!0}catch(e){return!1}},updateShowLocationResult:(e,{response:t},{cache:i})=>{try{const e={showLocationResponse:null!=t?t:null};return i.writeQuery({query:Av.F,data:e}),!0}catch(e){return!1}},resetShowLocationResponse:(e,t,{cache:i})=>{try{return i.writeQuery({query:Av.F,data:{showLocationResponse:null}}),!0}catch(e){return!1}},updateWebhookConfirmationResult:(e,{input:t},{cache:i})=>{try{if(!t)throw new Error("No webhookConfirmation input received");const e={webhookConfirmationResult:t};return i.writeQuery({query:Dv.S,data:e}),!0}catch(e){return!1}},setAppDevicePermissionsUpdated:(e,{input:t},{cache:i})=>{if(!t||!t.id||!t.status)throw new Error("Incorrect input received; id and status are required");try{const{id:e,status:n}=t,o={appDevicePermissionsUpdated:{__typename:"AppDevicePermissionsUpdated",id:e,status:n}};return i.writeQuery({query:Fv.g,data:o,variables:{input:e}}),o.appDevicePermissionsUpdated}catch(e){return null}},addSharedPlatformCachedApps:(e,{input:t},{cache:i,loggerFactory:n})=>Rv(t,i,Uv,null==n?void 0:n.newLogger(`${Ov}addSharedPlatformCachedApps`,"data-client-platform")),removeSharedPlatformCachedApps:(e,{input:t},{cache:i,loggerFactory:n})=>Rv(t,i,Wv,null==n?void 0:n.newLogger(`${Ov}removeSharedPlatformCachedApps`,"data-client-platform")),updateSharedPlatformCachedApps:(e,{input:t},{cache:i,loggerFactory:n,coreSettings:o})=>Rv(t,i,$v,null==n?void 0:n.newLogger(`${Ov}updateSharedPlatformCachedApps`,"data-client-platform"),o),setLocalFrameContext:(e,{localFrameContext:t},{cache:i})=>{var n,o,r,s,a;try{const e={localFrameContext:{__typename:"LocalFrameContext",id:t.id,threadId:null!==(n=t.threadId)&&void 0!==n?n:null,messageId:null!==(o=t.messageId)&&void 0!==o?o:null,tabId:null!==(r=t.tabId)&&void 0!==r?r:null,websiteUrl:null!==(s=t.websiteUrl)&&void 0!==s?s:null,contentUrl:null!==(a=t.contentUrl)&&void 0!==a?a:null}};return i.writeQuery({query:Hv.O,data:e}),e.localFrameContext}catch(e){return null}},resetLocalFrameContext:(e,t,{cache:i})=>{try{return i.writeQuery({query:Hv.O,data:{localFrameContext:null}}),null}catch(e){throw e}},setAppsBadgeRead:(e,{isRead:t},{cache:i})=>{try{return i.writeQuery({query:qv.Q,data:{appsBadgeRead:!!t}}),!0}catch(e){return!1}},setBackButtonHandlerState:(e,{backButtonHandlerState:t},{cache:i})=>{var n;try{const e={backButtonHandlerState:{__typename:"BackButtonHandlerState",id:t.id,registered:null!==(n=t.registered)&&void 0!==n&&n}};return i.writeQuery({query:zv.i,data:e}),e.backButtonHandlerState}catch(e){return null}},resetBackButtonHandlerState:(e,t,{cache:i})=>{try{return i.writeQuery({query:zv.i,data:{backButtonHandlerState:null}}),null}catch(e){throw e}},setMetaosApplicationSearchHandlerState:(e,{metaosApplicationSearchHandlerState:t},{cache:i})=>{var n;try{const e={metaosApplicationSearchHandlerState:{__typename:"MetaosApplicationSearchHandlerState",id:t.id,registered:null!==(n=t.registered)&&void 0!==n&&n}};return i.writeQuery({query:Vv,data:e}),e.metaosApplicationSearchHandlerState}catch(e){return null}},resetMetaosApplicationSearchHandlerState:(e,t,{cache:i})=>{try{return i.writeQuery({query:Vv,data:{metaosApplicationSearchHandlerState:null}}),null}catch(e){throw e}}}};var Jv=i(651998),Kv=i(982459),Qv=i(810786),Yv=i(135103),Xv=i(107195);const Zv="1ded03cb-ece5-4e7c-9f73-61c375528078",ey=10,ty="emptyLinkedEntityId",iy=()=>({__typename:"Entity",action:pe.uk.view,entityState:{__typename:"EntityState",flushableByLinkedEntity:!0},id:f.ew,linkedEntity:null,type:pe.py.blank,options:null,windowOptions:null});function ny(){return{__typename:"ActiveEntities",subNavEntity:null,startEntity:null,headerEntity:null,mainEntity:iy(),endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}}function oy(e,t){return!(!e||!t)&&(e.id===t.id&&e.type===t.type&&e.action===t.action)}function ry(e,t){return oy(e,t.subNavEntity)||oy(e,t.headerEntity)||oy(e,t.mainEntity)}function sy(e,t){return!e&&!t||!(!e||!t)&&(e.id===t.id&&e.type===t.type&&e.action===t.action&&(null==e?void 0:e.entityState.flushableByLinkedEntity)===(null==t?void 0:t.entityState.flushableByLinkedEntity)&&(null==e?void 0:e.options)===(null==t?void 0:t.options)&&function(e,t){if(!e&&!t)return!0;if(e&&t)return e.action===t.action&&e.id===t.id&&e.type===t.type;return!1}(null==e?void 0:e.linkedEntity,null==t?void 0:t.linkedEntity))}function ay(e,t,i){const n=new Map,o=new Map;for(const r of e){if(i&&!i(r))continue;const{mainEntity:e,endEntity:s}=r.activeEntities,a=r.userContextId;n.set(t(e,a),[r,e]);const{linkedEntity:l}=e;if(l&&o.set(t(l,a),[r,l]),s){n.set(t(s,a),[r,s]);const{linkedEntity:e}=s;e&&o.set(t(e,a),[r,e])}}return[n,o]}function ly(e,t){return`${e.type}-${e.id}-${t}`}function cy(e){return!!e.activeEntities}function dy(e,t){if(!t)return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:null,endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null};const{__typename:i}=t,n=(0,o.__rest)(t,["__typename"]),r=Object.assign({},n);if(!e)return r;const{subNavEntity:s,headerEntity:a,startEntity:l,mainEntity:c,endEntity:d,entityExtension:u,monitorEntity:m,inAppNotificationsEntity:g}=e,{subNavEntity:h,headerEntity:p,startEntity:v,mainEntity:y,endEntity:f,entityExtension:S,monitorEntity:k,inAppNotificationsEntity:b}=t;return r.subNavEntity=oy(s,h)?null:h,r.headerEntity=oy(a,p)?null:p,r.startEntity=oy(l,v)?null:v,r.mainEntity=oy(c,y)?null:y,r.endEntity=oy(d,f)?null:f,r.entityExtension=oy(u,S)?null:S,r.monitorEntity=oy(m,k)?null:k,r.inAppNotificationsEntity=oy(g,b)?null:b,r}function uy(e,t){const i=cy(e)?e.activeEntities:null,n=cy(t)?t.activeEntities:null;if(!i||!n)return!0;const{subNavEntity:o,headerEntity:r,startEntity:s,mainEntity:a,endEntity:l,entityExtension:c,monitorEntity:d,inAppNotificationsEntity:u}=i,{subNavEntity:m,headerEntity:g,startEntity:h,mainEntity:p,endEntity:v,entityExtension:y,monitorEntity:f,inAppNotificationsEntity:S}=n;return!(e.userContextId===t.userContextId&&e.extendedEntityContainerState.containerState===t.extendedEntityContainerState.containerState&&function(e,t){var i,n,o,r;if(e&&t)return(null===(i=e.blockedCommand)||void 0===i?void 0:i.stateTransition)===(null===(n=t.blockedCommand)||void 0===n?void 0:n.stateTransition)&&(null===(o=e.blockedCommand)||void 0===o?void 0:o.visibilityState)===(null===(r=t.blockedCommand)||void 0===r?void 0:r.visibilityState)&&sy(e.blockedEntity,t.blockedEntity)&&e.blockedEntityOptions===t.blockedEntityOptions;if(!e&&!t)return!0;return!1}(e.blockingEntityExtension,t.blockingEntityExtension)&&sy(o,m)&&sy(r,g)&&sy(s,h)&&sy(a,p)&&sy(l,v)&&sy(c,y)&&sy(d,f)&&sy(u,S))}function my(e,t,i,n){var o;const r=py(cy(e)?e.activeEntities:null,cy(t)?t.activeEntities:null);return i!==ve.su.none||"search"===(null===(o=r.endEntity)||void 0===o?void 0:o.type)||"search"===n.type&&gy(r)}function gy(e){return!(e.subNavEntity||e.headerEntity||e.startEntity||e.mainEntity||e.endEntity||e.entityExtension)}const hy=e=>({subNavEntity:(null==e?void 0:e.subNavEntity)||null,headerEntity:(null==e?void 0:e.headerEntity)||null,startEntity:(null==e?void 0:e.startEntity)||null,mainEntity:(null==e?void 0:e.mainEntity)||null,endEntity:(null==e?void 0:e.endEntity)||null,entityExtension:(null==e?void 0:e.entityExtension)||null,monitorEntity:(null==e?void 0:e.monitorEntity)||null,inAppNotificationsEntity:(null==e?void 0:e.inAppNotificationsEntity)||null});function py(e,t,i=!1){if(!t)return hy(e);const n=Object.assign({},t);if(!e)return n;const{subNavEntity:o,headerEntity:r,startEntity:s,mainEntity:a,endEntity:l,entityExtension:c,monitorEntity:d,inAppNotificationsEntity:u}=e,{subNavEntity:m,headerEntity:g,startEntity:h,mainEntity:p,endEntity:v,entityExtension:y,monitorEntity:f,inAppNotificationsEntity:S}=t,k=i?(e,t)=>sy(e,t):(e,t)=>oy(e,t);return n.subNavEntity=k(o,m)?null:null!=m?m:o,n.headerEntity=k(r,g)?null:null!=g?g:r,n.startEntity=k(s,h)?null:null!=h?h:s,n.mainEntity=k(a,p)?null:null!=p?p:a,n.endEntity=k(l,v)?null:null!=v?v:l,n.entityExtension=k(c,y)?null:null!=y?y:c,n.monitorEntity=k(d,f)?null:null!=f?f:d,n.inAppNotificationsEntity=k(u,S)?null:null!=S?S:u,n}function vy(e){return!!(e.mainEntity||e.endEntity||e.entityExtension||e.monitorEntity)}function yy(){return{__typename:"ExtendedEntityContainerState",containerState:ve.oq.Closed,isExternal:!1}}const fy=()=>({id:(0,xe.v4)(),startTimestamp:Date.now().toString(),source:k.D.Unknown});function Sy(e){if(!e)return null;const{action:t=null,entityState:i={flushableByLinkedEntity:!0},id:n,linkedEntity:o=null,options:r=null,type:s,windowOptions:a=null}=Object.assign({},e);return{action:null!=t?t:pe.uk.view,entityState:{flushableByLinkedEntity:i.flushableByLinkedEntity,__typename:"EntityState"},id:n||null,linkedEntity:o&&by(o)||null,options:r,type:s,windowOptions:a?Object.assign(Object.assign({},a),{__typename:"WindowOptions"}):null,__typename:"Entity"}}function ky(e,t,i){return{id:e.id||null,type:e.type,action:e.action,options:t||null,windowOptions:i?Object.assign(Object.assign({},i),{__typename:"WindowOptions"}):null,linkedEntity:e.linkedEntity&&by(e.linkedEntity)||null,entityState:{flushableByLinkedEntity:!0,__typename:"EntityState"},__typename:"Entity"}}function by(e){return{action:e.action||null,id:e.id?e.id:ty,type:e.type,__typename:"LinkedEntity"}}const wy=e=>e?Object.assign(Object.assign({},e),{options:null}):null,Cy=e=>Object.assign(Object.assign({},e),{subNavEntity:wy(e.subNavEntity),headerEntity:wy(e.headerEntity),startEntity:wy(e.startEntity),mainEntity:wy(e.mainEntity),endEntity:wy(e.endEntity)}),_y=e=>e?(0,Ee.b4)(e):null,Ty=(e,t,i)=>{var n;const o=t&&(null===(n=e.getApp({entityType:t.type}))||void 0===n?void 0:n.manifest.id);o&&i.add(o)},Iy=(e,t)=>{const{subNavEntity:i,headerEntity:n,startEntity:o,mainEntity:r,endEntity:s}=t,a=new Set;return Ty(e,i,a),Ty(e,n,a),Ty(e,o,a),Ty(e,r,a),Ty(e,s,a),a};function jy({appsRegistryService:e,currentWindowId:t,newReactiveValues:i}){i&&(e.resetAllViewState(t),Object.keys(i).forEach((n=>{e.setReactiveValuesForApp(t,n,i[n])})))}const Ny=e=>{if(!e)return;let t={};return t=Object.keys(e).reduce(((t,i)=>{const n=e[i];return Object.assign(Object.assign({},t),{[i]:n.read()})}),{}),t},Ey=(e,t={resetMonitor:!0})=>{var i;return e.layoutConfig.slots=Object.assign(Object.assign({},xy()),!t.resetMonitor&&{monitor:null===(i=e.layoutConfig.slots)||void 0===i?void 0:i.monitor}),e},xy=()=>{const e={__typename:"SlotLayoutConfig",height:null,isHidden:!1,width:null};return{__typename:"SlotsLayoutConfig",contextualNotifications:e,end:e,header:e,main:e,monitor:e,nav:e,notifications:e,inAppNotifications:e,start:e,subNav:e,titleBar:e,toasts:e}};var Ay=i(58826);function Dy(e,t){return e.replace(/\n/g,`\n${"  ".repeat(t)}`)}function Fy(e,t){if(!e)return"{}";if(t)return Dy(Fy(e),t);const{id:i,type:n,action:o,linkedEntity:r,entityState:s}=Object.assign({},e);return`{\n  id: ${i},\n  type: ${n},\n  action: ${o},${r?`\n  linkedEntity: {\n    id: ${r.id},\n    type: ${r.type}\n  },`:""}${s?`\n  entityState: {\n    flushableByLinkedEntity: ${s.flushableByLinkedEntity}\n  }`:""}\n}`}function Oy(e,t){return e?t?Dy(Oy(e),t):`{\n  id: ${e.id},\n  startTimestamp: ${e.startTimestamp},\n  source: ${e.source}\n}`:"{}"}function My(e,t){const{subNavEntity:i,headerEntity:n,startEntity:o,mainEntity:r,endEntity:s,monitorEntity:a,inAppNotificationsEntity:l,entityExtension:c}=e;i&&t.log(`subNavEntity: ${Fy(i)}`),n&&t.log(`headerEntity: ${Fy(n)}`),o&&t.log(`startEntity: ${Fy(o)}`),t.log(`mainEntity: ${Fy(r)}`),s&&t.log(`endEntity: ${Fy(s)}`),a&&t.log(`monitorEntity: ${Fy(a)}`),l&&t.log(`inAppNotificationsEntity: ${Fy(l)}`),c&&t.log(`entityExtension: ${Fy(c)}`)}function Ry(e,t){const{id:i,correlation:n,isMainWindow:o,layoutConfig:r}=e,s=Py(r);t.log(`{\n  id: ${i},\n  correlation: ${Oy(n,1)},\n  isMainWindow: ${o},\n  layoutMode: ${r.layoutMode},\n  layoutOverrides: ${null==s?void 0:s.toString()}\n}`),cy(e)?(t.log("activeEntities for window:"),My(e.activeEntities,t)):t.log("activeEntities: undefined")}const Py=e=>e.slots&&Object.keys(e.slots).reduce(((t,i)=>{var n,o,r,s,a,l,c,d,u,m,g,h;return"__typename"===i||((null===(o=null===(n=e.slots)||void 0===n?void 0:n[i])||void 0===o?void 0:o.height)||(null===(s=null===(r=e.slots)||void 0===r?void 0:r[i])||void 0===s?void 0:s.width)||(null===(l=null===(a=e.slots)||void 0===a?void 0:a[i])||void 0===l?void 0:l.isHidden))&&t.push(`${i}:height(${null===(d=null===(c=e.slots)||void 0===c?void 0:c[i])||void 0===d?void 0:d.height}),width(${null===(m=null===(u=e.slots)||void 0===u?void 0:u[i])||void 0===m?void 0:m.width}),isHidden(${null===(h=null===(g=e.slots)||void 0===g?void 0:g[i])||void 0===h?void 0:h.isHidden})`),t}),[]);function Ly(e,t){if(void 0===e)return t.log("undefined - app not ported to multi slot");if(null===e)return t.log("null - no app supports this entity");const{subNavEntity:i,headerEntity:n,startEntity:o,mainEntity:r,endEntity:s}=e;i&&t.log(`subNavEntity: ${Fy(i)}`),n&&t.log(`headerEntity: ${Fy(n)}`),o&&t.log(`startEntity: ${Fy(o)}`),r&&t.log(`mainEntity: ${Fy(r)}`),s&&t.log(`endEntity: ${Fy(s)}`)}const Uy=e=>{var t,i,n;return null!==(n=null!==(i=null!==(t=e.subNavEntity)&&void 0!==t?t:e.headerEntity)&&void 0!==i?i:e.startEntity)&&void 0!==n?n:e.mainEntity},Wy=({entity:e,currentEntities:t,shouldUseNewEntity:i})=>{var n;return i?{appEntity:null!==(n=e.linkedEntity)&&void 0!==n?n:e,contextEntity:e.linkedEntity?e:null}:t?{appEntity:Uy(t),contextEntity:e}:{appEntity:e,contextEntity:null}},By=e=>({infoPane:e.getPreferences("infoPane"),teamLayout:e.getPreferences("teamLayout")}),$y=({appsRegistryService:e,clientPreferences:t,contextEntity:i,coreSettings:n,entity:o,layoutMode:r})=>{if(!o)throw new Error("entity used to match app is null");const s=e.getApp({entityType:o.type});if(!s)return;if(!s.getAppViewEntities)return;const a=s.getAppViewEntities({contextEntity:i,coreSettings:n,entity:o,layoutMode:r,userPreferences:By(t)});if("activity"===o.type&&i&&a){const o=e.getApp({entityType:i.type});if(!o||!o.getAppViewEntities)return a;const s=o.getAppViewEntities({entity:i,contextEntity:i,coreSettings:n,layoutMode:r,userPreferences:By(t)});s&&Object.assign(a,{endEntity:s.endEntity})}return a},Hy={subNavEntity:{children:["headerEntity","startEntity","mainEntity","endEntity"]},headerEntity:{children:["startEntity","mainEntity","endEntity"]},startEntity:{children:["mainEntity","endEntity"]},mainEntity:{children:["endEntity"]},endEntity:{children:null}},qy=e=>!(!e||"monitorEntity"===e||"inAppNotificationsEntity"===e);function zy(e){return e&&e.viewEntityName&&qy(null==e?void 0:e.viewEntityName)?e.viewEntityName:"subNavEntity"}function Vy({executionContext:e,viewEntityName:t}){return zy(e)===t}function Gy({executionContext:e,viewEntityName:t}){const i=zy(e),{children:n}=Hy[i];return!(!n||!n.includes(t))}var Jy=i(820140);const Ky=(e,t)=>({endEntity:Sy(e.endEntity),headerEntity:Sy(e.headerEntity),mainEntity:Sy(e.mainEntity)||t,startEntity:Sy(e.startEntity),subNavEntity:Sy(e.subNavEntity),monitorEntity:null,inAppNotificationsEntity:null,entityExtension:null,__typename:"ActiveEntities"}),Qy=(e,t,i,n,o)=>{var r;const{appsRegistryService:s,coreSettings:a,clientPreferences:l}=e,c=Uy(t),d=s.getApp({entityType:null==c?void 0:c.type}),u=Uy(o),m=s.getApp({entityType:null==u?void 0:u.type}),g=null===(r=null==d?void 0:d.onBeforeNavigationFromHistory)||void 0===r?void 0:r.call(d,t,{coreSettings:a,layoutMode:i,userPreferences:By(l)},(null==m?void 0:m.manifest.id)===(null==d?void 0:d.manifest.id)?o:void 0);return g?(n.log(`${null==d?void 0:d.manifest.name} app declared history invalid. New set of entities:`),Ly(g,n),Ky(g,ny().mainEntity)):t},Yy=(e,t,i,n)=>{var o;const r=e.get((0,Jy.bM)(Jy.WD,i),"Experience");if(r)try{const e=JSON.parse(r);return n&&i!==e.userContextId?null:tf(e.activeEntities,t)}catch(e){null===(o=t.errorToTelemetry)||void 0===o||o.call(t,`Could not restore active entities from local storage. Stored string was in an invalid JSON format. String: ${r}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}return null},Xy=({localStorage:e,logger:t,appsRegistryService:i,userContextId:n,entityType:o,appId:r})=>{var s,a;const l=r||(null===(s=i.getApp({entityType:o}))||void 0===s?void 0:s.manifest.id),c=e.get((0,Jy.bM)(`${Jy.av}-${l}`,n),"Experience");if(c)try{return tf(JSON.parse(c),t)}catch(e){null===(a=t.errorToTelemetry)||void 0===a||a.call(t,`Could not restore active entities from local storage. Stored string was in an invalid JSON format error ${e}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),t.log("String in local storage: ",c)}return null},Zy=(e,t,i)=>{var n,o;const r=e.windowHistory.map((e=>Object.assign(Object.assign({},e),{activeEntities:Cy(e.activeEntities),reactiveVars:{}})));if(t.trySet((0,Jy.bM)(Jy.ax,e.userContextId),JSON.stringify(r),"Framework","Experience")){!t.trySet((0,Jy.bM)(Jy.Hs,e.userContextId),JSON.stringify({windowHistoryIndex:e.currentWindowHistoryIndex,userContextId:e.userContextId}),"Framework","Experience")&&(null===(n=i.errorToTelemetry)||void 0===n||n.call(i,`Failed to save history index ${e.currentWindowHistoryIndex}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0))}else null===(o=i.errorToTelemetry)||void 0===o||o.call(i,`Failed to save main window history to local storage with history length ${r.length}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)},ef=({action:e,type:t,id:i,entityState:n,linkedEntity:o,options:r,windowOptions:s})=>e&&t?{action:e,entityState:{flushableByLinkedEntity:n&&n.flushableByLinkedEntity||!1,__typename:"EntityState"},id:i||null,linkedEntity:o&&o.type?{id:o.id||ty,action:o.action||pe.uk.view,type:o.type,__typename:"LinkedEntity"}:null,options:r||null,type:t,windowOptions:s?{left:s.left||0,top:s.top||0,width:s.width||0,height:s.height||0,__typename:"WindowOptions"}:null,__typename:"Entity"}:null,tf=(e,t)=>e.mainEntity?{__typename:"ActiveEntities",subNavEntity:e.subNavEntity&&ef(e.subNavEntity)||null,headerEntity:e.headerEntity&&ef(e.headerEntity)||null,startEntity:e.startEntity&&ef(e.startEntity)||null,mainEntity:e.mainEntity&&ef(e.mainEntity)||iy(),endEntity:e.endEntity&&ef(e.endEntity)||null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}:(t.log("No main entity in entities stored in local storage"),null),nf=(e,t)=>e.reduce(((e,i)=>{const n=((e,t)=>{if(!e.activeEntities)return t.log("No activeEntities in window history item in local storage"),null;const i=tf(e.activeEntities,t);return i?{activeEntities:i,reactiveVars:{},__typename:"WindowHistoryItem"}:null})(i,t);return n&&e.push(n),e}),[]);function of(e,t,i=e.windowHistory.length-1,n){const{maxWindowHistoryLength:o}=n.get(b.J.Core);if(!cy(e))return;const r=e.windowHistoryNavigationState,s=e.windowHistory;i<0&&(i=-1),e.currentWindowHistoryIndex=i;const a=s.length>0&&s[s.length-1].activeEntities.mainEntity,l=e.activeEntities.mainEntity,c=!!a&&oy(a,l);r.canNavigateBack=!(0===s.length||1===s.length&&c)&&i>0,r.canNavigateForward=i<e.windowHistory.length-1;let d=i;i!==e.windowHistory.length-1&&(d=i-1),r.backHistory=rf(0,d,e.windowHistory);const u=r.backHistory,m=e.activeEntities.mainEntity;u.length>0&&oy(m,u[u.length-1].entity)&&(u.pop(),t.log("windowHistoryNavigationState back history entry was popped.")),r.backHistory=u.reverse().slice(0,o||ey),r.forwardHistory=rf(i+1,e.windowHistory.length-1,e.windowHistory).slice(0,o||ey),t.log(`Reset windowHistoryNavigationState. size: ${e.windowHistory.length}, windowHistoryIndex: ${i}`),t.log(`Reset windowHistoryNavigationState. canNavigateBack: ${r.canNavigateBack}, canNavigateForward: ${e.windowHistoryNavigationState.canNavigateForward}, backHistory size: ${e.windowHistoryNavigationState.backHistory.length}, forwardHistory size: ${r.forwardHistory.length}`)}function rf(e,t,i){if(!i)return[];const n=[];for(let o=e;o<=t;o++)n.push({__typename:"WindowHistoryNavigationItem",windowHistoryIndex:o,entity:i[o].activeEntities.mainEntity});return n}const sf=(e,t,i)=>{const n=n=>!n||i(t.getApp({entityType:n.type}),{mainEntity:e.mainEntity,subNavEntity:e.subNavEntity});return n(e.mainEntity)&&n(e.subNavEntity)},af=(e,t,i)=>sf(e,t,((e,t)=>{var n,o;try{return!(null===(n=null==e?void 0:e.onBeforeAddToNavigation)||void 0===n?void 0:n.shouldAddEntitiesToWindowHistory)||e.onBeforeAddToNavigation.shouldAddEntitiesToWindowHistory(t)}catch(t){return null===(o=i.errorToTelemetry)||void 0===o||o.call(i,`App ${e.manifest.name} failed to execute entity command hook 'ShouldAddEntitiesToWindowHistory' with ""${t.name}"" error`,"entity_command_hook",{errors:`${t.name}`},!0),!0}}));function lf({appIdsForReactiveVarChange:e,context:t,isUserContextSwitch:i,logger:n,newActiveEntities:o,windowContentState:r,skipMoveToTop:s,forcePush:a}){const{appsRegistryService:l,windowProvider:c,clientPreferences:d,coreSettings:u}=t,{currentWindowHistoryIndex:m,windowId:g}=r;let{windowHistory:h}=r;const{enableHostHistoryNavigation:p,maxWindowHistoryLength:v}=u.get(b.J.Core);i&&(n.log("User context switch, clearing out history"),h=[]),n.log(`handleWindowHistoryPush called: current length: ${h.length} current index ${m}`);const y=cf(o,l,d,u,r.layoutMode),f=Iy(l,y);if(e&&!e.some((e=>f.has(e))))return n.log(`Not storing rv change to history b/c rv changes made for app not being stored in history ${e} `),[h,!1];if(!af(y,l,n))return n.log("Not saving to history b/c app shouldAddEntitiesToWindowHistory hook has returned false"),[h,!1];const S={};f.forEach((e=>{const{navigationalReactiveValues:t,nonNavigationalReactiveValues:i}=l.getAppViewStateForWindow(g,e)||{};(t||i)&&(S[e]=Ny(Object.assign(Object.assign({},t),i)))}));let k=h;const w=h[m];if(!w||e||vy(dy(o,w.activeEntities))||a){if(!s&&m<h.length-1){n.log("Current index not at top stack");const e=h.splice(m,1);h.push(e[0]),n.log("Moving to top of stack: "),My(e[0].activeEntities,n),n.log(`Pushed windowHistory navigation item at index ${m} to the top of the history stack.`)}const e={__typename:"WindowHistoryItem",activeEntities:Object.assign(Object.assign({},y),{monitorEntity:null,inAppNotificationsEntity:null}),reactiveVars:S};return k=[...h,e],p?(c.history.pushState({windowHistoryIndex:k.length-1},""),n.log(`Added browser history entry with windowHistoryIndex: ${k.length}.`)):v?k=k.slice(-v):0===v&&(k=[]),n.log(`windowHistory length after push ${k.length}`),[k,!0]}return n.log("Did not push to window history"),[k,!1]}const cf=(e,t,i,n,o)=>{const r=t.getApp({entityType:Uy(e).type});return r&&r.manifest.shouldDeferNavigationToMainSlotApp?df(e,t,i,n,o):e},df=(e,t,i,n,o)=>{const{appEntity:r,contextEntity:s}=Wy({currentEntities:e,entity:e.mainEntity,shouldUseNewEntity:!0}),a=$y({appsRegistryService:t,clientPreferences:i,contextEntity:s,coreSettings:n,entity:r,layoutMode:o});return a&&a.mainEntity?Ky(a,e.mainEntity):e};function uf(e,t,i,n=!0){var o;try{const{activeWindows:t=[]}=i.enableDecoupleCommandingFromApollo?{activeWindows:i.getActiveWindows()}:e.readQuery({query:Ay.i8})||{};return n?(0,L.cloneDeep)(t):t}catch(e){return null===(o=t.errorToTelemetry)||void 0===o||o.call(t,`activeWindowsQuery cache read failed - ${e.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),t.log("activeWindowsQuery entry not found in cache"),[]}}function mf(e,t,i,n,o,r,s){var a,l,c,d;const{activeWindowsService:u,cache:m,commandChangeReportingService:g}=e,h=o||(null==i?void 0:i.correlation.id)||(0,xe.v4)(),p=i?function(e,t,i,n){var o;let r;const s=t.slice(0);if(cy(e)){const t=s.findIndex((t=>t.id===e.id));r=e,-1===t?s.push(r):s[t]=r}else{const t=e.windowHistory.length;if(t>0&&!e.windowHistory[t-1].activeEntities)throw null===(o=i.errorToTelemetry)||void 0===o||o.call(i,"Unable to resolve active entities, trying to pop back to empty window","webclient_framework_foundation_core_services_entity_commanding"),(0,se.Tr)(f.w5.Commanding,f.jK.Undefined,"executeEntityCommand",e.correlation,"Unable to resolve to active entities");r=s.splice(s.findIndex((t=>t.id===e.id)),1)[0],i.log(`Window has no active entities so destroying for correlation ${n}`)}return s}(i,t,n,h):t;try{u.enableDecoupleCommandingFromApollo?(u.setActiveWindows(p,r),i&&(null==i?void 0:i.activeEntities)&&(null===(a=u.getWindowLayoutService(i.id))||void 0===a||a.modalManager.updateModalState(i)),i&&(null==i?void 0:i.activeEntities)&&(null===(l=u.getWindowLayoutService(i.id))||void 0===l||l.modalManager.setBlockingEntityExtension(null===(c=i.blockingEntityExtension)||void 0===c?void 0:c.entity))):m.writeQuery({query:Ay.i8,data:{activeWindows:p}})}catch(e){return null===(d=n.errorToTelemetry)||void 0===d||d.call(n,`activeWindowsQuery cache write failed - ${e.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),g.report({correlationId:h,type:Ae.B.Failure,context:{target:"executeEntityCommand",errorInfo:De.y.WindowCacheFailedToUpdate,errorMessage:e.message}}),!1}return!i||i.isNotificationsWindow||s||(hf(p,i,n,e),gf(e,p,i,h)),n.log(`After updating window cache, there are ${p.length} active windows`),!0}const gf=({appsRegistryService:e,experienceChangeReportingService:t},i,n,o)=>{if(cy(n)&&vf(i,n.id)){const i=Uy(n.activeEntities),r=e.getPlatformAppIdForEntity(i);t.report({correlationId:o,type:ft.yU.AppSelectionChanged,context:{target:"entity-command-resolver",appId:r}})}},hf=(e,t,i,{appsRegistryService:n,clientPreferences:o,coreSettings:r,localStorage:s})=>{var a,l,c,d;const{enableWriteActiveEntitiesToLocalStorage:u,enableWriteAppHistoryToLocalStorage:m,enableWindowHistoryRestorationOnStandardMain:g}=r.get(b.J.Core);if(cy(t)&&vf(e,t.id)){const e=Object.assign(Object.assign({},t.activeEntities),{monitorEntity:null,inAppNotificationsEntity:null});if(((e,t,i)=>sf(e,t,((e,t)=>{var n,o;try{return!(null===(n=null==e?void 0:e.onBeforeAddToNavigation)||void 0===n?void 0:n.shouldRestoreClientToEntities)||e.onBeforeAddToNavigation.shouldRestoreClientToEntities(t)}catch(t){return null===(o=i.errorToTelemetry)||void 0===o||o.call(i,`App ${e.manifest.name} failed to execute entity command hook 'ShouldRestoreClientToEntities' with ""${t.name}"" error`,"entity_command_hook",{errors:`${t.name}`},!0),!0}})))(e,n,i)&&u&&s.set((0,Jy.bM)(Jy.WD,t.userContextId),JSON.stringify({activeEntities:e,userContextId:t.userContextId}),"Framework","Experience"),m){const{activeEntities:i}=t,u=Uy(i),m=n.getApp({entityType:u.type});if(null===(l=null===(a=null==m?void 0:m.onBeforeAddToNavigation)||void 0===a?void 0:a.shouldStoreLastVisitedInAppHistory)||void 0===l?void 0:l.call(a,i.mainEntity)){const i=null==m?void 0:m.manifest.id;s.set((0,Jy.bM)(`${Jy.av}-${i}`,t.userContextId),JSON.stringify(Cy(e)),"Framework","Experience")}else if(null==m?void 0:m.manifest.shouldDeferNavigationToMainSlotApp){const a=n.getApp({entityType:i.mainEntity.type}),l=null==a?void 0:a.manifest;if(null===(d=null===(c=null==a?void 0:a.onBeforeAddToNavigation)||void 0===c?void 0:c.shouldStoreLastVisitedInAppHistory)||void 0===d?void 0:d.call(c,i.mainEntity)){const i=df(e,n,o,r,t.layoutConfig.layoutMode);s.set((0,Jy.bM)(`${Jy.av}-${null==l?void 0:l.id}`,t.userContextId),JSON.stringify(Cy(i)),"Framework","Experience")}}}g&&Zy(t,s,i)}},pf=(e,t)=>e.find((e=>e.layoutConfig.layoutMode===t&&e.isMainWindow)),vf=(e,t)=>{const i=pf(e,ve.lO.standard);return t===f.ew||t===(null==i?void 0:i.id)},yf=e=>e===f.ew;function ff(e,t){const i=e.get(t);return i&&i[0]}function Sf(e,t){return e.find((e=>e.id===t))}function kf(e,t,i,n,o){let r=ff(t,ly(e,n));const{linkedEntity:s}=e;let a=!1;!r&&s&&(r=ff(t,ly(s,n)),a=!!r),!r&&e.id&&(r=ff(i,ly({id:e.id,type:e.type},n)),a=!!r);const{enableLinkedEntityMatching:l}=o.get(b.J.Core);return l&&!r&&s&&(r=ff(i,ly(s,n)),a=!!r),[r,a]}const bf="windowStateEvent";function wf({pubsub:e,fromWindowId:t,isFromWindowMain:i,sourceWindowId:n,diff:o,targetWindow:r,targetVisibilityState:s,stateTransition:a,correlation:l,logger:c}){!function(e,t,i,n,o,r,s){cy(r)&&r.id!==f.ew&&Cf(t,o)&&(i.log(`Focusing window ${s} for correlation ${e.id}`),n.publish(`${bf}-${s}`,{windowStateEvent:{isFocused:!0,correlation:e}}))}(l,o,c,e,s,r,n),function(e,t,i,n,o,r,s,a,l){!Cf(t,a)||n||l.isMainWindow||l.id===i||s!==ve.su.flush&&s!==ve.su.forceFlush||(o.log(`Closing ${i} for correlation ${e.id}`),r.publish(`${bf}-${i}`,{windowStateEvent:{correlation:e,shouldClose:!0}}))}(l,o,t,i,c,e,a,s,r)}function Cf(e,t){return t===ve.fe.show||t===ve.fe.toggle&&vy(e)}const _f=(e,t,i,n,o)=>{const r=e.activeEntities.monitorEntity,s=e.activeEntities;e.activeEntities=Qy(o,e.windowHistory[t].activeEntities,e.layoutConfig.layoutMode,i,s),(e=Ey(e,{resetMonitor:null===r})).activeEntities=Object.assign(Object.assign({},e.activeEntities),{monitorEntity:r});const a=e.windowHistory[t].reactiveVars;return jy({appsRegistryService:o.appsRegistryService,currentWindowId:e.id,newReactiveValues:a}),of(e,i,t,o.coreSettings),i.log("Window after navigating in history: "),Ry(e,i),mf(o,n,e,i)},Tf={Query:{},Mutation:{changeMonitorSlotContent:(e,{windowId:t,entityType:i,entityAction:n,entityOptions:o},r)=>{var s;const{cache:a,loggerFactory:l,activeWindowsService:c}=r,d=l.newLogger("changeSlotsVisibility-mutation","data-client-entity-command"),u=uf(a,d,c),m=Sf(u,t);if(!m)return d.error("mutation fails as targetWindow is not found."),null;let g=!1,h=!1;return n===pe.uk.view?(m.activeEntities=Object.assign(Object.assign({},m.activeEntities),{monitorEntity:{id:null,action:n,type:i,entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"},linkedEntity:null,options:o||null,windowOptions:null,__typename:"Entity"}}),h=!0):n===pe.uk.leave&&(null===(s=m.activeEntities.monitorEntity)||void 0===s?void 0:s.type)===i&&(m.activeEntities=Object.assign(Object.assign({},m.activeEntities),{monitorEntity:null}),h=!0),g=h&&mf(r,u,m,d),g&&cy(m)?m:null},changeSlotsVisibility:(e,{slotNames:t,windowId:i,isHidden:n},o)=>{const{cache:r,loggerFactory:s,activeWindowsService:a}=o,l=s.newLogger("changeSlotsVisibility-mutation","data-client-entity-command"),c=uf(r,l,a),d=Sf(c,i);if(!d)return l.error("mutation fails as targetWindow is not found."),null;let u=!1,m=!1;const g=t.reduce(((e,t)=>{var i;const o=(e=>e.replace(/-./g,(e=>e[1].toUpperCase())))(t),r=null===(i=d.layoutConfig.slots)||void 0===i?void 0:i[o];return m||(null==r?void 0:r.isHidden)===n||(m=!0),e[o]=Object.assign(Object.assign({},r),{isHidden:n}),e}),{});return m&&(d.layoutConfig.slots=Object.assign(Object.assign({__typename:"SlotsLayoutConfig"},d.layoutConfig.slots),g),u=mf(o,c,d,l)),u&&cy(d)?d:null},resizeHeaderSlot:(e,{height:t,windowId:i},n)=>{var o,r,s,a,l;const{cache:c,loggerFactory:d,activeWindowsService:u}=n,m=d.newLogger("resizeHeaderSlot-mutation","data-client-entity-command"),g=uf(c,m,u),h=Sf(g,i);if(!h)return null;let p=!1;return(null===(r=null===(o=h.layoutConfig.slots)||void 0===o?void 0:o.header)||void 0===r?void 0:r.height)!==t&&(h.layoutConfig.slots=Object.assign(Object.assign({},h.layoutConfig.slots),{__typename:"SlotsLayoutConfig",header:Object.assign(Object.assign({},null===(s=h.layoutConfig.slots)||void 0===s?void 0:s.header),{__typename:"SlotLayoutConfig",height:t,width:(null===(l=null===(a=h.layoutConfig.slots)||void 0===a?void 0:a.header)||void 0===l?void 0:l.width)||null})}),p=mf(n,g,h,m)),p&&cy(h)?h:null},resizeSlotDimensions:(e,{windowId:t,slotName:i,width:n},o)=>{var r,s,a,l,c,d;const{cache:u,loggerFactory:m,activeWindowsService:g}=o,h=m.newLogger("resizeSlotDimensions-mutation","data-client-entity-command"),p=uf(u,h,g),v=Sf(p,t);if(!v)return null;let y=!1;return"SUBNAV"===i?v.layoutConfig.slots=Object.assign(Object.assign({},v.layoutConfig.slots),{__typename:"SlotsLayoutConfig",subNav:Object.assign(Object.assign({},null===(r=v.layoutConfig.slots)||void 0===r?void 0:r.subNav),{__typename:"SlotLayoutConfig",height:(null===(a=null===(s=v.layoutConfig.slots)||void 0===s?void 0:s.subNav)||void 0===a?void 0:a.height)||null,width:n})}):"END"===i&&(v.layoutConfig.slots=Object.assign(Object.assign({},v.layoutConfig.slots),{__typename:"SlotsLayoutConfig",end:Object.assign(Object.assign({},null===(l=v.layoutConfig.slots)||void 0===l?void 0:l.end),{__typename:"SlotLayoutConfig",height:(null===(d=null===(c=v.layoutConfig.slots)||void 0===c?void 0:c.end)||void 0===d?void 0:d.height)||null,width:n})})),y=mf(o,p,v,h),y&&cy(v)?v:null}}};function If(e,t,i,n,o,r){const{enableOpenerHandleFlow:s}=o.get(b.J.Core);if(s&&vy(e)){const s=!!Ef(e,t,o),a=!!xf(e,Ff),l=!!xf(e,Mf),c=!!xf(e,Pf),d=!!xf(e,Lf),u=!!xf(e,Uf),m=!!xf(e,Wf),g=!!xf(e,Bf),h=!!xf(e,Jf),p=!!xf(e,Kf),v=!!xf(e,$f),y=!!xf(e,Zf),S=!!xf(e,aS),k=!!xf(e,tS),w=!!xf(e,iS),C=!!xf(e,nS),_=function(e,t,i){const{enableNewConsumerTasksChatTabNavigation:n}=t.get(b.J.Chat);return!n&&!!xf(e,(e=>Rf(e,i)))}(e,o,r),T=function(e,t){const{enableAliasVisibilitySettingsCommand:i}=t.get(b.J.People);return!i&&!!xf(e,Of)}(e,o),I=function(e,t,i){const{enableReactTaskModuleForBIM:n,launchAngularDialog:o,enableReactWorkflowsInBIM:r,enableReactTaskModuleForHWC:s,enableModernPurchaseFlow:a}=t.get(b.J.Extensibility);return function(e,t,i){return t===f.ew&&!i&&!!xf(e,Qf)}(e,i,n)||function(e,t,i){return t===f.ew&&!i&&!!xf(e,Yf)}(e,i,s)||function(e,t){return!!t&&!!xf(e,eS)}(e,o)||function(e,t){return!(t||!xf(e,rS)&&!xf(e,sS))}(e,r)||function(e){return!!xf(e,Xf)}(e)||function(e,t){return!t&&!!xf(e,oS)}(e,a)}(e,o,t),j=function(e,t){const{enableBrb:i}=t.get(b.J.Brb);return!i&&!!xf(e,Gf)}(e,o),N=function(e,t){const{enableHybridChannelList:i,msgEnableChannelsV2:n}=t.get(b.J.Host);return!(n||i||!xf(e,Hf))}(e,o),E=function(e,t){const{isCalendarSurfaceHybridArchitectureEnabled:i}=t.get(b.J.Host),n=!!xf(e,Vf);if(n&&i)return!1;return n}(e,o),x=function(e,t){const{isSchedulingFormHybridArchitecureEnabled:i}=t.get(b.J.Host),{enableMultiWindowCalendarSchedulingForm:n}=t.get(b.J.Calendar),o=!!xf(e,qf);if(n&&o)return!1;return o&&!i}(e,o),A=function(e,t,i,n,o){const{isSchedulingFormHybridArchitecureEnabled:r}=o.get(b.J.Host),{enableMultiWindowCalendarSchedulingFormViewAndEdit:s}=o.get(b.J.Calendar),a=!!xf(e,zf);if(a&&n)return!1;if(r&&a)return!1;if(s&&a)return!(t!==f.ew||!i);return a}(e,t,i,n,o),D=function(e,t,i,n){const{isChatHybridArchitectureEnabled:o}=t.get(b.J.Host),r=xf(e,Df);let s=!!r;r&&(n.log(`Checking if opener should handle chat ${r.id}: isChatHybridArchitectureEnabled\n      ${o}, and isNotNewNorNoneOnMainContext ${i}`),s=!1===o&&i,n.log(`Opener should handle chat ${r.id} ${s}`));return s}(e,o,i,r);return s||a||l||c||d||u||m||g||h||p||v||y||S||k||w||C||_||T||I||j||N||E||x||A||D}return!1}function jf(e,t,i,n,o,r){let s=!1,a=null;return a=Ef(t,n,r)||function(e,t){let i=null;return Nf.forEach((t=>{const n=xf(e,t);n&&(i=n)})),i||xf(e,(e=>Rf(e,t)))}(t,o),a&&(i.report({correlationId:e.id,type:Ae.B.NotHandled,context:{target:"openerHandleEntityChange"}}),s=!0),s}const Nf=[Wf,Ff,Mf,Pf,Lf,Uf,Bf,eS,Hf,Vf,function(e){return!(!e||e.type!==pe.py.schedulingform)},tS,iS,Gf,Jf,Kf,Qf,Df,$f,Zf,aS,nS,oS,rS,sS,Of,Xf];function Ef(e,t,i){const n=Af.bind(null,i);return t===f.ew?xf(e,n):null}function xf(e,t){const{mainEntity:i,endEntity:n,entityExtension:o}=e;let r=null;return i&&t(i)&&(r=i),n&&t(n)&&(r=n),o&&t(o)&&(r=o),r}function Af(e,t){if(!t)return!1;switch(t.type){case pe.py.channels:return[pe.uk.leave,pe.uk.share].indexOf(t.action)>=0;case pe.py.channelroster:return t.action===pe.uk.manage;case pe.py.eduteamcreate:return t.action===pe.uk.view;case pe.py.teams:return t.action===pe.uk.delete;case pe.py.channelnotificationsettings:{const{enableChannelNotificationSettingsInT21:i}=e.get(b.J.Activity);return!i&&t.action===pe.uk.view}case pe.py.channelconnectors:{const{enableChannelConnectorV2:i}=e.get(b.J.TeamsAndChannels);return!i&&t.action===pe.uk.view}case pe.py.channelworkflows:{const{legacyChannelConnectorsToWorkflows:i}=e.get(b.J.TeamsAndChannels);return!i&&t.action===pe.uk.view}case pe.py.crosspostchannelselectiondialog:return t.action===pe.uk.view}return[pe.py.addchannel,pe.py.addmember,pe.py.addmembernewteam,pe.py.broadcastliveevent,pe.py.channeldeeplink,pe.py.channeldelete,pe.py.channeledit,pe.py.channelemail,pe.py.channelmoderators,pe.py.showChannelOwners,pe.py.restorechannel,pe.py.teamarchive,pe.py.teamcreate,pe.py.teamdeeplink,pe.py.teamedit,pe.py.teamjoincode,pe.py.teamleave,pe.py.teampicture,pe.py.teamrenewal,pe.py.teamrestore,pe.py.sharedchannelacceptinvitation,pe.py.sharedchanneldeclineinvitation,pe.py.showformemberdialog,pe.py.stopsharingchannelwithteam].indexOf(t.type)>=0}function Df(e){return e&&e.type===pe.py.chats}function Ff(e){const t=!(!e||e.type!==pe.py.extensions||e.id!==ve.oz.organization);if(t&&!(null==e?void 0:e.linkedEntity))throw(0,se.Tr)(f.w5.Commanding,f.jK.Undefined,"CommandChangeNotification",void 0,"Org chart entity defined without a linked entity. Cannot notify host of route change.");return t}function Of(e){return e.type===pe.py.settingsstore&&e.id===ve.oz.privacyManageVisibility}function Mf(e){const t=!(!e||e.type!==pe.py.extensions||e.id!==pe.py.linkedin);if(t&&!(null==e?void 0:e.linkedEntity))throw(0,se.Tr)(f.w5.Commanding,f.jK.Undefined,"CommandChangeNotification",void 0,"LinkedIn entity defined without a linked entity. Cannot notify host of route change.");return t}function Rf(e,t){var i;if(e&&e.type===pe.py.extensions&&e.action===pe.uk.view&&(null===(i=e.linkedEntity)||void 0===i?void 0:i.type)===pe.py.chats){let i;try{(null==e?void 0:e.id)&&(i=JSON.parse(e.id||"").appId)}catch(e){t.warn("isConsumerTasksChatTab, failed to parse appId")}return!(i!==Zv)}return!1}function Pf(e){return(null==e?void 0:e.type)===pe.py.transcripttab}function Lf(e){return(null==e?void 0:e.type)===pe.py.meetingrecaptab}function Uf(e){return!(!e||e.type!==pe.py.platformapps||e.action!==pe.uk.list)}function Wf(e){const t=!(!e||e.type!==pe.py.platformStage||e.action!==pe.uk.view),i=!(!e||e.type!==pe.py.platformTabGallery);return t||i}function Bf(e){return!(!e||e.type!==pe.py.platformapps||e.action!==pe.uk.manage)}function $f(e){return!(!e||(e.type!==pe.py.file||e.action!==pe.uk.view&&e.action!==pe.uk.update)&&e.type!==pe.py.fileopensettings)}function Hf(e){return!(!e||e.type!==pe.py.channels||!e.id)}function qf(e){return!(!e||e.type!==pe.py.schedulingform||e.action!==pe.uk.create)}function zf(e){return!(!e||e.type!==pe.py.schedulingform||e.action!==pe.uk.view)}function Vf(e){return!(!e||e.type!==pe.py.calendar)}function Gf(e){return!(!e||e.type!==pe.py.brbfeedbackdialog)}function Jf(e){return!(!e||e.type!==pe.py.open3sfeedback)}function Kf(e){return!(!e||e.type!==pe.py.livepersonacard)}function Qf(e){return!(!e||e.type!==pe.py.taskmodule)}function Yf(e){return!(!e||e.type!==pe.py.hwctaskmodule)}function Xf(e){return!(!e||e.type!==pe.py.settingsdialog)}function Zf(e){return!(!e||e.type!==pe.py.accounts)}function eS(e){return!(!e||e.type!==pe.py.platformapp||e.action!==pe.uk.info)}function tS(e){return!(!e||e.type!==pe.py.platformappdetails||e.action!==pe.uk.config&&e.action!==pe.uk.update)}function iS(e){return!(!e||e.type!==pe.py.incontextstore||e.action!==pe.uk.config&&e.action!==pe.uk.update)}function nS(e){return!(!e||e.type!==pe.py.platformapp||e.action!==pe.uk.view)}function oS(e){return!(!e||e.type!==pe.py.platformsubscriptionplans||e.action!==pe.uk.info)}function rS(e){return!(!e||e.type!==pe.py.workflows||e.action!==pe.uk.create)}function sS(e){return!(!e||e.type!==pe.py.workflows||e.action!==pe.uk.manage)}function aS(e){return!(!e||e.type!==pe.py.customapp||e.action!==pe.uk.create)}function lS(e,t,{entity:i,stateTransition:n,logger:o,window:r,correlation:s,commandChangeReportingService:a,entityOptions:l}){var c,d;if(!r.blockingEntityExtension)throw(0,se.Tr)(f.w5.Commanding,f.jK.Undefined,"executeEntityCommand",r.correlation,"Unable to resolve blockingEntityExtension");const u={activeEntities:t,windowHistory:[...r.windowHistory],currentWindowHistoryIndex:r.windowHistory.length-1,layoutMode:r.layoutConfig.layoutMode,userContextId:r.userContextId,windowId:r.id};o.log("Blocking command transition due to blockingEntityExtension");const m=yy();u.activeEntities=Object.assign(Object.assign({},t),{entityExtension:r.blockingEntityExtension.entity});const g=Object.assign(Object.assign({},r.blockingEntityExtension),{blockedEntity:i,blockedEntityOptions:l||null,blockedCommand:{stateTransition:n,visibilityState:e,correlation:s,__typename:"EntityCommand"}});a.report({correlationId:s.id,type:Ae.B.CommandMetaDataAdded,context:{target:"blockTransitionAndShowExtension",transitionBlockedByExtension:!0}});const h=r.windowHistoryNavigationState,p=Object.assign(Object.assign({},h),{backHistory:[...null!==(c=h.backHistory)&&void 0!==c?c:[]],forwardHistory:[...null!==(d=h.forwardHistory)&&void 0!==d?d:[]]});return Object.assign(Object.assign(Object.assign({},r),u),{correlation:s,extendedEntityContainerState:m,blockingEntityExtension:g,windowHistoryNavigationState:p})}const cS=(e,t,i)=>{const n=e.activeEntities.entityExtension;if(!n)return t.error(`Unable to create hide command for extension in the given window. The window does not have an active extension. Window ID: ${e.id}`),null;const o=fy();o.source=k.D.CoreResolvers;const r={correlation:o,stateTransition:ve.su.extend,visibilityState:ve.fe.hide};return i.report({type:Ae.B.CommandStart,correlationId:o.id,context:{target:"createAndRegisterHideExtensionCommand",entityCommand:{entity:n,command:Object.assign(Object.assign({},r),{correlation:Object.assign(Object.assign({},o),{startTimestamp:parseInt(o.startTimestamp,10)})})}}}),{entity:n,command:r}},dS=(e,t,i)=>{var n;if(cy(e)){const o=cS(e,t,i),r=null===(n=null==o?void 0:o.command.correlation)||void 0===n?void 0:n.id;r&&(t.log(`Closing external dialog, sending hide command with new correlation ${r}`),i.report({type:Ae.B.NotHandled,correlationId:r,context:{target:"sendHideExternalExtensionCommand"}}))}},uS=(e,t,i,n,o)=>{const{commandChangeReportingService:r}=o;e.extendedEntityContainerState.isExternal?(i.log(`Routing externally - closing external dialog for correlation ${n.id}`),dS(e,i,r)):(i.log(`Routing externally - closing BIM dialog from command with correlation ${n.id}`),((e,t,i,n,o)=>{cy(t)&&mf(o,i,mS(t,n),e)})(i,e,t,n,o))};function mS(e,t){const{activeEntities:i}=e;return Object.assign(Object.assign({},e),{correlation:t,extendedEntityContainerState:Object.assign(Object.assign({},e.extendedEntityContainerState),{containerState:ve.oq.Closed}),activeEntities:Object.assign(Object.assign({},i),{entityExtension:null})})}const gS="CN:",hS={Query:{},Mutation:{createNotificationsWindow:(e,t,i)=>vS(e,t,i),removeNotificationsWindow:(e,t,i)=>pS(e,t,i)}},pS=(e,t,i)=>{var n,o;const{cache:r,loggerFactory:s,activeWindowsService:a}=i,l=s.newLogger("NotificationsResolver","data-client-entity-command");try{const e=uf(r,l,a),t=e.filter((e=>!0!==e.isNotificationsWindow));if(t.length===e.length)return l.log(`${gS}Cannot remove notifications window as it does not exist.`),!0;const o=mf(i,t,void 0,l);return!1===o&&(null===(n=l.errorToTelemetry)||void 0===n||n.call(l,`${gS}Error updating windows cache after deleting notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0)),o}catch(e){return null===(o=l.errorToTelemetry)||void 0===o||o.call(l,`${gS}Error occured trying to delete notifications window: ${e.message}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),!1}},vS=(e,t,i)=>{var n,o;const{cache:r,loggerFactory:s,activeWindowsService:a}=i,l=s.newLogger("NotificationsResolver","data-client-entity-command");try{const e=uf(r,l,a),t=e.find((e=>!0===e.isNotificationsWindow));if(t)return l.log(`${gS}Notifications window has already been created. windowId: ${t.id}`),!0;const o=pf(e,ve.lO.standard),s=Object.assign(Object.assign({},fy()),{__typename:"Correlation",clientLaunchId:o?o.correlation.clientLaunchId:(0,xe.v4)()}),c=mf(i,e,fS(s,null),l,s.id);return!1===c&&(null===(n=l.errorToTelemetry)||void 0===n||n.call(l,`${gS}Error updating windows cache with newly created notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0)),c}catch(e){return null===(o=l.errorToTelemetry)||void 0===o||o.call(l,`${gS}Error occured trying to create notifications window: ${e.message}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),!1}},yS=({activeWindows:e,context:t,command:i,correlation:n,entity:o,entityOptions:r,logger:s,notificationsHandler:a,newEntity:l})=>{var c,d,u,m;const g=((e,t)=>{var i;let n;try{e&&(n=JSON.parse(e))}catch(e){null===(i=t.errorToTelemetry)||void 0===i||i.call(t,`${gS}Ignoring error while parsing entity options for toasts.`,"webclient_framework_foundation_resolvers_notifications",void 0,!0)}return n})(r,s),h=(null==g?void 0:g.targetEntity.id)||i.correlation.id;s.log(`${gS}${h}Received entity command to render notification. correlationId:${i.correlation.id} tartetEntityType:${null==g?void 0:g.targetEntity.type} actionType:${null==g?void 0:g.targetEntity.dataOptions.actionType} visibility:${i.visibilityState} isIncomingCall:${null==g?void 0:g.isIncomingCall} callId: ${null==g?void 0:g.callId} userContextId: ${null===(d=null===(c=null==g?void 0:g.targetEntity)||void 0===c?void 0:c.dataOptions)||void 0===d?void 0:d.userContextId}`);const{callId:p,crossClientScenarioName:v}=g||{};if(a.sendTelemetry({callId:p,toastScenarioClientId:n.id,callingScenarioName:v,stepName:U.ck.CommandResolutionStarted}),a.isInAppNotificationsEnabled(g))return((e,t,i,n,o,r,s)=>{var a,l;const c=Sf(e,f.ew);if(!c)return null===(a=s.errorToTelemetry)||void 0===a||a.call(s,`${gS}Error occured trying to execute notifications command, targetWindow is not found`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),null;let d=!1,u=!1;return o.action===pe.uk.view&&("hide"===t.visibilityState&&(null===(l=c.activeEntities.inAppNotificationsEntity)||void 0===l?void 0:l.type)===o.type?(c.activeEntities=Object.assign(Object.assign({},c.activeEntities),{inAppNotificationsEntity:null}),u=!0):"show"===t.visibilityState&&(c.activeEntities=Object.assign(Object.assign({},c.activeEntities),{inAppNotificationsEntity:{id:o.id||n.id,action:o.action,type:o.type,entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"},linkedEntity:null,options:r||null,windowOptions:null,__typename:"Entity"}}),u=!0)),d=u&&mf(i,e,c,s),d&&cy(c)?c:null})(e,i,t,n,o,r,s);{const{enableInAppNotifications:e,enableBrowserToasts:i}=t.coreSettings.get(b.J.Notifications);if(e||i)return a.sendTelemetry({toastScenarioClientId:n.id,stepName:U.ck.ToastRenderCancelled,reason:`in app notifications disabled for: ${o.type}`}),null}if(!a.isCustomNotificationsEnabled(g))return function(e,t,i,n,o,r){var s;const a=!!n.coreSettings.get(b.J.Core).enableCommandToHostCommService;return a&&o.sendCommandToHost(e,t,i,r,null===(s=n.vdiServiceProvider)||void 0===s?void 0:s.provide()),null}(i,n.id,o,t,a,g);let y;const S=e.findIndex((e=>!0===e.isNotificationsWindow));-1===S?(null===(u=s.warnToTelemetry)||void 0===u||u.call(s,`${gS}${h}Notifications window does not exist to display this notification. Creating a new one now...`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),a.sendTelemetry({callId:p,toastScenarioClientId:n.id,callingScenarioName:v,stepName:U.ck.RecreatingNotificationsWindow}),y=fS(n,null)):(y=e[S],a.sendTelemetry({callId:p,toastScenarioClientId:n.id,callingScenarioName:v,stepName:U.ck.NotificationsWindowFound})),l.id=(0,xe.v4)(),((e,t)=>{t.activeEntities.mainEntity=e})(l,y);return!1===mf(t,e,y,s,n.id)?(null===(m=s.errorToTelemetry)||void 0===m||m.call(s,`${gS}${h}Error updating the active windows cache with notifications window. correlationId:${n.id}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),a.sendTelemetry({callId:p,toastScenarioClientId:n.id,callingScenarioName:v,stepName:U.ck.FailedToUpdateWindowsCache}),null):(a.sendTelemetry({callId:p,toastScenarioClientId:n.id,callingScenarioName:v,stepName:U.ck.CommandResolved}),y)};function fS(e,t){const i={__typename:"Entity",id:null,type:pe.py.toasts,action:pe.uk.view,options:null,windowOptions:null,linkedEntity:null,entityState:{__typename:"EntityState",flushableByLinkedEntity:!0}};return{__typename:"Window",id:(0,xe.v4)(),windowOptions:null,windowHistory:[],currentWindowHistoryIndex:0,windowHistoryNavigationState:{__typename:"WindowHistoryNavigationState",canNavigateBack:!1,canNavigateForward:!1,backHistory:[],forwardHistory:[]},correlation:Object.assign(Object.assign({},e),{__typename:"Correlation"}),extendedEntityContainerState:yy(),blockingEntityExtension:null,isMainWindow:!1,isNotificationsWindow:!0,isInitialWindowStateHidden:!1,userContextId:t,layoutConfig:{__typename:"LayoutConfig",layoutMode:ve.lO.minimal,isFullscreen:!1,slots:{__typename:"SlotsLayoutConfig",contextualNotifications:null,end:null,header:null,main:{__typename:"SlotLayoutConfig",height:null,isHidden:!1,width:null},nav:null,notifications:null,inAppNotifications:null,start:null,subNav:null,titleBar:null,toasts:null,monitor:null}},activeEntities:{__typename:"ActiveEntities",mainEntity:i,subNavEntity:null,headerEntity:null,startEntity:null,endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}}}const SS="webclient_framework_foundation_core_services_entity_commanding";function kS(e,t,i,n,o){let r;const{windowHistory:s,activeEntities:a}=e;let l=s;const{appsRegistryService:c,coreSettings:d}=i,{enableOpenerHandleFlow:u}=d.get(b.J.Core),m=s.slice().reverse().find((e=>{return t=a,i=e.activeEntities,n=Uy(t),o=Uy(i),!(n.type===o.type&&n.action===o.action);var t,i,n,o}));if(m){r=m.activeEntities,o.log(`Found app switch in window history ${t.id}. Switching to: `),My(r,o),jy({appsRegistryService:c,currentWindowId:e.id,newReactiveValues:m.reactiveVars});const n={activeEntities:a,windowHistory:s,currentWindowHistoryIndex:e.currentWindowHistoryIndex,layoutMode:e.layoutConfig.layoutMode,userContextId:e.userContextId,windowId:e.id};(!u||r.mainEntity.type!==pe.py.blank)&&([l]=lf({context:i,isUserContextSwitch:!1,logger:o,newActiveEntities:r,windowContentState:n}))}else if(o.log(`No app switch found in history ${t.id}`),e.id===f.ew){const s=c.getDefaultCommand(i.coreSettings);if(s){o.log(`Using default command for main window ${t.id}`);const r=fy();return r.source=k.D.CoreResolvers,o.log(`Sending new command with correlation ${r.id}`),zS({entity:s,command:{stateTransition:"forceFlush",visibilityState:"show",correlation:r},windowId:e.id,clientLaunchId:e.correlation.clientLaunchId},i,n)||Object.assign(Object.assign({},e),{correlation:t,activeEntities:void 0})}r=ny()}else o.log(`No app switch found in child window ${e.id}, so should close ${t.id}`);return Object.assign(Object.assign({},e),{correlation:t,activeEntities:r,windowHistory:l})}function bS({commandChangeReportingService:e,correlation:t,entitiesMap:i,entity:n,logger:o,userContextId:r,window:s},a){const{id:l}=t;return o.log(`Hiding main entity and popping history - ${Fy(n)} and correlation ${l}`),e.report({correlationId:t.id,type:Ae.B.CommandMetaDataAdded,context:{target:"hideMainEntity",popWindowHistory:!0}}),function({window:e,entitiesMap:t,correlation:i,logger:n,userContextId:o,context:r}){let s;const{windowHistory:a,activeEntities:l}=e,{appsRegistryService:c,coreSettings:d}=r;let u=a[a.length-1];if(gy(py(l,(null==u?void 0:u.activeEntities)||null))&&(a.pop(),u=a[a.length-1]),u&&n.log("Using most recent item in history: "),u&&My(u.activeEntities,n),u){if(ff(t,ly(u.activeEntities.mainEntity,o))||u.activeEntities.endEntity&&ff(t,ly(u.activeEntities.endEntity,o)))return n.log(`Active entities from history already exists in another window so emptying out current window ${e.id}`),s=void 0,c.resetAllViewState(e.id),Object.assign(Object.assign({},e),{correlation:i,activeEntities:s});s=Qy(r,u.activeEntities,e.layoutConfig.layoutMode,n,l),jy({appsRegistryService:c,currentWindowId:e.id,newReactiveValues:u.reactiveVars}),of(e,n,void 0,d)}else e.id===f.ew&&(n.log("No window history in main to pop so setting window to blank"),s=ny(),c.resetAllViewState(e.id));return n.log(`Popping window history, window history length: ${a.length}`),Object.assign(Object.assign({},e),{correlation:i,activeEntities:s})}({window:s,entitiesMap:i,correlation:t,logger:o,userContextId:r,context:a})}function wS({activeEntities:e,correlation:t,entity:i,logger:n,window:o}){const r=o;return oy(e.startEntity,i)?(n.log(`Hiding start entity - ${Fy(i)} and correlation ${t.id}`),Object.assign(Object.assign({},r),{activeEntities:Object.assign(Object.assign({},e),{startEntity:null}),correlation:t})):oy(e.endEntity,i)?(n.log(`Hiding end entity - ${Fy(i)} and correlation ${t.id}`),Object.assign(Object.assign({},r),{activeEntities:Object.assign(Object.assign({},e),{endEntity:null}),correlation:t})):void 0}function CS(e,t,i){var{commandChangeReportingService:n,correlation:r,enableMultiSlotHide:s,entitiesMap:a,entity:l,logger:c,stateTransition:d,window:u}=e,m=(0,o.__rest)(e,["commandChangeReportingService","correlation","enableMultiSlotHide","entitiesMap","entity","logger","stateTransition","window"]);if(cy(u)){const{activeEntities:e}=u;if(u.blockingEntityExtension&&"extend"!==d)return lS("hide",e,Object.assign({commandChangeReportingService:n,correlation:r,enableMultiSlotHide:s,entitiesMap:a,entity:l,logger:c,stateTransition:d,window:u},m));if("forceFlush"===d&&ry(l,e))return function({commandChangeReportingService:e,correlation:t,logger:i,window:n},o,r){const{id:s}=t;if(!cy(n))return n;i.log(`Closing app with correlation correlation ${s}`);const a=kS(n,t,o,r,i),l=cy(a)?Uy(a.activeEntities):void 0;return e.report({correlationId:t.id,type:Ae.B.CommandMetaDataAdded,context:{target:"closeApp",popWindowHistory:!1,entityDisplayedAfterHide:cy(a)?{mainEntity:a.activeEntities.mainEntity,contextEntity:l}:void 0}}),a}(Object.assign({commandChangeReportingService:n,correlation:r,enableMultiSlotHide:s,entitiesMap:a,entity:l,logger:c,stateTransition:d,window:u},m),t,i);if((!s||"flush"===d)&&oy(e.mainEntity,l))return n.report({correlationId:r.id,type:Ae.B.Hidden,context:{target:"handleHideCommandAction"}}),bS(Object.assign({commandChangeReportingService:n,correlation:r,enableMultiSlotHide:s,entitiesMap:a,entity:l,logger:c,stateTransition:d,window:u},m),t);if(!s||"none"===d){const t=wS({entity:l,logger:c,window:u,correlation:r,activeEntities:e});if(t)return n.report({correlationId:r.id,type:Ae.B.Hidden,context:{target:"handleHideCommandAction"}}),t}if(oy(e.entityExtension,l))return c.log(`Closing extended entity container with correlation ${r.id}`),mS(u,r);n.report({correlationId:r.id,type:Ae.B.Incomplete,context:{target:"handleHideCommandAction"}}),c.warn(`Hide command issued for an entity but that entity is not present - ${Fy(l)}`)}else c.warn(`Hide command issued for an entity but are no active entities - ${Fy(l)}`);return u}function _S({appViewEntities:e,commandChangeReportingService:t,coreSettings:i,correlation:n,enableMultiSlotNone:o,entity:r,executionContext:s,logger:a,userContextId:l,window:c}){var d;let u;const m={activeEntities:ES(c),windowHistory:[...c.windowHistory],currentWindowHistoryIndex:c.currentWindowHistoryIndex,layoutMode:c.layoutConfig.layoutMode,userContextId:c.userContextId,windowId:c.id},{enableMTMACommanding:g}=i.get(b.J.Core);if(g&&l!==c.userContextId)throw null===(d=a.errorToTelemetry)||void 0===d||d.call(a,"Different user context sent for toggle command",SS),new Error("Different user context sent for toggle command");if(cy(c)){const{activeEntities:i}=c,l=wS({activeEntities:i,correlation:n,entity:r,logger:a,window:c});if(l)return function({commandChangeReportingService:e,correlation:t,logger:i,newEntity:n}){e.report({correlationId:t.id,type:Ae.B.Toggled,context:{target:"logHideToggle"}}),i.log(`Toggling entity (hide) - ${Fy(n)} and correlation ${t.id}`)}({commandChangeReportingService:t,logger:a,newEntity:r,correlation:n}),l;oy(i.mainEntity,r)||(t.report({correlationId:n.id,type:Ae.B.Incomplete,context:{target:"handleToggleCommandAction"}}),a.log(`Toggling end entity (show) - ${Fy(r)} and correlation ${n.id}`),u=xS({activeEntities:i,appViewEntities:e,correlation:n,enableMultiSlotNone:o,executionContext:s,logger:a,newEntity:r,windowContentState:m}).activeEntities)}else t.report({correlationId:n.id,type:Ae.B.Incomplete,context:{target:"handleToggleCommandAction"}}),a.warn(`Toggle command only supported when active entities set - ${r}`);return Object.assign(Object.assign({},c),{correlation:n,activeEntities:u})}function TS({activeEntities:e,stateTransition:t,executionContext:i}){const n=e.mainEntity.entityState.flushableByLinkedEntity,o=!e.endEntity||e.endEntity.entityState.flushableByLinkedEntity,r=Gy({executionContext:i,viewEntityName:"mainEntity"});return"forceFlow"===t||r&&n&&"flow"===t||!r&&o&&"flow"===t}function IS({mainEntity:e,entity:t,stateTransition:i,matchedLinkedEntity:n}){const o=e.entityState.flushableByLinkedEntity;return"forceFlush"===i||o&&("flush"===i||"new"===i)||n&&t.type!==pe.py.byodchat&&t.type!==pe.py.chats&&t.type!==pe.py.devicesettings&&t.type!==pe.py.contentcamerasetup&&t.type!==pe.py.transcript&&t.type!==pe.py.meetingdetails&&t.type!==pe.py.roster&&t.type!==pe.py.byodroster&&t.type!==pe.py.breakoutroomspanel&&t.type!==pe.py.yammerqna&&t.type!==pe.py.accessibilitypanel&&t.type!==pe.py.extensions&&t.type!==pe.py.videobackgrounds&&t.type!==pe.py.roomremote&&t.type!==pe.py.videoeffectsandsettings&&t.type!==pe.py.audiosettings}function jS(e,t){const i={__typename:"Entity",action:"view",entityState:{__typename:"EntityState",flushableByLinkedEntity:!0},id:null,linkedEntity:null,type:pe.py.hybridplaceholder,options:null,windowOptions:null};return"Activity"===t||"NonHybridLeftRail"===t?i:Sy(e)}function NS({currentEntity:e,entityFromAppViewEntities:t,isExecutionContextUpstreamOfEntity:i}){const n=!e||e.entityState.flushableByLinkedEntity;return i&&n&&!!t}function ES(e){return cy(e)?e.activeEntities:void 0}function xS({activeEntities:e,appViewEntities:t,correlation:i,enableMultiSlotNone:n,executionContext:o,logger:r,newEntity:s,windowContentState:a}){return n&&t?(r.log("Using multi slot none behavior"),function({activeEntities:e,appViewEntities:t,executionContext:i,logger:n,windowContentState:o}){return t.endEntity||t.startEntity||n.warn("Attempting to show side rail slots (start or end) but appViewEntities has returned null for startEntity and endEntity"),Object.assign(Object.assign({},o),{activeEntities:Object.assign(Object.assign({},e),{startEntity:NS({currentEntity:e.startEntity,entityFromAppViewEntities:t.startEntity,isExecutionContextUpstreamOfEntity:Gy({executionContext:i,viewEntityName:"startEntity"})||Vy({executionContext:i,viewEntityName:"startEntity"})})?Sy(t.startEntity):e.startEntity,endEntity:NS({currentEntity:e.endEntity,entityFromAppViewEntities:t.endEntity,isExecutionContextUpstreamOfEntity:Gy({executionContext:i,viewEntityName:"endEntity"})||Vy({executionContext:i,viewEntityName:"endEntity"})})?Sy(t.endEntity):e.endEntity})})}({activeEntities:e,appViewEntities:t,logger:r,executionContext:o,windowContentState:a})):(r.log("Falling back to default none behavior"),function(e,t,i,n,o){return n.log(`Adding as end entity - ${Fy(i)} and correlation ${o}`),Object.assign(Object.assign({},e),{activeEntities:Object.assign(Object.assign({},t),{endEntity:i})})}(a,e,s,r,i.id))}function AS(e,t){var i,n,r,{appViewEntities:s,correlation:a,enableMultiSlotNone:l,entity:c,executionContext:d,isCurrentEntitiesInvalid:u,isInputDefaultEntity:m,logger:g,matchedLinkedEntity:h,sourceHint:p,stateTransition:v,window:y,userContextId:f}=e,S=(0,o.__rest)(e,["appViewEntities","correlation","enableMultiSlotNone","entity","executionContext","isCurrentEntitiesInvalid","isInputDefaultEntity","logger","matchedLinkedEntity","sourceHint","stateTransition","window","userContextId"]);const{coreSettings:k}=t,w=ES(y);let C=y.extendedEntityContainerState,_={activeEntities:w,windowHistory:[...y.windowHistory],currentWindowHistoryIndex:y.currentWindowHistoryIndex,layoutMode:y.layoutConfig.layoutMode,userContextId:y.userContextId,windowId:y.id};if(y.blockingEntityExtension&&w&&"extend"!==v)return lS("show",w,Object.assign({appViewEntities:s,correlation:a,enableMultiSlotNone:l,entity:c,executionContext:d,isCurrentEntitiesInvalid:u,isInputDefaultEntity:m,logger:g,matchedLinkedEntity:h,sourceHint:p,stateTransition:v,window:y,userContextId:f},S));if(!w||IS({mainEntity:w.mainEntity,entity:c,stateTransition:v,matchedLinkedEntity:h}))_=function({appViewEntities:e,context:t,correlation:i,isInputDefaultEntity:n,isCurrentEntitiesInvalid:o,logger:r,newEntity:s,sourceHint:a,userContextId:l,window:c,windowContentState:d}){var u;const{subNavEntity:m=null,headerEntity:g=null,startEntity:h=null,mainEntity:p=null,endEntity:v=null,monitorEntity:y=null,inAppNotificationsEntity:f=null}=Object.assign({},e),{coreSettings:S}=t,{activeEntities:k}=d,{action:w,type:C}=s,{enableMTMACommanding:_}=S.get(b.J.Core),T=!!_&&l!==c.userContextId;if(!T&&!o&&(("default"===w||"default"===C&&"view"===w)&&k&&C===Uy(k).type||d.activeEntities&&n))return d;const I={__typename:"ActiveEntities",subNavEntity:jS(m,a),headerEntity:Sy(g),startEntity:Sy(h),mainEntity:null!==(u=Sy(p))&&void 0!==u?u:s,endEntity:Sy(v),entityExtension:null,monitorEntity:y,inAppNotificationsEntity:f},[j,N]=lf({context:t,logger:r,windowContentState:d,newActiveEntities:I,isUserContextSwitch:T});return r.log(`Flushing window - ${Fy(s)} and correlation ${i.id}`),{activeEntities:I,windowHistory:j,currentWindowHistoryIndex:N?j.length-1:d.currentWindowHistoryIndex,layoutMode:c.layoutConfig.layoutMode,userContextId:l,windowId:c.id}}({appViewEntities:s,context:t,correlation:a,isCurrentEntitiesInvalid:u,isInputDefaultEntity:m,logger:g,newEntity:c,sourceHint:p,userContextId:f,window:y,windowContentState:_});else if(TS({activeEntities:w,stateTransition:v,executionContext:d}))_=function({activeEntities:e,appViewEntities:t,context:i,executionContext:n,logger:o,window:r,windowContentState:s}){var a;const l=Gy({executionContext:n,viewEntityName:"headerEntity"}),c=l||Gy({executionContext:n,viewEntityName:"startEntity"}),d=c||Gy({executionContext:n,viewEntityName:"mainEntity"}),u=d||Gy({executionContext:n,viewEntityName:"endEntity"});o.log(`Issuing flow command on window - headerEntity ${l}, startEntity ${c}, \n        mainEntity ${d}, endEntity ${u}`);const m=Object.assign(Object.assign({},e),{headerEntity:l?Sy(null==t?void 0:t.headerEntity):e.headerEntity,startEntity:c?Sy(null==t?void 0:t.startEntity):e.startEntity,mainEntity:d&&null!==(a=Sy(null==t?void 0:t.mainEntity))&&void 0!==a?a:e.mainEntity,endEntity:u?Sy(null==t?void 0:t.endEntity):e.endEntity}),[g]=lf({context:i,isUserContextSwitch:!1,logger:o,newActiveEntities:m,windowContentState:s});return{activeEntities:m,windowHistory:g,currentWindowHistoryIndex:g.length-1,layoutMode:r.layoutConfig.layoutMode,userContextId:r.userContextId,windowId:r.id}}({activeEntities:w,appViewEntities:s,context:t,executionContext:d,logger:g,window:y,windowContentState:_});else if(function(e,t,i){return!!e&&(oy(e.mainEntity,t)||oy(e.endEntity,t))&&"extend"!==i}(w,c,v))!function(e,t,i,n){e!==ve.su.new&&t.log(`Entity already exists in the active entities no state transition made - ${Fy(i)} and correlation ${n}`)}(v,g,c,a.id),_=function(e,t,i,n,r){const{activeEntities:s}=i;if(!s)return i;const{mainEntity:a,endEntity:l}=s,c=Object.assign({},s),{entityState:d}=n,u=(0,o.__rest)(n,["entityState"]);oy(a,n)?c.mainEntity=Object.assign(Object.assign({},a),u):l&&oy(l,n)&&(c.endEntity=Object.assign(Object.assign({},l),u));const[m]=lf({context:e,isUserContextSwitch:!1,logger:t,newActiveEntities:s,windowContentState:i});return{activeEntities:c,windowHistory:m,currentWindowHistoryIndex:m.length-1,layoutMode:r.layoutConfig.layoutMode,userContextId:r.userContextId,windowId:r.id}}(t,g,_,c,y);else if("extend"===v){const e=function({activeEntities:e,extendedEntityContainerState:t,logger:i,newEntity:n,windowContentState:o}){const r=t.containerState===ve.oq.Confirmed,s=t.containerState===ve.oq.Error,a=e.entityExtension&&t.isExternal;if("platformapp"===n.type&&"create"===n.action||"devicedetails"===n.type&&"view"===n.action||"storecartcheckout"===n.type&&"view"===n.action||"storecart"===n.type&&"view"===n.action||!e.entityExtension||r||s||a)return t=yy(),o.activeEntities=Object.assign(Object.assign({},e),{entityExtension:n}),[t,o];i.log(`Not showing extension: exists ${!!e.entityExtension}, isConfirmed ${r}, \n  hasError ${s}, hasExternalDialog ${a}`)}({activeEntities:w,extendedEntityContainerState:C,logger:g,newEntity:c,windowContentState:_});if(!e)throw new Error(`Extension already rendered, only one extension command request can be processed at a time. \n        Extension shown: ${null===(i=w.entityExtension)||void 0===i?void 0:i.type}; Extension requested: ${c.type}.`);C=e[0],_=e[1]}else _=xS({activeEntities:w,appViewEntities:s,correlation:a,enableMultiSlotNone:l,newEntity:c,executionContext:d,logger:g,windowContentState:_});if(function(e,t,i,n){const{enableMTMACommanding:o}=e.get(b.J.Core);return!(!o||t||!i||!n.userContextId||i===n.userContextId)}(k,"flush"===v||"forceFlush"===v||"extend"===v,f,y))throw new Error("Different user context sent for non-flush and non-extend command");const T=y.windowHistoryNavigationState,I=Object.assign(Object.assign({},T),{backHistory:[...null!==(n=T.backHistory)&&void 0!==n?n:[]],forwardHistory:[...null!==(r=T.forwardHistory)&&void 0!==r?r:[]]});return Object.assign(Object.assign(Object.assign({},y),_),{correlation:a,extendedEntityContainerState:C,windowHistoryNavigationState:I})}function DS(e,t,i,n){switch(e){case"hide":return CS(t,i,n);case"toggle":return _S(t);case"show":case"showWithoutFocusing":return AS(t,i)}}function FS(e,t){if(void 0!==t){const i=t?by(t):null;e.linkedEntity=i}}function OS(e,t,i,n,o){const{visibilityState:r,stateTransition:s,layoutMode:a,targetWindow:l}=e;if("hide"!==r){if(n&&"new"===s)return(0,xe.v4)();if(o&&i===f.ew||"main"===l){if(!pf(t,null!=a?a:ve.lO.standard))return(0,xe.v4)()}else if(function(e,t){return t===f.ew&&!Sf(e,f.ew)}(t,i))return f.ew}}function MS({activeWindows:e,command:t,coreSettings:i,correlation:n,entitiesMap:o,entity:r,isNewContextSupportEnabled:s,layoutMode:a,linkedEntitiesMap:l,logger:c,userContextId:d,windowId:u,webNrcEnabled:m}){const{stateTransition:g,targetWindow:h}=t,p="forceFlush"===g||"main"===h,v="flow"===g,y="extend"===g,[S,k]=!s||p||v||y?[void 0,!1]:kf(r,o,l,d,i);S&&(c.log(`Entity matched matched via linked entity ${k} for correlation ${n.id} to window`),Ry(S,c));const b=S||function({command:e,activeWindows:t,windowId:i,correlation:n,logger:o,isNewContextSupportEnabled:r,layoutMode:s,userContextId:a,webNrcEnabled:l}){const c=OS(e,t,i,r,l);return void 0!==c?(o.log(`Creating new window with id ${c} for correlation ${n.id}`),function(e,t,i,n,o,r,s){const{visibilityState:a,stateTransition:l,targetWindow:c}=o;return{__typename:"Window",id:t,windowOptions:null,windowHistory:[],currentWindowHistoryIndex:0,windowHistoryNavigationState:{__typename:"WindowHistoryNavigationState",canNavigateBack:!1,canNavigateForward:!1,backHistory:[],forwardHistory:[]},correlation:Object.assign(Object.assign({},e),{__typename:"Correlation"}),extendedEntityContainerState:yy(),blockingEntityExtension:null,isMainWindow:!s||l!==ve.su.new&&n===f.ew||"main"===c,isNotificationsWindow:!1,isInitialWindowStateHidden:a===ve.fe.showWithoutFocusing,userContextId:r,layoutConfig:{__typename:"LayoutConfig",layoutMode:null!=i?i:t===f.ew||l!==ve.su.new||"main"===c?ve.lO.standard:ve.lO.focus,isFullscreen:!1,slots:xy()}}}(n,c,s,i,e,a,r)):yf(i)||"main"===e.targetWindow?(o.log(`Retrieving mainWindow with layoutMode ${s} for correlation ${n.id}`),pf(t,null!=s?s:ve.lO.standard)):(o.log(`Retrieving window with id ${i} for correlation ${n.id}`),Sf(t,i))}({activeWindows:e,command:t,correlation:n,isNewContextSupportEnabled:s,layoutMode:a,logger:c,userContextId:d,windowId:u,webNrcEnabled:m});if(!b)throw function(e,t){var i;return null===(i=t.errorToTelemetry)||void 0===i||i.call(t,"Unable to get source window",SS,void 0,!0),(0,se.Tr)(f.w5.Commanding,f.jK.UndefinedWindowError,"CommandResolvers",e,"Unable to find applicable target window")}(n,c);return[b,k]}function RS(e,t,i,n,o){const r=ky(e),{webNrcEnabled:s}=o.get(b.J.Host),a=s?e=>e.id!==f.ew:void 0,[l,c]=ay(t,ly,a),[d]=kf(r,l,c,n,o);return d&&(i.log(`Found window for entity ${Fy(r)}`),Ry(d,i)),d||null}function PS(e,t,i,n){const o=e.activeEntities;return!!(null==o?void 0:o.entityExtension)&&(o.entityExtension=null,e.extendedEntityContainerState.containerState=ve.oq.Error,mf(t,i,e,n))}const LS=(e,t,i,n,r,s)=>{const{appsRegistryService:a,cache:l,commandChangeReportingService:c,localStorage:d,coreSettings:u,windowId:m}=i,g=(0,o.__rest)(i,["appsRegistryService","cache","commandChangeReportingService","localStorage","coreSettings","windowId"]),h=Object.assign(Object.assign({},e),{extendedEntityContainerState:Object.assign(Object.assign({},e.extendedEntityContainerState),t)}),p=e.blockingEntityExtension;h.blockingEntityExtension=null;const v=mf(i,r,h,n),y=((e,t,i)=>{const n=null==e?void 0:e.blockedEntity,o=null==e?void 0:e.blockedCommand,r=null==e?void 0:e.blockedEntityOptions;if(!n||!o)return t.warn("Unable to re-create the command which was blocked and saved."),null;const s=fy();s.source=k.D.CoreResolvers;const a={entity:n,command:Object.assign(Object.assign({},o),{correlation:s}),entityOptions:r};return i.report({type:Ae.B.CommandStart,correlationId:a.command.correlation.id,context:{target:"createAndRegisterBlockedCommandOnConfirm",entityCommand:Object.assign(Object.assign({},a),{entityOptions:r?JSON.parse(r):void 0})}}),a})(p,n,c);if(y){const{entity:e,command:t,entityOptions:i}=y;return!!zS({entity:e,command:t,entityOptions:i,windowId:m,clientLaunchId:h.correlation.clientLaunchId},Object.assign({appsRegistryService:a,cache:l,commandChangeReportingService:c,coreSettings:u,localStorage:d,windowId:m},g),s)}return v},US=({entity:e,windowId:t},i)=>{const{cache:n,loggerFactory:o,activeWindowsService:r}=i,s=o.newLogger("removeFromWindowHistory-mutation","data-client-entity-command"),a=ky(e);s.log(`Removing entity from history: ${Fy(a)}`);const l=uf(n,s,r),c=Sf(l,t);return c?((({window:e,entity:t,logger:i,context:n,activeWindows:o})=>{const{localStorage:r,coreSettings:s,appsRegistryService:a}=n;let l=0,c=!1;const d=[];e.windowHistory.forEach(((i,n)=>{ry(t,i.activeEntities)?n<e.currentWindowHistoryIndex?l++:n===e.currentWindowHistoryIndex&&(c=!0):d.push(i)}));const u=e.currentWindowHistoryIndex===e.windowHistory.length-1||c?void 0:e.currentWindowHistoryIndex-l;if(e.windowHistory=d,of(e,i,u,s),vf(o,e.id)){const{enableWindowHistoryRestorationOnStandardMain:n,enableWriteAppHistoryToLocalStorage:o,enableWriteActiveEntitiesToLocalStorage:l,enableMTMACommanding:c}=s.get(b.J.Core);if(n&&Zy(e,r,i),o&&a.appsWithAppHistoryStored.forEach((n=>{const o=Xy({localStorage:r,logger:i,appsRegistryService:a,userContextId:e.userContextId,entityType:void 0,appId:n});o&&ry(t,o)&&r.remove((0,Jy.bM)(`${Jy.av}-${n}`,e.userContextId),"Experience")})),l){const n=Yy(r,i,e.userContextId,c);n&&ry(t,n)&&r.remove((0,Jy.bM)(Jy.WD,e.userContextId),"Experience")}}})({window:c,entity:a,logger:s,context:i,activeWindows:l}),mf(i,l,c,s,void 0,void 0,!0)):(s.warn(`Could not retrieve window with id ${t}`),!1)},WS=({logger:e,appsRegistryService:t,coreSettings:i,layoutMode:n})=>{const o=t.getDefaultCommand(i,n);return o?(e.log("Default command found"),o):(e.error("No default command defined"),null)},BS=({context:e,correlation:t,logger:i,newEntity:n,shouldUseNewEntity:o,sourceWindow:r,stateTransition:s})=>{const{commandChangeReportingService:a,clientPreferences:l,appsRegistryService:c,coreSettings:d}=e,{appEntity:u,contextEntity:m}=Wy({currentEntities:cy(r)?r.activeEntities:void 0,entity:n,shouldUseNewEntity:o});t&&a.report({type:Ae.B.CommandBeforeGetAppViewEntities,context:{target:"executeEntityCommand"},correlationId:t.id});let g=null;try{g=$y({appsRegistryService:c,clientPreferences:l,contextEntity:m,coreSettings:d,entity:u,layoutMode:r.layoutConfig.layoutMode}),(({appViewEntities:e,stateTransition:t,appEntity:i,linkedEntity:n})=>t!==ve.su.none&&null===e&&i===n)({appEntity:u,appViewEntities:g,linkedEntity:n.linkedEntity,stateTransition:s})&&(i.log(`Initial getAppViewEntities for ${u} returned null`),g=$y({entity:n,clientPreferences:l,contextEntity:null,coreSettings:d,layoutMode:r.layoutConfig.layoutMode,appsRegistryService:c}))}catch(e){t&&a.report({type:Ae.B.Failure,context:{errorInfo:De.y.CommandGetAppViewEntitiesFailure,errorMessage:e.message,target:"executeEntityCommand"},correlationId:t.id})}return g},$S=({isInputDefaultEntity:e,sourceWindow:t,context:i,userContextId:n,newEntity:o,matchedLinkedEntity:r,stateTransition:s,executionContext:a,correlation:l,logger:c})=>{var d;const{localStorage:u,coreSettings:m,appsRegistryService:g,clientPreferences:h}=i,{enableWriteActiveEntitiesToLocalStorage:p,enableMTMACommanding:v,enableWriteAppHistoryToLocalStorage:y}=m.get(b.J.Core);let f=null,S=!1;e&&t.isMainWindow&&p?f=Yy(u,c,n,v):"default"===o.action&&t.isMainWindow&&y&&(f=Xy({localStorage:u,logger:c,appsRegistryService:g,userContextId:n,entityType:o.type}));const k=cy(t)?t.activeEntities:void 0;if(f){c.log("Got appViewEntities from local storage history: "),Ly(f,c);const e=JS(f,g),i=JS(k,g),n=null===(d=null==e?void 0:e.onBeforeNavigationFromHistory)||void 0===d?void 0:d.call(e,f,{coreSettings:m,layoutMode:t.layoutConfig.layoutMode,userPreferences:By(h)},(null==i?void 0:i.manifest.id)===(null==e?void 0:e.manifest.id)?k:void 0);S=!!n,S&&(c.log("App declared history invalid. New set of entities:"),Ly(n,c)),f=n||f}else{const e=(({currentEntities:e,newEntity:t,matchedLinkedEntity:i,stateTransition:n,executionContext:o})=>!e||IS({entity:t,mainEntity:e.mainEntity,matchedLinkedEntity:i,stateTransition:n})||TS({activeEntities:e,stateTransition:n,executionContext:o}))({currentEntities:k,newEntity:o,matchedLinkedEntity:r,stateTransition:s,executionContext:a});c.log(`Should use entity from command input for getAppViewEntities ${e} `),f=BS({context:i,correlation:l,logger:c,newEntity:o,shouldUseNewEntity:e,sourceWindow:t,stateTransition:s})}return{appViewEntities:f,isCurrentEntitiesInvalid:S}},HS=({context:e,correlation:t,logger:i,newEntity:n,pubsub:o,sourceWindow:r,stateTransition:s,userContextId:a})=>{i.log(`Targeting main window, but userContextId of command ${a} does not match main window user ${r.userContextId}`);const{coreSettings:l,appsRegistryService:c}=e,d=(({appsRegistryService:e,coreSettings:t,newEntity:i,stateTransition:n})=>{var o,r,s;let a=!1;return"flush"===n&&(a=(null===(s=null===(o=e.getApp({entityType:i.type}))||void 0===o?void 0:(r=o.manifest).getAllowUserWindowingPreference)||void 0===s?void 0:s.call(r,{coreSettings:t,entity:i}))||!1),a})({appsRegistryService:c,coreSettings:l,newEntity:n,stateTransition:s});return i.log(`allowUserWindowingPreference: ${d}`),d?(i.log("Popping out"),zS({entity:n,command:{stateTransition:"new",visibilityState:"show",correlation:t},windowId:r.id,clientLaunchId:r.correlation.clientLaunchId,executionContext:{userContextId:a},entityOptions:n.options},e,o),null):(({correlation:e,sourceWindow:t,logger:i,context:n,pubsub:o,userContextId:r,newEntity:s})=>{i.log("Launching switch account dialog");const{authenticationService:a}=n;return r?(a.getUser({accountId:r,correlation:e}).then((a=>(i.log(`Got user from auth service ${a.id}`),zS({entity:{type:"switchaccountdialog",action:"view"},command:{stateTransition:"extend",visibilityState:"show",correlation:e},entityOptions:JSON.stringify({originalCorrelation:e,originalEntity:s,userContextId:r,userName:a.userName}),windowId:t.id,clientLaunchId:t.correlation.clientLaunchId},n,o)))).catch((e=>{var t;null===(t=i.errorToTelemetry)||void 0===t||t.call(i,"Unable to getUser from auth",SS,void 0,!0)})),null):(i.log("UserContextId is undefined so unable to launch switch account dialog"),null)})({correlation:t,sourceWindow:r,logger:i,context:e,pubsub:o,userContextId:a,newEntity:n})},qS=({command:e,context:t,correlation:i,entitiesMap:n,entityOptions:o,executionContext:r,logger:s,matchedLinkedEntity:a,pubsub:l,sourceHint:c,sourceWindow:d,userContextId:u,windowOptions:m,newEntity:g})=>{const{coreSettings:h,commandChangeReportingService:p}=t,{enableEmptyWindowDialogForDeeplink:v}=h.get(b.J.Core),{stateTransition:y,targetWindow:f}=e;if("extend"===y){if("extend"===y&&v&&(!cy(d)||null===d.userContextId&&null!=u)&&d.isMainWindow){const e=(({context:e,correlation:t,entitiesMap:i,entityOptions:n,executionContext:o,logger:r,matchedLinkedEntity:s,pubsub:a,sourceHint:l,sourceWindow:c,userContextId:d,windowOptions:u})=>{const{authenticationUser:m,coreSettings:g,appsRegistryService:h,commandChangeReportingService:p,clientPreferences:v,windowProvider:y}=e,{enableMultiSlotHide:f,enableMultiSlotNone:S}=g.get(b.J.Core);if((null==m?void 0:m.role)===Es.w4.Anonymous){const e=De.y.EmptyWindowError;return r.log(`Anonymous user - extension command error ${e}`),p.report({correlationId:t.id,type:Ae.B.Incomplete,context:{errorInfo:e,target:"executeEntityCommand"}}),null}r.log("Extension command - creating main window");const k=WS({logger:r,appsRegistryService:h,coreSettings:g,layoutMode:c.layoutConfig.layoutMode});if(!k)throw new Error("No default entity. Unable to show extension");const w=ky(k,n,u),{appViewEntities:C,isCurrentEntitiesInvalid:_}=$S({isInputDefaultEntity:!0,sourceWindow:c,context:e,userContextId:d,newEntity:w,matchedLinkedEntity:!1,stateTransition:"flush",executionContext:o,correlation:t,logger:r});return r.log(`Extension command - flushing with entity ${Fy(w)}`),Ly(C,r),c=DS("show",{appsRegistryService:h,appViewEntities:C||void 0,clientPreferences:v,commandChangeReportingService:p,correlation:t,coreSettings:g,enableMultiSlotHide:f,enableMultiSlotNone:S,entitiesMap:i,entity:w,entityOptions:n,executionContext:o,host:y,isCurrentEntitiesInvalid:_,isInputDefaultEntity:!0,logger:r,matchedLinkedEntity:s,sourceHint:l,stateTransition:"flush",userContextId:d,window:c},e,a),r.log("Extension command - created source window"),Ry(c,r),c})({context:t,correlation:i,entitiesMap:n,entityOptions:o,executionContext:r,logger:s,matchedLinkedEntity:a,pubsub:l,sourceHint:c,sourceWindow:d,userContextId:u,windowOptions:m});if(!e)return null;if(!cy(d=e))return s.log("Tried creating main window for dialog but window is empty"),p.report({correlationId:i.id,type:Ae.B.Incomplete,context:{errorInfo:De.y.EmptyWindowError,target:"executeEntityCommand"}}),null}if(!(S=g,"switchaccountdialog"===S.type&&"view"===S.action||d.userContextId===u||null===d.userContextId))return s.log("User context of source window does not match user context of command. Rejecting command"),p.report({correlationId:i.id,type:Ae.B.Incomplete,context:{errorInfo:De.y.UserContextMismatch,target:"executeEntityCommand"}}),null}else if((({sourceWindow:e,stateTransition:t,targetWindowType:i,userContextId:n})=>"main"===i&&("forceFlush"===t||"flush"===t)&&e.userContextId!==n)({sourceWindow:d,stateTransition:y,targetWindowType:f,userContextId:u}))return HS({context:t,correlation:i,logger:s,newEntity:g,pubsub:l,sourceWindow:d,stateTransition:y,userContextId:u});var S;return d},zS=({clientLaunchId:e,command:t,entity:i,entityOptions:n,executionContext:o,windowId:r,windowOptions:s},a,l)=>{var c,d,u,m,g,h,p,v;const{appsRegistryService:y,authenticationUser:S,cache:k,clientPreferences:w,commandChangeReportingService:C,coreSettings:_,experienceChangeReportingService:T,loggerFactory:I,notificationsHandler:j,windowProvider:N,scenarioFactory:E,activeWindowsService:x}=a,A=I.newLogger("executeEntityCommand-mutation","data-client-entity-command"),{visibilityState:D,stateTransition:F,correlation:O,layoutMode:M}=t;try{const v=r||f.ew,I=((e,t)=>t?Object.assign(Object.assign({},t),{clientLaunchId:null!=e?e:null,__typename:"Correlation"}):Object.assign(Object.assign({},fy()),{clientLaunchId:null!=e?e:null,__typename:"Correlation"}))(null!=e?e:null,O);C.report({correlationId:I.id,type:Ae.B.CommandResolutionStarted,context:{target:"executeEntityCommand"}});const R=uf(k,A,x),[P,L]=ay(R,ly,(e=>!vf(R,e.id)&&!((e,t)=>{const i=pf(e,ve.lO.minimal);return t===(null==i?void 0:i.id)})(R,e.id)&&!((e,t)=>{const i=pf(e,ve.lO.minimode);return t===(null==i?void 0:i.id)})(R,e.id))),W=(e=>e.action===pe.uk.default&&e.type===pe.py.default)(i),B=(e=>e.action===pe.uk.view&&e.type===pe.py.default)(i),$=null==O?void 0:O.sourceHint,H=(({entity:e,isInputDefaultEntity:t,isInputDefaultViewEntity:i,logger:n,appsRegistryService:o,coreSettings:r,layoutMode:s})=>t||i?WS({logger:n,appsRegistryService:o,coreSettings:r,layoutMode:s}):e)({entity:i,isInputDefaultEntity:W,isInputDefaultViewEntity:B,logger:A,appsRegistryService:y,coreSettings:_,layoutMode:M});if(!H)return null===(c=A.errorToTelemetry)||void 0===c||c.call(A,"Unable to use entity from command input",SS,void 0,!0),null;const q=ky(H,n,s);if(function(e){return e.type===pe.py.toasts}(q))return yS({activeWindows:R,context:a,command:t,correlation:I,entity:i,entityOptions:n,logger:A,notificationsHandler:j,newEntity:q});A.log(`Command received for entity ${Fy(q)}`),A.log(`Command received :${function(e){return`{\n  visibilityState: ${e.visibilityState},\n  stateTransition: ${e.stateTransition},\n  correlation: ${Oy(e.correlation,1)},\n  layoutMode: ${e.layoutMode},\n  targetWindow: ${e.targetWindow}\n}`}(t)}`),A.log(`Command with id ${I.id} received on window context ${v}`),A.log(`Command received with execution context: ${null==o?void 0:o.viewEntityName}`),((e,t,i,n)=>{var o;const{stateTransition:r,targetWindow:s}=e,{enableCommandingMainWindowTargeting:a}=n.get(b.J.Core);if(s&&!a||"main"===s&&"extend"!==r&&"forceFlush"!==r&&"flush"!==r)throw null===(o=t.errorToTelemetry)||void 0===o||o.call(t,`Invalid command targetWindow ${s} stateTransition ${r}`,SS,void 0,!0),(0,se.Tr)(f.w5.Commanding,f.jK.InvalidInput,"CommandResolvers",i,`Invalid command ${s} stateTransition ${r}`)})(t,A,I,_);const{isNewContextSupportEnabled:z,webNrcEnabled:V}=_.get(b.J.Host),{enableMultiSlotHide:G,enableMultiSlotNone:J,enableWindowNotUpdatedEvent:K,enableMTMACommanding:Q,forceFocusLayoutMode:Y,enableWindowHistoryRestorationOnStandardMain:X}=_.get(b.J.Core),Z=pf(R,"standard"),ee=Q&&((null==o?void 0:o.userContextId)||_y(S)||"extend"===F&&Z&&Z.userContextId)||null;A.log(`isNewContextSupportEnabled ${z}, enableMultiSlotHide ${G}, enableMultiSlotNone ${J}`);const te=((e,t)=>t?ve.lO.focus:e&&(e.layoutMode||ve.lO.focus))(N.Cypress,!!Y),ie=MS({activeWindows:R,command:t,coreSettings:_,correlation:I,entitiesMap:P,entity:q,isNewContextSupportEnabled:null==z||z,layoutMode:null!=te?te:M,linkedEntitiesMap:L,logger:A,userContextId:ee,windowId:v,webNrcEnabled:null!=V&&V});let[ne]=ie;const[,oe]=ie;let re=!1;X&&ne&&!cy(ne)&&ne.isMainWindow&&"standard"===ne.layoutConfig.layoutMode&&(ne=((e,t,i,n,o)=>{var r,s;const a=t.get((0,Jy.bM)(Jy.Hs,n),"Experience");if(a)try{const l=JSON.parse(a);if(o&&n!==l.userContextId)return null===(r=i.warnToTelemetry)||void 0===r||r.call(i,"User context of window doesn't match user context of stored history","webclient_framework_foundation_core_services_entity_commanding",void 0,!0),e;const c=parseInt(l.windowHistoryIndex,10);if(isNaN(c))return null===(s=i.warnToTelemetry)||void 0===s||s.call(i,`Store window history has invalid history index. CurrentWindowHistoryIndex ${l.windowHistoryIndex}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),e;const d=t.get((0,Jy.bM)(Jy.ax,n),"Experience");if(d){const t=nf(JSON.parse(d),i);return Object.assign(Object.assign({},e),{windowHistory:t,currentWindowHistoryIndex:c})}i.warn("Could not restore history from storage")}catch(e){i.errorToTelemetry&&i.errorToTelemetry(`Could not restore main window nav history from local storage ${e.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}else i.warn("Could not restore main window nav history index from local storage. IndexAndUserFromStorage is null");return e})(ne,a.localStorage,A,ee,Q),ne.windowHistory.length>0&&(A.log("Restored main window navigation history from local storage"),re=!0));const ae=qS({command:t,context:a,correlation:I,entitiesMap:P,entityOptions:n,executionContext:o,logger:A,matchedLinkedEntity:oe,pubsub:l,sourceHint:$,sourceWindow:ne,userContextId:ee,windowOptions:s,newEntity:q});if(null===ae)return null;ne=ae;const{appViewEntities:le,isCurrentEntitiesInvalid:ce}=$S({isInputDefaultEntity:W,sourceWindow:ne,context:a,userContextId:ee,newEntity:q,matchedLinkedEntity:oe,stateTransition:F,executionContext:o,correlation:I,logger:A});if(C.report({type:Ae.B.CommandAfterGetAppViewEntitiesSucceeded,context:{target:"executeEntityCommand"},correlationId:I.id}),A.log("Final appViewEntities: "),Ly(le,A),A.log(`Before updating cache, There are ${R.length} active windows`),A.log("Source window: "),Ry(ne,A),null===le)throw null===(d=A.errorToTelemetry)||void 0===d||d.call(A,"No app supports entity command",SS,void 0,!0),new Error("no app view entities for entity input");let de=DS(D,{appsRegistryService:y,appViewEntities:le,clientPreferences:w,commandChangeReportingService:C,correlation:I,coreSettings:_,enableMultiSlotHide:G,enableMultiSlotNone:J,entitiesMap:P,entity:q,entityOptions:n,executionContext:o,host:N,isCurrentEntitiesInvalid:ce,isInputDefaultEntity:W,logger:A,matchedLinkedEntity:oe,sourceHint:$,stateTransition:F,userContextId:ee,window:ne},a,l);A.log("Target window: "),Ry(de,A),cy(ne)&&cy(de)&&(null===(u=ne.activeEntities)||void 0===u?void 0:u.monitorEntity)&&(de.activeEntities.monitorEntity=null===(m=ne.activeEntities)||void 0===m?void 0:m.monitorEntity),cy(ne)&&cy(de)&&(null===(g=ne.activeEntities)||void 0===g?void 0:g.inAppNotificationsEntity)&&t.visibilityState!==ve.fe.hide&&(de.activeEntities.inAppNotificationsEntity=null===(h=ne.activeEntities)||void 0===h?void 0:h.inAppNotificationsEntity);const ue=function(e,t){return dy(cy(e)?e.activeEntities:null,cy(t)?t.activeEntities:null)}(ne,de);!function(e,t,i,n,o,r,s){const a=(0,tr.YR)(e,i);s.log(`ViewportContext: ${a}`);const l={"Panel.WindowID":t,"Window.ViewportContext":a};o.report({correlationId:n,type:Ae.B.ScenarioEventDataAppended,context:{target:"setViewportContextOnLaunchScenarios",eventData:l}});const c=r.findScenario(U.RG.WindowLaunchTime);null==c||c.appendEventData(l)}(de.isMainWindow,de.id,de.layoutConfig.layoutMode,I.id,C,E,A),C.report({correlationId:I.id,type:Ae.B.CommandMetaDataAdded,context:{target:"executeEntityCommand",isCommandTargetedToMainWindow:de.id===f.ew,shouldNavigate:my(ne,de,F,q)}});const me=ne.id===f.ew&&"new"!==F&&"none"!==F;if(If(ue,v,me,"flow"===F||"none"===F,_,A)){A.log(`Opener will handle the requested entity change with correlationId ${I.id} and entityId ${i.id}`);let e=!0;ue.entityExtension&&(de.extendedEntityContainerState.isExternal=!0,e=mf(a,R,de,A));const t=Sf(R,f.ew);if(t&&(e=>!(!e.activeEntities.entityExtension||e.extendedEntityContainerState.containerState===ve.oq.Closed))(t)&&uS(t,R,A,I,a),e)try{return(({correlation:e,diff:t,commandChangeReportingService:i,windowId:n,logger:o,targetWindow:r,context:s,activeWindows:a})=>{var l;if(jf(e,t,i,n,o,s.coreSettings))return null;throw PS(r,s,a,o),null===(l=o.errorToTelemetry)||void 0===l||l.call(o,"Unable to update cache, opener did not handle change",SS),(0,se.Tr)(f.w5.Commanding,f.jK.UnhandledRuntimeException,"executeEntityCommand",void 0,"Unable to update cache, opener did not handle the entity change")})({correlation:I,diff:ue,commandChangeReportingService:C,windowId:v,logger:A,targetWindow:de,context:a,activeWindows:R})}catch(e){throw PS(de,a,R,A),null===(p=A.errorToTelemetry)||void 0===p||p.call(A,"Unable to update cache, errored while having opener handle change",SS,{errors:`${e.message}`}),(0,se.Tr)(f.w5.Commanding,f.jK.UnhandledRuntimeException,"executeEntityCommand",e,"Unable to update cache, opener threw an exception and did not handle the entity change")}}if(((e,t,i)=>{const n=cy(e)?e.activeEntities.entityExtension:null,o=cy(t)?t.activeEntities.entityExtension:null;return!(t.extendedEntityContainerState.containerState===ve.oq.Closed||!(n&&vy(i)||!o))})(ne,de,ue)&&(de=((e,t,i,n,o)=>{let r=e;return e.extendedEntityContainerState.isExternal?i.log(`Internal routing - closing external dialog for correlation ${o.id}`):(i.log(`Internal routing - closing internal dialog for correlation ${o.id}`),cy(e)&&(r=mS(e,o))),e.id===f.ew&&(i.log(`Internal routing - send close extension to angular for correlation ${o.id}`),dS(t,i,n)),r})(de,ne,A,C,I)),A.log(`Handling the requested entity command internally for correlation ${I.id}`),wf({pubsub:l,fromWindowId:v,isFromWindowMain:vf(R,v),sourceWindowId:ne.id,diff:ue,targetWindow:de,targetVisibilityState:D,stateTransition:F,correlation:I,logger:A}),of(de,A,re?de.currentWindowHistoryIndex:void 0,_),K&&!uy(ne,de))return C.report({correlationId:I.id,type:Ae.B.WindowNotUpdated,context:{target:"executeEntityCommand"}}),null;if(ne.correlation.id!==I.id){const e=cy(ne)?ne.activeEntities:void 0;e&&C.report({correlationId:I.id,type:Ae.B.ScenarioEventDataAppended,context:{target:"executeEntityCommand",eventData:{fromMainEntityType:e.mainEntity.type,fromMainEntityAction:e.mainEntity.action}}}),C.report({correlationId:ne.correlation.id,type:Ae.B.Abandoned,context:{target:"executeEntityCommand"}}),T.report({correlationId:I.id,type:ft.yU.ActiveEntitiesDestroyed,context:{target:"entity-command-resolver"},windowId:ne.id})}!oy(cy(de)?de.activeEntities.mainEntity:null,cy(ne)?ne.activeEntities.mainEntity:null)&&cy(ne)&&(de=Ey(de,{resetMonitor:null===ne.activeEntities.monitorEntity}));const ge=()=>{const e=function(e){const t=[];return Object.keys(e).map((i=>{const n=e[i];n&&t.push(n)})),t}(ue);e.length>0&&T.report({correlationId:I.id,type:ft.yU.ActiveEntitiesResolved,context:{target:"entity-command-resolver",entities:e},windowId:de.id}),C.report({correlationId:I.id,type:Ae.B.WindowUpdated,context:{target:"executeEntityCommand"}})},he=mf(a,R,de,A,I.id,ge);return he&&!x.enableDecoupleCommandingFromApollo&&ge(),he&&cy(de)?de:null}catch(e){throw null===(v=A.errorToTelemetry)||void 0===v||v.call(A,`Unable to execute entity command ${D} ${F} -  ${e.message}`,SS,{mainEntityType:i.type,mainEntityAction:i.action,correlationId:O.id},!0),e}},VS=(e,t,i,n)=>{var{cache:r,windowId:s,commandChangeReportingService:a}=i,l=(0,o.__rest)(i,["cache","windowId","commandChangeReportingService"]);if(!e.activeEntities.entityExtension)return!1;const c=cS(e,t,a);if(c){const{entity:t,command:i}=c;return zS({entity:t,command:i,windowId:s,clientLaunchId:e.correlation.clientLaunchId},Object.assign({cache:r,windowId:s,commandChangeReportingService:a},l),n)}return!1},GS=e=>({Query:{activeWindow(e,{windowId:t},{cache:i,coreSettings:n,loggerFactory:o,activeWindowsService:r}){const s=o.newLogger("activeWindow","data-client-entity-command"),{webNrcEnabled:a}=n.get(b.J.Host),l=t||f.ew;let c;const d=uf(i,s,r,!1);if(c=l===f.ew&&a?pf(d,"standard"):d.find((e=>e.id===l)),!c)throw new Error(`Requesting activeWindow for unknown windowId ${l}`);return c},activeWindowForEntity(e,{entity:t},{cache:i,loggerFactory:n,authenticationUser:o,coreSettings:r,activeWindowsService:s}){const a=n.newLogger("activeWindowForEntity-query","data-client-entity-command"),l=uf(i,a,s),{enableMTMACommanding:c}=r.get(b.J.Core);return RS(t,l,a,c?_y(o):null,r)},isEntityInActiveWindow(e,{entity:t,windowId:i},{cache:n,loggerFactory:o,activeWindowsService:r}){var s;const a=o.newLogger("isEntityInActiveWindow-query","data-client-entity-command"),l=Sf(uf(n,a,r),i),c=ky(t);if(a.log(`Querying window ${i} for entity: ${Fy(c)}`),!l)return null===(s=a.errorToTelemetry)||void 0===s||s.call(a,`No window found for windowId ${i}`,SS,void 0,!0),!1;const d=function(e,t){return oy(e,t.subNavEntity)||oy(e,t.headerEntity)||oy(e,t.startEntity)||oy(e,t.mainEntity)||oy(e,t.endEntity)}(c,l.activeEntities);return a.log(`entityExist: ${d}`),d}},Mutation:{navigateToWindowHistoryIndex:(e,t,i)=>(({windowId:e,windowHistoryIndex:t},i)=>{var n;const{cache:o,loggerFactory:r,activeWindowsService:s}=i,a=r.newLogger("navigateToWindowHistoryIndex-mutation","data-client-entity-command");a.log(`Navigating to windowHistoryIndex ${t} on window ${e}.`);const l=uf(o,a,s),c=Sf(l,e);if(!c)throw new Error("Could not find window.");return!(0===(null===(n=c.windowHistory)||void 0===n?void 0:n.length)||t<0||t>c.windowHistory.length-1)&&_f(c,t,a,l,i)})(t,i),performWindowHistoryNavigation:(e,t,i)=>(({windowId:e,navigationDirection:t},i)=>{var n;const{cache:o,loggerFactory:r,activeWindowsService:s}=i,a=r.newLogger("performWindowHistoryNavigation-mutation","data-client-entity-command");a.log(`Navigating ${e} with direction ${t}.`);const l=uf(o,a,s),c=Sf(l,e);if(!c)throw new Error("Could not find window.");if(0===(null===(n=c.windowHistory)||void 0===n?void 0:n.length))return!1;let d=c.currentWindowHistoryIndex;const u=e=>a.warn(`Could not navigate ${t}. Index ${e} is out of the bounds of the window history.`);if("back"===t){if(d--,d<0)return u(d),!1}else if(++d,d>c.windowHistory.length-1)return u(d),!1;return _f(c,d,a,l,i)})(t,i),pushToWindowHistory:(e,t,i)=>(({entity:e,entityOptions:t,windowId:i},n)=>{var o;const{cache:r,loggerFactory:s,activeWindowsService:a,coreSettings:l}=n,c=s.newLogger("pushToWindowHistory-mutation","data-client-entity-command"),d=ky(e,t);c.log(`Saving entity to history: ${Fy(d)}`);const u=uf(r,c,a),m=Sf(u,i);if(!m)return c.warn(`Could not retrieve window with id ${i}`),!1;const g=BS({context:n,logger:c,newEntity:d,shouldUseNewEntity:!0,sourceWindow:m,stateTransition:"flush"}),{subNavEntity:h=null,headerEntity:p=null,startEntity:v=null,mainEntity:y=null,endEntity:f=null,monitorEntity:S=null,inAppNotificationsEntity:k=null}=Object.assign({},g),b={__typename:"ActiveEntities",subNavEntity:jS(h,void 0),headerEntity:Sy(p),startEntity:Sy(v),mainEntity:null!==(o=Sy(y))&&void 0!==o?o:d,endEntity:Sy(f),entityExtension:null,monitorEntity:S,inAppNotificationsEntity:k},w={activeEntities:m.activeEntities,windowHistory:m.windowHistory,currentWindowHistoryIndex:m.currentWindowHistoryIndex,layoutMode:m.layoutConfig.layoutMode,userContextId:m.userContextId,windowId:m.id},[C]=lf({context:n,isUserContextSwitch:!1,logger:c,newActiveEntities:b,windowContentState:w,skipMoveToTop:!0,forcePush:!0});return m.windowHistory=C,of(m,c,void 0,l),mf(n,u,m,c)})(t,i),removeFromWindowHistory:(e,t,i)=>US(t,i),updateEntity(e,{entity:t,entityOptions:i,viewEntityName:n,windowId:o},r){const{cache:s,loggerFactory:a,activeWindowsService:l}=r,c=o||f.ew,d=a.newLogger("updateEntity-mutation","data-client-entity-command"),u=uf(s,d,l),m=Sf(u,c);if(!m)return d.warn("Trying to update entity in window that does not exist"),!1;if(m.userContextId&&r.authenticationUser&&m.userContextId!==_y(r.authenticationUser))return d.warn("Trying to update entity in for a different user context than currently present on the window"),!1;const g=ky(t,i);return d.log(`Updating entity with input: ${Fy(g)}`),function({entity:e,window:t,viewEntityName:i,context:n,logger:o}){var r;const{coreSettings:s}=n,a=gy(py(t.activeEntities,(null===(r=t.windowHistory[t.windowHistory.length-1])||void 0===r?void 0:r.activeEntities)||null,!0));if(t.activeEntities[i]=Object.assign(Object.assign({},t.activeEntities[i]),e),a){t.windowHistory.pop(),of(t,o,void 0,s);const e={activeEntities:t.activeEntities,windowHistory:t.windowHistory,currentWindowHistoryIndex:t.currentWindowHistoryIndex,layoutMode:t.layoutConfig.layoutMode,userContextId:t.userContextId,windowId:t.id},[i]=lf({context:n,isUserContextSwitch:!1,logger:o,newActiveEntities:t.activeEntities,windowContentState:e});t.windowHistory=i,of(t,o,void 0,s)}}({window:m,entity:g,viewEntityName:n,context:r,logger:d}),mf(r,u,m,d)},updateEntityState(e,{entity:t,entityState:i},n){const{authenticationUser:o,cache:r,coreSettings:s,loggerFactory:a,activeWindowsService:l}=n,{enableMTMACommanding:c}=s.get(b.J.Core),d=a.newLogger("updateEntityState-mutation","data-client-entity-command"),u=uf(r,d,l),m=RS(t,u,d,c?_y(o):null,s);if(!m)return d.warn("Trying to update flushable entity that does not exist"),!1;return function(e,t,i,n){const{mainEntity:o,endEntity:r}=e.activeEntities,{flushableByLinkedEntity:s,linkedEntityUpdate:a}=i;oy(o,t)?(null!=s&&(o.entityState.flushableByLinkedEntity=s),FS(o,a)):r&&oy(r,t)?(n.log("Updating entity state for end entity"),FS(r,a)):n.warn(`Updating entity state for entity the does not exist ${t}`)}(m,ky(t),i,d),mf(n,u,m,d),!0},updateExtendedEntityContainerState(t,i,n){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{cache:t,loggerFactory:o,windowId:r,windowProvider:s,activeWindowsService:a}=n,l=o.newLogger("updateExtendedEntityContainerState-mutation","data-client-entity-command"),c=uf(t,l,a),d=Sf(c,r);if(d)if(((e,t)=>{var i;return e===ve.oq.Confirmed&&(null===(i=t.blockingEntityExtension)||void 0===i?void 0:i.entity)&&oy(t.activeEntities.entityExtension,t.blockingEntityExtension.entity)})(i.containerState,d))d.id===f.ew&&s.opener.postMessage(C.W.MainWindowBlockedState,{isBlocked:"Confirmed",entity:null}),LS(d,i,n,l,c,e);else{if(i.containerState!==ve.oq.Closed)return d.extendedEntityContainerState=Object.assign(Object.assign({},d.extendedEntityContainerState),i),mf(n,c,d,l);VS(d,l,n,e)}return!1}))},executeEntityCommand:(t,i,n)=>zS(i,n,e),addBlockingExtension:(t,{entity:i,entityOptions:n,windowId:r,removeBlock:s},a)=>{var{cache:l,loggerFactory:c,windowProvider:d,activeWindowsService:u,coreSettings:m}=a,g=(0,o.__rest)(a,["cache","loggerFactory","windowProvider","activeWindowsService","coreSettings"]);const h=c.newLogger("addBlockingExtension-mutation","data-client-entity-command");h.log(`${s?"Removing":"Adding"} an entity extension blocker of type ${i.type}`);const p=uf(l,h,u),v=Sf(p,r);if(v){const t=Object.assign(Object.assign({},i),{id:i.id||null,linkedEntity:null,options:n||null,windowOptions:null,__typename:"Entity",entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"}});if(s&&v.blockingEntityExtension)return((e,t,i,n,o,r)=>{const{windowProvider:s}=r;if(!t.blockingEntityExtension||!oy(t.blockingEntityExtension.entity,e))return!1;const a=Object.assign(Object.assign({},t),{blockingEntityExtension:null}),l=mf(r,i,a,n);return a.id===f.ew&&s.opener.postMessage(C.W.MainWindowBlockedState,{isBlocked:"Unblocked",entity:null}),VS(t,n,r,o),l})(t,v,p,h,e,Object.assign({cache:l,loggerFactory:c,windowProvider:d,activeWindowsService:u,coreSettings:m},g));if(!s)return((e,t,i,n,o)=>{var r;const{windowProvider:s}=o,a={entity:e,__typename:"BlockingEntityExtension",blockedEntity:null,blockedCommand:null,blockedEntityOptions:null},l=Object.assign(Object.assign({},t),{blockingEntityExtension:a});if(l.id===f.ew)try{s.opener.postMessage(C.W.MainWindowBlockedState,{isBlocked:"Blocked",entity:a.entity,entityOptions:e.options&&JSON.parse(e.options)})}catch(e){null===(r=n.errorToTelemetry)||void 0===r||r.call(n,"Unable to parse and post addBlockingExtension to main window",SS)}return mf(o,i,l,n)})(t,v,p,h,Object.assign({cache:l,windowProvider:d,loggerFactory:c,activeWindowsService:u,coreSettings:m},g))}return!1},setWindowFullscreen:(e,{isFullscreen:t,windowId:i},n)=>{const{cache:o,loggerFactory:r,activeWindowsService:s}=n,a=r.newLogger("setWindowFullscreen-mutation","data-client-entity-command"),l=uf(o,a,s),c=Sf(l,i);if(!c)return null;let d=!1;return c.layoutConfig.isFullscreen!==t&&(c.layoutConfig.isFullscreen=t,d=mf(n,l,c,a)),d&&cy(c)?c:null},removeUserActiveWindows:(e,{userContextId:t},i)=>{const{cache:n,loggerFactory:o,activeWindowsService:r}=i,s=o.newLogger("removeUserActiveWindowsMutation-mutation","data-client-entity-command"),a=((e,t)=>e.filter((e=>e.isMainWindow||e.userContextId!==t)))(uf(n,s,r),t);return mf(i,a,void 0,s)},saveReactiveVarsToHistory(e,{windowId:t,appIds:i},n){const{cache:o,loggerFactory:r,activeWindowsService:s}=n,a=r.newLogger("saveReactiveVarsToHistory-mutation","data-client-entity-command"),l=t||f.ew,c=uf(o,a,s),d=Sf(c,l);if(!d)return a.warn("Trying to save reactive var history for window that does not exist"),!1;if(0===d.windowHistory.length)return!1;const u={activeEntities:d.activeEntities,windowHistory:d.windowHistory,currentWindowHistoryIndex:d.currentWindowHistoryIndex,layoutMode:d.layoutConfig.layoutMode,userContextId:d.userContextId||null,windowId:d.id},[m,g]=lf({appIdsForReactiveVarChange:i,context:n,isUserContextSwitch:!1,logger:a,newActiveEntities:d.activeEntities,windowContentState:u});if(!g)return a.log("Did not update history"),!1;const h=Object.assign(Object.assign({},d),{windowHistory:m});return of(h,a,void 0,n.coreSettings),mf(n,c,h,a),!0}}}),JS=(e,t)=>{if(e){const i=Uy(e);return t.getApp({entityType:i.type})}};var KS=i(790997),QS=i(331713),YS=i(593196),XS=i(748429),ZS=i(216023);const ek={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientVirtualEventsVirtualEventActionQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"virtualEventAction"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"VirtualEventAction"}},arguments:[]}]}}]},tk={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientVirtualEventsVirtualEventSchedulingFormDataQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"virtualEventSchedulingFormData"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasUnsavedChanges"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"VirtualEventSchedulingFormData"}},arguments:[]}]}}]},ik={Query:{virtualEventAction(e,t,{cache:i,loggerFactory:n}){var o,r,s;try{return null!==(r=null===(o=i.readQuery({query:ek}))||void 0===o?void 0:o.virtualEventAction)&&void 0!==r?r:null}catch(e){const t=n.newLogger("virtual-event-action","data-client-virtual-events");return null===(s=t.errorToTelemetry)||void 0===s||s.call(t,"virtualEventAction: Failed to fetch virtual event action from cache.","virtual_event_form_action"),null}},virtualEventSchedulingFormData(e,t,{cache:i,loggerFactory:n}){var o,r,s;try{return null!==(r=null===(o=i.readQuery({query:tk}))||void 0===o?void 0:o.virtualEventSchedulingFormData)&&void 0!==r?r:null}catch(e){const t=n.newLogger("virtual-event-scheduling-form-data","data-client-virtual-events");return null===(s=t.errorToTelemetry)||void 0===s||s.call(t,"virtualEventSchedulingFormData: Failed to fetch virtual event scheduling form data from cache.","virtual_event_scheduling_form_data"),null}}},Mutation:{setVirtualEventAction(e,{input:{type:t}},{cache:i,loggerFactory:n}){var o;const r=n.newLogger("set-virtual-event-action","data-client-virtual-events");try{i.writeQuery({query:ek,data:{virtualEventAction:t}})}catch(e){return null===(o=r.errorToTelemetry)||void 0===o||o.call(r,"setVirtualEventStateAction: Failed to update virtual event action task in cache.","virtual_event_form_action"),null}return t},updateVirtualEventSchedulingFormData(e,{virtualEventSchedulingFormDataInput:t},{cache:i,loggerFactory:n}){var o,r;const s=n.newLogger("update-virtual-event-scheduling-form-data","data-client-virtual-events"),a={virtualEventSchedulingFormData:{__typename:"VirtualEventSchedulingFormData",hasUnsavedChanges:null!==(o=t.hasUnsavedChanges)&&void 0!==o&&o}};try{i.writeQuery({query:tk,data:a})}catch(e){return null===(r=s.errorToTelemetry)||void 0===r||r.call(s,"updateVirtualEventSchedulingFormData: Failed to update virtual event scheduling form data in cache.","virtual_event_scheduling_form_data"),null}return a.virtualEventSchedulingFormData}}};var nk=i(69585),ok=i(71119);const rk={Mutation:{updateArchiveTeamInfo:(e,{info:t},{cache:i})=>{if(!t)throw new Error("No archiveTeamInfo received");try{const{archiveSharepointSite:e}=t,n={archiveTeamResult:{__typename:"ArchiveTeamResult",archiveSharepointSite:!!e}};return i.writeQuery({query:ok.r,data:n}),!0}catch(e){return!1}}}};class sk{constructor(){}static create(e){if(sk._clientResolvers)throw new Error("ClientResolvers are already created");return sk._clientResolvers=function(e){return(0,L.merge)((0,KS.w)(),Kv.w,Yp,Gp,(0,Jv.wf)(),function(){let e;const t=t=>n=>(r,s,a)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!e){const{broadcastClientResolvers:t}=yield Promise.all([i.e(346151),i.e(831470),i.e(675514),i.e(932135),i.e(297670),i.e(504247),i.e(791789)]).then(i.bind(i,138847));e=t()}return e[t][n](r,s,a)}));return{Query:{broadcastLayout:t("Query")("broadcastLayout"),attendeeCaptionsVisibility:t("Query")("attendeeCaptionsVisibility")},Mutation:{setBroadcastActiveSectionSource:t("Mutation")("setBroadcastActiveSectionSource"),updateBroadcastLayout:t("Mutation")("updateBroadcastLayout"),selectBroadcastSection:t("Mutation")("selectBroadcastSection"),clearBroadcastSource:t("Mutation")("clearBroadcastSource"),createDebugBroadcast:t("Mutation")("createDebugBroadcast"),updateAttendeeCaptionsVisibility:t("Mutation")("updateAttendeeCaptionsVisibility")}}}(),function(e){let t;const n=n=>r=>(s,a,l)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!t){const{clientResolvers:n}=yield Promise.all([i.e(346151),i.e(831470),i.e(675514),i.e(932135),i.e(297670),i.e(504247),i.e(791789)]).then(i.bind(i,138847));t=n(e)}return t[n][r](s,a,l)}));return{CallingIntent:{isFake:n("CallingIntent")("isFake")},CallLogParticipant:{hasDisplayName:n("CallLogParticipant")("hasDisplayName"),displayName:n("CallLogParticipant")("displayName")},Query:{whiteboardSharingSession:n("Query")("whiteboardSharingSession"),pptSharingSession:n("Query")("pptSharingSession"),bulkMoveStatus:n("Query")("bulkMoveStatus"),anonymousDisplayName:n("Query")("anonymousDisplayName"),prejoinState:n("Query")("prejoinState"),byodState:n("Query")("byodState"),callingScreenStatus:n("Query")("callingScreenStatus"),callingScreenLayout:n("Query")("callingScreenLayout"),poppedOutWindowState:n("Query")("poppedOutWindowState"),pinnedParticipantIds:n("Query")("pinnedParticipantIds"),videoScanType:n("Query")("videoScanType"),captionFontSize:n("Query")("captionFontSize"),debugVideoEffectState:n("Query")("debugVideoEffectState"),selectedBackgroundsInfo:n("Query")("selectedBackgroundsInfo"),getHardwareOutDevices:n("Query")("getHardwareOutDevices"),avatarInfo:n("Query")("avatarInfo"),selectedAvatarInfo:n("Query")("selectedAvatarInfo"),activeVideoEffects:n("Query")("activeVideoEffects"),videoEffectsCurrentInfo:n("Query")("videoEffectsCurrentInfo"),currentCallingState:n("Query")("currentCallingState"),compositorRegions:n("Query")("compositorRegions"),avatarAppAvailabilityInfo:n("Query")("avatarAppAvailabilityInfo"),myselfSettings:n("Query")("myselfSettings"),immersiveViewModeAppAvailabilityInfo:n("Query")("immersiveViewModeAppAvailabilityInfo"),debugClosedCaptionsEvent:n("Query")("debugClosedCaptionsEvent"),isCallingScreenReady:n("Query")("isCallingScreenReady"),isUbarRenderComplete:n("Query")("isUbarRenderComplete"),audioVideoFrameworkInfo:n("Query")("audioVideoFrameworkInfo")},Mutation:{acceptStreamPermissionsDebug:n("Mutation")("acceptStreamPermissionsDebug"),sendToDebugHardwareOutDevice:n("Mutation")("sendToDebugHardwareOutDevice"),stopDebugHardwareOutDevice:n("Mutation")("stopDebugHardwareOutDevice"),setDebugSpeakerVolume:n("Mutation")("setDebugSpeakerVolume"),setDebugToolVisible:n("Mutation")("setDebugToolVisible"),updateMeetingRoomLayoutToggleState:n("Mutation")("updateMeetingRoomLayoutToggleState"),updateShouldLaunchWhiteboardOnLoad:n("Mutation")("updateShouldLaunchWhiteboardOnLoad"),setDebugToolHiddenParticipantsCount:n("Mutation")("setDebugToolHiddenParticipantsCount"),setBulkMoveStatus:n("Mutation")("setBulkMoveStatus"),createDebugBreakoutRooms:n("Mutation")("createDebugBreakoutRooms"),createDebugCall:n("Mutation")("createDebugCall"),addDebugSuggestedUser:n("Mutation")("addDebugSuggestedUser"),joinDebugCallFromIntent:n("Mutation")("joinDebugCallFromIntent"),createDebugCallingIntent:n("Mutation")("createDebugCallingIntent"),createDebugConversation:n("Mutation")("createDebugConversation"),updateDebugCall:n("Mutation")("updateDebugCall"),stopDebugCall:n("Mutation")("stopDebugCall"),stopSpotlightSelfDebugCall:n("Mutation")("stopSpotlightSelfDebugCall"),updateDebugMeetingRoomRemoteSelectedLayoutChanged:n("Mutation")("updateDebugMeetingRoomRemoteSelectedLayoutChanged"),updateDebugSwapScreensButtonState:n("Mutation")("updateDebugSwapScreensButtonState"),toggleHoldDebugCall:n("Mutation")("toggleHoldDebugCall"),addDebugParticipant:n("Mutation")("addDebugParticipant"),createDebugParticipants:n("Mutation")("createDebugParticipants"),toggleDebugLocalMute:n("Mutation")("toggleDebugLocalMute"),startDebugRecording:n("Mutation")("startDebugRecording"),stopDebugRecording:n("Mutation")("stopDebugRecording"),setCallTranscriptStateDebug:n("Mutation")("setCallTranscriptStateDebug"),sendCallTranscriptEntryEventDebug:n("Mutation")("sendCallTranscriptEntryEventDebug"),sendClosedCaptionsEntryEventDebug:n("Mutation")("sendClosedCaptionsEntryEventDebug"),sendClosedCaptionsStatusEventDebug:n("Mutation")("sendClosedCaptionsStatusEventDebug"),setDebugClosedCaptionsEvent:n("Mutation")("setDebugClosedCaptionsEvent"),removeDebugParticipant:n("Mutation")("removeDebugParticipant"),toggleDebugVideo:n("Mutation")("toggleDebugVideo"),toggleDebugScreenShare:n("Mutation")("toggleDebugScreenShare"),updateDebugParticipant:n("Mutation")("updateDebugParticipant"),updateDebugPinParticipantFromOutside:n("Mutation")("updateDebugPinParticipantFromOutside"),updateDebugCortanaToggleButton:n("Mutation")("updateDebugCortanaToggleButton"),updateDebugContentCameraSharing:n("Mutation")("updateDebugContentCameraSharing"),toggleDebugMuteSpeaker:n("Mutation")("toggleDebugMuteSpeaker"),updateDebugContentCameraState:n("Mutation")("updateDebugContentCameraState"),triggerDebugCallingScreenGalleryTypeChange:n("Mutation")("triggerDebugCallingScreenGalleryTypeChange"),toggleVoiceLevel:n("Mutation")("toggleVoiceLevel"),setDebugDevicesList:n("Mutation")("setDebugDevicesList"),setDebugCallingQualityFeedback:n("Mutation")("setDebugCallingQualityFeedback"),setAnonymousDisplayName:n("Mutation")("setAnonymousDisplayName"),setPrejoinState:n("Mutation")("setPrejoinState"),triggerSubscribedCallChangedDebugEvent:n("Mutation")("triggerSubscribedCallChangedDebugEvent"),updateMeetingBrandingInfoCache:n("Mutation")("updateMeetingBrandingInfoCache"),setAcceptStreamPermissionsDebugResponse:n("Mutation")("setAcceptStreamPermissionsDebugResponse"),setStreamPermissionsDebugAcknowledged:n("Mutation")("setStreamPermissionsDebugAcknowledged"),setStreamPermissionsDebugAcknowledgedRequired:n("Mutation")("setStreamPermissionsDebugAcknowledgedRequired"),setByodState:n("Mutation")("setByodState"),setCallingScreenStatus:n("Mutation")("setCallingScreenStatus"),setCallingScreenLayout:n("Mutation")("setCallingScreenLayout"),setIsCallingScreenReady:n("Mutation")("setIsCallingScreenReady"),setPoppedOutWindowState:n("Mutation")("setPoppedOutWindowState"),setUbarRenderComplete:n("Mutation")("setUbarRenderComplete"),setPinnedParticipantIds:n("Mutation")("setPinnedParticipantIds"),updateMyselfSettings:n("Mutation")("updateMyselfSettings"),setVideoScanType:n("Mutation")("setVideoScanType"),updateCaptionFontSize:n("Mutation")("updateCaptionFontSize"),setDebugDeviceBlurringCapability:n("Mutation")("setDebugDeviceBlurringCapability"),setDebugVideoBackgroundImages:n("Mutation")("setDebugVideoBackgroundImages"),triggerBluetoothStateChangedDebugEvent:n("Mutation")("triggerBluetoothStateChangedDebugEvent"),triggerRaiseHandStateChangedEvent:n("Mutation")("triggerRaiseHandStateChangedEvent"),toggleDebugVideoEffect:n("Mutation")("toggleDebugVideoEffect"),updateMeetingLockDebug:n("Mutation")("updateMeetingLockDebug"),updateSelectedBackgroundsInfo:n("Mutation")("updateSelectedBackgroundsInfo"),setShouldReloadVideoApp:n("Mutation")("setShouldReloadVideoApp"),setShouldShowVideoApp:n("Mutation")("setShouldShowVideoApp"),setShouldShowVideoEffectsPreview:n("Mutation")("setShouldShowVideoEffectsPreview"),setShouldKeepPreviewWindowInSidePanelOpen:n("Mutation")("setShouldKeepPreviewWindowInSidePanelOpen"),setVideoAppPostMessageEvent:n("Mutation")("setVideoAppPostMessageEvent"),setAvatarAppPostMessageEvent:n("Mutation")("setAvatarAppPostMessageEvent"),setVideoNotification:n("Mutation")("setVideoNotification"),setAvatarErrorNotification:n("Mutation")("setAvatarErrorNotification"),setAvatarQuickPickerErrorNotification:n("Mutation")("setAvatarQuickPickerErrorNotification"),setShouldSetAvatarRendererTimeout:n("Mutation")("setShouldSetAvatarRendererTimeout"),setIsTurningOnVideoFromPreview:n("Mutation")("setIsTurningOnVideoFromPreview"),setShouldRefreshVideoFilters:n("Mutation")("setShouldRefreshVideoFilters"),toggleParticipantPin:n("Mutation")("toggleParticipantPin"),setScaling:n("Mutation")("setScaling"),scalingModeUpdated:n("Mutation")("scalingModeUpdated"),updateAvatarInfo:n("Mutation")("updateAvatarInfo"),updateSelectedAvatarInfo:n("Mutation")("updateSelectedAvatarInfo"),setLastSelectedCameraId:n("Mutation")("setLastSelectedCameraId"),setIsAvatarAppLoaded:n("Mutation")("setIsAvatarAppLoaded"),updateActiveVideoEffects:n("Mutation")("updateActiveVideoEffects"),updateVideoEffectsCurrentInfo:n("Mutation")("updateVideoEffectsCurrentInfo"),meetingDebugGoLive:n("Mutation")("meetingDebugGoLive"),setDebugStageRoomOutcome:n("Mutation")("setDebugStageRoomOutcome"),setShouldShowPopupPreview:n("Mutation")("setShouldShowPopupPreview"),setShouldAvatarMenuItemSelected:n("Mutation")("setShouldAvatarMenuItemSelected"),updateCallingState:n("Mutation")("updateCallingState"),setCompositorRegion:n("Mutation")("setCompositorRegion"),removeCompositorRegion:n("Mutation")("removeCompositorRegion"),setAvatarAppAvailabilityInfo:n("Mutation")("setAvatarAppAvailabilityInfo"),setIsAvatarMRULoaded:n("Mutation")("setIsAvatarMRULoaded"),setMeetingCollab:n("Mutation")("setMeetingCollab"),setMeetingCollabData:n("Mutation")("setMeetingCollabData"),toggleMeetingCollab:n("Mutation")("toggleMeetingCollab"),stopSharingTriggeredOnStage:n("Mutation")("stopSharingTriggeredOnStage"),setImmersiveViewModeAppAvailabilityInfo:n("Mutation")("setImmersiveViewModeAppAvailabilityInfo"),updateAudioVideoFrameworkInfo:n("Mutation")("updateAudioVideoFrameworkInfo")}}}(e),QS.s,Tf,GS(e),hS,Ah,Qv.D,Yv.w,Gv,tv,Xv.s,YS.s,ZS.s,ik,XS.w,nk.s,rk)}(e),sk._clientResolvers}static get clientResolvers(){return sk._clientResolvers}}sk._clientResolvers=null;class ak extends fh{constructor(e,t,i,n,o){var r;super(e,t,i({windowId:n.windowId,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:`mtma-window-${(null===(r=null==n?void 0:n.authenticationUser)||void 0===r?void 0:r.id)||"nouser"}-${n.windowId}`,storeType:o}),n,n.windowId,o)}get relayEnvironment(){return this.parent.relayEnvironment}get parentQueries(){return Ug}get parentSubscriptions(){return Hg}get parentMutations(){return Bg}get className(){return"MTMAWindowDataClient"}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}clone(e){throw new Error("Trying to clone child instance")}}class lk extends vh{constructor(e,t,i,n,o){super(e,i,t({windowId:i.windowId||f.ew,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:"mtma-core",storeType:ih.t.mtmaCore}),i.windowId||f.ew,ih.t.mtmaCore,o),this.createApolloClient=t,this.viewSchemaClient=null,n&&(this.viewSchemaClient=n({windowId:i.windowId||f.ew,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:"mtma-core-viewSchema",storeType:ih.t.viewSchema}),this.registerClient(this.viewSchemaClient))}clone(e){return e.windowId===f.ew?new kh(this.getServices(),this.client,Object.assign(Object.assign({},this.ctx),e),this.storeType,this):new ak(this.getServices(),this,this.createApolloClient,Object.assign(Object.assign({},this.ctx),e),ih.t.mtmaWindow)}cloneForViewSchema(e){return wh(this.viewSchemaClient,"View schema must be avaliable"),new bh(this.getServices(),this.viewSchemaClient,Object.assign(Object.assign({},this.ctx),e),ih.t.viewSchema)}disposeClients(e){const t=Object.create(null,{disposeClients:{get:()=>super.disposeClients}});return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield Promise.all([t.disposeClients.call(this,e),(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){this.viewSchemaClient&&(yield this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})))()])}))}}class ck extends fh{constructor(e,t,i,n,o,r){var s;const a=`${(null===(s=n.authenticationUser)||void 0===s?void 0:s.id)||"nouser"}-${n.windowId}`;super(e,t,i({windowId:n.windowId||f.ew,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:`mtma-user-${a}`,storeType:ih.t.mtmaUser}),n,n.windowId||f.ew,ih.t.mtmaUser,r),this.createApolloClient=i,this.viewSchemaClient=null,o&&(this.viewSchemaClient=o({windowId:n.windowId||f.ew,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:`mtma-user-viewSchema-${a}`,storeType:ih.t.viewSchema}),this.registerClient(this.viewSchemaClient))}get parentQueries(){return Lg}get parentSubscriptions(){return $g}get parentMutations(){return Wg}get className(){return"MTMAUserDataClient"}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}clone(e){return new ak(this.getServices(),this,this.createApolloClient,Object.assign(Object.assign({},this.ctx),e),ih.t.mtmaWindow)}cloneForViewSchema(e){return wh(this.viewSchemaClient,"View schema must be available"),new bh(this.getServices(),this.viewSchemaClient,Object.assign(Object.assign({},this.ctx),e),ih.t.viewSchema)}disposeClients(e){const t=Object.create(null,{disposeClients:{get:()=>super.disposeClients}});return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield Promise.all([t.disposeClients.call(this,e),(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){this.viewSchemaClient&&(yield this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})))()])}))}}class dk{constructor(){this._cache=new Map,this.getOrCreateServiceInstance=(e,t)=>{let i;return this._cache.has(e)?i=this._cache.get(e):(i=t(),this._cache.set(e,i)),i},this.clear=()=>{this._cache.clear()}}}const uk=new dk,mk=uk.getOrCreateServiceInstance;var gk,hk;!function(e){e.AddressService="AddressService",e.AiInsightsFeedbackService="AiInsightsFeedbackService",e.AiInsightsSdsService="AiInsightsSdsService",e.AppBasedLinkService="AppBasedLinkService",e.AppsPlatformService="AppsPlatformService",e.AppsStoreService="AppsStoreService",e.AppSuggestionsService="AppSuggestionsService",e.AsyncMediaService="AsyncMediaService",e.AtpSafelinksService="AtpSafelinksService",e.AugloopService="AugloopService",e.SubstrateBotPlatformService="SubstrateBotPlatformService",e.ComposeAugloopService="ComposeAugloopService",e.AzureMapsService="AzureMapsService",e.BadgeCountService="BadgeCountService",e.BiometricEnrollmentService="BiometricEnrollmentService",e.BiometricFaceEnrollmentService="BiometricFaceEnrollmentService",e.BotsPlatformService="BotsPlatformService",e.BrbService="BrbService",e.BreakoutRoomMiddleTierService="BreakoutRoomMiddleTierService",e.BroadcastAttendeeService="BroadcastAttendeeService",e.BroadcastCaptionsService="BroadcastCaptionsService",e.BroadcastSignalRService="BroadcastSignalRService",e.BroadcastStreamingAttendeeService="BroadcastStreamingAttendeeService",e.CalendarService="CalendarService",e.CallBlockingService="CallBlockingService",e.CallingAnonymousDisplayNameService="CallingAnonymousDisplayNameService",e.CallingAppEventsService="CallingAppEventsService",e.CallingBannerServiceAdapter="CallingBannerServiceAdapter",e.CallingDialogServiceAdapter="CallingDialogServiceAdapter",e.CallingNotificationServiceAdapter="CallingNotificationServiceAdapter",e.CallingService="CallingService",e.CallingConversationService="CallingConversationService",e.CallRecordingService="CallRecordingService",e.ChatService="ChatService",e.ChatServiceEndpointProvider="ChatServiceEndpointProvider",e.CloudStorageFoldersService="CloudStorageFoldersService",e.CmdMeetingIntelligenceService="CmdMeetingIntelligenceService",e.CollabCloudService="CollabCloudService",e.CollabObjectService="CollabObjectService",e.CommonSubstrateService="CommonSubstrateService",e.CommunitySettingsService="CommunitySettingsService",e.ConnectedAccountsService="ConnectedAccountsService",e.ConnectedCalendarSettingsService="ConnectedCalendarSettingsService",e.ConsumerGroupsService="ConsumerGroupsService",e.CSAService="CSAService",e.DeveloperSwitchersService="DeveloperSwitchersService",e.DiscoverSurfaceFeedbackService="DiscoverSurfaceFeedbackService",e.DiscoverSurfaceService="DiscoverSurfaceService",e.DistributionListService="DistributionListService",e.DriveItemShareService="DriveItemShareService",e.DynamicsMarketingService="DynamicsMarketingService",e.DynamicsVirtualEventsService="DynamicsVirtualEventsService",e.EmoticonService="EmoticonService",e.EspService="EspService",e.ExampleService="ExampleService",e.ExternalAccountsResponseService="ExternalAccountsResponseService",e.ExternalAccountsService="ExternalAccountsService",e.ExternalCalendarEmailAddressService="ExternalCalendarEmailAddressService",e.FileDownloadManagerService="FileDownloadManagerService",e.FilesBackfillThreadPropertiesService="FilesBackfillThreadPropertiesService",e.FilesRedeemService="FilesRedeemService",e.FilesReferenceService="FilesReferenceService",e.FilesSharepointUrlService="FilesSharepointUrlService",e.FilesValidDomainsService="FilesValidDomainsService",e.FilesSiteResourceInfoService="FilesSiteResourceInfoService",e.FileUploadPreviewService="FileUploadPreviewService",e.FileUploadService="FileUploadService",e.FloodgateService="FloodgateService",e.FluidService="FluidService",e.GalleryService="GalleryService",e.GiphyService="GiphyService",e.GoogleCalendarAuthenticationService="GoogleCalendarAuthenticationService",e.GoogleContactsAuthenticationService="GoogleContactsAuthenticationService",e.GuardiansService="GuardiansService",e.HealthScenarioService="HealthScenarioService",e.ImageProxyService="ImageProxyService",e.ImmersiveReaderService="ImmersiveReaderService",e.ImpersonationDetectionService="ImpersonationDetectionService",e.ImplicitContactsService="ImplicitContactsService",e.ImportMsaContactsService="ImportMsaContactsService",e.InstantAnswersService="InstantAnswersService",e.InviteLinksService="InviteLinksService",e.ItemDeleteService="ItemDeleteService",e.ItemDetailsService="ItemDetailsService",e.ItemUploadService="ItemUploadService",e.LiveStateBroadcastService="LiveStateBroadcastService",e.LiveStreamRenderingService="LiveStreamRenderingService",e.LmsIntegrationService="LmsIntegrationService",e.LockedTeamsService="LockedTeamsService",e.LogsFilesService="LogsFilesService",e.LokiMetaPreviewService="LokiMetaPreviewService",e.LokiService="LokiService",e.ManageTenantService="ManageTenantService",e.MeetingArtifactsService="MeetingArtifactsService",e.MeetingBotService="MeetingBotService",e.MeetingIntelligenceService="MeetingIntelligenceService",e.MeetingOptionsClientDataService="MeetingOptionsClientDataService",e.MeetingOptionsService="MeetingOptionsService",e.MeetingQuestionsAndAnswersService="MeetingQuestionsAndAnswersService",e.MeetingRecapService="MeetingRecapService",e.MeetingRecapWorkingSetFilesService="MeetingRecapWorkingSetFilesService",e.MeetingRecapSwaService="MeetingRecapSwaService",e.MeetingRoomAppEventsService="MeetingRoomAppEventsService",e.MeetingTemplateService="MeetingTemplateService",e.MonetizationService="MonetizationService",e.MRUItemService="MRUItemService",e.MsaAuthenticationService="MsaAuthenticationService",e.OdcFilePreviewService="OdcFilePreviewService",e.OdsService="OdcService",e.OrganizationInfoService="OrganizationInfoService",e.OSearchService="OSearchService",e.PaymentsService="PaymentsService",e.PeoplePickerService="PeoplePickerService",e.PeopleSearchService="PeopleSearchService",e.PeopleService="PeopleService",e.PeopleTargetingService="PeopleTargetingService",e.PersonalFileDetailsService="PersonalFileDetailsService",e.PetrolService="PetrolService",e.PoliciesService="PoliciesService",e.PresenceService="PresenceService",e.ODSLProcessingEngine="ODSLProcessingEngine",e.PstnService="PstnService",e.RefreshSiteUrlService="RefreshSiteUrlService",e.ReportConcernService="ReportConcernService",e.SCISService="SCISService",e.SearchPrefetchService="SearchPrefetchService",e.SensitivityLabelPolicySettingsService="SensitivityLabelPolicySettingsService",e.SharepointRestClient="SharepointRestClient",e.SharepointShareService="SharepointShareService",e.ShareService="ShareService",e.SignalsService="SignalsService",e.SmbUserIntentService="SmbUserIntentService",e.StatefulLongPoll="StatefulLongPoll",e.StoreDevicesService="StoreDevicesService",e.StoreService="StoreService",e.StyleMyRoomService="StyleMyRoomService",e.SubstrateFilesSearchService="SubstrateFilesSearchService",e.SubstrateMeetingRecommendationsService="SubstrateMeetingRecommendationsService",e.SubstrateMeetingSearchService="SubstrateMeetingSearchService",e.SubstrateMeetingSummarySearchService="SubstrateMeetingSummarySearchService",e.SubstrateRecommendationsService="SubstrateRecommendationsService",e.SubstrateSearchService="SubstrateSearchService",e.SubstrateSuggestionsService="SubstrateSuggestionsService",e.TargetingHierarchyService="TargetingHierarchyService",e.TeamCalendarService="TeamCalendarService",e.TeamsAndChannelsService="TeamsAndChannelsService",e.TenantAnalyticsService="TenantAnalyticsService",e.TenantMembershipService="TenantMembershipService",e.TenantPrivacyProfileService="TenantPrivacyProfileService",e.TenantService="TenantService",e.TFLUserService="TFLUserService",e.ThirdPartyCalendarService="ThirdPartyCalendarService",e.ToastImageService="ToastImageService",e.TpnNoticeService="TpnNoticeService",e.TranscriptFeedbackService="TranscriptFeedbackService",e.TranscriptService="TranscriptService",e.TranscriptSettingsStoreService="TranscriptSettingsStoreService",e.TranslateService="TranslateService",e.UnifiedConsentService="UnifiedConsentService",e.UrlPreviewService="UrlPreviewService",e.UserLicenseService="UserLicenseService",e.UserProfileService="UserProfileService",e.VideoMessageCameraCommandService="VideoMessageCameraCommandService",e.VideoFileService="VideoFileService",e.VideoMessageUploadService="VideoMessageUploadService",e.VirtualEventsService="VirtualEventsService",e.MeetingSchedulingService="MeetingSchedulingService",e.VoicemailService="VoicemailService",e.WebinarService="WebinarService",e.WaffleService="WaffleService"}(gk||(gk={})),function(e){e.ExampleGlobalService="ExampleGlobalService",e.GlobalCallingService="GlobalCallingService",e.GlobalTaskbarService="GlobalTaskbarService",e.MTMAUserDataService="MTMAUserDataService",e.WebAppSwitcherService="WebAppSwitcherService"}(hk||(hk={}));const pk=(e,t)=>i=>(0,gl.mT)(e,t,i),vk=()=>Promise.all([i.e(400010),i.e(177422),i.e(718291),i.e(137706),i.e(409201),i.e(901241),i.e(29311),i.e(736096),i.e(244586),i.e(883410),i.e(816702)]).then(i.bind(i,823378)),yk=pk((()=>i.e(585108).then(i.bind(i,224833))),"services-app-based-link"),fk=pk((()=>i.e(805203).then(i.bind(i,586364))),"services-apps-platform"),Sk=pk((()=>Promise.all([i.e(923870),i.e(761944)]).then(i.bind(i,105882))),"services-store-apps"),kk=pk((()=>i.e(733885).then(i.bind(i,644763))),"services-app-suggestions"),bk=pk((()=>i.e(591494).then(i.bind(i,197612))),"services-atp-safelinks"),wk=pk((()=>i.e(771401).then(i.bind(i,83873))),"services-async-media"),Ck=pk((()=>Promise.all([i.e(518264),i.e(956795),i.e(165441)]).then(i.bind(i,454082))),"services-augloop"),_k=pk((()=>i.e(23787).then(i.bind(i,55006))),"services-substrate-bot-platform"),Tk=pk((()=>Promise.all([i.e(889330),i.e(262456),i.e(987927)]).then(i.bind(i,591949))),"services-azure-maps"),Ik=pk((()=>Promise.all([i.e(491277),i.e(156255)]).then(i.bind(i,410499))),"services-biometric-enrollment"),jk=pk((()=>i.e(820672).then(i.bind(i,316246))),"services-bots-platform"),Nk=pk((()=>i.e(340060).then(i.bind(i,66749))),"services-brb"),Ek=pk((()=>i.e(911846).then(i.bind(i,834740))),"services-breakout-rooms"),xk=pk((()=>i.e(851710).then(i.bind(i,986462))),"services-transcript"),Ak=pk((()=>i.e(819211).then(i.bind(i,32337))),"services-transcript-setting-store"),Dk=pk((()=>i.e(851710).then(i.bind(i,986462))),"services-transcript-feedback"),Fk=pk((()=>i.e(116205).then(i.bind(i,731553))),"services-ai-insights-feedback"),Ok=pk((()=>i.e(116205).then(i.bind(i,731553))),"services-ai-insights-sds"),Mk=pk((()=>i.e(512159).then(i.bind(i,958168))),"services-style-my-room"),Rk=pk((()=>i.e(363685).then(i.bind(i,440464))),"services-broadcast-attendee"),Pk=pk((()=>i.e(620188).then(i.bind(i,343588))),"services-broadcast-streaming-attendee"),Lk=pk((()=>i.e(128560).then(i.bind(i,554256))),"services-broadcast-captions"),Uk=pk((()=>Promise.all([i.e(736096),i.e(12549)]).then(i.bind(i,852547))),"services-broadcast-signalr"),Wk=pk((()=>Promise.all([i.e(137706),i.e(265938),i.e(959651),i.e(993376)]).then(i.bind(i,817146))),"services-io-calendar"),Bk=pk((()=>i.e(634692).then(i.bind(i,172038))),"services-chat-endpoint-provider"),$k=pk((()=>i.e(477209).then(i.bind(i,463321))),"services-chat"),Hk=pk((()=>i.e(477209).then(i.bind(i,463321))),"services-calling-conversation"),qk=pk((()=>i.e(976808).then(i.bind(i,864933))),"services-report-concern"),zk=(pk((()=>Promise.all([i.e(400010),i.e(177422),i.e(718291),i.e(137706),i.e(409201),i.e(901241),i.e(29311),i.e(736096),i.e(244586),i.e(883410),i.e(175925)]).then(i.bind(i,713743))),"services-calling"),pk((()=>i.e(293740).then(i.bind(i,633398))),"services-cmd-meeting-intelligence")),Vk=pk((()=>i.e(656737).then(i.bind(i,353180))),"services-collab-object"),Gk=pk((()=>i.e(458771).then(i.bind(i,669936))),"services-community-settings"),Jk=pk((()=>i.e(32034).then(i.bind(i,397692))),"services-connected-accounts"),Kk=pk((()=>i.e(900675).then(i.bind(i,875667))),"services-io-connected-calendar"),Qk=pk((()=>Promise.all([i.e(220097),i.e(158036),i.e(384977)]).then(i.bind(i,290444))),"services-store-devices"),Yk=pk((()=>i.e(500923).then(i.bind(i,848249))),"services-distribution-list"),Xk=pk((()=>i.e(805794).then(i.bind(i,615277))),"services-dynamics-marketing"),Zk=pk((()=>i.e(106652).then(i.bind(i,347756))),"services-dynamics-virtual-events"),eb=pk((()=>i.e(178832).then(i.bind(i,989186))),"services-emoticon"),tb=pk((()=>i.e(421174).then(i.bind(i,787131))),"services-esp"),ib=pk((()=>i.e(469081).then(i.bind(i,409456))),"services-external-accounts"),nb=pk((()=>i.e(235430).then(i.bind(i,17686))),"services-external-accounts-response"),ob=pk((()=>i.e(579197).then(i.bind(i,878146))),"services-external-calendar-email-address"),rb=pk((()=>i.e(203137).then(i.bind(i,771027))),"services-files"),sb=pk((()=>i.e(622121).then(i.bind(i,816677))),"services-file-upload"),ab=pk((()=>i.e(302653).then(i.bind(i,535335))),"services-file-download-manager"),lb=pk((()=>i.e(251425).then(i.bind(i,820745))),"services-fluid"),cb=pk((()=>i.e(273806).then(i.bind(i,812110))),"services-giphy"),db=pk((()=>i.e(194248).then(i.bind(i,672081))),"services-gallery"),ub=pk((()=>i.e(183483).then(i.bind(i,382559))),"services-google-calendar-authentication"),mb=pk((()=>i.e(183483).then(i.bind(i,382559))),"services-google-contacts-authentication"),gb=pk((()=>i.e(787480).then(i.bind(i,654282))),"services-image-proxy"),hb=pk((()=>i.e(142705).then(i.bind(i,433559))),"immersive-reader-service"),pb=pk((()=>i.e(670972).then(i.bind(i,476080))),"services-import-msa-contacts"),vb=pk((()=>i.e(517965).then(i.bind(i,823050))),"services-instant-answers"),yb=pk((()=>i.e(723088).then(i.bind(i,233985))),"services-invite-links"),fb=pk((()=>Promise.all([i.e(71340),i.e(335221),i.e(840651),i.e(96978)]).then(i.bind(i,990942))),"services-live-state-broadcast"),Sb=pk((()=>Promise.all([i.e(834117),i.e(901241),i.e(368621),i.e(814408)]).then(i.bind(i,856263))),"services-live-stream-renderer"),kb=pk((()=>i.e(322581).then(i.bind(i,866178))),"services-lms-integration"),bb=pk((()=>i.e(288475).then(i.bind(i,678186))),"services-tenant-analytics"),wb=pk((()=>i.e(989829).then(i.bind(i,872473))),"services-loki"),Cb=pk((()=>Promise.all([i.e(137706),i.e(926934)]).then(i.bind(i,493405))),"services-discover-surface"),_b=pk((()=>Promise.all([i.e(137706),i.e(254964)]).then(i.bind(i,813095))),"services-discover-surface-feedback"),Tb=pk((()=>i.e(103998).then(i.bind(i,52074))),"services-guardians"),Ib=pk((()=>i.e(443091).then(i.bind(i,744064))),"services-health"),jb=pk((()=>i.e(251074).then(i.bind(i,914125))),"services-locked-teams"),Nb=pk((()=>i.e(188975).then(i.bind(i,771975))),"services-logs-files"),Eb=pk((()=>i.e(202066).then(i.bind(i,963632))),"services-manage-tenant"),xb=pk((()=>i.e(345626).then(i.bind(i,688528))),"services-meeting-artifacts"),Ab=pk((()=>i.e(694945).then(i.bind(i,508605))),"services-meeting-intelligence"),Db=pk((()=>Promise.all([i.e(234707),i.e(924251)]).then(i.bind(i,518227))),"services-meeting-recap"),Fb=pk((()=>Promise.all([i.e(944014),i.e(820516)]).then(i.bind(i,377735))),"services-meeting-options"),Ob=pk((()=>i.e(649880).then(i.bind(i,800217))),"services-meeting-recap-swa"),Mb=pk((()=>i.e(259164).then(i.bind(i,549657))),"services-meeting-recap-working-set-files"),Rb=pk((()=>Promise.all([i.e(944014),i.e(88137)]).then(i.bind(i,195356))),"services-meeting-templates"),Pb=pk((()=>i.e(950104).then(i.bind(i,464808))),"services-msa-authentication"),Lb=pk((()=>i.e(716151).then(i.bind(i,153790))),"services-people"),Ub=(pk((()=>i.e(37342).then(i.bind(i,943194))),"services-viva-insights"),pk((()=>i.e(716313).then(i.bind(i,958592))),"services-people-picker")),Wb=pk((()=>i.e(454165).then(i.bind(i,423344))),"services-people-targeting"),Bb=pk((()=>i.e(350718).then(i.bind(i,266012))),"services-files-personal"),$b=pk((()=>i.e(214988).then(i.bind(i,922691))),"services-example"),Hb=pk((()=>i.e(342461).then(i.bind(i,814671))),"services-petrol"),qb=pk((()=>Promise.all([i.e(418218),i.e(794166)]).then(i.bind(i,75334))),"services-floodgate"),zb=pk((()=>i.e(343607).then(i.bind(i,673603))),"services-ods"),Vb=pk((()=>i.e(304609).then(i.bind(i,432468))),"services-policies"),Gb=pk((()=>i.e(676130).then(i.bind(i,493565))),"services-presence"),Jb=pk((()=>Promise.all([i.e(137706),i.e(23363)]).then(i.bind(i,370007))),"scis-service"),Kb=pk((()=>Promise.all([i.e(137706),i.e(293785),i.e(762498),i.e(882800),i.e(79506)]).then(i.bind(i,572693))),"services-search"),Qb=pk((()=>Promise.all([i.e(574771),i.e(172842)]).then(i.bind(i,604157))),"services-search-meeting-summary"),Yb=pk((()=>i.e(419161).then(i.bind(i,799427))),"search-substrate"),Xb=pk((()=>i.e(902078).then(i.bind(i,27351))),"services-substrate-meeting-recommendations"),Zb=pk((()=>i.e(501129).then(i.bind(i,461500))),"services-substrate-recommendations"),ew=pk((()=>i.e(899164).then(i.bind(i,490749))),"services-sharepoint-client"),tw=pk((()=>i.e(130288).then(i.bind(i,878827))),"services-sharepoint-share"),iw=pk((()=>i.e(215793).then(i.bind(i,442145))),"services-share"),nw=pk((()=>i.e(792876).then(i.bind(i,220179))),"services-signals"),ow=pk((()=>i.e(463473).then(i.bind(i,321689))),"services-smb-user-intent"),rw=pk((()=>Promise.all([i.e(220097),i.e(158036),i.e(923870),i.e(659098)]).then(i.bind(i,913181))),"services-store"),sw=pk((()=>Promise.all([i.e(293785),i.e(538431)]).then(i.bind(i,437235))),"services-suggestions"),aw=pk((()=>Promise.all([i.e(293785),i.e(734949)]).then(i.bind(i,514639))),"services-implicit-contacts"),lw=pk((()=>i.e(74801).then(i.bind(i,420087))),"services-targeting-hierarchy"),cw=pk((()=>i.e(362437).then(i.bind(i,853373))),"services-tenant-membership"),dw=pk((()=>i.e(172557).then(i.bind(i,960832))),"services-tenant-service"),uw=pk((()=>i.e(277412).then(i.bind(i,563779))),"services-third-party-calendar"),mw=pk((()=>i.e(254692).then(i.bind(i,407343))),"services-toast-image"),gw=(pk((()=>i.e(751309).then(i.bind(i,799293))),"services-teams-and-channels"),pk((()=>i.e(16014).then(i.bind(i,340821))),"services-translate")),hw=pk((()=>i.e(606408).then(i.bind(i,888360))),"services-tpn-notice"),pw=pk((()=>i.e(439613).then(i.bind(i,212626))),"unified-consent-state"),vw=pk((()=>i.e(114826).then(i.bind(i,733621))),"services-url-preview"),yw=pk((()=>i.e(613549).then(i.bind(i,531377))),"services-user-profile"),fw=pk((()=>Promise.all([i.e(917388),i.e(790026),i.e(122297),i.e(140641),i.e(590393),i.e(892924),i.e(256045),i.e(241602),i.e(371935),i.e(779478),i.e(888171),i.e(901509),i.e(547652),i.e(435876),i.e(400010),i.e(242959),i.e(202477),i.e(465019),i.e(697672),i.e(160200),i.e(959180),i.e(687465),i.e(340690),i.e(890555),i.e(864770),i.e(745400),i.e(577907),i.e(357068),i.e(871090),i.e(816167),i.e(479335),i.e(846077),i.e(232236),i.e(914152),i.e(169080),i.e(269104),i.e(890473),i.e(25663),i.e(347761),i.e(9081),i.e(137706),i.e(475063),i.e(215133),i.e(949673),i.e(868724),i.e(919433),i.e(195258),i.e(86195),i.e(810162),i.e(150486),i.e(794535),i.e(309953),i.e(196348),i.e(26466),i.e(430209),i.e(911758),i.e(435216),i.e(667549),i.e(609633),i.e(469488),i.e(548536),i.e(868838),i.e(803124),i.e(242863),i.e(29311),i.e(321833),i.e(186443),i.e(472638),i.e(68688),i.e(912597),i.e(127919),i.e(953275),i.e(718194),i.e(68792),i.e(481020),i.e(485984),i.e(12921),i.e(495500),i.e(403936),i.e(450605),i.e(329712),i.e(905353),i.e(524307),i.e(964619),i.e(418133),i.e(158087),i.e(759500),i.e(816906),i.e(831470),i.e(417169),i.e(451185),i.e(666579),i.e(913486),i.e(369093),i.e(364315),i.e(781662),i.e(53443),i.e(478388),i.e(327116),i.e(713782),i.e(553856),i.e(801349),i.e(399286),i.e(764391),i.e(425523),i.e(336995),i.e(537680),i.e(520174),i.e(506412),i.e(25019),i.e(918607),i.e(673615),i.e(568740)]).then(i.bind(i,200385))),"services-voicemail"),Sw=pk((()=>i.e(948693).then(i.bind(i,620491))),"services-item-crud"),kw=pk((()=>i.e(551792).then(i.bind(i,564347))),"services-webinar"),bw=pk((()=>Promise.all([i.e(137706),i.e(178815)]).then(i.bind(i,503988))),"services-meeting-bot"),ww=pk((()=>i.e(729961).then(i.bind(i,610200))),"services-virtual-events"),Cw=pk((()=>i.e(195270).then(i.bind(i,28970))),"services-meeting-scheduling-service"),_w=pk((()=>i.e(223935).then(i.bind(i,381374))),"services-developer-switchers"),Tw=pk((()=>i.e(478053).then(i.bind(i,224078))),"services-search-prefetch"),Iw=pk((()=>i.e(684615).then(i.bind(i,72441))),"services-call-recording"),jw=pk((()=>i.e(59616).then(i.bind(i,525103))),"services-user-license"),Nw=pk((()=>i.e(376049).then(i.bind(i,320262))),"services-payment"),Ew=pk((()=>i.e(417341).then(i.bind(i,130082))),"services-monetization"),xw=pk((()=>i.e(57264).then(i.bind(i,319759))),"services-mru"),Aw=pk((()=>i.e(701035).then(i.bind(i,3412))),"services-collab-cloud"),Dw=pk((()=>i.e(655402).then(i.bind(i,150560))),"tfl-user-service"),Fw=pk((()=>i.e(172042).then(i.bind(i,760874))),"services-sensitivity-label-policy-settings"),Ow=pk((()=>i.e(883548).then(i.bind(i,774294))),"services-meeting-questions-and-answers"),Mw=pk((()=>i.e(864438).then(i.bind(i,992775))),"services-io-web-app-switcher"),Rw=pk((()=>i.e(145332).then(i.bind(i,714481))),"services-io-mtma-user-data"),Pw=pk((()=>i.e(112279).then(i.bind(i,537643))),"services-io-waffle"),Lw=pk((()=>i.e(669733).then(i.bind(i,788241))),"services-io-organization-info"),Uw=pk((()=>i.e(949584).then(i.bind(i,419677))),"services-video-message-upload"),Ww=pk((()=>i.e(658438).then(i.bind(i,237727))),"services-io-browser-video-message-camera-command"),Bw=e=>()=>e.userServicesCache(gk.AsyncMediaService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,gtmRegistry:i,discover:n,coreSettings:o,loggerFactory:r,scenarioFactory:s,endpointsManager:a}=e,{AsyncMediaService:l}=yield wk(s);return new l(t,i,n,o,r,a,s)})))(e))),$w=e=>()=>e.userServicesCache(gk.SharepointRestClient,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,platformService:i,scenarioFactory:n}=e,{SharepointRestClient:o}=yield ew(n);return new o(t,i)})))(e))),Hw=(e,t)=>()=>e.userServicesCache(gk.BotsPlatformService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:i,scenarioFactory:n,gtmRegistry:o,send:r,discover:s,platformService:a,i18n:l,coreSettings:c}=e,d=yield t(),{BotsPlatformService:u}=yield jk(n);return new u(i,d,o.bind(r,"middleTier"),s,n,a,l,c)})))(e,t))),qw=e=>()=>e.userServicesCache(gk.ConnectedAccountsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{discover:t,gtmRegistry:i,scenarioFactory:n,send:o,coreSettings:r,i18n:s,endpointsManager:a}=e,{ConnectedAccountsService:l}=yield Jk(n);return new l(t,i,n,r,o,s,a)})))(e))),zw=e=>()=>e.userServicesCache(gk.GoogleCalendarAuthenticationService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,loggerFactory:i,windowProvider:n,scenarioFactory:o,platformService:r,coreSecurityService:s}=e,{GoogleCalendarAuthenticationService:a}=yield ub(o);return new a(n,t,i,o,r,s)})))(e))),Vw=e=>()=>e.userServicesCache(gk.GoogleContactsAuthenticationService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,loggerFactory:i,windowProvider:n,scenarioFactory:o,platformService:r,coreSecurityService:s}=e,{GoogleContactsAuthenticationService:a}=yield mb(o);return new a(n,t,i,o,r,s)})))(e))),Gw=e=>()=>e.userServicesCache(gk.MsaAuthenticationService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,scenarioFactory:i,windowProvider:n}=e,{MsaAuthenticationService:o}=yield Pb(i);return new o(t,i,n)})))(e))),Jw=(e,t,i,n)=>()=>e.userServicesCache(gk.ExternalAccountsService,(()=>((e,t,i,n)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:o,localStorage:r,platformService:s,scenarioFactory:a}=e,l=yield t(),c=yield i(),d=yield n(),{ExternalAccountsService:u}=yield ib(a);return new u(o,l,c,d,a,s,r)})))(e,t,i,n))),Kw=(e,t,i)=>()=>e.userServicesCache(gk.ThirdPartyCalendarService,(()=>((e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:n,scenarioFactory:o,authenticationService:r,localStorage:s}=e,a=yield t(),l=yield i(),{ThirdPartyCalendarService:c}=yield uw(o);return new c(n,r,a,l,o,s)})))(e,t,i))),Qw=e=>()=>e.userServicesCache(gk.CallingAppEventsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,scenarioFactory:i,windowProvider:n}=e,{CallingAppEventsService:o,ObservableFactory:r}=yield vk();return new o(t,new r,i,n)})))(e))),Yw=(e,t)=>()=>e.userServicesCache(gk.CallingBannerServiceAdapter,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:i}=e,n=yield t(),{CallingBannerServiceAdapter:o}=yield vk();return new o(i,n)})))(e,t))),Xw=(e,t)=>()=>e.userServicesCache(gk.CallingDialogServiceAdapter,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:i,scenarioFactory:n}=e,o=yield t(),{CallingDialogServiceAdapter:r}=yield vk();return new r(i,n,o)})))(e,t))),Zw=(e,t)=>()=>e.userServicesCache(gk.CallingNotificationServiceAdapter,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:i,coreSettings:n,hostCommunicationService:o,platformService:r,scenarioFactory:s,coreShortcutService:a}=e,l=yield t(),{CallingLoggingService:c,CallingNotificationServiceAdapter:d}=yield vk();return new d(i,n,l,o,new c(i,s,n,r),a)})))(e,t))),eC=e=>()=>e.userServicesCache(gk.DiscoverSurfaceService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,scenarioFactory:i,endpointsManager:n}=e,{DiscoverSurfaceService:o}=yield Cb(i);return new o(t,n,i)})))(e))),tC=e=>()=>e.userServicesCache(gk.UserLicenseService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{discover:t,endpointsManager:i,loggerFactory:n,scenarioFactory:o}=e,{UserLicenseService:r}=yield jw(o);return new r(t,i,n,o)})))(e))),iC=(e,t)=>()=>e.userServicesCache(gk.SmbUserIntentService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:i,loggerFactory:n,scenarioFactory:o,localStorage:r,windowProvider:s}=e,a=yield t(),{SmbUserIntentService:l}=yield ow(o);return new l(n,i,r,a,s,o)})))(e,t))),nC=e=>()=>e.userServicesCache(gk.TenantPrivacyProfileService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,authenticationService:i,coreSettings:n,scenarioFactory:o,endpointsManager:r,localStorage:s,discover:a}=e,{CallingIdentityAdapterService:l,ClientDatabaseService:c,AggregatedSettingsStoreService:d,ACSCallingAuthenticationServiceAdapter:u,CallingAuthenticationServiceAdapter:m,TenantPrivacyProfileService:g}=yield vk(),h=new c(t,s),p=new d(t,n),v=yield i.getUser();return new g(t,i,new l(n.get(b.J.Calling).enableACSEmbed?new u(a,v,t):new m(i,a,v,t,n),p,t),n,h,o,r)})))(e))),oC=e=>()=>{var t;const{coreSettings:i}=e;if(!(null===(t=null==i?void 0:i.get(b.J.CMDMeetingArtifactsService))||void 0===t?void 0:t.enableCMDMeetingArtifactsService))throw new Error("FF enableCMDMeetingArtifactsService is disabled");return e.userServicesCache(gk.CollabObjectService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,coreSettings:i,loggerFactory:n,endpointsManager:o,scenarioFactory:r,discover:s}=e,{CollabObjectService:a}=yield Vk(r);return new a(t,i,n,o,s)})))(e)))},rC=e=>()=>e.userServicesCache(gk.StoreDevicesService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,scenarioFactory:i,endpointsManager:n}=e,{StoreDevicesService:o}=yield Qk(i);return new o(n,t,i)})))(e))),sC=e=>()=>e.userServicesCache(gk.OrganizationInfoService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i}=e,{OrganizationInfoService:n}=yield Lw(i);return new n(t)})))(e))),aC=e=>()=>e.userServicesCache(gk.MeetingRoomAppEventsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,scenarioFactory:i,windowProvider:n}=e,{ObservableFactory:o,MeetingRoomAppEventsService:r}=yield vk();return new r(t,new o,i,n)})))(e))),lC=e=>()=>e.userServicesCache(gk.AppsStoreService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,coreSettings:i,endpointsManager:n}=e,{AppsStoreService:o}=yield Sk(t);return new o(t,i,n)})))(e))),cC=e=>()=>e.userServicesCache(gk.AiInsightsFeedbackService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i,loggerFactory:n}=e,{AiInsightsFeedbackService:o}=yield Fk(t);return new o(i,n,t)})))(e))),dC=e=>()=>e.userServicesCache(gk.AiInsightsSdsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i,loggerFactory:n}=e,{AiInsightsSdsService:o}=yield Ok(t);return new o(i,n,t)})))(e))),uC=(e,t)=>()=>e.userServicesCache(gk.AppBasedLinkService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:i,scenarioFactory:n,loggerFactory:o}=e,{AppBasedLinkService:r}=yield yk(n);return new r(i,yield t(),n,o)})))(e,t))),mC=e=>()=>e.userServicesCache(gk.AppsPlatformService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,coreSettings:i,endpointsManager:n,localStorage:o,authenticationService:r}=e,{enableMetaOsSdkIntegration:s}=i.get(b.J.Extensibility),{AppsPlatformService:a,AppsPlatformServiceMetaOS:l}=yield fk(t);return s?new l(i,n,t,r):new a(i,n,o)})))(e))),gC=e=>()=>e.userServicesCache(gk.AppSuggestionsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i,coreSettings:n,loggerFactory:o}=e,{AppSuggestionsService:r}=yield kk(t);return new r(t,n,i,o)})))(e))),hC=(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:i,i18n:n,loggerFactory:o,scenarioFactory:r,windowProvider:s,coreSettings:a,pubsub:l}=e,{enableAugLoopService:c,runtimeFlights:d,resource:u,serviceUrl:m}=a.get(b.J.Augloop),{AugloopService:g}=yield Ck(r),h=new g(i,s,l,o,r,n,a),p=t?{appName:"Word",appPlatform:"Web"}:void 0;return c&&m&&u&&(yield h.initialize(m,u,d||[],p)),h})),pC=(e,t)=>()=>t?e.userServicesCache(gk.ComposeAugloopService,(()=>hC(e,!0))):e.userServicesCache(gk.AugloopService,(()=>hC(e))),vC=e=>()=>e.userServicesCache(gk.SubstrateBotPlatformService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i}=e,{SubstrateBotPlatformService:n}=yield _k(i);return new n(t)})))(e))),yC=e=>()=>e.userServicesCache(gk.AzureMapsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,i18NextWrapper:i,scenarioFactory:n,coreSettings:o}=e,{AzureMapsService:r}=yield Tk(n);return new r(t,o,i)})))(e))),fC=e=>()=>e.userServicesCache(gk.BadgeCountService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,config:i,discover:n,platformService:o,scenarioFactory:r}=e,{BadgeCountService:s}=yield $k(r);return new s(o,t,n,i)})))(e))),SC=e=>()=>e.userServicesCache(gk.BrbService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{activeWindowsService:t,scenarioFactory:i,loggerFactory:n,coreSettings:o,logsCollectorService:r,authenticationService:s,platformService:a,discover:l,windowProvider:c,hostCommunicationService:d,endpointsManager:u,authenticationUser:m,i18n:g}=e,{BrbService:h}=yield Nk(i);return new h(n,o,r,s,a,l,c,d,u,i,g,t,m)})))(e))),kC=e=>()=>e.userServicesCache(gk.BreakoutRoomMiddleTierService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{BreakoutRoomMiddleTierService:n}=yield Ek(t);return new n(i)})))(e))),bC=e=>()=>e.userServicesCache(gk.AtpSafelinksService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,endpointsManager:i,gtmRegistry:n,localStorage:o,loggerFactory:r,scenarioFactory:s,send:a}=e,{AtpSafelinksService:l}=yield bk(s);return new l(n.bind(a,"middleTier"),s,r,o,t,i)})))(e))),wC=e=>()=>e.userServicesCache(gk.BroadcastAttendeeService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,coreSettings:i,loggerFactory:n,scenarioFactory:o,windowProvider:r}=e,{BroadcastAttendeeService:s}=yield Rk(o);return new s(t,n,o,r,i)})))(e))),CC=e=>()=>e.userServicesCache(gk.BroadcastStreamingAttendeeService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i}=e,{BroadcastStreamingAttendeeService:n}=yield Pk(i);return new n(t)})))(e))),_C=e=>()=>e.userServicesCache(gk.BroadcastCaptionsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,send:i,endpointsManager:n,scenarioFactory:o,windowProvider:r,loggerFactory:s}=e,{BroadcastCaptionsService:a}=yield Lk(o);return new a(r,s,o,t,i,n)})))(e))),TC=e=>()=>e.userServicesCache(gk.BroadcastSignalRService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,loggerFactory:i,endpointsManager:n,windowProvider:o}=e,{BroadcastSignalRService:r}=yield Uk(t);return new r(i,n,t,o)})))(e)));var IC=i(486390);const jC=(e,t)=>i=>{t({payload:i,pubsub:e})},NC=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:n,gtmRegistry:o,loggerFactory:r,pubsub:s,send:a,windowProvider:l}=e,{CallBlockingService:c}=yield i.e(667417).then(i.bind(i,865704));return new c(t,n,o.bind(a,"middleTier"),r.newLogger("CallBlockingService","data-services-common"),l,jC(s,EC))})),EC=({payload:e,pubsub:t})=>{t.publish(IC.oo,e.newBlockedMris)};class xC{constructor(){this._displayName=null,this.getDisplayName=()=>this._displayName,this.setDisplayName=e=>{this._displayName=e}}}const AC=e=>()=>e.userServicesCache(gk.CallingAnonymousDisplayNameService,(()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return new xC})))),DC=e=>()=>e.userServicesCache(gk.CmdMeetingIntelligenceService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{CmdMeetingIntelligenceService:n}=yield zk(t);return new n(i)})))(e))),FC=e=>()=>e.userServicesCache(gk.CommunitySettingsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{CommunitySettingsService:n}=yield Gk(t);return new n(i)})))(e))),OC=e=>()=>e.userServicesCache(gk.ConnectedCalendarSettingsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,scenarioFactory:i,endpointsManager:n}=e,{ConnectedCalendarSettingsService:o}=yield Kk(i);return new o(i,t,n)})))(e))),MC=e=>()=>{const{coreSettings:t}=e,{enableCMDServiceForTokenRetriveAndVoiceSignatureStore:i}=t.get(b.J.BiometricEnrollment),{isCMDSvcEnabledForBiometricStorage:n}=t.get(b.J.Host);return i||n?e.userServicesCache(gk.BiometricEnrollmentService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,authenticationService:i,coreSettings:n,loggerFactory:o,platformService:r,scenarioFactory:s,i18n:a,endpointsManager:l}=e,{VoiceBiometricEnrollmentService:c}=yield Ik(s);return new c(t,i,n,o,r,a,l)})))(e))):e.userServicesCache(gk.BiometricEnrollmentService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{discover:t,gtmRegistry:i,loggerFactory:n,platformService:o,scenarioFactory:r,send:s,coreSettings:a,i18n:l,endpointsManager:c}=e,{BiometricEnrollmentService:d}=yield Ik(r);return new d(t,i,n,o,s,a,l,c)})))(e)))},RC=e=>()=>e.userServicesCache(gk.BiometricFaceEnrollmentService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,authenticationService:i,coreSettings:n,loggerFactory:o,platformService:r,scenarioFactory:s,endpointsManager:a}=e,{BiometricFaceEnrollmentService:l}=yield Ik(s);return new l(t,i,n,o,r,a)})))(e))),PC=e=>()=>e.userServicesCache(gk.DeveloperSwitchersService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,config:i,localStorage:n,loggerFactory:o,rebootService:r,scenarioFactory:s,windowProvider:a}=e,{DeveloperSwitchersService:l}=yield _w(s);return new l(r,a,o.newLogger("DeveloperSwitchersService","data-services-common"),t,n,i)})))(e))),LC=e=>()=>e.userServicesCache(gk.DistributionListService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,send:i,loggerFactory:n,coreSettings:o,scenarioFactory:r}=e,{DistributionListService:s}=yield Yk(r);return new s(n,t.bind(i,"middleTier"),o)})))(e))),UC=e=>()=>e.userServicesCache(gk.DynamicsMarketingService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:i,send:n,scenarioFactory:o}=e,{DynamicsMarketingService:r}=yield Xk(o);return new r(t,i,n)})))(e))),WC=e=>()=>e.userServicesCache(gk.DynamicsVirtualEventsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:i,send:n,i18NextWrapper:o,scenarioFactory:r,loggerFactory:s,discover:a}=e,{DynamicsVirtualEventsService:l}=yield Zk(r);return new l(t,i,n,o,s,a)})))(e))),BC=e=>()=>e.userServicesCache(gk.EmoticonService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,localStorage:i,scenarioFactory:n,coreSettings:o,i18n:r,windowProvider:s,config:a}=e,{EmoticonService:l}=yield eb(n),c=new l(r.locale,i,o,t.newLogger("EmoticonService","data-services-common"),n,r,s,null==a?void 0:a.experienceName);return yield c.isInitialized,c})))(e))),$C=e=>()=>e.userServicesCache(gk.EspService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i}=e,{EspService:n}=yield tb(i);return new n(t)})))(e))),HC=e=>()=>e.userServicesCache(gk.ExampleService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t}=e,{ExampleService:i}=yield $b(t);return new i})))(e))),qC=(e,t)=>()=>e.userServicesCache(gk.ExternalAccountsResponseService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:i,scenarioFactory:n}=e,o=yield t(),{ExternalAccountsResponseService:r}=yield nb(n);return new r(i,o,n)})))(e,t))),zC=e=>()=>e.userServicesCache(gk.FluidService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:i,endpointsManager:n,send:o,scenarioFactory:r}=e,{FluidService:s}=yield lb(r);return new s(t,i,n,o)})))(e))),VC=e=>()=>e.userServicesCache(gk.GalleryService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,discover:i,send:n,scenarioFactory:o}=e,{GalleryService:r}=yield db(o);return new r(n,t,i,o)})))(e))),GC=e=>()=>e.userServicesCache(gk.GiphyService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,gtmRegistry:i,endpointsManager:n,send:o,scenarioFactory:r,i18n:s}=e,{GiphyService:a}=yield cb(r);return new a(i.bind(o,"middleTier"),t,s.locale,n)})))(e))),JC=e=>()=>e.userServicesCache(gk.GuardiansService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,discover:i,send:n,scenarioFactory:o,loggerFactory:r,i18n:s}=e,{GuardiansService:a}=yield Tb(o);return new a(t,r,i,n,s)})))(e))),KC=e=>()=>e.userServicesCache(gk.ImageProxyService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,gtmRegistry:i,send:n,scenarioFactory:o}=e,{ImageProxyService:r}=yield gb(o);return new r(i,n,t)})))(e))),QC=e=>()=>e.userServicesCache(gk.ImmersiveReaderService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i}=e,{ImmersiveReaderService:n}=yield hb(i);return new n(t)})))(e))),YC=(e,t)=>()=>t.userServicesCache(gk.ImportMsaContactsService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:i,endpointsManager:n,scenarioFactory:o}=t,{ImportMsaContactsService:r}=yield pb(o);return new r(yield e(),i,n,o)})))(e,t))),XC=e=>()=>e.userServicesCache(gk.ImplicitContactsService,(()=>(({discover:e,gtmRegistry:t,send:i,scenarioFactory:n})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{ImplicitContactsService:o}=yield aw(n);return new o(i,e,t,n)})))(e))),ZC=e=>()=>e.userServicesCache(gk.InstantAnswersService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,send:i,scenarioFactory:n,loggerFactory:o,i18n:r}=e,{InstantAnswersService:s}=yield vb(n);return new s(o,n,t,i,r)})))(e))),e_=e=>()=>e.userServicesCache(gk.InviteLinksService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{InviteLinksService:n}=yield yb(t);return new n(i)})))(e))),t_=e=>()=>e.userServicesCache(gk.LiveStateBroadcastService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{pubsub:t,scenarioFactory:i,loggerFactory:n,coreSettings:o,authenticationService:r,platformService:s,discover:a}=e,{LiveStateBroadcastService:l}=yield fb(i);return new l(t,n,o,r,s,i,a)})))(e))),i_=e=>()=>e.userServicesCache(gk.LiveStreamRenderingService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,authStateProvider:i,discover:n,send:o,scenarioFactory:r,loggerFactory:s,pubsub:a,platformService:l,clientState:c,coreSettings:d,endpointsManager:u,networkState:m}=e,{LiveStreamRenderingService:g}=yield Sb(r),{ACSCallingAuthenticationServiceAdapter:h,CallingAuthenticationServiceAdapter:p}=yield vk(),v=yield t.getUser();return new g(s,d.get(b.J.Calling).enableACSEmbed?new h(n,v,s):new p(t,n,v,s,d,i),l,c,a,o,d,r,u,m)})))(e))),n_=e=>()=>e.userServicesCache(gk.LmsIntegrationService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,discover:i,send:n,scenarioFactory:o}=e,{LmsIntegrationService:r}=yield kb(o);return new r(t,i,n)})))(e))),o_=e=>()=>e.userServicesCache(gk.LockedTeamsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,discover:i,send:n,scenarioFactory:o}=e,{LockedTeamsService:r}=yield jb(o);return new r(t,i,n)})))(e))),r_=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,loggerFactory:i,logsCollectorService:n,coreSettings:o}=e,{LogsFilesService:r}=yield Nb(t);return new r(i,n,o,void 0)})),s_=e=>()=>e.userServicesCache(gk.LogsFilesService,(()=>r_(e))),a_=e=>()=>e.userServicesCache(gk.LokiService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,platformService:i,scenarioFactory:n,coreSettings:o,endpointsManager:r}=e,{LokiService:s}=yield wb(n);return new s(i,t,o,r)})))(e))),l_=e=>()=>e.userServicesCache(gk.ManageTenantService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,loggerFactory:i,scenarioFactory:n}=e,{ManageTenantService:o}=yield Eb(n);return new o(i,n,t)})))(e))),c_=e=>()=>e.userServicesCache(gk.MeetingArtifactsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,coreSettings:n,scenarioFactory:o,i18n:r,loggerFactory:s}=e,{MeetingArtifactsService:a}=yield xb(o);return new a(i,t,n,r,s,o)})))(e))),d_=(e,t,i)=>()=>{var n;const{coreSettings:r}=e;if(!(null===(n=null==r?void 0:r.get(b.J.MeetingBot))||void 0===n?void 0:n.enableMeetingBot))throw new Error("enableMeetingBot flag is disabled");return e.userServicesCache(gk.MeetingBotService,(()=>((e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:n,cmdApolloClient:o,authenticationService:r,coreSettings:s,loggerFactory:a,localStorage:l,platformService:c,windowProvider:d,entityCommanding:u,i18n:m,authenticationUser:g}=e,{MeetingBotService:h}=yield bw(n);return new h(r,yield t(),s,yield i(),a,n,d,l,c,o,u,m,g)})))(e,t,i)))},u_=e=>()=>e.userServicesCache(gk.MeetingIntelligenceService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i,loggerFactory:n}=e,{MeetingIntelligenceService:o}=yield Ab(t);return new o(i,n)})))(e))),m_=e=>()=>e.userServicesCache(gk.PeopleService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{PeopleService:n}=yield Lb(t);return new n(i)})))(e))),g_=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{windowProvider:t,coreSettings:n,scenarioFactory:o,loggerFactory:r}=e,{MeetingOptionsClientDataService:s}=yield Promise.all([i.e(944014),i.e(820516)]).then(i.bind(i,642927)),a=m_(e);return new s(t,yield a(),n,o,r)})),h_=e=>()=>e.userServicesCache(gk.MeetingOptionsClientDataService,(()=>g_(e))),p_=e=>()=>e.userServicesCache(gk.MeetingOptionsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,scenarioFactory:n,coreSettings:o,gtmRegistry:r,discover:s,endpointsManager:a}=e,{MeetingOptionsService:l}=yield Fb(n);return new l(t,i,n,o,r,s,a)})))(e))),v_=e=>()=>e.userServicesCache(gk.MeetingQuestionsAndAnswersService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,scenarioFactory:i,endpointsManager:n}=e,{MeetingQuestionsAndAnswersService:o}=yield Ow(i);return new o(n,t,i)})))(e))),y_=e=>()=>e.userServicesCache(gk.MeetingRecapService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{MeetingRecapService:n}=yield Db(t);return new n(i)})))(e))),f_=e=>()=>e.userServicesCache(gk.MeetingRecapSwaService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,scenarioFactory:i,authenticationService:n,loggerFactory:o,endpointsManager:r,coreSettings:s}=e,{MeetingRecapSwaService:a}=yield Ob(i);return new a(r,n,t,s,o)})))(e))),S_=e=>()=>e.userServicesCache(gk.MeetingRecapWorkingSetFilesService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{MeetingRecapWorkingSetFilesService:n}=yield Mb(t);return new n(i)})))(e))),k_=e=>()=>e.userServicesCache(gk.MeetingTemplateService,(()=>(({scenarioFactory:e,send:t,authenticationService:i,coreSettings:n,discover:r,loggerFactory:s,endpointsManager:a})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{MeetingTemplateService:o}=yield Rb(e);return new o(t,i,n,e,r,a,s)})))(e))),b_=e=>()=>e.userServicesCache(gk.PaymentsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,send:i,authenticationService:n,coreSettings:o,i18n:r,loggerFactory:s}=e,{PaymentService:a}=yield Nw(t);return new a(i,n,o,s,t,r)})))(e))),w_=e=>()=>e.userServicesCache(gk.PeoplePickerService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{PeoplePickerService:n}=yield Ub(t);return new n(i)})))(e))),C_=e=>()=>e.userServicesCache(gk.PeopleTargetingService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,loggerFactory:i,send:n,coreSettings:o,scenarioFactory:r,discover:s}=e,{PeopleTargetingService:a}=yield Wb(r);return new a(t,i,n,o,s)})))(e))),__=e=>()=>e.userServicesCache(gk.PoliciesService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:i,endpointsManager:n,loggerFactory:o,networkState:r,scenarioFactory:s}=e,{PoliciesService:a}=yield Vb(s);return new a(n,t,i,o,r,s)})))(e))),T_=e=>()=>e.userServicesCache(gk.PresenceService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,pubsub:i,send:n,scenarioFactory:o,platformService:r,config:s}=e,{PresenceService:a}=yield Gb(o);return new a(t.bind(n,"unifiedPresence"),i,r,s)})))(e)));class I_ extends Error{constructor(e,t){super(`${t} - ${e}`)}}class j_{process(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.validateInput(t),this.validateConfig(e),this.executeStatements(e,t)}))}executeStatements(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=[];for(const o of(null===(i=t.odsl)||void 0===i?void 0:i.statements)||[]){const t=e[o.name];if(!t)throw new I_(`No matching manifest found for statement '${o.name}'`,"ODSLProcessor-01");const i=t(this.processStatement(o));n.push(i)}return n}))}processStatement(e){const t={};Object.keys(e.arguments).forEach((i=>{const n=e.arguments[i];switch(n.type){case"number":n.number&&(t[i]=n.number);break;case"boolean":n.boolean&&(t[i]=n.boolean);break;case"string":n.string&&(t[i]=n.string)}}));return t}validateConfig(e){if(!e)throw new I_("No manifest found","ODSLProcessor-04")}validateInput(e){if(!e)throw new I_("No input found","ODSLProcessor-05");if(!e.odsl)throw new I_("No ODSL found in input","ODSLProcessor-06");if(!e.entities)throw new I_("No entities found in input","ODSLProcessor-07")}}const N_=e=>()=>e.userServicesCache(gk.ODSLProcessingEngine,(()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return new j_})))),E_=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,send:n,loggerFactory:o}=e,{AddressService:r}=yield i.e(821836).then(i.bind(i,76173));return new r(t.bind(n,"middleTier"),o)})),x_=e=>()=>e.userServicesCache(gk.AddressService,(()=>E_(e))),A_=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,send:n}=e,{PstnService:o}=yield i.e(893393).then(i.bind(i,787205));return new o(t.bind(n,"middleTier"))})),D_=e=>()=>e.userServicesCache(gk.PstnService,(()=>A_(e))),F_=e=>()=>e.userServicesCache(gk.SCISService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,authenticationService:i,platformService:n,scenarioFactory:o,loggerFactory:r}=e,{SCISService:s}=yield Jb(o);return new s(t,i,n,o,r)})))(e))),O_=e=>()=>e.userServicesCache(gk.SearchPrefetchService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,loggerFactory:i,authenticationService:n}=e,{SearchPrefetchService:o}=yield Tw(t);return new o(n,i)})))(e))),M_=e=>()=>e.userServicesCache(gk.ShareService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,discover:i,gtmRegistry:n,scenarioFactory:o,send:r,i18n:s}=e,{ShareService:a}=yield iw(o);return new a(t,i,n,r,s)})))(e))),R_=(e,t,i)=>()=>e.userServicesCache(gk.StoreService,(()=>((e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:n,loggerFactory:o,gtmRegistry:r,localStorage:s,coreSettings:a,authenticationService:l,platformService:c,endpointsManager:d,windowProvider:u,i18n:m}=e,{StoreService:g}=yield rw(n);return new g(n,o,r,s,a,l,c,d,u,m,yield t(),yield i())})))(e,t,i))),P_=e=>()=>e.userServicesCache(gk.StyleMyRoomService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,i18n:i,scenarioFactory:n,endpointsManager:o}=e,{StyleMyRoomService:r}=yield Mk(n);return new r(t,o,i)})))(e))),L_=e=>()=>e.userServicesCache(gk.TenantMembershipService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{TenantMembershipService:n}=yield cw(t);return new n(t,i)})))(e))),U_=e=>()=>e.userServicesCache(gk.TenantService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{TenantService:n}=yield dw(t);return new n(t,i)})))(e))),W_=e=>()=>e.userServicesCache(gk.TenantAnalyticsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i,loggerFactory:n}=e,{TenantAnalyticsService:o}=yield bb(i);return new o(n,t)})))(e))),B_=e=>()=>e.userServicesCache(gk.TranscriptService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i,coreSettings:n,loggerFactory:o}=e,{TranscriptService:r}=yield xk(t);return new r(i,o,t,n)})))(e))),$_=e=>()=>e.userServicesCache(gk.TranscriptFeedbackService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t}=e,{TranscriptFeedbackService:i}=yield Dk(t);return new i})))(e))),H_=e=>()=>e.userServicesCache(gk.TranscriptSettingsStoreService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,scenarioFactory:i,endpointsManager:n,authenticationUser:o}=e,{SettingsStoreService:r}=yield Ak(i);return new r(t,i,n,o)})))(e))),q_=e=>()=>e.userServicesCache(gk.TranslateService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,endpointsManager:i,coreSettings:n,scenarioFactory:o,send:r}=e,{TranslateService:s}=yield gw(o);return new s(t.bind(r,"middleTier"),o,n,i)})))(e))),z_=e=>()=>e.userServicesCache(gk.TargetingHierarchyService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:i,discover:n,loggerFactory:o,scenarioFactory:r,send:s}=e,{TargetingHierarchyService:a}=yield lw(r);return new a(t,o,s,i,n)})))(e))),V_=e=>()=>e.userServicesCache(gk.ToastImageService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{ToastImageService:n}=yield mw(t);return new n(i)})))(e)));var G_=i(699532);const J_=e=>()=>e.userServicesCache(gk.TeamsAndChannelsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t}=e;return new G_.K(t)})))(e))),K_=e=>()=>e.userServicesCache(gk.TpnNoticeService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,platformService:i,scenarioFactory:n}=e,{TpnNoticeService:o}=yield hw(n);return new o(t,i)})))(e))),Q_=(e,t)=>()=>e.userServicesCache(gk.UrlPreviewService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:i,endpointsManager:n,send:o,coreSettings:r,scenarioFactory:s}=e,{UrlPreviewService:a}=yield vw(s);return new a(i,o,r,yield t(),n,s)})))(e,t))),Y_=e=>()=>e.userServicesCache(gk.UserProfileService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{UserProfileService:n}=yield yw(t);return new n(i)})))(e))),X_=e=>()=>e.userServicesCache(gk.VirtualEventsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,send:i,authenticationService:n,coreSettings:o,discover:r,loggerFactory:s,endpointsManager:a}=e,{VirtualEventsService:l,MockVirtualEventsService:c}=yield ww(t),{forceUseMockAPIs:d}=o.get(b.J.VirtualEvents);return d?new c:new l(i,n,o,r,s,a)})))(e))),Z_=e=>()=>e.userServicesCache(gk.MeetingSchedulingService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{MeetingSchedulingService:n}=yield Cw(t);return new n(i)})))(e)));var eT=i(451890);const tT=({payload:e,pubsub:t})=>{t.publish(eT.Gq,e)},iT=e=>()=>e.userServicesCache(gk.VoicemailService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:i,loggerFactory:n,scenarioFactory:o,pubsub:r,send:s,windowProvider:a}=e,{VoicemailService:l}=yield fw(o);return new l(t,i,s,n,a,jC(r,tT))})))(e))),nT=e=>()=>e.userServicesCache(gk.WebinarService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,send:i,authenticationService:n,coreSettings:o,discover:r,i18n:s,loggerFactory:a}=e,{WebinarService:l}=yield kw(t);return new l(i,n,o,a,t,s,r)})))(e))),oT=e=>()=>e.userServicesCache(gk.CallRecordingService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,loggerFactory:i,endpointsManager:n}=e,{CallRecordingService:o}=yield Iw(t);return new o(i,n)})))(e))),rT=e=>()=>e.userServicesCache(gk.MonetizationService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,scenarioFactory:n,loggerFactory:o,discover:r,coreSettings:s,localStorage:a}=e,{MonetizationService:l}=yield Ew(n);return new l(t,i,o,r,s,a)})))(e))),sT=e=>()=>e.userServicesCache(gk.MRUItemService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,scenarioFactory:n,coreSettings:o}=e,{MRUService:r}=yield xw(n);return new r(t,i,o)})))(e))),aT=(e,t)=>()=>e.userServicesCache(gk.DiscoverSurfaceFeedbackService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:i,windowProvider:n,loggerFactory:o}=e,{DiscoverSurfaceFeedbackService:r}=yield _b(i);return new r(yield t(),n,o)})))(e,t))),lT=e=>()=>{var t;const{coreSettings:i}=e;if(!(null===(t=null==i?void 0:i.get(b.J.Extensibility))||void 0===t?void 0:t.enableCollabCloudApis))throw new Error("enableCollabCloudApis flag is disabled");return e.userServicesCache(gk.CollabCloudService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{CollabCloudService:n}=yield Aw(t);return new n(i)})))(e)))},cT=e=>()=>e.userServicesCache(gk.TFLUserService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i,localStorage:n,loggerFactory:o}=e,{TFLUserService:r}=yield Dw(t);return new r(o,n,i)})))(e))),dT=e=>()=>e.userServicesCache(gk.SensitivityLabelPolicySettingsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,discover:i,gtmRegistry:n,authenticationUser:o,scenarioFactory:r,send:s}=e,{SensitivityLabelPolicySettingsService:a}=yield Fw(r);return new a(r,t,n,s,i,o)})))(e))),uT=e=>()=>e.userServicesCache(gk.WaffleService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i}=e,{WaffleService:n}=yield Pw(i);return new n(t)})))(e))),mT=e=>()=>e.userServicesCache(gk.VideoMessageCameraCommandService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t}=e,{VideoMessageCameraCommandService:i}=yield Ww(t);return new i})))(e))),gT=(e,t,i)=>()=>e.userServicesCache(gk.PetrolService,(()=>((e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{platformService:n,authenticationService:o,coreSettings:r,send:s,scenarioFactory:a,loggerFactory:l,hostCommunicationService:c,i18n:d}=e,{PetrolService:u}=yield Hb(a);return new u(o,a,l,n,r,s,yield t(),yield i(),c,d)})))(e,t,i))),hT=(e,t)=>()=>e.userServicesCache(gk.FloodgateService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:i,scenarioFactory:n,coreSettings:o,clientState:r,i18NextWrapper:s,windowProvider:a,platformService:l,authenticationUser:c}=e,d=yield t(),{FloodGateService:u}=yield qb(n);return new u(i,n,r,o,d,s,l,a,c)})))(e,t))),pT=(e,t,i)=>()=>e.userServicesCache(gk.OdsService,(()=>((e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:n,scenarioFactory:o,loggerFactory:r,endpointsManager:s,logsCollectorService:a,coreSettings:l,platformService:c,hostCommunicationService:d,i18n:u}=e,{OdsService:m}=yield zb(o);return new m(n,r,s,a,l,c,yield t(),d,yield i(),u)})))(e,t,i))),vT=e=>()=>e.userServicesCache(gk.LokiMetaPreviewService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,loggerFactory:n,scenarioFactory:o}=e,{LokiMetaPreviewService:r}=yield Kb(o);return new r(i,t,n)})))(e))),yT=e=>()=>e.userServicesCache(gk.OdcFilePreviewService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,loggerFactory:n,scenarioFactory:o}=e,{OdcFilePreviewService:r}=yield Kb(o);return new r(i,t,n)})))(e))),fT=e=>()=>e.userServicesCache(gk.OSearchService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,discover:i,loggerFactory:n,scenarioFactory:o,coreSettings:r,endpointsManager:s}=e,{OSearchService:a}=yield Kb(o);return new a(t,s,i,n,r)})))(e))),ST=e=>()=>e.userServicesCache(gk.PeopleSearchService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{send:t,endpointsManager:i,gtmRegistry:n,loggerFactory:o,scenarioFactory:r,discover:s,coreSettings:a}=e,{PeopleSearchService:l}=yield Kb(r);return new l(n.bind(t,"middleTier"),i,o,s,a)})))(e))),kT=e=>()=>e.userServicesCache(gk.SubstrateFilesSearchService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,platformService:n,loggerFactory:o,scenarioFactory:r,i18n:s}=e,{SubstrateFilesSearchService:a}=yield Kb(r);return new a(i,t,n,r,o,s)})))(e))),bT=e=>()=>e.userServicesCache(gk.SubstrateRecommendationsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i}=e,{SubstrateRecommendationsService:n}=yield Zb(i);return new n(t)})))(e))),wT=e=>()=>e.userServicesCache(gk.SubstrateSearchService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,loggerFactory:n,platformService:o,scenarioFactory:r,windowProvider:s,coreSettings:a,endpointsManager:l,i18n:c}=e,{SubstrateSearchService:d}=yield Kb(r),{subType:u}=yield t.getUser();return new d(i,t,o,r,n,s,a,l,c,u||Es.Yf.Default)})))(e))),CT=e=>()=>e.userServicesCache(gk.SubstrateSuggestionsService,(()=>(({authenticationService:e,endpointsManager:t,coreSettings:i,discover:n,gtmRegistry:r,send:s,scenarioFactory:a,platformService:l})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{SubstrateSuggestionsService:o}=yield sw(a);return new o(s,t,e,i,n,r,l)})))(e))),_T=e=>()=>e.userServicesCache(gk.SubstrateMeetingSearchService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,send:i,loggerFactory:n,platformService:o,scenarioFactory:r}=e,{SubstrateMeetingSearchService:s}=yield Kb(r);return new s(i,t,o,r,n)})))(e))),TT=e=>()=>e.userServicesCache(gk.SubstrateMeetingSummarySearchService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,loggerFactory:i,platformService:n,scenarioFactory:o,coreSettings:r,endpointsManager:s,i18n:a}=e,{SubstrateMeetingSummarySearchService:l}=yield Qb(o);return new l(t,n,o,i,r,s,a)})))(e))),IT=e=>()=>e.userServicesCache(gk.ChatService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,coreSettings:i,scenarioFactory:n}=e,{ChatService:o}=yield $k(n);return new o(i,t)})))(e))),jT=(e,t)=>()=>e.userServicesCache(gk.ChatServiceEndpointProvider,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:i}=e,n=yield t(),{ChatServiceEndpointProvider:o}=yield Bk(i);return new o(n,i)})))(e,t))),NT=e=>()=>e.userServicesCache(gk.ConsumerGroupsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:t,scenarioFactory:i,endpointsManager:n,loggerFactory:o}=e,{ConsumerGroupsService:r}=yield $k(i);return new r(n,o,i,t)})))(e))),ET=e=>()=>e.userServicesCache(gk.CSAService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,platformService:i,coreSettings:n,scenarioFactory:o,endpointsManager:r,i18n:s,discover:a}=e,{createCSAService:l}=yield $k(o);return l(t,i,n,s,r,a)})))(e))),xT=e=>()=>e.userServicesCache(gk.StatefulLongPoll,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t}=e,{StatefulLongPoll:i}=yield $k(t);return new i})))(e))),AT=e=>()=>e.userServicesCache(gk.ReportConcernService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,send:i,gtmRegistry:n,platformService:o}=e,{ReportConcernService:r}=yield qk(t);return new r(n.bind(i,"middleTier"),o)})))(e))),DT=e=>()=>e.userServicesCache(gk.CallingConversationService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i,loggerFactory:n}=e,{CallingConversationService:o}=yield Hk(i);return new o(t,n)})))(e))),FT=(e,t)=>()=>e.userServicesCache(gk.SharepointShareService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:i,coreSettings:n,loggerFactory:o,send:r,scenarioFactory:s}=e,{SharepointShareService:a}=yield tw(s);return new a(r,i,o,n,yield t())})))(e,t))),OT=(e,t)=>()=>e.userServicesCache(gk.FilesRedeemService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:i,coreSettings:n,loggerFactory:o,send:r,scenarioFactory:s}=e,{FilesRedeemService:a}=yield tw(s);return new a(r,i,o,n,yield t())})))(e,t))),MT=(e,t,i)=>()=>i.userServicesCache(gk.FilesSharepointUrlService,(()=>((e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:n,coreSettings:o}=i,{FilesSharepointUrlService:r}=yield tw(n);return new r(yield e(),yield t(),o)})))(e,t,i))),RT=(e,t)=>()=>t.userServicesCache(gk.FilesReferenceService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:i,coreSettings:n}=t,{FilesReferenceService:o}=yield rb(i);return new o(yield e(),n)})))(e,t))),PT=(e,t)=>()=>e.userServicesCache(gk.FileUploadPreviewService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:i,scenarioFactory:n}=e,{FileUploadPreviewService:o}=yield sb(n);return new o(yield t(),i)})))(e,t))),LT=(e,t)=>()=>e.userServicesCache(gk.FileUploadService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:i,scenarioFactory:n,coreSettings:o}=e,{FileUploadService:r}=yield sb(n);return new r(yield t(),o,i)})))(e,t))),UT=e=>()=>e.userServicesCache(gk.FileDownloadManagerService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,loggerFactory:i}=e,{FileDownloadManagerService:n}=yield ab(t);return new n(i.newLogger("fileDownloadManagerService","data-services-common"))})))(e))),WT=(e,t)=>()=>e.userServicesCache(gk.PersonalFileDetailsService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{discover:i,gtmRegistry:n,loggerFactory:o,scenarioFactory:r,send:s,endpointsManager:a,coreSettings:l}=e,c=yield t(),{PersonalFileDetailsService:d}=yield Bb(r),u=new Tl.q(i);return new d(c,r,o,n.bind(u.authorize(s,"x-skypetoken"),"middleTier"),a,l)})))(e,t))),BT=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,send:n,discover:o,endpointsManager:r,coreSettings:s}=e,{RefreshSiteUrlService:a}=yield i.e(606545).then(i.bind(i,18204));return new a(t,o,n,r,s)})),$T=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{gtmRegistry:t,discover:n,loggerFactory:o,send:r,endpointsManager:s,coreSettings:a}=e,{CloudStorageFoldersService:l}=yield i.e(134125).then(i.bind(i,95391));return new l(t,n,o,r,s,a)})),HT=e=>()=>e.userServicesCache(gk.CloudStorageFoldersService,(()=>$T(e))),qT=e=>()=>e.userServicesCache(gk.FilesBackfillThreadPropertiesService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{discover:t,gtmRegistry:i,scenarioFactory:n,loggerFactory:o,send:r,endpointsManager:s,coreSettings:a}=e,{FilesBackfillThreadPropertiesService:l}=yield rb(n),c=new Tl.q(t);return new l(o,i.bind(c.authorize(r,"x-skypetoken"),"middleTier"),s,a)})))(e)));var zT=i(872177);const VT=(e,t=el.l)=>(i,n=zT.hO.BEARER)=>{var o,r;return i?null!==(r=null===(o=e.authorizeV2)||void 0===o?void 0:o.call(e,t,i,{scheme:n}))&&void 0!==r?r:e.authorize(t,i):t},GT=(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:i,authenticationService:n,loggerFactory:o,coreSettings:r}=t,s=JT(r),a=KT(r,s)||"",l=QT(r,s)||"",c=VT(n),{ItemUploadService:d,ItemDeleteService:u,ItemDetailsService:m}=yield Sw(i),g=o.newLogger(e,"data-services-common");switch(e){case gk.ItemUploadService:return new d(c,s,a,l,g);case gk.ItemDeleteService:return new u(c,s,g);case gk.ItemDetailsService:return new m(c,s,g,r);default:return}})),JT=e=>!!e.get(b.J.Files).preferGraphOverVroom,KT=(e,t)=>t?e.get(b.J.Files).graphEndpointBaseUrl:e.get(b.J.Files).vroomEndpointBaseUrl,QT=(e,t)=>t?e.get(b.J.Files).graphAuthScope:e.get(b.J.Files).vroomAuthScope,YT=e=>()=>e.userServicesCache(gk.ItemUploadService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return yield GT(gk.ItemUploadService,e)})))(e))),XT=e=>()=>e.userServicesCache(gk.ItemDeleteService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return yield GT(gk.ItemDeleteService,e)})))(e))),ZT=e=>()=>e.userServicesCache(gk.ItemDetailsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return yield GT(gk.ItemDetailsService,e)})))(e))),eI=e=>()=>e.userServicesCache(gk.DriveItemShareService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t}=e,{DriveItemShareService:i}=yield tw(t),{authenticationService:n,coreSettings:o}=e,r=JT(o);return new i(VT(n),r)})))(e))),tI=(e,t)=>()=>e.userServicesCache(gk.VideoFileService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{coreSettings:i,loggerFactory:n,send:o,scenarioFactory:r}=e,{VideoFileService:s}=yield tw(r);return new s(o,n,i,yield t())})))(e,t))),iI=e=>()=>e.userServicesCache(gk.FilesValidDomainsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i,loggerFactory:n,localStorage:o,coreSettings:r}=e,{FilesValidDomainsService:s}=yield rb(i);return new s(t,n,o,r)})))(e))),nI=e=>()=>e.userServicesCache(gk.FilesSiteResourceInfoService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i,loggerFactory:n}=e,{FilesSiteResourceInfoService:o}=yield rb(i);return new o(t,n)})))(e))),oI=(e,t)=>()=>e.userServicesCache(gk.VideoMessageUploadService,(()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:i,scenarioFactory:n,offlineCacheManager:o,discover:r,coreSettings:s,i18n:a}=e,{VideoMessageUploadService:l}=yield Uw(n);return new l(yield t(),o,n,i,r,s,(0,F.J)(),a)})))(e,t))),rI=e=>()=>e.userServicesCache(gk.CalendarService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,send:i,authenticationService:n,coreSettings:o,discover:r,loggerFactory:s,platformService:a,i18n:l}=e,{CalendarService:c}=yield Wk(t);return new c(i,n,r,o,s,a,l)})))(e))),sI=e=>()=>e.userServicesCache(gk.ExternalCalendarEmailAddressService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,endpointsManager:i}=e,{ExternalCalendarEmailAddressService:n}=yield ob(t);return new n(i)})))(e))),aI=e=>()=>e.userServicesCache(gk.TeamCalendarService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,send:i,authenticationService:n,coreSettings:o,discover:r,loggerFactory:s,platformService:a,i18n:l}=e,{TeamCalendarService:c}=yield Wk(t);return new c(i,n,r,o,s,a,l)})))(e))),lI=e=>()=>e.userServicesCache(gk.SubstrateMeetingRecommendationsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,send:i,authenticationService:n,loggerFactory:o}=e,{SubstrateMeetingRecommendationsService:r}=yield Xb(t);return new r(i,n,o)})))(e))),cI=e=>()=>e.userServicesCache(gk.CommonSubstrateService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t,loggerFactory:i,platformService:n,authenticationService:o,endpointsManager:r,windowProvider:s,coreSettings:a}=e,{CommonSubstrateService:l}=yield Yb(t);return new l(s,i,o,n,a,r)})))(e))),dI=e=>()=>e.userServicesCache(gk.SignalsService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,config:i,coreSettings:n,scenarioFactory:o,send:r}=e;if(!i)throw new Error("config not set on IUserServicesFactoryContext");const{SignalsService:s}=yield nw(o);return new s(t,n,r,i)})))(e))),uI=e=>()=>e.globalServicesCache(hk.ExampleGlobalService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{scenarioFactory:t}=e,{ExampleService:i}=yield $b(t);return new i})))(e))),mI=e=>()=>e.globalServicesCache(hk.GlobalCallingService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{GlobalCallingService:t}=yield Promise.all([i.e(400010),i.e(177422),i.e(718291),i.e(137706),i.e(409201),i.e(901241),i.e(29311),i.e(736096),i.e(244586),i.e(883410),i.e(175925)]).then(i.bind(i,713743));return new t(e)})))(e))),gI=e=>()=>e.globalServicesCache(hk.MTMAUserDataService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{authenticationService:t,coreSettings:i,hostCommunicationService:n,loggerFactory:o,scenarioFactory:r,workerCacheManager:s}=e,{MTMAUserDataService:a}=yield Rw(r),l=new a({authenticationService:t,hostCommunicationService:n,loggerFactory:o,workerCacheManager:s,coreSettings:i});return i.get(b.J.CdlWorker).enableMTMAUserDataInMaglevStorage&&(yield l.startup()),l})))(e))),hI=e=>()=>e.globalServicesCache(hk.WebAppSwitcherService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{crossTabsService:t,localStorage:i,loggerFactory:n,scenarioFactory:o}=e,{WebAppSwitcherService:r}=yield Mw(o);return new r(i,n,t)})))(e)));var pI=i(342097);class vI{constructor(e,t,i,n){this.coreSettings=t,this.hostCommunicationService=i,this.i18n=n,this.mainAccountId="",this.badgeCounts=new Map,this.presenceCache=new Map,this.getBadge=e=>({icon:{countBadge:{value:e}}}),this.getGlyphBadge=e=>({icon:{glyphBadge:{glyph:e}}}),this.logger=e.newLogger(pI.d5,"services-io-taskbar")}setPresenceForCurrentAccount(e,t){this.logger.log(`Set presence for with accountId: ${e} and presence: ${t.status}`),this.presenceCache.set(e,t.status),0===this.badgeCounts.get(e)&&this.showPresenceForCurrentAccount(e)}showBadgeForCurrentAccount(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let i=!1;const n=e?this.presenceCache.get(e):_.t.unknown;if(this.enableCoherenceBadgeForWindows&&(this.logger.log(`Show badge for current account event accountId: ${e} with badgeCount: ${t}`),this.badgeCounts.set(e,t),this.mainAccountId&&this.mainAccountId===e)){this.logger.log("Main account badge update");const e=t>9?"9+":t.toString(),o=this.getBadge(t);o.altText=this.i18n.stringTranslate("toastNotifications","taskbar_presence_status_with_count",{count:e,presenceStatus:n}),yield this.showBadgeCommand(o),i=!0}return i}))}resetBadge(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log("Reset badge event"),yield this.showBadgeCommand(this.getBadge(0))}))}showBadge(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let i=!1;if(this.enableCoherenceBadgeForMac){this.logger.log(`Show badge event with accountId: ${e} and badgeCount: ${t}`),this.badgeCounts.set(e,t);const n=Array.from(this.badgeCounts.values()).reduce(((e,t)=>e+t),0);yield this.showBadgeCommand(this.getBadge(n)),i=!0}return i}))}updateMainAccountId(e){this.logger.log(`Main account id updated event ${e}`),this.mainAccountId=e}restoreBadge(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=this.badgeCounts.get(e),i=t||0;return this.logger.log(`Restored badge event for account id ${e} with badge count ${i}`),this.showBadgeForCurrentAccount(e,i)}))}showPresenceForCurrentAccount(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e!==this.mainAccountId)return!1;let t=!1;this.logger.log(`Show presence for current account ${e}`);const i=this.presenceCache.get(e);if(!this.enablePresenceStatusTaskbar)return t;if(i){this.logger.log(`Show presence update event with presence: ${i}`);const e=this.getGlyphBadge(i);e.altText=this.i18n.stringTranslate("toastNotifications","taskbar_presence_status_no_items",{presenceStatus:i}),yield this.showBadgeCommand(e),t=!0}else this.logger.log(`No presence available for account ${e}`),yield this.resetBadge();return t}))}restorePresenceForAccount(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=this.badgeCounts.get(e);let i=!1;if(0===(t||0)){const t=this.presenceCache.get(e),n=t||_.t.unknown;this.logger.log(`Restored presence event for account id ${e} with badge presence ${n}`),i=yield this.showPresenceForCurrentAccount(e)}return i}))}get enableTaskbarBadgeMaglev(){return!!this.coreSettings.get(b.J.Core).enableTaskbarBadgeMaglev}get enableCoherenceBadgeForWindows(){return!!this.coreSettings.get(b.J.Notifications).enableCoherenceBadgeForWindows}get enableCoherenceBadgeForMac(){return!!this.coreSettings.get(b.J.Notifications).enableCoherenceBadgeForMac}get enablePresenceStatusTaskbar(){return!!this.coreSettings.get(b.J.Notifications).enablePresenceStatusTaskbar}showBadgeCommand(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.enableTaskbarBadgeMaglev)return void this.logger.log(pI.vc.NotEnabled);const t=yield this.hostCommunicationService.loadModule("taskbar");if(t){if(t.showBadge)return this.logger.log(pI.Bd.UpdatedEvent),t.showBadge(e);this.logger.log(pI.vc.MethodNotAvailable)}else this.logger.log(pI.vc.ModuleUnableToLoad)}))}}const yI=e=>()=>e.globalServicesCache(hk.GlobalTaskbarService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{loggerFactory:t,coreSettings:i,hostCommunicationService:n,i18n:o}=e;return new vI(t,i,n,o)})))(e))),fI=e=>()=>e.userServicesCache(gk.HealthScenarioService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i,localStorage:n}=e,{HealthScenarioService:o}=yield Ib(i);return new o(t,n)})))(e))),SI=e=>()=>e.userServicesCache(gk.UnifiedConsentService,(()=>(e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{endpointsManager:t,scenarioFactory:i,authenticationService:n,cacheStorage:o,loggerFactory:r}=e,{UnifiedConsentService:s}=yield pw(i);return new s(t,n,o,r)})))(e))),kI=(e,t)=>{const{calendarServices:i,chatServices:n,fileServices:r,getAppsStoreService:s,getAsyncMediaService:a,getBotsPlatformService:l,getCallingAppEventsService:c,getCallingBannerService:d,getCallingDialogService:u,getCallingNotificationService:m,getCollabObjectService:g,getConnectedAccountsService:h,getDiscoverSurfaceService:p,getExternalAccountsService:v,getGoogleCalendarAuthenticationService:y,getMeetingRoomAppEventsService:f,getMsaAuthenticationService:S,getSharepointRestClient:k,getSmbUserIntentService:b,getTenantPrivacyProfileService:w,getThirdPartyCalendarService:C,getUserLicenseService:_,getStoreDevicesService:T,getOrganizationInfoService:I,videoMessageServices:j}=(e=>{const t=Bw(e),i=CI(e),n=$w(e),o=Hw(e,i.getChatService),r=_I(e,t,i.getChatService,n),s=TI(e,t),a=qw(e),l=zw(e),c=Vw(e),d=Gw(e),u=Jw(e,l,c,a),m=Kw(e,l,a),g=II(e),h=Qw(e),p=Yw(e,h),v=Xw(e,h),y=Zw(e,h),f=eC(e),S=tC(e),k=iC(e,S),b=nC(e),w=oC(e),C=rC(e),_=sC(e),T=aC(e);return{calendarServices:g,chatServices:i,fileServices:r,getAppsStoreService:lC(e),getAsyncMediaService:t,getBotsPlatformService:o,getCallingAppEventsService:h,getCallingBannerService:p,getCallingDialogService:v,getCallingNotificationService:y,getCollabObjectService:w,getConnectedAccountsService:a,getDiscoverSurfaceService:f,getExternalAccountsService:u,getGoogleCalendarAuthenticationService:l,getMeetingRoomAppEventsService:T,getMsaAuthenticationService:d,getSharepointRestClient:n,getSmbUserIntentService:k,getTenantPrivacyProfileService:b,getThirdPartyCalendarService:m,getUserLicenseService:S,getStoreDevicesService:C,getOrganizationInfoService:_,videoMessageServices:s}})(e),N={getCallingAppEventsService:c,getCallingBannerService:d,getCallingDialogService:u,getCallingNotificationService:m,getTenantPrivacyProfileService:w,getCalendarService:i.getCalendarService,getMeetingRoomAppEventsService:f},E=((e,t,i)=>(n,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const o=null==r?void 0:r.scenario;null==o||o.mark(U.ck.GetGlobalCallingService);const s=yield i.getGlobalCallingService();null==o||o.mark(U.ck.GlobalCallingServiceInitAccount);const a=yield s.initAccount({entryPoint:n,accountCtx:e,deps:t,telemetryContext:r});return Object.assign(Object.assign({},a),{dispose:(t,i)=>s.disposeAccount(t,i,e.authenticationUser)})})))(e,N,t),x=((e,t,i)=>()=>i.getGlobalCallingService().then((i=>i.deprecated_onAccountInitialized(e,t).then((t=>Object.assign(Object.assign({},t),{dispose:(t,n)=>i.disposeAccount(t,n,e.authenticationUser)}))))))(e,N,t);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},n),{getAiInsightsFeedbackService:cC(e),getAiInsightsSdsService:dC(e),getAppBasedLinkService:uC(e,l),getAppsPlatformService:mC(e),getAppsStoreService:s,getAppSuggestionsService:gC(e),getAsyncMediaService:a,getAugloopService:pC(e),getSubstrateBotPlatformService:vC(e),getComposeAugloopService:pC(e,!0),getAzureMapsService:yC(e),getBadgeCountService:fC(e),getBotsPlatformService:l,getBrbService:SC(e),getBreakoutRoomMiddleTierService:kC(e),getAtpSafelinksService:bC(e),getBroadcastAttendeeService:wC(e),getBroadcastStreamingAttendeeService:CC(e),getBroadcastCaptionsService:_C(e),getBroadcastSignalRService:TC(e)}),i),{getCallBlockingService:(A=e,()=>A.userServicesCache(gk.CallBlockingService,(()=>NC(A)))),getCallingAnonymousDisplayNameService:AC(e),getCallingAppEventsService:c,getCallingBannerService:d,getCallingDialogService:u,getCallingNotificationService:m,getCallingService:E,deprecated_getCallingServiceOnInitialized:x,getCmdMeetingIntelligenceService:DC(e),getCollabObjectService:g,getCommunitySettingsService:FC(e),getConnectedAccountsService:h,getConnectedCalendarSettingsService:OC(e),getBiometricEnrollmentService:MC(e),getBiometricFaceEnrollmentService:RC(e),getDeveloperSwitchersService:PC(e),getDistributionListService:LC(e),getDynamicsMarketingService:UC(e),getDynamicsVirtualEventsService:WC(e),getEmoticonService:BC(e),getEspService:$C(e),getExampleService:HC(e),getExternalAccountsService:v,getExternalAccountsResponseService:qC(e,h)}),r),j),{getFluidService:zC(e),getGalleryService:VC(e),getGiphyService:GC(e),getGoogleCalendarAuthenticationService:y,getGoogleContactsAuthenticationService:Vw(e),getGuardiansService:JC(e),getHealthScenarioService:fI(e),getImageProxyService:KC(e),getImmersiveReaderService:QC(e),getImportMsaContactsService:YC(S,e),getImplicitContactsService:XC(e),getInstantAnswersService:ZC(e),getInviteLinksService:e_(e),getLiveStateBroadcastService:t_(e),getLiveStreamRenderingService:i_(e),getLmsIntegrationService:n_(e),getLockedTeamsService:o_(e),getLogsFilesService:s_(e),getLokiService:a_(e),getManageTenantService:l_(e),getMeetingArtifactsService:c_(e),getMeetingBotService:d_(e,i.getCalendarService,n.getChatService),getMeetingIntelligenceService:u_(e),getMeetingOptionsClientDataService:h_(e),getMeetingOptionsService:p_(e),getMeetingQuestionsAndAnswersService:v_(e),getMeetingRecapService:y_(e),getMeetingRecapSwaService:f_(e),getMeetingRecapWorkingSetFilesService:S_(e),getMeetingRoomAppEventsService:f,getMeetingTemplateService:k_(e),getMsaAuthenticationService:S,getPaymentService:b_(e),getPeoplePickerService:w_(e),getPeopleService:m_(e),getPeopleTargetingService:C_(e)}),bI(e,b,_)),{getPoliciesService:__(e),getPresenceService:T_(e)}),wI(e)),{getODSLProcessingEngine:N_(e),getAddressService:x_(e),getPstnService:D_(e),getSCISService:F_(e),getSearchPrefetchService:O_(e)}),jI(e)),{getSharepointRestClient:k,getShareService:M_(e),getSmbUserIntentService:b,getStoreService:R_(e,T,s),getStoreDevicesService:T,getStyleMyRoomService:P_(e),getTenantMembershipService:L_(e),getTenantService:U_(e),getTenantAnalyticsService:W_(e),getTenantPrivacyProfileService:w,getTranscriptService:B_(e),getTranscriptFeedbackService:$_(e),getTranscriptSettingsStoreService:H_(e),getTranslateService:q_(e),getTargetingHierarchyService:z_(e),getThirdPartyCalendarService:C,getToastImageService:V_(e),getTeamsAndChannelsService:J_(e),getTpnNoticeService:K_(e),getUrlPreviewService:Q_(e,r.getFilesReferenceService),getUserProfileService:Y_(e),getVirtualEventsService:X_(e),getMeetingSchedulingService:Z_(e),getVoicemailService:iT(e),getWebinarService:nT(e),getCallRecordingService:oT(e),getUserLicenseService:_,getDiscoverSurfaceService:p,getMonetizationService:rT(e),getMRUItemService:sT(e),getDiscoverSurfaceFeedbackService:aT(e,p),getCollabCloudService:lT(e),getTFLUserService:cT(e),getSensitivityLabelPolicySettingsService:dT(e),getWaffleService:uT(e),getOrganizationInfoService:I,getVideoMessageCameraCommandService:mT(e)});var A},bI=(e,t,i)=>{const n=gT(e,t,i);return{getPetrolService:n,getFloodgateService:hT(e,n),getOdsService:pT(e,t,i)}},wI=e=>({getLokiMetaPreviewService:vT(e),getOdcFilePreviewService:yT(e),getOSearchService:fT(e),getPeopleSearchService:ST(e),getSubstrateFilesSearchService:kT(e),getSubstrateRecommendationsService:bT(e),getSubstrateSearchService:wT(e),getSubstrateSuggestionsService:CT(e),getSubstrateMeetingSearchService:_T(e),getSubstrateMeetingSummarySearchService:TT(e)}),CI=e=>{const t=IT(e),i=jT(e,t),n=NT(e),o=ET(e),r=xT(e);return{getChatService:t,getChatServiceEndpointProvider:i,getConsumerGroupsService:n,getCSAService:o,getReportConcernService:AT(e),getStatefulLongPoll:r,getUnifiedConsentService:SI(e),getCallingConversationService:DT(e)}},_I=(e,t,i,n)=>{const o=FT(e,n),r=OT(e,n),s=MT(o,r,e);return{getFilesRedeemService:r,getFilesReferenceService:RT(s,e),getFilesSharepointUrlService:s,getFileUploadPreviewService:PT(e,t),getFileUploadService:LT(e,n),getFileDownloadManagerService:UT(e),getPersonalFileDetailsService:WT(e,i),getRefreshSiteUrlService:(a=e,()=>a.userServicesCache(gk.RefreshSiteUrlService,(()=>BT(a)))),getCloudStorageFoldersService:HT(e),getFilesBackfillThreadPropertiesService:qT(e),getSharepointShareService:o,getItemUploadService:YT(e),getItemDeleteService:XT(e),getItemDetailsService:ZT(e),getDriveItemShareService:eI(e),getVideoFileService:tI(e,n),getFilesValidDomainsService:iI(e),getFilesSiteResourceInfoService:nI(e)};var a},TI=(e,t)=>({getVideoMessageUploadService:oI(e,t)}),II=e=>({getCalendarService:rI(e),getExternalCalendarEmailAddressService:sI(e),getTeamCalendarService:aI(e),getMeetingRecommendationsService:lI(e)}),jI=e=>({getCommonSubstrateService:cI(e),getSignalsService:dI(e)});function NI(e){const t=(i=Object.assign({globalServicesCache:mk},e),{getExampleGlobalService:uI(i),getGlobalCallingService:mI(i),getLogsFilesService:(n=i,()=>n.globalServicesCache(gk.LogsFilesService,(()=>r_(n)))),getGlobalMTMAUserDataService:gI(i),getGlobalWebAppSwitcherService:hI(i),getGlobalTaskbarService:yI(i)});var i,n;return Object.assign(Object.assign({entityType:"unknown",windowId:""},e),t)}class EI{static createGlobalDataRequestContext(e){if(EI._globalRequestContext)throw new Error("GlobalDataRequestContext is already created!");return EI._globalRequestContext=NI(e),EI._globalRequestContext}static createUserDataRequestContext(e,t){if(!EI._globalRequestContext)throw new Error("GlobalDataRequestContext has not been created!");return function(e,t,i){const n=Object.assign(Object.assign({},e),{userServicesCache:(new dk).getOrCreateServiceInstance}),{appsRegistryService:o,appStateService:r,authenticationService:s,authenticationUser:a,authStateProvider:l,cacheStorage:c,clientPreferences:d,clientState:u,commandChangeReportingService:m,coreSettings:g,discover:h,experienceChangeReportingService:p,hostCommunicationService:v,localStorage:y,loggerFactory:f,offlineCacheManager:S,platformService:k,pubsub:b,rebootService:w,scenarioFactory:C,userBiService:_,windowProvider:T,i18n:I,brbServiceManager:j,entityCommanding:N,userTrackingService:E,mediaAuthService:x}=e;return Object.assign(Object.assign(Object.assign({},t),{appsRegistryService:o,appStateService:r,authenticationUser:a,authenticationService:s,authStateProvider:l,cacheStorage:c,clientPreferences:d,clientState:u,commandChangeReportingService:m,coreSettings:g,discover:h,entityType:"unknown",experienceChangeReportingService:p,hostCommunicationService:v,localStorage:y,loggerFactory:f,mediaAuthService:x,offlineCacheManager:S,platformService:k,pubsub:b,rebootService:w,scenarioFactory:C,userBiService:_,windowId:"",windowProvider:T,i18n:I,brbServiceManager:j,entityCommanding:N,userTrackingService:E}),kI(Object.assign(Object.assign({},n),{cmdApolloClient:i}),t))}(e,EI._globalRequestContext,t)}static get globalRequestContext(){return EI._globalRequestContext}}function xI(e,t,n){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e.config.enableEmbedDataClient)return function(e,t,i){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{dataEvictionService:o,platformService:r,coreSettings:s,config:a}=e,{enableApolloDevtools:l}=s.get(b.J.Diagnostics),c=new th.pS,{defaultContext:d,link:u}=yield PI(e,i,c),m=null===(n=d.leakDetectorService)||void 0===n?void 0:n.create(),g=AI(e,c,m,u,d.loggerFactory,d.scenarioFactory)({windowId:f.ew,entityType:i,viewportContext:e.windowProvider.viewportContext,name:"embed",storeType:ih.t.embed});return gh(g,"embed",Boolean(l),r,a.experienceName),new _h({pubsub:c,leakDetector:m,scenarioFactory:d.scenarioFactory,coreSettings:d.coreSettings,dataOpsTracker:t,dataEvictionService:LI(o)?o:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},g,d)}))}(e,t,n);const{enableMTMA:r}=e.coreSettings.get(b.J.Core);return r?function(e,t,n){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:o,dataEvictionService:s}=e,a=new th.pS,{defaultContext:l,link:c}=yield PI(e,n,a,{noCDLTerminatingLink:!0}),d=null===(r=l.leakDetectorService)||void 0===r?void 0:r.create(),u=AI(e,a,d,c,l.loggerFactory,l.scenarioFactory),{enableApolloDataEviction:m,enableViewSchema:g,enableRelay:h,enableRelayLiveResolverStore:p,relayGCReleaseBufferSize:v}=o.get(b.J.Core);let y,f;if(g&&(y=FI(e,a,d,dp.createViewSchemaLink(e),l.loggerFactory,l.scenarioFactory)),h){const{createRelayEnvironment:e}=i(807510);f=yield e({isLiveResolverEnabled:!0===p,link:c,loggerFactory:l.loggerFactory,userBiService:l.userBiService,configName:"mtma-core",gcReleaseBufferSize:v})}return new lk({pubsub:a,leakDetector:d,scenarioFactory:l.scenarioFactory,coreSettings:l.coreSettings,dataOpsTracker:m?t:void 0,dataEvictionService:m&&LI(s)?s:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},u,l,y,f)}))}(e,t,n):function(e,t,n){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:o,dataEvictionService:s}=e,a=new th.pS,{defaultContext:l,link:c}=yield PI(e,n,a),d=null===(r=l.leakDetectorService)||void 0===r?void 0:r.create(),u=AI(e,a,d,c,l.loggerFactory,l.scenarioFactory),{enableApolloDataEviction:m,enableViewSchema:g,enableRelay:h,enableRelayLiveResolverStore:p,relayGCReleaseBufferSize:v}=o.get(b.J.Core);let y,f;if(g&&(y=FI(e,a,d,dp.createViewSchemaLink(e),l.loggerFactory,l.scenarioFactory)),h){const{createRelayEnvironment:e}=i(807510);f=yield e({isLiveResolverEnabled:!0===p,link:c,loggerFactory:l.loggerFactory,userBiService:l.userBiService,configName:"core",gcReleaseBufferSize:v})}return new Ch({pubsub:a,leakDetector:d,scenarioFactory:l.scenarioFactory,coreSettings:l.coreSettings,dataOpsTracker:m?t:void 0,dataEvictionService:m&&LI(s)?s:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},u,l,y,f)}))}(e,t,n)}))}function AI(e,t,i,n,o,r,s,a){const{appsRegistryService:l,coreSettings:c,platformService:d,config:u,graphqlStoreStatsReporterService:m}=e;let g;g=s||sk.create(t);const{maxApolloResultCacheSize:h,enableApolloDoubleWriteFix:p}=c.get(b.J.Core),{enableApolloDevtools:v}=c.get(b.J.Diagnostics),y=null!=h?h:void 0;return({windowId:e,entityType:t,viewportContext:s,name:c,overrideLink:h,storeType:f})=>{const S=l.getRegisteredAppsTypePolicies(e),k=DI({leakDetector:i,windowId:e,entityType:t,viewportContext:s,userContextId:a},h||n,g,y,o,r,S,v,f,m,p);return gh(k,c,Boolean(v),d,u.experienceName),k}}const DI=(e,t,i,n,o,r,s,a,l,c,d)=>{const u=(0,sh.aw)({typePolicies:fp(null==s?void 0:s.typePolicies),possibleTypes:oh.g_h,dataIdFromObject:nh.X,resultCacheMaxSize:n,apolloLeakOptions:e,loggerFactory:o,scenarioFactory:r,storeType:l,graphqlStoreStatsReporterService:c,enableApolloDoubleWriteFix:d}),m=(0,sh.nl)({cache:u,link:t,resolvers:i,defaultOptions:{watchQuery:{nextFetchPolicy:Sp}},apolloLeakOptions:e,loggerFactory:o,enableApolloDevtools:a,storeType:l,graphqlStoreStatsReporterService:c,notifyOnTeardown:!1,enableApolloDoubleWriteFix:d});return Fh(u,o,null==s?void 0:s.defaultTypeName),m};function FI(e,t,i,n,o,r){const{coreSettings:s,platformService:a,config:l,graphqlStoreStatsReporterService:c}=e,{maxApolloResultCacheSize:d,enableApolloDoubleWriteFix:u}=s.get(b.J.Core),{enableApolloDevtools:m}=s.get(b.J.Diagnostics),g=null!=d?d:void 0;return({windowId:e,entityType:t,viewportContext:s,name:d,overrideLink:h,storeType:p})=>{const v=OI({leakDetector:i,windowId:e,entityType:t,viewportContext:s},h||n,{},g,o,r,p,c,u);return gh(v,d,Boolean(m),a,l.experienceName),v}}const OI=(e,t,i,n,o,r,s,a,l)=>{const c=(0,sh.aw)({typePolicies:{PresenceAvailability:{merge:!0},PresenceOutOfOfficeStatus:{merge:!0},PresenceStatusNote:{merge:!0},ViewData:{merge:!0}},possibleTypes:rh.g,dataIdFromObject:nh.X,resultCacheMaxSize:n,apolloLeakOptions:e,loggerFactory:o,scenarioFactory:r,storeType:s,graphqlStoreStatsReporterService:a});return(0,sh.nl)({cache:c,link:t,resolvers:i,defaultOptions:{watchQuery:{nextFetchPolicy:Sp}},apolloLeakOptions:e,loggerFactory:o,storeType:s,graphqlStoreStatsReporterService:a,enableApolloDoubleWriteFix:l})},MI=(e,t,i)=>{const{activeWindowsService:n,appsRegistryService:o,appStateService:r,cdlAppStateService:s,authenticationService:a,authenticationUser:l,cacheStorage:c,clientPreferences:d,clientState:u,commandChangeReportingService:m,coreSettings:g,discover:h,dataEvictionService:p,experienceChangeReportingService:v,hostCommunicationService:y,leakDetectorService:S,localStorage:k,loggerFactory:b,notificationsHandler:w,offlineCacheManager:C,platformService:_,rebootService:T,scenarioFactory:I,userBiService:j,windowProvider:N,i18n:E,brbServiceManager:x,entityCommanding:A,userTrackingService:D}=e;return{activeWindowsService:n,appsRegistryService:o,appStateService:r,cdlAppStateService:s,authenticationService:a,authenticationUser:l,cacheStorage:c,clientPreferences:d,clientState:u,commandChangeReportingService:m,coreSettings:g,discover:h,dataEvictionService:p,entityType:i,experienceChangeReportingService:v,hostCommunicationService:y,leakDetectorService:S,localStorage:k,loggerFactory:b,notificationsHandler:w,offlineCacheManager:C,platformService:_,pubsub:t,rebootService:T,scenarioFactory:I,userBiService:j,windowId:f.ew,windowProvider:N,i18n:E,brbServiceManager:x,entityCommanding:A,userTrackingService:D}},RI=(e,t)=>{const i=(0,ah.v)(((t,i)=>Object.assign(Object.assign({},e),i)));return lh.i.from([i,t])};function PI(e,t,i,{noCDLTerminatingLink:n}={}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{networkState:o}=e,r=(0,Za.UZ)(el.l,o.observeIsOnline()),s=Object.assign(Object.assign({},e),{pubsub:i,send:r}),a=EI.createGlobalDataRequestContext(s),l=yield dp.createSingletonLink(Object.assign({contextValue:a,noCDLTerminatingLink:n},s));return{defaultContext:MI(e,i,t),link:l}}))}function LI(e){if(!e)return!1;const t=e;return"function"==typeof t.register&&"function"==typeof t.unregister}class UI extends Ce.i{constructor(){super(f.Yg.CreateDataClient,["scenarioFactory","loggerFactory","windowProvider","coreSettings","platformService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{scenarioFactory:t,loggerFactory:i,windowProvider:n,coreSettings:o,platformService:r}=e,{enableApolloDataEviction:s,disableApolloMissingChatMessageFix:a,maxApolloCacheOperationCount:l}=e.coreSettings.get(b.J.Core);(0,Dg.x)({disableApolloMissingChatMessageFix:null!=a&&a});const c=new Zg({activeOperationLimit:l});e.dataCleanupService=c,s&&(e.dataEvictionService=new eh(c,t,i,n));const d=yield xI(Object.assign(Object.assign({},e),{pulsar:this.createDataClientPulsarInstance(o,i,r)}),c,"default");e.client=d}))}createDataClientPulsarInstance(e,t,i){const{enablePulsarTelemetry:n,logToOTLCollector:o}=e.get(b.J.Pulsar),r=new $o(Po.TEAMS_RESOLVER,{sessionId:i.host.sessionId,spanExporter:new Ho,loggerFactory:t,logToOTLCollector:!!o});return n&&r.initialize(),r}}var WI=i(815306),BI=i(541986),$I=i(719388);const HI={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeWindow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}}]},qI={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindows"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isMainWindow"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}}},arguments:[]}]}}]};var zI,VI;!function(e){e[e.Other=1]="Other",e[e.Main=2]="Main",e[e.Flyout=3]="Flyout",e[e.Minimode=4]="Minimode"}(zI||(zI={})),function(e){e.MatchingPendingIntentFound="MatchingPendingIntentFound",e.IntentOverriddenByOnBeforeAuth="IntentOverriddenByOnBeforeAuth",e.IntentOverriddenByOnAfterAuth="IntentOverriddenByOnAfterAuth"}(VI||(VI={}));var GI=i(766052);const JI=e=>e.get(b.J.Auth).buildCloud,KI=(e,t)=>{var i;const n=null==t?void 0:t.get(b.J.Auth).cloudDomainMap;if(!n)return;const o=null===(i=n.find((t=>t.domain===e)))||void 0===i?void 0:i.cloud;return o?Es.G7[o]:void 0};function QI(e,t){return KI(e.host,t)}function YI(e,t){return!!e&&KI(e,t)!==JI(t)}function XI({coreSettings:e,logger:t,userContextId:i,waitForRenderingContextReady:n}){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=!!(null===(r=null==e?void 0:e.get(b.J.Auth))||void 0===r?void 0:r.enableIntegratedAuthApp);return t.log(`getUserContext(${i})`),n(o,i)}))}function ZI(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,correlation:i,logger:n,waitForRenderingContextReady:r}=e,s=yield XI({coreSettings:t,logger:n,waitForRenderingContextReady:r}),a=yield function(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield e.getUser({correlation:{id:t.id,scenarioName:t.scenarioName,source:t.source},accountId:i})}catch(e){return}}))}(s.authenticationService,i),l=null==a?void 0:a.id;return n.log(`getMainWindowUserId returns ${l}`),l}))}function ej(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{commandChangeReportingService:t,correlation:i,userContextId:n,userContextAccountType:o}=e,r=e=>t.report({type:e,correlationId:i.id,context:{target:"get-deeplink-user-context",eventData:{commandSource:i.source,deeplinkGetUserContextAccountType:GI.K[o],deeplinkGetUserContextId:n,scenarioPhase:"Core"}}});try{r(Ae.B.WaitForUserContextStarted);const t=yield XI(e);return r(Ae.B.WaitForUserContextCompleted),{context:{client:t.client},userContextId:n,userContextAccountType:o}}catch(e){return void t.report({type:Ae.B.WaitForUserContextFailed,correlationId:i.id,context:{target:"get-deeplink-user-context",errorInfo:De.y.CreateUserContextError,eventData:{commandSource:i.source,deeplinkGetUserContextAccountType:GI.K[o],deeplinkGetUserContextId:n,scenarioPhase:"Core",errors:e instanceof je.G&&je.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():`${e}`}}})}}))}function tj(e,t,i,n,r,s){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{id:o,source:a}=r;t.report({type:Ae.B.IntentExecuted,correlationId:o,context:{target:"launch-cloud",eventData:{commandSource:a,scenarioPhase:"Core"}}});try{const r=yield n.loadModule("core");if(!(null==r?void 0:r.launchCloud))throw Error("launchCloud not implemented in auth module");yield r.launchCloud({cloudType:e,deepLink:i,userContextId:s,correlation:{id:o,source:a}}),t.report({type:Ae.B.IntentTransferredCrossCloud,correlationId:o,context:{target:"launch-cloud",eventData:{commandSource:a,scenarioPhase:"Core"}}})}catch(e){const i=new Ne.G(Ne.$.LAUNCH_CLOUD_DEEPLINK_ERROR,e);throw t.report({type:Ae.B.Failure,correlationId:o,context:{target:"launch-cloud",errorInfo:De.y.DeeplinkLaunchCrossCloudError,eventData:{commandSource:a,scenarioPhase:"Core",errorCode:i.toTelemetryEntry()}}}),i}}))}const ij={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeAuthenticatedUser"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAuthenticatedUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}}]},nj="intent-service";function oj(e,t,i,n,r){return(0,o.__awaiter)(this,void 0,void 0,(function*(){n.log(`Executing Intent in windowId: ${r}`);const t=function(e,t){if(t){const i=(0,L.cloneDeep)(e.entityCommand);return i.command.stateTransition=i.command.stateTransition===ve.su.extend?ve.su.extend:ve.su.flush,i.command.__UNSAFE_windowId=t,i}return e.entityCommand}(i,r),o=yield e(t,i.scenarioCorrelation.clientLaunchId);return n.log(`Command execution happened in windowId: ${o}`),o}))}function rj(e,t,i,n,o){return{shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:$e({entity:i,entityOptions:o,command:{visibilityState:ve.fe.show,stateTransition:ve.su.forceFlush,layoutMode:n,correlation:t.correlation}}),metadata:{allowAnonymous:!1,deepLink:e},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}}}function sj(e){const t=e.entityCommand.entity.type,i=e.entityCommand.command.layoutMode;return i===ve.lO.minimode?zI.Minimode:t===pe.py.flyout||i===ve.lO.minimal?zI.Flyout:i===ve.lO.focus?zI.Other:zI.Main}function aj({commandHandler:e,commandChangeReportingService:t,error:i,errorInfo:n,errorMessage:r,fallbackError:s,intent:a,logger:l,newCommandType:c,windowId:d,delegatedCommanding:u}){var m;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(null===(m=l.errorToTelemetry)||void 0===m||m.call(l,r,"webclient_framework_foundation_core_services_intent"),t.report({type:c,correlationId:a.scenarioCorrelation.correlation.id,context:{target:nj,errorInfo:n,eventData:{errors:i instanceof je.G&&je.G.isFunction(i.toTelemetryEntry)?i.toTelemetryEntry():`${i}`}}}),a.shouldRenderContent)return function(e,t,i,n,r,s,a){var l;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o;try{if(!(i instanceof je.G))throw i;o=i.serialize()}catch(e){null===(l=t.errorToTelemetry)||void 0===l||l.call(t,`Failed to serialize error: ${e}`,"webclient_framework_foundation_core_services_intent"),o=null==a?void 0:a.serialize()}const s=Object.assign(Object.assign({},n),{entityCommand:{entity:{type:pe.py.error,action:pe.uk.view},entityOptions:{serializedError:o},command:Object.assign(Object.assign({},n.entityCommand.command),{layoutMode:ve.lO.focus})}});return oj(e,0,s,t,r)}))}(e,l,i,a,d,0,s)}))}var lj;function cj(e,t){const i=pe.py.identity;let n=e.entityCommand.command;return t===ve.fe.show?n={visibilityState:ve.fe.show,stateTransition:ve.su.new,layoutMode:ve.lO.focus,correlation:e.scenarioCorrelation.correlation}:t===ve.fe.hide&&(n={visibilityState:ve.fe.hide,stateTransition:ve.su.flush,layoutMode:ve.lO.focus,correlation:e.scenarioCorrelation.correlation}),{shouldRenderContent:!0,scenarioCorrelation:e.scenarioCorrelation,entityCommand:{command:n,entity:{type:i,action:pe.uk.loading},entityOptions:{tenantId:e.metadata.tenantId}},metadata:e.metadata}}!function(e){e[e.pending=0]="pending",e[e.fulfilled=1]="fulfilled",e[e.rejected=2]="rejected"}(lj||(lj={}));const dj=(e,t)=>{var i,n,o,r;const s=null!==(n=null===(i=null==t?void 0:t.get(b.J.Auth))||void 0===i?void 0:i.enableLoadingScreenInMeetings)&&void 0!==n&&n,a=null!==(r=null===(o=null==t?void 0:t.get(b.J.Auth))||void 0===o?void 0:o.enableMTO)&&void 0!==r&&r;return!e.shouldRenderContent||!(s&&a)||e.scenarioCorrelation.correlation.source===k.D.ExternalCommand||!(e.entityCommand.entity.type===pe.py.meetings||e.entityCommand.entity.type===pe.py.callingdeeplink||e.entityCommand.entity.type===pe.py.channels)};function uj(e){const t=(0,L.cloneDeep)((0,L.omit)(e,["options"]));return e.shouldRenderContent?Object.assign(Object.assign({},t),{metadata:(0,L.omit)(t.metadata,["shouldTargetSourceWindow"])}):t}function mj(e,t,i,n,r){var s,a,l,c,d;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o,u,m;switch(n){case"onBeforeIntentAuthenticated":o=yield null===(s=i.onBeforeIntentAuthenticated)||void 0===s?void 0:s.execute(r);break;case"onAfterIntentAuthenticated":o=yield null===(a=i.onAfterIntentAuthenticated)||void 0===a?void 0:a.execute(r);break;default:{const e=`evaluateHook(${n}): Unknown hook and options.`;throw null===(l=t.errorToTelemetry)||void 0===l||l.call(t,e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}}if(!o){const e=`evaluateHook(${n}): Undefined app hook response.`;throw null===(c=t.errorToTelemetry)||void 0===c||c.call(t,e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}switch(o.overrideType){case GI.U.NoOverride:m=!1,u=r.intent;break;case GI.U.OverrideCloud:m=!0,u=Object.assign(Object.assign({},r.intent),{metadata:Object.assign(Object.assign({},r.intent.metadata),{cloud:o.cloud})});break;case GI.U.OverrideIntent:m=!0,u=o.intent;break;case GI.U.OverrideUserContext:m=!1,u=Object.assign(Object.assign({},r.intent),{metadata:Object.assign(Object.assign({},r.intent.metadata),{userContextId:o.userContextId})});break;case GI.U.TerminateNavigation:m=!0,u=void 0;break;default:const e=`evaluateHook(${n}): Invalid app hook override type.`;throw null===(d=t.errorToTelemetry)||void 0===d||d.call(t,e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}if(e.report({correlationId:r.intent.scenarioCorrelation.correlation.id,type:Ae.B.IntentHookResolved,context:{target:nj}}),u&&r.intent.shouldRenderContent!==u.shouldRenderContent)throw new Ne.G(Ne.$.INVALID_INTENT_OVERRIDE);return{intentOverridenByHook:m,intent:u}}))}var gj=i(663945);const hj=(e,t,i,n,r,s,a)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var l,c,d;const u={};u["Foundation.deeplinkWindowTarget"]=(e=>{const t=e.entityCommand.command,{stateTransition:i,layoutMode:n,targetWindow:o}=t;switch(n){case ve.lO.minimal:return"flyout";case ve.lO.minimode:return"minimode";default:return i===ve.su.new?"child":i===ve.su.flush||i===ve.su.forceFlush||o===ve.PH.main?"main":void 0}})(e),u["Foundation.accountType"]=yield((e,t,i,n,r)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const o=yield ZI({coreSettings:i,logger:n,waitForRenderingContextReady:r,correlation:e.scenarioCorrelation.correlation});return o?t&&e.metadata.userContextId?e.metadata.userContextId===o?"main":"background":"unknown":"preauth"})))(e,t,i,n,r);const m=(null===(d=null===(l=s.getApp({entityType:e.entityCommand.entity.type}))||void 0===l?void 0:(c=l.manifest).getAllowUserWindowingPreference)||void 0===d?void 0:d.call(c,{coreSettings:i,entity:e.entityCommand.entity}))||!1;u["Foundation.isUserPreferenceOverriddenByApp"]=!m,a.recordPanelAction({actionGesture:gj.uS.auto,actionOutcome:gj.$K.open,actionScenario:gj.Tk.deeplink,actionScenarioType:gj.Yu.deeplink,moduleType:gj.PO.intent,moduleName:gj.rA.intentService,dataBag:{id:"",data:Object.assign({},u),dispose:()=>{}},mainEntityType:e.entityCommand.entity.type,mainEntityAction:e.entityCommand.entity.action},n)})),pj="intent-service",vj="none";class yj{constructor(e,t,i,n,o,r,s,a,l,c,d,u,m,g){this.appsRegistryService=t,this.coreSettings=i,this.commandHandler=n,this.client=o,this.waitForRenderingContextReady=r,this.commandChangeReportingService=s,this.experienceChangeReportingService=a,this.scenarioFactory=l,this.hostComms=c,this.host=d,this.activeWindowsService=u,this.userBiService=m,this.delegatedCommanding=g,this.pendingIntentMap=new Map,this.logger=e.newLogger("IntentService","core-services-deeplink"),u.enableDecoupleCommandingFromApollo?this.observeActiveWindows():this.observeActiveWindowsDeprecated(),this.hasCreatedNonMainWindow=!1}execute(e,t){var i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logInternal("execute: Original intent:",e);let o,r,s=e.shouldRenderContent&&e.metadata.shouldTargetSourceWindow?null===(i=e.options)||void 0===i?void 0:i.sourceWindowId:void 0;if(e.shouldRenderContent){r=sj(e),yield this.cleanupActiveWindowsIfNeeded(r);const t=this.pendingIntentMap.get(r);t&&(s=t.windowId,o=VI.MatchingPendingIntentFound,this.logInternal(`execute: Replacing intent for window id: ${s} with layout type ${r}:`,e)),this.pendingIntentMap.set(r,{intent:(0,L.cloneDeep)(e),windowId:s})}this.logInternal("execute: Intent for evaluation:",e),this.commandChangeReportingService.report({correlationId:e.scenarioCorrelation.correlation.id,type:Ae.B.IntentReceived,context:{target:pj,eventData:{mainEntityType:e.shouldRenderContent?e.entityCommand.entity.type:vj,mainEntityAction:e.shouldRenderContent?e.entityCommand.entity.action:vj,errorCode:o}}}),e=function(e,t){var i,n;const{coreSettings:o,appsRegistryService:r}=t,{enableMinimodeWindow:s}=o.get(b.J.Core);s&&e.shouldRenderContent&&!(null===(i=e.options)||void 0===i?void 0:i.shouldSkipMinimodeOverride)&&e.entityCommand.command.stateTransition!==ve.su.extend&&e.entityCommand.command.stateTransition!==ve.su.none&&"com.microsoft.teams.chat"===(null===(n=r.getApp({entityType:e.entityCommand.entity.type}))||void 0===n?void 0:n.manifest.id)&&(e.entityCommand.command.layoutMode=ve.lO.minimode);return e}(e,{coreSettings:this.coreSettings,appsRegistryService:this.appsRegistryService});const{intentExecuted:a,targetWindowId:l}=yield this.executeInternal(e,s);if(yield null==t?void 0:t(),e.shouldRenderContent&&r)a?(this.logger.log("execute: Intent was not overriden and executed. Removing from state."),this.pendingIntentMap.delete(r)):(this.pendingIntentMap.set(r,{intent:(0,L.cloneDeep)(e),windowId:l}),this.logInternal(`execute: updated window ID: ${l}: For pending intent:`,e)),(null===(n=e.options)||void 0===n?void 0:n.isFromDeeplink)&&(yield this.sendDeeplinkUserBi(e,a));else if(!e.shouldRenderContent){const t=this.scenarioFactory.findScenario(U.RG.ApplicationLaunchTime);null==t||t.stop({mainEntityType:vj,reason:"nrc_background_launch"}),this.commandChangeReportingService.report({type:Ae.B.Blanked,correlationId:e.scenarioCorrelation.correlation.id,context:{target:"intent-service",eventData:{systemInitiated:!0,mainEntityType:vj}}})}this.experienceChangeReportingService.report({correlationId:e.scenarioCorrelation.correlation.id,type:ft.yU.NavigationIntentExecuted,context:{target:"intent-service",shouldRenderContent:e.shouldRenderContent}})}))}checkForPendingIntent(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){for(const[i,{intent:n,windowId:o}]of Array.from(this.pendingIntentMap)){const r=(0,L.cloneDeep)(n);if(r){this.commandChangeReportingService.report({correlationId:e.id,type:Ae.B.IntentReceived,context:{target:pj,eventData:{mainEntityType:r.entityCommand.entity.type,mainEntityAction:r.entityCommand.entity.action}}}),r.entityCommand.command.visibilityState=ve.fe.showWithoutFocusing,r.metadata.userContextId=t,r.entityCommand.command.correlation=e,r.scenarioCorrelation.correlation=e,this.logInternal("checkForPendingIntent: Executing pending intent:",r);const{intentExecuted:n}=yield this.executeInternal(r,o,!0);n&&(this.logger.log("checkForPendingIntent: Intent was not overriden and executed. Removing from state."),this.pendingIntentMap.delete(i))}}}))}switchAccount(e,t,i,n,r){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.logger.log("switchAccount"),this.execute({shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:$e({entity:i,entityOptions:r,command:{visibilityState:ve.fe.show,stateTransition:ve.su.forceFlush,layoutMode:ve.lO.standard,correlation:t.correlation}}),metadata:{allowAnonymous:!1,deepLink:e,userContextId:n},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}})}))}launchMainApp(e,t,i,n){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log("launchMainApp"),yield this.execute(rj(e,t,i,ve.lO.standard,n))}))}launchMinimode(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log("launchMinimode"),yield this.execute(rj(e,t,i,ve.lO.minimode))}))}prewarmFlyout(e,t=!1){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log("prewarmFlyout"),yield this.execute({shouldRenderContent:!0,scenarioCorrelation:e,entityCommand:$e({entity:{type:pe.py.default,action:pe.uk.default},command:{visibilityState:ve.fe.showWithoutFocusing,stateTransition:ve.su.flush,layoutMode:t?ve.lO.minimode:ve.lO.minimal,correlation:e.correlation}}),metadata:{allowAnonymous:!1,deepLink:is.n0.flyout},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}})}))}cleanupActiveWindowsIfNeeded(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{switch(e){case zI.Other:const e=this.pendingIntentMap.get(zI.Main);e&&(this.logger.log(`Closing main window with id=${e.windowId}.`),yield this.client.mutate({mutation:HI,variables:{windowId:e.windowId}}));case zI.Main:const t=this.pendingIntentMap.get(zI.Other);t&&(this.logger.log(`Closing other window with id=${t.windowId}.`),yield this.client.mutate({mutation:HI,variables:{windowId:t.windowId}}))}}catch(t){this.logger.warn(`cleanupActiveWindowsIfNeeded: Failed to remove window of type ${e}: ${t.message}`)}}))}observeActiveWindows(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.activeWindowsService.getActiveWindowsObservable().subscribe(this.handleNewActiveWindows.bind(this))}))}observeActiveWindowsDeprecated(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.client.watchQuery({query:qI}).subscribe((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!e.loading&&!e.errors){const{data:{activeWindows:t}}=e;this.handleNewActiveWindows(t)}}))))}))}handleNewActiveWindows(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(null===(i=null===(t=this.coreSettings)||void 0===t?void 0:t.get(b.J.Core))||void 0===i?void 0:i.enableAnonymousCallerSignout){const t=(e=>e.some((e=>!e.isMainWindow)))(e);if(this.hasCreatedNonMainWindow){const e=yield XI({coreSettings:this.coreSettings,logger:this.logger,waitForRenderingContextReady:this.waitForRenderingContextReady});yield((e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(!e&&i){const e={id:(0,Ta.pW)(),source:"intent-service",scenarioName:U.RG.AuthWebLogout};yield t.mutate({mutation:ij,variables:{reason:"AnonymousSessionEnd"},context:{correlation:e}})}})))(t,this.client,(e=>{var t;return(null===(t=null==e?void 0:e.authenticationUser)||void 0===t?void 0:t.type)===Es.Ch.Anonymous})(e))}else this.hasCreatedNonMainWindow=t}this.checkAndCleanupIfWindowRemoved(e.map((e=>e.id)))}))}checkAndCleanupIfWindowRemoved(e){for(const[t,{intent:i,windowId:n}]of Array.from(this.pendingIntentMap))n&&!e.find((e=>e===n))&&(this.logInternal(`checkAndCleanupIfWindowRemoved: window id: ${n} no longer exists, removing intent:`,i),this.pendingIntentMap.delete(t))}handleIntentOverriddenByHook(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.logger.log("executeInternal: Intent overriden by onBeforeIntentAuthenticated."),t?(this.logger.log("executeInternal: overridden to target cloud. LaunchCloud and return early."),yield tj(t,this.commandChangeReportingService,e.metadata.deepLink,this.hostComms,e.scenarioCorrelation.correlation,e.metadata.userContextId),{intentExecuted:!0,targetWindowId:i}):{intentExecuted:!1,targetWindowId:i}}))}executeInternal(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.executeOnCrossCloudMeeting(e,t);if(n)return n;let r=this.commandHandler,s=this.delegatedCommanding;this.logInternal(`executeInternal: windowId: ${t}: Original intent:`,e);const{intentOverridenByHook:a,newTargetWindowId:l,errorCode:c,targetCloud:d,targetUserContextId:u}=yield this.evaluateOnBeforeIntentAuthHook(e,r,s,t);let m,g,h=c;if(a)return this.handleIntentOverriddenByHook(e,d,l);if(e.metadata.userContextId!==u&&(this.logger.log("executeInternal: userContextId overriden by onBeforeIntentAuthenticated."),e.metadata.userContextId=u),!e.shouldRenderContent&&!e.metadata.userContextId)return this.logger.log("executeInternal: userContextId is still undefined. Returning early."),{intentExecuted:!1,targetWindowId:l};this.commandChangeReportingService.report({type:Ae.B.WaitForUserContextStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:pj}});try{m=yield XI({coreSettings:this.coreSettings,logger:this.logger,userContextId:e.metadata.userContextId,waitForRenderingContextReady:this.waitForRenderingContextReady})}catch(i){return{intentExecuted:!0,targetWindowId:yield aj({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:new Ne.G(Ne.$.CREATE_USER_CONTEXT_FAILED_GENERIC,i,e.metadata.userContextId),errorInfo:De.y.CreateUserContextError,errorMessage:`getUserContext(${e.metadata.userContextId}) failed, executing original intent ${i}.`,fallbackError:new Ne.G(Ne.$.CREATE_USER_CONTEXT_FAILED_GENERIC,void 0,e.metadata.userContextId),intent:e,logger:this.logger,newCommandType:Ae.B.WaitForUserContextFailed,windowId:t,delegatedCommanding:this.delegatedCommanding})}}if(this.commandChangeReportingService.report({type:Ae.B.WaitForUserContextCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:pj}}),null==m?void 0:m.authenticationUser){const i=m;r=(e,t)=>{var n;return fi(Object.assign(Object.assign({},i),{entityCommandInput:e,clientLaunchId:t,executionContext:{userContextId:(null===(n=null==m?void 0:m.authenticationUser)||void 0===n?void 0:n.id)?(0,Ee.b4)(m.authenticationUser):void 0}}))},s=m.delegatedCommanding;const{intentOverridenByHook:n,targetWindowId:o,errorCode:a}=yield this.evaluateOnAfterIntentAuthenticatedHook(e,r,s,m,t);if(a&&(h=a),n)return this.logger.log("executeInternal: Intent overriden by onAfterIntentAuthenticated."),{intentExecuted:!1,targetWindowId:o}}else this.logger.log(`executeInternal: user context / authentication user is not defined for userContextId: ${e.metadata.userContextId}  - skip execution of onAfterIntentAuthenticated`);if(this.logInternal(`executeInternal: windowId: ${t}: Executing original intent:`,e),e.shouldRenderContent){const n=yield ZI({coreSettings:this.coreSettings,logger:this.logger,waitForRenderingContextReady:this.waitForRenderingContextReady,correlation:e.scenarioCorrelation.correlation});if(this.logInternal(`executeInternal: The intent is targeting userContextId ${e.metadata.userContextId}, and the mainWindowUserId is ${n}:`,e),this.shouldGoToAccountListWindow(e,n))return yield function(e,t,i,n,r){var s;return(0,o.__awaiter)(this,void 0,void 0,(function*(){r.metadata.accountsToUse=void 0,r.entityCommand.command.stateTransition=ve.su.new,r.entityCommand.command.layoutMode=ve.lO.focus;const n=(0,L.cloneDeep)(r);return n.entityCommand.entity={id:`${r.entityCommand.command.layoutMode}`,type:pe.py.identity,action:pe.uk.list,linkedEntity:{type:r.entityCommand.entity.type,action:r.entityCommand.entity.action,id:null!==(s=r.entityCommand.entity.id)&&void 0!==s?s:r.entityCommand.command.correlation.id}},n.entityCommand.command=Object.assign(Object.assign({},r.entityCommand.command),{layoutMode:ve.lO.focus,stateTransition:ve.su.new,visibilityState:ve.fe.show}),t.log(`goToAccountListWindow: Executing account list intent: {${n.entityCommand.entity.type}, ${n.entityCommand.entity.action}, ${n.entityCommand.command.layoutMode}, ${n.entityCommand.command.visibilityState}}`),e.report({correlationId:n.scenarioCorrelation.correlation.id,type:Ae.B.IntentExecuted,context:{target:nj,eventData:{mainEntityType:n.entityCommand.entity.type,mainEntityAction:n.entityCommand.entity.action}}}),oj(i,0,n,t)}))}(this.commandChangeReportingService,this.logger,r,0,e),{intentExecuted:!1,targetWindowId:void 0};const s=function(e,t,i,n,o,r){var s,a,l,c,d,u;if(null===(s=i.options)||void 0===s?void 0:s.shouldSkipOverridingWindowing)return!1;if(!(null===(a=e.get(b.J.Core))||void 0===a?void 0:a.enableDeeplinkOptionAllowUserWindowingPreference))return!1;if(!r)return o.log("Main window user context id is undefined"),!1;if(YI(i.metadata.homeCloud,e))return!1;const m=sj(i);if(o.log(`PendingIntentType: ${m}`),m===zI.Flyout||m===zI.Minimode)return!1;const g=i.entityCommand.command;switch(o.log(`StateTransition: ${g.stateTransition}`),g.stateTransition){case ve.su.none:case ve.su.extend:case ve.su.flow:return!1}if(o.log(`EntityType: ${i.entityCommand.entity.type}`),i.entityCommand.entity.type===pe.py.default||i.entityCommand.entity.action===pe.uk.default||i.entityCommand.entity.type===pe.py.identity)return!1;const h=(null===(d=null===(l=n.getApp({entityType:i.entityCommand.entity.type}))||void 0===l?void 0:(c=l.manifest).getAllowUserWindowingPreference)||void 0===d?void 0:d.call(c,{coreSettings:e,entity:i.entityCommand.entity}))||!1;if(o.log(`AllowUserWindowingPreference: ${h}`),!i.metadata.userContextId)return null===(u=o.errorToTelemetry)||void 0===u||u.call(o,"Unexpected undefined userContextId for intent in override","webclient_framework_foundation_core_services_intent",void 0,!0),!1;if(i.metadata.userContextId!==r)return o.log("User context of intent does not match main window user"),h||g.stateTransition===ve.su.new?(g.layoutMode=ve.lO.focus,g.stateTransition=ve.su.new):(g.layoutMode=ve.lO.standard,g.stateTransition=ve.su.forceFlush,g.targetWindow=ve.PH.main),!0;if(o.log("User context of intent matches main window user"),h){const e=t.getPreferences("windowing").shouldOpenContentInNewWindow;return o.log(`ShouldOpenContentInNewWindow ${e}`),e?(g.layoutMode=ve.lO.focus,g.stateTransition=ve.su.new):(g.layoutMode=ve.lO.standard,g.stateTransition=ve.su.flush),!0}return!1}(this.coreSettings,m.clientPreferences,e,this.appsRegistryService,this.logger,n);!function(e,t,i,n,r,s){var a,l;(0,o.__awaiter)(this,void 0,void 0,(function*(){r&&i.entityCommand.entity.type===pe.py.default&&(n.log("checkForPendingIntent: Translating default entity to a real entity"),i.entityCommand.entity=null!==(l=e.getDefaultCommand(null!==(a=null==s?void 0:s.coreSettings)&&void 0!==a?a:t,i.entityCommand.command.layoutMode))&&void 0!==l?l:i.entityCommand.entity)}))}(this.appsRegistryService,this.coreSettings,e,this.logger,i,m),g=yield oj(r,0,e,this.logger,s?void 0:t)}return this.logInternal(`executeInternal: windowId: ${t}: Executed intent:`,e),this.commandChangeReportingService.report({correlationId:e.scenarioCorrelation.correlation.id,type:Ae.B.IntentExecuted,context:{target:pj,eventData:{mainEntityType:e.shouldRenderContent?e.entityCommand.entity.type:vj,mainEntityAction:e.shouldRenderContent?e.entityCommand.entity.action:vj,errorCode:h}}}),{intentExecuted:!0,targetWindowId:g}}))}executeOnCrossCloudMeeting(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=this.coreSettings.get(b.J.Metadata).environment;if(e.shouldRenderContent&&e.entityCommand.entity.type===pe.py.callingdeeplink&&i&&e.metadata.homeCloud&&KI(e.metadata.homeCloud,this.coreSettings)!==i&&!1===this.coreSettings.get(b.J.HostCapabilities,["crossCloudMeetingEnabled"]).crossCloudMeetingEnabled){return{intentExecuted:!0,targetWindowId:yield aj({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:new Ne.G(Ne.$.EXPERIENCE_DISABLED,void 0,e.metadata.userContextId),errorInfo:De.y.DeeplinkExecutionTerminated,errorMessage:"Deeplink callingdeeplink execution was terminated, because crossCloudMeetingEnabled is disabled.",intent:e,logger:this.logger,newCommandType:Ae.B.Failure,windowId:t,delegatedCommanding:this.delegatedCommanding})}}}))}evaluateOnBeforeIntentAuthHook(e,t,i,n){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.commandChangeReportingService.report({type:Ae.B.OnBeforeIntentAuthenticatedStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:pj}});const{intentOverridenByHook:r,targetWindowId:s,errorCode:a,targetCloud:l,targetUserContextId:c}=yield function(e,t,i,n,r,s,a,l,c,d){var u,m;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let n=lj.pending,o={};if(dj(t,a))return o=yield e(),o;r.log("Proceed with loading screen display if threshold exceeds.");const g=null!==(m=null===(u=null==a?void 0:a.get(b.J.Auth))||void 0===u?void 0:u.thresholdToShowLoadingScreenInMs)&&void 0!==m?m:2e3;let h;const p=s.setTimeout((()=>{n!==lj.pending||h||(l.report({type:Ae.B.OnLoadingScreenDisplayStarted,correlationId:t.scenarioCorrelation.correlation.id,context:{target:c}}),oj(i,0,cj(t,ve.fe.show),r,d).then((e=>{h=e})).catch((e=>r.warn(`Error while launching loading screen: ${e}`))))}),g);try{o=yield e(),n=lj.fulfilled}catch(e){throw n=lj.rejected,e}finally{s.clearTimeout(p),h&&(oj(i,0,cj(t,ve.fe.hide),r,h).catch((e=>r.warn(`Error while closing loading screen: ${e}`))),l.report({type:Ae.B.OnLoadingScreenDisplayCompleted,correlationId:t.scenarioCorrelation.correlation.id,context:{target:c}}))}return o}))}((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.evaluateHook("onBeforeIntentAuthenticated",{intent:uj(e),context:{client:this.client,coreSettings:this.coreSettings,scenarioFactory:this.scenarioFactory}},t,i,n)}))),e,t,0,this.logger,this.host,this.coreSettings,this.commandChangeReportingService,pj,n);return this.commandChangeReportingService.report({type:Ae.B.OnBeforeIntentAuthenticatedCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:pj,eventData:{errorCode:a}}}),{intentOverridenByHook:r,newTargetWindowId:s,errorCode:a,targetCloud:l,targetUserContextId:c}}))}evaluateHook(e,t,i,n,r){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let n,o;this.logger.log(`evaluateHook(${e}): windowId: ${r}: Begin evaluation`);let s=!1;for(const a of function(e,t,i){const n=[];for(const o of e.registeredApps){const e=o[t];if(e)for(const t of Array.from(e.filter))"*"!==t&&t!==i||n.push(o)}return n}(this.appsRegistryService,e,t.intent.shouldRenderContent?t.intent.entityCommand.entity.type:void 0)){this.logger.log(`evaluateHook(${e}) - Matching app found: ${a.manifest.id}`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:Ae.B.IntentHookStarted,context:{target:pj,eventData:{matchingApp:a.manifest.id}}});try{const i=yield mj(this.commandChangeReportingService,this.logger,a,e,t);s=i.intentOverridenByHook,n=i.intent,o=s?"onBeforeIntentAuthenticated"===e?VI.IntentOverriddenByOnBeforeAuth:VI.IntentOverriddenByOnAfterAuth:void 0}catch(i){this.logger.warn(`evaluateHook(${e}) windowId: ${r}: - Evaluating hook threw an error: ${i}. Executing error intent.`),o="onBeforeIntentAuthenticated"===e?De.y.OnBeforeIntentAuthenticatedRejected:De.y.OnAfterIntentAuthenticatedRejected;return{intentOverridenByHook:!0,targetWindowId:yield aj({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:i,errorInfo:o,errorMessage:`evaluateHook(${e}) windowId: ${r}: - Evaluating hook threw an error: ${i}. Falling back to original intent.`,fallbackError:new Ne.G(Ne.$.UNKNOWN),logger:this.logger,intent:t.intent,newCommandType:Ae.B.IntentHookRejected,windowId:r,delegatedCommanding:this.delegatedCommanding}),errorCode:o}}if(s){if(!n)return this.logger.warn(`evaluateHook(${e}) windowId: ${r}: - Hook overriden to undefined. Stopping further processing`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:Ae.B.Failure,context:{target:pj,errorInfo:"onBeforeIntentAuthenticated"===e?De.y.OnBeforeIntentAuthenticatedReturnedUndefined:De.y.OnAfterIntentAuthenticatedReturnedUndefined}}),{intentOverridenByHook:!0,targetWindowId:r};if(n.metadata.cloud)return{intentOverridenByHook:s,targetWindowId:void 0,targetCloud:n.metadata.cloud,errorCode:o};if(t.intent.shouldRenderContent&&n.shouldRenderContent){this.logInternal(`evaluateHook(${e}), windowId: ${r}: - Executing overriden intent:`,n),this.commandChangeReportingService.report({correlationId:n.scenarioCorrelation.correlation.id,type:Ae.B.IntentExecuted,context:{target:pj,eventData:{mainEntityType:n.shouldRenderContent?n.entityCommand.entity.type:vj,mainEntityAction:n.shouldRenderContent?n.entityCommand.entity.action:vj,errorCode:o}}});return{intentOverridenByHook:s,targetWindowId:yield oj(i,0,n,this.logger,r),errorCode:o}}}}return this.logger.log(`evaluateHook(${e}): windowId: ${r}: Completing evaluation. Intent was not overriden.`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:Ae.B.IntentHookCompleted,context:{target:pj}}),{intentOverridenByHook:!1,targetWindowId:r,errorCode:o,targetUserContextId:null==n?void 0:n.metadata.userContextId}}))}logInternal(e,t){this.logger.log(`${e} {${t.shouldRenderContent?`${t.entityCommand.entity.type}, ${t.entityCommand.entity.action}, ${t.entityCommand.command.layoutMode}, ${t.entityCommand.command.visibilityState}}`:"nrc"}`)}evaluateOnAfterIntentAuthenticatedHook(e,t,i,n,r){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.commandChangeReportingService.report({type:Ae.B.OnAfterIntentAuthenticatedStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:pj}});const{intentOverridenByHook:o,targetWindowId:s,errorCode:a}=yield this.evaluateHook("onAfterIntentAuthenticated",{intent:uj(e),context:{authenticatedUser:n.authenticationUser,client:n.client,localStorage:n.localStorage,coreSettings:this.coreSettings,experienceChangeReportingService:n.experienceChangeReportingService}},t,i,r);return this.commandChangeReportingService.report({type:Ae.B.OnAfterIntentAuthenticatedCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:pj,eventData:{errorCode:a}}}),{intentOverridenByHook:o,targetWindowId:s,errorCode:a}}))}shouldGoToAccountListWindow(e,t){var i,n,o,r,s;const a=(null===(o=null===(i=this.appsRegistryService.getApp({entityType:e.entityCommand.entity.type}))||void 0===i?void 0:(n=i.manifest).getAllowUserWindowingPreference)||void 0===o?void 0:o.call(n,{coreSettings:this.coreSettings,entity:e.entityCommand.entity}))||!1;return!!(null===(r=this.coreSettings.get(b.J.Core))||void 0===r?void 0:r.enableDeeplinkOptionAccountToUse)&&0===(null===(s=e.metadata.accountsToUse)||void 0===s?void 0:s.length)&&!!t&&e.metadata.userContextId===t&&(a||e.entityCommand.command.stateTransition===ve.su.new)}sendDeeplinkUserBi(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){hj(e,t,this.coreSettings,this.logger,this.waitForRenderingContextReady,this.appsRegistryService,this.userBiService)}))}}const fj=["#/apps","#/conversations","#/debug","#/modern-calling","#/scheduling-form"],Sj=["ctx=channel","ctx=chat","MyLearning"],kj=["/_","/alerts","/analytics/myteams","/apps","/bizChatCopilotApp","/broadcast-intermediate-screen","/broadcastPlaybackScreen","/calendar","/calendarv2","/calendarv2owa","/calling-intermediate-screen","/calling","/callingProtocol","/calls","/channel-hub","/channelDashboard","/channels","/chatProtocol","/chats","/communities","/communitiesDashboard","/communitiesOnboarding","/debug","/deepLinkAutoInstallNotification","/deepLinkDiscoverAppsNotifications","/deepLinkFreemiumUpgrade","/deepLinkLobNotifications","/deepLinkOnboardingNotifications","/deviceLicenseError","/discover","/discoverSurface","/download","/error","/files/oneupviewer","/force_resync_data","/freemium-upsell","/getUserMedia","/guestLicense","/help","/l/app","/l/auth-callback","/l/auth/google","/l/call","/l/claim","/l/community","/l/file","/l/fileDownload","/l/help","/l/home","/l/invite","/l/manage-teams","/l/meeting-share","/l/meeting","/l/meetingrecap","/l/meetnow-join","/l/meetup-join","/l/present","/l/search","/l/settings/recognition","/l/stage","/l/task","/l/virtualevent","/l/virtualevent/new","/l/voiceassistant","/licenseError","/manageteams/myinvites","/manageteams/myteams","/manageTenant","/meet","/meeting/meet/list","/message","/modern-calling","/my","/non-members-placeholder","/oops","/people","/post-calling","/post-echo-bot-call","/pre-join-calling","/rigel-console-broadcast","/rigel-console-cortana","/rigel-console-home-page","/rigel-console-join-by-code","/rigel-console-post-call","/rigel-console-pre-call","/rigel-console","/scheduling-form","/school","/search","/sections","/sfbfrequickstartvideo","/smart-devices-guest-screen","/smart-devices-home-screen","/smart-devices-login-screen","/smbWelcome","/start-meeting","/subscriptionManagement","/surface-hub-home-screen","/team-overview","/teamCreate","/teamDashboard","/teamsGallery","/tenantSwitch","/toolkit","/unsupportedBrowser","/unsupportedIE","/v2/"],bj=["callto:","ftp:","ftps:","http:","https:","im:","mailto:","msteams:","onenote:","sip:","sips:","tel:","vscode-insiders:","vscode:","vsls:"],wj=["","a","allowXTenantAccess","anon","appId","appTenantId","attachmentCount","attachmentSize","attendees","authId","btype","calendarType","ccRecipients","channelId","chatId","cloudAttachments","cloudAttachmentsRaw","content","context","contextType","correlationId","ctx","deeplinkId","defaultFocusArea","defaultRightTab","displayName","displayProperties","emailHtmlLink","endTime","environment","eventId","eventType","fileType","fileTypes","fqdn","from","groupId","iCalUid","id","installAppPackage","isBroadcast","isBroadcastMeeting","IsBroadcastMeeting","isPublic","isWatchParty","loginHint","meetingType","messageId","messageId","MessageId","name","objectUrl","Oid","openInMeeting","organizerId","organizerId","outlookSmtpAddress","outlookTid","outlookUid","p","parentMessageId","pp","pptContext","prid","recordingId","replyChainId","result","role","roleHint","scope","serviceName","shareUrl","source","sourceVersion","startTime","subject","subType","tagId","templateId","templateInstanceId","tenantId","threadId","tid","Tid","timestamp","toRecipients","uid","url","user","userEmail","users","ver","viewState"],Cj=e=>fj.find((t=>e.startsWith(t))),_j=e=>Sj.find((t=>e.endsWith(t))),Tj=e=>{const t=is.Hl.find((t=>e.startsWith(t)));return t||kj.find((t=>e.startsWith(t)))},Ij=e=>bj.find((t=>e===t)),jj=e=>{if(!e||0===e.length)return;const t=new URLSearchParams(e),i=Array.from(t.keys()).sort(),n=i.filter((e=>wj.includes(e)));if(0===n.length)return`unsupported_searchparams_keys_${i.length}`;const o=Nj(t,n);return(0,M.u4)(o)},Nj=(e,t)=>{const i={};return t.forEach((t=>{const n=e.get(t);if(n){const e=Ej(n);i[t]=e}else i[t]="undefined"})),i},Ej=e=>{const t=(e=>{try{return JSON.parse(e),!0}catch(e){return!1}})(e);let i;t&&(i=(e=>{const t=Object.keys(e).sort();if(0===t.length)return t;const i=t.filter((e=>wj.includes(e)));return 0===i.length?["unsupported_json_parsed_keys"]:i})(JSON.parse(e)));return{canJsonParse:t,jsonParsedKeys:i}};function xj(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{commandChangeReportingService:t,coreSettings:i,experienceBasePath:n,location:r,scenarioCorrelation:s,loggerFactory:a,userContextId:l}=e,c=a.newLogger("DeeplinkUtilities","core-services-deeplink"),d=ks({coreSettings:i,experienceBasePath:n,location:r,loggerFactory:a});t.report({type:Ae.B.ScenarioEventDataAppended,correlationId:s.correlation.id,context:{target:"deeplink-parsing",eventData:{homeCloud:null==d?void 0:d.homeCloud,externalId:s.correlation.externalId}}});let u,m,g=!1;if(d&&d.isDesktopDeeplink){const t=yield function(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{commandChangeReportingService:t,deepLink:i,homeCloud:n,logger:o,scenarioCorrelation:r,userContextId:s,windowType:a}=e,l=is.n0[i];if(l){let e;switch(o.log(`Static deeplink: ${l}`),i){case is.n0.flyout:const t=ve.lO.minimal;e=Dj({scenarioCorrelation:r,userContextId:s,deepLink:i,homeCloud:n,entity:Rj(t),layoutMode:t});break;case is.n0.default:{let t=ve.lO.standard;a!==is.fo.mini&&a!==is.fo.main||(t=ve.lO.minimode),e=Dj({scenarioCorrelation:r,userContextId:s,deepLink:i,homeCloud:n,entity:Rj(t),layoutMode:t});break}case is.n0.core:e=Dj({scenarioCorrelation:r,userContextId:s,deepLink:i,homeCloud:n})}return Lj({commandChangeReportingService:t,correlationId:r.correlation.id,externalId:r.correlation.externalId,deeplinkType:l,mainEntityType:(null==e?void 0:e.shouldRenderContent)?null==e?void 0:e.entityCommand.entity.type:void 0,mainEntityAction:(null==e?void 0:e.shouldRenderContent)?null==e?void 0:e.entityCommand.entity.action:void 0,loadingWindowType:a}),{terminateDeeplink:!1,intent:e}}const c=yield Pj(Object.assign(Object.assign({},e),{deepLink:i}));if(c.intent||c.terminateDeeplink||c.errorCode===Rt.InvalidOrigin)return c;return{terminateDeeplink:!1,intent:Aj(i,r,s,n)}}))}(Object.assign(Object.assign({},e),{userContextId:l||d.userContextId,deepLink:d.deepLink,homeCloud:d.homeCloud,logger:c,windowType:d.windowType}));g=t.terminateDeeplink,u=t.intent,m=t.errorCode}else if(d){const t=yield Pj(Object.assign(Object.assign({},e),{deepLink:d.deepLink,userContextId:l||d.userContextId,logger:c}));g=t.terminateDeeplink,u=t.intent,m=t.errorCode}if(g)return{terminateDeeplink:g,intent:u};if(u||m===Rt.InvalidOrigin||(u=function(e,t,i){const{hash:n,pathname:o}=e;let r;if(n&&!(0,L.isEmpty)(n)){const e=n.indexOf("?");r=e>=0?n.substr(0,e):n}else r=o;return Aj(r,t,i)}(r,s,l)),!u&&d){const t=ms(d.deepLink,e.coreSettings),i=(e=>{const{pathname:t,protocol:i,hash:n,search:o}=e,r={hashstart:void 0,hashend:void 0,pathname:void 0,protocol:void 0};let s;r.protocol=Ij(i),r.pathname=Tj(t),r.hashstart=Cj(n),r.hashend=_j(n);try{s=jj(o)}catch(e){s=`SEARCH_METADATA_ERR:${e.name}`}if(void 0===r.pathname&&void 0===r.protocol&&void 0===r.hashstart&&void 0===r.hashend&&void 0===s)return"unsupported";const a=(0,M.u4)(r);return s?`${a}::search::${s}`:a})(t);c.errorToTelemetry&&c.errorToTelemetry(i,"webclient_framework_foundation_core_services_deeplink",void 0,!0),u=yield function({commandChangeReportingService:e,originalDeeplink:t,coreSettings:i,hostCommunicationService:n,logger:r,scenarioCorrelation:s,userContextId:a}){var l,c,d;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enableUnsupportedDeeplinkDialog:o,enableUnsupportedDeeplinkDialogForTflToTfw:u,clientPreviewOptOutStrategy:m}=i.get(b.J.Core);r.log(`enableUnsupportedDeeplinkDialog: ${o}, enableUnsupportedDeeplinkDialogForTflToTfw: ${u}`);if(u&&QI((0,BI.P)(t,i),i)===Es.G7.life||o){let i="Web"===m;if("Desktop"===m){const e=yield n.loadModule("appswitcher"),t=yield null===(l=null==e?void 0:e.getPearInstallState)||void 0===l?void 0:l.call(e,ji.OP.Teams1);null===(c=r.infoToTelemetry)||void 0===c||c.call(r,`t1InstallState: ${t}`,"webclient_framework_foundation_core_services_deeplink",void 0,!0),i=t===ji.Jv.InstalledNotActive||t===ji.Jv.InstalledActive}if(i){null===(d=r.infoToTelemetry)||void 0===d||d.call(r,"Returning unsupported deeplink command","webclient_framework_foundation_core_services_deeplink",void 0,!0);const i=Dj({scenarioCorrelation:s,userContextId:a,deepLink:t.toString(),entity:{type:pe.py.unsupporteddeeplinkdialog,action:pe.uk.view},layoutMode:ve.lO.standard,stateTransition:ve.su.extend,entityOptions:{originalDeeplink:t}}),{pathname:n}=t,o=is.Hl.find((e=>n.startsWith(e))),l=null!=o?o:"unsupported";return Lj({commandChangeReportingService:e,correlationId:s.correlation.id,externalId:s.correlation.externalId,deeplinkType:l,mainEntityType:null==i?void 0:i.entityCommand.entity.type,mainEntityAction:null==i?void 0:i.entityCommand.entity.action}),i}}}))}({commandChangeReportingService:e.commandChangeReportingService,originalDeeplink:t,coreSettings:e.coreSettings,hostCommunicationService:e.hostCommunicationService,logger:c,scenarioCorrelation:s,userContextId:l})}return{terminateDeeplink:!1,intent:u}}))}function Aj(e,t,i,n){const o=Cs(e);if(o)return Dj({scenarioCorrelation:t,userContextId:i,deepLink:Uj(e||is.n0.default),entity:o,homeCloud:n})}function Dj(e){const{scenarioCorrelation:t,userContextId:i,deepLink:n,homeCloud:o,entity:r,layoutMode:s,stateTransition:a=ve.su.flush,entityOptions:l}=e;return r?{shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:$e({entity:r,command:{visibilityState:ve.fe.show,stateTransition:a,layoutMode:s,correlation:t.correlation},entityOptions:l,metadata:{deepLink:n}}),metadata:{allowAnonymous:!1,deepLink:n,homeCloud:o,userContextId:i}}:{shouldRenderContent:!1,scenarioCorrelation:t,metadata:{allowAnonymous:!1,deepLink:is.n0.core,homeCloud:o,userContextId:i}}}function Fj(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let i,n,r,s,a=!1;const{authenticationService:l,appsRegistryService:c,commandChangeReportingService:d,coreSettings:u,homeCloud:m,normalizedDeeplink:g,rawDeeplink:h,scenarioCorrelation:p,loggerFactory:v,logger:y,client:f,scenarioFactory:S,preferredCommandInput:k,userContextId:w,sourceViewEntity:C,forceInCloudExecution:_,getExperienceAccountMode:T,waitForRenderingContextReady:I}=e,j=u.get(b.J.Core).enableOriginValidationForIncomingIntents;if(!_&&j&&!(0,BI.H)(g.toString(),u,!0))return{terminateDeeplink:!1,matchType:"originValidationForIncomingIntents",intent:void 0,reason:"Not a valid deeplink",errorCode:Rt.InvalidOrigin};try{let t;const{pathname:s}=g,_="/"===s[0]?s.substr(1):s,j=function(e){if(e.hash){const t=new URL(e.hash.substring(1),e.origin),i={pathname:t.pathname};return t.search&&(i.search=(0,os.parse)(t.search)),i}}(g);for(const e of c.registeredApps){const{match:n,matchType:o,matchingCondition:r}=Oj(e,_,g,j);if(n){t=r,i=o;break}}if(t){const i=e=>{d.report({correlationId:p.correlation.id,type:e,context:{target:"delegate-deeplink-to-app"}})};i(Ae.B.DeeplinkParseByAppStarted);const s=yield t.execute({context:{__doNotUse_globalDataClient:f,coreSettings:u,getExperienceAccountMode:T,getUserContexts:e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return function(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{getExperienceAccountMode:i,userContextId:n,authenticationService:o,tenantId:r,logger:s,correlation:a}=e;s.log(`getUserContexts call with tenantId ${r}`);const l=(yield null===(t=o.getCachedUsers)||void 0===t?void 0:t.call(o,{id:a.id,source:a.source},{isAuthenticated:!0}))||[];s.log(`Auth service returned ${l.length} users`);const c=[],d=yield ZI(e);if(n&&n!==d&&i()!==WI.b.SingleAccount){s.log(`Adding source window to user context ${n}`);const t=yield ej(Object.assign(Object.assign({},e),{userContextId:n,userContextAccountType:GI.K.SourceWindow}));t&&c.push(t)}if(d){s.log(`Adding main window to user context ${d}`);const t=yield ej(Object.assign(Object.assign({},e),{userContextId:d,userContextAccountType:GI.K.MainWindow}));t&&c.push(t)}for(const t of l)if(t.id&&t.id!==n&&t.id!==d&&(!r||r===t.profile.tid)){s.log(`Adding ${t.id} user context`);const i=yield ej(Object.assign(Object.assign({},e),{userContextId:t.id,userContextAccountType:GI.K.Other}));i&&c.push(i)}return c}))}({authenticationService:l,commandChangeReportingService:d,coreSettings:u,correlation:p.correlation,getExperienceAccountMode:T,logger:y,tenantId:e,userContextId:w,waitForRenderingContextReady:I})})),loggerFactory:v,scenarioFactory:S},deeplinkUrl:h,homeCloud:m,preferredCommandInput:k,sourceViewEntity:C,parsedDeeplinkHash:j});if(i(Ae.B.DeeplinkParseByAppSucceeded),s){const t=yield function(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:i,userContextId:n}=e;if(!(null===(t=i.get(b.J.Core))||void 0===t?void 0:t.enableDeeplinkOptionAccountToUse))return{accountsToUse:n?[n]:void 0,userContextId:n};if(YI(e.homeCloud,i))return{accountsToUse:n?[n]:void 0,userContextId:n};const o=yield ZI(e);if(!o)return{accountsToUse:void 0,userContextId:n};const{accountsToUse:r,getExperienceAccountMode:s}=e;if(s()===WI.b.SingleAccount)return{accountsToUse:[o],userContextId:o};let a=n;return r&&0===r.length&&(a=void 0),r&&r.length>=1&&(a=r[0]),{accountsToUse:r,userContextId:a}}))}(Object.assign(Object.assign({},e),{correlation:p.correlation,userContextId:w,waitForRenderingContextReady:I,accountsToUse:s.metadata.accountsToUse}));n=Object.assign(Object.assign({},s),{shouldRenderContent:!0,entityCommand:Object.assign(Object.assign(Object.assign({},s.entityCommand),{command:Object.assign(Object.assign({},s.entityCommand.command),{correlation:p.correlation})}),h&&{metadata:{deepLink:h.toString()}}),scenarioCorrelation:p,metadata:Object.assign(Object.assign(Object.assign({},s.metadata),{deepLink:h.toString(),homeCloud:m}),t)})}else a=!0,r=Rt.DeeplinkTerminatedByApp}else r=Rt.DeeplinkNotHandledByRegisteredApps}catch(e){r=Rt.OnBeforeDeeplinkParsedFailed,s=e.message;const i=e.reason,n=`${Mt}/${r}/${(0,re.A)(s)}/${i}`;null===(t=y.errorToTelemetry)||void 0===t||t.call(y,n,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}return{matchType:i,terminateDeeplink:a,intent:n,errorCode:r,reason:s}}))}function Oj(e,t,i,n){if(!e.onBeforeDeeplinkParsed)return{match:!1};for(const o of e.onBeforeDeeplinkParsed){const{filter:r}=o;if(Mj(r)){if(r(i,n))return{match:!0,matchType:`${e.manifest.name}#filterFn`,matchingCondition:o}}else{const e="/"===r[0]?r.substr(1):r;if(t.startsWith(e))return{match:!0,matchType:e,matchingCondition:o}}}return{match:!1}}function Mj(e){return(0,L.isFunction)(e)}function Rj(e){return e===ve.lO.minimode||e===ve.lO.minimal?{type:pe.py.flyout,action:pe.uk.default}:{action:pe.uk.default,type:pe.py.default}}function Pj(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{commandChangeReportingService:t,coreSettings:i,deepLink:n,isInternalDeeplink:o,logger:r,scenarioCorrelation:s,userBiService:a}=e,l=ms(n,i),c=(0,BI.P)(l,i),{matchType:d,terminateDeeplink:u,intent:m,errorCode:g,reason:h}=yield Fj(Object.assign(Object.assign({},e),{normalizedDeeplink:c,rawDeeplink:l,logger:r}));return function(e,t,i,n,o){var r,s;const{pathname:a,search:l}=n,c="/"===a[0]?a.substr(1):a,d=is.Hl.find((e=>{const t="/"===e[0]?e.substr(1):e;return c.startsWith(t)}));if(!d)return;const u={};u["DataBag.joinLinkType"]=d.toString();const m=new URLSearchParams(l);u["DataBag.deeplinkId"]=m.get("deeplinkId"),u["DataBag.externalId"]=null===(s=null===(r=null==o?void 0:o.entityCommand.command)||void 0===r?void 0:r.correlation)||void 0===s?void 0:s.externalId,u["DataBag.joinLinkVariant"]=m.get("v"),e.recordPanelAction({actionGesture:gj.uS.open,actionOutcome:gj.$K.open,actionScenario:gj.Tk.deeplink,actionScenarioType:gj.Yu.deeplink,moduleType:gj.PO.deeplink,moduleName:gj.rA.deeplinkService,panelType:i?gj.wh.Internal:gj.wh.External,dataBag:{id:"",data:Object.assign({},u),dispose:()=>{}},mainEntityType:null==o?void 0:o.entityCommand.entity.type,mainEntityAction:null==o?void 0:o.entityCommand.entity.action},t)}(a,r,o,c,m),(null==m?void 0:m.shouldRenderContent)?r.log(`Deeplink parsed to intent: { type: ${m.entityCommand.entity.type}, action: ${m.entityCommand.entity.action} }`):r.log("Returning default entity to be executed as fallback"),Lj({commandChangeReportingService:t,correlationId:s.correlation.id,externalId:s.correlation.externalId,deeplinkType:d,mainEntityType:null==m?void 0:m.entityCommand.entity.type,mainEntityAction:null==m?void 0:m.entityCommand.entity.action,errorCode:g,reason:h}),{terminateDeeplink:u,intent:m,errorCode:g}}))}function Lj(e){const{commandChangeReportingService:t,correlationId:i,externalId:n,deeplinkType:o,mainEntityType:r,mainEntityAction:s,errorCode:a,reason:l,loadingWindowType:c}=e,d="deeplink-parsing";t.report({correlationId:i,type:Ae.B.DeeplinkParsed,context:{target:d,eventData:{externalId:n,deeplinkType:o,loadingWindowType:c,mainEntityType:r,mainEntityAction:s,errorCode:a,reason:l}}}),t.report({type:Ae.B.ScenarioEventDataAppended,correlationId:i,context:{target:d,eventData:{externalId:n,deeplinkType:o,loadingWindowType:c,mainEntityType:r,mainEntityAction:s,errorCode:a,reason:l}}})}const Uj=e=>decodeURIComponent(e).replace(/[^A-Za-z0-9/.?&=#\+\-,_:@{}"]/g,"");class Wj{constructor(e,t,i,n,o,r,s,a,l,c,d,u,m,g,h,p,v,y,f){this._client=n,this._waitForRenderingContextReady=o,this._host=r,this._appsRegistryService=s,this._config=a,this._correlation=l,this._scenarioFactory=c,this._userBiService=d,this._commandChangeReportingService=u,this._hostComms=m,this._localStorage=g,this._experienceChangeReportingService=h,this._acountModeTrackingService=p,this._activeWindowsService=v,this._authenticationService=y,this._delegatedCommanding=f,this._logger=e.newLogger("DeepLinkService","core-services-deeplink"),this._intentService=new yj(e,this._appsRegistryService,t,i,this._client,this._waitForRenderingContextReady,this._commandChangeReportingService,this._experienceChangeReportingService,this._scenarioFactory,this._hostComms,this._host,this._activeWindowsService,this._userBiService,this._delegatedCommanding),this._loggerFactory=e,this._coreSettings=t}init(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._host.addEventListener("hashchange",(()=>{const e=function(e,t,i){return{clientLaunchId:ps({location:e,clientLaunchId:i}),correlation:vs(e,t),deeplinkId:fs(e,"deeplinkId")}}(this._host.location,k.D.ExternalCommand);return this._handleUrl(!1,e)})),this._handleUrl(!0,{clientLaunchId:ps({location:this._host.location}),correlation:Object.assign({scenarioName:U.RG.ClientStart},this._correlation),deeplinkId:fs(this._host.location,"deeplinkId")})}))}executeFromUrlAsync(e,t,i,n,r,s,a){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o;this._logger.log(`executeFromUrlAsync::deepLinkUrl::'${e}'`);try{const l=new URL(e);o={correlation:(null==t?void 0:t.correlation)?Ue(t.correlation):vs(l,k.D.InternalDeeplink),clientLaunchId:n},n&&this.sendDeeplinkReceivedSignal(o,i);const c=JI(this._coreSettings),d=QI(l,this._coreSettings),u=this._coreSettings.get(b.J.Core).enableCrossCloudLaunch;if(!a&&!this._isValidDeepLinkUrlForInCloudOrCrossCloudExecution(e,d))return this.stopNavigationScenarios(o,Ae.B.Incomplete,De.y.DeeplinkIntentParseFailure,`Current cloud: ${c}, deeplinkCloud: ${d}, enableCrossCloudLaunch: ${u}`),!1;if(!a&&u&&d&&d!==c)return yield tj(d,this._commandChangeReportingService,e,this._hostComms,o.correlation,null==r?void 0:r.userContextId),!0;const{terminateDeeplink:m,intent:g}=yield this._getNavigationIntentAsync(l,!0,o,t,null==r?void 0:r.userContextId,s,a);return m?(this.stopNavigationScenarios(o,Ae.B.Incomplete,De.y.DeeplinkExecutionTerminated),!0):g?(g.options={isFromDeeplink:!0,sourceWindowId:null==r?void 0:r.windowId},yield this._intentService.execute(g),!0):(this.stopNavigationScenarios(o,Ae.B.Incomplete,De.y.DeeplinkIntentParseFailure),!1)}catch(e){const t=`${Mt}${Rt.ToNavigationIntentFailed} ${(0,M.u4)(e)}`;throw o&&this.stopNavigationScenarios(o,Ae.B.Failure,De.y.DeeplinkIntentParseFailure,t),new Error(t)}}))}checkForPendingIntent(e,t,i){const n=Ue({source:e,scenarioName:U.RG.NavigationCommand});return t&&this.sendDeeplinkReceivedSignal({clientLaunchId:t,correlation:n},{type:"pendingIntent"}),this._intentService.checkForPendingIntent(n,i)}launchMainApp(e,t,i,n){const o={correlation:Ue(Object.assign({scenarioName:U.RG.NavigationCommand},e)),clientLaunchId:ps({clientLaunchId:t})};o.clientLaunchId&&this.sendDeeplinkReceivedSignal(o,{type:"default"});const r=null!=i?i:{type:pe.py.default,action:pe.uk.default};return this._intentService.launchMainApp(Ss(r),o,r,n)}launchMinimode(e,t,i){const n={correlation:Ue(Object.assign({scenarioName:U.RG.NavigationCommand},e)),clientLaunchId:ps({clientLaunchId:t})};n.clientLaunchId&&this.sendDeeplinkReceivedSignal(n,{type:"default"});const o=null!=i?i:{type:pe.py.default,action:pe.uk.default};return this._intentService.launchMinimode(Ss(o),n,o)}switchAccount(e,t,i,n,r,s){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o={correlation:Ue(Object.assign({scenarioName:U.RG.NavigationCommand},e)),clientLaunchId:ps({clientLaunchId:i})};o.clientLaunchId&&this.sendDeeplinkReceivedSignal(o,{type:"switchAccount"});const a=null!=n?n:{type:pe.py.default,action:pe.uk.default};return r&&r!==JI(this._coreSettings)?tj(r,this._commandChangeReportingService,Ss(a),this._hostComms,o.correlation,t):this._intentService.switchAccount(Ss(a),o,a,t,s)}))}prewarmFlyout(e,t=!1){const i={correlation:Ue({source:e,scenarioName:U.RG.NavigationCommand}),clientLaunchId:ps({})},n=t?"minimode":"flyout";return this.sendDeeplinkReceivedSignal(i,{type:n}),this._intentService.prewarmFlyout(i,t)}executeIntent(e){var t,i;const n={correlation:Ue(Object.assign(Object.assign({},e.entityCommand.command.correlation),{scenarioName:U.RG.NavigationCommand})),clientLaunchId:ps({})};this.sendDeeplinkReceivedSignal(n,{type:`${e.entityCommand.entity.type}/${e.entityCommand.entity.action}`});const o=e.metadata.deepLink,r=this._coreSettings.get(b.J.Core).enableCrossCloudLaunch;if(o&&r){this._logger.log(`executeIntent::deepLinkUrl::'${o}'`);try{const t=QI(new URL(o),this._coreSettings);if(t&&t!==JI(this._coreSettings)&&this._isValidDeepLinkUrlForInCloudOrCrossCloudExecution(o,t))return tj(t,this._commandChangeReportingService,o,this._hostComms,n.correlation,e.metadata.userContextId)}catch(e){const n=`${Mt}${Rt.InvalidDeepLinkUrl}::${null==e?void 0:e.name}`;null===(i=(t=this._logger).warnToTelemetry)||void 0===i||i.call(t,n,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}}return this._intentService.execute(Object.assign(Object.assign({},e),{entityCommand:Object.assign(Object.assign({},e.entityCommand),{command:Object.assign(Object.assign({},e.entityCommand.command),{correlation:n.correlation})}),metadata:Object.assign(Object.assign({},e.metadata),{deepLink:o||Ss(e.entityCommand.entity)}),scenarioCorrelation:n,shouldRenderContent:!0}))}_handleUrl(e,t){var i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this._lastDesktopClientId&&this._lastDesktopClientId===t.clientLaunchId)return void(null===(n=(i=this._logger).errorToTelemetry)||void 0===n||n.call(i,"Navigation received with duplicate clientId. Terminating flow.","webclient_framework_foundation_core_services_deeplink",void 0,!0));this._lastDesktopClientId=t.clientLaunchId;const o=this._host.location;this._logger.log(`_handleUrl::location::'${o.href}'`),t.correlation.scenarioName&&t.clientLaunchId&&this.sendDeeplinkReceivedSignal(t);const{terminateDeeplink:r,intent:s}=yield this._getNavigationIntentAsync(o,!1,t);let a=s;return r?(yield this._notifyIntentHandled(),this.stopNavigationScenarios(t,Ae.B.Incomplete,De.y.DeeplinkExecutionTerminated),void(yield this._clearHashFromLocation())):(!a&&this._config.shouldExecuteDefaultCommand&&(a=Dj({scenarioCorrelation:t,userContextId:void 0,deepLink:is.n0.default,entity:Rj(),layoutMode:ve.lO.standard})),a?(yield this._notifyIntentHandled(),e&&this._experienceChangeReportingService.report({correlationId:t.correlation.id,type:ft.yU.InitialDeeplinkResolved,context:{target:"deeplink-service-handle-url",shouldRenderContent:a.shouldRenderContent}}),a.options={shouldSkipMinimodeOverride:e,isFromDeeplink:!0},this._intentService.execute(a,this._clearHashFromLocation.bind(this))):(this.stopNavigationScenarios(t,Ae.B.Failure,De.y.DeeplinkIntentParseFailure),void(yield this._clearHashFromLocation())))}))}_isValidDeepLinkUrlForInCloudOrCrossCloudExecution(e,t){var i,n;try{const i=this._coreSettings.get(b.J.Core).validCloudsForInternalDeeplinks||[];return(!t||i.includes(t))&&(0,BI.H)(e,this._coreSettings)}catch(e){const t=`${Mt}${Rt.InvalidDeepLinkUrl}::${null==e?void 0:e.name}`;return null===(n=(i=this._logger).errorToTelemetry)||void 0===n||n.call(i,t,"webclient_framework_foundation_core_services_deeplink",void 0,!0),!1}}_notifyIntentHandled(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const t=yield this._hostComms.loadModule("core");yield null===(e=null==t?void 0:t.intentHandled)||void 0===e?void 0:e.call(t)}catch(e){this._logger.warn("Failed to notify host that intent was handled")}}))}_clearHashFromLocation(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{clientPreviewOptOutStrategy:e}=this._coreSettings.get(b.J.Core);if("Web"!==e)return;const t=this._host.location;if(t.search.includes("meetingjoin=true")){if((yield this._authenticationService.getUser()).role===Es.w4.Anonymous)return}if(t.hash){this._logger.log("Clearing hash from location");const e=new URL(t.href);e.hash="",this._host.history.pushState("",this._host.document.title,e)}}))}_getNavigationIntentAsync(e,t,i,n,r,s,a){var l,c;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield xj({authenticationService:this._authenticationService,appsRegistryService:this._appsRegistryService,experienceBasePath:this._config.basePath,coreSettings:this._coreSettings,hostCommunicationService:this._hostComms,location:e,scenarioCorrelation:i,loggerFactory:this._loggerFactory,userBiService:this._userBiService,isInternalDeeplink:t,commandChangeReportingService:this._commandChangeReportingService,intentPersistenceService:new $I.I(this._localStorage),userContextId:r,client:this._client,preferredCommandInput:n,sourceViewEntity:s,scenarioFactory:this._scenarioFactory,forceInCloudExecution:a,getExperienceAccountMode:()=>this._acountModeTrackingService?this._acountModeTrackingService.getAccountMode():WI.b.SingleAccount,waitForRenderingContextReady:this._waitForRenderingContextReady})}catch(e){null===(c=(l=this._logger).errorToTelemetry)||void 0===c||c.call(l,`${Mt}${Rt.ToNavigationIntentFailed}`,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}return{terminateDeeplink:!1}}))}sendDeeplinkReceivedSignal({clientLaunchId:e,correlation:t,deeplinkId:i},n){this._scenarioFactory.findScenarioByNameAndId(U.RG.NavigationCommand,e)&&(t.scenarioName=U.RG.NavigationCommand),this._commandChangeReportingService.report({type:Ae.B.NavigationCommandStart,correlationId:t.id,context:{target:"deeplink-service",clientLaunchId:e,correlation:t,eventData:Object.assign({deeplinkId:i,scenarioPhase:"Core"},n)}})}stopNavigationScenarios(e,t,i,n){this._logger.warn("Navigation intent not found");const o=this._scenarioFactory.findScenario(U.RG.ApplicationLaunchTime);null==o||o.fail({errorCode:i}),this._commandChangeReportingService.report({type:t,correlationId:e.correlation.id,context:{target:"deeplink-service-handle-url",errorInfo:i,errorMessage:n}})}}class Bj extends Ce.i{constructor(){super(f.Yg.CreateDeeplinkService,["activeWindowsService","appsRegistryService","authenticationService","client","commandChangeReportingService","commandHandler","config","coreSettings","correlation","delegatedCommanding","experienceChangeReportingService","hostCommunicationService","localStorage","loggerFactory","scenarioFactory","userBiService","waitForRenderingContextReady","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,appsRegistryService:i,authenticationService:n,client:o,commandChangeReportingService:r,commandHandler:s,config:a,coreSettings:l,correlation:c,delegatedCommanding:d,experienceChangeReportingService:u,hostCommunicationService:m,localStorage:g,loggerFactory:h,scenarioFactory:p,userBiService:v,userTrackingService:y,waitForRenderingContextReady:f,windowProvider:S}=e;e.deeplinkService=new Wj(h,l,s,o,f,S,i,a,c,p,v,r,m,g,u,y,t,n,d)}))}}const $j="default";class Hj extends Ce.i{constructor(){super(f.Yg.CreateDefaultCacheStorageAndCacheManagers,["config","loggerFactory","windowProvider","coreSettings","scenarioFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{windowProvider:t,config:i,loggerFactory:n,coreSettings:o,scenarioFactory:r}=e,s=new Dl(t.caches,$j,$j,i.experienceName);e.cacheStorage=s,e.offlineCacheManager=new Fl(s,n);(0,nd.Q6)(o)&&(e.workerCacheManager=Yc(i.experienceName,n.newLogger("CreateDefaultCacheStorageAndCacheManagersTask","core-services-tasks"),r))}))}}const qj="tmp";class zj{constructor(e,t,i,n,o){this.tid=e,this.oid=t,this.experienceName=i,this.windowProvider=n,this.logger=o.newLogger("LocalStorageService","services-io-browser-local-storage")}set(e,t,i,n="UserAndExperience"){const o=this.getFormatKey(e,n);return this.windowProvider.localStorage.setItem(o,t)}trySet(e,t,i,n="UserAndExperience"){var o,r;try{return this.set(e,t,i,n),!0}catch(t){return null===(r=(o=this.logger).errorToTelemetry)||void 0===r||r.call(o,`Failed to set key '${e}', category '${i}'`,"webclient_framework_localstorage_tryset",{errorCode:null==t?void 0:t.name},!0),!1}}get(e,t="UserAndExperience"){const i=this.getFormatKey(e,t);return this.windowProvider.localStorage.getItem(i)}remove(e,t="UserAndExperience"){const i=this.getFormatKey(e,t);return this.windowProvider.localStorage.removeItem(i)}clear(e){if(e){const t=e.map((e=>this.getFormatKey("",e)));Object.keys(this.windowProvider.localStorage).filter((e=>e.startsWith(qj)&&t.some((t=>e.startsWith(t))))).forEach((e=>this.windowProvider.localStorage.removeItem(e)))}else this.windowProvider.localStorage.clear()}calculateUsageStats(){const e={Global:{},User:{},Experience:{},UserAndExperience:{},Unmanaged:{}};return Object.keys(this.windowProvider.localStorage).forEach((t=>{const i=this.getScopeFromKey(t);i&&(e[i][t]=(this.windowProvider.localStorage[t].length+t.length)/512)})),e}getScopeFromKey(e){let t=this.getFormatKey("","UserAndExperience");return e.startsWith(t)?"UserAndExperience":(t=this.getFormatKey("","User"),e.startsWith(t)?"User":(t=this.getFormatKey("","Experience"),e.startsWith(t)?"Experience":(t=this.getFormatKey("","Global"),e.startsWith(t)?"Global":"Unmanaged")))}getFormatKey(e,t){switch(t){case"Experience":return`${qj}.${this.experienceName}.${e}`;case"User":return`${qj}.${this.tid}.${this.oid}.${e}`;case"Global":return`${qj}.${e}`;default:return`${qj}.${this.tid}.${this.oid}.${this.experienceName}.${e}`}}}const Vj="default";class Gj extends Ce.i{constructor(){super(f.Yg.CreateDefaultLocalStorage,["config","loggerFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{windowProvider:t,loggerFactory:i,config:n}=e,o=new zj(Vj,Vj,n.experienceName,t,i);e.localStorage=o}))}}class Jj extends Ce.i{constructor(){super(f.Yg.DisableExperience,["platformService","coreSettings","loggerFactory"])}execute(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{platformService:i,coreSettings:n,loggerFactory:o}=e,r=null===(t=i.config)||void 0===t?void 0:t.browser,{supportedBrowsers:s}=n.get(b.J.Core);if(r&&s){if(!!!(null==s?void 0:s.find((e=>e===r))))throw(0,se.Tr)(f.w5.Core,f.jK.Disabled,"DisableUnsupportedBrowsersTask",void 0,`Browser "${r}" is not supported.`)}else r||o.newLogger("DisableUnsupportedBrowsersTask","core-services-tasks").warn("Unable to detect Browser.")}))}}class Kj extends Ce.i{constructor(){super(f.Yg.CreateDiscovery,["authenticationService","loggerFactory","coreSettings","scenarioFactory","appStateService","networkState","hostCommunicationService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{onDiscoverSuccess:t,onDiscoverFail:i}=this.getDiscoverCallback(e),{authenticationService:n,loggerFactory:o,coreSettings:r,scenarioFactory:s,appStateService:a,networkState:l,authStateProvider:c,i18n:d,hostCommunicationService:u}=e,m=(0,Za.Gg)(a);e.discover=Xa(n,o,el.l,r,s,m,l,u,d,c,void 0,t,i,void 0,void 0)}))}getDiscoverCallback(e){var t;let i,n;return(null===(t=e.platformService)||void 0===t?void 0:t.config.hostingParent)===wr.GJ.Outlook&&(i=()=>{e.windowProvider.sessionStorage.removeItem(zT.v4),e.windowProvider.sessionStorage.removeItem(zT.F_)},n=t=>{t||"true"!==e.windowProvider.sessionStorage.getItem(zT.F_)||(e.windowProvider.sessionStorage.setItem(zT.v4,"true"),e.windowProvider.location.reload())}),{onDiscoverSuccess:i,onDiscoverFail:n}}}var Qj;!function(e){e[e.Success=0]="Success",e[e.InvalidArguments=1]="InvalidArguments",e[e.GroupNameExists=2]="GroupNameExists"}(Qj||(Qj={}));class Yj{constructor(e){this.isCompleted=!1,this.subscriptions=new Set,this.observedValue=e,this.observable$=new Wl((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e,t){return this.isCompleted&&t.error("Subject: tried to subscribe to a complete observable"),this.observable$.subscribe(e)}onNext(e){this.observedValue=e,this.subscriptions.forEach((t=>{t.next(Object.assign({},e))}))}onComplete(){this.isCompleted=!0,this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.isCompleted=!0,this.subscriptions.forEach((t=>{t.error(e)}))}get value(){return this.observedValue}}class Xj{constructor(){this._endpointsHealthCache={},this._groupsHealthCache={},this.getEndpointHealth=(e,t)=>{if(e&&t){const i=this._endpointsHealthCache[this._getCacheKey(e,t)];return i?Object.assign({},i.value):void 0}},this.observeEndpointHealth=(e,t)=>e&&t?this._getHealthRecord(e,t).observable:void 0,this.observeAggregatedHealth=e=>e?this._getHealthRecord(e,void 0).observable:void 0,this.dumpState=()=>JSON.stringify(Object.assign(Object.assign({},this._endpointsHealthCache),this._groupsHealthCache),((e,t)=>t instanceof Yj?t.value:t)),this.updateRemoteEndpointHealth=e=>{if(!e.serviceName)return;const t=this._getHealthRecord(e.serviceName,e.endpointName);t.value.isHealthy!==e.isHealthy&&(t.value.isHealthy=e.isHealthy,t.onNext(t.value))},this._getCacheKey=(e,t)=>`${e}_${t||""}`,this._getHealthRecord=(e,t)=>(t?this._endpointsHealthCache[this._getCacheKey(e,t)]:this._groupsHealthCache[this._getCacheKey(e,t)])||this._startTrackingHealth(e,t),this._startTrackingHealth=(e,t)=>{if(t){const i=new Yj({serviceName:e,endpointName:t,isHealthy:void 0});return this._endpointsHealthCache[this._getCacheKey(e,t)]=i,i}{const i=new Yj({groupName:e,isHealthy:void 0});return this._groupsHealthCache[this._getCacheKey(e,t)]=i,i}}}getAggregatedHealth(e){if(e){const t=this._groupsHealthCache[this._getCacheKey(e,void 0)];return t?Object.assign({},t.value):void 0}}dispose(){this._endpointsHealthCache={},this._groupsHealthCache={}}}class Zj{constructor(e,t){this._endpointsManager=e,this._logger=t,this._subscriptions=[],this._aggregatedHealthMap=new Map,this._remoteEndpointsHealthCache=new Xj,this.observeEndpointHealth=(e,t)=>this._getLocalEndpointHealth(e,t)?this._getLocalEndpointObservable(e,t):this._getRemoteEndpointHealth(e,t)?this._getRemoteEndpointObservable(e,t):this._getLocalEndpointObservable(e,t),this.getEndpointHealth=(e,t)=>this._getLocalEndpointHealth(e,t)||this._getRemoteEndpointHealth(e,t),this.observeAggregatedHealth=e=>{var t;return null===(t=this._aggregatedHealthMap.get(e))||void 0===t?void 0:t.healthSubject.observable},this.getAggregatedHealth=e=>this._getLocalAggregatedHealth(e)||this._getRemoteAggregatedHealth(e),this.dumpState=()=>(0,M.LQ)(`{ "aggregated endpoints health": [\n      ${this._printAggregatedHealth(this._aggregatedHealthMap)}\n    ],\n    "endpoints health": [\n      ${this._endpointsManager.health.dumpState()}\n    ]},\n    "remote endpoints health": ${this._remoteEndpointsHealthCache.dumpState()}`),this.getWorkerDumpState=()=>this._requestWorkerStateDumpCallback?(this._deferredWorkerStateDump=(0,Jl.P)(),this._requestWorkerStateDumpCallback(),this._deferredWorkerStateDump.promise):Promise.reject("Worker endpoints health snapshot can't be requested"),this.getEndpointsHealthUpdateHandler=()=>({handleEndpointHealthUpdate:this._remoteEndpointsHealthCache.updateRemoteEndpointHealth,handleStateDump:this._handleWorkerStateDumpResponse,onStateDumpRequest:this._setWorkerStateDumpRequestCallback}),this._getLocalEndpointHealth=(e,t)=>this._endpointsManager.health.getEndpointHealth(e,t),this._getLocalEndpointObservable=(e,t)=>this._endpointsManager.health.observeEndpointHealth(e,t),this._getRemoteEndpointHealth=(e,t)=>this._remoteEndpointsHealthCache.getEndpointHealth(e,t),this._getRemoteEndpointObservable=(e,t)=>this._remoteEndpointsHealthCache.observeEndpointHealth(e,t),this._updateAggregatedHealth=(e,t,i)=>{const n=e.healthSubject.value,o=[];if(n.endpoints)for(const e of n.endpoints)if(e.endpointName===t.endpointName&&e.serviceName===t.serviceName)o.push(t);else{const t=this._endpointsManager.health.getEndpointHealth(e.serviceName,e.endpointName);t&&o.push(t)}try{const t=i(o);t!==n.isHealthy&&(n.isHealthy=t,e.healthSubject.onNext(n))}catch(e){this._logger.error(`Error happened in aggregated group health policy. Group: ${n.groupName}. Error: ${JSON.stringify(e.reason||e)}`)}},this._printAggregatedHealth=e=>{let t="";return e.forEach((e=>{t=`${t},${JSON.stringify(e.healthSubject.value)}`})),t?(0,M.LQ)(t):""},this._handleWorkerStateDumpResponse=e=>{this._logger.log("Received worker endpoints health state dump."),this._deferredWorkerStateDump&&(this._deferredWorkerStateDump.resolve(e),this._deferredWorkerStateDump=void 0)},this._setWorkerStateDumpRequestCallback=e=>{this._requestWorkerStateDumpCallback=e}}createAggregatedHealthGroup(e,t,i){if(!e||0===e.length||!t||0===t.length)return this._logger.error(`createAggregatedHealthGroup: Group name is empty or no endpoints are provided. groupName: ${e}; endpoints: ${t&&JSON.stringify(t)}`),Qj.InvalidArguments;if(this.getAggregatedHealth(e))return this._logger.error(`createAggregatedHealthGroup: Group name already exists. groupName: ${e}`),Qj.GroupNameExists;const n={healthSubject:new Yj({groupName:e,endpoints:t,isHealthy:void 0})};return this._aggregatedHealthMap.set(e,n),t.forEach((t=>{var n;const o=null===(n=this.observeEndpointHealth(t.serviceName,t.endpointName))||void 0===n?void 0:n.subscribe((t=>{const n=this._aggregatedHealthMap.get(e);n||this._logger.error(`Can't update group health. Group '${e}' is not registered`),n&&this._updateAggregatedHealth(n,t,i)}));o&&this._subscriptions.push(o)})),Qj.Success}dispose(){var e;this._subscriptions.map((e=>e.unsubscribe())),this._subscriptions=[],this._aggregatedHealthMap.clear(),this._remoteEndpointsHealthCache.dispose(),this._requestWorkerStateDumpCallback=void 0,null===(e=this._deferredWorkerStateDump)||void 0===e||e.reject("CombinedEndpointsHealthService is disposed"),this._deferredWorkerStateDump=void 0}_getLocalAggregatedHealth(e){var t;return null===(t=this._aggregatedHealthMap.get(e))||void 0===t?void 0:t.healthSubject.value}_getRemoteAggregatedHealth(e){return this._remoteEndpointsHealthCache.getAggregatedHealth(e)}}class eN{constructor(e,t){this._endpointsManager=e,this._logger=t,this._subscriptions=[],this._aggregatedHealthMap=new Map,this.observeEndpointHealth=(e,t)=>this._endpointsManager.health.observeEndpointHealth(e,t),this.getEndpointHealth=(e,t)=>this._endpointsManager.health.getEndpointHealth(e,t),this.observeAggregatedHealth=e=>{var t;return null===(t=this._aggregatedHealthMap.get(e))||void 0===t?void 0:t.healthSubject.observable},this.getAggregatedHealth=e=>{var t;return null===(t=this._aggregatedHealthMap.get(e))||void 0===t?void 0:t.healthSubject.value},this.dumpState=()=>`{ "aggregated endpoints health": [\n      ${this._printAggregatedHealth(this._aggregatedHealthMap)}\n    ],\n    "endpoints health": [\n      ${this._endpointsManager.health.dumpState()}\n    ]}`,this._updateAggregatedHealth=(e,t,i)=>{const n=e.healthSubject.value,o=[];if(n.endpoints)for(const e of n.endpoints)if(e.endpointName===t.endpointName&&e.serviceName===t.serviceName)o.push(t);else{const t=this._endpointsManager.health.getEndpointHealth(e.serviceName,e.endpointName);t&&o.push(t)}try{const t=i(o);t!==n.isHealthy&&(n.isHealthy=t,e.healthSubject.onNext(n))}catch(e){this._logger.error(`Error happened in aggregated group health policy. Group: ${n.groupName}. Error: ${JSON.stringify(e.reason||e)}`)}},this._printAggregatedHealth=e=>{let t="";return e.forEach((e=>{t=`${t},${JSON.stringify(e.healthSubject.value)}`})),t?(0,M.LQ)(t):""}}createAggregatedHealthGroup(e,t,i){if(!e||0===e.length||!t||0===t.length)return this._logger.error(`createAggregatedHealthGroup: Group name is empty or no endpoints are provided. groupName: ${e}; endpoints: ${t&&JSON.stringify(t)}`),Qj.InvalidArguments;if(this.getAggregatedHealth(e))return this._logger.error(`createAggregatedHealthGroup: Group name already exists. groupName: ${e}`),Qj.GroupNameExists;const n={healthSubject:new Yj({groupName:e,endpoints:t,isHealthy:void 0})};return this._aggregatedHealthMap.set(e,n),t.forEach((t=>{var n;const o=null===(n=this.observeEndpointHealth(t.serviceName,t.endpointName))||void 0===n?void 0:n.subscribe((t=>{const n=this._aggregatedHealthMap.get(e);n||this._logger.error(`Can't update group health. Group '${e}' is not registered`),n&&this._updateAggregatedHealth(n,t,i)}));o&&this._subscriptions.push(o)})),Qj.Success}dispose(){this._subscriptions.map((e=>e.unsubscribe())),this._subscriptions=[],this._aggregatedHealthMap.clear()}}var tN=i(412938),iN=i(401110);const nN=({url:e,method:t,body:i,headers:n,credentials:o,timeout:r,signal:s},a,l)=>{if(null==s?void 0:s.aborted)throw(0,ca.T)(la.A.RequestCancelled);return da(iN(e,{method:t,headers:n&&new Headers(n),body:i,signal:s,credentials:o}),a,null!=r?r:l.defaultRequestTimeoutInMs).then((e=>{var t;const i={};return null===(t=e.headers)||void 0===t||t.forEach(((e,t)=>i[t]=e)),{status:e.status,headers:i,body:e,url:e.url}}))},oN="failed to fetch";const rN=(e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const i=e.operationLogger.logStep(ia.nz.AuthDecorate);try{const n=yield t(e);return i(ia.qb[ia.qb.OK]),n}catch(e){throw i(la.A.AuthFailed),(0,ca.T)(la.A.AuthFailed,void 0,e)}})),sN=(e,t,i)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const n=t.operationLogger.beginStep(ia.nz.AuthResolve,t);try{const o=i(e,t);return o.then((t=>(t&&n(ia.qb[e.status],e),t))),yield o}catch(t){throw n(ia.qb[e.status],e),(0,ca.T)(la.A.AuthResolveFailed,e,t)}}));function aN(e,t=ia.qb.NOT_FOUND){return Array.isArray(t)?t.some((t=>lN(e,t))):lN(e,t)}function lN(e,t){return"string"==typeof t?new RegExp(t.replace(/x/gi,"\\d")).test(e.toString()):e===t}const cN=(e,t)=>t.indexOf(e)>-1||t.filter(dN).map((e=>new RegExp(e.replace(/x/gi,"\\d")))).some((t=>t.test(e.toString())));function dN(e){return"string"==typeof e}const uN=(e,t,i,{globalContext:n})=>r=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){let o=yield mN(e)(r);for(let s=0;;s++){const{response:a,error:l}=o,c=null==a?void 0:a.status,d=c||(null==l?void 0:l.reason)||la.A.FailedToFetch,u=null==a?void 0:a.headers,m=i.get(d)||0;if(i.set(d,m+1),!t.shouldRetry(s,d,i,u)){if(l)throw l;return o.response}{const i=t.nextDelay(s,u,d),m=c&&ia.qb[c]||void 0;r.operationLogger.nextStep(ia.nz.RetryDelay,l||m,void 0,a),yield ua(i,n),r.operationLogger.nextStep(ia.nz.Retry,ia.qb[ia.qb.OK],r),o=yield mN(e)(r)}}})),mN=e=>t=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{return{response:yield e(t)}}catch(e){return{response:e.serverResponse,error:e}}}));const gN=(e,t)=>{if(e){const i=t.get(e);if(!i)throw(0,ca.T)(la.A.InvalidCancellationToken);return i}},hN=(e,t,i,n)=>{const{cancellationMap:r}=n;let s=e;return s=function(e,t,i){return n=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var o;const{cancellationToken:r}=n,s=null!==(o=gN(r,t))&&void 0!==o?o:new AbortController;n.signal=s.signal;try{return yield e(n)}catch(e){throw(null==e?void 0:e.reason)!==la.A.TimedOut||void 0!==i&&!i||s.abort(),e}}))}(s,n.cancellationMap,t.abortOnTimeout),i.authResource&&(s=((e,t)=>i=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const n=yield rN(i,t),o=n.request,r=yield e(o),s=yield sN(r,o,n.resolver);return s?(s.operationLogger.nextStep(ia.nz.Auth,ia.qb[r.status],s,r),e(s)):r})))(s,i.authResource)),s=((e,t,i)=>n=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{baseUrl:o,baseUrlPromise:r}=t,s=n.operationLogger.logStep(ia.nz.BaseUrlResolve),a=o||r&&(yield da(r().catch((e=>{throw s(e.reason),(0,ca.T)(la.A.BaseUrlFailedToResolve,void 0,e)})),i.globalContext,i.configuration.baseUrlResolutionTimeoutInMs,la.A.BaseUrlTimeout));try{if(a){const e=!a.endsWith("/")&&n.url.length>0?`${a}/`:a,t=n.url.startsWith("/")?n.url.substring(1):n.url;n.url=new URL(t,e).href}}catch(e){throw s(la.A.InvalidUrl),(0,ca.T)(la.A.InvalidUrl)}return s(ia.qb[ia.qb.OK]),e(n)})))(s,i,n),s=((e,t,i)=>{if(!t.redirectPolicy)return e;const{maxRedirects:n,useAbsoluteRedirect:r,headers:s,redirectOn:a,onRedirect:l}=t.redirectPolicy;return t=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const o=Object.assign(Object.assign({},t),{headers:Object.assign(Object.assign({},t.headers),s)});let c=yield e(o);for(let s=0;;s++){const{status:d,headers:{location:u}}=c;if(!(s<n&&aN(d,a)))return c;try{let e;if(l?e=l(u,d):u&&(e=new URL(u)),!e)return c;r?(i.baseUrl=e.origin,o.url=e.pathname):(o.url=t.url,i.baseUrl=e.href)}catch(e){throw(0,ca.T)(la.A.InvalidUrl,void 0,e)}o.operationLogger.nextStep(ia.nz.Redirect,ia.qb[c.status],o,c),c=yield e(o)}}))})(s,t,i),t.rejectHttpError&&(s=function(e){return t=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield e(t);if(i.status>=ia.qb.BAD_REQUEST)throw(0,ca.T)(la.A.RequireStatusFailed,i,[ia.qb[i.status]]);return i}))}(s)),t.allowedResponses&&(s=function(e,...t){return i=>e(i).then((e=>{if(cN(e.status,t))return e;const i=[ia.qb[e.status]];throw(0,ca.T)(la.A.RequireStatusFailed,e,i)}))}(s,...t.allowedResponses)),t.retryPolicy&&(s=function(e,t,i){const n=new Map;return o=>uN(e,t,n,i)(o)}(s,t.retryPolicy,n)),s=((e,t)=>i=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{cancellationToken:n}=i;n&&t.set(n,new AbortController);try{return yield e(i)}finally{n&&t.delete(n)}})))(s,r),s};function pN(e,t,i){if(!t)return;const n=i?new URL(i.url).hostname:"";return{name:t.apiName||"",dateTime:e,method:t.method,hostname:n,requestHeaders:t.headers||{},responseHeaders:(null==i?void 0:i.headers)||{},status:null==i?void 0:i.status,performance:vN(null==i?void 0:i.url),authPerformanceLogs:t.authPerformanceLogs||{}}}function vN(e){return e?new Promise((t=>{const i=new PerformanceObserver((n=>{const o=n.getEntries().find((t=>e===t.name));o&&(i.disconnect(),t(o))}));i.observe({entryTypes:["resource"]})})):Promise.reject()}class yN{constructor(e){this.subscriptions=new Set,this.observedValue=e,this.observable$=new Wl((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e){return this.observable$.subscribe(e)}onNext(e){this.observedValue=e,this.subscriptions.forEach((t=>{t.next(e)}))}onComplete(){this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.subscriptions.forEach((t=>{t.error(e)}))}get value(){return this.observedValue}}const fN=!0,SN=new yN(fN);const kN=()=>{const e=new Map,t=(t,i)=>e.get(CN(t,i))||((t,i)=>{const n={responseHistory:[],healthSubject:new yN({serviceName:t,endpointName:i,isHealthy:void 0})};return e.set(CN(t,i),n),n})(t,i),i=(e,i,n,o)=>{const r=t(i,e);((e,t,i)=>{e.responseHistory.push(t),e.responseHistory.length>i&&e.responseHistory.shift()})(r,n,o.historyLength);const s=o.isHealthy([...r.responseHistory]);if(r.healthSubject.value.isHealthy!==s){const t={serviceName:i,endpointName:e,isHealthy:s};r.healthSubject.onNext(t)}};return{trackHealth:(e,t,n)=>_N(e,i,t,bN(n)),observeEndpointHealth:(e,i)=>{if(!e||!i)return;return t(e,i).healthSubject.observable},getEndpointHealth:(t,i)=>wN(t,i,e),dumpState:()=>IN(e)}},bN=e=>Object.assign(Object.assign({},TN),e),wN=(e,t,i)=>{var n;const o=null===(n=i.get(CN(e,t)))||void 0===n?void 0:n.healthSubject.value;return o&&Object.assign({},o)},CN=(e,t)=>`${e}_${t}`,_N=(e,t,i,n)=>r=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return e(r).then((e=>(t(r.apiName||"",i,e.status,n),e))).catch((e=>{throw t(r.apiName||"",i,e.reason,n),e}))})),TN={isHealthy:e=>{if(e&&e.length>0){const t=e[e.length-1];if("number"!=typeof t&&t!==la.A.RequestCancelled)return!1}return!0},historyLength:5};const IN=e=>{let t="";return e.forEach((e=>{t=`${t}${JSON.stringify(e.healthSubject.value)}`})),t?null==(i=t)||0===i.length?i:` ${i}`.substr(1):"";var i},jN=e=>t=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var i,n;try{if(e.transformResponse)return yield e.transformResponse(t);if(t.status===ia.qb.NO_CONTENT)return;const o=e.responseType||function(e){if(e.headers){const t=e.headers["content-type"];if(t){if(-1!==t.indexOf("application/json"))return"json";if(-1!==t.indexOf("text/"))return"text"}if("0"===e.headers["content-length"])return"text"}return}(t)||"json";return yield t.body&&(null===(n=(i=t.body)[o])||void 0===n?void 0:n.call(i))}catch(e){throw"AbortError"===e.name?(0,ca.T)(la.A.RequestCancelled):(0,ca.T)(la.A.TransformFailed,t,e)}}));const NN=(e,t,i)=>{let n,r;return t.then((e=>{if(e.throttlePolicy){r=e.throttlePolicy;const t=null==r?void 0:r.throttleKey;t?(n=i.get(t)||[],i.has(t)||i.set(t,n)):n=[]}})),t=>r?i=>function i(s){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=function(e,t){const{maxPerThrottleInterval:i,throttleInterval:n}=t,o=Date.now()-n;let r=e.length-1;for(;r>=0&&o<e[r];)r--;e.splice(0,r);const s=e.length-i;return s>=0?e[s]-o:0}(n,r);if(!o)return function(e){return n.push(Date.now()),t(e)}(s);const a=s.operationLogger.logStep(ia.nz.Throttle);return yield ua(o,e),a&&a(ia.qb[ia.qb.OK]),i(s)}))}(i):t};function EN(e,t){const{globalContext:i}=t,n=new Map,r=new Map,{networkMonitor:s,networkState:a}=(()=>{const e=e=>SN.onNext(e);return{networkMonitor:{processResponse:t=>{t.status===ia.qb.NETWORK_AUTHENTICATION_REQUIRED?e(!1):void 0!==t.status&&t.status!==ia.qb.NOT_MODIFIED&&t.status!==ia.qb.GATEWAY_TIMEOUT&&e(fN)},processResponseError:t=>{t&&(t.reason===la.A.RejectHttpError?e(!1):t.serverResponse&&e(fN))}},networkState:{observeIsOnline:()=>SN.observable,isOnline:()=>SN.value}}})(),l=((e,t)=>i=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const n=t(i).then((t=>(e.processResponse(t),t))).catch((t=>{throw e.processResponseError(t),t}));return n})))(s,function(e){return t=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var i;try{return yield e(t)}catch(e){if(e instanceof TypeError&&(null===(i=e.message)||void 0===i?void 0:i.toLowerCase())===oN){const i=t.headers&&t.headers.cache;if(i&&-1!==i.indexOf("only-if-cached"))return{status:ia.qb.GATEWAY_TIMEOUT};e=(0,ca.T)(la.A.RejectHttpError,void 0,e)}throw"AbortError"===e.name&&(e=(0,ca.T)(la.A.RequestCancelled)),e}}))}(((e,t)=>i=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){return nN(i,e,t)})))(i,t.configuration))),c=kN(),{trackHealth:d}=c;return{createApi:i=>xN(i,e,Object.assign(Object.assign({},t),{cancellationMap:n,trackHealth:d,throttleMap:r}),l),createCancelToken:()=>{const e=(0,xe.v4)();return{token:e,cancel:()=>{const t=n.get(e);return t&&t.abort(),!t}}},networkState:a,health:(0,o.__rest)(c,["trackHealth"])}}const xN=(e,t,i,n)=>{const o={},r=e(t),{baseUrlPromise:s,models:a}=r;s&&s();for(const e in a){const t=a[e];o[e]=AN(e,t,r,i,n)}return o},AN=(e,t,i,n,r)=>{const{trackHealth:s,throttleMap:a,globalContext:l}=n,c=NN(l,t,a),{telemetryProvider:d}=n,{serviceName:u}=i;return(...a)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var o;let m,g,h,p;const v=(new Date).toISOString(),y=performance.now();try{const e=yield da(t.catch((e=>{throw(0,ca.T)(la.A.ModelFailedToInitialize,void 0,e)})),l,n.configuration.modelInitializationTimeoutInMs,la.A.ModelTimeOut);let d=hN(r,e,i,n);m=e.constructRequest(...a),m.operationLogger=(e=>{const t=[];let i;const n=(e,i,n)=>{const o=new Date;return(r,s,a)=>{t.push({type:e,duration:r-i,result:s,request:pN(o,n,a)})}},o=(e,t)=>{const o=performance.now();return(r,s)=>{i(o,r,s),i=n(e,o,t)}};return i=n(ia.nz.Initial,performance.now(),e),{nextStep:(e,t,i,n)=>{o(e,i)(t,n)},beginStep:o,logStep:(e,t,i)=>{const o=n(e,performance.now(),t);return e=>o(performance.now(),e,i)},complete:(e,n)=>(i(performance.now(),e,n),t)}})(m),d=s(d,i.serviceName,e.healthPolicy),d=c(d);try{p=null===(o=e.customTelemetry)||void 0===o?void 0:o.call(e,...a)}catch(e){throw(0,ca.T)(la.A.CustomTelemetryFailed,void 0,e)}return g=yield d(m),jN(e)(g)}catch(e){throw e.serverResponse&&(g=e.serverResponse),h=e,e}finally{const t=performance.now()-y,i=null==m?void 0:m.correlationId,n=null==g?void 0:g.status,o=n&&ia.qb[n]||void 0,r=(null==m?void 0:m.operationLogger.complete(h||o,g))||[],s=(null==h?void 0:h.reason)||o||"";d({apiName:e,serviceName:u,createdTime:v,parameters:p,duration:t,result:s,innerError:null==h?void 0:h.innerException,operationLogs:r,correlationId:i})}}))};class DN extends Ce.i{constructor(){super(f.Yg.CreateEndpointsManager,["coreSettings"])}execute(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{loggerFactory:i,windowProvider:n,coreSettings:o}=e,{disableEndpointsHealthService:r,enableCombinedEndpointsHealthService:s}=o.get(b.J.Core);var a;e.endpointsManager=EN(e,{globalContext:n,telemetryProvider:(0,tN.YK)(n,o,i.newLogger("EPM","core-services-tasks"),null===(t=e.authenticationUser)||void 0===t?void 0:t.id),configuration:(a=o.get(b.J.Core),{modelInitializationTimeoutInMs:a.endpointsManagerModelInitializationTimeoutInMs||3e4,baseUrlResolutionTimeoutInMs:a.endpointsManagerBaseUrlResolutionTimeoutInMs||12e4,defaultRequestTimeoutInMs:a.endpointsManagerDefaultRequestTimeoutInMs||3e4})}),r?i.newLogger("EndpointsHealthService","core-services-tasks").log("Disabled by disableEndpointsHealthService feature flag"):(e.endpointsHealthService=s?new Zj(e.endpointsManager,i.newLogger("CombinedEndpointsHealthService","core-services-tasks")):new eN(e.endpointsManager,i.newLogger("EndpointsHealthService","core-services-tasks")),(0,Ei.G)().setEndpointHealth(e.endpointsHealthService.getEndpointHealth))}))}}const FN={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesTasksRemoveUserActiveWindowsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeUserActiveWindows"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}}]};class ON extends Ce.i{constructor(){super(f.Yg.CreateEntityCommanding,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,client:i,commandHandler:n,commandDelegator:r,eventHandler:s,windowProvider:a,hostCommunicationService:l,scenarioFactory:c,loggerFactory:d,deeplinkService:u,coreSettings:m}=Lu("CreateEntityCommandingTask",e,"activeWindowsService","client","commandHandler","commandDelegator","eventHandler","windowProvider","hostCommunicationService","scenarioFactory","loggerFactory","deeplinkService","coreSettings"),g=e.authenticationUser?(0,Ee.b4)(e.authenticationUser):void 0,{entityCommanding:h,eventing:p}=Xn(n,r,s,i,m,a,c,d,u,l,g,void 0,t.getWindowLayoutService());return e.entityCommanding=h,e.eventing=p,e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if("signout"===e)yield i.mutate({mutation:FN,variables:{userContextId:g}})}))}))}}class MN extends Ce.i{constructor(){super(f.Yg.CreateEventHandler,["appsRegistryService","client","clientPreferences","commandChangeReportingService","coreSettings","hostCommunicationService","i18n","loggerFactory","notificationsHandler","scenarioFactory","shortcutExecutionService","userBiService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{appsRegistryService:t,client:i,clientPreferences:n,commandChangeReportingService:o,coreSettings:r,hostCommunicationService:s,i18n:a,loggerFactory:l,notificationsHandler:c,scenarioFactory:d,shortcutExecutionService:u,userBiService:m}=e;e.eventHandler=(e,g,h)=>Dt({appsRegistryService:t,client:i,clientPreferences:n,commandChangeReportingService:o,commandDelegator:h,commandHandler:g,coreSettings:r,eventInput:e,i18n:a,loggerFactory:l,notificationsHandler:c,scenarioFactory:d,shortcutExecutionService:u,userBiService:m,hostCommunicationService:s})}))}}const RN={RejectIncomingCall:gj.Yu.toastCallingRejectIncomingCall,IgnoreIncomingCall:gj.Yu.toastCallingIgnoreIncomingCall,AcceptIncomingCallContentOnly:gj.Yu.toastCallingAcceptIncomingCallContentOnly,AcceptIncomingCallThroughPrejoin:gj.Yu.toastCallingAcceptIncomingCallThroughPrejoin,AcceptIncomingCallWithAudio:gj.Yu.toastCallingAcceptIncomingCallWithAudio,AcceptIncomingCallWithVideo:gj.Yu.toastCallingAcceptIncomingCallWithVideo,AcceptIncomingScreenshareOnlyCall:gj.Yu.toastCallingAcceptIncomingScreenshareOnlyCall,Error:gj.Yu.toastCallingError,NavigateToCallTab:gj.Yu.toastCallingNavigateToCallTab,ReplyIncomingCall:gj.Yu.toastCallingReplyIncomingCall,ResumeCallTransfer:gj.Yu.toastCallingResumeCallTransfer,TimeOut:gj.Yu.toastCallingTimeOut,Unknown:gj.Yu.toastCallingUnknown,onAcceptTelemetryCleanup:gj.Yu.toastAcceptTelemetryCleanup,onDismissTelemetryCleanup:gj.Yu.toastDismissTelemetryCleanup,canNotifyForCallingNotification:gj.Yu.toastCallingNotDroppedByDND,JoinMeetingFromToast:gj.Yu.joinMeeting,JoinAudioDropInFromToast:gj.Yu.toastJoinAudioDropIn,OpenChatList:gj.Yu.openChatConversationFromToast},PN={RejectIncomingCall:gj.rA.toastRejectIncomingCall,AcceptIncomingCallContentOnly:gj.rA.toastAcceptIncomingCall,AcceptIncomingCallThroughPrejoin:gj.rA.toastAcceptIncomingCall,AcceptIncomingCallWithAudio:gj.rA.toastAcceptIncomingCall,AcceptIncomingCallWithVideo:gj.rA.toastAcceptIncomingCall,AcceptIncomingScreenshareOnlyCall:gj.rA.toastAcceptIncomingCall,ReplyIncomingCall:gj.rA.toastReplyIncomingCall,ResumeCallTransfer:gj.rA.toastResumeCallTransfer},LN=(e,t,i,n)=>{if(!e)return void t.error("coreServicesEntityCommanding: UserBiService is not available.");const o={[pe.py.chats]:UN,[pe.py.channels]:WN,[pe.py.calls]:HN,[pe.py.communities]:BN,[pe.py.communitiesevents]:$N,[pe.py.communitiesjoinrequest]:BN,[pe.py.communitiesmembers]:BN}[i.entity.type];o&&o(e,i,!!n)},UN=(e,t,i)=>{const{dataOptions:n,entity:o,entityOptions:r}=t;let s;if((null==n?void 0:n.actionType)===Di.u.quickReply){if(e.createDatabag&&(null==n?void 0:n.toastType)){const{toastType:t}=n;s=e.createDatabag(),s.chatToastType=t,s.isCustomNotification=Boolean(i)}e.recordPanelAction({actionGesture:gj.uS.click,actionScenario:gj.Tk.toastActivation,actionScenarioType:gj.Yu.quickReplyFromToast,moduleName:gj.rA.chatToastQuickreply,dataBag:s})}if(o.action===pe.uk.view&&e.createDatabag&&(null==n?void 0:n.toastType)){const{toastType:t}=n;s=e.createDatabag(),s.chatToastType=t,s.isCustomNotification=Boolean(i)}if(o.action===pe.uk.view&&(!(null==n?void 0:n.actionType)||s)&&(e.recordPanelAction({actionGesture:gj.uS.click,panelRegion:gj.Ai.toast,panelType:gj.wh.chatToast,actionScenario:gj.Tk.toastActivation,actionScenarioType:gj.Yu.openChatConversationFromToast,dataBag:s}),r)){const{campaignType:t}=r;if(t){e.createDatabag&&(s=e.createDatabag(),s.identifier=t);const i={panelType:gj.wh.SyntheticNotification,panelRegion:gj.Ai.toast,dataBag:s};e.recordPanelView(i)}}},WN=(e,t,i)=>{const{entity:n}=t;if(n.action!==pe.uk.view)return;let o;i&&(null==e?void 0:e.createDatabag)&&(o=e.createDatabag(),o.isCustomNotification=Boolean(i)),e.recordPanelAction({actionGesture:gj.uS.click,panelRegion:gj.Ai.toast,panelType:gj.wh.channelsToast,actionScenario:gj.Tk.toastActivation,actionScenarioType:gj.Yu.openChannelsConversationFromToast,dataBag:o})},BN=(e,t,i)=>{const{dataOptions:n,entity:o}=t;let r;if(n&&e.createDatabag){const{toastType:t}=n;r=e.createDatabag(),r.communitiesToastType=t,r.isCustomNotification=Boolean(i)}o.action===pe.uk.view&&e.recordPanelAction({actionGesture:gj.uS.click,panelRegion:gj.Ai.toast,panelType:gj.wh.communitiesToast,actionScenario:gj.Tk.toastActivation,actionScenarioType:gj.Yu.openCommunitiesConversationFromToast,teamId:null==n?void 0:n.teamId,dataBag:r})},$N=(e,t,i)=>{const{dataOptions:n,entity:o}=t;let r;if(n&&e.createDatabag){const{toastType:t}=n;r=e.createDatabag(),r.communitiesToastType=t,r.isCustomNotification=Boolean(i)}o.action===pe.uk.view&&e.recordPanelAction({actionGesture:gj.uS.click,panelRegion:gj.Ai.toast,panelType:gj.wh.communitiesEventsToast,actionScenario:gj.Tk.toastActivation,actionScenarioType:gj.Yu.openCommunitiesEventsFromToast,dataBag:r})},HN=(e,t,i)=>{var n;const{dataOptions:o}=t;if(!o)return;const{actionType:r,toastType:s}=o,a=RN[r],l=PN[r];let c;e.createDatabag&&(c=e.createDatabag(),c.correlationId=null===(n=t.command)||void 0===n?void 0:n.correlation.id,c.callingToastType=s,c.isCustomNotification=Boolean(i)),a&&e.recordPanelAction({actionGesture:gj.uS.click,panelRegion:gj.Ai.toast,panelType:gj.wh.callingToast,actionScenario:gj.Tk.toastActivation,actionScenarioType:a,moduleName:l,dataBag:c}),null==c||c.dispose()};function qN({activeWindowsService:e,coreSettings:t,renderingContext:i,isHostCommandNotification:n,handlerCommand:r,logger:s,notificationUserContextId:a,appsRegistryService:l,logPrefix:c}){var d,u;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=c||"";if(n&&r.command){const{enableDecoupleCommandingFromApollo:n,enableMinimodeWindow:c,enableMTMANotificationsMainWindow:m,enableWindowModeLayout:g}=t.get(b.J.Core),h=n?e.getActiveWindows():yield(0,_s.Ko)(i.client),p=h.find((e=>e.layoutConfig.layoutMode===ve.lO.minimode)),v=h.find((e=>e.layoutConfig.layoutMode===ve.lO.standard));if(s.log(`${o}State transition before override: ${r.command.stateTransition}`),!c||!VN(r.entity)||!p&&v||a&&p&&p.userContextId!==a){const e=zN({appsRegistryService:l,coreSettings:t,entity:r.entity});if(s.log(`${o}allowUserWindowingPreference: ${e}`),v&&v.userContextId!==a)m&&(s.log(`${o}User context of notification does not match main window user`),e||r.command.stateTransition===ve.su.new?r.command.stateTransition=ve.su.new:(s.log(`${o}Entity must be opened in main window`),r.command.stateTransition=ve.su.forceFlush,r.command.targetWindow=ve.PH.main));else if(s.log(`${o}User context of notification matches main window user`),g&&e){const e=null===(d=i.clientPreferences.getPreferences("windowing"))||void 0===d?void 0:d.shouldOpenContentInNewWindow;r.command.stateTransition=e?ve.su.new:ve.su.flush,s.log(`${o}Respecting user preference for toast shouldOpenContentInNewWindow ${e}`)}}else r.command.layoutMode=ve.lO.minimode,r.command.stateTransition=ve.su.flush,s.log(`${o}Redirecting chat toasts to minimode window if no popout chat is open`);s.log(`${o}Final stateTransition after override ${null===(u=r.command)||void 0===u?void 0:u.stateTransition}`)}return r}))}const zN=({appsRegistryService:e,coreSettings:t,entity:i})=>{var n,o,r;return(null===(r=null===(n=e.getApp({entityType:i.type}))||void 0===n?void 0:(o=n.manifest).getAllowUserWindowingPreference)||void 0===r?void 0:r.call(o,{coreSettings:t,entity:i}))||!1},VN=e=>e.type===pe.py.chats&&"welcomePage"!==e.id;function GN(e,t,i,n,r,s,a){const l=e.newLogger("External Command Listener","core-services-entity-commanding"),c=JN(l,r,n,s,a);if(t.opener.addEventListener("executeEntityCommand",c),n.get(b.J.Core).enableHostCommandListener){const e=e=>{const{entity:t}=e,{type:i}=t;switch(i){case S.dt.calls:case S.dt.chats:case S.dt.toasts:case S.dt.extensions:case S.dt.channels:case S.dt.reminders:case S.dt.activity:case S.dt.campaignnotifications:case S.dt.communities:case S.dt.communitiesevents:case S.dt.callingdeeplink:case S.dt.communitiesjoinrequest:case S.dt.communitiesmembers:return c(uu(e,l),!0);case S.dt.signout:return function(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{yield e(Object.assign(Object.assign({},lu),{payload:{entity:{type:pe.py.default,action:pe.uk.default},command:{visibilityState:ve.fe.show,stateTransition:ve.su.flush}}})),t.log(`${zs}Executed default command`),yield e(Object.assign(Object.assign({},lu),{payload:{entity:{type:pe.py.signoutdialog,action:pe.uk.view},command:{visibilityState:ve.fe.show,stateTransition:ve.su.extend}}})),t.log(`${zs}Executed signout modal command`)}catch(e){throw t.errorToTelemetry&&t.errorToTelemetry(`${zs}SignoutCommandFailed - ${(0,M.u4)(e)}`,"webclient_framework_host_comms",void 0,!0),e}}))}(c,l);default:return c(lu)}};i.loadModule("core").then((t=>{var i;t&&(null===(i=t.registerForOnExecuteCommand)||void 0===i||i.call(t,e))})).catch((e=>{var t;null===(t=l.errorToTelemetry)||void 0===t||t.call(l,`Loading core host comms module failed with: ${(0,M.u4)(e)}`,"webclient_framework_host_comms",void 0,!0)}))}return Promise.resolve()}const JN=(e,t,i,n,r)=>({payload:s},a=!1)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const o=t=>{var i;return null===(i=e.errorToTelemetry)||void 0===i?void 0:i.call(e,t,"webclient_framework_foundation_external_command_listener",void 0,!0)};try{if(s&&s.entity&&s.command&&s.entity.type in pe.py&&s.entity.action in pe.uk&&s.command.visibilityState in ve.fe&&s.command.stateTransition in ve.su){const{entity:l,entityOptions:c,dataOptions:d,command:u,windowOptions:m}=s,{linkedEntity:g}=l;if(g){if(!g.id||!(g.type in pe.py)){const e=`Missing id ${!g.id} or linked entity type ${g.type}`;return o(e),Promise.reject(new Error(e))}}else l.linkedEntity=null;u.correlation=u.correlation||{},u.correlation.source=u.correlation.source||k.D.ExternalCommand;const h=null==d?void 0:d.userContextId;e.log(`Got userContextId: ${h} from dataOptions`);const p=t(!1,h),v=1e4;(0,W.E)(p,v).catch((()=>{o(`waitForRenderingContextReady timed out after ${v}ms`)}));const y=yield p;e.log(`got renderingContext for userContextId: ${h}`);const f={dataOptions:d,entity:l,entityOptions:c,command:He(u),windowOptions:m};return e.log(`External command isHostComm ${a}, type ${l.type}, action ${l.action}`),yield qN({activeWindowsService:n,coreSettings:i,renderingContext:y,isHostCommandNotification:a,handlerCommand:f,logger:e,notificationUserContextId:h,appsRegistryService:r}),LN(y.userBiService,e,f),y.commandHandler(f)}const l=function(e){let t=`payload(${!!e})`;if(e){const{entity:i,command:n}=e;if(t+=` entity(${!!i}) command(${!!n})`,i&&n){const{type:e,action:o}=i,{visibilityState:r,stateTransition:s}=n;t+=` type(${e}) action(${o})`,t+=` visibilityState(${r}) stateTransition(${s})`}}return t}(s),c=`Invalid payload for executeEntityCommand handler: ${l}`;return o(c),Promise.reject(new Error(c))}catch(e){o(`Error thrown from external command listener: ${(0,M.u4)(e)}`)}}));class KN extends Ce.i{constructor(){super(f.Yg.CreateExternalCommandListener,["activeWindowsService","appsRegistryService","windowProvider","loggerFactory","hostCommunicationService","coreSettings","waitForRenderingContextReady"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,appsRegistryService:i,windowProvider:n,loggerFactory:o,hostCommunicationService:r,coreSettings:s,waitForRenderingContextReady:a}=e;return GN(o,n,r,s,a,t,i)}))}}class QN{constructor(){this.countBasedLogs=this.initializeLogs(),this.countBasedTotalLogs=[],this.currentBuffer=0}addOperation(e,t,i){if(t&&e)if(this.countBasedLogs[t][e]){const n=this.countBasedLogs[t][e];"Request"===i?n.requestCount++:n.responseCount++}else this.countBasedLogs[t][e]={requestCount:"Request"===i?1:0,responseCount:"Response"===i?1:0,errorCount:"Error"===i?1:0}}getLatestDataAndClear(){const e=(0,L.clone)(this.countBasedLogs);return this.currentBuffer>=40&&(this.currentBuffer=0),this.countBasedTotalLogs[this.currentBuffer++]=e,this.countBasedLogs=this.initializeLogs(),e}getCompleteDataLogs(){return this.countBasedTotalLogs.length<40?this.countBasedTotalLogs:this.countBasedTotalLogs.slice(this.currentBuffer).concat(this.countBasedTotalLogs.slice(0,this.currentBuffer))}initializeLogs(){return{subscription:{},mutation:{},query:{}}}}class YN extends Ce.i{constructor(){super(f.Yg.CreateGraphQlOpsService,["coreSettings"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enableGraphQlOpsCount:t,enableGraphQlOpsCountInConsole:i}=e.coreSettings.get(b.J.Core);let n;if(t&&(n=new QN,e.graphqlOpsCountService=n),i){const e=window;e.hooks||(e.hooks={}),e.hooks.graphQlOpsCountServiceHook=n}}))}}var XN=i(670974);const ZN=0;class eE{constructor(){this.stats={},this.counter=ZN,this.tracked={}}getTelemetry(){const e=this.stats;return this.stats={},e}trackCall(e,t){this.getOrCreateStore(e).methodCalls[t]++}trackSubscribeEvent(e){this.getOrCreateStore(e).subscribeEvents++}markReadStart(e,t){return this.mark(tE("read",e,t))}markReadEnd(e){this.markEnd(e)}markReadError(e){this.markError(e)}markDiffStart(e,t){return this.mark(tE("diff",e,t))}markDiffEnd(e){this.markEnd(e)}markDiffError(e){this.markError(e)}markWriteStart(e,t){return this.mark(tE("write",e,t))}markWriteEnd(e){return this.markEnd(e)}markWriteError(e){this.markError(e)}markDuplicateWrite(e,t,i){const n=tE("writeDuplicate",e,t);this.update("success",n,i)}mark(e){const t=""+this.counter++;return this.tracked[t]=e,t}markEnd(e){const t=this.tracked[e];if(delete this.tracked[e],t){const e=performance.now()-t.start;return this.update("success",t,e),e}return 0}markError(e){const t=this.tracked[e];if(delete this.tracked[e],t){const e=performance.now()-t.start;this.update("error",t,e)}}update(e,t,i){const n=this.getOrCreateStore(t.storeType)[t.kind];n.count++,"error"===e&&n.errors++,n.min=Math.min(null!==n.min?n.min:Number.MAX_VALUE,i),(null==n.max||n.max<i)&&(n.max=i,n.slowestOperation=t.operationName),n.mean=null!==n.mean?(n.mean+i)/2:i}getOrCreateStore(e){let t=this.stats[e];return t||(t={type:e,read:iE(),write:iE(),diff:iE(),writeDuplicate:iE(),subscribeEvents:ZN,methodCalls:{[ih.z.query]:ZN,[ih.z.watchQuery]:ZN,[ih.z.mutate]:ZN,[ih.z.subscribe]:ZN,[ih.z.readQuery]:ZN,[ih.z.writeQuery]:ZN,[ih.z.readFragment]:ZN,[ih.z.writeFragment]:ZN}},this.stats[e]=t),t}}function tE(e,t,i){return{storeType:t,kind:e,operationName:"string"==typeof i?i:(0,XN.Ok)(i)||"unknown",start:performance.now()}}function iE(){return{min:null,max:null,mean:null,count:ZN,errors:ZN,slowestOperation:null}}class nE extends Ce.i{constructor(){super(f.Yg.CreateGraphQLStoreStatsReporterService,["coreSettings","loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=e.loggerFactory.newLogger("CreateGraphQLStoreStatsReporterServiceTask","core-services-tasks"),{enableGraphQLStoreStatsReporterService:i}=e.coreSettings.get(b.J.Core);i&&(e.graphqlStoreStatsReporterService=new eE,t.log("GraphQLStoreStatsReporterService initialized"))}))}}var oE=i(251498);class rE extends Ce.i{constructor(){super(f.Yg.CreateGtmRegistry,["authenticationService","discover","coreSettings","loggerFactory","platformService","config"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.gtmRegistry=new oE.a(e.authenticationService,e.discover,e.coreSettings,e.loggerFactory,e.platformService,e.config)}))}}class sE{constructor(e,t,i,n,o){this.commandChangeReportingService=e,this.coreSettings=t,this.hostCommunicationService=i,this.scenarioFactory=n,this.logger=o.newLogger("HostCommandingListener","core-services-entity-commanding")}init(){this.initCommandChangeReportingSubscription()}destroy(){var e;null===(e=this.commandChangeReportingSubscription)||void 0===e||e.unsubscribe(),this.commandChangeReportingSubscription=void 0}initCommandChangeReportingSubscription(){this.commandChangeReportingSubscription&&this.destroy(),this.commandChangeReportingSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>{e.type===Ae.B.NotHandled&&e.context.entityCommand&&this.sendHostEvent(e.context.entityCommand)}))}sendHostEvent(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){!!this.coreSettings.get(b.J.Core).enableCommandToHostCommService&&(yield Nu(e,this.hostCommunicationService,this.logger,this.scenarioFactory))}))}}class aE{constructor(){this.id=f.Yg.CreateHostCommandingListener}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{commandChangeReportingService:t,coreSettings:i,loggerFactory:n,scenarioFactory:o,hostCommunicationService:r}=Lu("CreateHostCommandingListenerTask",e,"commandChangeReportingService","coreSettings","loggerFactory","scenarioFactory","hostCommunicationService");new sE(t,i,r,o,n).init()}))}}var lE=i(301343);class cE extends Ce.i{constructor(){super(f.Yg.CreateHostCommunication,["coreSettings","loggerFactory","platformService","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,loggerFactory:i,platformService:n,windowProvider:o}=e;e.hostCommunicationService=(0,lE.I)(n,t,o,i)}))}}var dE=i(831649);class uE extends Ce.i{constructor(){super(f.Yg.CreateI18n,["i18NextWrapper"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=new dE.o(e.i18NextWrapper);e.i18n=t;const i=e.localMigratedSettings;if(i){const n=mE(e.i18NextWrapper.logger,e.i18NextWrapper.migratedLocaleCode,t.locale);i.registerConsumer("i18n",n)}}))}}const mE=(e,t,i)=>({language:n})=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(n!==t)throw e.error(`Migrated locale (${n}) was not available for the i18NextWrapper (${t})`),new Error("Language mismatch during locale migration");n!==i&&e.log(`Migrated locale (${n}) was not applied to the i18n instance. Detected language: (${i})`)}));var gE=i(867500),hE=i(865429);class pE{constructor(e,t){this.options={},this.setOptions(t),this.logger=e("i18n:selective-icu","services-io-browser-i18n"),this.name="selective-icu",this.type="postProcessor",this.icu=new hE.Z}setOptions(e){this.options=Object.assign(Object.assign({},this.options),e)}process(e,t,i,n){const o=Array.isArray(t)?t[t.length-1]:t;if(!this.options.filterRegex||!this.options.filterRegex.test(o))return e;try{return this.icu.parse(e,i,n.language,i.ns,o,!1)}catch(o){return this.logger.error(`ICU parse failed for namespace: "${i.ns||""}" key: "${t.toString()}" locale: "${n.language||""}"`),e}}}class vE{constructor(){this.name="simple-pseudo",this.type="postProcessor"}process(e){return`([{${e}}])`}}var yE=i(503847);class fE{constructor(e,t,i){this.i18nextWrapper=e,this.coreSettings=i,this.entries={},this.logger=t("NamespaceLoader","services-io-browser-i18n");const n=null==i?void 0:i.getObservable(b.J.Localization);null==n||n.subscribe((e=>{e.enableExpStrings&&this.getOverriddenNamespaces().forEach((e=>this.patchBundleOverrides(e)))}))}getState(e){const t=this.entries[e];return t?t.state:yE.i.Missing}waitForNamespace(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=this.getState(e);if(t===yE.i.Loaded)return;if(t===yE.i.Failed)throw new Error(`Loading of namespace ${e} has previously failed`);const i=t===yE.i.Missing?this.load(e):this.entries[e];return i&&i.promise?i.promise:void 0}))}loadStatic(e){this.addResourceBundle(e.namespace,e.translations),this.entries[e.namespace]={state:yE.i.Loaded,error:void 0,promise:void 0}}load(e,t){const i="en-us",n=t?i:this.i18nextWrapper.locale,o=`${n}/${(0,L.kebabCase)(e)}`,r=`./generated/resources/${o}`,s={state:yE.i.Loading,error:void 0,promise:void 0};this.entries[e]=s,this.i18nextWrapper.logger.log("importing",r);const a=this.getNamespaceEntry(n,e).then((t=>{this.addResourceBundle(e,t.default.translations),this.i18nextWrapper.logger.log("imported",r),s.state=yE.i.Loaded,s.promise=void 0})).catch((a=>t||n===i?(this.failI18nLoad({error:a.message,origin:o}),this.i18nextWrapper.logger.error("failed to import",r,a),s.state=yE.i.Failed,s.error=a.message,s.promise=void 0,Promise.reject(a)):(this.i18nextWrapper.logger.log("trying fallback to the default locale as failed to import",r,a),this.failI18nLoad({fallbackLocale:i,error:a.message,origin:o}),this.load(e,!0).promise)));return s.promise=a,s}addResourceBundle(e,t){return this.i18nextWrapper.i18next.addResourceBundle(this.i18nextWrapper.locale,e,Object.assign(Object.assign({},t),this.getOverrides(e)))}patchBundleOverrides(e){if(this.entries[e]){const t=this.getOverrides(e);(this.entries[e].promise||Promise.resolve()).then((()=>{this.i18nextWrapper.i18next.addResourceBundle(this.i18nextWrapper.locale,e,t,!0,!0)}))}}getOverriddenNamespaces(){var e;const t=null===(e=this.coreSettings)||void 0===e?void 0:e.get(b.J.Localization);let i=[];return Object.keys(t).forEach((e=>{var n,o;(null===(n=t[e])||void 0===n?void 0:n.expStrOverrides)&&(i=[...i,...Object.keys((null===(o=t[e])||void 0===o?void 0:o.expStrOverrides)||{})])})),[...new Set(i)]}getOverrides(e){var t,i,n;const{enableExpStrings:o}=null!==(i=null===(t=this.coreSettings)||void 0===t?void 0:t.get(b.J.Localization))&&void 0!==i?i:{};if(!o)return{};const r=this.i18nextWrapper.locale.toLowerCase(),s=null===(n=this.coreSettings)||void 0===n?void 0:n.get(b.J.Localization),a=Object.keys(s).map((t=>{var i,n;return null===(n=null===(i=s[t])||void 0===i?void 0:i.expStrOverrides)||void 0===n?void 0:n[e]})).filter((e=>!!e)).map((e=>e.reduce(((e,t)=>{const i=Object.keys(t.locales).find((e=>e.toLowerCase()===r)),n=t.key,o=i&&t.locales[i];return n&&o&&(e[n]=o),e}),{}))).reduce(((e,t)=>Object.assign(Object.assign({},e),t)),{});return a}getNamespaceEntry(e,t){return(0,gl.mT)((()=>i(122057)(`./${e}/${(0,L.kebabCase)(t)}.js`)),`${(0,L.kebabCase)(t)}-locale-${e}`)}failI18nLoad(e){var t,i;null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,"Failed to import locale","namespace_loader",e)}}var SE=i(985937),kE=i(752426),bE=i(899517);const wE="localeCode";function CE(e){return e.navigator.language||f.ZW}function _E(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield e.loadModule("osutils"),n=yield null===(t=null==i?void 0:i.getAppLocale)||void 0===t?void 0:t.call(i);return null==n?void 0:n.localeName}))}function TE(e,t,i,n){const o=IE(e,t,i,n);return(0,bE.vw)(o).locale}function IE(e,t,i,n,o,r,s){var a;const l=function({localeCode:e,language:t,setting:i}){if(e)return e;if(t)return t.toLowerCase();if(!i)return;let n;if(Array.isArray(i)){for(const e of i)if(e.startsWith("localeCode:")){n=e;break}}else i.startsWith("localeCode:")&&(n=i);if(n)return n.split(":")[1];return}(t.state.getSearchState()||{});if(l)return l;if(o&&(null===(a=null==e?void 0:e.navigator)||void 0===a?void 0:a.language))return e.navigator.language;const c=e.getHostedWindowContext(),{enableLocaleSyncWithMSAccount:d}=(null==i?void 0:i.get(b.J.Localization))||{},u=function(e,t,i){const n=e.localStorage.getItem(wE);if(!t||!i)return n;const o=jE(e,i);return("1"===o.isLocaleInSyncWithAccount?o.accountLocaleCode:o.applicationLocaleCode)||n}(e,!!d,s);return c&&c.localeCode?(e.localStorage.setItem(wE,c.localeCode),c.localeCode):(!u&&r&&e.localStorage.setItem(wE,r),u&&e.localStorage.setItem(wE,u),u||r||n||f.ZW)}function jE(e,t){const i=NE(t);return{accountLocaleCode:e.localStorage.getItem(i.accountLocaleCodeKey),applicationLocaleCode:e.localStorage.getItem(i.applicationLocaleCodeKey),isLocaleInSyncWithAccount:e.localStorage.getItem(i.isLocaleInSyncWithAccountKey)}}function NE(e){return{accountLocaleCodeKey:`accountLocaleCode_${e}`,applicationLocaleCodeKey:`applicationLocaleCode_${e}`,isLocaleInSyncWithAccountKey:`isLocaleInSyncWithAccount_${e}`}}const EE=()=>{};class xE{get locale(){return this._locale}get osLocaleInfo(){return this._osLocaleInfo}constructor(e,t,i,n,o,r,s,a,l,c,d,u,m){var g,h;this.preloadNamespaces=e,this.originLocale=o,this.staticNamespaces=r,this.userLanguage=a,this.osLocale=l,this.migratedLocaleCode=c,this.coreSettings=m,this.notLoadedNamespacesWithErrors=[];const p=t("i18n","services-io-browser-i18n"),v="pseudo"===o||"pseudo_rtl"===o;let y=(0,kE.Ax)(o,n,s);const f=null!==(h=b.J.Core&&(null===(g=this.coreSettings)||void 0===g?void 0:g.get(b.J.Core)))&&void 0!==h?h:{};f&&f.useEnglishOnlyUI&&(y="en-us");const S=this.initPlugins(t,v,y,p);this.namespaceLoader=((e,t,i)=>new fE(e,t,i))(this,t,m),this.i18next=S,this.latestTranslation={},this.originLocale=o,this.logger=p,this.scenarioFactory=n,this.osPlatform=i.config.osPlatform,this.initOsDateTimeLocalization(n,p,m,u,d),this.initI18next(y,n,p),this._locale=y,this.loadLocales()}setOSLocaleInfo(e){this._osLocaleInfo=e}setLocale(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=null!==(i=b.J.Core&&(null===(t=this.coreSettings)||void 0===t?void 0:t.get(b.J.Core)))&&void 0!==i?i:{};n&&n.useEnglishOnlyUI&&(e="en-us");const o=(0,kE.um)(this.scenarioFactory,e);this.i18next.changeLanguage(o),this._locale=o,yield this.loadLocales()}))}setPreloadedNamespaces(e){this.preloadNamespaces&&this.preloadNamespaces.length>0||(this.preloadNamespaces=e,this.logger.log("Setting preloaded namespaces ",this.preloadNamespaces),this.loadLocales())}initPlugins(e,t,i,n){const o=[new pE(e,{filterRegex:/.*\_mf$/})];if(t){const e=new vE;o.push(e),i="en-us"}kE.cL.locale=i;let r=gE.default.createInstance();for(const e of o)r=r.use(e);const s=this.getInitOptions(i,o);return r.init(s).catch((e=>n.error("The i18next initialization failed",e))),r}removeDefaultI18nNamespaces(e){var t;("string"==typeof this.i18next.options.ns?[this.i18next.options.ns]:null!==(t=this.i18next.options.ns)&&void 0!==t?t:[]).forEach((t=>this.i18next.removeResourceBundle(e,t))),this.i18next.setDefaultNamespace("")}setMissingHandlers(e,t){this.i18next.options.saveMissing=!0,this.i18next.options.missingKeyHandler=(i,n,o)=>{this.missingKeyHandler(e,t,this.i18next,i,n,o)},this.i18next.options.missingInterpolationHandler=i=>this.missingInterpolationHandler(e,t,this.latestTranslation)}initI18next(e,t,i){this.removeDefaultI18nNamespaces(e),this.setMissingHandlers(t,i)}normalizeOSRegionalFormat(e){return e.split("_").join("-").toLowerCase()}initOsDateTimeLocalization(e,t,i,n,r){var s;if(r)return void this.setOSLocaleInfo(r);const a=null!==(s=b.J.Host&&(null==i?void 0:i.get(b.J.Host)))&&void 0!==s?s:{};a&&a.enableOsDateTimeFormatting&&function(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield null==e?void 0:e.loadModule("osutils");return yield null===(t=null==i?void 0:i.getLocaleInfo)||void 0===t?void 0:t.call(i)}))}(n).then((e=>{var i;if(!e||!(null==e?void 0:e.regionalFormat))return void this.setOSLocaleInfo(e);const n=this.normalizeOSRegionalFormat(e.regionalFormat);if((e=>{try{return Intl.DateTimeFormat.supportedLocalesOf([e],{localeMatcher:"lookup"}).length>0}catch(e){return!1}})(n))e.regionalFormat=n,this.setOSLocaleInfo(e);else{const n=`getLocaleInfoFromHostCommunication returned unsupported regional format: ${e.regionalFormat}`;null===(i=t.errorToTelemetry)||void 0===i||i.call(t,n,"telemetry_i18next_wrapper")}})).catch((i=>{var n;const o=`getLocaleInfoFromHostCommunication failed: ${i}`;null===(n=t.errorToTelemetry)||void 0===n||n.call(t,o,"telemetry_i18next_wrapper");e.newScenario(U.RG.I18nGetLocaleInfo).fail({errors:JSON.stringify(["getLocaleInfoAsync failed"])})}))}loadLocales(){const e=[];this.staticNamespaces&&this.namespaceLoader.loadStatic(this.staticNamespaces);for(const t of this.preloadNamespaces){const i=this.namespaceLoader.load(t);i.promise&&e.push(i.promise.catch(EE))}return Promise.all(e)}missingKeyHandler(e,t,i,n,o,r){const s="string"==typeof i.options.ns?[i.options.ns]:i.options.ns||[""],a=s.indexOf(o)<0;let l="",c="";if(a&&(e=>this.notLoadedNamespacesWithErrors.indexOf(e)>=0)(o))return;a?(l=`The namespace "${o}" has not been loaded. The only loaded namespaces: "${s.join(", ")}"`,c=r,this.notLoadedNamespacesWithErrors.push(o)):l=`The key "${r}" doesn't exist in namespace "${o}" for locale "${n[0]}"`;e.newScenario(U.RG.I18nMissingKeyHandler).stop({message:l,origin:c}),t.error(l)}missingInterpolationHandler(e,t,i){var n;const o=`Undefined interpolation for namespace "${i.namespace}" and key "${i.key}"`;e.newScenario(U.RG.I18nMissingInterpolationHandler).stop({message:o}),null===(n=t.errorToTelemetry)||void 0===n||n.call(t,o,"telemetry_i18next_wrapper")}getInitOptions(e,t){return{initImmediate:!1,interpolation:{escapeValue:!1},react:{bindI18n:"languageChanged",bindI18nStore:"",nsMode:"default",transKeepBasicHtmlNodesFor:["br","strong","i","b","u","p"]},lng:e,fallbackLng:e,load:"currentOnly",lowerCaseLng:!0,postProcess:t.filter((e=>"postProcessor"===e.type)).map((e=>e.name))}}}class AE extends Ce.i{constructor(){super(f.Yg.CreateI18NextWrapper,["config","coreSettings","coreSettingsContext","hostCommunicationService","loggerFactory","platformService","routingServices","scenarioFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=function(e,t,i,n,o,r,s,a){const{windowProvider:l,routingServices:c,hostCommunicationService:d}=r,u=(0,SE.pf)(l),{language:m}=n.get(b.J.LocalMigrated)||{},g=m||void 0,h=b.J.Core&&n.get(b.J.Core),p=h&&h.includeBrowserInLocaleDetermination,v=IE(l,c,n,u.localeCode,!!p,g),y=CE(l),f=d?_E(d):Promise.resolve(void 0);return new xE(e,t,i,o,v,s,a,y,f,g,void 0,d,n)}(e.config.preloadedI18nNamespaces||[],e.loggerFactory.newLogger,e.platformService,e.coreSettings,e.scenarioFactory,{windowProvider:e.windowProvider,routingServices:e.routingServices,hostCommunicationService:e.hostCommunicationService},e.config.staticNamespaces,e.config.locale);e.coreSettingsContext.setLocale(t.locale),e.coreSettingsContext.updatePlatformProviderSettings({localeCode:t.locale}),e.i18NextWrapper=t}))}}class DE{constructor(e){this.cache=new Map,this.lastId=0,this.maxCacheSize=e.maxCacheSize,this.cachePruningPercent=e.cachePruningPercent}add(e,t){if(this.maxCacheSize<=0)return;let i=this.cache.get(e);if(i)return void(i.time=this.lastId++);const n=new Image;n.src=t,i={image:n,time:this.lastId++},this.cache.set(e,i),this.cache.size>this.maxCacheSize&&this.prune()}setCapacity(e){this.maxCacheSize=e.maxCacheSize,this.cachePruningPercent=e.cachePruningPercent,this.cache.size>this.maxCacheSize&&this.prune()}clear(){this.cache.clear(),this.lastId=0}has(e){return this.cache.has(e)}getUrl(e){if(this.has(e)){const t=this.cache.get(e);return null==t?void 0:t.image.src}}get size(){return this.cache.size}prune(){const e=[];this.cache.forEach(((t,i)=>{e.push({time:t.time,url:i})})),e.sort(((e,t)=>e.time-t.time));let t=Math.ceil(this.maxCacheSize*this.cachePruningPercent);t=Math.max(this.cache.size-this.maxCacheSize,t);for(let i=0;i<t;i++){const t=e[i];this.cache.delete(t.url)}}}class FE extends Ce.i{constructor(){super(f.Yg.CreateImageCaches,["coreSettings"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t}=e,i=new DE({maxCacheSize:0,cachePruningPercent:.15});e.avatarImageCache=i;const n=null==t?void 0:t.getObservable(b.J.ImageCache),o=null==n?void 0:n.subscribe((e=>{let t=0;"number"==typeof(null==e?void 0:e.avatarImageCacheMaxCapacity)&&(t=e.avatarImageCacheMaxCapacity),i.setCapacity({maxCacheSize:t,cachePruningPercent:.15})}));return()=>o.unsubscribe()}))}}class OE extends Ce.i{constructor(){super(f.Yg.CreateInactiveGC,["clientState","coreSettings","profilerService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{clientState:t,coreSettings:i,profilerService:n}=e;t.observe().subscribe((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e===_e.pk.Inactive||e===_e.pk.LongInactive){const{clearConsoleInInactive:e,enableGCInInactive:t}=i.get(b.J.Core);e&&(console.clear(),console.log('Console cleared on going to Inactive/LongInactive. When debugging, you can override this with disabling "clearConsoleInInactive" FF')),t&&n.requestTriggerGC()}}))))}))}}class ME extends Ce.i{constructor(){super(f.Yg.LeakDetector,["loggerFactory","coreSettings","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{loggerFactory:t,windowProvider:i,coreSettings:n}=e,o=t.newLogger("CreateLeakDetectorTask","core-services-tasks"),{enableObjectLeakDetection:r}=n.get(b.J.Core);if(o.log(`enableObjectLeakDetection ${r}`),!r)return;if(!i.WeakRef)return void o.log("windowProvider?.WeakRef is undefined");const s=new nr.E(n,i);e.leakDetectorService=s,o.log("leakDetectorService instantiated"),i.opener.addEventListener(O.rY.GetLeaks,(()=>this.sendLeaksStats(i,s,o)));const{testAutomation:a}=n.get(b.J.Test);this.initTestingMode(i,s,n.get(b.J.Host),!!a)}))}sendLeaksStats(e,t,i){let n=0;const o=e.parent;o.getAndClearAriTelemetry=void 0,o.getLeakDetectorService=void 0,o.gc?(i.log("executing gc() on experience renderer"),o.gc(),n=1e4):i.warn("gc() not defined on experience renderer");let r=0;r=e.setTimeout((()=>{e.clearTimeout(r);const i={leaks:t.getReachableObjectCountsByKey(),leaksTrackingInfo:t.getReachableObjectsTrackingInfo()};e.opener.postMessage(O.rY.GetLeaks,i)}),n)}initTestingMode(e,t,i,n){const{userType:o}=i;(o&&o.indexOf("test")>-1&&!("getLeakDetectorService"in e.parent)||n)&&(e.parent.getLeakDetectorService=()=>t)}}var RE,PE,LE,UE,WE,BE,$E,HE,qE,zE;function VE(e){if(e.has(ft.c4.ExperienceWarm))return;const t=JE(e,ft.yU.NavigationIntentExecuted);let i=!1;t&&(i=!t.shouldRenderContent||function(e){var t;const i=JE(e,ft.FV.LayoutRenderComplete),n=["pearnotdefaultapp","error"];return null!==(t=(null==i?void 0:i.mainEntityType)&&!n.includes(i.mainEntityType))&&void 0!==t&&t}(e));const n=Array.from(e.values()).pop();return i&&(null==n?void 0:n.context)}function GE(e,t){if(e.has(ft.c4.UserWarm))return;let i=!1;if(KE(e))if(t)if(function(e){const t=JE(e,ft.FV.LayoutRenderCancelled);return!!t}(e)||QE(e))i=!0;else{const t=JE(e,ft.yU.NavigationIntentExecuted);t&&!t.shouldRenderContent&&(i=!0)}else i=!0;const n=Array.from(e.values()).pop();return i&&(null==n?void 0:n.context)}function JE(e,t){const i=e.get(t);return i&&i.context}function KE(e){return e.has(ft.yU.UserAuthenticated)&&e.has(ft.yU.UserConsentedToConsumeResources)}function QE(e){const t=JE(e,ft.FV.LayoutRenderComplete);if(t){const{mainEntityType:e}=t;if(!e||-1===["identity","tflfre","pearnotdefaultapp","error"].indexOf(e))return!0}return!1}function YE(e,t){let i=[];const n=e[t.state];return n&&(i=i.concat(n({context:t.context}))),i}function XE(e,t,i){let n;if(e){const{app:o,state:r,callback:s}=e;let a=s();if(a){const e=a.length;if(e>0){t.log(`App:${o.manifest.id} supports the state: ${r}, job count returned from the app: ${e}.`),a=a.filter((e=>function(e,t,i){if(i===UE.start)return!1;const n=t&&t[i];if(Array.isArray(n))return n.indexOf(e)>-1;if([UE.onPreWarm,UE.onExperienceWarm,UE.onUserWindowPreWarm].includes(i))return!1;return!0}(e.id,i,r)));const n=a.length;n!==e&&t.log(`Jobs filtering by permissions took place. Job count is now: ${n}`)}n={state:r,jobs:a}}}return n}function ZE({app:e,currentChanges:t,change:i,getCachedSupportSet:n,sessionContext:r}){const s=function(e,t){if(t.has(ft.c4.Initialized)||e.type===ft.yU.ExperienceIdleStateChanged)return;const i=JE(t,ft.yU.ActiveEntitiesResolved);return KE(t)&&i?i:void 0}(i,t);if(s)return{app:e,state:UE.onPreInit,callback:()=>function(e,t,i){let n;const r=i(),{entities:s,target:a}=t,l=(0,o.__rest)(t,["entities","target"]);for(const t of s)if(t&&r&&r.has(t.type)){n=n||[];const i=YE(e,{context:Object.assign(Object.assign({},l),{entity:t}),state:UE.onPreInit});n=n.concat(i)}return n}(e,Object.assign(Object.assign({},r),s),n)}}function ex({app:e,currentChanges:t,sessionContext:i}){const n=VE(t);if(n){const t=UE.onExperienceWarm;return{app:e,state:t,callback:()=>YE(e,{context:Object.assign(Object.assign({},i),n),state:t})}}}function tx({app:e,currentChanges:t,sessionContext:i,change:n}){if(n.context.isIdle&&KE(t)){const t=UE.onExperienceLongIdle;return{app:e,state:t,callback:()=>YE(e,{context:Object.assign({},i),state:t})}}}function ix({app:e,currentChanges:t,sessionContext:i}){const n=function(e){if(e.has(ft.c4.WindowWarm))return;let t=!1;QE(e)&&(t=!0);const i=Array.from(e.values()).pop();return t&&(null==i?void 0:i.context)}(t);if(n){const t=UE.onUserWindowPreWarm;return{app:e,state:t,callback:()=>YE(e,{context:Object.assign(Object.assign({},i),n),state:t})}}}function nx({appId:e,jobState:t,change:i,currentChanges:n,logger:o}){let r;if(t){const{jobs:s,state:a}=t,l=function(e,t){let i;switch(e){case UE.start:i=ft.c4.Started;break;case UE.onPreInit:i=ft.c4.Initialized;break;case UE.onExperienceWarm:i=ft.c4.ExperienceWarm;break;case UE.onPreWarm:i=ft.c4.UserWarm;break;case UE.onExperienceLongIdle:i=ft.c4.ExperienceLongIdle;break;case UE.onUserWindowPreWarm:i=ft.c4.WindowWarm;break;case UE.onIdle:i=ft.c4.Idle}return function(e,{correlationId:t,windowId:i,context:{target:n}}){return{type:e,context:{target:n},correlationId:t,windowId:i}}(i,t)}(a,i);n.set(l.type,l),o.debug(`Life Cycle - Change type: ${i.type}, initiated by: ${i.context.target}. Resulted in app:${e} transition to state: ${a} and job count: ${s.length}`),r={change:l,jobs:s}}return r}function ox({application:e,appLifeCyclePermissions:t,change:i,currentChanges:n,getNextState:o,getCachedSupportSet:r,logger:s,sessionContext:a}){const l=XE(o({currentChanges:n,app:e,change:i,getCachedSupportSet:r,sessionContext:a}),s,t);return nx({appId:e.manifest.id,jobState:l,change:i,currentChanges:n,logger:s})}!function(e){e.incomplete="incomplete",e.success="success",e.failure="failure"}(RE||(RE={})),function(e){e.LifeCycleReport="life_cycle_report"}(PE||(PE={})),function(e){e.ExperienceLifeCycleManager="experience_life_cycle_manager",e.UserLifeCycleManager="user_life_cycle_manager"}(LE||(LE={})),function(e){e.start="start",e.onPreInit="onPreInit",e.onExperienceWarm="onExperienceWarm",e.onPreWarm="onPreWarm",e.onExperienceLongIdle="onExperienceLongIdle",e.onUserWindowPreWarm="onUserWindowPreWarm",e.onIdle="onIdle"}(UE||(UE={})),function(e){e.Experience="Experience"}(WE||(WE={})),function(e){e.Window="Window"}(BE||(BE={})),function(e){e.FirstUserAtBoot="FirstUserAtBoot",e.Other="Other"}($E||($E={}));class rx{constructor(e,t,i){this._scope=e,this._appLifeCyclePermissions=t,this._sessionContext=i,this._currentChanges=new Map,this._logger=i.loggerFactory.newLogger("ApplicationLifeCycleManager","core-services-life-cycle")}get managedId(){var e;return null===(e=this._application)||void 0===e?void 0:e.manifest.id}manageApplication(e){this._application=e}onChange(e){const t=[];if(!this._application)return t;this._currentChanges.set(e.type,e);const i=function(e){switch(e){case WE.Experience:return[ex];case BE.Window:return[ix];default:return[ZE,(t=e===$E.FirstUserAtBoot,({app:e,currentChanges:i,sessionContext:n})=>{const o=GE(i,t);if(o){const t=UE.onPreWarm;return{app:e,state:t,callback:()=>YE(e,{context:Object.assign(Object.assign({},n),o),state:t})}}}),tx]}var t}(this._scope);for(const n of i){const i=ox({application:this._application,appLifeCyclePermissions:this._appLifeCyclePermissions,change:e,currentChanges:this._currentChanges,getNextState:n,getCachedSupportSet:()=>this.supportedSets,logger:this._logger,sessionContext:this._sessionContext});i&&t.push(i)}return t}get supportedSets(){return this._supportedEntitySet=this._supportedEntitySet||this._application&&function(e){const t=e.manifest.supportedEntities,i=new Set;return t&&t.reduce(((e,t)=>e.add(t)),i),i}(this._application),this._supportedEntitySet}}function sx(e,t){const i=e.get(t);return i&&i.context}function ax({changeset:e}){return e.has(ft.yU.UserAuthenticated)&&e.has(ft.yU.UserConsentedToConsumeResources)}function lx({changeset:e}){const t=sx(e,ft.FV.LayoutRenderComplete);if(t){const{mainEntityType:e}=t;if(!e||-1===["identity","tflfre","pearnotdefaultapp","error"].indexOf(e))return!0}return!1}!function(e){e.Experience="Experience"}(HE||(HE={})),function(e){e.Window="Window"}(qE||(qE={})),function(e){e.FirstUserAtBoot="FirstUserAtBoot",e.Other="Other"}(zE||(zE={}));const cx=[{name:UE.onExperienceWarm,fn:({application:e,ctx:t})=>{const i=function({changeset:e}){if(e.has(ft.c4.ExperienceWarm))return;const t=sx(e,ft.yU.NavigationIntentExecuted);let i=!1;t&&(i=!t.shouldRenderContent||function({changeset:e}){var t;const i=sx(e,ft.FV.LayoutRenderComplete);return null!==(t=(null==i?void 0:i.mainEntityType)&&!["pearnotdefaultapp","error"].includes(i.mainEntityType))&&void 0!==t&&t}({changeset:e}));const n=Array.from(e.values()).pop();return i&&(null==n?void 0:n.context)}({changeset:t.changeset});if(i){const n=UE.onExperienceWarm;return{app:e,change:t.change,scope:t.scope,state:n,jobs:YE(e,{state:n,context:Object.assign(Object.assign({},t.context),i)})}}},scope:"experience"},{name:UE.onPreInit,fn:({application:e,ctx:t,supportedEntitySet:i})=>{const n=function({change:e,changeset:t}){if(t.has(ft.c4.Initialized)||e.type===ft.yU.ExperienceIdleStateChanged)return;const i=sx(t,ft.yU.ActiveEntitiesResolved);if(ax({changeset:t})&&i)return i;return}({change:t.change,changeset:t.changeset});if(n){let r;const{entities:s,target:a}=n,l=(0,o.__rest)(n,["entities","target"]);for(const n of s)if(n&&i&&i.has(n.type)){r=r||[];const i=YE(e,{context:Object.assign(Object.assign(Object.assign({},t.context),l),{entity:n}),state:UE.onPreInit});r=r.concat(i)}if(Array.isArray(r))return{app:e,change:t.change,scope:t.scope,state:UE.onPreInit,jobs:r}}},scope:"user"},{name:UE.onPreWarm,fn:({application:e,ctx:t})=>{const i=function({changeset:e,isFirstInitializedUser:t}){if(e.has(ft.c4.UserWarm))return;let i=!1;if(ax({changeset:e}))if(t)if(function({changeset:e}){return!!sx(e,ft.FV.LayoutRenderCancelled)}({changeset:e})||lx({changeset:e}))i=!0;else{const t=sx(e,ft.yU.NavigationIntentExecuted);t&&!t.shouldRenderContent&&(i=!0)}else i=!0;const n=Array.from(e.values()).pop();return i&&(null==n?void 0:n.context)}({changeset:t.changeset,isFirstInitializedUser:t.scope===zE.FirstUserAtBoot});if(i){const n=UE.onPreWarm;return{app:e,change:t.change,scope:t.scope,state:n,jobs:YE(e,{state:n,context:Object.assign(Object.assign({},t.context),i)})}}},scope:"user"},{name:UE.onUserWindowPreWarm,fn:({application:e,ctx:t})=>{const i=function({changeset:e}){if(e.has(ft.c4.WindowWarm))return;let t=!1;lx({changeset:e})&&(t=!0);const i=Array.from(e.values()).pop();return t&&(null==i?void 0:i.context)}({changeset:t.changeset});if(i){const n=UE.onUserWindowPreWarm;return{app:e,change:t.change,scope:t.scope,state:n,jobs:YE(e,{state:n,context:Object.assign(Object.assign({},t.context),i)})}}},scope:"window"},{name:UE.onExperienceLongIdle,fn:({application:e,ctx:t})=>{if(t.change.context.isIdle&&ax({changeset:t.changeset})){const i=UE.onExperienceLongIdle;return{app:e,change:t.change,scope:t.scope,state:i,jobs:YE(e,{state:i,context:Object.assign({},t.context)})}}},scope:"user"},{name:UE.onIdle,fn:({application:e,ctx:t})=>{const i=function({changeset:e}){if(e.has(ft.c4.Idle))return;let t=!1;(function({changeset:e}){return e.has(ft.FV.IdleCallback)})({changeset:e})&&function({changeset:e}){return e.has(ft.yU.PreWarmJobsCompleted)&&e.has(ft.yU.WindowWarmJobsCompleted)&&e.has(ft.yU.ExperienceWarmJobsCompleted)}({changeset:e})&&(t=!0);const i=Array.from(e.values()).pop();return t&&(null==i?void 0:i.context)}({changeset:t.changeset});if(i){const n=UE.onIdle;return{app:e,change:t.change,scope:t.scope,state:n,jobs:YE(e,{state:n,context:Object.assign(Object.assign({},t.context),i)})}}},scope:"user"}];function dx(e){return cx.map((({name:t,fn:i,scope:n})=>{const o=function({name:e,fn:t,scope:i}){return n=>{if(!ux[i].includes(n.ctx.scope))return;const o=t(n);return o&&o.jobs.length&&n.logger.log(`${e} resulted in a transition with ${o.jobs.length} jobs${o.jobs.length?`, ${o.jobs.map((e=>e.id)).join(", ")}`:""}`),o}}({name:t,fn:i,scope:n});return o(e)})).filter(Boolean)}const ux={experience:[HE.Experience],user:[zE.FirstUserAtBoot,zE.Other],window:[qE.Window]};class mx{constructor(e,t){this.application=e,this.permissions=t,this.changesets={experience:new Map,users:{},windows:{}},this.supportedEntitySet=this.getSupportedEntitySet()}performTransition(e){const t=gx[e.state],i=this.getChangeset(e);if(!i)return;const n={type:t,context:{target:e.change.context.target},correlationId:e.change.correlationId,windowId:e.change.windowId};return i.set(n.type,n),{change:n,jobs:e.jobs}}getTransitions(e){return dx(Object.assign(Object.assign({},e),{application:this.application,supportedEntitySet:this.supportedEntitySet})).map((t=>{const{jobs:i}=t;return i&&(t.jobs=i.filter((i=>{const n=this.computeJobEligibility(i,t,this.permissions);return n||e.logger.log(`${t.state} denied job ${i.id} due to missing permissions`),n}))),t}))}getChangeset(e){return e.scope===HE.Experience?this.changesets.experience:e.scope===qE.Window?this.extractChangesetFromGroup({changesetGroup:this.changesets.windows,contextId:e.change.windowId}):this.extractChangesetFromGroup({changesetGroup:this.changesets.users,contextId:e.change.userContextId})}extractChangesetFromGroup({changesetGroup:e,contextId:t}){if(t)return e[t]||(e[t]=new Map),e[t]}computeJobEligibility(e,t,i){if(t.state===UE.start)return!1;const n=i&&i[t.state];return Array.isArray(n)?n.indexOf(e.id)>-1:![UE.onPreWarm,UE.onExperienceWarm,UE.onUserWindowPreWarm].includes(t.state)}getSupportedEntitySet(){const e=this.application.manifest.supportedEntities,t=new Set;return e&&e.reduce(((e,t)=>e.add(t)),t),t}}const gx={[UE.start]:ft.c4.Started,[UE.onPreInit]:ft.c4.Initialized,[UE.onExperienceWarm]:ft.c4.ExperienceWarm,[UE.onPreWarm]:ft.c4.UserWarm,[UE.onExperienceLongIdle]:ft.c4.ExperienceLongIdle,[UE.onUserWindowPreWarm]:ft.c4.WindowWarm,[UE.onIdle]:ft.c4.Idle};class hx extends mx{constructor(e,t){super(e,t),this._loggerCache=new WeakMap}get managedId(){return this.application.manifest.id}onChange(e,t,i){const n=this.getLogger(e,t,i),o=[],r=this.getChangeset({scope:t,change:e});if(!r)return n.warn(`missing ${t===qE.Window?"window":"user context"} id.`),o;r.set(e.type,e);const s=this.getTransitions({logger:n,ctx:{change:e,changeset:r,context:i,scope:t}});for(const e of s){const t=this.performTransition(e);t&&o.push(t)}return o.length>0&&n.log(`${o.length} app changes generated${o.length?`, ${o.map((e=>e.change.type)).join(", ")}`:""}`),o}removeUser(e,t){this.changesets.users[e]&&(t.debug(`removing user ${e} from change set`),delete this.changesets.users[e])}removeWindow(e,t){this.changesets.windows[e]&&(t.debug(`removing window ${e} from change set`),delete this.changesets.windows[e])}getLogger(e,t,i){let n=this._loggerCache.get(i.loggerFactory);n||(n=i.loggerFactory.newLogger("ApplicationLifeCycleManagerV2","core-services-life-cycle"),this._loggerCache.set(i.loggerFactory,n));const o=`[${this.managedId}::${t}::${e.type}]`;return new Proxy(n,{get(e,t,i){const n=Reflect.get(e,t,i).bind(e);return"function"==typeof n?(...e)=>{n(`${o} ${e[0]}`,...e.slice(1))}:n}})}}class px{constructor(e,t){this._scheduler=e,this._logger=t.newLogger("SchedulerWithValidator","core-services-scheduling"),this._uniqueJobIds=new Set}validateAndSchedule(e,t,i){const{id:n,runOncePerId:o}=t;if(this._uniqueJobIds.has(n)){if(o)return this._logger.debug(`Job by ID ${n} has already run once.`),Z.o_}else this._uniqueJobIds.add(n);return this._scheduler.schedule(e,t,i)}}class vx{constructor({context:e,scheduler:t,experienceChangeReportingService:i,loggerFactory:n,lifeCycleChangeReportingService:o,lifeCycleJobPermissions:r}){this.managers=new Map,this.applications=[],this.contexts={experience:{cleanupJobs:[],schedulerWithValidator:new px(t,n),scope:WE.Experience,session:e},users:new Map,windows:new Map},this.coreSettings=e.coreSettings,this.experienceChangeReportingService=i,this.lifeCycleChangeReportingService=o,this.lifeCycleJobPermissions=r||{},this.logger=n.newLogger("ExperienceLifeCycleManagerV2","core-services-life-cycle-manager"),this.scheduler=t}init(){const e=this.experienceChangeReportingService.observeChanges();this.subscription=e.pipe((0,g.b)((e=>this.publish(e)))).subscribe(),this.logger.log("initialized")}destroy(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=this.contexts.users.size+this.contexts.windows.size;i>0&&this.logger.warn(`destroying with ${i} other contexts`),yield this.processCleanupJobs(this.contexts.experience,e),null===(t=this.subscription)||void 0===t||t.unsubscribe(),this.scheduler.destroy(),this.logger.log("destroyed")}))}registerApplication(e){var t;if(!this.isInitialized)throw new Error("Unable to register application before ExperienceLifeCycleManager initialization");const i=e.manifest.id;if(this.managers.has(i))return void this.logger.warn(`skipping application, already registered ${e.manifest.id}`);const n=new hx(e,null===(t=this.lifeCycleJobPermissions)||void 0===t?void 0:t.Application);this.managers.set(i,n),this.applications.push(e),this.logger.log(`registered application ${e.manifest.id}`)}registerUser(e,t){var i,n;if(this.contexts.users.has(e))return void(null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`user already exists for contextId ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0));const o={cleanupJobs:[],userContextId:e,schedulerWithValidator:new px(this.scheduler,t.loggerFactory),session:t,scope:this.contexts.users.size>0?$E.Other:$E.FirstUserAtBoot};this.contexts.users.set(e,o),this.logger.log(`registered user ${e}`)}removeUser(e,t){var i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=this.contexts.users.get(e);if(o){const i=[];this.contexts.windows.forEach((n=>{n.userContextId===e&&i.push(this.removeWindow(n.windowId,e,t))})),yield Promise.all(i),yield this.processCleanupJobs(o,t),this.managers.forEach((t=>t.removeUser(e,this.logger))),this.contexts.users.delete(e),this.logger.log(`removed user ${e}, reason ${t}`)}else null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`user not found ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}))}registerWindow(e,t,i){var n,o,r,s;let a=this.contexts.windows.get(e);a&&a.userContextId===t?null===(o=(n=this.logger).errorToTelemetry)||void 0===o||o.call(n,`window ${e} already exists for user ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0):(this.removeWindow(e,void 0,"switch_user"),this.contexts.users.has(t)?(a={cleanupJobs:[],schedulerWithValidator:new px(this.scheduler,i.loggerFactory),windowId:e,userContextId:t,session:Object.assign(Object.assign({},this.contexts.experience.session),i),scope:BE.Window},this.contexts.windows.set(e,a),this.logger.log(`registered window ${e}`)):null===(s=(r=this.logger).errorToTelemetry)||void 0===s||s.call(r,`failed to register window, could not find user ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}removeWindow(e,t,i){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log(`removing window ${e}${t?` for ${t}`:""}, reason ${i}`);const o=this.contexts.windows.get(e);o?(yield this.processCleanupJobs(o,i),this.managers.forEach((t=>t.removeWindow(e,this.logger))),this.contexts.windows.delete(e),this.logger.log(`removed window ${e}`)):null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,`window not found for ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}))}publish(e){var t,i;if(this.logger.log(`publishing ${e.type}`),e.userContextId)this.logger.log(`change is specific to user ${e.userContextId}`),this.publishChangeWithUserContext(e,e.userContextId);else{const t=Array.from(this.contexts.users.values());for(const{userContextId:i}of t)this.publishChangeWithUserContext(e,i)}if(e.windowId){this.logger.log(`change is specific to window ${e.windowId}`);const n=this.contexts.windows.get(e.windowId);n?this.processChange({change:e,context:n}):null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`window not found for windowId ${e.windowId}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}this.processChange({change:e,context:this.contexts.experience})}publishChangeWithUserContext(e,t){var i,n;const o=this.contexts.users.get(t);if(!o)return void(null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`user not found for userContextId ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0));const r=!e.userContextId&&t?Object.assign(Object.assign({},e),{userContextId:t}):e;this.processChange({change:r,context:o})}processChange({change:e,context:t}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=`${t.scope}::${e.type}`,n=[];let o;this.logger.log(`${i} forwarded to ${this.managers.size} apps`),this.managers.forEach((i=>{const r=i.managedId,s=i.onChange(e,t.scope,t.session);r&&s.length>0&&s.forEach((e=>n.push(this.scheduleJobs({changeWithJobs:e,managedApplicationId:r,context:t}))));const[a]=s||[];a&&(o=a.change.type)})),this.logger.log(`${i} scheduled ${n.length} jobs`);const r=yield Promise.all(n);if(n.length>0&&void 0!==o){const t=vx.getJobsCompleteChangeType(o);t&&this.experienceChangeReportingService.report({type:t,correlationId:e.correlationId,context:{target:"experience-life-cycle-manager"},userContextId:e.userContextId,windowId:e.windowId})}t.scope!==BE.Window&&this.markPostALTScenarioIfNeeded(r,t);for(const{cleanupJobs:e}of r)t.cleanupJobs.push(...e);this.logger.log(`${i} saved ${r.length} cleanup jobs`);const s=this.generateChangeReport({change:e,results:r,scope:t.scope});return this.lifeCycleChangeReportingService.report(s),{change:e}}))}scheduleJobs({changeWithJobs:e,managedApplicationId:t,context:i}){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{change:s,jobs:a}=e,l=[],c=this.coreSettings.get(b.J.Core).enableSerializeScheduledJob&&[ft.c4.UserWarm,ft.c4.ExperienceWarm].includes(s.type),d=[ft.c4.ExperienceLongIdle,ft.c4.Idle].includes(s.type),u=c?Z.vW.MacroSequential:d?Z.vW.Background:Z.vW.Macro;a.forEach((e=>{var{job:t,maxRetries:n,id:r}=e,a=(0,o.__rest)(e,["job","maxRetries","id"]);const c=this.logger;l.push(new Promise(((e,l)=>{const d=Object.assign(Object.assign({},a),{id:r,priority:u,scheduledById:"services-life-cycle-manager"}),m=i.schedulerWithValidator.validateAndSchedule((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var o;let s=0,a=n?Math.min(n,3)+1:1;for(;a;){s++,a--;try{const n=yield t();if(u===Z.vW.MacroSequential){const e=i.session.scenarioFactory.findScenario(U.RG.PostALT);null==e||e.mark(r)}return e(n),n}catch(e){if(!a)throw l(e),e;null===(o=c.errorToTelemetry)||void 0===o||o.call(c,`retrying failed job ${r}, after attempts ${s}, retries remaining ${a}, error: ${e.message?e.message:e}`,"webclient_framework_foundation_core_services_life_cycle_manager")}}}))),d,s.correlationId);m===Z.o_&&e(void 0)})))}));const m=[];let g=RE.success;for(const e of l)try{const t=yield e;t&&m.push(t)}catch(e){const i=`Not all jobs scheduled by ${t} completely successfully. Continuing execution of remaining jobs. Error: ${e.message?e.message:e}`;null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,i,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0),g=RE.failure}return Promise.resolve({id:t,type:s.type,stateJobStatus:g,jobCount:a.length,cleanupJobs:m})}))}markPostALTScenarioIfNeeded(e,t){var i,n;const o=t.scope===WE.Experience?ft.c4.ExperienceWarm:ft.c4.UserWarm,r=t.scope===WE.Experience?U.ck.ExperienceWarmJobCompleted:U.ck.PreWarmJobCompleted;if((null==e?void 0:e.length)>0&&(null===(i=e[0])||void 0===i?void 0:i.type)===o){const e=null===(n=t.session.scenarioFactory)||void 0===n?void 0:n.findScenario(U.RG.PostALT);e&&(e.mark(r),this.logger.log("marked postALT scenario as completed"))}}generateChangeReport({change:e,results:t,scope:i}){const{type:n}=e;0===t.length&&this.logger.warn(`change ${n} produced no application life cycle changes`);const o=i===WE.Experience?LE.ExperienceLifeCycleManager:LE.UserLifeCycleManager;return Object.assign(Object.assign({},e),{type:PE.LifeCycleReport,context:{apps:t,target:o,reportedChange:e}})}processCleanupJobs(e,t){var i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o="experience";"windowId"in e?o=e.windowId:"userContextId"in e&&(o=e.userContextId);const r=`${e.scope}::${o}`,s=e.cleanupJobs;let a;for(let e=s.length-1;e>=0;e--){const i=s[e];try{yield i(t)}catch(e){a=a?a.concat(`${i.toString()}::${(0,M.u4)(e)}`):`${i.toString()}::${(0,M.u4)(e)}::`}}if(this.logger.log(`${r} ran ${s.length} cleanup jobs`),a){const e=new Ne.G(Ne.$.CLEANUP,new Error(a));null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`${r} ${e.toTelemetryEntry()}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}}))}get isInitialized(){return Boolean(this.subscription)}static getJobsCompleteChangeType(e){switch(e){case ft.c4.ExperienceWarm:return ft.yU.ExperienceWarmJobsCompleted;case ft.c4.UserWarm:return ft.yU.PreWarmJobsCompleted;case ft.c4.WindowWarm:return ft.yU.WindowWarmJobsCompleted;default:return}}}class yx{constructor(e,t,i,n,o,r){this._elcm=new vx({scheduler:e,experienceChangeReportingService:t,context:i,lifeCycleChangeReportingService:n,loggerFactory:o,lifeCycleJobPermissions:r})}init(){this._elcm.init()}destroy(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this._elcm.destroy(e)}))}manageApplication(e){this._elcm.registerApplication(e)}manageUser(e,t){this._elcm.registerUser(e,t)}removeUser(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._elcm.removeUser(t,e)}))}manageWindow(e,t,i){this._elcm.registerWindow(e,t,i)}removeWindow(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this._elcm.removeWindow(t,e,i)}))}}function fx({applicationManagers:e,change:t,logger:i,schedulerWithValidator:n,scenarioFactory:r,allowSequentialExecution:s}){const a=[];return i.debug(`Change received: ${t.type}`),e.forEach((e=>{const l=e.managedId,c=e.onChange(t);l&&c.length>0&&c.forEach((e=>a.push(function(e,t,i,n,r,s){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{jobs:a,change:l}=e,c=[],d=s&&[ft.c4.UserWarm,ft.c4.ExperienceWarm].includes(l.type),u=[ft.c4.ExperienceLongIdle,ft.c4.Idle].includes(l.type),m=d?Z.vW.MacroSequential:u?Z.vW.Background:Z.vW.Macro;a.forEach((e=>{c.push(function(e,t,i,n,r){var{job:s}=e,a=(0,o.__rest)(e,["job"]);return new Promise(((e,l)=>{t.validateAndSchedule((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const t=yield s();if(r===Z.vW.MacroSequential){const e=n.findScenario(U.RG.PostALT);null==e||e.mark(a.id)}return e(t),t}catch(e){throw l(e),e}}))),Object.assign(Object.assign({priority:r},a),{scheduledById:"services-life-cycle-manager"}),i)===Z.o_&&e(void 0)}))}(e,n,l.correlationId,r,m))}));const g=[];let h=RE.success;for(const e of c)try{const t=yield e;t&&g.push(t)}catch(e){const n=`Not all jobs scheduled by ${i} completely successfully. Continuing execution of remaining jobs. Error: ${e.message?e.message:e}`;t.errorToTelemetry&&t.errorToTelemetry(n,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0),h=RE.failure}return Promise.resolve({id:i,type:l.type,stateJobStatus:h,jobCount:a.length,cleanupJobs:g})}))}(e,i,l,n,r,s))))})),{change:t,lcChanges:a}}function Sx({change:e,lcChanges:t}){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield Promise.all(t);return{change:e,lcChanges:i}}))}function kx({change:e,lcChanges:t},i,n){const{type:o}=e;0===t.length&&i.debug(`Experience change type: ${o} produced no application life cycle changes`);const r=n===WE.Experience?LE.ExperienceLifeCycleManager:LE.UserLifeCycleManager;return Object.assign(Object.assign({},e),{type:PE.LifeCycleReport,context:{apps:t,target:r,reportedChange:e}})}class bx{constructor(e,t,i,n,o,r,s){this._scope=t,this._sessionContext=n,this._lifeCycleChangeReportingService=o,this._loggerFactory=r,this._lifeCycleJobPermissions=s,this._cleanupJobs=[],this._applicationManagers=[],this._activelyManagedApplications=new Set,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger(`WindowLifeCycleManager[${e}]`,"core-services-life-cycle-manager"),this._schedulerWithValidator=new px(i,r)}notify(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=fx({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory,allowSequentialExecution:!1}),i=yield Sx(t);for(const{cleanupJobs:e}of i.lcChanges)this._cleanupJobs.push(...e);const n=kx(i,this._logger,this._scope);this._lifeCycleChangeReportingService.report(n)}))}manageApplication(e){var t;if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const i=new rx(this._scope,null===(t=this._lifeCycleJobPermissions)||void 0===t?void 0:t.Application,this._sessionContext);i.manageApplication(e),this._applicationManagers.push(i)}destroy(e){var t,i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o,r,s;for(;o=this._cleanupJobs.pop();)try{yield o(e)}catch(e){s=s?s.concat(`${o.toString()}::${(0,M.u4)(e)}`):`${o.toString()}::${(0,M.u4)(e)}::`}s&&(r=new Ne.G(Ne.$.CLEANUP,new Error(s)),null===(i=(t=this._logger).errorToTelemetry)||void 0===i||i.call(t,`${r.code}${null===(n=r.prevError)||void 0===n?void 0:n.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}))}}class wx{constructor(e,t,i,n,o,r,s){this._scope=t,this._scheduler=i,this._sessionContext=n,this._lifeCycleChangeReportingService=o,this._loggerFactory=r,this._lifeCycleJobPermissions=s,this._cleanupJobs=[],this._windowLifecycleManagers=new Map,this._applicationManagers=[],this._activelyManagedApplications=new Set,this._coreSettings=this._sessionContext.coreSettings,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger(`UserLifeCycleManager[${e}]`,"core-services-life-cycle-manager"),this._schedulerWithValidator=new px(i,r)}manageApplication(e){var t;if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const i=new rx(this._scope,null===(t=this._lifeCycleJobPermissions)||void 0===t?void 0:t.Application,this._sessionContext);i.manageApplication(e),this._applicationManagers.push(i)}notify(e){var t,i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.handleWindowChange(e);const{enableSerializeScheduledJob:o}=this._coreSettings.get(b.J.Core),r=fx({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory,allowSequentialExecution:o||!1}),s=yield Sx(r);if((null===(t=s.lcChanges)||void 0===t?void 0:t.length)>0&&(null===(i=s.lcChanges[0])||void 0===i?void 0:i.type)===ft.c4.UserWarm){const e=null===(n=this._sessionContext.scenarioFactory)||void 0===n?void 0:n.findScenario(U.RG.PostALT);null==e||e.mark(U.ck.PreWarmJobCompleted)}for(const{cleanupJobs:e}of s.lcChanges)this._cleanupJobs.push(...e);const a=kx(s,this._logger,this._scope);this._lifeCycleChangeReportingService.report(a)}))}manageWindow(e,t){var i,n;if(this._windowLifecycleManagers.has(e))return void(null===(n=(i=this._logger).errorToTelemetry)||void 0===n||n.call(i,`WINDOW_LIFECYCLE_MANAGER_ALREADY_EXISTS[${e}]`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0));const o=new bx(e,BE.Window,this._scheduler,t,this._lifeCycleChangeReportingService,this._loggerFactory,this._lifeCycleJobPermissions);this._activelyManagedApplications.forEach((e=>o.manageApplication(e))),this._windowLifecycleManagers.set(e,o)}removeWindow(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=this._windowLifecycleManagers.get(e);i&&(yield i.destroy(t),this._windowLifecycleManagers.delete(e))}))}destroy(e){var t,i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o,r,s;for(this._windowLifecycleManagers.forEach((t=>{t.destroy(e)}));o=this._cleanupJobs.pop();)try{yield o(e)}catch(e){s=s?s.concat(`${o.toString()}::${(0,M.u4)(e)}`):`${o.toString()}::${(0,M.u4)(e)}::`}s&&(r=new Ne.G(Ne.$.CLEANUP,new Error(s)),null===(i=(t=this._logger).errorToTelemetry)||void 0===i||i.call(t,`${r.code}${null===(n=r.prevError)||void 0===n?void 0:n.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}))}handleWindowChange(e){var t;e.windowId&&(null===(t=this._windowLifecycleManagers.get(e.windowId))||void 0===t||t.notify(e))}}class Cx{constructor(e,t,i,n,o,r){this._scheduler=e,this._experienceChangeReportingService=t,this._sessionContext=i,this._lifeCycleChangeReportingService=n,this._loggerFactory=o,this._lifeCycleJobPermissions=r,this._cleanupJobs=[],this._userLifecycleManagers=new Map,this.handleUserScopeChange=e=>{if(e.userContextId){const t=this._userLifecycleManagers.get(e.userContextId);t?t.notify(e):this._logger.error(`EXPECTED_USER_LIFECYCLE_MANAGER_NOT_FOUND[${e.userContextId}]`)}else this._userLifecycleManagers.forEach((t=>t.notify(e)))},this._applicationManagers=[],this._activelyManagedApplications=new Set,this._coreSettings=this._sessionContext.coreSettings,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger("ExperienceLifeCycleManager","core-services-life-cycle-manager"),this._schedulerWithValidator=new px(this._scheduler,o)}init(){const e=this._experienceChangeReportingService.observeChanges(),{enableSerializeScheduledJob:t}=this._coreSettings.get(b.J.Core);this._subscription=e.pipe((0,g.b)(this.handleUserScopeChange),(0,c.U)((e=>fx({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory,allowSequentialExecution:t||!1}))),(0,ce.b)(Sx),(0,g.b)((e=>{var t,i,n;if((null===(t=e.lcChanges)||void 0===t?void 0:t.length)>0&&(null===(i=e.lcChanges[0])||void 0===i?void 0:i.type)===ft.c4.ExperienceWarm){const e=null===(n=this._sessionContext.scenarioFactory)||void 0===n?void 0:n.findScenario(U.RG.PostALT);null==e||e.mark(U.ck.ExperienceWarmJobCompleted)}for(const{cleanupJobs:t}of e.lcChanges)this._cleanupJobs.push(...t)})),(0,c.U)((e=>kx(e,this._logger,WE.Experience))),(0,c.U)((e=>this._lifeCycleChangeReportingService.report(e)))).subscribe()}destroy(e){var t,i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o,r,s;for(;o=this._cleanupJobs.pop();)try{yield o(e)}catch(e){s=s?s.concat(`${o.toString()}::${(0,M.u4)(e)}`):`${o.toString()}::${(0,M.u4)(e)}::`}this._subscription&&this._subscription.unsubscribe(),this._scheduler.destroy(),s&&(r=new Ne.G(Ne.$.CLEANUP,new Error(s)),null===(i=(t=this._logger).errorToTelemetry)||void 0===i||i.call(t,`${r.code}${null===(n=r.prevError)||void 0===n?void 0:n.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}))}manageApplication(e){var t;if(!this._subscription)throw new Error("Unable to manage provided application prior to LifeCycleManager init.");if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const i=new rx(WE.Experience,null===(t=this._lifeCycleJobPermissions)||void 0===t?void 0:t.Application,this._sessionContext);i.manageApplication(e),this._applicationManagers.push(i)}manageUser(e,t){if(this._userLifecycleManagers.has(e))return void this._logger.error(`USER_LIFECYCLE_MANAGER_ALREADY_EXISTS[${e}]`);const i=new wx(e,this._userLifecycleManagers.size>0?$E.Other:$E.FirstUserAtBoot,this._scheduler,t,this._lifeCycleChangeReportingService,this._loggerFactory,this._lifeCycleJobPermissions);this._activelyManagedApplications.forEach((e=>i.manageApplication(e))),this._userLifecycleManagers.set(e,i)}manageWindow(e,t,i){var n,o;this.removeWindow(void 0,e,"switch_user");const r=this._userLifecycleManagers.get(t);r?r.manageWindow(e,Object.assign(Object.assign({},this._sessionContext),i)):null===(o=(n=this._logger).errorToTelemetry)||void 0===o||o.call(n,`EXPECTED_USER_LIFECYCLE_MANAGER_NOT_FOUND[${t}]`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}removeUser(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=this._userLifecycleManagers.get(t);i?(yield i.destroy(e),this._userLifecycleManagers.delete(t)):this._logger.warn(`USER_LIFECYCLE_MANAGER_NOT_FOUND_TO_DESTROY[${t}]`)}))}removeWindow(e,t,i){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){e?null===(n=this._userLifecycleManagers.get(e))||void 0===n||n.removeWindow(t,i):this._userLifecycleManagers.forEach((e=>e.removeWindow(t,i)))}))}}const _x=(e,t,i,n)=>{const o=function(e,t,i){if(!i){const{context:{execution:i}}=e;t.error(`Received a scheduler change in state: ${Z.Tf[i]} with no active scenario: ${JSON.stringify(e)}`)}return i}(e,t,n);if(o){const{context:{execution:t,handle:n,error:r}}=e;o.appendEventData({errorCode:null==r?void 0:r.code,message:null==r?void 0:r.message,context:null==r?void 0:r.context}),o.mark(`${U.ck.ScheduledJobStateChange}_${Z.Tf[t].toLocaleLowerCase()}_${n}`),i(o)}};class Tx{constructor(e,t,i){this._schedulerChangeReporting=e,this._scenarioFactory=t,this._activeExpScenariosMap=new Map,this._activeAppScenariosMap=new Map,this._activeSchedulerScenariosMap=new Map,this._logger=i.newLogger("LifeCycleTelemetry","core-services-life-cycle-telemetry")}init(){const e=e=>({change:e,scenarioFactory:this._scenarioFactory,activeAppScenariosMap:this._activeAppScenariosMap,activeExpScenariosMap:this._activeExpScenariosMap,activeSchedulerScenariosMap:this._activeSchedulerScenariosMap,logger:this._logger});this._schedulingChangeSubscription=this._schedulerChangeReporting.observeChanges().pipe((0,c.U)((t=>function({change:e,activeSchedulerScenariosMap:t,scenarioFactory:i,logger:n}){const{context:{execution:o}}=e,r=(({windowId:e,context:{handle:t}})=>`${t}:${e}`)(e);let s=t.get(r);switch(o){case Z.Tf.Started:if(s)n.error(`Received a scheduler change in state: ${Z.Tf[o]} with an active scenario already running. Change: ${JSON.stringify(e)}`);else{s=i.newScenario(U.RG.ScheduledJobComplete),t.set(r,s);const{correlationId:n,context:{meta:{id:o,priority:a,scheduledById:l,runOncePerId:c},target:d},type:u}=e;s.appendEventData({"Job.Id":o,"Job.Priority":Z.vW[a],"Job.ScheduledBy":l,"Job.RunOncePerId":c,target:d,correlationId:n,type:u})}break;case Z.Tf.Canceled:_x(e,n,(e=>null==e?void 0:e.cancel()),s);break;case Z.Tf.Complete:_x(e,n,(e=>null==e?void 0:e.stop()),s),t.delete(r);break;case Z.Tf.Received:n.log(`Received a scheduler change in state: ${Z.Tf[o]}: Change:${JSON.stringify(e)}`)}}(e(t))))).subscribe()}destroy(){this._schedulingChangeSubscription&&this._schedulingChangeSubscription.unsubscribe(),this._schedulingChangeSubscription=void 0}}var Ix=i(586990);const jx=1024;function Nx(e,t,i,n,r){var s;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const a=yield null===(s=Ix.K.getInstance())||void 0===s?void 0:s.getMemoryData(r);if(!a)return{baseRendererWS:0,baseJSUsedHeapSize:0};const l=yield function(e,t,i){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o=0;o=i.enableDecoupleCommandingFromApollo?i.getActiveWindows().length:(null===(n=yield(0,_s.XD)(e))||void 0===n?void 0:n.length)||0;const r=t.get(b.J.Diagnostics).memorySharedSettings.popoutSizeInMB;return o<=1||!r?{jsUsedHeapSize:0,rendererWorkingSet:0}:{jsUsedHeapSize:(o-1)*(r.jsUsedHeapSize||0)*jx,rendererWorkingSet:(o-1)*(r.rendererWorkingSet||0)*jx}}))}(e,t,i),c=yield function(e,t){var i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o={id:"dummy",source:"memoryUtilities"},s=null!==(r=null===(n=yield null===(i=null==t?void 0:t.getCachedUsers)||void 0===i?void 0:i.call(t,o,{isAllCachedUsers:!0,isAuthenticated:!0}))||void 0===n?void 0:n.length)&&void 0!==r?r:1,a=e.get(b.J.Diagnostics).memorySharedSettings.accountSizeInMB;return s<=1||!a?{jsUsedHeapSize:0,rendererWorkingSet:0}:{jsUsedHeapSize:(s-1)*(a.jsUsedHeapSize||0)*jx,rendererWorkingSet:(s-1)*(a.rendererWorkingSet||0)*jx}}))}(t,n);let d=0;const u=a.Perf_MainRenderer_WorkingSet;u&&(d=u-l.rendererWorkingSet-c.rendererWorkingSet);let m=0;const g=a.Perf_JSHeap_UsedSize;return g&&(m=g-l.jsUsedHeapSize-c.jsUsedHeapSize),{baseRendererWS:d,baseJSUsedHeapSize:m,heartbeatData:a}}))}class Ex{constructor(e,t,i,n,o,r,s,a,l,c){this.client=t,this.clientStateProvider=i,this.coreSettings=n,this.rebootService=o,this.hostCommunicationService=r,this.scenarioFactory=s,this.activeWindowsService=a,this.loggerFactory=l,this.authService=c,this.clientStateSubscription=null,this.isMachineLocked=!1,this.configSubscription=null,this.highMemoryRestartSettings=this.coreSettings.get(b.J.Diagnostics).highMemoryRestartSettings,this.currentClientState=this.clientStateProvider.getState(),this.startTimeMS=e.startTimeMS,this.startDate=new Date(this.startTimeMS).toUTCString(),this.logger=this.loggerFactory.newLogger("highMemoryRestartService","high-memory-restart"),this.start()}start(){this.newScenario(U.RG.HighMemoryRestartServiceStart),this.subscribeToClientStateChange(),this.subscribeToMachineStateChange(),this.subscribeToConfigSettingsChange()}stop(){var e,t,i;null===(e=this.clientStateSubscription)||void 0===e||e.unsubscribe(),null===(t=this.unsubscribeToMachineStateChange)||void 0===t||t.call(this),null===(i=this.configSubscription)||void 0===i||i.unsubscribe()}static createInstance(e,t,i,n,o,r,s,a,l,c){return Ex.instance||(Ex.instance=new Ex(e,t,i,n,o,r,s,a,l,c)),Ex.instance}destroyInstance(){Ex.instance=void 0}subscribeToClientStateChange(){this.clientStateSubscription=this.clientStateProvider.observe().subscribe((e=>this.handleClientStateChange(e)))}subscribeToMachineStateChange(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.hostCommunicationService.loadModule("osutils");this.unsubscribeToMachineStateChange=null===(e=null==t?void 0:t.registerForSessionStateChanged)||void 0===e?void 0:e.call(t,(e=>{this.infoToTelemetry(`Current machine state is ${e.status}`),e.status!==Js.$y.Locked&&e.status!==Js.$y.Unlocked||this.handleMachineStateChange(e.status===Js.$y.Locked)}))}))}subscribeToConfigSettingsChange(){this.configSubscription=this.coreSettings.getObservable(b.J.Diagnostics).subscribe((e=>{e.enableHighMemoryRestartService||this.stop()}))}handleClientStateChange(e){this.currentClientState=e,this.handleStateChange()}handleMachineStateChange(e){this.isMachineLocked=e,this.handleStateChange()}handleStateChange(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){(yield this.shouldRebootApp())&&(this.newScenario(U.RG.HighMemoryRestartApp),this.rebootService.rebootApp(ns.Z.HighMemory,ns.d.ReloadAppTask))}))}shouldRebootApp(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.currentClientState===_e.pk.LongInactive&&(this.isLongRunningSession()?(yield this.hasHighMemory())?(this.infoToTelemetry("App is ready to reboot, waiting for the computer to be locked"),!!this.isMachineLocked||(this.infoToTelemetry("App didn't reboot because machine wasn't locked"),!1)):(this.infoToTelemetry("App didn't reboot because memory wasn't high"),!1):(this.infoToTelemetry(`App didn't reboot because it is not a long running session yet. Start time: ${this.startDate}`),!1))}))}isLongRunningSession(){var e;return(new Date).getTime()-this.startTimeMS>36e5*((null===(e=this.highMemoryRestartSettings)||void 0===e?void 0:e.longRunningThresholdInHours)||0)}hasHighMemory(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield Nx(this.client,this.coreSettings,this.activeWindowsService,this.authService,!0)).baseRendererWS>1024*((null===(e=this.highMemoryRestartSettings)||void 0===e?void 0:e.thresholdsInMB.rendererWorkingSet)||0)}))}newScenario(e){this.scenarioFactory.newScenario(e).stop()}infoToTelemetry(e){var t,i;this.coreSettings.get(b.J.Diagnostics).enableHighMemoryRestartLogger&&(null===(i=null===(t=this.logger)||void 0===t?void 0:t.infoToTelemetry)||void 0===i||i.call(t,e,"high_memory_restart_request"))}}var xx,Ax;!function(e){e.ok="ok",e.error="error"}(xx||(xx={})),function(e){e.debugPii="debugPii",e.debug="debug",e.info="info",e.warning="warning",e.error="error"}(Ax||(Ax={}));var Dx=i(157930);const Fx=1024,Ox=1e3,Mx=6e4,Rx=36e5,Px=864e5,Lx="memoryFeedbackService.lastDialogDate",Ux="memoryFeedbackService.countOfDialogWithinDay",Wx="memoryFeedbackService.countOfDialogWithinWeek";class Bx{constructor(e,t,i,n,o,r,s,a,l,c,d){this.localStorage=e,this.entityCommanding=t,this.clientState=i,this.client=n,this.coreSettings=o,this.scenarioFactory=r,this.activeWindowsService=s,this.hostCommunicationService=a,this.profilerService=l,this.userTrackingService=c,this.authService=d,this.timeWhenLastCallEnded=-1,this.countOfDialogWithinDay=0,this.countOfDialogWithinWeek=0,this.memoryFeedbackSettings={},this.enableMemoryAutoBRBDialog=!1,this.enableWatsonMemoryDumps=!1,this.triedToWriteHighMemoryEvent=!1,this.running=!1,this.shouldKeepStopped=!1;this.coreSettings.getObservable(b.J.Diagnostics).subscribe((e=>{const{memoryFeedbackSettings:t,enableMemoryAutoBRBDialog:i,enableWatsonMemoryDumps:n}=e;this.enableMemoryAutoBRBDialog=i||!1,this.enableWatsonMemoryDumps=n||!1;let o=this.enableMemoryAutoBRBDialog||this.enableWatsonMemoryDumps;t&&Object.keys(t).length>0?this.memoryFeedbackSettings=t:(this.memoryFeedbackSettings={},o=!1),o?this.start():this.stop(!1)}))}start(){var e;this.running||this.shouldKeepStopped||(this.running=!0,this.dateOfBeginingHighMemory=void 0,this.timeWhenLastCallEnded=-1,this.clientStateSubscription||this.startClientStateSubscription(),this.intervalId||(this.intervalId=(0,F.J)().setInterval((()=>this.beat(!0)),null!==(e=this.memoryFeedbackSettings.verySlowSampleTime)&&void 0!==e?e:2147483647)))}stop(e){this.shouldKeepStopped||(this.shouldKeepStopped=e),this.running&&(this.running=!1,this.intervalId&&(0,F.J)().clearInterval(this.intervalId),this.clientStateSubscription&&this.clientStateSubscription.unsubscribe(),this.intervalId=void 0,this.clientStateSubscription=void 0)}startClientStateSubscription(){let e=this.clientState.getState();this.clientStateSubscription=this.clientState.observe().subscribe({next:t=>{e===_e.pk.VeryActive&&t!==_e.pk.VeryActive&&(this.timeWhenLastCallEnded=Date.now()),e=t}})}shouldKeepRunningForMTMA(){var e,t;return!!(null===(e=this.coreSettings.get(b.J.Diagnostics).memorySharedSettings)||void 0===e?void 0:e.accountSizeInMB)||(null===(t=this.userTrackingService)||void 0===t?void 0:t.getAccountMode())!==WI.b.MultipleAccounts}beat(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.shouldKeepRunningForMTMA())return void this.stop(!0);const i=new Date,n=yield this.isMemoryHigh(i,e);if(n.hasExtraRenderer)return this.stop(!0),void this.newScenario(U.RG.MemoryFeedbackStopBecauseOfDevtools);if(!n.isMemoryHeavy)return;if(e)return yield this.triggerGCAndWait(),this.beat(!1);const o=this.clientState.getState();if(!this.enableWatsonMemoryDumps||o!==_e.pk.Inactive&&o!==_e.pk.LongInactive){if(this.enableWatsonMemoryDumps&&!this.triedToWriteHighMemoryEvent||!this.enableMemoryAutoBRBDialog||o!==_e.pk.Active)return;this.openBrbDialog(n.memoryDetailMessage),this.newScenario(U.RG.MemoryFeedbackDialogOpen)}else{this.triedToWriteHighMemoryEvent=!0;const e=yield this.hostCommunicationService.loadModule("etw"),i=yield null===(t=null==e?void 0:e.writeHighMemoryEvent)||void 0===t?void 0:t.call(e);if(this.newScenario(U.RG.MemoryFeedbackHighMemoryMark,i),(null==i?void 0:i.result)!==xx.ok)return}this.stop(!0),this.dateOfBeginingHighMemory=void 0,this.localStorage.set(Ux,(this.countOfDialogWithinDay+1).toString(),"Fundamentals"),this.localStorage.set(Wx,(this.countOfDialogWithinWeek+1).toString(),"Fundamentals"),this.localStorage.set(Lx,i.toString(),"Fundamentals")}))}openBrbDialog(e){this.entityCommanding.brbFeedback.autoBrbConfirmationDialog({visibilityState:ve.fe.show,stateTransition:ve.su.new,correlation:{source:k.D.AutoBrb}},{feedbackText:`Detected high memory usage. ${e}`,feedbackSelectedCategory:"79",includeHeapSnapshot:!0,brbContext:Dx.t.HighMemoryUsage})}isMemoryHigh(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{isMemoryHeavy:n,memoryDetailMessage:o,hasExtraRenderer:r}=yield this.getMemoryUsageData(t),s=this.activeWindowsService.enableDecoupleCommandingFromApollo?this.activeWindowsService.getStandardMainWindow():yield(0,_s.jW)(this.client);if(!(null==s?void 0:s.isMainWindow))return{hasExtraRenderer:r,isMemoryHeavy:!1};const a=this.clientState.getState();if(!n||a===_e.pk.VeryActive||this.wasInCallRecently(e))return this.dateOfBeginingHighMemory=void 0,{hasExtraRenderer:r,isMemoryHeavy:!1};this.dateOfBeginingHighMemory=this.dateOfBeginingHighMemory||e;return e.getTime()-this.dateOfBeginingHighMemory.getTime()<(null!==(i=this.memoryFeedbackSettings.durationInMinuteOfConsecutiveHighMemoryState)&&void 0!==i?i:Number.MAX_SAFE_INTEGER)*Mx||this.hasReachedDialogLimit(e)?{hasExtraRenderer:r,isMemoryHeavy:!1}:{hasExtraRenderer:r,isMemoryHeavy:n,memoryDetailMessage:o}}))}getMemoryUsageData(e){var t,i,n,r,s;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=this.getThresholds(),a=[];let l=!1;const c=yield Nx(this.client,this.coreSettings,this.activeWindowsService,this.authService,e),d=(null===(t=c.heartbeatData)||void 0===t?void 0:t.Perf_MainRenderer_WorkingSet)||0,u=c.baseRendererWS>(null!==(i=o.rendererWorkingSet)&&void 0!==i?i:Number.MAX_SAFE_INTEGER)*Fx;l=l||u,a.push(`${this.markReachedThreshold(u)}RWS: ${this.convertKBtoMB(d)} MB`);const m=(null===(n=c.heartbeatData)||void 0===n?void 0:n.Perf_JSHeap_UsedSize)||0,g=c.baseJSUsedHeapSize>(null!==(r=o.jsUsedHeapSize)&&void 0!==r?r:Number.MAX_SAFE_INTEGER)*Fx;l=l||g,a.push(`${this.markReachedThreshold(g)}JSH: ${this.convertKBtoMB(m)} MB`),a.push(`base RWS: ${this.convertKBtoMB(c.baseRendererWS)} MB`);return{isMemoryHeavy:l,memoryDetailMessage:a.join(", "),hasExtraRenderer:!0===(null===(s=c.heartbeatData)||void 0===s?void 0:s.hasExtraRenderer)}}))}hasReachedDialogLimit(e){var t,i,n;const o=new Date(this.localStorage.get(Lx)||0),r=e.getTime()-o.getTime();return r<(null!==(t=this.memoryFeedbackSettings.gapInHourBetweenFeedbackDialogs)&&void 0!==t?t:Number.MAX_SAFE_INTEGER)*Rx||(r>Px&&this.resetDialogDayCount(),this.countOfDialogWithinDay=parseInt(this.localStorage.get(Ux)||"0",10),this.countOfDialogWithinDay>=(null!==(i=this.memoryFeedbackSettings.limitOfFeedbackDialogsWithinDay)&&void 0!==i?i:0)||(r>7*Px&&this.resetDialogWeekCount(),this.countOfDialogWithinWeek=parseInt(this.localStorage.get(Wx)||"0",10),this.countOfDialogWithinWeek>=(null!==(n=this.memoryFeedbackSettings.limitOfFeedbackDialogsWithinWeek)&&void 0!==n?n:0)))}wasInCallRecently(e){var t;const i=(null!==(t=this.memoryFeedbackSettings.minimumSecondsPassedSinceLastCall)&&void 0!==t?t:Number.MAX_SAFE_INTEGER)*Ox;return e.getTime()-this.timeWhenLastCallEnded<i}triggerGCAndWait(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield null===(e=this.profilerService)||void 0===e?void 0:e.requestTriggerGC(),yield(0,Fa._)(null!==(t=this.memoryFeedbackSettings.delayInMsAfterGC)&&void 0!==t?t:0)}))}newScenario(e,t){this.scenarioFactory.newScenario(e).stop(t)}getThresholds(){var e;return null!==(e=this.memoryFeedbackSettings.thresholdsInMB)&&void 0!==e?e:{}}resetDialogDayCount(){this.localStorage.set(Ux,"0","Fundamentals")}resetDialogWeekCount(){this.localStorage.set(Wx,"0","Fundamentals")}markReachedThreshold(e){return e?"#":""}convertKBtoMB(e){return(e/Fx).toFixed(2)}}var $x,Hx=i(817861);!function(e){e.Supported="Supported",e.Unsupported="Unsupported",e.Unknown="Unknown"}($x||($x={}));function qx(e){return e.split(".").slice(-2).join(".")}class zx{constructor(e,t,i,n){this.windowProvider=n,this.detectionAttempts=0,this.scenario=i.newScenario(U.RG.DetectThirdPartyCookieSupport);const{enableThirdPartyCookiesDetection:o,thirdPartyCookiesDetectionOriginOverride:r}=t.get(b.J.Core,["enableThirdPartyCookiesDetection","thirdPartyCookiesDetectionOriginOverride"]);this.enabled=Boolean(o);const{staticsPath:s,buildType:a,buildVersion:l}=t.get(b.J.Platform,["staticsPath","buildType","buildVersion"]);this.cdnConfig={experienceName:e,staticsOrigin:s||void 0,overrideOrigin:r||void 0,buildType:a||void 0,version:l||void 0}}detect(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.enabled)return this.returnError("enableThirdPartyCookiesDetection is disabled");this.scenario.mark("attempting_detection");const t=yield this.attemptDetection();if(this.cleanup(),"result"in t)return this.returnSuccess(t.result);const{error:i,retriable:n,url:o}=t;return!e&&n&&this.detectionAttempts<3?this.detect(e):this.returnError(i,o)}))}attemptDetection(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.detectionAttempts+=1;const e=5e3*this.detectionAttempts;try{const t=function(e,t){const{experienceName:i,staticsOrigin:n,buildType:o,version:r,overrideOrigin:s}=t;let a;const l=s||n;switch(o){case"production":if(!l||!r)break;a=`${l}/teams-modular-packages/${i}/${r}/`;break;case"container":a=e.__webpack_public_path__;break;case"local":a="https://local.third-party-cookie-service.office.net/v2/";break;default:throw new Error("Unsupported build type")}if(!a)throw new Error("CDN path not found");if(qx(new URL(a).host)===qx(e.location.host))throw new Error("CDN domain and client domain are the same");return`${a}report-third-party-cookies.html`}(this.windowProvider,this.cdnConfig),i=this.windowProvider.document.createElement("iframe");i.setAttribute("style","display: none;"),i.setAttribute("src",t),this.iframe=i,this.scenario.mark("iframe_created");const n=new Promise((i=>{this.detectionTimeoutRef=this.windowProvider.setTimeout((()=>{i({error:`Timeout of ${e} exceeded`,url:t,retriable:!0})}),e)})),o=new Promise((e=>{this.messageHandler=t=>{const i=this.handlePostMessage(t);i&&e({result:i})},this.windowProvider.addEventListener("message",this.messageHandler)})),r=new Promise((e=>{i.addEventListener("error",(i=>{e({error:i.message,url:t})}))}));return this.windowProvider.document.body.appendChild(this.iframe),Promise.race([n,o,r])}catch(e){return Promise.resolve({error:e.message})}}))}handlePostMessage({data:e}){const{third_party_cookies_allowed:t}=e;if(void 0===t)return;this.scenario.mark("iframe_message_received");return Boolean(t)?$x.Supported:$x.Unsupported}returnSuccess(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.scenario.stop({third_party_cookie_support:e}),Promise.resolve(e)}))}returnError(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.scenario.fail({error:`${e}. Attempts made: ${this.detectionAttempts}`,url:t,third_party_cookies_support:$x.Unknown}),Promise.resolve($x.Unknown)}))}cleanup(){this.iframe&&(this.windowProvider.document.body.removeChild(this.iframe),this.iframe=void 0),this.messageHandler&&(this.windowProvider.removeEventListener("message",this.messageHandler),this.messageHandler=void 0),this.detectionTimeoutRef&&(this.windowProvider.clearTimeout(this.detectionTimeoutRef),this.detectionTimeoutRef=void 0)}}var Vx=i(24606);const Gx=e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const t=yield e.loadModule("core");(null==t?void 0:t.reportExperienceWarm)&&t.reportExperienceWarm()}));var Jx;!function(e){e.LifeCycleScopeChange="LifeCycleScopeChange"}(Jx||(Jx={}));class Kx extends Ce.i{constructor(){super(f.Yg.CreateLifeCycleTask,["activeWindowsService","appsRegistryService","authenticationService","client","clientState","config","coreSecurityService","coreSettings","coreSettingsContext","coreUtilities","entityCommanding","experienceChangeReportingService","hostCommunicationService","i18n","i18NextWrapper","lifeCycleScopeChangeReportingService","localStorage","loggerFactory","networkState","platformService","rebootService","scenarioFactory","schedulerChangeReporting","userBiService","windowProvider","scheduler","notificationsHandler","logsCollectorService","eventing"]),this.createCoreApplication=(e,t,i,n,r)=>({manifest:{name:"CoreTasks",id:"com.microsoft.teams.corescheduling"},onExperienceWarm:n=>[{id:"memory-feedback-service-start",job:()=>{const{context:{authenticationService:e,client:t,clientState:i,coreSettings:o,entityCommanding:s,localStorage:a,profilerService:l,scenarioFactory:c,userTrackingService:d,hostCommunicationService:u}}=n;a&&new Bx(a,s,i,t,o,c,r,u,l,d,e)}},{id:"init-diagnostics-idb-job",job:()=>{const{context:{loggerFactory:e}}=n;"notifyDiagnosticsALTDone"in e&&e.notifyDiagnosticsALTDone()}},{id:"clear-t2-web-boot-attempts-counter",job:()=>{var e,t,i;const{context:{coreSettings:o,loggerFactory:r,localStorage:s}}=n;if(!o.get(b.J.Core).enableClearT2WebBootAttempts)return;const a="clear_t2_web_boot_attempts_failure",l=r.newLogger("ClearWebBootAttemptsLogger","clear-t2-web-boot-attempts-counter");if(!s)return void(null===(e=l.errorToTelemetry)||void 0===e||e.call(l,"Local storage unavailable",a,void 0,!0));const c="numT2WebBootAttempts",d="t2WebOptInSessionId";s.remove(c,"Global"),s.remove(d,"Global"),s.remove("lastT2WebBootAttemptRecordTime","Global"),s.get(c,"Global")||s.get(d,"Global")?null===(t=l.errorToTelemetry)||void 0===t||t.call(l,"Failed to remove web boot/opt-in keys from local storage",a,void 0,!0):null===(i=l.warnToTelemetry)||void 0===i||i.call(l,"Successfully removed web boot/opt-in keys from local storage","clear_t2_web_boot_attempts_success",void 0,!0)}},{id:"detect-third-party-cookie-support-job",runOncePerId:!0,job:()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{scenarioFactory:e,windowProvider:i,coreSettings:o,config:r,platformService:s}=n.context,a=yield function(e,t,i,n,o,r=!1){return t!==wr.us.Web?Promise.resolve($x.Unknown):new zx(e,i,n,o).detect(r)}(r.experienceName,s.config.platformId,o,e,i);t.updatePlatformProviderSettings({thirdPartyCookieSupport:a})}))},{id:"notify-desktop-experience-warm-job",job:()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{context:{coreSettings:i,hostCommunicationService:n,scenarioFactory:o,loggerFactory:r}}=e,s=r.newLogger("NotifyDesktopExperienceWarmJob","notify-desktop-experience-warm-job");s.log("Start");const a=o.newScenario(U.RG.NotifyDesktopOnExperienceWarm),{enableUserDataFetchForSilentLaunch:l}=i.get(b.J.Core),{launchIntent:c}=i.get(b.J.HostCapabilities);if(!l||"LaunchCoreNoSystemTray"!==c){const e=`ReportingDesktopExperienceWarm: enableUserDataFetchForSilentLaunch: ${l}, launchIntent: ${c}`;return s.log(e),a.stop({reason:e}),void(yield Gx(n))}if(yield Rd(t)){const e="SkippingReportingDesktopExperienceWarm: PrimaryUserFound";s.log(e),a.stop({reason:e},"abandoned")}else{const e="ReportingDesktopExperienceWarm: PrimaryUserUndefined";s.log(e),a.stop({reason:e}),yield Gx(n)}})))(n,e)},Qx(n,i)],onPreWarm:r=>[{id:"settings-ecs-fetch",job:()=>t.fetchEcsSettingsIfApplicable()},{id:"maglev-provider-host-settings",job:()=>{const{context:{coreSettings:e}}=r;e.get(b.J.Core).enableMaglevHostPostAltSettings&&t.initializeMaglevHostProviderPostAltSettings(n)}},{id:"user-bi-initialize-smb-user-intent",job:()=>i.initializeAndSubscribeToSmbUserIntent&&i.initializeAndSubscribeToSmbUserIntent()},{id:"active-windows-history-job",job:()=>{const{context:{activeWindowsHistoryService:e}}=r;if(e)return e.initialize(),t=>{e.cleanup(t)}}},Xx(r),{id:"start-local-migrated-settings-timer-job",job:()=>{const{context:{localMigratedSettings:e}}=r;e&&e.startTimer()}},{id:"notify-desktop-experience-warm-for-user-job",job:()=>((e,t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var i,n;const{context:{authenticationUser:o,coreSettings:r,client:s,hostCommunicationService:a,scenarioFactory:l,loggerFactory:c}}=e,d=c.newLogger("NotifyDesktopExperienceWarmForUserJob","notify-desktop-experience-warm-for-user-job"),u=l.newScenario(U.RG.NotifyDesktopOnPrimaryUserWarm);d.log("Start");const{enableUserDataFetchForSilentLaunch:m}=r.get(b.J.Core),{launchIntent:g}=r.get(b.J.HostCapabilities);if(!m||"LaunchCoreNoSystemTray"!==g){const e=`SkippingReportingDesktopExperienceWarm: enableUserDataFetchForSilentLaunch: ${m}, launchIntent: ${g}`;return d.log(e),void u.stop({reason:e},"abandoned")}if(!(yield Md(t,o))){const e="SkippingReportingDesktopExperienceWarm: CurrentUserNotPrimary";return d.log(e),void u.stop({reason:e},"abandoned")}try{d.log("ChatListQueryStart"),u.mark(U.ck.ChatListQueryStart);const{data:e}=yield s.query({query:Vx.h,variables:{includePinnedChats:!0,includeSuggestedContacts:!1}}),t=`ChatListQueryEnd[${null===(n=null===(i=null==e?void 0:e.recentsChats)||void 0===i?void 0:i.edges)||void 0===n?void 0:n.length}]`;d.log(t),u.mark(U.ck.ChatListQueryEnd,{reason:t})}catch(e){d.error("ChatListQueryFail",e),u.mark(U.ck.ChatListQueryEnd,{error:e})}d.log("Stop"),u.stop(),yield Gx(a)})))(r,e)}],onExperienceLongIdle:e=>[Yx(e,r)]})}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=e.config,i=e.coreSettings,n=e.coreSettingsContext,r=e.clientAccessAdminPolicyCheckService,s=e.entityCommanding,a=e.experienceChangeReportingService,l=e.hostCommunicationService,c=e.i18n,d=e.lifeCycleScopeChangeReportingService,u=e.loggerFactory,m=e.networkState,g=e.platformService,h=e.scenarioFactory,p=e.schedulerChangeReporting,v=e.userBiService,y=e.clientState,f=e.localStorage,S=e.i18NextWrapper,k=e.windowProvider,w=e.rebootService,C=e.coreSecurityService,_=e.scheduler,T=e.notificationsHandler,I=e.authenticationService,j=e.activeWindowsService,N=e.logsCollectorService,E=e.eventing;new Tx(p,h,u).init();const{isEntityInView:x}=e.coreUtilities,{enableExperienceLifeCycleManagerV2:A}=i.get(b.J.Core),D=new(A?yx:Cx)(_,a,{authenticationService:I,client:e.client,clientAccessAdminPolicyCheckService:r,clientState:y,config:t,coreSecurityService:C,coreSettings:i,entityCommanding:s,eventing:E,hostCommunicationService:l,i18n:c,i18NextWrapper:S,isEntityInView:x,localStorage:f,loggerFactory:u,logsCollectorService:N,networkState:m,notificationsHandler:T,platformService:g,rebootService:w,scenarioFactory:h,windowProvider:k},d,u,t.lifeCycleJobPermissions);return D.init(),e.appsRegistryService.registeredApps.forEach((e=>D.manageApplication(e))),D.manageApplication(this.createCoreApplication(I,n,v,l,j)),e.scheduler=_,e.experienceLifecycleManager=D,e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){switch(e){case"quit":case"signout":yield D.destroy(e);break;default:return}}))}))}}const Qx=(e,t)=>({id:"cleanup-t1-desktop-job",runOncePerId:!0,job:()=>{const{context:{clientAccessAdminPolicyCheckService:i,hostCommunicationService:n,loggerFactory:r}}=e,s=r.newLogger("CleanupT1DesktopJob","cleanup-t1-desktop-job");if(i){const e=i.shouldUserAttemptT1Cleanup().subscribe((e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){if(e){const e=yield n.loadModule("appswitcher");if(null==e?void 0:e.uninstallT1App){s.log("PIE: uninstallT1App");try{yield e.uninstallT1App(),t.recordPanelAction({panelType:"OpenApplication",actionScenario:"UninstallT1App",actionOutcomeNew:"T1AppUninstalled",actionGesture:"auto"})}catch(e){t.recordPanelAction({panelType:"OpenApplication",actionScenario:"UninstallT1App",actionOutcomeNew:"T1AppUninstallFailed",actionGesture:"auto"})}}}}))));return()=>{e.unsubscribe()}}return()=>{}}}),Yx=(e,t)=>({id:"high-memory-restart-service",runOncePerId:!0,job:()=>{const{context:{authenticationService:i,client:n,clientState:o,config:r,coreSettings:s,hostCommunicationService:a,loggerFactory:l,rebootService:c,scenarioFactory:d}}=e;s.get(b.J.Diagnostics).enableHighMemoryRestartService&&s.get(b.J.Diagnostics).highMemoryRestartSettings&&Ex.createInstance(r,n,o,s,c,a,d,t,l,i)}}),Xx=e=>({id:"initialize-office-integration-service",job:()=>{const{coreSettings:t,client:i,hostCommunicationService:n,loggerFactory:o,entityCommanding:r,authenticationUser:s,localStorage:a,windowProvider:l}=e.context,{launchIntent:c}=t.get(b.J.HostCapabilities);t.get(b.J.People).enableOfficeIntegration&&(null==s?void 0:s.role)!==Es.w4.Anonymous&&"LaunchCoreNoSystemTray"!==c&&Hx.x.Instance(n,t,i,o,r,l,a,s).initialize()}});class Zx{constructor(e){this.localStorage=e,this.logsProviderName="LocalStorageLogsProvider"}getLogsFiles(){const e=this.localStorage.calculateUsageStats(),t=JSON.stringify({userData:Object.assign(Object.assign(Object.assign({},e.User),e.UserAndExperience),{otherTMP:Object.values(Object.assign(Object.assign({},e.Global),e.Experience)).reduce(((e,t)=>e+t),0),nonTMP:Object.values(e.Unmanaged).reduce(((e,t)=>e+t),0)})});return Promise.resolve([{fileName:"local-storage-usage.json",content:t,isPiiFree:!1}])}}var eA=i(375754);const tA=["TflFreProfileCardDisplayed","newTeamsOnlyEffectivePolicyStartTime"],iA=["policy-cache"];class nA extends Ce.i{constructor(){super(f.Yg.CreateLocalStorage,["authenticationUser","config","coreSettings","loggerFactory","logsCollectorService","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,config:i,windowProvider:n,loggerFactory:r}=e,s=new zj(t.profile.tenantId,t.profile.objectId,i.experienceName,n,r);let a;!!e.coreSettings.get(b.J.Core).disableLocalStorageLogsProvider||(a=new Zx(s),e.logsCollectorService.registerUserLogsProvider(t.profile.objectId,a));const l=r.newLogger("CreateLocalStorage","core-services-tasks"),c=(0,Ee.b4)(t);e.localStorage=s;const d=!e.coreSettings.get(b.J.Auth).isLegacyCleanupCodeFlag;return i=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if("signout"===i&&d){const t=yield function(e,t,i,n){const o={},{enableServiceSwitcher:r}=n.get(b.J.Core,["enableServiceSwitcher"]);r&&tA.push(eA.H);const s=(0,Jy.nC)(i);try{tA.forEach((t=>{const i=e.get(t,"UserAndExperience");i&&(o[t]=i)})),e.clear(["UserAndExperience","User"]),s.map((t=>e.remove(t,"Experience"))),iA.map((t=>e.remove(t,"Global")))}catch(e){t.warn(`Failed to clear local storage! ${e}`)}return o}(s,l,c,e.coreSettings);t&&function(e,t,i){const n=Object.keys(t);try{n.forEach((i=>{e.set(i,t[i],"Framework","UserAndExperience")}))}catch(e){i.warn(`Failed to restore local storage values for ${n}: ${e}!`)}}(s,t,l)}switch(i){case"quit":case"signout":a&&e.logsCollectorService.unregisterUserLogsProvider(t.profile.objectId,a.logsProviderName);new $I.I(s).clear();break;default:return}}))}))}}const oA={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataCustomNotificationsRemoveWindowMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeNotificationsWindow"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]}}]},rA={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataCustomNotificationsCreateWindowMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNotificationsWindow"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]}}]};function sA(e,t){return new Notification(e,t)}const aA=(e,t)=>`${e}/hashed/audio/${lA(t)}`,lA=e=>e?"Teams_Notification_v2-15d259a.mp3":"",cA="CN:",dA="BrowserNotifications:",uA=[U.ck.CallingNotificationRenderComplete,U.ck.MsnMeetingNotificationRenderComplete,U.ck.MeetingNudgeNotificationRenderComplete,U.ck.NormalNotificationRenderComplete,U.ck.ToastRenderCancelled,U.ck.NotificationRenderUpdate];class mA{constructor(e,t,i,n,r,s,a,l,c,d,u){this.activeWindowsService=e,this.waitForRenderingContextReady=t,this.hostCommunicationService=i,this.coreSettings=n,this.commandChangeReportingService=r,this.mainWindow=s,this.scenarioFactory=a,this.appsRegistryService=l,this.userBiService=c,this.activateBrowserToast=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t,i,n;this.mainWindow.focus();const o=e,r={entity:{type:pe.py.toasts,action:pe.uk.confirm},command:{visibilityState:ve.fe.show,stateTransition:ve.su.new,correlation:{source:k.D.NotificationsActivation,startTimestamp:Date.now(),scenarioName:U.RG.ToastActivation,id:(0,xe.v4)()}},entityOptions:o},s=null===(t=e.targetEntity.dataOptions)||void 0===t?void 0:t.userContextId;if(!s)return void(null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`${dA} Error activating browser toast. UserContextId is missing from notifications entity command dataOptions.\n      Therefore, the user rendering context to use to activate this notification cannot be determined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0));this.startToastActivationScenario(r,{isBrowserNotification:!0});const a=yield this.waitForRenderingContextReady(!1,s);yield a.commandHandler(r)})),this.logger=d.newLogger("NotificationsHandler","core-services-notifications"),this.i18n=u,this.notificationsWindowId=void 0,this.notificationsWindow=void 0,this.isWindowInInitState=!1,this.isResettingWindow=!1}activateNotification(e){var t,i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{this.sendUserBiActivation(e);const{command:n,dataOptions:o}=e;if(this.startToastActivationScenario(e),!o||!o.userContextId)return void(null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`${cA}Error activating notification. UserContextId is missing from notifications entity command dataOptions.\n      Therefore, the user rendering context to use to activate this notification cannot be determined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0));const{userContextId:r,actionType:s,callId:a,callingScenarioName:l}=o;this.sendTelemetry({callId:a,callingScenarioName:l,toastScenarioClientId:n.correlation.id,stepName:gA(s)});const c=this.waitForRenderingContextReady(!1,r),d=yield c;return yield qN({activeWindowsService:this.activeWindowsService,coreSettings:this.coreSettings,renderingContext:d,isHostCommandNotification:!0,handlerCommand:e,logger:this.logger,notificationUserContextId:r,appsRegistryService:this.appsRegistryService,logPrefix:cA}),this.addStepToToastActivationScenario(e),d.commandHandler(e)}catch(e){return void(null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,`${cA}Errored while activating notification:${e.message}`,"webclient_framework_foundation_core_services_notifications",void 0,!0))}}))}resizeNotificationsWindow({windowFeatures:e}){var t,i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.notificationsWindowId&&this.notificationsWindow&&e){const{width:n,height:o}=e;this.logger.log(`${cA}Attempting to resize the notifications window to width= ${n} height= ${o}. windowId= ${this.notificationsWindowId}`);const{enableCustomNotificationsWindowReset:r}=this.coreSettings.get(b.J.Core);0!==n&&0!==o?this.isWindowInInitState=!1:0!==n||0!==o||this.isWindowInInitState||this.isResettingWindow||!r||(this.isResettingWindow=!0,yield this.removeNotificationsWindow(),yield this.createNotificationsWindow(),this.isResettingWindow=!1);const s=yield null===(t=this.hostCommunicationService)||void 0===t?void 0:t.loadModule("toasts");null===(i=null==s?void 0:s.resizeNotificationsPanel)||void 0===i||i.call(s,n,o)}else null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,`${cA}Error resizing the notifications window. notificationsWindowId = ${this.notificationsWindowId} windowFeatures width=${null==e?void 0:e.width}; height=${null==e?void 0:e.height}. window=${void 0!==this.notificationsWindow?"defined":"undefined"}`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}))}focusNotificationsWindow(){var e,t,i,n,r,s;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const o=yield null===(e=this.hostCommunicationService)||void 0===e?void 0:e.loadModule("windowcontrols");this.notificationsWindowId?null===(t=null==o?void 0:o.focus)||void 0===t||t.call(o,this.notificationsWindowId):null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`${cA}Error focusing the notifications window. notificationsWindowId is undefined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}catch(e){null===(s=(r=this.logger).errorToTelemetry)||void 0===s||s.call(r,`${cA}Error focusing the notifications window. Loading windowcontrols module failed with: ${e.message}`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}}))}isInAppNotificationsEnabled(e){const{enableInAppNotifications:t,enableInAppNotificationsForCalls:i,enableInAppNotificationsForChatsAndChannels:n}=this.coreSettings.get(b.J.Notifications);return!!t&&this.isToastEntitySupported(!!i,!!n,e)}isCustomNotificationsEnabled(e){const{enableCustomNotificationsOnDesktop:t,enableCustomNotificationsForCalls:i,enableCustomNotificationsForChats:n}=this.coreSettings.get(b.J.Core);return!!t&&this.isToastEntitySupported(!!i,!!n,e)}initializeWithWindow(e,t,i){this.logger.log(`${cA}Initializing notifications handler with notifications windowId=${e}`),this.notificationsWindowId=e,this.notificationsWindow=t,this.client=i,this.isWindowInInitState=!0}sendCommandToHost(e,t,i,n,o){var r,s,a;let l="";l=(0,M.u4)(null===(r=null==n?void 0:n.targetEntity)||void 0===r?void 0:r.dataOptions),this.logger.log(`${cA}Sending toast command to host for display. TargetEntity type: [${null===(s=null==n?void 0:n.targetEntity)||void 0===s?void 0:s.type}] action [${null===(a=null==n?void 0:n.targetEntity)||void 0===a?void 0:a.action}] dataOptions [${l}]`),((e,t,i,n,o,r,s)=>{var a;if(s&&s.remoteAudioNotifications()){const{staticsPath:l}=e.get(b.J.Platform),c=t.id||i;if(n.visibilityState===ve.fe.show){const e=aA(l||void 0,null==r?void 0:r.ringtone),t=null!==(a=null==r?void 0:r.isIncomingCall)&&void 0!==a&&a;t&&s.setLoop(c,t),s.playNotifyAudio(c,e,t),o.log(`VDI: [handleVDIRemotedAudio] Playing remoted audio notification with id: ${c}, loop: ${t}`),r&&!0!==r.isSilent&&(r.isSilent=!0)}else n.visibilityState===ve.fe.hide&&s.pauseNotifyAudio(c)}})(this.coreSettings,i,t,e,this.logger,n,o),this.commandChangeReportingService.report({correlationId:t,type:Ae.B.NotHandled,context:{target:"notificationsHandler",entityCommand:{entity:i,command:Object.assign(Object.assign({},e),{correlation:e.correlation,layoutMode:e.layoutMode||void 0}),entityOptions:n}}})}showPermissionConfirmationBrowserNotification(){sA(this.i18n.stringTranslate("toastNotifications","browser_toast_permission_confirmation_title"),{body:this.i18n.stringTranslate("toastNotifications","browser_toast_permission_confirmation_body")})}tryShowBrowserNotification(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if("granted"!==Notification.permission)return"skippedNoPermissions";const{suppressBrowserToastWhenAppIsFocused:n}=this.coreSettings.get(b.J.Notifications,["suppressBrowserToastWhenAppIsFocused"]);if(n&&hA(this.mainWindow))return"skippedAppInFocus";const r=e.getWebToastOptions(),{notificationTitle:s,notificationOptions:a}=e.getNotificationOptionsPayload();try{const t=sA(s,a),i=()=>t;return e.registerGetNotificationCallback(i),null==t||t.addEventListener("click",(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){this.addBrowserNotificationScenarioStep(r,U.ck.BrowserToastActivated),yield this.activateBrowserToast(r)})))),this.addBrowserNotificationScenarioStep(r,U.ck.BrowserToastRequested),Promise.resolve("queued")}catch(e){return null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`${dA} Show browser notification toast failed.`,"webclient_framework_foundation_core_services_notifications",void 0,!0),Promise.resolve("skippedReasonUnknown")}}))}sendTelemetry(e){const{callId:t,callingScenarioName:i,reason:n,stepName:o,toastScenarioClientId:r}=e,s=t||"",a=this.scenarioFactory.findScenarioByNameAndId(i,s),l=this.scenarioFactory.findScenarioByNameAndId(U.RG.WebToastShow,r),c=this.scenarioFactory.findScenarioByNameAndId(U.RG.CrossClientToastView,r);null==a||a.mark(o),null==l||l.mark(o),null==c||c.mark(o),uA.includes(o)&&(null==l||l.stop({reason:n}),null==c||c.stop({reason:n}),a&&a.name===U.RG.MeetingStartedNotification&&a.stop())}sendDismissToastTelemetry({correlationId:e,toastType:t,reason:i}){const n=this.scenarioFactory.newScenario(U.RG.ToastActivation,{clientId:e});n.appendEventData({isCustomNotification:!0,mainEntityType:t}),n.stop({reason:i})}offsetNotificationsWindow(e){var t;null===(t=this.hostCommunicationService)||void 0===t||t.loadModule("toasts").then((t=>{var i,n,o,r;if(t){if(t.offsetNotificationsPanel)return t.offsetNotificationsPanel(e);null===(r=(o=this.logger).errorToTelemetry)||void 0===r||r.call(o,`${cA}toasts.offsetNotificationsPanel method not available`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}else null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`${cA}Cannot load toasts module to offset the notifications window. updating windows cache with newly created notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0)}))}sendUserBiActivation(e){LN(this.userBiService,this.logger,e,!0)}addStepToToastActivationScenario(e){const t=this.scenarioFactory.findScenarioByNameAndId(U.RG.ToastActivation,e.command.correlation.id);if(t){const i=e.command.stateTransition===ve.su.new?U.ck.StateTransitionNotOverriden:U.ck.StateTransitionOverriden;t.mark(i)}}startToastActivationScenario(e,t={}){var i;const{command:n}=e,{isBrowserNotification:o}=t,r=n.correlation.startTimestamp?+n.correlation.startTimestamp:void 0;(this.scenarioFactory.findScenarioByNameAndId(U.RG.ToastActivation,null===(i=n.correlation)||void 0===i?void 0:i.id)||this.scenarioFactory.newScenario(U.RG.ToastActivation,{startTime:r,clientId:n.correlation.id})).appendEventData({isCustomNotification:!0,mainEntityType:e.entity.type,isBrowserNotification:o})}addBrowserNotificationScenarioStep(e,t){const{crossClientScenarioName:i}=e,n=e.callId||"",o=this.scenarioFactory.findScenarioByNameAndId(i,n);null==o||o.mark(t)}removeNotificationsWindow(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.notificationsWindow&&this.client&&(null===(e=this.notificationsWindow)||void 0===e||e.close(),yield this.client.mutate({mutation:oA,fetchPolicy:"no-cache"}),this.notificationsWindowId=void 0,this.notificationsWindow=void 0,this.isWindowInInitState=!1)}))}createNotificationsWindow(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){!this.notificationsWindow&&this.client&&(yield this.client.mutate({mutation:rA,fetchPolicy:"no-cache"}))}))}isToastEntitySupported(e,t,i){var n;return(null===(n=null==i?void 0:i.targetEntity)||void 0===n?void 0:n.type)===S.dt.calls?e:t}}const gA=e=>{switch(e){case"AcceptIncomingCallContentOnly":return U.ck.AcceptIncomingCallContentOnly;case"AcceptIncomingCallWithAudio":return U.ck.AcceptIncomingCallWithAudio;case"AcceptIncomingCallWithVideo":return U.ck.AcceptIncomingCallWithVideo;case"AcceptIncomingCallThroughPrejoin":return U.ck.AcceptIncomingCallThroughPrejoin;case"AcceptIncomingScreenshareOnlyCall":return U.ck.AcceptIncomingScreenshareOnlyCall;case"IgnoreIncomingCall":return U.ck.IgnoreIncomingCall;case"RejectIncomingCall":return U.ck.RejectIncomingCall;case"ReplyIncomingCall":return U.ck.ReplyIncomingCall;case"NavigateToCallTab":return U.ck.NavigateToCallTab;case"ResumeCallTransfer":return U.ck.ResumeCallTransfer;default:return`${e}Clicked`}},hA=e=>e.document.hasFocus();class pA extends Ce.i{constructor(){super(f.Yg.CreateNotificationsHandlerTask,["activeWindowsService","appsRegistryService","commandChangeReportingService","coreSettings","hostCommunicationService","loggerFactory","scenarioFactory","waitForRenderingContextReady","windowProvider","userBiService","i18n"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,appsRegistryService:i,commandChangeReportingService:n,coreSettings:o,hostCommunicationService:r,loggerFactory:s,scenarioFactory:a,waitForRenderingContextReady:l,windowProvider:c,userBiService:d,i18n:u}=e;e.notificationsHandler=new mA(t,l,r,o,n,c,a,i,d,s,u)}))}}var vA=i(683470);class yA{constructor(e){this.userAgent=e,this.UAParser=vA.getParser(e)}getBrowser(){switch(this.UAParser.getBrowserName()){case"Microsoft Edge":return wr.AR.Edge;case"Safari":return wr.AR.Safari;case"Chrome":return wr.AR.Chrome;case"Firefox":return wr.AR.Firefox;case"Electron":return wr.AR.Electron;default:return wr.AR.Unknown}}getVendor(){var e,t;return(null===(t=null===(e=this.UAParser.getPlatform())||void 0===e?void 0:e.vendor)||void 0===t?void 0:t.toString())||""}getOSDetails(){const e=this.UAParser.getOS();return{name:null==e?void 0:e.name,version:null==e?void 0:e.version,versionName:null==e?void 0:e.versionName}}getBrowserVersion(){return this.UAParser.getBrowserVersion()}getRingConfig(e=yt.s.prod,t){switch(t){case"ring0_gcc":t="ring0",e=yt.s.gcc;break;case"general_gcc":t="general",e=yt.s.gcc}return{ring:t,environment:e}}getOsPlatform(){const e=this.getOsOverride();if(null!=e)return e;switch(this.UAParser.getOSName()){case"Windows":return wr.NR.Windows;case"macOS":return wr.NR.Mac;case"Linux":return wr.NR.Linux;case"Chrome OS":return wr.NR.ChromeOS;case"Android":return wr.NR.Android;case"iOS":return wr.NR.IOS;case"Windows Phone":return wr.NR.WindowsPhone;default:return wr.NR.Unknown}}getOSPlatformVersion(){var e,t;return(null===(t=null===(e=this.host)||void 0===e?void 0:e.deviceInfo)||void 0===t?void 0:t.osVersion)||this.UAParser.getOSVersion()}getOsOverride(){return null}getPlatformId(e,t){let i=this.getClientType(e,t);const n=this.getMetaOsPlatformId(e);return n||(i===wr.Bh.Desktop&&this.getOsPlatform()===wr.NR.Mac&&(i="Mac"),i=`${i[0].toUpperCase()}${i.substr(1)}`,wr.us[i])}getMetaOsPlatformId(e){var t;switch(null===(t=null==e?void 0:e.metaoshost)||void 0===t?void 0:t.toLowerCase()){case"office":return wr.us.MetaOsOffice;case"outlook":return wr.us.MetaOsOutlook}return null}getClientType(e,t){let i=e&&e.host;if(!i&&t){const e="host";i=t.localStorage.getItem(e)||""}return"outlookDesktop"===i?wr.Bh.Desktop:"outlookWeb"===i?wr.Bh.Web:this.getBrowser()===wr.AR.Electron?wr.Bh.Desktop:wr.Bh.Web}getCpuArchitecture(){let e;const t=/x\d{2}_\d{2}|(i[3-6]86|x\d{2}|amd\d{2}|wow\d{2}|arm\d{2}|arm|ARM|aarch\d{2}|ppc\d{2}|ppc\d{2}le)|Intel|Android\s+\d+\.\d+\.\d+;\s*(\S+)/;try{e=this.userAgent.match(t)}catch(e){return""}return(null==e?void 0:e[0])||""}}class fA extends yA{constructor(e,t,i,n,o){super(i.navigator.userAgent),this.loggerFactory=e,this.routingServices=t,this.windowHost=i,this.hostSettings=n,this.getPlatformConfigurationOverrides=o,this.fullBrowserVersionUpdated=!1,this.logger=this.loggerFactory.newLogger("PlatformService","core-services-platform"),this.queryStringParameters=this.routingServices.state.getSearchState()||{},this.headConfig=(0,SE.pf)(this.windowHost,this.logger),this.cachedConfig=this.computeConfig(),this.cachedEcsOverrides=this.computeEcsOverrides()}get config(){return this.cachedConfig}get ecsOverrides(){return this.cachedEcsOverrides}get host(){var e,t;const i=null===(t=null===(e=this.windowHost.loader)||void 0===e?void 0:e.getProperties)||void 0===t?void 0:t.call(e);return Object.assign({bootType:(null==i?void 0:i.bootType)||w.Hs.Unknown,deviceId:(null==i?void 0:i.deviceId)||rt.get("deviceId"),deviceInfo:null==i?void 0:i.deviceInfo,hostAppVersion:(0,SE.nU)(this.windowHost),sessionId:(null==i?void 0:i.sessionId)||rt.get("sessionId"),preAuthUserId:null==i?void 0:i.preAuthUserId},this.windowHost.getHostedWindowContext())}updateAsyncPlatformInfo(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!(this.fullBrowserVersionUpdated||void 0===this.cachedConfig.browserVersion||this.cachedConfig.browserVersion.indexOf(".0.0.0")<0)){this.fullBrowserVersionUpdated=!0;try{let e;if(!this.windowHost.navigator||!("userAgentData"in this.windowHost.navigator))return;e=this.windowHost.navigator.userAgentData;const t=yield e.getHighEntropyValues(["fullVersionList"]);if(t&&t.fullVersionList&&t.fullVersionList.length>0)for(const e of t.fullVersionList)if(e.brand.toUpperCase().indexOf(this.cachedConfig.browser.toUpperCase())>=0){this.cachedConfig.browserVersion=e.version||this.cachedConfig.browserVersion;break}}catch(i){null===(t=(e=this.logger).errorNoPii)||void 0===t||t.call(e,`Fetching full browser version failed: ${this.cachedConfig.browser} - ${this.cachedConfig.browserVersion||""}`)}}}))}getOsOverride(){return this.windowHost.localStorage.getItem("platformOverride")}computeConfig(){var e,t,i,n,o,r,s,a,l;let c={};this.getPlatformConfigurationOverrides&&(c=this.getPlatformConfigurationOverrides(this.windowHost,this.queryStringParameters)),this.logger.log(`IPlatformConfiguration overrides: ${JSON.stringify(c)}`);const d=this.getBrowser(),u=null!==(e=c.clientType)&&void 0!==e?e:this.getClientType(this.queryStringParameters,this.windowHost),m=this.determinePlatformId(c);this.logger.log(`Determined PlatformID to be '${m}'`);const g=this.getHostingParent(),h=this.windowHost.__VERSION__,p=`${m}/${h}`,v=this.windowHost.__webpack_public_path__,y=this.getVendor(),f=this.getOSDetails(),S=this.getCpuArchitecture();let k="https://statics.teams.cdn.office.net";try{v&&(k=new URL(v).origin)}catch(e){this.logger.warn(`Failed to parse dynamic staticsPath origin from '${v}'`)}const b=this.windowHost.navigator.language||"en-us",w=null===(t=this.windowHost.loaderConfig)||void 0===t?void 0:t.pullRequestId,C=null===(i=this.windowHost.loaderConfig)||void 0===i?void 0:i.buildId;this.logger.log(`PlatformService: configuring with clientVersion: ${p}`);const _=null===(s=null===(r=null===(o=null===(n=this.windowHost.loader)||void 0===n?void 0:n.getProperties)||void 0===o?void 0:o.call(n))||void 0===r?void 0:r.deviceInfo)||void 0===s?void 0:s.browserVersion;return _&&(this.fullBrowserVersionUpdated=!0),{browser:d,browserVersion:_||this.getBrowserVersion(),buildType:(0,SE.Cu)(p),buildVersion:h,clientContext:this.getClientContext(g),clientType:u,clientVersion:p,cpuArchitecture:S,currentUrl:null===(l=null===(a=this.windowHost)||void 0===a?void 0:a.location)||void 0===l?void 0:l.href,hostingParent:g,isInCypressFrame:this.getIsInCypressFrame(),isInIframe:this.getIsInIframe(),isInternalUser:this.headConfig.isInternalUser,osDetails:f,osPlatform:this.getOsPlatform(),osVersion:this.getOSPlatformVersion(),platformId:m,publicPath:v,staticsPath:k,userAgent:this.userAgent,userLanguage:b,vdi:c.vdi,vendor:y,getLocaleInfoAsync:this.windowHost.getLocaleInfoAsync,pullRequestId:w,buildId:C}}determinePlatformId(e){var t,i,n,o,r,s,a,l,c,d,u;const m=e.platformId,g=null===(i=null===(t=this.hostSettings)||void 0===t?void 0:t.hostSettings)||void 0===i?void 0:i.platformId;if(null===(o=(n=this.logger).logNoPii)||void 0===o||o.call(n,`Potential PlatformID sources: experienceOverrides='${m}', hostSettings='${g}', qsp='${JSON.stringify(this.queryStringParameters)}', windowHostHost='${null===(r=this.windowHost)||void 0===r?void 0:r.localStorage.getItem("host")}'`),m)return null===(a=(s=this.logger).logNoPii)||void 0===a||a.call(s,"Using PlatformID value from experience overrides"),m;if(g){const e=parseInt(g,10);if(e)return null===(c=(l=this.logger).logNoPii)||void 0===c||c.call(l,"Using PlatformID value from host settings"),e}return null===(u=(d=this.logger).logNoPii)||void 0===u||u.call(d,"Using PlatformID value from QSP/WindowHost/Browser"),this.getPlatformId(this.queryStringParameters,this.windowHost)}getHostUrl(){const e=this.windowHost.localStorage.getItem("ecsHostUrl")||this.headConfig.ecsHostUrl;if(e)return new URL(e,this.windowHost.location.origin).href}computeEcsOverrides(){const e=this.getHostUrl(),t=this.getEnvironmentOverride()||(0,SE.zj)(this.windowHost,this.headConfig),i=(0,L.get)(yt.s,t),n=this.getRingOverride(),{originalRing:o,unauthenticated:r}=this.headConfig,s=void 0===o||o===n;return Object.assign(Object.assign({hostUrl:e},this.getRingConfig(i,n)),{originalRing:o,unauthenticated:r,isAssignedRing:s})}getEnvironmentOverride(){if(this.queryStringParameters.webinarRing)return this.queryStringParameters.webinarRing}getRingOverride(){if(this.headConfig.isInternalUser&&this.queryStringParameters.ring)return this.queryStringParameters.ring;const e=this.windowHost.getHostedWindowContext();if(null==e?void 0:e.ring)return e.ring;const{ring:t}=this.headConfig;return t?"string"==typeof t?t:t.id:void 0}getHostingParent(){const e=(0,SE.f2)(this.windowHost);return e&&e.dataset&&"outlook"===e.dataset.host?wr.GJ.Outlook:wr.GJ.Unknown}getClientContext(e){return e===wr.GJ.Outlook?wr.RY.Embed:void 0}getIsInIframe(){return!!this.windowHost.getHostedWindowContext().isInIframe}getIsInCypressFrame(){return!!this.windowHost.getHostedWindowContext().isInCypressFrame}}class SA extends Ce.i{constructor(){super(f.Yg.CreatePlatform,["windowProvider","loggerFactory","routingServices"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{windowProvider:t,loggerFactory:i,routingServices:n,hostSettings:o,getPlatformConfigurationOverrides:r}=e,s=new fA(i,n,t,o,r);yield s.updateAsyncPlatformInfo(),e.platformService=s}))}}var kA=i(422325),bA=i(375823);const wA="Profiler:: ";var CA,_A;!function(e){e.LoadModuleProfilerFailed="LoadModuleProflierFailed",e.ExecuteCommandFailed="ExecuteCommandFailed"}(CA||(CA={})),function(e){e.LoadModuleProfilerSuccess="LoadModuleProfilerSuccess",e.ExecuteCommandSuccess="ExecuteCommandSuccess"}(_A||(_A={}));class TA{constructor(e,t,i){this.hostCommunicationService=t,this.coreSettings=i,this.logger=e.newLogger("ProfilerService","services-io-profiler"),this.exposeToCoreWindow(),this.injectFakeRegression()}getMemoryData(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=(null===(t=null===(e=this.coreSettings.get(b.J.Telemetry).heartbeatConfiguration)||void 0===e?void 0:e.workerMetricsCollection)||void 0===t?void 0:t.enabled)||!1,n=yield(0,kA.K)(this.hostCommunicationService,this.logger,i);return(0,bA.Mv)(n.processes)}))}getHeapSnapshot(e=!0){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.getProfilerModuleAsync();if(!i)return;e&&(yield this.requestTriggerGC());const n=yield null===(t=i.getHeapSnapshot)||void 0===t?void 0:t.call(i);return(null==n?void 0:n.snapshot)?n.snapshot:void 0}))}requestTriggerGC(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.getProfilerModuleAsync();if(!t)return!1;const i=yield null===(e=t.triggerGC)||void 0===e?void 0:e.call(t);return!!(null==i?void 0:i.status)}))}getProfilerModuleAsync(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let e;try{e=yield this.hostCommunicationService.loadModule("profiler"),this.logger.log(`${wA}${_A.LoadModuleProfilerSuccess}`)}catch(e){this.logger.error(`${wA}${CA.LoadModuleProfilerFailed} ${(0,M.u4)(e)}`)}return e}))}exposeToCoreWindow(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.hostCommunicationService.loadModule("profiler"),t=yield this.hostCommunicationService.loadModule("heartbeat");e&&t?globalThis.window.profiler=Object.assign(Object.assign({},e),{getMemoryData:()=>this.getMemoryData(),getHeapSnapshot:(e=!1)=>this.getHeapSnapshot(e),getTotalWorkingSetSizeBytes:()=>this.getWorkingSetSizeFromProcesses(null==t?void 0:t.getPerfMetrics),getTotalCommitSizeBytes:()=>this.getCommitSizeFromProcesses(null==t?void 0:t.getPerfMetrics)}):this.logger.log("HostComms is unable to load profiler and/or heartbeat module. We are running on Web or Teams 1.0. Bailing out.")}))}getWorkingSetSizeFromProcesses(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e){const t=yield e();return null==t?void 0:t.reduce(((e,t)=>(e.workingSetSizeBytes+=t.workingSetSizeBytes,e)),{workingSetSizeBytes:0}).workingSetSizeBytes}return this.logger.warn("Unable to get perf metrics."),-1}))}getCommitSizeFromProcesses(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e){const t=yield e();return null==t?void 0:t.reduce(((e,t)=>(e.pageFileUsageBytes+=t.pageFileUsageBytes,e)),{pageFileUsageBytes:0}).pageFileUsageBytes}return this.logger.warn("Unable to get perf metrics."),-1}))}injectFakeRegression(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){globalThis.window.fakeRegression=new Array(262144).fill(0)}))}}class IA extends Ce.i{constructor(){super(f.Yg.CreateProfiler,["loggerFactory","hostCommunicationService","coreSettings"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.profilerService=new TA(e.loggerFactory,e.hostCommunicationService,e.coreSettings)}))}}class jA{constructor(e,t,i,n,o,r,s,a,l,d){this.loggerFactory=e,this.host=t,this.clientStateProvider=i,this.networkStateProvider=n,this.platformService=o,this.hostCommunicationService=a,this.localStorage=l,this.scenarioFactory=d,this.cleanupOnRebootArray=[],this.expChangeSubscription=null,this.lcChangeSubscription=null,this.clientStateSubscription=null,this.isRunningJobsInLongInactive=!1,this.rebootPending=void 0,this.registerCleanupCallback=e=>{this.cleanupOnRebootArray.push(e)},this.didUrlChange=e=>(0,Cr.IC)(e)!==(0,Cr.IC)(this.host.location.href),this.areMaxRetriesExhausted=(e,t)=>{if(null==t?void 0:t.maxRetries){const i=this.getRetryStorageKey(e),n=this.localStorage.get(i,"Experience"),o=n&&parseInt(n,10)||0;this.logger.debug(`Reboot retry count for '${e}': ${o}`);const r=o>=t.maxRetries;return this.localStorage.set(i,`${o+1}`,"Framework","Experience"),r&&this.logger.warn(`Max retries exhausted for '${e}', retryCount: ${o}, maxRetries: ${t.maxRetries}`),r}return!1},this.getRetryStorageKey=e=>`rebootRetries.${e}`,this.logger=this.loggerFactory.newLogger("rebootService","core-services-reboot"),this.expChangeSubscription=r.observeChanges().pipe((0,c.U)((e=>{this.isExperienceIdleStateChangedEvent(e)&&(this.isRunningJobsInLongInactive=!0)}))).subscribe(),this.lcChangeSubscription=s.observeChanges().pipe((0,c.U)((({context:e})=>{const{target:t,reportedChange:i}=e;if(this.isRunningJobsInLongInactive&&t===LE.UserLifeCycleManager&&this.isExperienceIdleStateChangedEvent(i)&&(this.isRunningJobsInLongInactive=!1,this.rebootPending)){this.host.clearTimeout(this.timeoutId),this.logger.log("Core finished running App jobs in LongInactive client state. Issuing pending reboot now...");const{reason:e,commandSource:t,options:i}=this.rebootPending;this.rebootApp(e,t,i)}}))).subscribe()}rebootApp(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(yield this.cleanupBeforeReboot(),this.logger.log(`Reboot app triggered for ${e} from ${t} with options: ${(0,M.u4)(i)}`),this.areMaxRetriesExhausted(t,i))return!1;try{this.dispose();const n=this.scenarioFactory.findScenario(U.RG.ClientStart);null==n||n.incomplete({commandSource:t,reason:e});const o=this.getReloadUrl(i,t,e);this.platformService.config.clientType===wr.Bh.Maglev?yield this.rebootThroughDesktopApi(o,t,e,"reboot_maglev_request"):this.platformService.config.clientType===wr.Bh.Desktop&&e===ns.Z.AuthTokenForceRefresh?yield this.rebootThroughDesktopApi(o,t,e,"reboot_t1_request"):this.didUrlChange(o)?this.host.location.replace(o):this.host.location.reload()}catch(e){return this.logger.error("Reboot app failed"),!1}return!0}))}rebootWhenLongInactive(e,t,i){return this.clientStateSubscription?(this.logger.log(`Reboot subscription already exist, skip the subscription from ${t} with reason ${e}`),!1):(this.logger.log(`Reboot when longInactive is subscribed from ${t} with reason ${e}`),this.clientStateSubscription=this.clientStateProvider.observe().subscribe((n=>this.handleClientStateChange(n,e,t,i))),!0)}clearRetryCount(e){this.localStorage.remove(this.getRetryStorageKey(e),"Experience")}dispose(){var e,t,i;this.isRunningJobsInLongInactive=!1,this.rebootPending=void 0,this.timeoutId&&(this.host.clearTimeout(this.timeoutId),this.timeoutId=void 0),null===(e=this.clientStateSubscription)||void 0===e||e.unsubscribe(),this.clientStateSubscription=null,null===(t=this.expChangeSubscription)||void 0===t||t.unsubscribe(),this.expChangeSubscription=null,null===(i=this.lcChangeSubscription)||void 0===i||i.unsubscribe(),this.lcChangeSubscription=null}cleanupBeforeReboot(){var e,t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let n,o,r;for(;n=this.cleanupOnRebootArray.pop();)try{yield n("restart")}catch(e){o=o?o.concat(`${n.toString()}::${(0,M.u4)(e)}`):`${n.toString()}::${(0,M.u4)(e)}::`}o&&(r=new Ne.G(Ne.$.CLEANUP,new Error(o)),null===(t=(e=this.logger).errorToTelemetry)||void 0===t||t.call(e,`${r.code}${null===(i=r.prevError)||void 0===i?void 0:i.message}`,"webclient_framework_foundation_core_services",void 0,!0))}))}rebootThroughDesktopApi(e,t,i,n){var r,s,a,l,c,d,u;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield this.hostCommunicationService.loadModule("core");if(!o)return void(null===(s=(r=this.logger).errorToTelemetry)||void 0===s||s.call(r,"HostComms is unable to load core module.",n,void 0,!0));const m=`${i}; source: ${ns.d[t]}`;null===(l=(a=this.logger).infoToTelemetry)||void 0===l||l.call(a,m,n,void 0,!0);try{yield null===(c=o.relaunch)||void 0===c?void 0:c.call(o,{url:e,reason:m})}catch(e){null===(u=(d=this.logger).errorToTelemetry)||void 0===u||u.call(d,`${m} PIE API call failed`,n,void 0,!0)}}))}handleClientStateChange(e,t,i,n){this.networkStateProvider.getState()===Ys.G.Online?(this.logger.log(`Handling clientState change to ${e}.`),e===_e.pk.LongInactive&&(this.rebootPending={reason:t,commandSource:i,options:n},this.isRunningJobsInLongInactive?this.waitForRunningJobsAndReboot():this.rebootApp(t,i,n))):this.logger.log(`Reboot skipped, network state is offline when client state change to ${e}.`)}getReloadUrl(e,t,i){var n;const o=new URL((null==e?void 0:e.customUrl)||this.host.location.href),r=o.searchParams;(null===(n=null==e?void 0:e.qsps)||void 0===n?void 0:n.hasOwnProperty("clearcontainer"))&&r.delete("container"),r.delete("tenantId"),o.hash=this.getReloadHash(t,i,o.hash);const s=(null==e?void 0:e.qsps)||{};return Object.keys(s).forEach((e=>{r.set(e,s[e])})),o.toString()}getReloadHash(e,t,i){if(this.platformService.config.clientType===wr.Bh.Maglev){const n=ws(i);let o;if(n.deepLink===is.n0.core)o=is.n0.core;else switch(e){case ns.d.WebClientUpdateService:o=is.n0.core;break;case ns.d.ReloadAppTask:o=!n.deepLink||n.deepLink===is.n0.flyout||t!==ns.Z.RingSwitch&&t!==ns.Z.HighMemory?is.n0.default:encodeURIComponent(n.deepLink);break;default:o=is.n0.default}return`deepLink=${o}&source=${ns.d[e]}`}return""}waitForRunningJobsAndReboot(){this.logger.log("Pending a reboot while waiting for Core to finish running App jobs in LongInactive client state. timeout=2000 ms"),this.timeoutId=this.host.setTimeout((()=>{if(this.host.clearTimeout(this.timeoutId),this.rebootPending){this.logger.log("Timeout waiting for Core to finish running App jobs in LongInactive client state. Rebooting now...");const{reason:e,commandSource:t,options:i}=this.rebootPending;this.rebootApp(e,t,i)}}),2e3)}isExperienceIdleStateChangedEvent(e){return e.type===ft.yU.ExperienceIdleStateChanged&&e.context.isIdle}}class NA extends Ce.i{constructor(){super(f.Yg.CreateReboot,["clientState","experienceChangeReportingService","hostCommunicationService","lifeCycleScopeChangeReportingService","localStorage","loggerFactory","networkState","platformService","scenarioFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{clientState:t,experienceChangeReportingService:i,hostCommunicationService:n,lifeCycleScopeChangeReportingService:o,localStorage:r,loggerFactory:s,networkState:a,platformService:l,scenarioFactory:c,windowProvider:d}=e;e.rebootService=new jA(s,d,t,a,l,i,o,n,r,c)}))}}var EA=i(995714),xA=i(460193);class AA extends Ce.i{constructor(){super(f.Yg.CreateRouting,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=e.config.forceUseBrowserHistory||!e.windowProvider||""===e.windowProvider.location.hash?(0,EA.lX)({basename:e.config.basePath}):(0,EA.q_)({basename:e.config.basePath});e.history=t,e.routingServices=(0,xA.I)(e.loggerFactory,e.history,e.windowProvider&&e.windowProvider.location)}))}}class DA{constructor(e,t){this.statsPerIdMap=new Map,this.startTimeMap=new Map,this.telemetryReportInterval=0,this.globalStats={maxInQueueTaskCount:0,totalLatencyTime:0,executedTaskCount:0,maxLatency:0,reportSequence:0,queueSize:0},this.logger=e.newLogger("PostTaskSchedulerDiagnosticsService","core-services-scheduling"),this.host=t}subscribeToCoreSettings(e){e.getObservable(b.J.Core,["schedulerTelemetryIntervalMS"]).subscribe((e=>{if(e.schedulerTelemetryIntervalMS){const t=e.schedulerTelemetryIntervalMS;this.telemetryReportInterval!==t&&(this.telemetryReportInterval=t,this.initializeTelemetryReporter(t))}}))}markTaskEnqueued(e,t){this.startTimeMap.set(e,performance.now());let i=this.statsPerIdMap.get(t);i||(i={executedTaskCount:0,maxLatency:-1,totalLatencyTime:0,totalLatencyTimeThisReport:0}),this.statsPerIdMap.set(t,i),this.globalStats.queueSize++,this.globalStats.queueSize>this.globalStats.maxInQueueTaskCount&&(this.globalStats.maxInQueueTaskCount=this.globalStats.queueSize)}markTaskDequeued(e,t){const i=this.statsPerIdMap.get(t),n=this.startTimeMap.get(e);if(!n)return;this.startTimeMap.delete(e),this.globalStats.executedTaskCount++,this.globalStats.queueSize--;const o=Math.round(performance.now()-n);this.globalStats.totalLatencyTime+=o,o>this.globalStats.maxLatency&&(this.globalStats.maxLatency=o),i&&(i.totalLatencyTime+=o,i.totalLatencyTimeThisReport+=o,i.executedTaskCount++,o>i.maxLatency&&(i.maxLatency=o))}initializeTelemetryReporter(e){this.clearTelemetryInterval(),e>=6e4&&(this.telemetryIntervalId=this.host.setInterval((()=>this.reportTelemetry()),e))}clearTelemetryInterval(){this.telemetryIntervalId&&(this.host.clearInterval(this.telemetryIntervalId),this.telemetryIntervalId=0)}reportTelemetry(){var e,t;0!==this.globalStats.maxInQueueTaskCount&&(null===(t=(e=this.logger).infoToTelemetry)||void 0===t||t.call(e,"send-log-to-console-and-diagnostics","webclient_framework_foundation_post_task_scheduler_diagnostics",{maxSchedulerWaitLatency:this.globalStats.maxLatency,maxSchedulerQueueSize:this.globalStats.maxInQueueTaskCount,totalTaskWaitLatency:this.globalStats.totalLatencyTime,totalExecutedTaskCount:this.globalStats.executedTaskCount,sequence:this.globalStats.reportSequence}),this.statsPerIdMap.forEach(((e,t)=>{var i,n;null===(n=(i=this.logger).infoToTelemetry)||void 0===n||n.call(i,`send-log-to-console-and-diagnostics-${t}`,"webclient_framework_foundation_post_task_scheduler_diagnostics",{maxSchedulerWaitLatency:e.maxLatency,totalTaskWaitLatency:e.totalLatencyTime,totalExecutedTaskCount:e.executedTaskCount,sequence:this.globalStats.reportSequence}),e.totalLatencyTimeThisReport=0})),this.globalStats.reportSequence++)}}class FA extends Ce.i{constructor(){super(f.Yg.CreateSchedulerTask,["schedulerChangeReporting","loggerFactory","diagnosticsService","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{diagnosticsService:t,loggerFactory:i,schedulerChangeReporting:n,windowProvider:o}=e,r=new DA(i,o),s=new wo(n,window,i,f.QU,r);e.postTaskSchedulerDiagnosticsService=r,e.scheduler=s,t.setScheduler(s)}))}}class OA{constructor(e,t,i,n,r,s,a,l){this.experienceChangeReportingService=e,this.commandChangeReportingService=t,this.appsRegistryService=i,this.scheduler=n,this.hostComms=r,this.userKey=s,this.context=a,this.activeWindowsService=l,this.mainWindowDisplayedChange={windowId:null,eventFired:!1},this.processExperienceChangeChange=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){e.type===ft.yU.UserConsentedToConsumeResources&&(this.layoutRenderedChange&&(this.layoutRenderedChange=void 0),this.userConsentedChange=e),e.type===ft.FV.LayoutRenderComplete&&!0===e.isMainWindow&&(this.layoutRenderedChange=e),this.tryToSendSignal()})),this.onWindowVisibilityChanged=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t;const i=yield this.isMainWindowForActiveUserContext(e.windowId);if(!e.visible||this.mainWindowDisplayedChange&&(null===(t=this.mainWindowDisplayedChange)||void 0===t?void 0:t.eventFired))e.visible||(i&&(this.mainWindowDisplayedChange.windowState=yield this.getWindowState(e.windowId)),this.mainWindowDisplayedChange.eventFired=!1,this.mainWindowDisplayedChange.windowId=null);else{if(!i)return;this.mainWindowDisplayedChange.windowId=e.windowId,this.tryToSendSignal()}}))}init(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.experienceChangeReportingServiceSubscription=this.experienceChangeReportingService.observeChanges().pipe((0,u.h)((e=>e.userContextId===this.userKey))).subscribe(this.processExperienceChangeChange),this.commandChangeReportingServiceSubscription=this.commandChangeReportingService.observeChanges().pipe((0,u.h)((e=>e.userContextId===this.userKey&&!!e.isMainWindow&&e.type===Ae.B.WindowCreated&&e.context.layoutMode===ve.lO.standard))).subscribe((e=>{this.mainWindowRenderedChange=e,this.tryToSendSignal()}));const t=yield this.hostComms.loadModule("windowcontrols");this.windowVisibilityChangeSubscription=null===(e=null==t?void 0:t.registerForWindowVisibilityChanged)||void 0===e?void 0:e.call(t,this.onWindowVisibilityChanged)}))}dispose(){this.experienceChangeReportingServiceSubscription&&this.experienceChangeReportingServiceSubscription.unsubscribe(),this.commandChangeReportingServiceSubscription&&this.commandChangeReportingServiceSubscription.unsubscribe(),this.windowVisibilityChangeSubscription&&this.windowVisibilityChangeSubscription()}tryToSendSignal(){if(!this.shouldSendSignal())return;const e=this.appsRegistryService.registeredApps;this.scheduler.schedule((()=>{e.forEach((e=>{e.UNSAFE_onSignal&&e.UNSAFE_onSignal({type:"main_window_rendered",userContextId:this.userKey},this.context)}))}),{id:"on-signal-job",priority:Z.vW.Macro,scheduledById:"signal-processor"},(0,xe.v4)()),this.reset()}isMainWindowForActiveUserContext(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=this.activeWindowsService.enableDecoupleCommandingFromApollo?this.activeWindowsService.getStandardMainWindow():yield(0,_s.jW)(this.context.client);return e===(null==t?void 0:t.id)&&t.userContextId===this.userKey}))}getWindowState(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.hostComms.loadModule("windowcontrols");return null===(t=null==i?void 0:i.getWindowState)||void 0===t?void 0:t.call(i,e)}))}shouldSendSignal(){return this.windowHasBeenCreatedAndSignalsHaveFired()||this.windowHasToggledVisibilityAndWasNotMinimizedOrRestored()}windowHasBeenCreatedAndSignalsHaveFired(){return!!this.userConsentedChange&&!!this.mainWindowRenderedChange&&!!this.layoutRenderedChange}windowHasToggledVisibilityAndWasNotMinimizedOrRestored(){return!(!this.userConsentedChange||!this.mainWindowDisplayedChange.windowId||this.mainWindowDisplayedChange.eventFired||this.windowWasMinimized())}windowWasMinimized(){var e;return!0===(null===(e=this.mainWindowDisplayedChange.windowState)||void 0===e?void 0:e.minimized)}reset(){this.mainWindowRenderedChange=void 0,this.layoutRenderedChange=void 0,this.mainWindowDisplayedChange.eventFired=!0}}class MA extends Ce.i{constructor(){super(f.Yg.CreateSignalProcessor,["activeWindowsService","appsRegistryService","experienceChangeReportingService","client","coreSettings","entityCommanding","loggerFactory","platformService","scenarioFactory","scheduler","hostCommunicationService","commandChangeReportingService","authenticationUser","userBiService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,appsRegistryService:i,experienceChangeReportingService:n,client:o,coreSettings:r,entityCommanding:s,loggerFactory:a,platformService:l,scenarioFactory:c,scheduler:d,hostCommunicationService:u,commandChangeReportingService:m,authenticationUser:g,userBiService:h}=e,p=new OA(n,m,i,d,u,(0,Ee.b4)(g),{client:o,coreSettings:r,entityCommanding:s,loggerFactory:a,platformService:l,scenarioFactory:c,userBiService:h},t);return p.init(),()=>{p.dispose()}}))}}var RA=i(990489);class PA extends Ce.i{constructor(){super(f.Yg.CreateShortcutExecutionServiceTask,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.shortcutExecutionService=new RA.T}))}}class LA{constructor(e){this._loggerFactory=e,this._logger=this._loggerFactory.newLogger("app-wide-shortcut-registry","core-shortcut-service"),this._registeredShortcuts=[]}addAppWideShortcut(e,t,i,n){this._logger.log(`Adding application wide shortcut for command ${t} and shortuct ${e}. ${this._registeredShortcuts.length} shortcuts active`),this._registeredShortcuts=this._registeredShortcuts.filter((t=>t.hotkey!==e)),this._registeredShortcuts.push({commandId:t,commandHandler:i,hotkey:e,windowId:n}),this._logger.log(`Added app wide shortcutfor command ${t} and hotkey ${e}. ${this._registeredShortcuts.length} shortcuts active`)}removeAppWideShortcut(e){this._logger.log(`Removing app wide shortcutfor commandId ${e}. ${this._registeredShortcuts.length} shortcuts active`),this._registeredShortcuts=this._registeredShortcuts.filter((t=>t.commandId!==e)),this._logger.log(`Removed app wide shortcut for command ${e}. ${this._registeredShortcuts.length} shortcuts active`)}getAppWideShortcutHandler(e){var t;return null===(t=this._registeredShortcuts.find((t=>t.hotkey===e)))||void 0===t?void 0:t.commandHandler}destroy(e){this._registeredShortcuts=this._registeredShortcuts.filter((t=>t.windowId!==e))}}class UA{constructor(e,t){this._loggerFactory=e,this._hostCommunicationService=t,this._logger=this._loggerFactory.newLogger("global-shortcut-registry","core-shortcut-service"),this._registeredGlobalShortcuts=[]}addGlobalShortcut(e,t,i){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=(e=>e.windows)(e),s=0===this._registeredGlobalShortcuts.length;this._logger.log(`Adding global shortcut for command ${t} and shortuct ${o}. ${this._registeredGlobalShortcuts.length} shortcuts active`);const a=yield this._hostCommunicationService.loadModule("globalshortcuts");if(!a)return;const l=this._registeredGlobalShortcuts.filter((e=>e.keys===o));if(l.length>0){this._logger.log("Global shortcut already registered, removing");for(const e of l)yield null===(n=null==a?void 0:a.removeGlobalShortcut)||void 0===n?void 0:n.call(a,e.shortcutId),this._logger.log(`Removed global shortcut for command ${t} and shortuct ${o}`),this._registeredGlobalShortcuts=this._registeredGlobalShortcuts.filter((t=>t.shortcutId!==e.shortcutId))}const c=yield null===(r=null==a?void 0:a.addGlobalShortcut)||void 0===r?void 0:r.call(a,e);return c&&(this._registeredGlobalShortcuts.push({commandId:t,shortcutId:c,commandHandler:i,keys:o}),this._logger.log(`Added global shortcut for command ${t} and shortuctId ${c}. ${this._registeredGlobalShortcuts.length} shortcuts active`),s&&(this._logger.log("First global shortcut added, registering callback"),yield this.registerForGlobalShortcutActivated())),c}))}removeGlobalShortcut(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this._logger.log(`Removing global shortcut for commandId ${e}. ${this._registeredGlobalShortcuts.length} shortcuts active`);const i=this._registeredGlobalShortcuts.filter((t=>t.commandId===e));i.length>0&&(this._removeGlobalShortcuts(i),this._logger.log(`Removed ${i.length} global shortcut for command ${e}. ${this._registeredGlobalShortcuts.length} shortcuts active`)),0===this._registeredGlobalShortcuts.length&&(this._logger.log("Last global shortcut removed, disposing registration"),null===(t=this._disposeGlobalShortcutActivatedEventRegistration)||void 0===t||t.call(this),this._disposeGlobalShortcutActivatedEventRegistration=void 0)}))}registerForGlobalShortcutActivated(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this._disposeGlobalShortcutActivatedEventRegistration)return;const t=yield this._hostCommunicationService.loadModule("globalshortcuts");t&&(this._disposeGlobalShortcutActivatedEventRegistration=null===(e=null==t?void 0:t.registerForGlobalShortcutActivated)||void 0===e?void 0:e.call(t,(e=>this._handleGlobalShortcut(e))))}))}cleanup(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this._disposeGlobalShortcutActivatedEventRegistration&&(this._disposeGlobalShortcutActivatedEventRegistration(),this._disposeGlobalShortcutActivatedEventRegistration=void 0),yield this._removeGlobalShortcuts(this._registeredGlobalShortcuts),this._registeredGlobalShortcuts=[]}))}_removeGlobalShortcuts(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this._hostCommunicationService.loadModule("globalshortcuts");if(i)for(const n of e)this._logger.log(`Removing global shortcut for commandId ${n.commandId} with keys ${n.keys}`),yield null===(t=null==i?void 0:i.removeGlobalShortcut)||void 0===t?void 0:t.call(i,n.shortcutId),this._logger.log(`Removed global shortcut for command ${n.commandId}`),this._registeredGlobalShortcuts=this._registeredGlobalShortcuts.filter((e=>e.shortcutId!==n.shortcutId))}))}_handleGlobalShortcut(e){const t=this._registeredGlobalShortcuts.find((t=>t.shortcutId===e));t?(this._logger.debug(`Executing command handler for global shortcut: ${t.commandId} / ${t.shortcutId}`),t.commandHandler()):this._logger.warn(`Can't execute global shortcut with id ${e}. No record found.`)}}class WA{constructor(e,t,i,n){this._hostCommunicationService=e,this._loggerFactory=t,i&&(this._appWideShortcutRegistry=new LA(t)),n&&(this._globalShortcutRegistry=new UA(this._loggerFactory,this._hostCommunicationService))}addAppWideShortcut(e,t,i,n){var o;null===(o=this._appWideShortcutRegistry)||void 0===o||o.addAppWideShortcut(e,t,i,n)}removeAppWideShortcut(e){var t;null===(t=this._appWideShortcutRegistry)||void 0===t||t.removeAppWideShortcut(e)}getAppWideShortcutHandler(e){var t;return null===(t=this._appWideShortcutRegistry)||void 0===t?void 0:t.getAppWideShortcutHandler(e)}addGlobalShortcut(e,t,i){var n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return null===(n=this._globalShortcutRegistry)||void 0===n?void 0:n.addGlobalShortcut(e,t,i)}))}removeGlobalShortcut(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return null===(t=this._globalShortcutRegistry)||void 0===t?void 0:t.removeGlobalShortcut(e)}))}registerForGlobalShortcutActivated(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return null===(e=this._globalShortcutRegistry)||void 0===e?void 0:e.registerForGlobalShortcutActivated()}))}destroy(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){null===(t=this._appWideShortcutRegistry)||void 0===t||t.destroy(e),"global"===e&&(yield null===(i=this._globalShortcutRegistry)||void 0===i?void 0:i.cleanup())}))}}class BA extends Ce.i{constructor(){super(f.Yg.CreateShortcutRegistryServiceTask,["coreSettings","hostCommunicationService","loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,hostCommunicationService:i,loggerFactory:n}=e,o=null==t?void 0:t.get(b.J.Shortcuts),{enableAppWideShortcuts:r,enableGlobalShortcuts:s}=o||{enableAppWideShortcuts:!1,enableGlobalShortcuts:!1},a=new WA(i,n,!!r,!!s);return e.shortcutRegistryService=a,e=>{switch(e){case"quit":case"signout":return a.destroy("global");default:return}}}))}}class $A{constructor(e,t=""){e.debug("Initialized telemetry context service for "+(t?"user":"default context")),this.userId=t,this._telemetryProvider=(0,Ei.G)()}initialize(e){e.debug("Initialized telemetry context service"),this._telemetryProvider=(0,Ei.G)()}setContext(e,t,i,n=""){this._telemetryProvider.setContext(e,t,i,n||this.userId)}setCoreContext(e,t,i){this._telemetryProvider.setContext(e,t,i)}setDeviceAuthToken(e){this._telemetryProvider.setDeviceAuthToken(e)}setUserId(e){this.userId=e}setPrimaryUser(e,t){this._telemetryProvider.setPrimaryUser(e,t)}}class HA extends Ce.i{constructor(){super(f.Yg.TelemetryContext,["loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=e.loggerFactory.newLogger("CreateTelemetryContextTask","core-services-tasks");e.telemetryContextService=new $A(t)}))}}var qA=i(186921);class zA{constructor(e,t){this.authenticationService=e,this.coreSettings=t,this._users=new Map,this._accountModeObservable=new r.X(WI.b.SingleAccount),this._cloudModeObservable=new r.X(WI.i.SingleCloud)}init(){this._syncWithAuthServicePromise||(this._syncWithAuthServicePromise=this.syncWithAuthenticationService())}getAuthenticatedUsers(){return new Set(this._users.keys())}has(e){return this._users.has(e)}getAccountMode(){return this._accountModeObservable.value}getAccountModeObservable(){return this._accountModeObservable.pipe((0,Ws.x)())}getCloudMode(){return this._cloudModeObservable.value}getCloudModeObservable(){return this._cloudModeObservable.pipe((0,Ws.x)())}syncWithAuthenticationService(){var e,t,i,n,r,s;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(((yield null===(s=(r=this.authenticationService).getCachedUsers)||void 0===s?void 0:s.call(r,{id:(0,xe.v4)(),scenarioName:U.RG.AuthWebCachedUser,source:"UserTrackingService::syncWithAuthenticationService"},{isAllCachedUsers:!0}))||[]).forEach((e=>{var t;this._users.set((0,Ee.b4)((0,Ee.KQ)(e)),null!==(t=e.cloud)&&void 0!==t?t:JI(this.coreSettings))})),this.updateExperienceAccountMode(),this.updateExperienceCloudMode(),this.authenticationService.getUsersIterator)try{for(var a,l=!0,c=(0,o.__asyncValues)(this.authenticationService.getUsersIterator({isAllCachedUsers:!0}));a=yield c.next(),!(e=a.done);){n=a.value,l=!1;try{const e=n;this._users.clear(),e.forEach((e=>{var t;this._users.set((0,Ee.b4)((0,Ee.KQ)(e)),null!==(t=e.cloud)&&void 0!==t?t:JI(this.coreSettings))})),this.updateExperienceAccountMode(),this.updateExperienceCloudMode()}finally{l=!0}}}catch(e){t={error:e}}finally{try{l||e||!(i=c.return)||(yield i.call(c))}finally{if(t)throw t.error}}}))}updateExperienceAccountMode(){const e=this._users.size>1?WI.b.MultipleAccounts:WI.b.SingleAccount;qA.q.log(`[updateExperienceAccountMode] to: ${WI.b[e]}`),this._accountModeObservable.next(e)}updateExperienceCloudMode(){const e=new Set(this._users.values()).size>1?WI.i.MultiCloud:WI.i.SingleCloud;qA.q.log(`[updateExperienceCloudMode] to: ${WI.i[e]}`),this._cloudModeObservable.next(e)}}class VA extends Ce.i{constructor(){super(f.Yg.CreateTrackUserServiceTask,["authenticationService","coreSettings"])}execute(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationService:i,coreSettings:n}=e,o=new zA(i,n);(null===(t=n.get(b.J.Core))||void 0===t?void 0:t.initializeMTMAModeOnStartup)&&o.init(),e.userTrackingService=o}))}}class GA extends Ce.i{constructor(){super(f.Yg.CreateUserDataClient,["scenarioFactory","loggerFactory","windowProvider","coreSettings","client"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!e.client)throw new Error("CreateUserDataClientTask: core data client doesn't exist, cannot initialize user client");const t=yield function(e,t,n){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{networkState:o,coreSettings:s,leakDetectorService:a,platformService:l,config:c,graphqlStoreStatsReporterService:d}=e,u=new th.pS,m=(0,Za.UZ)(el.l,o.observeIsOnline()),g=Object.assign(Object.assign({},e),{pubsub:u,send:m}),h=sk.clientResolvers;if(!h)throw new Error("Client resolvers should be created at this point");const{maxApolloResultCacheSize:p,enableViewSchema:v,enableApolloDoubleWriteFix:y,enableRelay:S,enableRelayLiveResolverStore:k,relayGCReleaseBufferSize:w}=s.get(b.J.Core),{enableApolloDevtools:C}=s.get(b.J.Diagnostics),_=null!=p?p:void 0,T=null==a?void 0:a.create(),I=(null==e?void 0:e.authenticationUser)&&(0,Ee.b4)(e.authenticationUser),j=DI({leakDetector:T,userContextId:I,windowId:f.ew,entityType:n,viewportContext:"cmd"},void 0,h,_,e.loggerFactory,e.scenarioFactory,void 0,C,ih.t.cmd,d,y),N=(null===(r=null==e?void 0:e.authenticationUser)||void 0===r?void 0:r.loginUserName)||"nouser";gh(j,`mtma-cmd-${N}`,Boolean(C),l,c.experienceName);const E=EI.createUserDataRequestContext(g,j),x=yield dp.createLink(Object.assign({contextValue:E},g));j.setLink(x);const A=AI(e,u,T,x,e.loggerFactory,e.scenarioFactory,h,I);let D,F;if(v&&(D=FI(e,0,T,dp.createViewSchemaLink(e),e.loggerFactory,e.scenarioFactory)),S){const{createRelayEnvironment:t}=i(807510);F=yield t({isLiveResolverEnabled:!0===k,link:x,loggerFactory:e.loggerFactory,userBiService:e.userBiService,configName:`mtma-user-${N}`,gcReleaseBufferSize:w})}const{dataOpsTracker:O,dataEvictionService:M}=t.getServices();return new ck({pubsub:u,leakDetector:T,scenarioFactory:E.scenarioFactory,coreSettings:E.coreSettings,dataOpsTracker:O,dataEvictionService:M,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},t,A,E,D,F)}))}(e,e.client,"default");return e.client=t,e=>{switch(e){case"signout":case"quit":t.destroy()}}}))}}var JA=i(455572);const KA=12e4,QA={"cdl-request":!0};var YA=i(555828);class XA{constructor(){this._isPaused=!1,this._startTime=0,this._reason=f.jK.Unknown,this._totalPauseTime=0,this._lastPauseLength=0}get paused(){return this._isPaused}get totalPauseDuration(){return this._totalPauseTime}pause(e,t={},i=void 0){this._isPaused||(this._reason=e,this._startTime=this.getTime(t),this._data=i,this._isPaused=!0)}resume(e={}){if(this._isPaused){const t=this.getTime(e)-this._startTime;this._lastPauseLength=t,this._totalPauseTime+=this._lastPauseLength}return this._isPaused=!1,{startTime:this._startTime,totalTime:this._lastPauseLength,eventData:this._data,reason:this._reason,monitoringData:void 0}}getTime(e={}){const{overrideTimestamp:t,offsetCurrentTimeInMs:i}=e;return(null!=t?t:Date.now())+(null!=i?i:0)}}class ZA{constructor(e,t,i={}){this.name=e,this.id=t,this.excludedTimings=i,this.previousMark=""}markPerformanceApi(e,t=""){if(performance&&performance.mark&&performance.measure&&this.shouldMark(this.name)){const i=`${e} ${this.name}-${this.id}`;if(performance.mark(i),e===U.ck.Stop){let e=`start ${this.name}-${this.id}`;0===(performance.getEntriesByName(e,"mark")||[]).length&&(e="navigationStart");const n=[this.name,t&&`(${t})`].join(" ");performance.measure(n,e,i)}this.previousMark&&performance.measure(`${this.name} [${this.previousMark} <=> ${e}]`,`${this.previousMark} ${this.name}-${this.id}`,i),this.previousMark=e}}shouldMark(e){return!(e in this.excludedTimings)||this.excludedTimings[e]}}class eD{constructor(e,t,i,n,o,r,s=(0,xe.v4)(),a=U.t7.Expanded,l="",c={}){this.name=e,this.clientId=t,this._eventData=i,this._timingData=n,this.startTime=o,this.timeoutMs=r,this.id=s,this.scenarioMode=a,this.userContextId=l,this.crossAccountScenarioOptions=c,this.previousStep=U.ck.Unknown,this.sequence=1,this.active=!0,this.onStopCallbacks=[],this.__stepsPerfInfo__=[],this._testingMode=!1,this._steps=[],this._stepsEx=[],this.userIds=new Set,this.pauseTracker=new XA,this.currentStep=U.ck.Unknown,this.timestamps=[],this.intervalTimestamp=o,this.performanceMarker=new ZA(this.name,this.id,QA)}addPackedData(e,t){this._steps=this._steps.concat(e.map((e=>JSON.parse(e)))),this._stepsEx=this._stepsEx.concat(t.map((e=>JSON.parse(e))))}updateTimestamp(e,t){this.timingData[e]=t}addOnStopCallback(e){this.onStopCallbacks.push(e)}get timingData(){return this._timingData}get testingMode(){return this._testingMode}set testingMode(e){this._testingMode=e}get isPaused(){return this.pauseTracker.paused}get eventData(){return this._eventData}get steps(){return this._steps}get stepsEx(){return this._stepsEx}get elapsed(){return this.calculateElapsed(Date.now())}get stepDelta(){return this.calculateStepDelta(Date.now())}get delta(){return this.calculateDelta(Date.now())}get isHoisted(){return!1}syncToState(e){this.previousStep=e.previousStep,this.intervalTimestamp=e.lastTimestamp,this.sequence=e.lastSequence}setCrossClientObservables(e){const t=e.mark.subscribe((e=>{this.mark(e.step,e.eventData,e.status)})),i=e.stop.subscribe((e=>{this.stop(e.eventData,e.status)})),n=e.appendEventData.subscribe((e=>{this.appendEventData(e.eventData)}));this.subscriptions={mark:t,stop:i,appendEventData:n}}appendEventData(e){this._eventData=Object.assign(Object.assign({},this._eventData),e)}pause(e){var t;null===(t=this.timer)||void 0===t||t.pause();const{reason:i,overrideTimestamp:n,offsetCurrentTimeInMs:r}=e,s=(0,o.__rest)(e,["reason","overrideTimestamp","offsetCurrentTimeInMs"]);this.pauseTracker.pause(i,{overrideTimestamp:n,offsetCurrentTimeInMs:r},s),this.currentStep!==U.ck.Unknown&&this.mark(this.currentStep)}resume(e={}){var t;null===(t=this.timer)||void 0===t||t.resume();const i=this.pauseTracker.resume({overrideTimestamp:e.overrideTimestamp,offsetCurrentTimeInMs:e.offsetCurrentTimeInMs});this.mark(U.ck.Pause,Object.assign(Object.assign({pauseReason:i.reason},i.eventData),e))}cancel(e={}){this.stop(e,"abandoned")}mark(e,t={},i="success"){if(!this.canMark())return;this.currentStep=U.ck.Unknown;const{overrideTimestamp:n,offsetCurrentTimeInMs:r}=t,s=(0,o.__rest)(t,["overrideTimestamp","offsetCurrentTimeInMs"]),a=this.getBaseTimestamp(n,r),{delta:l,stepDelta:c,elapsed:d}=this.getBaseScenarioTimingData(a,t),u=e,m={"Scenario.Mode":this.scenarioMode,"Scenario.Name":this.name,"Scenario.Status":i,"Scenario.Step":u,InstanceId:this.id,sequence:this.sequence,delta:l,elapsed:d,stepDelta:c};let g;if(t=Object.assign(Object.assign({},this.eventData),s),this.scenarioMode===U.t7.Packed&&(this.prepareAndStorePackedSteps(m),this.createStepsExEntry(s),u===U.ck.Stop&&(m["Scenario.Steps"]=JSON.stringify(this._steps),g={columnName:"Scenario.StepsEx",packedData:this._stepsEx})),this.scenarioMode===U.t7.Expanded||u===U.ck.Stop)if(this.isCrossAccountScenario)for(const e of this.userIds)(0,Q.Yx)(this.name,t,this.finalizeScenarioData(a,m),void 0,g,e);else(0,Q.Yx)(this.name,t,this.finalizeScenarioData(a,m),void 0,g,this.userContextId);this.performanceMarker.markPerformanceApi(u,this.clientName),this._testingMode&&this.__stepsPerfInfo__.push({name:u,delta:l,stepDelta:c,status:i}),this.updateScenarioStatePostMark(u,a)}stop(e={},t="success"){var i;null===(i=this.timer)||void 0===i||i.stop(),this.currentStep!==U.ck.Unknown&&this.mark(this.currentStep,void 0,t),this.mark("stop",Object.assign({previousStep:this.previousStep},e),t),this.active=!1,this.subscriptions&&(this.subscriptions.appendEventData.unsubscribe(),this.subscriptions.mark.unsubscribe(),this.subscriptions.stop.unsubscribe()),this.onStopCallbacks.forEach((e=>e()))}fail(e={}){this.stop(e,"failure")}incomplete(e={}){this.stop(e,"incomplete")}startStep(e){const t=e;this.currentStep!==U.ck.Unknown&&t!==this.currentStep&&this.mark(this.currentStep),this.currentStep=t}markAggregateStart(e){}markAggregateStop(e){}getTotalPauseDuration(){return 0}getPackedSteps(){return this._steps}addUser(e){this.userIds.add(e)}removeUser(e){this.userIds.delete(e)}canMark(){return this.active&&!this.pauseTracker.paused}get isCrossAccountScenario(){return!!this.crossAccountScenarioOptions.enabled&&!!this.userIds.size}finalizeScenarioData(e,t){const i=t;return i.elapsedSinceCoreInit=this.calculateElapsedSinceCoreInit(e),i}getBaseScenarioTimingData(e,t){return{delta:"number"==typeof t.delta?t.delta:this.calculateDelta(e),elapsed:"number"==typeof t.elapsed?t.elapsed:this.calculateElapsed(e),stepDelta:"number"==typeof t.stepDelta?t.stepDelta:this.calculateStepDelta(e)}}getBaseTimestamp(e,t){return(null!=e?e:Date.now())+(null!=t?t:0)}calculateElapsedSinceCoreInit(e){return this.timingData.coreInitTime?e-this.timingData.coreInitTime:void 0}calculateDelta(e){return e-this.startTime-this.pauseTracker.totalPauseDuration}calculateElapsed(e){return e-this.timingData.scenarioFactoryStartTime}calculateStepDelta(e){return e-this.intervalTimestamp}prepareAndStorePackedSteps(e){const t={"Scenario.Status":e["Scenario.Status"],"Scenario.Step":e["Scenario.Step"],delta:e.delta,elapsed:e.elapsed,sequence:e.sequence,stepDelta:e.stepDelta,previousStep:e.previousStep};this._steps.push(t)}updateScenarioStatePostMark(e,t){this.intervalTimestamp=t,this.previousStep=e,this.sequence++}createStepsExEntry(e){this.stepsEx.push((0,L.cloneDeep)(Object.assign(Object.assign({},this.eventData),e))||{})}}const tD=e=>e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.name]:t.value})),{});class iD{constructor(e,t,i,n,o={},r="",s=[]){this.timingData=e,this.logger=t,this.factoryFunctions=i,this.finalizeLegacyCrossClient=n,this.telemetryModeLookUp=o,this.userContextId=r,this.noPureScenarioCreationList=s,this.scenarioCreated$=new mi.xQ,this.scenarioStopped$=new gi.y,this.scenarioMarked$=new gi.y,this.appendEventData$=new gi.y}loadCallbacks(e){if(e.marks){const{registerForScenarioStop:t,registerForScenarioMark:i,registerForScenarioStart:n}=e.marks;this.scenarioMarked$=new gi.y((e=>{i(((t,i,n)=>{const o={step:i,status:n,scenarioName:t.scenarioName,eventData:tD(t.eventData),clientId:t.clientId};e.next(o)}))})),this.scenarioStopped$=new gi.y((e=>{t(((t,i)=>{const n={step:"stop",status:i,scenarioName:t.scenarioName,eventData:tD(t.eventData),clientId:t.clientId};e.next(n)}))})),n(((e,t)=>this.onReceivedScenarioStart(e,t)))}if(e.appendEventData){const{appendEventData:t}=e;this.appendEventData$=new gi.y((e=>{t((t=>e.next({scenarioName:t.scenarioName,clientId:t.clientId,eventData:tD(t.eventData)})))}))}}loadExistingScenarios(e){e.forEach((e=>this.OnExistingScenario(e)))}onReceivedScenarioStart(e,t){var i,n;const o=this.factoryFunctions.findScenarioByNameAndId(e.scenarioName,e.clientId);if(o)this.logger.debug(`Creating mark observable for existing scenario: name=${e.scenarioName}, clientid=${e.clientId}`),o.appendEventData({"Scenario.CrossClientMode":"existing"}),null===(i=o.setCrossClientObservables)||void 0===i||i.call(o,this.createObservablesForScenario(e.scenarioName,e.clientId));else{const i=this.factoryFunctions.findScenario(e.scenarioName);i?(this.logger.debug(`Creating mark observable for existing scenario (by name): name=${e.scenarioName}, clientid=${e.clientId}`),i.appendEventData({"Scenario.CrossClientMode":"existing"}),null===(n=i.setCrossClientObservables)||void 0===n||n.call(i,this.createObservablesForScenario(e.scenarioName,e.clientId))):this.onStartScenario(e,t)}}onStartScenario(e,t){var i,n,o;const r=e.scenarioName,s=t.time.getTime(),a=tD(e.eventData);if(this.noPureScenarioCreationList.includes(r))return void(null===(n=(i=this.logger).warnToTelemetry)||void 0===n||n.call(i,`Existing scenario not found for scenario which is found in the noPureScenarioCreationList: name=${r}`,"telemetry_instrumentation_pure_cross_client_scenario_blocked",{reason:r}));const l=this.createNewCrossClient(r,e.clientId,a,s,e.timeout,(0,xe.v4)(),null!==(o=this.telemetryModeLookUp[r])&&void 0!==o?o:U.t7.Expanded);l.appendEventData({"Scenario.CrossClientMode":"pure"}),l.addOnStopCallback((()=>{this.factoryFunctions.clearScenario(l)})),l.setCrossClientObservables(this.createObservablesForScenario(l.name,l.clientId)),this.scenarioCreated$.next(l)}OnExistingScenario(e){var t,i,n,o,r,s;const a=null!==(t=e.clientId)&&void 0!==t?t:"",l=tD(null!==(i=e.eventData)&&void 0!==i?i:[]),c=this.createNewCrossClient(e.name,a,l,e.creationTime.time.getTime(),null!==(n=e.timeout)&&void 0!==n?n:KA,e.id,null!==(o=e.scenarioMode)&&void 0!==o?o:U.t7.Expanded);c.addPackedData(null!==(r=e.steps)&&void 0!==r?r:[],null!==(s=e.stepsEx)&&void 0!==s?s:[]),c.appendEventData({"Scenario.CrossClientMode":"transferred"}),c.addOnStopCallback((()=>{this.factoryFunctions.clearScenario(c)}));const d=this.finalizeLegacyCrossClient;if(d&&c.addOnStopCallback((()=>{d({scenarioName:c.name})})),c.setCrossClientObservables(this.createObservablesForScenario(c.name,c.clientId)),e.lastMarkStep){const t={previousStep:e.lastMarkStep,lastTimestamp:e.lastMarkTime.time.getTime(),lastSequence:e.sequence};c.syncToState(t)}this.scenarioCreated$.next(c),this.logger.debug(`Created scenario from previous client: name=${e.name}, clientid=${a}`)}createObservablesForScenario(e,t){const i=this.scenarioStopped$.pipe((0,u.h)((i=>i.scenarioName===e&&i.clientId===t)),(0,YA.q)(1));return{mark:this.scenarioMarked$.pipe((0,u.h)((i=>i.scenarioName===e&&i.clientId===t)),(0,u.h)((e=>-1===["stop","start"].indexOf(e.step))),(0,li.R)(i)),stop:i,appendEventData:this.appendEventData$.pipe((0,u.h)((i=>i.scenarioName===e&&i.clientId===t)),(0,li.R)(i))}}createNewCrossClient(e,t,i,n,o,r,s){return new eD(e,t,i,this.timingData,n,o,r,s,this.userContextId)}}class nD{constructor(e){this._name=e}get id(){return"noop"}get name(){return this._name}get delta(){return 0}get timeoutMs(){return 0}get eventData(){return{}}set eventData(e){}get timestamps(){return[]}get isPaused(){return!1}set isHoisted(e){}get isHoisted(){return!1}appendEventData(e){}pause(e){}resume(e){}cancel(e){}mark(e,t,i){}startStep(e){}stop(e,t){}fail(e){}incomplete(e){}markAggregateStart(e){}markAggregateStop(e){}getTotalPauseDuration(){return 0}setCrossClientMarkObservables(e){}setCoreInitTime(e){}addUser(e){}removeUser(e){}}const oD="Scenario.Step";class rD{constructor(e,t,i,n,o,r,s,a,l,c=!1,d=!1,u=U.t7.Expanded,m=0,g,h,p,v,y="",f={},S=-1){var k,b,w;this._id=e,this._name=t,this.scenarioFactory=o,this.logger=r,this.timeout=s,this.callback=a,this.memoryAnalyzer=l,this.markStepsInTrace=c,this.showAllConsoleLogs=d,this.scenarioMode=u,this._sequence=m,this.reportActivity=g,this.hostCommunicationService=h,this.crossClientOptions=p,this.clientId=v,this.userContextId=y,this.crossAccountScenarioOptions=f,this.scenarioPackedDataLimit=S,this.steps=[],this.stepsEx=[],this.__stepsPerfInfo__=[],this.performanceMarksToCleanup=[],this.userIds=new Set,this.getTotalPauseDuration=()=>this.pauseInfo.totalTime,this._currentStep=U.ck.Unknown,this._previousStep=U.ck.Unknown,this._timestamps=[],this._isHoisted=!1,this.active=!0,this.pauseInfo={reason:"",startTime:0,totalTime:0,eventData:void 0,monitoringData:void 0};let C=0;const{overrideTimestamp:_,offsetCurrentTimeInMs:T}=n;_?C=_-Date.now():T&&(C=-T),this._eventData=i,this._absoluteStartTime=Date.now()+C,this.intervalTimestamp=this.relativeTimestamp=this.scenarioFactory.timestamp({isCrossClient:null===(k=this.crossClientOptions)||void 0===k?void 0:k.enabled})+C,this.memoryDataInitial=null===(b=this.memoryAnalyzer)||void 0===b?void 0:b.snapshotMemoryUsage(),(null===(w=this.crossClientOptions)||void 0===w?void 0:w.enabled)&&this.syncStateToCrossClientStart(this.crossClientOptions)}get id(){return this._id}get name(){return this._name}get absoluteStartTime(){return this._absoluteStartTime}get delta(){return this.scenarioFactory.timestamp()-this.relativeTimestamp}get timeoutMs(){return this.timeout}set timeoutMs(e){this.timeout=e}get eventData(){return this._eventData}set eventData(e){this._eventData=e}get timestamps(){return this._timestamps}get currentStep(){return this._currentStep}get isPaused(){return!!this.pauseInfo.startTime}set isHoisted(e){this._isHoisted=e}get isHoisted(){return this._isHoisted}appendEventData(e){this.eventData=Object.assign(Object.assign({},this.eventData),e)}markAggregateStart(e){this.active?this.isPaused?this.logger.debug(`[Scenario]${this.name} - ignoring aggregated start step [${e}] due to paused state`):(this.aggregateStepStartTime||(this.aggregateStepStartTime={}),this.aggregateStepStartTime[e]||(this.aggregateStepStartTime[e]=performance.now())):this.logger.debug(`[Scenario]${this.name} - ignoring aggregated start step [${e}] due to inactive`)}markAggregateStop(e){this.active&&this.aggregateStepStartTime[e]&&(this.aggregateStepTotalTime||(this.aggregateStepTotalTime={}),this.aggregateStepTotalTime[e]||(this.aggregateStepTotalTime[e]=0),this.aggregateStepTotalTime[e]+=performance.now()-this.aggregateStepStartTime[e],this.aggregateStepStartTime[e]=void 0)}pause(e,t){var i;if(!this.active||this.isPaused)return;null===(i=this.timer)||void 0===i||i.pause(),this._currentStep!==U.ck.Unknown&&this.mark(this._currentStep);const{reason:n,overrideTimestamp:r}=e,s=(0,o.__rest)(e,["reason","overrideTimestamp"]),a=null!=r?r:Date.now();this.startStep(U.ck.Pause),this.pauseInfo=Object.assign(Object.assign({},this.pauseInfo),{reason:n,startTime:a,eventData:s,monitoringData:t})}resume(e,t){var i;if(!this.active||!this.isPaused)return;null===(i=this.timer)||void 0===i||i.resume();const{overrideTimestamp:n}=null!=e?e:{},o=(0,L.isNumber)(n)?n:Date.now(),r=this.pauseInfo.startTime?o-this.pauseInfo.startTime:0;this.pauseInfo.totalTime=(this.pauseInfo.totalTime||0)+r,this.mark(U.ck.Pause,Object.assign(Object.assign({pauseReason:this.pauseInfo.reason},this.pauseInfo.eventData),e),void 0,t||this.pauseInfo.monitoringData),this._currentStep=U.ck.Unknown,this.pauseInfo.reason="",this.pauseInfo.startTime=0}stop(e,t="success",i){var n;this._currentStep!==U.ck.Unknown&&this.mark(this._currentStep,void 0,t,i),this.aggregateStepTotalTime&&((0,L.each)(Object.keys(this.aggregateStepTotalTime),(e=>{const t=parseInt(this.aggregateStepTotalTime[e].toString(),10);this.mark(e,{stepDelta:t},void 0,i)})),this.aggregateStepTotalTime=null,this.aggregateStepStartTime=null),null===(n=this.timer)||void 0===n||n.stop(),this.createMark(U.ck.Stop,t,!0,e,i).then((()=>{var e;if(this.active&&(this.active=!1),this.markSubscription&&!this.markSubscription.closed&&this.markSubscription.unsubscribe(),this.stopSubscription&&!this.stopSubscription.closed&&this.stopSubscription.unsubscribe(),this.callback&&(this.callback(t),this.callback=void 0),this.hostCommunicationService&&(null===(e=this.crossClientOptions)||void 0===e?void 0:e.enabled)){const e={scenarioName:this.name};this.hostCommunicationService.loadModule("scenario").then((t=>{t&&t.setScenarioCompletion&&t.setScenarioCompletion(e)}))}this.scenarioFactory.clearScenario(this)}))}updateTimestamp(e,t){"coreInitTime"===e&&(this.coreInitTimestamp=t)}fail(e,t){this.stop(e,"failure",t)}cancel(e,t){this.stop(e,"abandoned",t)}incomplete(e,t){this.stop(e,"incomplete",t)}mark(e,t,i="success",n){var o;this.isPaused&&e!==U.ck.Pause?this.logger.debug(`[Scenario]${this.name} - ignoring mark step [${e}] due to paused state`):(this.createMark(e,i,!1,t,n),this._currentStep=U.ck.Unknown,(null===(o=this.crossClientOptions)||void 0===o?void 0:o.enabled)&&this.crossClientOptions.previousStep&&e===U.ck.Start&&(this._previousStep=this.crossClientOptions.previousStep))}startStep(e){this.isPaused?this.logger.debug(`[Scenario]${this.name} - ignoring start step [${e}] due to paused state`):(this._currentStep!==U.ck.Unknown&&e!==this._currentStep&&this.mark(this._currentStep),this._currentStep=e)}setCrossClientObservables(e){this.markSubscription=e.mark.subscribe((e=>this.mark(e.step,e.eventData,e.status))),this.stopSubscription=e.stop.subscribe((e=>{this.stop(e.eventData,e.status)}))}addUser(e){this.userIds.add(e)}removeUser(e){this.userIds.delete(e)}prepareAndSendTelemetry(e,t,i,n){const{overrideTimestamp:o}=e;let r;r=this.eventData&&this.eventData!==e?Object.assign(Object.assign({},this.eventData),e):Object.assign({},e),r.InstanceId=this.id,r.overrideTimestamp=o;const s=this.createScenarioData(r,t,i),a=!!this.scenarioFactory.findScenario(U.RG.WindowLaunchTime);r.isInEst=a;const l=s[oD];if(l!==U.ck.Start){let t;this.scenarioMode!==U.t7.Expanded&&(this.prepareAndStorePackedSteps(s,e),l===U.ck.Stop&&(s["Scenario.Steps"]=JSON.stringify(this.steps),t={columnName:"Scenario.StepsEx",packedData:this.stepsEx})),this.sendScenario(r,s,l,t,n)}return this.logScenarioPerf(s),s}syncStateToCrossClientStart(e){if(e.existingEventData){const t=e.existingEventData.reduce(((e,t)=>Object.assign({[t.name]:t.value},e)),{});this.appendEventData(t)}e.previousStep&&(this._previousStep=e.previousStep),this.intervalTimestamp=this.relativeTimestamp+e.previousStepTimestamp-this._absoluteStartTime,this.active=!0}sendScenario(e,t,i,n,o){if(this.scenarioMode!==U.t7.Packed||i===U.ck.Stop){const r=()=>{if(!this.isCrossAccountScenario)return(0,Q.Yx)(this.name,e,t,o,n,this.userContextId);for(const i of this.userIds)(0,Q.Yx)(this.name,e,t,o,n,i)};i!==U.ck.Stop?r():Promise.all([this.updateEventDataMemory(e)]).then((()=>{r()})).catch((()=>{r()}))}}get isCrossAccountScenario(){return!!this.crossAccountScenarioOptions.enabled&&!!this.userIds.size}prepareAndStorePackedSteps(e,t){if(this.scenarioPackedDataLimit<0||this._sequence<=this.scenarioPackedDataLimit||e["Scenario.Step"]===U.ck.Stop){const i={"Scenario.Status":e["Scenario.Status"],"Scenario.Step":e["Scenario.Step"],delta:e.delta,elapsed:e.elapsed,sequence:e.sequence,stepDelta:e.stepDelta,previousStep:e.previousStep};this.scenarioPackedDataLimit>-1&&this._sequence>this.scenarioPackedDataLimit&&e["Scenario.Step"]===U.ck.Stop&&(i.exceededStepsLimit=!0),this.steps.push(i),this.stepsEx.push((0,L.cloneDeep)(Object.assign(Object.assign({},this.eventData),t))||{})}}logScenarioPerf(e){if(this.showAllConsoleLogs){const t=e[oD],i=e["Scenario.Status"],n=t===U.ck.Start?`[step](${this._sequence})${t}`:t===U.ck.Stop?`[step](${this._sequence})${t} (${e.stepDelta}ms/${e.delta}ms) [status]${i}`:`[step](${this._sequence})${t} (${e.stepDelta}ms)`;this.logger&&this.logger.log(`[Scenario]${this.name} ${n}`),this.__stepsPerfInfo__.push({name:t,stepDelta:e.stepDelta,delta:e.delta,status:i})}}updateEventDataMemory(e){return this.memoryAnalyzer?this.memoryAnalyzer.snapshotMemoryUsageAsync().then((t=>{var i,n,o;t&&(t.jsHeapStatistics&&(e.jsUsedHeapSize=t.jsHeapStatistics.used_heap_size,e.jsUsedHeapSizeDelta=(null===(i=this.memoryDataInitial)||void 0===i?void 0:i.jsHeapStatistics)?this.memoryDataInitial.jsHeapStatistics.used_heap_size-t.jsHeapStatistics.used_heap_size:void 0),t.processMemoryInfo&&(e.workingSet=t.processMemoryInfo.workingSetSize,e.workingSetDelta=(null===(n=this.memoryDataInitial)||void 0===n?void 0:n.processMemoryInfo)?t.processMemoryInfo.workingSetSize-this.memoryDataInitial.processMemoryInfo.workingSetSize:void 0,e.privateBytes=t.processMemoryInfo.privateBytes,e.privateBytesDelta=(null===(o=this.memoryDataInitial)||void 0===o?void 0:o.processMemoryInfo)?t.processMemoryInfo.privateBytes-this.memoryDataInitial.processMemoryInfo.privateBytes:void 0))})):Promise.resolve()}createScenarioData(e,t,i){var n,o;const{overrideTimestamp:r,offsetCurrentTimeInMs:s}=e,a=this.intervalTimestamp;let l;(0,L.isNumber)(r)?(l=this.relativeTimestamp+r-this._absoluteStartTime,e.overrideTimestamp=void 0):s?(l=this.scenarioFactory.timestamp({isCrossClient:null===(n=this.crossClientOptions)||void 0===n?void 0:n.enabled})-s,e.offsetCurrentTimeInMs=void 0):l=i===U.ck.Start?this.relativeTimestamp:this.scenarioFactory.timestamp({isCrossClient:null===(o=this.crossClientOptions)||void 0===o?void 0:o.enabled}),this._timestamps.push(l),this.intervalTimestamp=l;const c=(0,L.isNumber)(e.stepDelta)?e.stepDelta:l-a,d=(0,L.isNumber)(e.delta)?e.delta:l-this.relativeTimestamp-this.getTotalPauseDuration(),u=(0,L.isNumber)(e.elapsed)?e.elapsed:l,m=this._sequence,g="number"==typeof this.coreInitTimestamp?Date.now()-this.coreInitTimestamp:void 0,h=i===U.ck.Stop?this._previousStep:void 0;return{"Scenario.Status":t,"Scenario.Mode":this.scenarioMode,"Scenario.Name":this.name,[oD]:i,InstanceId:this.id,elapsedSinceCoreInit:g,delta:d,elapsed:u,sequence:m,stepDelta:c,previousStep:h}}getMonitoringDataOverride(e){let t=e;return this.name!==U.RG.WindowLaunchTime&&this.name!==U.RG.ExperienceReady||(t=e?(0,L.cloneDeep)(e):{scenarioPriority:"P0",data:[]},t.data.push({key:"App",value:this.eventData.contentSlotApp})),t}createMark(e,t,i,n={},r){var s;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!e||!this.active)return;let o;"reason"in n&&(o=n.reason);const a=this.getMonitoringDataOverride(r);this.markPerformanceApi(this.name,e,o);const l=this.prepareAndSendTelemetry(null!==(s=n)&&void 0!==s?s:{},t,e,a);this.active=this.active&&!i,this.reportActivity&&this.reportActivity(l),this._previousStep=e,this._sequence+=1}))}markPerformanceApi(e,t,i){if(performance&&performance.mark&&performance.measure&&!QA.hasOwnProperty(this.name)){const n=`${t} ${e}-${this.id}`;if(performance.mark(n),this.performanceMarksToCleanup.push(n),this.markStepsInTrace){if(this.previousMark){const i=`${e} [${this.previousMark} <=> ${t}]`,n=`${this.previousMark} ${e}-${this.id}`,o=`${t} ${e}-${this.id}`;performance.measure(i,n,o),performance.clearMeasures(i)}this.previousMark=t}if(t===U.ck.Stop){let t=`start ${e}-${this.id}`;0===(performance.getEntriesByName(t,"mark")||[]).length&&(t="navigationStart");const o=this.clientName?` (${this.clientName})`:"",r=null!=i?i:this.eventData.reason,s=`${e}${o}${r?`-(${r})`:""}`;performance.measure(s,t,n),performance.clearMeasures(s);for(const e of this.performanceMarksToCleanup)performance.clearMarks(e);this.performanceMarksToCleanup=[]}}}}class sD{constructor(e,t){this.scenario=e,this.windowProvider=t,this.timeRemaining=this.scenario.timeoutMs,this.lastUnpausedTimestamp=0}start(){this.timerIsRunning()||(this.timeRemaining=this.scenario.timeoutMs),this.resume()}pause(){this.timerIsRunning()&&(this.windowProvider.clearTimeout(this.timeoutId),this.timeoutId=void 0,this.timeRemaining-=Date.now()-this.lastUnpausedTimestamp)}resume(){this.timerIsRunning()||(this.lastUnpausedTimestamp=Date.now(),this.timeoutId=this.windowProvider.setTimeout(this.timeoutFunction.bind(this),this.timeRemaining))}stop(){this.windowProvider.clearTimeout(this.timeoutId),this.timeoutId=void 0}reset(){this.stop(),this.start()}timerIsRunning(){return!!this.timeoutId}timeoutFunction(){this.scenario.stop(void 0,"timeout")}}class aD{constructor(e){this.windowProvider=e}addTimerToScenario(e){if(!e.timer){const t=new sD(e,this.windowProvider);e.timer=t,t.start()}}}const lD=e=>{const{enableClickStreamEvents:t,enableClickStreamUnloadCache:i,clickStreamBatchInSeconds:n,clickStreamMaxBatchSize:o,clickStreamMaxBatchSizeWeb:r,clickStreamBatchInSecondsWeb:s,disable1DSBatching:a}=e.get(b.J.Telemetry);return{enableClickStreamEvents:null!=t&&t,enableClickStreamUnloadCache:null!=i&&i,clickStreamBatchInSeconds:n||75,clickStreamMaxBatchSize:o||15,clickStreamMaxBatchSizeWeb:r||5,clickStreamBatchInSecondsWeb:s||30,disable1DSBatching:null!=a&&a}},cD=e=>{const{disableRingNamePrefixing:t,enableTestOnlyTelemetry:i,testOnlyUserbiTelemetry:n}=e.get(b.J.Telemetry),{environment:o}=e.get(b.J.Metadata),{enableSmbUserIntentUserBiTelemetry:r,smbUserIntentUserBiTelemetryPollInterval:s}=e.get(b.J.Growth),{enableCallingPerfCollectorService:a,enableCallingLongTasksTracking:l,enableCallingLongTasksTriggerFinder:c}=e.get(b.J.Calling);return{telemetry:{observable:e.getObservable(b.J.Telemetry),disableRingNamePrefixing:Boolean(t),enableTestOnlyTelemetry:Boolean(i),testOnlyUserbiTelemetry:null!=n?n:""},metadata:{observable:e.getObservable(b.J.Metadata),environment:null!=o?o:""},growth:{enableSmbUserIntentUserBiTelemetry:Boolean(r),smbUserIntentUserBiTelemetryPollInterval:null!=s?s:36e5},calling:{enableCallingPerfCollectorService:Boolean(l),enableCallingLongTasksTracking:Boolean(c),enableCallingLongTasksTriggerFinder:Boolean(a)}}},dD=e=>{var t,i,n,o,r,s,a,l,c,d,u;const m=e.get(b.J.Telemetry),g=e.get(b.J.Host);return{telemetry:{observable:e.getObservable(b.J.Telemetry),coreAllowListEnabled:null!==(t=m.coreAllowListEnabled)&&void 0!==t&&t,coreAllowList:new Set(null!==(i=m.coreAllowList)&&void 0!==i?i:[]),scenarioIncompleteOnShutdown:null!==(n=m.scenarioIncompleteOnShutdown)&&void 0!==n&&n,scenarioIncompleteOnShutdownBlockList:null!==(o=m.scenarioIncompleteOnShutdownBlockList)&&void 0!==o?o:[],enableNewScenarioTimeout:null!==(r=m.enableNewScenarioTimeout)&&void 0!==r&&r,scenarioPackedDataLimit:mD(m.scenarioPackedDataLimit),showAllConsoleLogs:null!==(s=m.showAllConsoleLogs)&&void 0!==s&&s,noPureScenarioCreationList:null!==(a=m.noPureScenarioCreationList)&&void 0!==a?a:[],enableCrossAccountScenario:null!==(l=m.enableCrossAccountScenario)&&void 0!==l&&l,scenariosNotToTimeoutIfPaused:null!==(c=m.scenariosNotToTimeoutIfPaused)&&void 0!==c?c:[]},host:{environment:e.get(b.J.Metadata).environment,userType:null!==(d=g.userType)&&void 0!==d?d:"",enableSyncEngine:(0,nd.Q6)(e),showScenarioStepsInPerfTrace:uD(e)},test:{scenarioBufferList:null!==(u=e.get(b.J.Test).scenarioBufferList)&&void 0!==u?u:[]}}},uD=e=>{var t;return null!==(t=e.get(b.J.Host).showScenarioStepsInPerfTrace||e.get(b.J.Core).showScenarioStepsInPerfTrace)&&void 0!==t&&t},mD=e=>null!=e?e:-1,gD="scenarioBuffer";class hD{constructor(e,t,i,n,o,r,s=!1,a,l,c,d={},u=""){var m,g,h;this.context=e,this.memoryAnalyzer=i,this.windowId=n,this.clientId=o,this.payload=a,this.finalizeLegacyCrossClient=c,this.eventContextData=d,this.userContextId=u,this.coreAllowListEnabled=!1,this.allowedScenarios=new Set,this.scenarioPackedDataLimit=-1,this.crossClientScenarioList=new Set,this.scenarioTimeoutMs=KA,this.telemetryModeLookUp={},this.__isTestingMode__=!1,this.__testingBuffer__=[],this.newScenario=(e,t)=>{if(this.isCrossClientScenarioEnabled(e)){let i;if(i=(null==t?void 0:t.clientId)?this.findScenarioByNameAndId(e,t.clientId):this.findScenario(e),i)return i.appendEventData({"Scenario.CrossClientMode":"transferred"}),i}const i=this.createScenarioWithoutStarting(e,t);return i.mark(U.ck.Start,t&&{overrideTimestamp:t.overrideTimestamp},void 0,t&&t.monitoringData),i},this.createScenarioWithoutStarting=(e,t={})=>{var i;if(0===this.factoryTimestamps.scenarioFactoryStartTime||!this.isAllowedScenario(e))return new nD(e);const n=void 0===t.captureMemoryUsage||t.captureMemoryUsage,{userObjectId:o,correlationId:r,commandSource:s,tenantId:a}=this.getContextData(),l=(0,L.cloneDeep)(this.eventContextData);l["Panel.WindowID"]=this.windowId,l["UserInfo.Id"]=o,l["UserInfo.TenantId"]=a,l["EventInfo.CorrelationId"]=r,l.commandSource=s;const c=t.scenarioId||(0,xe.v4)(),{telemetry:{showAllConsoleLogs:d},host:{showScenarioStepsInPerfTrace:u}}=this.context.settings,m=this.telemetryModeLookUp?this.telemetryModeLookUp[e]||(this.telemetryModeLookUp["*"]?this.telemetryModeLookUp["*"]:U.t7.Expanded):U.t7.Expanded,g=new rD(c,e,l,{overrideTimestamp:t.startTime},this,this.logger,t.timeoutMs||this.scenarioTimeoutMs,t.callback,n?this.memoryAnalyzer:void 0,!!u,!!d,m,t.sequence||0,this.reportActivity,this.context.hostCommunicationService,t.crossClientOptions,void 0,this.userContextId,this.crossAccountScenarioOptions,this.scenarioPackedDataLimit);e===U.RG.NavigationCommand?g.clientId=null!==(i=t.clientId)&&void 0!==i?i:this.clientId:g.clientId=t.clientId,this.factoryTimestamps.coreInitTime&&g.updateTimestamp("coreInitTime",this.factoryTimestamps.coreInitTime);const h=this.setupScenarioTimeout(g);return this.getActiveScenarios(g.name).push({scenario:g,timeoutId:h}),g},this.cancelExistingAndCreateScenario=(e,t,i,n,o,r)=>{let s=this.findScenario(e);if(s){const e=[{reason:t}];s.cancel({errors:JSON.stringify(e)})}return s=this.newScenario(e,Object.assign(Object.assign({},r),{timeoutMs:i,callback:n,monitoringData:o})),s},this.stopScenarioIfActive=(e,t,i,n)=>{const o=this.findScenario(e);o&&o.stop(t,i,n)},this.markStep=(e,t,i)=>{const n=this.findScenario(e);n&&n.mark(t,i&&i.eventData,i&&i.status,i&&i.monitoringData)},this.startStep=(e,t)=>{const i=this.findScenario(e);i&&i.startStep(t)},this.findScenario=e=>{var t;if(!e)return null;const i=this.activeScenariosMap.get(e);let n=null;i&&(n=(null===(t=(0,L.find)(i,(t=>t&&t.scenario.name===e||t.scenario.clientId===e)))||void 0===t?void 0:t.scenario)||null);const{parentScenarioFactory:o}=this.context;return null==n&&o&&o!==this&&(n=o.findScenario(e)),n},this.findScenarioByNameAndId=(e,t)=>{const i=this.activeScenariosMap.get(e);let n=null,o=null;i&&(n=(0,L.find)(i,(i=>i.scenario.name===e&&i.scenario.clientId===t))||null);const{parentScenarioFactory:r}=this.context;return null==n&&r&&r!==this&&(o=r.findScenarioByNameAndId(e,t)),n&&n.scenario||o},this.clearScenario=e=>{const t=this.activeScenariosMap.get(e.name);if(t){const i=(0,L.findIndex)(t,(t=>t.scenario===e));if(i>-1){this.__saveForTestingMode__(e);const n=t.splice(i,1)[0];0===t.length&&this.activeScenariosMap.delete(n.scenario.name),this.context.settings.telemetry.enableNewScenarioTimeout||this.context.windowProvider.clearTimeout(n.timeoutId)}}const{parentScenarioFactory:i}=this.context;e.isHoisted&&i&&this!==i&&(i.clearScenario(e),e.isHoisted=!1)},this.setContext=e=>{this.eventContextData=Object.assign(Object.assign({},this.eventContextData),e),this.activeScenariosMap.forEach((t=>{t.forEach((t=>t.scenario.appendEventData(e)))}))},this.hoistScenarioToCore=e=>{const{parentScenarioFactory:t}=this.context;if(t&&t!==this)t.hoistScenarioToCore&&t.hoistScenarioToCore(e);else if(!e.isHoisted){this.getActiveScenarios(e.name).push({scenario:e,timeoutId:0}),e.isHoisted=!0}},this.findAllScenariosByName=e=>this.getActiveScenarios(e).map((e=>e.scenario)),this.changeTimeout=(e,t)=>{var i,n;const o=null===(i=this.activeScenariosMap.get(e.name))||void 0===i?void 0:i.find((t=>t.scenario.name===e.name&&t.scenario.id===e.id));o&&(o.scenario.timeoutMs=t,this.context.settings.telemetry.enableNewScenarioTimeout?null===(n=o.scenario.timer)||void 0===n||n.reset():(this.context.windowProvider.clearTimeout(o.timeoutId),o.timeoutId=this.setupScenarioTimeout(o.scenario)))},this.processOnRunningScenarios=e=>{this.activeScenariosMap.forEach((t=>t.forEach((t=>e(t.scenario,t.timeoutId)))))},this.setupScenarioTimeout=(e,t)=>{if(this.context.settings.telemetry.enableNewScenarioTimeout)return this.timerFactory.addTimerToScenario(e),0;{const i=e.timeoutMs;return this.context.windowProvider.setTimeout((()=>{const{scenariosNotToTimeoutIfPaused:i}=this.context.settings.telemetry;e.isPaused&&(null==i?void 0:i.includes(e.name))||e.stop(void 0,"timeout",t)}),i)}},this.getContextData=()=>{var e,t,i,n;return{userObjectId:this.context.settings.host.environment===yt.s.life?null===(e=this.context.authenticationUser)||void 0===e?void 0:e.profile.paddedMsaId:null===(t=this.context.authenticationUser)||void 0===t?void 0:t.profile.objectId,tenantId:null===(n=null===(i=this.context.authenticationUser)||void 0===i?void 0:i.profile)||void 0===n?void 0:n.tenantId,correlationId:this.context.correlation.id,commandSource:this.context.correlation.source}},this.getActiveScenarios=e=>{let t=this.activeScenariosMap.get(e);return t||(t=[],this.activeScenariosMap.set(e,t)),t},this.reportActivity=e=>{var t;const i=e["Scenario.Name"];i&&this.isWhitelistedActivity(i)&&(null===(t=this.context.windowProvider.opener)||void 0===t||t.postMessage(O.rY.ActivityEvent,{action:"er:rendererActivityEvents",data:{activityEvents:[{sourceId:this.windowId,events:[`${i}:${e["Scenario.Step"]}`]}]}}))},this.isWhitelistedActivity=e=>{switch(e){case U.RG.WindowLaunchTime:case U.RG.ChatSendMessage:case U.RG.CentralDataLayerRequest:case U.RG.UnhandledRejection:case U.RG.FatalError:case U.RG.GlobalWindowError:return!0;default:return!1}},this.isAllowedScenario=e=>!this.coreAllowListEnabled||this.allowedScenarios.has(e),this.isCrossClientScenarioEnabled=e=>this.clientType===wr.Bh.Maglev&&this.crossClientScenarioList.has(e)&&void 0!==this.context.hostCommunicationService,this.initializeCrossClientScenarios=(e,t=[],i)=>{var n,o;const r=null!==(n=e.scenarios)&&void 0!==n?n:[],s=null!==(o=e.crossClientScenarioList)&&void 0!==o?o:[],a=this.context.loggerFactory.newLogger("CrossClientCoordinator","core-services-telemetry");s.forEach((e=>{this.crossClientScenarioList.add(e)}));const l={scenarioFactoryStartTime:e.scenarioFactoryStartTime.time.getTime(),coreInitTime:this.factoryTimestamps.coreInitTime};this.crossClientCoordinator=new iD(l,a,this,this.finalizeLegacyCrossClient,this.telemetryModeLookUp,this.userContextId,t),this.crossClientCoordinator.scenarioCreated$.subscribe((e=>{this.onScenarioFromCoordinator(e)})),i&&(this.crossClientCoordinator.loadCallbacks(i),this.logger.debug("Cross client initializing with callbacks")),this.crossClientCoordinator.loadExistingScenarios(r),this.logger.debug("Cross client coordinator initialized")},this.getTimestamp=e=>{const t=Date.now();return(null==e?void 0:e.isCrossClient)&&this.factoryTimestamps.desktopFactoryStartTime?t-this.factoryTimestamps.desktopFactoryStartTime:(null==e?void 0:e.isFromCoreInit)&&this.factoryTimestamps.coreInitTime?t-this.factoryTimestamps.coreInitTime:t-this.factoryTimestamps.scenarioFactoryStartTime};const{telemetry:{coreAllowListEnabled:p,coreAllowList:v,scenarioPackedDataLimit:y}}=this.context.settings;this.coreAllowListEnabled=p,this.allowedScenarios=v,this.scenarioPackedDataLimit=y,this.factoryTimestamps={scenarioFactoryStartTime:t,desktopFactoryStartTime:null===(m=this.payload)||void 0===m?void 0:m.scenarioFactoryStartTime.time.getTime(),coreInitTime:r},this.activeScenariosMap=new Map,this.clientType=null===(h=null===(g=e.platformService)||void 0===g?void 0:g.config)||void 0===h?void 0:h.clientType,this.telemetryModeSubscription=this.context.settings.telemetry.observable.subscribe((e=>this.onReceiveTelemetrySettings(e))),this.crossAccountScenarioOptions={enabled:this.context.settings.telemetry.enableCrossAccountScenario},this.__initTestingMode__(this.context.settings.host.userType),this.timestamp=this.getTimestamp;const f=n?`ScenarioFactory-${n}`:"ScenarioFactory";this.logger=this.context.loggerFactory.newLogger(f,"core-services-telemetry"),this.timerFactory=new aD(this.context.windowProvider),this.payload&&this.initializeCrossClientScenarios(this.payload,this.context.settings.telemetry.noPureScenarioCreationList,l),this.startWindowLaunchTimeScenario(s,t),this.logger.debug("Initialized ScenarioFactory")}destroy(){this.telemetryModeSubscription.unsubscribe(),this.incompleteRunningScenarios()}setCoreInitTime(e){this.factoryTimestamps.coreInitTime=e,this.activeScenariosMap.forEach((t=>{t.forEach((t=>{var i,n;return null===(n=(i=t.scenario).updateTimestamp)||void 0===n?void 0:n.call(i,"coreInitTime",e)}))}))}doesScenariosExist(e){const t=[];for(const i of e){const e=this.activeScenariosMap.get(i);(null==e?void 0:e.length)&&t.push(i)}return t}incompleteRunningScenarios(){this.context.settings.telemetry.scenarioIncompleteOnShutdown&&this.processOnRunningScenarios(((e,t)=>{this.context.settings.telemetry.scenarioIncompleteOnShutdownBlockList.includes(e.name)||(e.incomplete({reason:"shutdown"}),this.context.settings.telemetry.enableNewScenarioTimeout||clearTimeout(t))}))}startWindowLaunchTimeScenario(e,t){var i;if(e){const e=this.newScenario(U.RG.WindowLaunchTime,{startTime:t,timeoutMs:6e4});e.appendEventData({workerEnabled:this.context.settings.host.enableSyncEngine}),null===(i=this.hoistScenarioToCore)||void 0===i||i.call(this,e)}}__initTestingMode__(e){e&&e.indexOf("test")>-1&&(this.__isTestingMode__=!0,gD in window?this.__testingBuffer__=window[gD]:this.__testingBuffer__=window[gD]=[])}__saveForTestingMode__(e){if(this.__isTestingMode__&&this.__testingBuffer__){const{scenarioBufferList:t}=this.context.settings.test;t.length>0?t.indexOf(e.name)>-1&&this.__pushScenarioBuffer__(e):this.__pushScenarioBuffer__(e)}}__pushScenarioBuffer__(e){e.isHoisted&&this.__testingBuffer__.length>0&&this.__testingBuffer__[this.__testingBuffer__.length-1].id===e.id||(this.__testingBuffer__.push(e),this.__testingBuffer__.length>100&&this.__testingBuffer__.shift())}onReceiveTelemetrySettings(e){var t;this.telemetryModeLookUp=e.scenarioModes,this.coreAllowListEnabled=Boolean(e.coreAllowListEnabled),this.allowedScenarios=new Set(null!==(t=e.coreAllowList)&&void 0!==t?t:[]),this.scenarioPackedDataLimit=mD(e.scenarioPackedDataLimit)}onScenarioFromCoordinator(e){this.crossClientScenarioList.add(e.name);const{showAllConsoleLogs:t}=this.context.settings.telemetry;e.testingMode=Boolean(t);const{userObjectId:i,correlationId:n,commandSource:o,tenantId:r}=this.getContextData(),s=(0,L.cloneDeep)(this.eventContextData);s["Panel.WindowID"]=this.windowId,s["UserInfo.Id"]=i,s["UserInfo.TenantId"]=r,s["EventInfo.CorrelationId"]=n,s.commandSource=o,e.appendEventData(s),this.factoryTimestamps.coreInitTime&&e.updateTimestamp("coreInitTime",this.factoryTimestamps.coreInitTime);const a=this.setupScenarioTimeout(e);this.getActiveScenarios(e.name).push({scenario:e,timeoutId:a})}}var pD=i(982190),vD=i(248965),yD=i(124498);const fD="reactWebClient",SD="maglev",kD="prod",bD="general";function wD(e,t,i){var n;let o,r,s,a;if(i){const e=i.expConfigMetadata.find((e=>e.client===fD)),t=i.expConfigMetadata.find((e=>e.client===SD));o=null==e?void 0:e.config.eTag,r=null==t?void 0:t.config.eTag,s=i.expConfigMetadata.map((e=>e.config.expIds)).filter((e=>e.length>0)).join(","),a=CD(i.expConfigMetadata).join(",")}else o=e.eTag||void 0,r=e.hostETag||void 0,e.configIds&&e.configIds.experiments&&(s=e.configIds.experiments.join(",")),(null===(n=e.expRolloutIdAllowList)||void 0===n?void 0:n.length)&&(a=_D(e).join(","));const l=function(e,t){var i;const n=e.ring&&e.ring.id||bD;if(t)return n;const o=null===(i=e.region)||void 0===i?void 0:i.toLowerCase(),r="gcc"===o?o:e.environment||kD;switch(r){case kD:return n;case"gcc":return`${n}_gcc`;default:return`${r}-${n}`}}(e,t);return{ring:l,eTag:o,hostETag:r,expIds:s,rolloutIds:a,environment:e.environment||void 0}}const CD=e=>{const t=new RegExp(/P-R-[a-zA-Z0-9]+/),i=[];return e.forEach((e=>{var n,o;null===(o=null===(n=e.config.expRolloutIdAllowList)||void 0===n?void 0:n.split(","))||void 0===o||o.forEach((n=>{var o,r;if(t.test(n)){const t=null===(r=null===(o=e.config.rolloutIds)||void 0===o?void 0:o.split(","))||void 0===r?void 0:r.filter((e=>e.startsWith(n)));i.push(...null!=t?t:[])}}))})),i},_D=e=>{var t;const i=new RegExp(/P-R-[a-zA-Z0-9]+/),n=[];return null===(t=e.expRolloutIdAllowList)||void 0===t||t.forEach((t=>{var o,r,s;if(i.test(t)){const i=null!==(s=null===(r=null===(o=e.configIds)||void 0===o?void 0:o.rollouts)||void 0===r?void 0:r.filter((e=>e.startsWith(t))))&&void 0!==s?s:[];n.push(...i)}})),n};class TD{constructor(e){this._top=-1,this._isFilled=!1,this._buffer=new Array(e),this.capacity=e}add(e){this._top=(this._top+1)%this.capacity,this._buffer[this._top]=e,this._top===this.capacity-1&&(this._isFilled=!0)}getItemFromLast(e){if(-1===this._top||e>=this.capacity||!this._isFilled&&this._top-e<0)return;const t=this._top-e>=0?this._top-e:this.capacity- -1*(this._top-e);return this._buffer[t]}}class ID{constructor(e){this.eventMarks=new TD(e&&e>0?e:100)}markEvent(e){this.markEventOverrideTimestamp(e,Date.now())}markEventOverrideTimestamp(e,t){var i;null===(i=this.eventMarks)||void 0===i||i.add({ts:t,name:e})}getEventsBetweenStartAndLast(e){if(!this.eventMarks)return[];const t=[];let i;for(let n=1;i=this.eventMarks.getItemFromLast(n),i&&!(i.ts<e);n++)t.push(i.name);return t}getEventsBetween(e,t){if(!this.eventMarks)return[];const i=[];let n;for(let o=0;n=this.eventMarks.getItemFromLast(o),n&&!(n.ts<e);o++)n.ts<t&&i.push(n.name);return i}}function jD(e){return new ID(e)}var ND;!function(e){e.Action="panelaction",e.View="panelview"}(ND||(ND={}));class ED{constructor(e,t=""){this.contextData=e,this.userContextId=t,this.clickStreamBatchInSeconds=75,this.clickStreamMaxBatchSize=15,this.getBatchNumber=()=>this.userBiCache.batchNumber,this.emptyCacheWithoutRestarting=()=>{this.recordClickStreamEvent({isTimeOut:!1,isBatchSize:!1,disableSetTimeout:!0})},this.addEventToUserBiCache=(e,t)=>{"panelaction"===t?(this.userBiCache.actionCount=this.userBiCache.actionCount+1,e["EventInfo.BaseType"]=ND.Action):(this.userBiCache.viewCount=this.userBiCache.viewCount+1,e["EventInfo.BaseType"]=ND.View),this.userBiCache.events.push(e),this.userBiCache.events.length>=this.clickStreamMaxBatchSize&&this.recordClickStreamEvent({isTimeOut:!1,isBatchSize:!0})},this.cacheClickStreamToLocalStorage=()=>{var e;this.userBiCache.events.length>0&&this.telemetrySettings.enableClickStreamUnloadCache&&(null===(e=this.contextData.localStorage)||void 0===e||e.set("clickstream_cache",JSON.stringify(this.userBiCache),"Telemetry"))},this.setUpHostListeners=()=>{this.host.addEventListener("beforeunload",(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){this.cacheClickStreamToLocalStorage(),this.emptyCacheWithoutRestarting(),yield this.telemetryProvider.flush()}))))},this.localStorageFlush=()=>{var e,t;if(this.telemetrySettings.enableClickStreamUnloadCache){const i=null===(e=this.contextData.localStorage)||void 0===e?void 0:e.get("clickstream_cache"),n=JSON.parse(i);i&&(0,Q.P3)(pD.x.ClickStream,"clickstream_cached",n,void 0,{columnName:"events",packedData:n.events},void 0,this.userContextId),null===(t=this.contextData.localStorage)||void 0===t||t.remove("clickstream_cache")}},this.setBatchTimeandSize=e=>{e===(wr.Bh.Desktop||wr.Bh.Maglev)?(this.clickStreamBatchInSeconds=this.telemetrySettings.clickStreamBatchInSeconds||75,this.clickStreamMaxBatchSize=this.telemetrySettings.clickStreamMaxBatchSize||15):(this.clickStreamBatchInSeconds=this.telemetrySettings.clickStreamBatchInSecondsWeb||30,this.clickStreamMaxBatchSize=this.telemetrySettings.clickStreamMaxBatchSizeWeb||5)},this.setupClickStreamTimeout=()=>this.contextData.windowProvider.setTimeout((()=>{this.recordClickStreamEvent({isTimeOut:!0,isBatchSize:!1})}),1e3*this.clickStreamBatchInSeconds),this.recordClickStreamEvent=e=>{if(this.userBiCache.actionCount>0||this.userBiCache.viewCount>0){this.userBiCache.batchFlushed=e.isBatchSize,this.userBiCache.timeoutFlushed=e.isTimeOut;const t=this.userBiCache;this.telemetrySettings.disable1DSBatching&&(t.latency=4),(0,Q.P3)(pD.x.ClickStream,"clickstream",t,void 0,{columnName:"events",packedData:t.events},void 0,this.userContextId),this.userBiCache={events:[],batchStartTime:(new Date).toISOString(),viewCount:0,actionCount:0,batchNumber:t.batchNumber+1,batchFlushed:!1,timeoutFlushed:!1}}this.contextData.windowProvider.clearTimeout(this.currentTimeoutId),e.disableSetTimeout||(this.currentTimeoutId=this.setupClickStreamTimeout())},this.userBiCache={events:[],batchStartTime:(new Date).toISOString(),viewCount:0,actionCount:0,batchNumber:1,batchFlushed:!1,timeoutFlushed:!1},this.telemetrySettings=this.contextData.settings.telemetry;const i=this.contextData.platformService.config.clientType;this.setBatchTimeandSize(i),this.currentTimeoutId=this.setupClickStreamTimeout(),this.host=this.contextData.windowProvider,this.localStorageFlush(),this.host&&this.setUpHostListeners(),this.telemetryProvider=(0,Ei.G)()}}var xD=i(410218);class AD{constructor(e,t){var i,n;if(this.context=e,this.windowId=t,this.biEventObserver=new mi.xQ,this.experimentationEventData={},this.telemetrySettings={},this.panelContextData={},this.dataBagContextData={},this.windowSlotContext={},this.userContextId="",this._dataBags=[],this.recordPanelView=(e,t,i)=>{const n=this.getCombinedContextData(i),o=this.getCombinedDataBagData(i),r={"Panel.Type":e.panelType,"Panel.Region":e.panelRegion};this.recordBiEvent({eventName:"panelview",data:Object.assign(Object.assign(Object.assign(Object.assign({},this.windowSlotContext),o),OD(Object.assign(Object.assign({},n),e))),r)},t)},this.recordPanelAction=(e,t,i)=>{var n;const o=this.getCombinedContextData(i),r=this.getCombinedDataBagData(i);this.recordBiEvent({eventName:"panelaction",data:Object.assign(Object.assign(Object.assign({},this.windowSlotContext),r),DD(Object.assign(Object.assign({},o),e)))},t),null===(n=this.eventTimeTracker)||void 0===n||n.markEvent(`${e.actionOutcome}-${e.actionScenario}-${e.panelType}-${e.threadType}`)},this.setBISlotContext=e=>{this.windowSlotContext=Object.assign(Object.assign({},this.windowSlotContext),e)},this.createDatabag=()=>{const e=new xD.S;return this._dataBags.push(e),e.setDispose((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){yield(0,Fa._)(0);const t=this._dataBags.findIndex((t=>t.id===e.id));this._dataBags.splice(t,1)})))),e},this.appendBiData=(e,t)=>{const{dataBag:i}=t,n=(0,o.__rest)(t,["dataBag"]),r=MD(gj.sz,e);this.dataBagContextData[r]=Object.assign(Object.assign({},this.dataBagContextData[r]),null==i?void 0:i.data),this.panelContextData[r]=Object.assign(Object.assign({},this.panelContextData[r]),n)},this.removeBiData=(e,t)=>{var i,n;const o=MD(gj.sz,e);if(t)for(const e of t)this.dataBagContextData&&(null===(i=this.dataBagContextData[o])||void 0===i||delete i[e]),this.panelContextData&&(null===(n=this.panelContextData[o])||void 0===n||delete n[e]);else delete this.dataBagContextData[o],delete this.panelContextData[o]},this.recordTestOnlyTelemetry=()=>{var e;const t=null===(e=this.context)||void 0===e?void 0:e.settings.telemetry.testOnlyUserbiTelemetry;if(t)try{this.recordPanelAction(JSON.parse(t))}catch(e){}},(null===(i=this.context)||void 0===i?void 0:i.authenticationUser)&&(this.userContextId=this.context.authenticationUser.id),null===(n=this.context)||void 0===n?void 0:n.settings){const{telemetry:{disableRingNamePrefixing:e,observable:t,enableTestOnlyTelemetry:i},calling:{enableCallingPerfCollectorService:n,enableCallingLongTasksTracking:o,enableCallingLongTasksTriggerFinder:r}}=this.context.settings;this.metadataSubscription=this.context.settings.metadata.observable.subscribe((t=>{var i;this.experimentationEventData=function(e,t,i){const n={},o=wD(e,t,i);return n["UserInfo.Ring"]=o.ring,n["UserInfo.ETag"]=o.eTag,n["UserInfo.HostETag"]=o.hostETag,n["AppInfo.ExpIds"]=o.expIds,n["AppInfo.ExpRolloutIds"]=o.rolloutIds,n["AppInfo.Environment"]=o.environment,n}(t,!!e,null===(i=this.context)||void 0===i?void 0:i.experimentationService)})),this.telemetrySettingsSubscription=t.subscribe((e=>this.onReceiveTelemetrySettings(e))),this.clientType=this.context.platformService.config.clientType,this.clientType===wr.Bh.Maglev&&this.windowId!==f.ew&&this.subscribeToMaglevWindowState(),n&&o&&r&&(this.eventTimeTracker=jD()),i&&this.recordTestOnlyTelemetry()}}getEventsWithinTimeframe(e,t){var i;return(null===(i=this.eventTimeTracker)||void 0===i?void 0:i.getEventsBetween(e,t))||[]}getWindowId(){return this.windowId}destroy(){var e;this.metadataSubscription&&this.metadataSubscription.unsubscribe(),this.telemetrySettingsSubscription&&this.telemetrySettingsSubscription.unsubscribe(),this.clickStreamService&&this.clickStreamService.emptyCacheWithoutRestarting(),this.windowStateSubcription$&&this.windowStateSubcription$.unsubscribe(),this.unregisterForWindowStateChanged&&this.unregisterForWindowStateChanged(),(null===(e=this.smbUserIntentSubcription)||void 0===e?void 0:e.unsubscribe)&&this.smbUserIntentSubcription.unsubscribe(),this._dataBags.length&&(this._dataBags=[])}initializeAndSubscribeToSmbUserIntent(){var e,t;if(this.environment===yt.s.life&&this.includeSmbUserIntentData&&(null===(e=this.context)||void 0===e?void 0:e.client)){const{smbUserIntentUserBiTelemetryPollInterval:e}=null===(t=this.context)||void 0===t?void 0:t.settings.growth,n=()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t,n;const o=yield(0,gl.mT)((()=>i.e(309342).then(i.bind(i,218600))),"services-io-data-smb-user-intent").then((e=>e.smbUserIntentDocument));this.smbUserIntentSubcription=null===(n=null===(t=this.context)||void 0===t?void 0:t.client)||void 0===n?void 0:n.watchQuery({query:o,pollInterval:e,fetchPolicy:"no-cache"}).subscribe((e=>{var t;(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.smbUserIntent)&&(this.smbUserIntent=e.data.smbUserIntent)}))}));return n(),()=>{var e;"function"==typeof(null===(e=this.smbUserIntentSubcription)||void 0===e?void 0:e.unsubscribe)&&this.smbUserIntentSubcription.unsubscribe()}}}getDataFromBaseInstance(){var e,t,i;return{"UserInfo.SmbUserIntent.Intent":null===(e=this.smbUserIntent)||void 0===e?void 0:e.smbUserIntent,"UserInfo.SmbUserIntent.IntentScore":null===(t=this.smbUserIntent)||void 0===t?void 0:t.smbUserIntentScore,"UserInfo.SmbUserIntent.ConfidenceScore":null===(i=this.smbUserIntent)||void 0===i?void 0:i.smbConfidenceScore}}bubbleUpObservable(e){var t,i,n;this.biEventObserver.next(e),null===(n=null===(i=null===(t=this.context)||void 0===t?void 0:t.parentUserBiService)||void 0===i?void 0:i.bubbleUpObservable)||void 0===n||n.call(i,e)}observe(){return this.biEventObserver.asObservable()}onReceiveTelemetrySettings(e){this.telemetrySettings=e,this.context&&this.telemetrySettings.enableClickStreamEvents&&!this.clickStreamService&&(this.clickStreamService=new ED({settings:this.context.clickstreamSettings,windowProvider:this.context.windowProvider,platformService:this.context.platformService,localStorage:this.context.localStorage},this.userContextId))}get includeSmbUserIntentData(){var e;return Boolean(null===(e=this.context)||void 0===e?void 0:e.settings.growth.enableSmbUserIntentUserBiTelemetry)}get environment(){var e;return null===(e=this.context)||void 0===e?void 0:e.settings.metadata.environment}recordBiEvent(e,t){this._applyContextData(e),this.includeSmbUserIntentData&&this.applySmbUserIntentData(e);const i=function(e){const t={};return Object.keys(e).forEach((i=>{(0,L.isNil)(e[i])||(t[i]=e[i])})),t}(e.data),n="EventInfo.Identifier"in e.data?e.data["EventInfo.Identifier"]:void 0;if(this.telemetrySettings.enableClickStreamEvents&&this.clickStreamService){const t=(e.eventName,i);this.telemetrySettings.enableDualClickStreamEvents&&(i.batchNumber=this.clickStreamService.getBatchNumber(),(0,Q.P3)(pD.x.UserBI,e.eventName,i,void 0,void 0,this.telemetrySettings.enableUserBiEventIdentifiers?n:void 0,this.userContextId)),this.clickStreamService.addEventToUserBiCache(t,e.eventName)}else(0,Q.P3)(pD.x.UserBI,e.eventName,i,void 0,void 0,this.telemetrySettings.enableUserBiEventIdentifiers?n:void 0,this.userContextId);t&&(t.debug(`Analytics: EventType: ${e.eventName}`),t.debug(`Analytics: Type: ${i["Panel.Type"]}`),t.debug("Analytics: Payload:",i)),this.bubbleUpObservable({eventName:e.eventName,data:i})}_applyContextData(e){var t,i,n,o,r,s,a,l,c,d,u;e.data["Panel.WindowID"]=this.windowId,e.data["EventInfo.CorrelationId"]=null===(i=null===(t=this.context)||void 0===t?void 0:t.correlation)||void 0===i?void 0:i.id;const m=null!==(n=this.windowIsVisible)&&void 0!==n?n:null===(o=this.context)||void 0===o?void 0:o.windowProvider.isFocused();e.data["Window.Focus"]=m?JA.cb.foreground:JA.cb.background;const g=m?JA.Lv.maximized:JA.Lv.minimized;if(e.data["Window.Status"]=g,e.data["Window.Height"]=null===(r=this.context)||void 0===r?void 0:r.windowProvider.innerHeight,e.data["Window.Width"]=null===(s=this.context)||void 0===s?void 0:s.windowProvider.innerWidth,e.data["Window.ViewportContext"]=null===(a=this.context)||void 0===a?void 0:a.windowProvider.viewportContext,null===(l=this.context)||void 0===l?void 0:l.authenticationUser){const t=this.environment===yt.s.life?null===(c=this.context)||void 0===c?void 0:c.authenticationUser.profile.paddedMsaId:null===(d=this.context)||void 0===d?void 0:d.authenticationUser.profile.objectId;e.data["UserInfo.Id"]=t,e.data["UserInfo.TenantId"]=null===(u=this.context)||void 0===u?void 0:u.authenticationUser.profile.tenantId}e.data=Object.assign(Object.assign({},e.data),this.experimentationEventData)}getCombinedContextData(e){let t={};if(e)for(const i of e){const e=MD(gj.sz,i);t=Object.assign(Object.assign({},t),this.panelContextData[e])}return t}getCombinedDataBagData(e){let t={};if(e)for(const i of e){const e=MD(gj.sz,i);t=Object.assign(Object.assign({},t),this.dataBagContextData[e])}return t}subscribeToMaglevWindowState(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.windowControlsModule&&this.context){this.windowControlsModule=yield this.context.hostCommunicationService.loadModule("windowcontrols"),this.windowState$=new gi.y((e=>{var t;this.windowControlsModule&&this.windowControlsModule.registerForWindowStateChanged&&(this.unregisterForWindowStateChanged=null===(t=this.windowControlsModule)||void 0===t?void 0:t.registerForWindowStateChanged((t=>{if(!t.windowId||this.windowId&&t.windowId===this.windowId){const i=!t.placement.minimized;e.next(i)}})))}));const e=e=>{this.windowIsVisible=e};this.windowStateSubcription$=this.windowState$.subscribe(e)}}))}applySmbUserIntentData(e){var t,i,n,o;const r="function"==typeof(null===(i=null===(t=this.context)||void 0===t?void 0:t.parentUserBiService)||void 0===i?void 0:i.getDataFromBaseInstance)?null===(o=null===(n=this.context)||void 0===n?void 0:n.parentUserBiService)||void 0===o?void 0:o.getDataFromBaseInstance():void 0;r&&(e.data["UserInfo.SmbUserIntent.Intent"]=r["UserInfo.SmbUserIntent.Intent"],e.data["UserInfo.SmbUserIntent.IntentScore"]=r["UserInfo.SmbUserIntent.IntentScore"],e.data["UserInfo.SmbUserIntent.ConfidenceScore"]=r["UserInfo.SmbUserIntent.ConfidenceScore"])}}function DD(e){const{appName:t,actionGesture:i,actionOutcome:n,actionOutcomeNew:o,actionScenario:r,actionScenarioType:s,actionWorkload:a,actionSubworkload:l,actionInputDelay:c,moduleName:d,moduleNameNew:u,moduleType:m,moduleTypeNew:g,extensibilityData:h,tabId:p,tabIdNew:v,tabOrdinal:y,tabType:f,tabTypeNew:S,eventIdentifier:k,appId:b,appIsTenantApp:w,appCapabilityId:C,appScenarioCapability:_,appScope:T}=e,I=MD(gj.rA,d),j=MD(gj.PO,m),N=MD(gj.uS,i),E=MD(gj.Tk,r),x=(0,L.isNil)(k)?[I,j,N,E].filter(Boolean).join("_"):MD(gj.b6,k),A=Object.assign(Object.assign({"Action.Gesture":i,"Action.Outcome":n,"Action.OutcomeNew":o,"Action.Scenario":r,"Action.ScenarioType":s,"Action.WorkLoad":a,"Action.SubWorkLoad":l,"Module.Name":d,"Module.Type":m,"Module.NameNew":u,"Module.TypeNew":g,"Tab.Id":p,"Tab.Type":f,"Tab.IdNew":v,"Tab.TypeNew":S,"Tab.Ordinal":y,"App.Name":t,"App.Id":b,"App.IsTenantApp":w,"App.CapabilityId":C,"App.ScenarioCapability":_,"App.Scope":T},OD(e)),FD(h));return(0,L.isNil)(x)||(A["EventInfo.Identifier"]=x),(0,L.isNil)(c)||(A["Action.InputDelay"]=c),A}function FD(e){if(e&&!(0,L.isEmpty)(e))return{"App.Id":e.id,"App.Name":e.name,"App.Scope":MD(vD.Mv,e.scope),"App.ScenarioCapability":MD(vD.Ky,e.scenarioCapability),"App.EntryPoint":MD(vD.sG,e.entryPoint),"App.ExternalId":e.externalId,"App.IsTenantApp":e.isTenantApp,"App.CapabilityId":e.capabilityId,"App.SceneId":e.sceneId,"Bot.Id":e.botId,"App.MsftPartnerAppID":e.mpnId,"App.Source":MD(yD.RE,e.appDetailsEntryPoint),"App.FromSectionName":e.fromSectionName,"App.Capabilities":e.capabilities,"App.BotScopes":e.botScopes,"App.GalleryTabScopes":e.galleryTabScopes,"App.StaticTabScopes":e.staticTabScopes,"App.StaticTabName":e.staticTabName,"App.ConnectorScopes":e.connectorScopes,"App.ConnectorId":e.connectorId,"App.Version":e.version,"App.ManifestVersion":e.manifestVersion,"App.Categories":e.categories,"App.IsHostedApp":e.isHostedApp,"App.AppSource":e.appSource,"App.EventType":e.eventType,"App.DraftId":e.draftId,"App.LinkUnfurlingType":e.linkUnfurlingType}}function OD(e){const{panelRegion:t,panelRegionNew:i,panelType:n,panelTypeNew:o,threadId:r,teamId:s,threadMembers:a,threadType:l,panelLaunchMethod:c,panelUri:d,dataBag:u,extensibilityData:m,eventIdentifier:g,entityType:h,mainSlotApp:p,mainEntityType:v,mainEntityAction:y,officeGroupId:f,moduleName:S,moduleType:k,callId:b,participantId:w}=e,C=MD(gj.Ai,t),_=MD(gj.wh,n),T=(0,L.isNil)(g)?[C,_].filter(Boolean).join("_"):MD(gj.b6,g);return Object.assign(Object.assign(Object.assign({"Panel.LaunchMethod":c,"Panel.Region":t,"Panel.Type":n,"Panel.RegionNew":i,"Panel.TypeNew":o,"Panel.Uri":d,"Module.Name":S,"Module.Type":k,"Thread.Id":r,"Team.Id":s,"Team.OfficeGroupId":f,"Call.Id":b,"Participant.Id":w,"Thread.Type":l,"Thread.Members":a,"TargetThread.Id":r,"TargetThread.Type":l,"EventInfo.Identifier":T,"Entity.Type":h},u&&u.data),FD(m)),{"UserInfo.ChannelResourceTenant.Id":e["UserInfo.ChannelResourceTenant.Id"],"SlotConfig.MainSlotApp":p,"SlotConfig.MainEntityType":v,"SlotConfig.MainEntityAction":y})}function MD(e,t){return(0,L.isNil)(t)?void 0:e[t]}class RD{create(e,t,i,n,o,r,s){var a;const l=new oe(n),c=new hD(Object.assign(Object.assign({},e),{loggerFactory:l}),i,o,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,r),d=new AD(t),u=new $A(l.newLogger("SetUserOnTelemetryContextTask","core-services-telemetry"),r),m={coreScenarioFactory:c,userBiService:d,loggerFactory:l,telemetryContext:u,telemetryService:new PD(c,u,o,{isolateUserContext:null!==(a=s.get(b.J.Telemetry).isolateUserContext)&&void 0!==a&&a})};return RD._cache.set(r,m),m}destroy(e){var t,i,n,o;if(e){const r=RD._cache.get(e);r&&(null===(i=(t=r.coreScenarioFactory).destroy)||void 0===i||i.call(t),null===(o=(n=r.userBiService).destroy)||void 0===o||o.call(n),RD._cache.delete(e))}}get(e){let t;return e&&(t=RD._cache.get(e)),t}clear(){RD._cache.clear()}forEach(e){RD._cache.forEach(e)}}RD._cache=new Map;class PD{constructor(e,t,i,n){this.coreScenarioFactory=e,this.coreTelemetryContext=t,this.memoryAnalyzer=i,this.isolateUserContext=!1,this.scenarioCancelOnNetworkStateChangeBlockList=new Set,this.scenarioCancelOnSuspendStateChangeBlockList=new Set,this.newCoreScenario=(e,t)=>this.coreScenarioFactory.newScenario(e,t),this.stopCoreScenarioIfActive=(e,t,i)=>this.coreScenarioFactory.stopScenarioIfActive(e,t,i),this.createScenarioFactory=(e,t,i,n,o,r="")=>{const{coreSettings:s}=e,{enableCreateWindowLaunchScenarioOnMainWindow:a}=s.get(b.J.Core);return new hD({settings:dD(s),parentScenarioFactory:e.scenarioFactory,platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:i},parseInt(i.startTimestamp,10)||Date.now(),this.memoryAnalyzer,t,n,this.coreInitTimestamp,!!a||t!==f.ew,void 0,void 0,void 0,{"Window.ViewportContext":o},r||this.coreTelemetryContext.userId)},this.createUserBiService=(e,t,i)=>new AD({authenticationUser:e.authenticationUser,settings:cD(e.coreSettings),clickstreamSettings:{telemetry:lD(e.coreSettings)},windowProvider:e.windowProvider,platformService:e.platformService,experimentationService:e.experimentationService,hostCommunicationService:e.hostCommunicationService,client:e.client,localStorage:e.localStorage,parentUserBiService:e.userBiService,correlation:i},t),this.setCoreContext=(e,t,i)=>{this.coreTelemetryContext.setContext(e,t,i)},this.setContext=(e,t,i,n="")=>{this.coreTelemetryContext.setContext(e,t,i,n)},this.setDeviceAuthToken=e=>{this.coreTelemetryContext.setDeviceAuthToken(e)},this.setUserId=e=>{this.coreTelemetryContext.setUserId(e)},this.getTelemetryContextService=()=>this.coreTelemetryContext,this.setTelemetryContextService=e=>{this.coreTelemetryContext=e},this.logOutUser=e=>{(0,Ei.G)().logOutUser(e)},this.onHostStateChange=e=>{if(e.suspendedState===_e.V9.Suspending&&e.suspendedState!==this.previousHostSuspendState){const e=e=>{this.scenarioCancelOnSuspendStateChangeBlockList.has(e.name)||e.cancel({reason:"suspending"})};this.getTelemetryServicesCache().forEach((t=>{t.coreScenarioFactory.processOnRunningScenarios(e)})),this.coreScenarioFactory.processOnRunningScenarios(e)}this.previousHostSuspendState=e.suspendedState},this.onNetworkStateChange=e=>{if(e===Ys.G.Offline){const e=e=>{this.scenarioCancelOnNetworkStateChangeBlockList.has(e.name)||e.cancel({reason:"network offline"})};this.getTelemetryServicesCache().forEach((t=>{t.coreScenarioFactory.processOnRunningScenarios(e)})),this.coreScenarioFactory.processOnRunningScenarios(e)}},PD._telemetryServicesCache||(PD._telemetryServicesCache=new RD);const{isolateUserContext:o}=n;this.isolateUserContext=o}destroy(){var e,t;null===(e=this.telemetrySuspendStateSubscription)||void 0===e||e.unsubscribe(),null===(t=this.telemetryNetworkStateSubscription)||void 0===t||t.unsubscribe()}getMemoryAnaylzer(){return this.memoryAnalyzer}setCoreInitTime(e){var t,i;this.coreInitTimestamp=e,null===(i=(t=this.coreScenarioFactory).setCoreInitTime)||void 0===i||i.call(t,e)}setAuthContext(e){const{id:t,oid:i,tid:n,type:o,role:r,subType:s,isCrossCloudUser:a,isExternal:l,homeAccountId:c,homeTenantId:d,userCloud:u}=e,m=(e,i)=>{this.isolateUserContext?this.setContext(e,i,void 0,t):this.setCoreContext(e,i)};void 0!==t&&m("userId",t===i?"":t),void 0!==i&&m("UserInfo.Id",i),void 0!==n&&m("UserInfo.TenantId",n),void 0!==o&&m("UserInfo.Type",o),void 0!==r&&m("UserInfo.Role",r),void 0!==c&&this.setContext("UserInfo.HomeAccountId",c,void 0,t),void 0!==d&&this.setContext("UserInfo.HomeTenantId",d,void 0,t),void 0!==s&&m("UserInfo.SubType",s),void 0!==u&&this.setContext("UserInfo.HomeCloud",u,void 0,t),void 0!==a&&this.setContext("UserInfo.IsCrossCloudUser",a,void 0,t),void 0!==l&&m("UserInfo.IsExternal",l)}getTelemetryServicesCache(){return PD._telemetryServicesCache}initTelemetrySuspendStateSubscription(e,t){this.telemetrySuspendStateSubscription||(this.scenarioCancelOnSuspendStateChangeBlockList=new Set(t),this.telemetrySuspendStateSubscription=e.observe().subscribe(this.onHostStateChange))}initTelemetryNetworkStateSubscription(e,t){this.telemetryNetworkStateSubscription||(this.scenarioCancelOnNetworkStateChangeBlockList=new Set(t),this.telemetryNetworkStateSubscription=e.observe().subscribe(this.onNetworkStateChange))}}class LD extends Ce.i{constructor(){super(f.Yg.SetUserOnTelemetryContext,["authenticationService","authenticationUser","config","coreSettings","correlation","diagnosticsService","discover","hostCommunicationService","loggerFactory","platformService","scenarioFactory","telemetryContextService","telemetryService","windowProvider"])}execute(e){var t,i,n,r,s,a;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:l,coreSettings:c,loggerFactory:d,authenticationService:u,correlation:m,telemetryContextService:g,telemetryService:h,discover:p}=e,v=d.newLogger("SetUserOnTelemetryContextTask","core-services-tasks");let y;if(c.get(b.J.Telemetry).useTelemetryServicesCache&&(y=h.getTelemetryServicesCache().get(l.id)),y)e.loggerFactory=y.loggerFactory,e.scenarioFactory=y.coreScenarioFactory,e.telemetryService=y.telemetryService,e.userBiService=y.userBiService,e.telemetryContextService=y.telemetryContext;else{const o=l.type===Es.Ch.MsaLife||c.get(b.J.Metadata).environment===yt.s.life,r=new $A(v,l.id);e.loggerFactory=new oe(e.diagnosticsService,e.correlation.id,l.id);const s=new hD({parentScenarioFactory:e.scenarioFactory,settings:dD(e.coreSettings),platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:e.correlation},e.config.startTimeMS,null===(t=e.telemetryService)||void 0===t?void 0:t.getMemoryAnaylzer(),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,l.id);e.scenarioFactory=s,e.telemetryService=new PD(s,r,null===(i=e.telemetryService)||void 0===i?void 0:i.getMemoryAnaylzer(),{isolateUserContext:null!==(n=c.get(b.J.Telemetry).isolateUserContext)&&void 0!==n&&n}),o&&(l.profile.paddedMsaId=this.getPaddedMsaId(l.profile.objectId,v)),this.setAuthUserOnTelemetryContext(e.telemetryService,l,o),this.markServiceWorkerState(e.telemetryService,e.windowProvider,e.config.basePath)}const{registerForUserContext:f,notifyPrivacyDataControlsEnabled:S}=yield this.initializeUserHostComms(e.authenticationUser.id,e.hostCommunicationService,v);S&&p.getUser().then((e=>{var t;S(null!==(t=e.isPrivacyDataControlEnabled)&&void 0!==t&&t)}));const k=null==f?void 0:f(((t,i,n)=>{e.telemetryService.setContext(t,n,void 0,i)})),w=this.subscribeAndSetUserInfoTelemetryContext(e.telemetryService,l,c),C=this.subscribeAndSetSmbTenantSegmentTelemetryContext(e.telemetryService,c),_=null!==(r=c.get(b.J.Telemetry).disableMTMAPrimaryId)&&void 0!==r&&r;To(_,g,u,m,v),null===(a=(s=e.authenticationService).registerEndTelemetryTask)||void 0===a||a.call(s,(e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){var t;k&&k(),h.setContext("UserInfo.IsMRU",void 0,void 0,e),w.unsubscribe(),C.unsubscribe();try{yield To(_,g,u,m,v)}catch(e){null===(t=v.errorToTelemetry)||void 0===t||t.call(v,"Failed to update MRU or sync mtma context","telemetry_instrumentation_update_user_context")}yield(0,Ei.G)().flush(),(0,Ei.G)().logOutUser(e),c.get(b.J.Telemetry).useTelemetryServicesCache&&h.getTelemetryServicesCache().destroy(e)}))))}))}initializeUserHostComms(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n={};try{const i=yield t.loadModule("telemetry"),{registerForOnNewContext:o,setPdcEeaStatus:r}=null!=i?i:{};o&&(n.registerForUserContext=t=>o((i=>{i.filter((t=>t.userContextId===e)).forEach((i=>t(i.column,e,i.value)))}))),r&&(n.notifyPrivacyDataControlsEnabled=r)}catch(e){i.errorToTelemetry&&i.errorToTelemetry(Vs.LoadModuleTelemetryFailed,"webclient_framework_host_comms",void 0,!0)}return n}))}subscribeAndSetUserInfoTelemetryContext(e,t,i){return i.getObservable(b.J.UserResources).subscribe((i=>{const n=i.licenseType||void 0;switch(n&&e.setContext("UserInfo.LicenseType",n),t.role){case Es.w4.Member:i.isTenantAdmin||void 0?e.setContext("UserInfo.TenantRole",JA.z7.Admin):e.setContext("UserInfo.TenantRole",JA.z7.Regular);break;case Es.w4.Guest:e.setContext("UserInfo.TenantRole",JA.z7.Guest);break;case Es.w4.Anonymous:e.setContext("UserInfo.TenantRole",JA.z7.Anonymous)}}))}subscribeAndSetSmbTenantSegmentTelemetryContext(e,t){return t.getObservable(b.J.Smb).subscribe((t=>{const i=t.tenantSizeSegment||void 0;i&&e.setContext("Tenant.SmbTenantSizeSegment",i)}))}markServiceWorkerState(e,t,i){let n;"serviceWorker"in t.navigator&&t.navigator.serviceWorker.getRegistration(`/${i}/serviceworker.js`).then((t=>{t&&(t.active?n=t.active:t.waiting?n=t.waiting:t.installing&&(n=t.installing)),null==e||e.setCoreContext("AppInfo.ServiceWorkerState",t?null==n?void 0:n.state:"NotFound")}))}setAuthUserOnTelemetryContext(e,t,i){i&&t.profile.paddedMsaId&&this.setUserContext(e,t.profile.paddedMsaId);const n=i&&t.profile.paddedMsaId?t.profile.paddedMsaId:t.profile.objectId;e.setContext("UserInfo.Id",n),e.setContext("UserInfo.TenantId",t.profile.tenantId),e.setContext("UserInfo.Type",t.type),e.setContext("UserInfo.Role",t.role)}setUserContext(e,t){const i=t.slice(19).replace("-","");e.setUserId(t),e.setContext("UserInfo.Id",t),e.setContext("userId",i)}getPaddedMsaId(e,t){try{if(/(\w{8})-(\w{4})-(\w{4})-(\w{4})-(\w{12})/.exec(e)&&e.startsWith("00000000-0000-0000-"))return e;{const t=(0,L.padStart)(e,32,"0"),i=/(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})/;return t.replace(i,"$1-$2-$3-$4-$5")}}catch(e){return void t.error("failed_user_padding")}}}class UD extends Ce.i{constructor(){super(f.Yg.CreateUserTelemetryServicesTask,["telemetryService","authenticationUser","diagnosticsService","coreSettings","loggerFactory","windowProvider","correlation","platformService","experimentationService","hostCommunicationService","client","scenarioFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,diagnosticsService:i,telemetryService:n,coreSettings:o,loggerFactory:r,windowProvider:s,correlation:a,platformService:l,experimentationService:c,hostCommunicationService:d,client:u,scenarioFactory:m}=e;o.get(b.J.Telemetry).useTelemetryServicesCache&&!n.getTelemetryServicesCache().get(t.id)&&n.getTelemetryServicesCache().create({settings:dD(o),loggerFactory:r,windowProvider:s,correlation:a,parentScenarioFactory:m},{authenticationUser:t,settings:cD(o),clickstreamSettings:{telemetry:lD(o)},windowProvider:s,platformService:l,experimentationService:c,hostCommunicationService:d,client:u},Date.now(),i,n.getMemoryAnaylzer(),t.id,o)}))}}const WD="serviceWorkerDeferInstallDurationInMs",BD="enableServiceWorkerIntegrityCheck",$D="enableServiceWorkerDynamicManifest",HD="localeSettingValue",qD="environment",zD="clientType",VD="swHandleCdlHashRoute",GD="platformId",JD="teams-service-worker-telemetry-v2",KD="1",QD="LogEvents",YD="timestamp",XD="teams-service-worker-v2",ZD="2",eF="SwState",tF="key";var iF,nF,oF,rF;!function(e){e.Install="install",e.Activate="activate",e.Fetch="fetch"}(iF||(iF={})),function(e){e.Intermediate="intermediate",e.Old="old"}(nF||(nF={})),function(e){e.Info="sw_info",e.InstallSuccess="sw_install_success",e.InstallFailure="sw_install_failure",e.ActivateSuccess="sw_activate_success",e.ActivateFailure="sw_activate_failure",e.FetchCacheMiss="sw_fetch_cache_miss",e.CleanupCacheSuccess="sw_cleanup_cache_success",e.CleanupCacheFailure="sw_cleanup_cache_failure",e.CleanupCacheRetry="sw_cleanup_cache_retry",e.CleanupNotRun="sw_cleanup_cache_not_run",e.CleanupNotRequired="sw_cleanup_cache_not_required",e.CorruptCache="sw_corrupt_cache",e.CorruptCacheDeleteSuccess="sw_corrupt_cache_delete_success",e.CorruptCacheDeleteFailure="sw_corrupt_cache_delete_failure",e.DeferInstallStarted="sw_install_defer_started",e.DeferInstallCancelled="sw_install_defer_cancelled",e.DeferInstallCancelledOnMaxIncomplete="sw_install_defer_cancelled_max_incomplete",e.DeferInstallOldCacheCleanupInProgress="sw_install_defer_old_cache_cleanup_inprogress",e.DeferInstallTimerCompleted="sw_install_defer_timer_completed",e.DeferInstallRetryAttempted="sw_install_defer_retry",e.ResetInstallIncompleteCounterFailure="sw_install_reset_counter_failure",e.ResetCacheCleanupStateFailure="sw_reset_cache_cleanup_state_failure",e.InstallIntegrityCheckPerformed="sw_install_integrity_check_performed",e.ReadIndexedDbFailure="sw_read_indexeddb_failure",e.AssetSetGenerationFailure="sw_asset_set_generation_failure",e.WriteIndexedDbFailure="sw_write_indexeddb_failure",e.FetchSWAssetsUsingSendMessage="sw_fetch_assets_using_send_message"}(oF||(oF={})),function(e){e.Start="start",e.Success="success",e.Failure="failure",e.CacheMiss="cache_miss",e.HighLatency="high_latency",e.CDNAssetNotInManifest="cdn_asset_not_in_manifest",e.OfflineAssetStart="offline_asset_start",e.OfflineAssetSuccess="offline_asset_success",e.OfflineAssetFailure="offline_asset_failure",e.OfflineAssetCacheMiss="offline_asset_cache_miss"}(rF||(rF={}));const sF=3e5,aF=18e4,lF=72e5,cF=18e5,dF="serviceWorkerCheckingForUpdates",uF="serviceWorkerMaxUpdateFailureCountReached",mF="serviceWorkerRegistrationNotFound",gF=5,hF=1e4,pF=3,vF=5,yF=72e5,fF="fundamentals_performance_sw_fetch",SF="fundamentals_performance_sw_offline_fetch";var kF=i(321748);class bF{constructor(e){var t,i,n,o,r;this.context=e,this.fetchTelemetryStore=new Map,this.swEnableIntegrityCheck=!1,this.isSwInstalling=!1,this.isSwWaiting=!1,this.sWRegistrationAttempt=0,this.sWRegistrationTrialCounter=0,this.serviceWorkerUpdateFailureCount=0,this.basePath=this.context.config.basePath,this.loggerFactory=this.context.loggerFactory,this.logger=this.loggerFactory.newLogger("WebClientUpdateService","services-io-browser-web-client-update"),this.rebootService=this.context.rebootService,this.host=this.context.windowProvider,this.scenarioFactory=this.context.scenarioFactory,this.coreSecurityService=this.context.coreSecurityService;try{this.swRegisterUrlPolicy=this.coreSecurityService.getTrustedTypePolicy("@msteams/services-io-browser-web-client-update#register-service-worker"),this.trustedScriptUrl=null===(t=this.swRegisterUrlPolicy)||void 0===t?void 0:t.createScriptURL(`/${this.basePath}/serviceworker.js`,this.host.location.origin)}catch(e){e instanceof Bu.Y&&je.G.isFunction(e.toTelemetryEntry)?null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,e.toTelemetryEntry(),"fundamental_performance_trusted_sw_scripturl"):null===(r=(o=this.logger).errorToTelemetry)||void 0===r||r.call(o,"create register service worker url trustedtype policy failed",e)}this.enableSWSubscription=this.context.coreSettings.getObservable(b.J.Core).subscribe((e=>{this.registerOrUnregisterServiceWorker(!!e.enableServiceWorker)}))}cleanup(){this.enableSWSubscription.unsubscribe(),this.clearTimer()}checkForUpdateAndRestartWebClient(){this.configureServiceWorkerEvents(),this.addUpdateServiceWorkerSettings(!0),this.registerAndCheckForServiceWorkerUpdates()}sendMessageToServiceWorker(e,t){return new Promise(((i,n)=>{const o=new MessageChannel;o.port1.onmessage=e=>{e.data.error?n(e.data.error):i(e.data)},e.postMessage(t,[o.port2])}))}handleOnStateChange(e,t,i,n){switch(this.sendServiceWorkerLifeCycleEventTelemetry(),t){case"installed":this.logger.log("Service worker got installed"),this.handleInstalledSWState(n);break;case"activated":this.logger.log("Service worker got activated"),this.isSwWaiting=!1;const t=this.scenarioFactory.findScenario(U.RG.SwStateChange);t&&(this.scenarioFactory.markStep(U.RG.SwStateChange,U.ck.SwActivated),t.stop()),this.setServiceWorkerContextForScenarios(!0);case"redundant":this.handleRedundantSWState(e,i)}e={state:t}}SendIncompleteEvent(e,t){this.fetchTelemetryStore.set(e.url,e),this.sendServiceWorkerFetchEventTelemetryInCompleteEvent(t)}setServiceWorkerContextForScenarios(e=!1){e?this.setScenarioContext(e):this.getServiceWorkerRegistration().then((e=>{this.setScenarioContext(!!e)})).catch((e=>{this.logger.error(`Error getting Service Worker registration object: ${e}`)}))}unregisterServiceWorker(e,t=!0){const i=t?"fundamentals_performance_sw_unregister":"fundamentals_performance_t1_sw_unregister_from_t2";"serviceWorker"in this.host.navigator&&(this.getServiceWorkerRegistration(t).then((t=>{t&&t.unregister().then((t=>{var n,o;null===(o=(n=this.logger).infoToTelemetry)||void 0===o||o.call(n,e,i)}))})).catch((e=>{var t,n;null===(n=(t=this.logger).errorToTelemetry)||void 0===n||n.call(t,e.toString(),i)})),this.deleteCacheStorage(e,t?f.eL:f.In),this.clearTimer())}handleRedundantSWState(e,t){"installing"===e.state?(this.isSwInstalling=!1,this.scenarioFactory.markStep(U.RG.SwStateChange,U.ck.SwInstallFailure),t.fail(),this.serviceWorkerUpdateFailureCount++,this.triggerForceUpdate()):"installed"===e.state&&(this.isSwWaiting=!1),this.setServiceWorkerContextForScenarios(!0)}triggerForceUpdate(){this.serviceWorkerUpdateFailureCount>=gF&&(this.logger.error("Will force an update when the app is idle as SW update failed repeatedly with",uF),this.handleUpdateReady())}handleInstalledSWState(e){this.isSwInstalling=!1,this.isSwWaiting=!0,this.setServiceWorkerContextForScenarios(!0),this.scenarioFactory.markStep(U.RG.SwStateChange,U.ck.SwInstalled),"storage"in this.host.navigator&&"estimate"in this.host.navigator.storage&&this.host.navigator.storage.estimate().then((e=>{var t,i;const n=e.usageDetails,o={storageUsage:e.usage,storageQuota:e.quota,cacheStorageSize:null==n?void 0:n.caches,indexedDBSize:null==n?void 0:n.indexedDB,swRegSize:null==n?void 0:n.serviceWorkerRegistrations};null===(i=(t=this.logger).infoToTelemetry)||void 0===i||i.call(t,"Teams disk footprint","fundamentals_performance_user_storage_info",o)})),(0,SE.K4)(this.host)&&this.scenarioFactory.stopScenarioIfActive(U.RG.SwStateChange),e||this.handleUpdateReady(),this.serviceWorkerUpdateFailureCount=0}logServiceWorkerTelemetry(){this.sendServiceWorkerFetchEventTelemetry(),this.recurringSendSWFetchEventTelemetryInterval=this.host.setInterval(this.sendServiceWorkerFetchEventTelemetry.bind(this),sF),this.sendServiceWorkerLifeCycleEventTelemetry()}sendServiceWorkerLifeCycleEventTelemetry(){const e=parseInt(KD,10);(0,kF.q8)(JD,e,QD,YD,this.scenarioFactory,!0).then((e=>{var t;if(void 0!==e){let i=0;const n=null!==(t=this.recentProcessedLifeCycleEventTimestamp)&&void 0!==t?t:-1;e.map((e=>{var t;const o=null!==(t=e.timestamp)&&void 0!==t?t:0;o>n&&(this.sendServiceWorkerLifeInfoAndInstallTelemetry(e),i=Math.max(i,o))})),this.recentProcessedLifeCycleEventTimestamp=i}})).catch((e=>{this.logger.error("Error fetching service worker state telemetry. Error:",e)})).then((()=>(0,kF.dR)(JD,e,QD,YD,this.scenarioFactory).catch((e=>{this.logger.error("Error deleting service worker state telemetry. Error:",e)}))))}sendServiceWorkerLifeInfoAndInstallTelemetry(e){var t,i,n,o,r,s,a,l,c,d,u,m;const g={version:e.version,type:e.type,context:e.buildVersion},h=e.message||"";switch(e.type){case oF.InstallSuccess:null===(i=(t=this.logger).infoToTelemetry)||void 0===i||i.call(t,h,"fundamentals_performance_sw_install",g);break;case oF.InstallFailure:null===(o=(n=this.logger).errorToTelemetry)||void 0===o||o.call(n,h,"fundamentals_performance_sw_install",g);break;case oF.ActivateSuccess:null===(s=(r=this.logger).infoToTelemetry)||void 0===s||s.call(r,h,"fundamentals_performance_sw_activate",g);break;case oF.ActivateFailure:null===(l=(a=this.logger).errorToTelemetry)||void 0===l||l.call(a,h,"fundamentals_performance_sw_activate",g);break;case oF.ReadIndexedDbFailure:null===(d=(c=this.logger).errorToTelemetry)||void 0===d||d.call(c,h,"fundamentals_performance_sw_read_indexed_db",g);break;default:null===(m=(u=this.logger).infoToTelemetry)||void 0===m||m.call(u,h,"fundamentals_performance_sw_state_info",g)}}registerServiceWorker(){var e;const{serviceWorkerRegistrationScenarioTimeoutInMs:t,maxSWRegistrationTrialAllowed:i}=this.context.coreSettings.get(b.J.Core),n=null!==(e=this.scenarioFactory.findScenario(U.RG.SwRegistration))&&void 0!==e?e:this.scenarioFactory.newScenario(U.RG.SwRegistration,{timeoutMs:null!=t?t:yF});n.isPaused&&n.resume(),this.attemptSWRegistration().then((e=>{this.sWRegistrationTrialCounter=0,n.stop(),this.attachEventsToInstallingServiceWorker(e,!0)})).catch((e=>{var t;n.appendEventData({retryCount:this.sWRegistrationTrialCounter,message:`SW registration attempt ${this.sWRegistrationAttempt} failed with ${e}`}),this.sWRegistrationAttempt<pF?this.sWRegistrationRetryTimer=this.host.setTimeout((()=>this.registerServiceWorker()),hF):this.sWRegistrationTrialCounter<(null!=i?i:vF)?(n.pause({reason:f.jK.Paused,pauseReason:`SW Registration trial ${this.sWRegistrationTrialCounter} attempt ${this.sWRegistrationAttempt} Failed. Retry  after 2 hours`,message:e}),this.sWRegistrationAttempt=0):(this.sWRegistrationTrialCounter=0,this.sWRegistrationAttempt=0,(null===(t=this.context.networkState)||void 0===t?void 0:t.isOnline())?(n.mark(U.ck.checkNetworkConnection),this.checkNetworkConnection().then((t=>{t.ok?n.fail({message:`SW reg is failing due to ${e} & response status: ${t.status}, content-length: ${t.headers.get("Content-Length")}, Content-Encoding:${t.headers.get("Content-Encoding")}`}):n.cancel({message:`SW reg is failing due to ${e} & response status: ${t.status}, content-length: ${t.headers.get("Content-Length")}, Content-Encoding:${t.headers.get("Content-Encoding")}`})})).catch((t=>{n.cancel({message:`SW reg is failing on check network connection error: ${t} in explict request with top Error: ${e}`})}))):n.cancel({message:`user is not online and SW reg is failing due to error: ${e}`}))}))}attemptSWRegistration(){const{enableTrustedSWScriptUrl:e}=this.context.coreSettings.get(b.J.Core);this.sWRegistrationAttempt++;const t=e&&this.trustedScriptUrl?this.trustedScriptUrl:`/${this.basePath}/serviceworker.js`;return this.host.navigator.serviceWorker.register(t,{updateViaCache:"all"})}checkNetworkConnection(){const e=this.trustedScriptUrl?this.trustedScriptUrl.toString():`/${this.basePath}/serviceworker.js`;return fetch(e)}handleUpdateReady(){const{disableSkipWaiting:e}=this.context.coreSettings.get(b.J.Core);e||this.skipWaitingServiceWorkerIfNeeded(),this.rebootService.rebootWhenLongInactive(ns.Z.AppUpdatedUsingServiceWorker,ns.d.WebClientUpdateService)}deleteCacheStorage(e,t=f.eL){if(void 0!==this.host.caches){const i=this.scenarioFactory.newScenario(U.RG.SwCleanupSwCache);this.host.caches.delete(t).then((n=>{n?i.stop({reason:e,message:`cache ${t}$ got deleted`}):i.fail({reason:`cache ${t}$ not found`})}))}}registerAndCheckForServiceWorkerUpdates(){this.sWRegistrationTrialCounter++;const{enableT1ServiceWorkerUnregistrationOnWeb:e}=this.context.coreSettings.get(b.J.Core);this.getServiceWorkerRegistration().then((t=>{var i,n;t?e&&this.context.platformService.config.clientType===wr.Bh.Web&&t.scope.startsWith(this.host.location.origin)&&!1===t.scope.includes(`/${this.basePath}/`)?(this.unregisterServiceWorker("Found T1 service worker so unregistering it",!1),this.registerServiceWorker()):(null===(n=(i=this.logger).infoToTelemetry)||void 0===n||n.call(i,dF,"fundamentals_performance_sw_update_check"),t.update()):(this.logger.log(mF),this.registerServiceWorker())})).catch((e=>{this.logger.error(`Error getting Service Worker registration object: ${e}`)}))}configureServiceWorkerEvents(){"serviceWorker"in this.host.navigator&&this.getServiceWorkerRegistration().then((e=>{e?(this.attachEventsToInstallingServiceWorker(e),e.onupdatefound=()=>{this.attachEventsToInstallingServiceWorker(e)}):this.logger.log(mF)}))}registerServiceWorkerAndLogTelemetry(){const{enableUpdateServiceWorkerRegistrationPerSession:e}=this.context.coreSettings.get(b.J.Core);this.addUpdateServiceWorkerSettings(),e?this.registerAndCheckForServiceWorkerUpdates():this.registerServiceWorker(),this.logServiceWorkerTelemetry()}addUpdateServiceWorkerSettings(e=!1){var t,i;const n=[],{serviceWorkerDeferInstallDurationInMs:o,enableServiceWorkerDynamicManifest:r,handleCdlHashRouteInServiceWorkerInstall:s,enableServiceWorkerIntegrityCheck:a}=this.context.coreSettings.get(b.J.Core);o&&Number.isInteger(o)&&this.swDeferInstallDurationInMs!==o&&(this.swDeferInstallDurationInMs=o,n.push({key:WD,value:this.swDeferInstallDurationInMs})),this.swEnableDynamicManifest!==r&&(this.swEnableDynamicManifest=null!=r&&r,n.push({key:$D,value:this.swEnableDynamicManifest})),this.swEnableIntegrityCheck!==a&&(this.swEnableIntegrityCheck=null!=a&&a,n.push({key:BD,value:this.swEnableIntegrityCheck})),this.swhandleCdlHashRoute!==s&&(this.swhandleCdlHashRoute=null!=s&&s,n.push({key:VD,value:this.swhandleCdlHashRoute}));const l=null!==(i=null===(t=this.context.i18NextWrapper)||void 0===t?void 0:t.locale)&&void 0!==i?i:"en-us";if(this.localeSetting!==l&&(this.localeSetting=l,n.push({key:HD,value:this.localeSetting})),!e){n.push({key:qD,value:this.context.platformService.ecsOverrides.environment.toString()});const e=this.context.platformService.config.clientType===wr.Bh.Maglev?"desktop":this.context.platformService.config.clientType.toString();n.push({key:zD,value:e})}n.push({key:GD,value:this.context.platformService.config.platformId.toString()}),n.length&&this.writeSettingsInServiceWorkerDb(n)}writeSettingsInServiceWorkerDb(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=parseInt(ZD,10);yield(0,kF.Zl)(XD,t,eF,tF,e,this.scenarioFactory).then((()=>{this.logger.log("Successfully updated service worker settings in Indexed DB")})).catch((e=>{this.logger.error("Error updating service worker settings in Indexed DB. Error:",e)}))}))}sendServiceWorkerFetchEventTelemetry(){this.host.navigator.serviceWorker.controller&&this.sendMessageToServiceWorker(this.host.navigator.serviceWorker.controller,"getFetchTelemetryEvents").then((e=>{e.forEach((e=>{this.sendServiceWorkerFetchEventTelemetryCompletedEvent(e)}))})).catch((e=>{this.logger.error("Error getting service worker fetch telemetry. Error:",e)})),this.sendServiceWorkerFetchEventTelemetryInCompleteEvent(sF)}sendServiceWorkerFetchEventTelemetryInCompleteEvent(e){const t=Date.now();this.fetchTelemetryStore.forEach(((i,n)=>{if(void 0===e||t-i.timestamp>e){const e={endpointUrl:i.url,fetchTelemetryEventDelta:t-i.timestamp,operationType:i.type,version:i.version,message:i.message},o=i.type===rF.OfflineAssetStart?U.RG.SwOfflineAssetFetchEvent:U.RG.SwFetchEvent;this.scenarioFactory.newScenario(o).cancel(e),this.fetchTelemetryStore.delete(n)}}))}sendServiceWorkerFetchEventTelemetryCompletedEvent(e){const t={endpointUrl:e.url,operationType:e.type,message:e.message,version:e.version,context:e.buildVersion};if(this.captureFetchEvent(e,t)){const i=this.isOfflineFetchOperation(e.type)?SF:fF;this.sendFetchEvent(i,e.type,t)}}isOfflineFetchOperation(e){let t;switch(e){case rF.OfflineAssetSuccess:case rF.OfflineAssetFailure:case rF.OfflineAssetCacheMiss:t=!0;break;default:t=!1}return t}sendFetchEvent(e,t,i){var n,o,r,s,a,l,c,d;const u=i.message||"";switch(t){case rF.Success:case rF.OfflineAssetSuccess:null===(o=(n=this.logger).infoToTelemetry)||void 0===o||o.call(n,u,e,i);break;case rF.CacheMiss:case rF.OfflineAssetCacheMiss:null===(s=(r=this.logger).warnToTelemetry)||void 0===s||s.call(r,u,e,i);break;case rF.Failure:case rF.OfflineAssetFailure:null===(l=(a=this.logger).errorToTelemetry)||void 0===l||l.call(a,u,e,i);break;default:null===(d=(c=this.logger).debugToTelemetry)||void 0===d||d.call(c,u,e,i)}}captureFetchEvent(e,t){switch(e.type){case rF.Start:case rF.OfflineAssetStart:return this.fetchTelemetryStore.set(e.url,e),!1;case rF.Failure:case rF.Success:case rF.OfflineAssetFailure:case rF.OfflineAssetSuccess:case rF.CDNAssetNotInManifest:case rF.CacheMiss:case rF.OfflineAssetCacheMiss:const i=this.fetchTelemetryStore.get(e.url);return i?(t.fetchTelemetryEventDelta=e.timestamp-i.timestamp,this.fetchTelemetryStore.delete(e.url)):t.reason="orphan",!0;case void 0:return this.logger.error("unexpected fetch event type:",e.type),!1}return!1}clearTimer(){this.host.clearInterval(this.recurringCheckForUpdateInterval),this.host.clearTimeout(this.registerSWAndLogTelemetryTimer),this.host.clearInterval(this.recurringSendSWFetchEventTelemetryInterval),this.host.clearTimeout(this.sWRegistrationRetryTimer)}registerOrUnregisterServiceWorker(e){if(e){if(!this.recurringCheckForUpdateInterval){this.recurringCheckForUpdateInterval=this.host.setInterval((()=>this.checkForUpdateAndRestartWebClient()),lF+Math.ceil(Math.random()*cF));const{serviceWorkerRegistrationDelayInMs:e}=this.context.coreSettings.get(b.J.Core),t=e&&Number.isInteger(e)?e:aF;this.registerSWAndLogTelemetryTimer=this.host.setTimeout((()=>this.registerServiceWorkerAndLogTelemetry()),t)}}else this.unregisterServiceWorker("Service Worker is not enabled");this.setServiceWorkerContextForScenarios()}setScenarioContext(e){var t,i;null===(i=(t=this.scenarioFactory).setContext)||void 0===i||i.call(t,{isServiceWorkerRegistered:e,isServiceWorkerActive:(0,SE.K4)(this.host),isServiceWorkerInstalling:this.isSwInstalling,isServiceWorkerWaiting:this.isSwWaiting})}attachEventsToInstallingServiceWorker(e,t=!1){if(!e||!e.installing)return;const i=this.scenarioFactory.newScenario(U.RG.SwStateChange);this.scenarioFactory.markStep(U.RG.SwStateChange,U.ck.SwInstalling);const n=e.installing,o={state:n.state};this.isSwInstalling=!0,this.setServiceWorkerContextForScenarios(!0),n.onstatechange=()=>this.handleOnStateChange(o,n.state,i,t)}skipWaitingServiceWorkerIfNeeded(){"serviceWorker"in this.host.navigator&&this.getServiceWorkerRegistration().then((e=>{e&&e.waiting&&e.waiting.postMessage("skipWaiting")}))}getServiceWorkerRegistration(e=!0){return e?this.host.navigator.serviceWorker.getRegistration(`/${this.basePath}/serviceworker.js`):this.host.navigator.serviceWorker.getRegistration("/serviceworker.js")}}class wF extends Ce.i{constructor(){super(f.Yg.CreateWebClientUpdate,["coreSettings"])}execute(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){t.webClientUpdateService=new bF(e);const{isUnRegisterSWOnLogoutEnabled:i}=e.coreSettings.get(b.J.Core);if(i)return e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){"signout"===e&&(yield t.webClientUpdateService.unregisterServiceWorker(e))}))}))}}var CF=i(692374);class _F extends Ce.i{constructor(){super(f.Yg.CreateWindow,["config","diagnosticsService","logsCollectorService"]),this.registerShellHandlers=(e,t,i)=>{e.opener.addEventListener(O.rY.GetLogs,(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=yield t.getDiagnosticsEvents(),o=yield i.getSystemInfo();let r="System Info: ";o&&o.size>0?o.forEach(((e,t)=>{r+=`${t}: ${e}\n`})):r+="No system info collected",n.unshift({message:`${r}`,level:T.i.Debug,levelName:T.i[T.i.Debug],timeStamp:new Date,isPiiFree:!0}),e.opener.postMessage(O.rY.GetLogs,{logs:n})}))))}}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=CF.n.getInstance(),i=t.config.hostedWindowContext,n=t.window;t.opt={postMessageConfig:e.config.postMessageConfig},n.onAppStart();const{diagnosticsService:o,logsCollectorService:r}=e;this.registerShellHandlers(n,o,r),e.hostedWindowContext=i,e.windowProvider=n}))}}class TF extends Ce.i{constructor(){super(f.Yg.DiscoverUser,["config","discover"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){e.config.skipDiscoverUser||(e.user=yield e.discover.getUser())}))}}class IF extends Ce.i{constructor(){super(f.Yg.FetchCriticalDynamicImportsTask,["criticalDynamicImports","loggerFactory","scenarioFactory","coreSettings"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{criticalDynamicImports:t,loggerFactory:i,scenarioFactory:n,coreSettings:o}=e;if(!t||0===t.length)return;(null==o?void 0:o.get(b.J.Core).enableSerializeChunkImport)?yield Promise.all(t.map((e=>(0,gl.mT)(e.importFunc,e.chunkName,n)))).catch((e=>{var t,n;null===(n=(t=i.newLogger("FetchCriticalDynamicImportsTask","core-services-tasks")).errorToTelemetry)||void 0===n||n.call(t,`Failed to preload chunk this will regress performance of first load: ${e}`,"webclient_framework_foundation_core_services_tasks",void 0,!0)})):t.forEach((({importFunc:e,chunkName:t})=>{(0,gl.mT)(e,t,n).catch((e=>{var n,o;return null===(o=(n=i.newLogger("FetchCriticalDynamicImportsTask","core-services-tasks")).errorToTelemetry)||void 0===o?void 0:o.call(n,`Failed to preload chunk ${t} this will regress performance of first load: ${e}`,"webclient_framework_foundation_core_services_tasks",void 0,!0)}))}))}))}}class jF extends Ce.i{constructor(){super(f.Yg.InitApiServiceProvider,["coreSettingsContext"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield e.coreSettingsContext.initializeApiServiceProvider()}))}}class NF extends Ce.i{constructor(){super(f.Yg.InitAsyncMediaAuthService,["mediaAuthService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{mediaAuthService:t}=e;return null==t||t.initAsyncMediaAuthService(),e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){"signout"===e&&(yield null==t?void 0:t.logout())}))}))}}var EF=i(723506);class xF extends Ce.i{constructor(){super(f.Yg.InitATPPolicyTask,["coreSettings","endpointsManager","gtmRegistry","localStorage","loggerFactory","scenarioFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,endpointsManager:i,gtmRegistry:n,localStorage:o,loggerFactory:r,scenarioFactory:s}=e,{enableFastSharepointSafelinks:a}=t.get(b.J.Messaging),l=r.newLogger("InitATPPolicyTask","core-services-tasks");if(!(null==a?void 0:a.enabled))return void l.log("InitATPPolicyTask - Do nothing, FF is disabled");const c=new EF.c(n.bind(el.l,"middleTier"),s,r,o,t,i);l.log("Getting ATP Safelinks policy"),c.initPolicy()}))}}const AF={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeAuthenticatedUser"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAuthenticatedUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}}]};let DF;class FF{constructor(e,t,i,n,o,r,s,a){var l,c,d;this._auth=e,this._client=t,this._discover=i,this._networkStateProvider=n,this._windowProvider=r,this._keepTokenActive=!1,this._keepCheckingSignInRestrictions=!1,this._isLoginRequired=void 0,this._tokenIntervalId=void 0,this._logger=s.newLogger("AuthTokenStoreService","core-services-auth-token-store"),this._mtResourceKey=(null===(l=null==a?void 0:a.get(b.J.Auth))||void 0===l?void 0:l.mtResource)||Bi.ej.MT_AAD_KEY,this._tokenWarmingIntervalInMs=(null===(c=null==a?void 0:a.get(b.J.Auth))||void 0===c?void 0:c.tokenWarmingIntervalInMs)||xa.lP.MT_TOKEN_INTERVAL,this._disableTokenWarmingForSigninRestriction=(null===(d=null==a?void 0:a.get(b.J.Auth))||void 0===d?void 0:d.disableTokenWarmingForSigninRestriction)||!1,this._subscriptions=new Map,this.observeIsLoginRequired(),this.observeAppOnlineState()}observe(e){let t=this._subscriptions.get(e);return t||(t=this.createSubscription(e),this._subscriptions.set(e,t)),t}createSubscription(e){let t;switch(e){case Bi.ej.MT_KEY:this._keepTokenActive=!0,t=this._auth.observeMiddleTierToken(),this.keepTokenActive();break;case Bi.ej.SIGNIN_RESTRICTIONS_KEY:this._keepCheckingSignInRestrictions=!0,this.keepTokenActive();break;default:this._logger.error("Unable to create subscription, token key %s is not supported",e)}return t}keepTokenActive(){this._tokenIntervalId||(this._keepTokenActive||this._keepCheckingSignInRestrictions)&&(this._tokenIntervalId=this._windowProvider.setInterval((()=>{if(this._keepCheckingSignInRestrictions&&this._disableTokenWarmingForSigninRestriction){let e=(0,Ta.pW)();e=`sign${e.substr(Bi.uI.FOUR)}`,this._auth.acquireToken(Bi.ej.SIGNIN_RESTRICTIONS_KEY,{correlationId:e}).catch((e=>{this.handleSignInRestrictionsError(e)}))}this._keepTokenActive&&this._auth.acquireToken(this._mtResourceKey).then((()=>this._discover.validateSkypeToken())).catch((e=>{this._logger.error("Error occurred in keeping MT token active.",e)}))}),this._tokenWarmingIntervalInMs))}handleSignInRestrictionsError(e){if(this._logger.error(`Error occurred in keeping SignInRestrictions token active. ErrorCode: ${null==e?void 0:e.errorCode}`,e),(null==e?void 0:e.errorCode)===Bi.SM.SignInRestrictions){this._logger.error("Sign in restrictions was enabled and caught by the periodic check. Forcibly signing out the user");const e={id:(0,Ta.pW)(),source:"auth-token-store",scenarioName:U.RG.AuthWebLogout},[t,i]=(0,_a.OU)({options:{correlation:e},scenarioName:e.scenarioName,source:e.source,subContext:"auth-token-store::handleSignInRestrictionsError"});t.appendScenarioEventData({operationType:Bi.SM.SignInRestrictions}),this._client.mutate({mutation:AF,variables:{reason:Bi.SM.SignInRestrictions},context:{correlation:e}}),i()}else this._logger.error("Sign in restrictions token acquisition threw an unexpected error",e)}observeIsLoginRequired(){this._auth.isLoginRequired.subscribe((e=>{if(this._isLoginRequired===e)return;const t=void 0===this._isLoginRequired;this._isLoginRequired=e,t||(this._isLoginRequired?this._tokenIntervalId&&(this._windowProvider.clearInterval(this._tokenIntervalId),this._tokenIntervalId=void 0):this.replayKeepTokenActiveState())}))}observeAppOnlineState(){this._networkStateProvider.observeIsOnline().subscribe((e=>{e?this.replayKeepTokenActiveState():this._tokenIntervalId&&(this._windowProvider.clearInterval(this._tokenIntervalId),this._tokenIntervalId=void 0)}))}replayKeepTokenActiveState(){if(0===this._subscriptions.size)return;const e=this._subscriptions.keys();let t=e.next();for(;!t.done;)this.keepTokenActive(),t=e.next()}}class OF extends Ce.i{constructor(){super(f.Yg.InitAuthenticationService,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{client:t,discover:i,authenticationUser:n,authenticationService:o,networkState:r,loggerFactory:s,coreSettings:a,scenarioFactory:l}=e,{enableSignInRestrictions:c,prefetchTokens:d,disableTokenWarming:u,enableTokenWarming:m,tokenWarmingResources:g}=a.get(b.J.Auth);if(!n)return;const h=((e,t,i,n,o,r,s)=>(DF||(DF=new FF(i,e,t,n,o,(0,F.J)(),r,s)),DF))(t,i,o,r,l,s,a);c&&h.observe(Bi.ej.SIGNIN_RESTRICTIONS_KEY),!u&&h.observe(Bi.ej.MT_KEY);const p=[];null==d||d.forEach((e=>e&&p.push(e))),m&&g&&g.forEach((e=>{e&&p.indexOf(e)<0&&p.push(e)})),p.forEach((e=>o.acquireToken(e).catch((()=>{}))))}))}}class MF{constructor(e,t,i){this.coreSettings=e,this.host=i,this.defaultScreenshotsTimeoutMs=5e3,this.brbServiceMap=new Map,this.brbExtendedServiceMap=new Map,this.rootToolsManagerMap=new Map,this.logger=t.newLogger("BrbServiceManager","core-services-brb")}registerRootToolsManager(e,t){t.setBRBCallback(this.onBrbRequested(e)),this.rootToolsManagerMap.set(e,t)}registerUserBrbExtendedFeedbackProvider(e,t){var i,n;null===(n=(i=this.logger).logNoPii)||void 0===n||n.call(i,"Registering a new BRB extended feedback provider for account");const o=this.getOrCreateUserBrbExtendedFeedbackProviderSet(e);o.add(t),this.brbExtendedServiceMap.set(e,o)}unregisterUserBrbExtendedFeedbackProvider(e){var t,i;return null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,"Unregistering an existing BRB service for account"),this.brbExtendedServiceMap.delete(e)}registerUserBrbService(e,t){var i,n;null===(n=(i=this.logger).logNoPii)||void 0===n||n.call(i,"Registering a new BRB service for account"),this.brbServiceMap.set(e,t)}unregisterUserBrbService(e){var t,i;return null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,"Unregistering an existing BRB service for account"),this.rootToolsManagerMap.delete(e),this.brbServiceMap.delete(e)}getBrbFormData(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{categories:i,disclaimer:n}=this.coreSettings.get(b.J.Brb),o=[];return null==i||i.forEach((e=>{e&&o.push({id:e.id,name:e.name})})),null===(t=(e=this.logger).logNoPii)||void 0===t||t.call(e,"Returning data for BRB form",o),{disclaimer:n||f.bA,categories:o}}))}getBrbScreenshots(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=this.getOrCreateUserBrbService(e);if(i){const{screenshotsTimeoutMs:e}=this.coreSettings.get(b.J.Brb,["screenshotsTimeoutMs"]);let n=0;const o=new Promise((t=>{n=this.host.setTimeout((()=>{var e,i;null===(i=(e=this.logger).logNoPii)||void 0===i||i.call(e,"Screenshots timeout. Returning undefined for BRB screenshots."),n=0,t(void 0)}),null!=e?e:this.defaultScreenshotsTimeoutMs)})),r=i.getBrbScreenshots(t).then((e=>{var t,i;return null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,`Screenshots received: ${null==e?void 0:e.length}`),e}));return Promise.race([r,o]).then((e=>(n&&this.host.clearTimeout(n),e)))}return Promise.resolve(void 0)}))}createBrbItem(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=this.getOrCreateUserBrbService(e),o=yield(null==n?void 0:n.createBrbItem(t,i))||void 0;if(!o)return o;const{enableMTMA:r}=this.coreSettings.get(b.J.Core);if(r){Array.from(this.brbServiceMap.keys()).filter((t=>t!==e)).forEach((e=>{const n=this.getOrCreateUserBrbService(e);null==n||n.extendBrbReports(t,o,i)}))}const s=this.getOrCreateUserBrbExtendedFeedbackProviderSet(e);if(n&&s){const e=yield n.getSystemInfo();s.forEach((i=>i.extendedBrbFeedback(t,o,e)))}return o}))}createAutoBrbItem(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return yield this.createBrbItem(e,t,!0)}))}onBrbRequested(e){return t=>{this.logger.log(`onBrbRequested called >>> event ${t.uploadId}`);const i={categoryId:"11",text:"Extend report",includeHeapSnapshot:!1};if(e){const n=this.getOrCreateUserBrbService(e);n?(null==n||n.extendBrbReports(i,{containerId:t.uploadId}),this.logger.log("setBRBCallback >>> called extendBrbReports")):this.logger.warn("setBRBCallback >>> could not call extendBrbReports brbService undefined")}else this.logger.warn(`setBRBCallback >>> userKey is null uploadId: ${t.uploadId}`)}}getOrCreateUserBrbExtendedFeedbackProviderSet(e){const t=this.brbExtendedServiceMap.get(e);return null!=t?t:new Set}getOrCreateUserBrbService(e){var t,i,n,o,r,s;const a=this.brbServiceMap.get(e);if(!(a&&a instanceof Function))return null===(s=(r=this.logger).logNoPii)||void 0===s||s.call(r,`Found existing BRB service for account ${e}`),a;null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,`Creating BRB service for account ${e}`);try{const t=a(),i=this.rootToolsManagerMap.get(e);return i&&t.registerRootToolsManager(i),this.brbServiceMap.set(e,t),t}catch(t){return void(null===(o=(n=this.logger).logNoPii)||void 0===o||o.call(n,`Failed to create BRB service for account ${e}`))}}}class RF extends Ce.i{constructor(){super(f.Yg.InitBrbServiceManagerTask,["coreSettings","loggerFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,loggerFactory:i,windowProvider:n}=e;e.brbServiceManager=new MF(t,i,n)}))}}var PF=i(218228),LF=i(472200),UF=i(917556);class WF{constructor(e,t,i,n,o,r,s,a){this.coreSettings=e,this.useAccessCheckV2=i,this.hostComm=n,this.scenarioFactory=o,this.appSwitcherPolicyCheckService=r,this.authenticationService=s,this.rebootService=a,this.logger=t.newLogger("ClientAccessAdminPolicyCheckService","services-utilities-core"),this.useAccessCheckV2=i}isUserAllowed(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log("isUserAllowed::start");let e=!1;const{useNewTeamsClient:t}=this.coreSettings.get(b.J.Core,["useNewTeamsClient"]);switch(this.logger.log(`isUserAllowed: useNewTeamsClient: ${t}`),t){case"AdminDisabled":e=!1;break;case"MicrosoftChoice":this.useAccessCheckV2&&(e=yield this.isUserAllowedV2()),e||(e=this.isUserAllowedViaAppSwitcher());break;default:e=!0}return this.logger.log(`isUserAllowed: returned ${e}`),e}))}rebootOnPolicyChangeToAdminDisabled(){this.logger.log("Will observe changes to useNewTeamsClient policy");const e=this.scenarioFactory.newScenario(U.RG.AppSwitcherObserveUseNewTeamsPolicy),t=this.coreSettings.getObservable(b.J.Core,["useNewTeamsClient"]).pipe((0,u.h)((({useNewTeamsClient:e})=>void 0!==e))).subscribe((({useNewTeamsClient:i})=>{e.stop({reason:`initial_value_${i}`}),t.unsubscribe(),this.logger.log("Stopped observing changes to useNewTeamsClient policy"),"AdminDisabled"===i&&(this.logger.log("useNewTeamsClient policy changed to AdminDisabled, rebooting"),this.rebootService.rebootApp(ns.Z.ClientAccessPolicyAdminDisabled,ns.d.ClientAccessAdminPolicyCheckService))}))}rebootIfUserBecomesAllowedLater(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(yield this.isUserAllowed())return void this.logger.error("rebootIfUserBecomesAllowedLater: user is already allowed. Skipped.");const e=()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){(yield this.isUserAllowed())&&(this.logger.log("User is now allowed to use T2.1, rebooting to enable T2.1"),this.rebootService.rebootApp(ns.Z.ClientAccessPolicyUserAllowed,ns.d.ClientAccessAdminPolicyCheckService))})),{useNewTeamsClient:t}=this.coreSettings.get(b.J.Core,["useNewTeamsClient"]);if("AdminDisabled"===t){const i=this.coreSettings.getObservable(b.J.Core,["useNewTeamsClient"]).pipe((0,u.h)((({useNewTeamsClient:e})=>"AdminDisabled"!==e))).subscribe((()=>{this.logger.log(`useNewTeamsClient policy changed from AdminDisabled to ${t}. Checking if user is now allowed.`),i.unsubscribe(),e()}))}}))}shouldUserAttemptT1Cleanup(){var e;return(0,LF.aj)([null===(e=this.appSwitcherPolicyCheckService)||void 0===e?void 0:e.getAppSwitcherEffectivePolicy(),this.coreSettings.getObservable(b.J.Core,["forceEnableT1Cleanup","disableAppSwitcherWin10TFLCheck","forceAppSwitcherWin10MSACheck","t1UninstallDelayTimeInDays","enableT1UninstallDelay"]),this.coreSettings.getObservable(b.J.Platform,["deviceInfo"]),this.coreSettings.getObservable(b.J.HostCapabilities,["t1InstallPresent"])]).pipe((0,vt.w)((([e,t,i,n])=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{forceEnableT1Cleanup:o,disableAppSwitcherWin10TFLCheck:r,forceAppSwitcherWin10MSACheck:s,t1UninstallDelayTimeInDays:a,enableT1UninstallDelay:l}=t,{deviceInfo:c}=i,{t1InstallPresent:d}=n;return!(!e&&void 0===o)&&this.shouldUserAttemptT1CleanupInternal(e,!!d,!!o,!!s,!!r,null!=a?a:void 0,!!l,null!=c?c:void 0,this.appSwitcherPolicyCheckService)})))))}shouldUserAttemptT1CleanupInternal(e,t,i,n,r,s,a,l,c){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log("shouldUserAttemptT1Cleanup::start");const o=this.scenarioFactory.newScenario(U.RG.AppSwitcherCheckT1CleanupPolicy);if(i)return o.stop({reason:"force_enable"}),this.appSwitcherPolicyCheckService.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: T1 was force uninstalled."),!0;if(this.logger.log(`shouldUserAttemptT1Cleanup: got appSwitcherEffectivePolicy=${e}`),(null==e?void 0:e.toLocaleUpperCase())===PF.m7.T21_ONLY){if(!t)return this.logger.log("shouldUserAttemptT1Cleanup: T1 install not present, skipping uninstall"),o.cancel({reason:"t1_not_present"}),this.appSwitcherPolicyCheckService.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: T1 is not present."),!1;if(!this.isT1UninstallDelayTimeReached(s,a,c,o))return o.cancel({reason:"t1_uninstall_delay_time_not_reached"}),this.logger.log("shouldUserAttemptT1Cleanup: T1 uninstall delay time not reached, skipping"),!1;const e=!l||!(0,UF.E)(l)||n;return r?e?(this.logger.log("shouldUserAttemptT1Cleanup: OS version < Win11, skipping uninstall"),o.cancel({reason:"win10_cleanup_disabled"}),!1):(o.stop(),c.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: Delay time met and shouldUserAttemptT1CleanupInternal returning true."),!0):(yield this.isMSAHostedOnMachine())&&e?(this.logger.log("shouldUserAttemptT1Cleanup: T1 hosting MSA, skipping uninstall"),o.cancel({reason:"win10_msa_acct_detected"}),!1):(this.logger.log("shouldUserAttemptT1Cleanup: Starting T1 uninstall"),o.stop(),c.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: Delay time met and shouldUserAttemptT1CleanupInternal returning true."),!0)}return o.cancel({reason:"invalid_policy"}),this.appSwitcherPolicyCheckService.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: Effective policy is not T21_ONLY."),!1}))}isUserAllowedViaAppSwitcher(){const{installedThroughAppSwitcher:e}=this.coreSettings.get(b.J.Host,["installedThroughAppSwitcher"]);return this.logger.log(`isUserAllowedViaAppSwitcher: installedThroughAppSwitcher: ${e}`),!!e}isUserAllowedV2(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{allowUserOnMicrosoftChoice:e}=this.coreSettings.get(b.J.Core,["allowUserOnMicrosoftChoice"]);if(!e)return this.logger.log("isUserAllowedV2: returned false due to allowUserOnMicrosoftChoice=false"),!1;const{disableEduCheckOnMicrosoftChoice:t}=this.coreSettings.get(b.J.Core,["disableEduCheckOnMicrosoftChoice"]);if(!t&&this.isEdu())return this.logger.log(`isUserAllowedV2: returned false due to EDU, disableEduCheckOnMicrosoftChoice=${t}`),!1;const{disableVdiCheckOnMicrosoftChoice:i}=this.coreSettings.get(b.J.Core,["disableVdiCheckOnMicrosoftChoice"]);return!i&&(yield this.isVdi())?(this.logger.log(`isUserAllowedV2: returned false due to VDI, disableVdiCheckOnMicrosoftChoice=${i}`),!1):(this.logger.log("isUserAllowedV2: returned true due to allowUserOnMicrosoftChoice=true"),!0)}))}isVdi(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.hostComm)return this.logger.warn("isVdi: returned false - invalid hostComm"),!1;const e=yield this.hostComm.loadModule("vdi");if(!e||!e.isVDI)return this.logger.warn(`isVdi: returned false - invalid VDI function, vdiModule=${!!e}`),!1;const t=yield e.isVDI();return this.logger.log(`isVdi: returned ${t}`),t}))}isEdu(){const{licenseType:e}=this.coreSettings.get(b.J.UserResources);return this.logger.log(`isEdu: licenseType=${e}`),!(!e||"Student"!==e&&"Teacher"!==e)}isMSAHostedOnMachine(){var e,t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(null!==(i=yield null===(t=(e=this.authenticationService).getHostMachineUsers)||void 0===t?void 0:t.call(e,""))&&void 0!==i?i:[]).filter((e=>"MsaLife"===e.accountType)).length>0}))}isT1UninstallDelayTimeReached(e,t,i,n){if(t){const t=new Date,o=i.getNewTeamsOnlyEffectivePolicyStartTime();if(!o){const e=i.setNewTeamsOnlyEffectivePolicyStartTime(t.toISOString());this.logger.log(`shouldUserAttemptT1Cleanup: starting T1 uninstall delay timer was successful: ${e}`);const o={startTime:t.toISOString()};return n.mark(U.ck.NewTeamsOnlyEffectivePolicyStartTimeSet,o),!1}const r=new Date(o),s=(t.getTime()-r.getTime())/864e5;this.logger.log(`shouldUserAttemptT1Cleanup: timer start: ${o}, T1 uninstall delay time in days: ${s}`);const a={startTime:o,currentTime:t.toISOString()};return e&&s>=e?(this.logger.log("shouldUserAttemptT1Cleanup: T1 uninstall delay time reached, uninstalling T1"),n.mark(U.ck.T1UninstallDelayTimeReached,a),!0):(n.mark(U.ck.T1UninstallDelayTimeNotReached,a),!1)}return!0}}class BF extends Ce.i{constructor(){super(f.Yg.InitClientAccessAdminPolicyCheck,["appSwitcherPolicyCheckService","coreSettings","coreSettingsContext","hostCommunicationService","loggerFactory","rebootService","scenarioFactory","authenticationService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{appSwitcherPolicyCheckService:t,coreSettings:i,coreSettingsContext:n,hostCommunicationService:o,loggerFactory:r,rebootService:s,scenarioFactory:a,authenticationService:l}=e,c=r.newLogger("InitClientAccessAdminPolicyCheckTask","core-services-tasks"),{enableAppSwitcherTACSettingsSync:d}=i.get(b.J.Core,["enableAppSwitcherTACSettingsSync"]),{enableAppSwitcherTACSettingsSyncV2:u}=i.get(b.J.Core,["enableAppSwitcherTACSettingsSyncV2"]);if(!d&&!u)return void c.log("Both enableAppSwitcherTACSettingsSync and enableAppSwitcherTACSettingsSyncV2 are false, skipping ClientAccessAdminPolicyCheckService initialization.");const m=new WF(i,r,!!u,o,a,t,l,s);e.clientAccessAdminPolicyCheckService=m;const{shouldRebootOnPolicyChangeToAdminDisabled:g}=i.get(b.J.Core,["shouldRebootOnPolicyChangeToAdminDisabled"]);if(g&&!n.getInitialStateHints().primaryUserHadPolicyCache&&m.rebootOnPolicyChangeToAdminDisabled(),!(yield m.isUserAllowed()))throw m.rebootIfUserBecomesAllowedLater(),new Ne.G(Ne.$.DISABLED_BY_ADMIN)}))}}class $F{constructor(e,t,i,n){this.coreSettings=e,this.scenarioFactory=i,this.localStorage=n,this.logger=t.newLogger("AppSwitcherPolicyCheckService","services-utilities-core")}getAppSwitcherEffectivePolicy(){return(0,LF.aj)([this.coreSettings.getObservable(b.J.Core,["useNewTeamsClient","enableT1AppSwitcherEffectivePolicyFetch","appSwitcherCohortSettings","appSwitcherDebugEffectivePolicy"]),this.coreSettings.getObservable(b.J.HostCapabilities,["t1AppSwitcherEffectivePolicy"]),this.getAppSwitcherCohort()]).pipe((0,c.U)((([e,t,i])=>{const n=this.scenarioFactory.newScenario(U.RG.AppSwitcherIdentifyPolicy),{useNewTeamsClient:o,enableT1AppSwitcherEffectivePolicyFetch:r,appSwitcherCohortSettings:s,appSwitcherDebugEffectivePolicy:a}=e,{t1AppSwitcherEffectivePolicy:l}=t;if(a)return n.stop({policy:a,reason:"DebugForced"}),a;let c;if(o)switch(o){case"UserChoice":c=PF.m7.USER_CHOICE;break;case"AdminDisabled":c=PF.m7.ADMIN_DISABLED;break;case"NewTeamsAsDefault":c=PF.m7.T21_DEFAULT;break;case"NewTeamsOnly":c=PF.m7.T21_ONLY;break;case"MicrosoftChoice":c=this.getMicrosoftChoicePolicyForUser(i,null!=s?s:void 0,!!r,null!=l?l:"",n);break;default:c=PF.m7.T1_DEFAULT}return n.stop({policy:c,cohort:i,t1Cohort:null!=l?l:"",adminPolicy:null!=o?o:void 0}),this.logger.log(`getAppSwitcherEffectivePolicy: useNewTeamsClient=${o} cohort=${i} policy=${c}`),c})))}getAppSwitcherCohort(){return(0,LF.aj)([this.coreSettings.getObservable(b.J.HostCapabilities,["officeUpdateRegkey"]),this.coreSettings.getObservable(b.J.Metadata,["ring"]),this.coreSettings.getObservable(b.J.UserResources,["licenseType"]),this.coreSettings.getObservable(b.J.Platform,["deviceInfo"]),this.coreSettings.getObservable(b.J.Host,["authBootstrapData"])]).pipe((0,c.U)((([e,t,i,n,o])=>{var r;const s=this.scenarioFactory.newScenario(U.RG.AppSwitcherIdentifyCohort),a=this.getAppSwitcherCohortFromSettings(s,i.licenseType,null===(r=o.authBootstrapData)||void 0===r?void 0:r.licenseDetails,e,n,t.ring);return s.stop({reason:"FromSettings",cohort:a}),a})))}setNewTeamsOnlyEffectivePolicyStartTime(e){return this.localStorage.trySet("newTeamsOnlyEffectivePolicyStartTime",e,"Framework","UserAndExperience")}getNewTeamsOnlyEffectivePolicyStartTime(){const e=this.localStorage.get("newTeamsOnlyEffectivePolicyStartTime","UserAndExperience");return e||void 0}removeNewTeamsOnlyEffectivePolicyStartTime(){this.localStorage.remove("newTeamsOnlyEffectivePolicyStartTime","UserAndExperience")}getMicrosoftChoicePolicyForUser(e,t,i,n,o){let r;return this.logger.log(`getMicrosoftChoicePolicyForUser: cohort=${e} enableT1AppswitcherEffectivePolicyFetch=${i} t1AppSwitcherEffectivePolicyHint=${n}`),t&&(r=this.getCohortPolicyFromECS(e,t),r)?(o.appendEventData({reason:"FromSettings"}),r.toLocaleUpperCase()):!r&&n&&i?(o.appendEventData({reason:"T1Hint"}),n.toLocaleUpperCase()):void 0}getCohortPolicyFromECS(e,t){let i;switch(e){case PF.bi.M365BusinessLicenseCohort:i=null==t?void 0:t.M365BusinessLicenseCohort;break;case PF.bi.EarlyEnterpriseCohort:i=null==t?void 0:t.EarlyEnterpriseCohort;break;case PF.bi.MidEnterpriseCohort:i=null==t?void 0:t.MidEnterpriseCohort;break;case PF.bi.AdminsOfLateEnterpriseCohort:i=null==t?void 0:t.AdminsOfLateEnterpriseCohort;break;case PF.bi.GovCloudCohort:i=null==t?void 0:t.GovCloudCohort;break;case PF.bi.LateEnterpriseCohort:i=null==t?void 0:t.LateEnterpriseCohort;break;case PF.bi.MacR36Cohort:i=null==t?void 0:t.MacR36Cohort;break;case PF.bi.MacR4Cohort:i=null==t?void 0:t.MacR4Cohort;break;case PF.bi.EduCohort:i=null==t?void 0:t.EduCohort;break;case PF.bi.InternalRingCohort:i=null==t?void 0:t.InternalRingCohort;break;case PF.bi.ExternalTapCohort:i=null==t?void 0:t.ExternalTapCohort;break;case PF.bi.NoPPChannelCohort:i=null==t?void 0:t.NoPPChannelCohort}return null!=i?i:void 0}getAppSwitcherCohortFromSettings(e,t,i,n,o,r){var s,a;const l=(null===(s=null==r?void 0:r.id)||void 0===s?void 0:s.toLocaleLowerCase())||"",c=(null==n?void 0:n.officeUpdateRegkey)||"";if("Student"===t||"Teacher"===t)return e.appendEventData({licenseType:t}),PF.bi.EduCohort;if(["gcc","gcch","dod","ag08","ag09","gallatin"].includes(l))return PF.bi.GovCloudCohort;if("macOS"===(null===(a=null==o?void 0:o.deviceInfo)||void 0===a?void 0:a.osName)){if("ring3_6"===l)return PF.bi.MacR36Cohort;if("general"===l)return PF.bi.MacR4Cohort}return $F.internalRings.includes(l)?PF.bi.InternalRingCohort:"ring3_6"===l?PF.bi.ExternalTapCohort:(e.appendEventData({officeUpdateRegkey:c}),"production::mec"===c?PF.bi.MidEnterpriseCohort:"insiders::frdc"===c?PF.bi.AdminsOfLateEnterpriseCohort:"production::cc"!==c||(null==i?void 0:i.appSwitcherBusinessLicenseCategory)?Object.values(PF.GO).includes(null==i?void 0:i.appSwitcherBusinessLicenseCategory)?(e.appendEventData({businessLicenseCategory:(null==i?void 0:i.appSwitcherBusinessLicenseCategory)||""}),PF.bi.M365BusinessLicenseCohort):c?PF.bi.LateEnterpriseCohort:PF.bi.NoPPChannelCohort:PF.bi.EarlyEnterpriseCohort)}}$F.internalRings=["ring0","ring1","ring1_5","ring1_6","ring2","ring3","ring3_9"];class HF extends Ce.i{constructor(){super(f.Yg.InitAppSwitcherPolicyCheck,["coreSettings","loggerFactory","telemetryService","scenarioFactory","localStorage"]),this._updateTelemetryOnPolicyStateChange=(e,t)=>{e.getAppSwitcherEffectivePolicy().subscribe((e=>{t.setCoreContext("appswitcherEffectivePolicy",e)}))}}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,loggerFactory:i,telemetryService:n,scenarioFactory:o,localStorage:r}=e,s=i.newLogger("InitAppSwitcherPolicyCheckTask","core-services-tasks"),a=new $F(t,i,o,r);s.log("AppSwitcherPolicyCheckService initialization done."),e.appSwitcherPolicyCheckService=a,this._updateTelemetryOnPolicyStateChange(a,n)}))}}class qF extends Ce.i{constructor(){super(f.Yg.InitDesktopEcsContext,["coreSettings","discover","hostCommunicationService","i18NextWrapper","loggerFactory","platformService","primaryUser"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,discover:i,hostCommunicationService:n,i18NextWrapper:o,loggerFactory:r,platformService:s,primaryUser:a}=e,l=yield n.loadModule("ecs");if(null==l?void 0:l.setEcsContext){const e=yield this.getDesktopEcsFilters(t,i,o,r,s,a);l.setEcsContext(e)}}))}getDesktopEcsFilters(e,t,i,n,r,s){var a,l,c,d;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{ring:o,environment:u,countryCode:m}=e.get(b.J.Metadata),{enableLocaleFilterForFeatureFlags:g,disableRegionParamForMaglev:h,enableCountryFilterForFeatureFlags:p}=e.get(b.J.Core,["enableLocaleFilterForFeatureFlags","disableRegionParamForMaglev","enableCountryFilterForFeatureFlags"]);let v;if(!h)try{v=yield t.getRegion({id:s.id,tenantId:s.profile.tenantId,oid:s.profile.objectId,accountType:s.type,userName:s.loginUserName||""})}catch(e){null===(l=(a=n.newLogger("InitDesktopEcsContextTask","core-services-tasks")).errorToTelemetry)||void 0===l||l.call(a,"Failed to fetch region info from discover service.","webclient_framework_foundation_core_services_tasks",void 0,!0)}const{isInternalUser:y}=r.config,{originalRing:f}=r.ecsOverrides,S=g?i.locale:void 0,k=p?m:void 0;return u||null===(d=(c=n.newLogger("InitDesktopEcsContextTask","core-services-tasks")).errorToTelemetry)||void 0===d||d.call(c,"Environment is undefined","webclient_framework_foundation_core_services_tasks",void 0,!0),{cloud:u||"",isInternalUser:y,locale:S,originalRing:f,region:v,countryCode:k||void 0,ring:(null==o?void 0:o.id)||"general",tenantId:s.profile.tenantId,userId:s.profile.objectId}}))}}var zF=i(231194);function VF(e,t){return(i,n,o)=>{if(n>=ia.qb.OK&&n<=ia.qb.NOT_MODIFIED)return!1;const r=i<e&&n!==ia.qb.BAD_REQUEST&&n!==ia.qb.NOT_AUTHORIZED;return t.warn(`imageCookieRetryPolicy retry count ${i} responseCode ${n} canRetry ${r}`),r}}var GF=i(921961);function JF(e,t){return()=>({url:"v1/imageauth/cookie",method:"POST",headers:{"x-ms-client-caller":"imageAuthCookieSetupEM","x-ms-client-type":(0,GF.I)(e,t)},credentials:"include",apiName:"consumerGroupsImageAuthCookie"})}function KF(e,t){const i=(0,xe.v4)();return()=>({url:"v1/imageauth/deletecookie",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",RequestId:i,CorrelationId:i,TransactionId:i,"x-ms-client-type":(0,GF.I)(e,t)},credentials:"include",apiName:"consumerGroupsImageAuthCookie"})}const QF="tfl_media_auth_cookie_service";class YF{constructor(e,t,i,n,o,r,s,a,l){var c,d;this._endpointsManager=t,this._platformService=i,this._authenticationService=n,this._networkState=o,this._coreSettings=r,this._authStateProvider=s,this._config=a,this._localStorage=l,this._imageAuthCookieExpiryTsKey="ConsumerGroupsImageAuthCookieExpiryTs",this._imageCookieRetryInterval=2e4,this._imageCookieRetryMaxCount=5,this._authStateSubscription=void 0,this._networkStateSubscription=void 0,this._isInitialized=!1,this._consumerGroupsImageAuthCookieExpiryTs=void 0,this.setupConsumerGroupsImageAuthCookieEndpoints=({discover:e,authenticationResources:t,authenticationService:i})=>({baseUrlPromise:()=>e.regionGtm("groupsServiceV2"),serviceName:ra.E.GroupsServiceV2,authResource:(0,zF.Nc)(i,t,zF.jP),models:{setupConsumerGroupsImageAuthCookie:this.setupConsumerGroupsImageAuthCookie(),deleteConsumerGroupsImageAuthCookie:this.deleteConsumerGroupsImageAuthCookie()}}),this._logger=e.newLogger("Consumer Groups media auth service","services-io-browser-consumer-groups-media-auth-service"),this._imageCookieRetryInterval=(null===(c=this._coreSettings.get(b.J.ConsumerGroups))||void 0===c?void 0:c.imageCookieRetryInterval)||2e4,this._imageCookieRetryMaxCount=(null===(d=this._coreSettings.get(b.J.ConsumerGroups))||void 0===d?void 0:d.imageCookieRetryMaxCount)||5,this._window=(0,F.J)(),this._consumerGroupsImageAuthCookieApi=this._endpointsManager.createApi(this.setupConsumerGroupsImageAuthCookieEndpoints)}initConsumerGroupsMediaAuthService(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this._isInitialized)this.logToTelemetry("ConsumerGroupsMediaAuthService already initiated, skipping initialization");else{this.logToTelemetry("initiating ConsumerGroupsMediaAuthService");try{yield this.fetchCookie("serviceInit"),this.subscribeToAuthStateChange(),this.subscribeToNetworkStateChange(),this.logToTelemetry("ConsumerGroupsMediaAuthService initiated"),this._isInitialized=!0}catch(e){this.logToTelemetry("failed to initiate ConsumerGroupsMediaAuthService",!0)}}}))}logout(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.cleanupCookieExpireInfo();try{yield this._consumerGroupsImageAuthCookieApi.deleteConsumerGroupsImageAuthCookie(),this._authStateSubscription&&this._authStateSubscription.unsubscribe(),this._networkStateSubscription&&this._networkStateSubscription.unsubscribe(),this._cookieRefetchInterval&&this._window.clearTimeout(this._cookieRefetchInterval),this.logToTelemetry("deleted cookie on logout")}catch(e){this.logToTelemetry("failed to delete cookie on logout",!0)}}))}checkIsCookieExpired(){var e;const{enableStoringExpireInfoOnConsumerGroupsMediaAuthServiceClass:t}=this._coreSettings.get(b.J.ConsumerGroups),i=t?this._consumerGroupsImageAuthCookieExpiryTs:null===(e=this._localStorage)||void 0===e?void 0:e.get(this._imageAuthCookieExpiryTsKey,"Global");if(!i)return this.logToTelemetry("cookie not found"),!0;if(i){const e=1e3*Number(i);if(Date.now()>e)return this.logToTelemetry("cookie expired"),!0}return!1}fetchCookie(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.checkIsCookieExpired())return void this.logToTelemetry(`cookie not expired, skipping fetchCookie for ${e}`);const t=yield this.getAuthToken();try{t&&(null==t?void 0:t.expires)&&(yield this._consumerGroupsImageAuthCookieApi.setupConsumerGroupsImageAuthCookie(),yield this.storeCookieExpireInfo(t.expires),this._consumerGroupsImageAuthCookieExpiryTs=t.expires,this.handleCookieRefetchInterval(t.expires),this.logToTelemetry(`setupConsumerGroupsImageAuthCookie successful for ${e}`))}catch(t){this.logToTelemetry(`setupConsumerGroupsImageAuthCookie error for ${e}`,!0)}}))}getImageCookieRetryPolicy(){return{shouldRetry:VF(this._imageCookieRetryMaxCount,this._logger),nextDelay:(e=this._imageCookieRetryInterval,t=>e*Math.pow(2,t))};var e}storeCookieExpireInfo(e){var t;null===(t=this._localStorage)||void 0===t||t.set(this._imageAuthCookieExpiryTsKey,`${e}`,"Auth","Global"),this.logToTelemetry("consumer groups cookie expire info stored in local storage succesfully")}handleCookieRefetchInterval(e){this._cookieRefetchInterval&&(this.logToTelemetry(`clearing previous cookie refetch interval: ${this._cookieRefetchInterval}`),this._window.clearTimeout(this._cookieRefetchInterval)),this.logToTelemetry(`setting cookie refetch interval at: ${e}`),this._cookieRefetchInterval=this._window.setTimeout((()=>this.fetchCookie("cookieRefetchInterval")),function(e){const t=1e3*e-Date.now();return Math.max(t,6e4)}(e))}getAuthToken(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enableStoringErrorInfoForAuthToken:t}=this._coreSettings.get(b.J.ConsumerGroups);try{if("function"==typeof(null===(e=this._authenticationService)||void 0===e?void 0:e.acquireTokenV2)){const e=yield this._authenticationService.acquireTokenV2(zF.jP);return this.logToTelemetry("getAuthToken successful"),e}return void this.logToTelemetry("getAuthToken failed due to missing acquireTokenV2 method")}catch(e){return void(t?this.logToTelemetry(`failed to get auth Token with error ${e.message}`,!0,e.message):this.logToTelemetry("failed to get auth Token",!0))}}))}cleanupCookieExpireInfo(){var e;null===(e=this._localStorage)||void 0===e||e.remove(this._imageAuthCookieExpiryTsKey,"Global")}logToTelemetry(e,t,i){var n,o,r,s;t?null===(s=(r=this._logger).errorToTelemetry)||void 0===s||s.call(r,e,QF,i?{errors:i}:void 0,!0):null===(o=(n=this._logger).infoToTelemetry)||void 0===o||o.call(n,e,QF,void 0,!0)}subscribeToNetworkStateChange(){this._networkStateSubscription=this._networkState.observeIsOnline().pipe((0,Ws.x)(),(0,u.h)((e=>!!e))).subscribe((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logToTelemetry("network state changed to online, checking cookie"),yield this.fetchCookie("networkStateChange")}))))}subscribeToAuthStateChange(){var e;this._authStateProvider?this._authStateSubscription=null===(e=this._authStateProvider)||void 0===e?void 0:e.observe().pipe((0,Ws.x)(),(0,u.h)((e=>e.state===Ca.j.Up))).subscribe((()=>{this.logToTelemetry("Auth state back Up, checking cookie"),this.fetchCookie("authStateChange")})):this.logToTelemetry("authStateProvider is not available",!0)}deleteConsumerGroupsImageAuthCookie(){return Promise.resolve({constructRequest:KF(this._platformService,this._config),allowedResponses:[ia.qj.HTTP_2XX]})}setupConsumerGroupsImageAuthCookie(){return Promise.resolve({constructRequest:JF(this._platformService,this._config),allowedResponses:[ia.qj.HTTP_2XX],retryPolicy:this.getImageCookieRetryPolicy()})}}class XF extends Ce.i{constructor(){super(f.Yg.InitConsumerGroupsMediaAuthTask,["authStateProvider","authenticationService","config","coreSettings","endpointsManager","localStorage","loggerFactory","networkState","platformService"])}execute(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=null===(t=e.coreSettings)||void 0===t?void 0:t.get(b.J.ConsumerGroups);if(!(null==i?void 0:i.useGroupsProfilePicCookieService))return;const n=function(e,t,i,n,o,r,s,a,l){return new YF(e,t,i,n,o,r,s,a,l)}(e.loggerFactory,e.endpointsManager,e.platformService,e.authenticationService,e.networkState,e.coreSettings,e.authStateProvider,e.config,e.localStorage);return e.consumerGroupsMediaAuthService=n,n.initConsumerGroupsMediaAuthService(),e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){"signout"===e&&(yield n.logout())}))}))}}class ZF{constructor(e){this.context=e,this.enabled=!1,this.globalWindow=window}writeToEtw(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.enabled){const i=yield null===(t=this.context.hostCommunicationService)||void 0===t?void 0:t.loadModule("etw"),n={message:e,channel:"JS_ETW",severity:Ax.debug};(null==i?void 0:i.writeEtwEvent)&&(null==i||i.writeEtwEvent(n))}}))}start(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield this.registerEtwUpdates()}))}isPromiseRejectionEvent(e){return"reason"in e}isErrorEvent(e){return"message"in e}handleError(e){if(this.isPromiseRejectionEvent(e))this.writeToEtw(`${e.reason.message}\n${e.reason.stack}`);else if(this.isErrorEvent(e)){const t=[e.message,e.filename,e.lineno,e.colno,e.context,e.code,e.subContext].filter(Boolean).join(",");this.writeToEtw(t)}}registerErrorHandlers(){this.globalWindow.addEventListener("unhandledrejection",this.handleError.bind(this)),this.globalWindow.addEventListener("error",this.handleError.bind(this))}unregisterErrorHandlers(){this.globalWindow.removeEventListener("unhandledrejection",this.handleError),this.globalWindow.removeEventListener("error",this.handleError.bind(this))}registerEtwUpdates(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield null===(e=this.context.hostCommunicationService)||void 0===e?void 0:e.loadModule("etw");if(null==t?void 0:t.registerForTracingChanged)try{t.registerForTracingChanged((e=>{this.enabled=e.enabled,e.enabled?this.registerErrorHandlers():this.unregisterErrorHandlers()}))}catch(e){}}))}}class eO extends Ce.i{constructor(){super(f.Yg.InitEtwTask,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=new ZF(e);yield t.start()}))}}class tO{constructor(e,t){var i,n,o,s,a,l,c,d,u,m,g,h;this.coreSettings=e,this.hostCommunicationService=t;const p=this.coreSettings.get(b.J.Metadata);this.expConfigMetadata=[{client:fD,config:{expIds:null!==(o=null===(n=null===(i=p.configIds)||void 0===i?void 0:i.experiments)||void 0===n?void 0:n.join(","))&&void 0!==o?o:"",rolloutIds:null!==(l=null===(a=null===(s=p.configIds)||void 0===s?void 0:s.rollouts)||void 0===a?void 0:a.join(","))&&void 0!==l?l:"",eTag:null!==(c=p.eTag)&&void 0!==c?c:"",expRolloutIdAllowList:null!==(u=null===(d=p.expRolloutIdAllowList)||void 0===d?void 0:d.join(""))&&void 0!==u?u:""}},{client:SD,config:{expIds:"",rolloutIds:"",eTag:null!==(m=p.hostETag)&&void 0!==m?m:"",expRolloutIdAllowList:null!==(h=null===(g=p.expRolloutIdAllowList)||void 0===g?void 0:g.join(""))&&void 0!==h?h:""}}],this.subject=new r.X(this.expConfigMetadata),this.ecmObservable=this.subject.asObservable(),this.registerSyncHostEcm()}updateHostExperimentConfigMetadata(e){const t=e.find((e=>e.client===SD)),i=this.expConfigMetadata.findIndex((e=>e.client===SD));t&&i>-1&&(this.expConfigMetadata[i]=t,this.subject.next(this.expConfigMetadata))}updateWebExperimentConfigMetadata(e){var t,i,n,o;const r=null===(t=this.expConfigMetadata.find((e=>e.client===fD)))||void 0===t?void 0:t.config;r&&e.eTag&&e.configIds&&e.configIds.experiments&&(r.eTag=e.eTag,r.expIds=e.configIds.experiments.join(","),r.expRolloutIdAllowList=null!==(n=null===(i=e.expRolloutIdAllowList)||void 0===i?void 0:i.join(","))&&void 0!==n?n:"",(null===(o=e.expRolloutIdAllowList)||void 0===o?void 0:o.length)&&(r.rolloutIds=_D(e).join(",")))}communicateWithHost(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=null===(e=this.expConfigMetadata.find((e=>e.client===fD)))||void 0===e?void 0:e.config;if(!i)return;const n=yield this.hostCommunicationService.loadModule("ecs");if(!n)return;const o=yield null===(t=n.syncEcm)||void 0===t?void 0:t.call(n,[{client:fD,config:i}]);if(o&&o.client===SD){const e=[{client:SD,config:{eTag:o.config.eTag,expIds:o.config.expIds,rolloutIds:o.config.rolloutIds,expRolloutIdAllowList:o.config.expRolloutIdAllowList}}];this.updateHostExperimentConfigMetadata(e)}}))}registerSyncHostEcm(){this.hostCommunicationService.loadModule("ecs").then((e=>{var t;null===(t=null==e?void 0:e.registerForOnSyncEcm)||void 0===t||t.call(e,(e=>{this.updateHostExperimentConfigMetadata(e)}))}))}}class iO extends Ce.i{constructor(){super(f.Yg.InitExperimentation,["coreSettings","hostCommunicationService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,hostCommunicationService:i}=e;e.experimentationService=new tO(t,i)}))}}class nO extends Ce.i{constructor(){super(f.Yg.InitPreAuthSettingsEcsProvider,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=Lu("InitPreAuthSettingsEcsProvider",e,"coreSettings","coreSettingsContext","loggerFactory","scenarioFactory","networkState","clientState","windowProvider","endpointsManager"),{coreSettings:i,coreSettingsContext:n,loggerFactory:r}=t,s=(0,o.__rest)(t,["coreSettings","coreSettingsContext","loggerFactory"]),{enablePreAuthEcsFetch:a}=i.get(b.J.Core);if(!a)return;const l=n;yield l.initializeEcsProvider(Object.assign({},s))}))}}class oO extends Ce.i{constructor(){super(f.Yg.InitSettingsEcsProvider,["coreSettings","coreSettingsContext","authenticationService","loggerFactory","scenarioFactory","networkState","clientState","windowProvider","endpointsManager"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,coreSettingsContext:i,authenticationService:n,loggerFactory:r,scenarioFactory:s,networkState:a,clientState:l,windowProvider:c,endpointsManager:d}=e,u=i,m=()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){h||(yield u.fetchEcsSettingsIfApplicable())})),{enablePreAuthEcsFetch:g}=t.get(b.J.Core),h=yield this.getPrimaryUser(n,r);yield u.setPrimaryUser(h),g||(yield u.initializeEcsProvider({scenarioFactory:s,networkState:a,clientState:l,windowProvider:c,endpointsManager:d,authenticationUser:h})),yield m()}))}getPrimaryUser(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let n;try{const t=yield null===(i=e.getCachedUsers)||void 0===i?void 0:i.call(e,{id:(0,Ta.pW)(),scenarioName:U.RG.AuthWebCachedUser,source:"init-settings-ecs-provider-task"},{isPrimaryUser:!0});t&&t.length>0&&(n=(0,Ee.KQ)(t[0]))}catch(e){t.newLogger("InitSettingsEcsProviderTask","core-services-tasks").warn("No primary user returned from authentication: ",e)}return n}))}}class rO extends Ce.i{constructor(){super(f.Yg.InitSettingsMaglevHostProvider,["coreSettingsContext","hostCommunicationService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettingsContext:t,hostCommunicationService:i}=e,{enableMaglevHostProvider:n}=t.getCoreSettings().get(b.J.Core);n&&(yield t.initializeMaglevHostProvider(i))}))}}class sO{constructor(e,t,i,n,o,r,s){this.scenarioFactory=o,this.host=r,this.clientStateProvider=s,this.namespacesToFetch=[],this.settings={},this.refreshIntervalInMs=36e5,this.fetch=()=>{if(0===this.namespacesToFetch.length)return this.logger.debug("Skipping fetch() as no namespacesToFetch registered."),Promise.resolve();const e=this.scenarioFactory.newScenario(this.getScenarioName());return this.validateEnvironment().then((()=>this.fetchPolicies(e))).catch((t=>{e.stop({errors:t},"abandoned"),this.logger.warn(`Error fetching policies: ${t}`)}))},this.validateEnvironment=()=>new Promise(((e,t)=>{this.clientStateProvider.getState()===_e.pk.VeryActive&&(this.logger.log("Cancel policy fetching, due to app being in a very active state."),t("very active")),e()})),this.cleanupClientStateSubscription=()=>{var e;null===(e=this.clientStateSubscription)||void 0===e||e.unsubscribe(),this.clientStateSubscription=void 0},this.logger=e.newLogger(`CoreSettings/${t}`,"services-io-data-policies"),this.namespacesToFetch=(0,ud.z$)(i,n),this.namespacesToFetch.forEach((e=>{this.settings[e]={}})),this.updateConfigs(n)}initialize(e=!0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.isInitialized=!0,yield this.fetchAndSetRefreshCadence()}))}subscribeForSettingsUpdates(e){this.settingsChangedCallbackFunction=e}cleanup(){var e;this.cleanupClientStateSubscription(),this.settingsChangedCallbackFunction=void 0,null===(e=this.coreSubscription)||void 0===e||e.unsubscribe(),this.coreSubscription=void 0}notifySettingsChanged(){const e=()=>{var e;this.cleanupClientStateSubscription(),null===(e=this.settingsChangedCallbackFunction)||void 0===e||e.call(this,this.settings),this.logger.debug("Notified about policy change")};return this.clientStateProvider.getState()!==_e.pk.VeryActive?(e(),!0):(this.clientStateSubscription||(this.clientStateSubscription=this.clientStateProvider.observe().subscribe((t=>{t!==_e.pk.VeryActive&&e()}))),!1)}handleError(e){this.logger.error(`Failed to fetch tenant settings with error: ${e}`)}updateConfigs(e){const t=e.getObservable(b.J.Core);this.coreSubscription=t.subscribe((e=>{e.policyRefreshIntervalInMs&&this.updateRefreshCadence(e.policyRefreshIntervalInMs)}))}updateRefreshCadence(e){this.refreshIntervalInMs=e,this.isInitialized&&this.queueNextPolicyFetch()}fetchAndSetRefreshCadence(){return this.fetch().then((()=>{this.queueNextPolicyFetch()})).catch((e=>{this.logger.error(`Error fetching policies: ${e}`)}))}queueNextPolicyFetch(){if(!this.isInitialized)throw new Error("Service not initialized to queue the fetch.");this.setIntervalHandle&&(this.host.clearInterval(this.setIntervalHandle),this.setIntervalHandle=void 0,this.logger.debug("clearInterval() called.")),this.refreshIntervalInMs>0?(this.setIntervalHandle=this.host.setInterval(this.fetch,this.refreshIntervalInMs),this.logger.debug("setInterval() called.")):this.logger.error(`Refresh interval not valid: ${this.refreshIntervalInMs}`)}}class aO extends sO{constructor(e,t,i,n,o,r){super(e,"PoliciesIpcDataProvider",t,i,n,o,r),this.handleSetAggregatedSettings=e=>{const{payload:t}=e;Object.keys(t).length>0?(this.logger.log(`handleSetAggregatedSettings() called: ${Object.keys(t).join(", ")}.`),this.parsePolicies(t),this.notifySettingsChanged()):this.logger.log("handleSetAggregatedSettings() called with empty payload.")},this.windowOpener=o.opener}initialize(e=!0){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.windowOpener.addEventListener(O.rY.SetAggregatedSettings,this.handleSetAggregatedSettings),t.initialize.call(this)}))}cleanup(){super.cleanup(),this.windowOpener.removeEventListener(O.rY.SetAggregatedSettings,this.handleSetAggregatedSettings)}getScenarioName(){return U.RG.IPCPolicyFetch}fetchPolicies(e){return this.windowOpener.requestMessage(O.rY.GetAggregatedSettings).then((t=>{let i=!1,n="success";const o=null==t?void 0:t.data;o&&0!==Object.keys(o).length?(this.logger.log(`fetchPolicies: Got policies for namespaces: ${Object.keys(o).join(", ")}.`),this.parsePolicies(o),i=this.notifySettingsChanged()):(this.logger.log("Failed to fetch policies via IPC, got empty payload data response."),n="incomplete"),e.stop({message:(0,M.u4)({notified:i})},n)})).catch((t=>{var i;this.handleError(t),e.fail({errors:null!==(i=t.message)&&void 0!==i?i:"Failed to fetch policies via IPC."})}))}parsePolicies(e){this.namespacesToFetch.forEach((t=>{e[t]&&e[t].hasOwnProperty("value")&&(this.settings[t]=e[t].value)}))}}const lO={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"policies"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"correlationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"namespaces"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"policies"},arguments:[{kind:"Argument",name:{kind:"Name",value:"correlationId"},value:{kind:"Variable",name:{kind:"Name",value:"correlationId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"Argument",name:{kind:"Name",value:"namespaces"},value:{kind:"Variable",name:{kind:"Name",value:"namespaces"}},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"jsonData"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"PoliciesResult"}}}]}}]},cO={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"policiesUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"policiesUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"jsonData"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PoliciesResult"}}},arguments:[]}]}}]};class dO extends sO{constructor(e,t,i,n,o,r,s){super(e,"PoliciesResolversDataProvider",t,i,n,o,s),this.apolloClient=r,this.handlePoliciesUpdatedEvent=e=>{this.logger.log("handlePoliciesUpdatedEvent() called.");try{void 0!==e&&this.parsePolicies(e)?this.notifySettingsChanged():this.logger.log(`handlePoliciesUpdatedEvent(): policiesString is ${void 0===e?"undefined":"empty"}.`)}catch(e){this.logger.error(`handlePoliciesUpdatedEvent(): ${e.message}`)}}}initialize(e=!0){const t=Object.create(null,{initialize:{get:()=>super.initialize}});return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=this;return this.policiesApolloSubscription=this.apolloClient.subscribe({query:cO}).subscribe({next(t){var i,n,o;e.handlePoliciesUpdatedEvent(null!==(o=null===(n=null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.policiesUpdatedEvent)||void 0===n?void 0:n.jsonData)&&void 0!==o?o:void 0)}}),t.initialize.call(this)}))}cleanup(){var e;super.cleanup(),null===(e=this.policiesApolloSubscription)||void 0===e||e.unsubscribe(),this.policiesApolloSubscription=void 0}getScenarioName(){return U.RG.PoliciesFetchDataResolvers}fetchPolicies(e){return this.apolloClient.query({query:lO,variables:{correlationId:e.id,namespaces:this.namespacesToFetch},fetchPolicy:"no-cache"}).then((t=>{var i,n,o,r,s;(null==t?void 0:t.error)&&(null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,`fetchPolicies:then: Message: ${t.error.message}.`,"webclient_framework_policies_resolvers_fetch_failed_event",void 0,!0)),(null==t?void 0:t.errors)&&t.errors.forEach((e=>{var t,i;null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,`fetchPolicies:then: Errors:Message: ${e.message}.`,"webclient_framework_policies_resolvers_fetch_failed_event",void 0,!0)}));const a=null!==(s=null===(r=null===(o=null==t?void 0:t.data)||void 0===o?void 0:o.policies)||void 0===r?void 0:r.jsonData)&&void 0!==s?s:void 0;let l=!1,c="success";void 0!==a&&this.parsePolicies(a)?l=this.notifySettingsChanged():(this.logger.log(`fetchPolicies(): Failed to fetch policies, got ${void 0===a?"undefined":"empty"} response.`),c="incomplete"),e.stop({message:(0,M.u4)({notified:l})},c)})).catch((t=>{var i;this.handleError(t),e.fail({errors:null!==(i=t.message)&&void 0!==i?i:"Failed to fetch policies via resolvers."})}))}parsePolicies(e){let t={};try{t=JSON.parse(e)}catch(e){throw new Error("parsePolicies(): Unable to parse policies string.")}return 0!==Object.keys(t).length&&(this.namespacesToFetch.forEach((e=>{t[e]&&(this.settings[e]=t[e])})),!0)}}class uO extends Ce.i{constructor(){super(f.Yg.InitSettingsPolicyProvider,["authenticationUser","coreSettings","coreSettingsContext","loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,coreSettings:i,coreSettingsContext:n,loggerFactory:o}=e,{disableNonBlockingPolicyProviderInit:r,disablePolicyProvider:s}=i.get(b.J.Core);if(s)return;if(!t||t.role===Es.w4.Anonymous)return;const a=this.createPoliciesDataProvider(e),{enableMainWindowPolicyFetch:l}=i.get(b.J.Host);if(l||r)yield n.initializePolicyProvider(a);else{const e=o.newLogger("InitPolicyProviderTask","core-services-tasks");n.initializePolicyProvider(a).then((()=>{e.log("Initialized policy provider successfully.")})).catch((t=>{e.errorToTelemetry&&e.errorToTelemetry(`Initialization of policy provider failed. ${t}`,"webclient_framework_foundation_core_services",void 0,!0)}))}return e=>{if("signout"===e)a.cleanup()}}))}createPoliciesDataProvider(e){const{client:t,clientState:i,configLoader:n,coreSettings:o,loggerFactory:r,scenarioFactory:s,windowProvider:a}=e;let l;const{enableMainWindowPolicyFetch:c}=o.get(b.J.Host);return l=c?new aO(r,n,o,s,a,i):new dO(r,n,o,s,a,t,i),l}}const mO="preReleaseFeaturesAllowed";class gO extends Ce.i{constructor(){super(f.Yg.InitSettingsWithDiscoveredUser,["authenticationService","authenticationUser","config","coreSettings","coreSettingsContext","endpointsManager","localStorage","loggerFactory","platformService","user"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationService:t,authenticationUser:i,config:n,coreSettings:o,coreSettingsContext:r,endpointsManager:s,localStorage:a,loggerFactory:l,platformService:c,user:d}=e;let u={};const{enablePreReleaseClientFilter:m}=o.get(b.J.Core);if(m){const e=yield this.getPreReleaseUserInfo({authenticationService:t,authenticationUser:i,config:n,coreSettings:o,endpointsManager:s,localStorage:a,loggerFactory:l,platformService:c});u=Object.assign(Object.assign({},u),{preReleaseFeaturesAllowed:e})}const g=r,{enableMTMA:h}=o.get(b.J.Core),p=!h||(yield Md(t,i));yield g.initializeProvidersWithDiscoveredUser(d,p,u)}))}getPreReleaseUserInfo({authenticationService:e,authenticationUser:t,config:{experienceName:i},coreSettings:n,endpointsManager:r,localStorage:s,loggerFactory:a,platformService:l}){var c;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=a.newLogger("InitSettingsWithDiscoveredUserTask","core-services-tasks"),{preReleaseFeaturesAllowed:d}=n.get(b.J.Metadata);if(!d)return o.log("No pre release features are allowed."),!1;if(yield Md(e,t))return o.log(`Returning preReleaseAllowed filter for primary user: ${d}`),!!d;try{const e=s.get(mO);if(null!=e)return o.log(`Cached preReleaseAllowed filter loaded: ${e}`),JSON.parse(e);const c={userId:null==t?void 0:t.profile.objectId,tenantId:null==t?void 0:t.profile.tenantId},d=(0,Lm.xb)({coreSettings:n,experienceName:i,platformService:l,user:c,logger:o}),u=(0,Rm.bn)({serviceName:"ClientFilters",ecsParameters:d,loggerFactory:a,endpointsManager:r}),m=yield u.fetch(),g=this.getValueFromPayload(m,d);return void 0!==g?(o.log(`Storing preReleaseAllowed filter in cache: ${g}`),s.set(mO,g.toString(),"Framework")):o.log("Could not get preReleaseAllowed filter from ECS."),!!g}catch(e){null===(c=o.errorToTelemetry)||void 0===c||c.call(o,(0,Ta.u4)(e),"web_infra_determine_pre_release_filter_failed")}return!1}))}getValueFromPayload(e,t){var i;if(e.requestStatus===Pm.m.Success)return null===(i=t.agents)||void 0===i?void 0:i.some((t=>{var i,n;const o=null===(i=e.ecsConfiguration)||void 0===i?void 0:i[t];return!!(null===(n=null==o?void 0:o.metadata)||void 0===n?void 0:n.preReleaseFeaturesAllowed)}))}}class hO extends Ce.i{constructor(){super(f.Yg.InitSettingsWithPrimaryUser,["coreSettingsContext","authenticationUser"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettingsContext:t,authenticationUser:i}=e;return yield t.setPrimaryUser(i),e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if("signout"===e)yield t.setPrimaryUser(void 0)}))}))}}var pO;!function(e){e[e.ComposeMessageTyping=0]="ComposeMessageTyping",e[e.MessageListScroll=1]="MessageListScroll",e[e.PowerbarTyping=2]="PowerbarTyping",e[e.VirtualTreeListScroll=3]="VirtualTreeListScroll",e[e.FeedsFilterTyping=4]="FeedsFilterTyping",e[e.PeoplePickerTyping=5]="PeoplePickerTyping",e[e.SearchBoxTyping=6]="SearchBoxTyping",e[e.FloodgatePopup=7]="FloodgatePopup",e[e.ChatListSearchFilterTyping=8]="ChatListSearchFilterTyping",e[e.ChannelListSearchFilterTyping=9]="ChannelListSearchFilterTyping",e[e.CallingPerfSample=10]="CallingPerfSample",e[e.AllChannelSystemMessagesScroll=11]="AllChannelSystemMessagesScroll",e[e.AllPinnedPostsScroll=12]="AllPinnedPostsScroll",e[e.DiscoverSurfaceFeedListScroll=13]="DiscoverSurfaceFeedListScroll",e[e.TeamsAndChannelsTableScroll=14]="TeamsAndChannelsTableScroll",e[e.PostComposeTyping=15]="PostComposeTyping",e[e.UnifiedFunPickerTyping=16]="UnifiedFunPickerTyping",e[e.CreateTeamGalleryScroll=17]="CreateTeamGalleryScroll",e[e.AddMemberScroll=18]="AddMemberScroll",e[e.MeetForWorkListScroll=19]="MeetForWorkListScroll",e[e.MeetForWorkSearchFilterTyping=20]="MeetForWorkSearchFilterTyping",e[e.PeopleAppContactListScroll=21]="PeopleAppContactListScroll",e[e.SimpleCollabLeftRailScroll=22]="SimpleCollabLeftRailScroll"}(pO||(pO={}));var vO=i(303244);class yO{constructor(e){this.histogram=new Map,this.bucketSize=e.bucketSize,this.maxBucketValue=e.maxBucketValue,this.fixedDecimals=function(e){let t=0;const i=10;for(;Math.floor(e)!==e;)e*=i,t++;return t}(this.bucketSize)}record(e,t){t=(t=t||1)<1?1:t;const i=Math.min(Math.floor(e/this.bucketSize)*this.bucketSize,this.maxBucketValue).toFixed(this.fixedDecimals),n=this.histogram.get(i)||0;this.histogram.set(i,n+t)}toObject(){const e={};return Array.from(this.histogram.keys()).forEach((t=>e[t]=this.histogram.get(t))),e}clear(){this.histogram.clear()}}const fO="getAndClearAriTelemetry";class SO{constructor(e,t){this.host=e,this.context=t,this.startSlot=0,this.blinkInterval=100,this.trailingTimespan=f.B.second,this.rafRecords=new Map,this.activeUserActionType=void 0,this.wheelEventTriggeredUserActionType=void 0,this.userActions=new Map,this.validActions=new Map,this.lastEventTimeSlot=this.startSlot,this.isDebugging=!1,this.minAriDuration=200,this.minEtwTriggeringDelay=1e3,this.minEtwTriggeringFrameDelay=1e3,this.lastRafTime=0,this.strategies=[{name:"TwoRafAndLimitedStopTimeStrategy",lowestAllowedRafs:2,allowStopTimeOverwrite:!0}],this.logger=t.loggerFactory.newLogger("ARI","core-services-telemetry"),this.hostCommunicationService=t.hostCommunicationService,this.initializeOnAppLaunchAndReinit(),this.__initTestingMode__(this.context.coreSettings.get(b.J.Host)),this.defaultHost=e}trackEvent(e,t,i,n,o,r){const s=this.getUserActionType(e,t),{isDebugging:a,logger:l}=this;if(void 0===s||!(s in pO))return void(a&&l.debug(`[${this.formatActionKey(e,t)}] TrackEvent | No action found`));if(r)return void(this.wheelEventTriggeredUserActionType=s);const c=this.getMeasurementName(s),d=n.performance.now();if(a&&l.debug(`[${c} TrackEvent | [${Math.round(i)}...${Math.round(d)}] ${Math.round(d-i)}ms`),void 0===this.activeUserActionType)a&&l.debug(`[${c}] track-start`),this.startMeasurement(s,i,n,o);else if(this.activeUserActionType!==s||this.host!==n||this.actionLocation!==o)a&&l.debug(`[${c}] track-stop`),this.stopMeasurement(n),a&&l.debug(`[${c}] track-start`),this.startMeasurement(s,i,n,o);else{if(a){const e=`[${c}] track-continue`;l.debug(e),(0,hd.mF)(this.host.performance,e,{startTime:i})}this.continueMeasurement(i)}}handleUnmount(e){this.stopMeasurement(e)}getTelemetry(e=vO.xL.HeartbeatMonitor){return this.getTelemetryFilteredByType(e)}getTelemetryTypeForAction(e){return e===pO.CallingPerfSample?vO.xL.CallingPerfMonitor:vO.xL.HeartbeatMonitor}isActionOfTelemetryType(e,t){return this.getTelemetryTypeForAction(e)===t}getTelemetryFilteredByType(e){void 0!==this.activeUserActionType&&this.isActionOfTelemetryType(this.activeUserActionType,e)&&this.stopMeasurement();const t={};let i=!1;const n={totalIntervalCount:0,passIntervalCount:0,measurements:0,wheelMeasurements:0,max:{totalIntervalCount:0,passIntervalCount:0}};this.userActions.forEach(((o,r)=>{if(void 0!==pO[o.type]&&this.isActionOfTelemetryType(o.type,e)){const e={};o.scores.forEach(((t,i)=>{(e=>{e&&(n.passIntervalCount+=e.passIntervalCount,n.totalIntervalCount+=e.totalIntervalCount,n.measurements+=e.measurements,n.wheelMeasurements+=e.wheelMeasurements,n.max.passIntervalCount=Math.max(n.max.passIntervalCount,e.passIntervalCount),n.max.totalIntervalCount=Math.max(n.max.totalIntervalCount,e.totalIntervalCount))})(t),e[i]=this.getAri(t),e[`${i}-score`]=t})),o.scoreHistograms.forEach(((t,i)=>{e[`${i}-scoreHistogram`]=t.toObject()})),e.frameDelayHistogram=o.frameDelayHistogram.toObject(),t[r]=e,i=!0,this.userActions.delete(r),this.isDebugging&&this.logger.debug(`[AppResponsivenessService]: clear action for type ${pO[o.type]}`)}})),t.Total=this.getAri(n),t.score=n;let o="";if(i)try{o=JSON.stringify(t)}catch(e){this.logger.error("[AppResponsivenessService]: unexpected error parsing log object. Likely because of circular reference.")}return o}clearTelemetry(){this.userActions.clear(),this.clearTelemetryTimeoutId&&this.context.windowProvider.clearTimeout(this.clearTelemetryTimeoutId),this.clearTelemetryTimeoutId=this.context.windowProvider.setTimeout((()=>{this.clearTelemetry()}),f.B.tenMinutes,!1)}initializeOnAppLaunchAndReinit(){this.initSettings(),this.registerValidActions(),this.clearTelemetry()}__initTestingMode__(e){if(e){const t=e.userType;t&&t.indexOf("test")>-1&&(this.isDebugging=!0,fO in window||(window[fO]=()=>{const e=this.getTelemetry();return this.clearTelemetry(),e}))}}registerValidActions(){this.validActions.set(this.formatActionKey(vO.PG.Floodgate,f.f_.System),pO.FloodgatePopup),this.validActions.set(this.formatActionKey(vO.PG.ComposeMessage,f.f_.Keyup),pO.ComposeMessageTyping),this.validActions.set(this.formatActionKey(vO.PG.MessageList,f.f_.Scroll),pO.MessageListScroll),this.validActions.set(this.formatActionKey(vO.PG.Powerbar,f.f_.Keyup),pO.PowerbarTyping),this.validActions.set(this.formatActionKey(vO.PG.VirtualTreeList,f.f_.Scroll),pO.VirtualTreeListScroll),this.validActions.set(this.formatActionKey(vO.PG.FeedsFilter,f.f_.Keyup),pO.FeedsFilterTyping),this.validActions.set(this.formatActionKey(vO.PG.PeoplePicker,f.f_.Keyup),pO.PeoplePickerTyping),this.validActions.set(this.formatActionKey(vO.PG.PostCompose,f.f_.Keyup),pO.PostComposeTyping),this.validActions.set(this.formatActionKey(vO.PG.SearchBox,f.f_.Keyup),pO.SearchBoxTyping),this.validActions.set(this.formatActionKey(vO.PG.ChatListSearchFilter,f.f_.Keyup),pO.ChatListSearchFilterTyping),this.validActions.set(this.formatActionKey(vO.PG.ChannelListSearchFilter,f.f_.Keyup),pO.ChannelListSearchFilterTyping),this.validActions.set(this.formatActionKey(vO.PG.CallingPerf,f.f_.Sample),pO.CallingPerfSample),this.validActions.set(this.formatActionKey(vO.PG.DiscoverSurfaceFeedList,f.f_.Scroll),pO.DiscoverSurfaceFeedListScroll),this.validActions.set(this.formatActionKey(vO.PG.AllPinnedPosts,f.f_.Scroll),pO.AllPinnedPostsScroll),this.validActions.set(this.formatActionKey(vO.PG.AllChannelSystemMessages,f.f_.Scroll),pO.AllChannelSystemMessagesScroll),this.validActions.set(this.formatActionKey(vO.PG.TeamsAndChannelsTable,f.f_.Scroll),pO.TeamsAndChannelsTableScroll),this.validActions.set(this.formatActionKey(vO.PG.UnifiedFunPicker,f.f_.Keyup),pO.UnifiedFunPickerTyping),this.validActions.set(this.formatActionKey(vO.PG.CreateTeamGallery,f.f_.Scroll),pO.CreateTeamGalleryScroll),this.validActions.set(this.formatActionKey(vO.PG.AddMember,f.f_.Scroll),pO.AddMemberScroll),this.validActions.set(this.formatActionKey(vO.PG.MeetForWorkList,f.f_.Scroll),pO.MeetForWorkListScroll),this.validActions.set(this.formatActionKey(vO.PG.MeetForWorkSearchFilter,f.f_.Keyup),pO.MeetForWorkSearchFilterTyping),this.validActions.set(this.formatActionKey(vO.PG.PeopleAppContactList,f.f_.Scroll),pO.PeopleAppContactListScroll),this.validActions.set(this.formatActionKey(vO.PG.SimpleCollabLeftRail,f.f_.Scroll),pO.SimpleCollabLeftRailScroll)}getUserActionType(e,t){const i=this.formatActionKey(t,e);return this.validActions.get(i)}formatActionKey(e,t){return`${e}_${t}`}registerRafCallback(){this.rafCallbackId||(this.lastRafTime=this.host.performance.now(),this.rafCallbackId=this.host.requestAnimationFrame((()=>this.measureRaf())))}unregisterRafCallback(){this.rafCallbackId&&(this.host.cancelAnimationFrame(this.rafCallbackId),this.clearRaf())}clearRaf(){this.rafCallbackId=void 0,this.rafRecords.clear()}getAri(e){return e&&0!==e.totalIntervalCount?Math.round(e.passIntervalCount/e.totalIntervalCount*f.B.second)/f.B.second:0}initSettings(){const{enableAriDebugging:e,appResponsivenessConstants:t}=this.context.coreSettings.get(b.J.Telemetry),i=this.context.coreSettings.get(b.J.Host).showScenarioStepsInPerfTrace||this.context.coreSettings.get(b.J.Core).showScenarioStepsInPerfTrace;this.isDebugging=e||i||!1,this.blinkInterval=t&&t.blinkInterval||100,this.trailingTimespan=t&&t.trailingTimespan||f.B.second,this.minEtwTriggeringDelay=(null==t?void 0:t.minEtwTriggeringDelay)||1e3,this.minEtwTriggeringFrameDelay=(null==t?void 0:t.minEtwTriggeringFrameDelay)||1e3}startMeasurement(e,t,i,n){this.assignHost(i),this.actionLocation=n,this.activeUserActionType=e,this.eventStartTime=t||this.host.performance.now(),this.lastEventTimeSlot=this.getTimeSlot(this.eventStartTime);const o=this.getMeasurementName(e);if(this.isDebugging){const e=`[${o}] START`,t=`${e} | ${this.host.performance.now()} | Event: ${this.eventStartTime}`;this.host.performance.mark(e,{startTime:this.eventStartTime}),this.logger.debug(t)}this.registerRafCallback();let r=this.userActions.get(o);void 0===r&&(r={scores:new Map,scoreHistograms:new Map,startTime:this.startSlot,type:e,frameDelayHistogram:new yO({bucketSize:500,maxBucketValue:15e3})},this.userActions.set(o,r)),r.startTime=this.eventStartTime}stopMeasurement(e=this.host){if(void 0===this.activeUserActionType)return;const t=this.getMeasurementName(this.activeUserActionType),i=this.userActions.get(t);if(void 0!==i){if(this.isDebugging){const e=`[${t}] END`;this.host.performance.mark(e),this.logger.debug(`${e} | ${this.host.performance.now()}`)}this.finalizeMeasurement(i)}this.unregisterRafCallback(),this.wheelEventTriggeredUserActionType===this.activeUserActionType&&(this.wheelEventTriggeredUserActionType=void 0),this.activeUserActionType=void 0,this.actionLocation=void 0,e===this.host&&this.assignHost(this.defaultHost)}continueMeasurement(e){this.lastEventTimeSlot=this.getTimeSlot(e)}finalizeMeasurement(e,t){this.strategies.forEach((i=>{const n=t&&i.allowStopTimeOverwrite?t:this.getCurrentTimeSlot(),o=Math.round(this.host.performance.now()-e.startTime);if(o<this.minAriDuration)return;const r=this.getResponsivenessScore(this.startSlot,n,i);this.recordPerInteractionAri(e,o,r,i);const s=e.scores.get(i.name);s?(s.passIntervalCount+=r.passIntervalCount,s.totalIntervalCount+=r.totalIntervalCount,s.measurements+=r.measurements,s.wheelMeasurements+=r.wheelMeasurements,s.max.passIntervalCount=Math.max(s.max.passIntervalCount,r.passIntervalCount),s.max.totalIntervalCount=Math.max(s.max.totalIntervalCount,r.totalIntervalCount)):e.scores.set(i.name,{totalIntervalCount:r.totalIntervalCount,passIntervalCount:r.passIntervalCount,measurements:r.measurements,wheelMeasurements:r.wheelMeasurements,max:r.max});const a=(r.passIntervalCount/r.totalIntervalCount).toFixed(2);if(this.logger.log(`[${this.getMeasurementName(e.type)}] duration: ${o}ms measurement: ${r.passIntervalCount}/${r.totalIntervalCount} (${a})`),this.isDebugging){const t=this.getMeasurementName(e.type),i={name:t,pass:r.passIntervalCount,total:r.totalIntervalCount,result:a},n=`ari-measurement => ${JSON.stringify(i)}`,o=`[${t}] START`,s=`[${t}] END`;(0,hd.bu)(this.host.performance,n,o,s)}}))}recordFrameDelay(){var e;if(void 0===this.activeUserActionType)return;const t=this.getMeasurementName(this.activeUserActionType),i=this.userActions.get(t);if(void 0===i)return;const n=this.host.performance.now(),o=n-this.lastRafTime;this.lastRafTime=n,i.frameDelayHistogram.record(o),o>=this.minEtwTriggeringFrameDelay&&(null===(e=this.hostCommunicationService)||void 0===e||e.loadModule("etw").then((e=>{var t;null===(t=null==e?void 0:e.writeAppResponsivenessFrameDelayEvent)||void 0===t||t.call(e,{type:pO[i.type],delayMs:o})})))}recordPerInteractionAri(e,t,i,n){var o;const r=i.passIntervalCount/i.totalIntervalCount;e.scoreHistograms.has(n.name)||e.scoreHistograms.set(n.name,new yO({bucketSize:.1,maxBucketValue:1}));e.scoreHistograms.get(n.name).record(r);const s=(1-r)*t;s>=this.minEtwTriggeringDelay&&(null===(o=this.hostCommunicationService)||void 0===o||o.loadModule("etw").then((i=>{var n;null===(n=null==i?void 0:i.writeAppResponsivenessDelayEvent)||void 0===n||n.call(i,{type:pO[e.type],delayMs:s,durationMs:t})})))}measureRaf(){const e=this.getCurrentTimeSlot();this.recordFrameDelay();let t=this.rafRecords.get(e);void 0===t?t=1:t++,e-this.lastEventTimeSlot>=this.trailingTimespan?this.stopMeasurement():(this.rafRecords.size>1e3&&(this.stopMeasurement(),this.rafRecords.clear()),this.rafRecords.set(e,t),this.rafCallbackId=this.host.requestAnimationFrame((()=>this.measureRaf())))}getCurrentTimeSlot(){const e=this.host.performance.now();return this.getTimeSlot(e)}getTimeSlot(e){const t=void 0!==this.eventStartTime?e-this.eventStartTime:-1;return t<0?-1:Math.floor(t/this.blinkInterval)*this.blinkInterval}getResponsivenessScore(e,t,i){let n=0,o=0;for(;e<t;){const t=this.rafRecords.get(e);this.isDebugging&&this.logger.debug(`${e}: ${void 0===t?0:t}`),o+=void 0!==t&&t>=i.lowestAllowedRafs?1:0,n++,e+=this.blinkInterval}return{passIntervalCount:o,totalIntervalCount:n,measurements:1,wheelMeasurements:void 0!==this.wheelEventTriggeredUserActionType&&this.wheelEventTriggeredUserActionType===this.activeUserActionType?1:0,max:{passIntervalCount:o,totalIntervalCount:n}}}assignHost(e){this.host=e}getMeasurementName(e){let t=pO[e];return this.actionLocation&&(t+=`-${this.actionLocation}`),t}}const kO={"14d6962d-6eeb-4f48-8890-de55454bb136":"ActivityAppSwitch","86fcd49b-61a2-4701-b771-54728cd291fb":"ChatAppSwitch","ef56c0de-36fc-4ef8-b417-3d82ba9d073c":"CalendarAppSwitch","2a84919f-59d8-4441-a975-2a8c2643b741":"ChannelAppSwitch","3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40":"SimpleCollabAppSwitch","20c3440d-c67e-4420-9f80-0e50c39693df":"CallsMainAppSwitch","5af6a76b-40fc-4ba1-af29-8f49b08e44fd":"FilesAppSwitch","957ed0e3-e5ca-4c82-9676-fd037185c4d8":"MeetAppSwitch","a63f7012-8cc9-42d5-99c3-e35f526fab17":"MeetForWorkAppSwitch","3b95919f-59d8-4441-a975-2a8c2643c852":"CommunitiesAppSwitch","66aeee93-507d-479a-a3ef-8f494af43945":"AssignmentsAppSwitch","ac40aa4a-fef1-4896-aea2-46d1c14dbfd5":"StoreAppSwitch","7133fca9-0853-4e7a-bb5d-32d4e5f6020a":"HomepageAppSwitch","a02e4d17-af86-4ceb-9c97-4c2626eb3587":"QueuesAppSwitch","7831feaf-c4c4-4669-ba64-ce4ea0b56d31":"PeopleAppSwitch"},bO={"chat-list-item":"ChatSwitch","sendMessageCommands-send":"MessageSend","activity-feed-list-item":"ActivitySwitch"},wO={good:"#0CCE6A","needs-improvement":"#FFA400",poor:"#FF4E42"},CO=new Set(["slot-measurer"]),_O="not-able-to-find-a-data-tid",TO=["file-chiclet","message-heart","message-yes","message-laugh","message-surprised","channel-list-item-text","participant-8:orgid","participantsFromMeeting","participantsFromThread","participantsInLobby","participantsInCall","participantsFromTeamSuggestions","attendeesInMeeting","newMessageCommands","background-effect","tab-item-tab","recipient-line-entry","emoticon-button","custom-emoji","channel-list-item-text","store-item","team-context-menu-more-button","tid-calendar-event","role-dropdown","tid-upcoming"],IO="getInpTelemetry";class jO{constructor(e){this.context=e,this.performanceObserverDurationThreshold=16,this.minEtwTriggeringDelay=500,this.minEtwTriggeringDelayForEvents={},this.track=e=>{if(!e.PerformanceObserver)return null;const t=new e.PerformanceObserver(this.performanceObserverCallback);return t.observe({type:"event",durationThreshold:this.performanceObserverDurationThreshold,buffered:!0}),()=>{t.disconnect()}},this.saveMousedownEntry=e=>{const t=e.filter((e=>"mousedown"===e.name)),i=t.length>=1?t.reduce(((e,t)=>e.duration>=t.duration?e:t)):null;(null==i?void 0:i.target)&&(this.previousMousedownAssociatedScenario=this.attemptToFindMatch(null==i?void 0:i.target))},this.performanceObserverCallback=e=>{var t;if(this.inpRecordCount>1e3)return;const i={},n=e.getEntries();for(const e of n){const t=e.interactionId||0;i[t]=i[t]||[],i[t].push(e)}for(const e of Object.values(i)){this.saveMousedownEntry(e);const i=e.filter((e=>"click"===e.name));if(0===i.length)continue;const n=i.reduce(((e,t)=>e.duration>=t.duration?e:t)),r=n.target,s={inp:this.getInp(n),inputDelay:this.getInputDelay(n),processingTime:this.getProcessingTime(n),presentationDelay:this.getPresentationDelay(n)},{match:a,notYetInstrumentedMatch:l,iterations:c}=this.attemptToFindMatchForClickOrPreviousMousedown(r);a?this.updateAssociatedInstrumentedScenario(a,s):this.updateAssociatedNotYetInstrumentedScenario(l,s),this.inpRecordCount++;const d=this.minEtwTriggeringDelayForEvents[null!=a?a:""],u=null!=d?d:this.minEtwTriggeringDelay;if(n.duration>=u&&(null===(t=this.hostCommunicationService)||void 0===t||t.loadModule("etw").then((e=>{var t;null===(t=null==e?void 0:e.writeInteractionToNextPaintEvent)||void 0===t||t.call(e,{scenario:null!=a?a:l,version:"2",inputDelayMs:s.inputDelay,processingTimeMs:s.processingTime,presentationDelayMs:s.presentationDelay,inpMs:s.inp,inpEndTimestamp:n.startTime+n.duration})}))),this.isDebugging){const e=n.duration,t=(o=e)<=200?"good":o<=500?"needs-improvement":"poor",i=`${e.toFixed(0)} ms`;this.logger.log(`%cInteraction tracking snippet %c${i} (${t})`,"font-weight: bold;",`font-weight: bold; color: ${wO[t]||"inherit"}`),a?this.logger.log(`Interaction associated scenario: %c${a}`,"font-family: monospace"):this.logger.log(`Interaction associated not yet implemented scenario: %c${l}`,"font-family: monospace"),this.logger.log(`Interaction event type: %c${n.name}`,"font-family: monospace"),this.logger.log("DOM Depth search iterations needed to find a match",c+1),this.logger.log(`Input delay (ms): ${s.inputDelay}\n`,`Processing time (ms): ${s.processingTime}\n`,`Presentation delay (ms): ${s.presentationDelay}`)}}var o},this.isDebugging=!1,this.__initTestingMode__(this.context.coreSettings.get(b.J.Host)),this.logger=this.context.loggerFactory.newLogger("INP","core-services-telemetry"),this.hostCommunicationService=e.hostCommunicationService,this.initSettings(),this.inpData={version:"2",events:{}},this.inpRecordCount=0,this.previousMousedownAssociatedScenario=null}getTelemetry(){const e={version:this.inpData.version,events:{}};let t="",i=!1;const n=e.events;if(Object.entries(this.inpData.events).forEach((([e,t])=>{n[e]={instrumented:{},notYetInstrumented:{}},Object.entries(t).forEach((([t,o])=>{Object.entries(o).forEach((([o,r])=>{n[e][t][o]={},Object.entries(r).forEach((([r,s])=>{0!==s.length&&(n[e][t][o][r]=s,i=!0)}))}))}))})),this.inpData.events={},this.inpRecordCount=0,i)try{t=JSON.stringify(e)}catch(e){this.logger.error("[InteractionToNextPaintService]: unexpected error parsing log object. Likely because of circular reference.")}return t}initSettings(){var e,t,i;const{interactionToNextPaintConstants:n}=this.context.coreSettings.get(b.J.Telemetry);this.performanceObserverDurationThreshold=null!==(e=null==n?void 0:n.performanceObserverDurationThreshold)&&void 0!==e?e:16,this.minEtwTriggeringDelay=null!==(t=null==n?void 0:n.minEtwTriggeringDelayFallback)&&void 0!==t?t:500,null===(i=null==n?void 0:n.minEtwTriggeringDelayForEvents)||void 0===i||i.forEach((e=>{const t=null==e?void 0:e.eventName,i=null==e?void 0:e.duration;t&&i&&(this.minEtwTriggeringDelayForEvents[t]=e.duration)}))}attemptToFindMatchForClickOrPreviousMousedown(e){return e?this.attemptToFindMatch(e):this.previousMousedownAssociatedScenario?this.previousMousedownAssociatedScenario:{match:null,notYetInstrumentedMatch:_O,iterations:0}}attemptToFindMatch(e){var t;let i=0,n=null,o="",r=0;for(;i<10&&(e&&(n=this.attemptToFindInstrumentedMatch(e)),o||(o=null!==(t=this.maybeGetDataTid(e))&&void 0!==t?t:"",r=i),!n);)e=null==e?void 0:e.parentElement,i++;return o||(o=_O),{match:n,notYetInstrumentedMatch:o,iterations:Math.min(i,r)}}attemptToFindInstrumentedMatch(e){var t;const i=null!==(t=this.maybeGetDataTid(e))&&void 0!==t?t:"",n=e.getAttribute("id"),o=e.getAttribute("class"),r=kO[i];if(r)return r;const s=bO[i];return s?"ChatSwitch"===s?(null==n?void 0:n.includes("meeting"))?"ChatMeetingSwitch":"ChatSwitch":s:(null==n?void 0:n.includes("channel"))&&(null==o?void 0:o.includes("ui-tree__item"))?"ChannelSwitch":null}__initTestingMode__(e){if(e){const t=e.userType;t&&t.indexOf("test")>-1&&(this.isDebugging=!0,IO in window||(window[IO]=()=>this.getTelemetry()))}}maybeGetDataTid(e){var t,i,n;if(!e)return null;let o=null!==(n=null!==(i=null!==(t=e.getAttribute("data-tid"))&&void 0!==t?t:e.getAttribute("data-testid"))&&void 0!==i?i:e.getAttribute("data-track-module-name"))&&void 0!==n?n:null;if(!o)return null;if(CO.has(o))return null;if(null==o?void 0:o.includes("@"))return null;for(const e of TO)if(o.startsWith(e)){o=e;break}return o}getInp(e){return Math.max(Math.round(e.duration),0)}getInputDelay(e){return Math.max(Math.round(e.processingStart-e.startTime),0)}getProcessingTime(e){return Math.max(Math.round(e.processingEnd-e.processingStart),0)}getPresentationDelay(e){const t=Math.max(e.processingEnd+4,e.startTime+e.duration);return Math.max(Math.round(t-e.processingEnd),0)}updateMetricsForScenario(e,t){new Map([["inp",t.inp],["inputDelay",t.inputDelay],["processingTime",t.processingTime],["presentationDelay",t.presentationDelay]]).forEach(((t,i)=>{var n;(null!==(n=e[i])&&void 0!==n?n:e[i]=[]).push(t)}))}updateAndGetEventType(){var e;return null!==(e=this.inpData.events.click)&&void 0!==e?e:this.inpData.events.click={instrumented:{},notYetInstrumented:{}}}updateAssociatedInstrumentedScenario(e,t){var i;const n=this.updateAndGetEventType(),o=null!==(i=n.instrumented[e])&&void 0!==i?i:n.instrumented[e]={};this.updateMetricsForScenario(o,t)}updateAssociatedNotYetInstrumentedScenario(e,t){var i;const n=this.updateAndGetEventType(),o=null!==(i=n.notYetInstrumented[e])&&void 0!==i?i:n.notYetInstrumented[e]={};this.updateMetricsForScenario(o,t)}}class NO{constructor(e){var t,i;if(this.context=e,null===(t=this.context.host)||void 0===t?void 0:t.performance){this.deprecatedNavigationTiming=this.context.host.performance.timing,this.navigationStart=null===(i=this.deprecatedNavigationTiming)||void 0===i?void 0:i.navigationStart;const e=this.context.host.performance.getEntriesByType("navigation");e&&e[0]&&(this.navigationTiming=e[0]),this.init()}}get altScenario(){return this._altScenario}get clientStartScenario(){return this._clientStartScenario}markCoreInitSteps(){const e=this.context.host.performance.getEntriesByType("mark");e&&this.navigationStart&&(this._altScenario&&this.processCoreInitPerfMarks(this._altScenario,this.navigationStart,e),this._clientStartScenario&&(this._clientStartScenario.appendEventData({scenarioPhase:su.M.Core}),this.processCoreInitPerfMarks(this._clientStartScenario,this.navigationStart,e)))}processCoreInitPerfMarks(e,t,i){const n=i;for(const i of n)i.name!==`${h}${f.sM.Initialization}`?i.name.startsWith(p)&&e.mark(i.name.replace("_end_","_"),{overrideTimestamp:Math.round(i.startTime)+t}):e.mark(U.ck.PreCoreInitializationTasks,{overrideTimestamp:Math.round(i.startTime)+t})}markAltExpLoaderSteps(e,t){this.markNavigationSteps(e,t);const i=this.context.host.performance.getEntriesByName("start-execute-main-bundle","mark");i&&i[0]&&e.mark(U.ck.MainBundleDownloadParse,{overrideTimestamp:Math.round(i[0].startTime)+t})}markClientStartExpLoaderSteps(e,t){e.appendEventData({scenarioPhase:su.M.ExpLoader}),this.markNavigationSteps(e,t);const i=[w.Xd.IndexPageStart,w.Xd.CoreModuleLoaded,w.Xd.NotifyDesktop,w.Xd.ConfigLoaded,w.Xd.MainChunksLoadingStart,w.Xd.MainChunksLoadingStop,w.Xd.IndexPageStop,U.ck.MainBundleDownloadParse,"start-execute-main-bundle"],n=this.context.host.performance.getEntriesByType("mark");n&&n.filter((e=>i.includes(e.name)||e.name.startsWith("exp_loader_err_"))).forEach((i=>{e.mark(i.name,{overrideTimestamp:Math.round(i.startTime)+t})}))}markNavigationSteps(e,t){var i,n,o,r;(null===(i=this.navigationTiming)||void 0===i?void 0:i.workerStart)&&e.mark(U.ck.IndexServiceWorkerStartup,{overrideTimestamp:t+Math.round(this.navigationTiming.workerStart)}),(null===(n=this.deprecatedNavigationTiming)||void 0===n?void 0:n.fetchStart)&&e.mark(U.ck.IndexFetchIPC,{overrideTimestamp:this.deprecatedNavigationTiming.fetchStart}),(null===(o=this.deprecatedNavigationTiming)||void 0===o?void 0:o.requestStart)&&e.mark(U.ck.IndexFetchIPCWait,{overrideTimestamp:this.deprecatedNavigationTiming.requestStart}),(null===(r=this.deprecatedNavigationTiming)||void 0===r?void 0:r.responseStart)&&e.mark(U.ck.IndexFetchProcessing,{overrideTimestamp:this.deprecatedNavigationTiming.responseStart})}init(){var e,t;this.navigationStart&&(this._altScenario=null===(e=this.context.scenarioFactory)||void 0===e?void 0:e.newScenario(U.RG.ApplicationLaunchTime,{startTime:this.navigationStart,timeoutMs:36e4}),this._clientStartScenario=null===(t=this.context.scenarioFactory)||void 0===t?void 0:t.newScenario(U.RG.ClientStart,{startTime:this.navigationStart,timeoutMs:36e4}),this._altScenario&&this.markAltExpLoaderSteps(this._altScenario,this.navigationStart),this._clientStartScenario&&this.markClientStartExpLoaderSteps(this._clientStartScenario,this.navigationStart),this.markCoreInitSteps())}}class EO{constructor(e,t){this.isScenarioMemorySnapshotEnabled=e,this.globalWindow=t,this.cachedMemoryData={},this.cacheToExpireTime=0}snapshotMemoryUsage(){return this.isScenarioMemorySnapshotEnabled?(this.cacheToExpireTime<Date.now()&&this.snapshot(),this.cachedMemoryData):{}}snapshotMemoryUsageAsync(){if(!this.isScenarioMemorySnapshotEnabled)return Promise.resolve({});if(this.ongoingPromise)return this.ongoingPromise;const e=this.cacheToExpireTime-Date.now();return e>0?(this.ongoingPromise=new Promise((t=>{this.globalWindow.setTimeout((()=>{this.snapshot(),t(this.cachedMemoryData),this.ongoingPromise=void 0}),e)})),this.ongoingPromise):(this.snapshot(),Promise.resolve(this.cachedMemoryData))}snapshot(){this.cachedMemoryData={jsHeapStatistics:this.globalWindow.envPerformance.getJSHeapStatistics()||this.cachedMemoryData.jsHeapStatistics,processMemoryInfo:this.globalWindow.envPerformance.getProcessMemoryInfo()||this.cachedMemoryData.processMemoryInfo},this.cacheToExpireTime=Date.now()+3e4}}var xO=i(209406),AO=i(973877);class DO{constructor(e){this.eventTimeTracker=jD(e&&e>0?e:100)}markResponse(e){return this.eventTimeTracker.markEvent(e)}getResponsesBetweenStartAndLast(e){return this.eventTimeTracker.getEventsBetweenStartAndLast(e)}getResponsesBetween(e,t){return this.eventTimeTracker.getEventsBetween(e,t)}}const FO=e=>{var t;const{apolloLeakInfoViewportContext:i,apolloLeakInfoEntityType:n=""}=null!==(t=e.apolloLeakInfo)&&void 0!==t?t:{};return i===gt.R.primary?`main:${n}`:n},OO=e=>e.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{});class MO{constructor(e,t,i,n){this.coreSettings=e,this.leakDetectorService=t,this.userTrackingService=i,this.shouldCollectStats=n,this.measurementTimeOverflow=!1,this.resultMeasurementTimeOverflow=!1,this.isLeakingUser=e=>e&&this.userTrackingService&&!this.userTrackingService.has(e);const{apolloCacheStatsThrottleTime:o,logCdlOperationsDuringWaitSettings:r}=e.get(b.J.Core);var s;this.getTelemetry=o?(0,L.throttle)((()=>this.getTelemetryInternal()),o,{leading:!0,trailing:!1}):this.getTelemetryInternal,r&&(r.enableTrackingCdlOperationsDuringWait||r.enableLoggingCdlOperationsDuringWait)&&(this.cdlResponseTracker=(s=r.trackingCdlOperationsDuringWaitBufferSize,new DO(s)))}getTelemetryInternal(){var e,t,i,n,o,r;const{enableApolloCacheStats:s,enableApolloCacheSizeStats:a,enableApolloResultCacheSizeStats:l,enableApolloDataEviction:c}=this.coreSettings.get(b.J.Core);if(!s)return;const d=null!==(t=null===(e=this.leakDetectorService)||void 0===e?void 0:e.getReachableObjects(nr.I.DataClient).size)&&void 0!==t?t:0,u=Array.from(null!==(n=null===(i=this.leakDetectorService)||void 0===i?void 0:i.getReachableObjects(nr.I.ApolloCache))&&void 0!==n?n:[]),m=[...Array.from(null!==(r=null===(o=this.leakDetectorService)||void 0===o?void 0:o.getReachableObjects(nr.I.UnwrappedWindow))&&void 0!==r?r:[]).map((e=>{var t;return null===(t=e.windowLeakInfo)||void 0===t?void 0:t.windowLeakInfoWindowId})).filter((e=>!!e)),f.ew],g=e=>!e||!m.includes(e),h=u.filter((e=>{const{apolloLeakInfo:{apolloLeakInfoWindowId:t}={}}=e;return g(t)})),p=this.getLeakedUserCaches(u),v=u.map(FO),y=h.map(FO),S=a&&!this.measurementTimeOverflow&&this.shouldCollectStats(),k=l&&!this.resultMeasurementTimeOverflow&&this.shouldCollectStats(),w={clientsCount:d,cacheCount:u.length,allEntityTypes:Array.from(new Set(v)),entityTypeStats:OO(v),leakedCacheCount:y.length,leakedEntityTypes:Array.from(new Set(y)),leakedEntityTypeStats:OO(y),leakedUserCachesCount:p.length,caches:u.map((e=>{const{apolloLeakInfo:{apolloLeakInfoWindowId:t,apolloLeakInfoEntityType:i,apolloLeakInfoViewportContext:n,apolloLeakInfoStartTime:o,apolloLeakInfoEndTime:r}={}}=e,s={windowId:t,isLeaking:g(t),apolloLeakInfoStartTime:o,apolloLeakInfoEndTime:r,entityType:i,viewportContext:n};if(S){const{cacheSize:t,measuringTime:i}=(0,xO.T)(e);s.cacheSize=t,s.measuringTime=i}if(k){const{cacheSize:t,measuringTime:i}=(0,AO.TP)(e);s.resultCacheSize=t,s.resultMeasuringTime=i}return s})),enableApolloDataEviction:null!=c?c:void 0},C=w.caches.reduce(((e,t)=>({cacheSize:void 0===t.cacheSize||void 0===e.cacheSize?void 0:e.cacheSize+t.cacheSize,measuringTime:void 0===t.measuringTime||void 0===e.measuringTime?void 0:e.measuringTime+t.measuringTime,resultCacheSize:void 0===t.resultCacheSize||void 0===e.resultCacheSize?void 0:e.resultCacheSize+t.resultCacheSize,resultMeasuringTime:void 0===t.resultMeasuringTime||void 0===e.resultMeasuringTime?void 0:e.resultMeasuringTime+t.resultMeasuringTime})),{cacheSize:0,measuringTime:0,resultCacheSize:0,resultMeasuringTime:0});return C.measuringTime&&C.measuringTime>500&&(this.measurementTimeOverflow=!0),C.resultMeasuringTime&&C.resultMeasuringTime>500&&(this.resultMeasurementTimeOverflow=!0),Object.assign(Object.assign({},w),C)}unthrottle(){"function"==typeof this.getTelemetry.cancel&&this.getTelemetry.cancel()}markResponse(e){var t;null===(t=this.cdlResponseTracker)||void 0===t||t.markResponse(e)}getResponsesBetweenStartAndLast(e){var t;return(null===(t=this.cdlResponseTracker)||void 0===t?void 0:t.getResponsesBetweenStartAndLast(e))||[]}getResponsesBetween(e,t){var i;return(null===(i=this.cdlResponseTracker)||void 0===i?void 0:i.getResponsesBetween(e,t))||[]}getLeakedUserCaches(e){return e.filter((e=>{const{apolloLeakInfo:{apolloLeakInfoUserContextId:t}={}}=e;return this.isLeakingUser(t)}))}}const RO={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindows"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isMainWindow"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isNotificationsWindow"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActiveEntities"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Correlation"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"layoutConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layoutMode"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LayoutModes"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LayoutConfig"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}}},arguments:[]}]}}]},PO=(e,t,i)=>{const n=void 0!==e[t]||Object.keys(e).length<i?t:"other";return e[n]=(e[n]||0)+1,n},LO=new Set([pe.py.breakoutroomspanel,pe.py.calendar,pe.py.callablechannels,pe.py.callsmain,pe.py.chats,pe.py.channels,pe.py.schedulingform,pe.py.search,pe.py.store,pe.py.transcriptcontent]);var UO;!function(e){e.mainActive="mainActive",e.mainContentRecord="mainContentRecord"}(UO||(UO={}));class WO{constructor(e){this.entityTypeLimit=e,this.active={},this.record={},this.allEntityTypes=new Set,this.usedEntityTypes=new Set,this.allLayoutModes=new Set,this.activeWindowIds=new Set}update(e,t){Object.keys(this.active).forEach((e=>{this.active[e]=0})),this.activeWindowIds.clear(),e.forEach((e=>{const i=e.activeEntities.mainEntity.type;this.allEntityTypes.add(i),this.allLayoutModes.add(e.layoutConfig.layoutMode),this.activeWindowIds.add(e.id),PO(this.active,i,this.entityTypeLimit),LO.has(i)&&this.usedEntityTypes.add(i),!this.isFirstUse(i)&&this.wasInPreviousUpdate(e,t)||PO(this.record,i,this.entityTypeLimit)}))}getStats(){return{mainActive:this.active,mainContentRecord:this.record,allEntityTypes:Array.from(this.allEntityTypes),usedEntityTypes:Array.from(this.usedEntityTypes),allLayoutModes:Array.from(this.allLayoutModes),activeWindowIds:Array.from(this.activeWindowIds)}}isFirstUse(e){return!this.record[e]}wasInPreviousUpdate(e,t){const i=t.find((t=>t.id===e.id));return!!i&&i.activeEntities.mainEntity.type===e.activeEntities.mainEntity.type&&i.activeEntities.mainEntity.id===e.activeEntities.mainEntity.id&&i.correlation.id===e.correlation.id}}const BO=new Set([pe.py.calls,pe.py.chats,pe.py.channels,pe.py.extensions,pe.py.schedulingform]);var $O;!function(e){e.popOutActive="popOutActive",e.popOutRecord="popOutRecord"}($O||($O={}));class HO{constructor(e){this.entityTypeLimit=e,this.active={},this.record={},this.allEntityTypes=new Set,this.usedEntityTypes=new Set,this.activeWindowIds=new Set}update(e,t){Object.keys(this.active).forEach((e=>{this.active[e]=0})),this.activeWindowIds.clear(),e.forEach((e=>{const i=e.activeEntities.mainEntity.type;this.allEntityTypes.add(i),this.activeWindowIds.add(e.id),PO(this.active,i,this.entityTypeLimit),BO.has(i)&&this.usedEntityTypes.add(i),!this.isFirstUse(i)&&this.wasInPreviousUpdate(e,t)||PO(this.record,i,this.entityTypeLimit)}))}getStats(){return{popOutActive:this.active,popOutRecord:this.record,allEntityTypes:Array.from(this.allEntityTypes),usedEntityTypes:Array.from(this.usedEntityTypes),activeWindowIds:Array.from(this.activeWindowIds)}}isFirstUse(e){return!this.record[e]}wasInPreviousUpdate(e,t){const i=t.find((t=>t.id===e.id));return!!i&&i.activeEntities.mainEntity.type===e.activeEntities.mainEntity.type}}const qO=e=>e.isMainWindow||e.isNotificationsWindow,zO=e=>!qO(e),VO=e=>Object.keys(e).reduce(((t,i)=>t+e[i]),0),GO=e=>{const t=Object.keys(e).reduce(((t,i)=>{const n=e[i];return n&&n>0&&(t[i]=n),t}),{}),i=Object.keys(t);return 1===i.length?i[0]:void 0},JO=(e,t)=>{const i=Array.from(e).filter((e=>{var i;return!(null===(i=e.windowLeakInfo)||void 0===i?void 0:i.windowLeakInfoWindowId)||!t.includes(e.windowLeakInfo.windowLeakInfoWindowId)})).map((e=>{var t;const{windowLeakInfoEntityType:i=""}=null!==(t=e.windowLeakInfo)&&void 0!==t?t:{};return e.viewportContext===gt.R.primary?`main:${i}`:i}));return{allEntityTypes:Array.from(new Set(i)),memActive:i.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{})}};class KO{constructor({client:e,leakDetectorService:t,entityTypeStatsLimit:i,activeWindowsService:n}){let o;this.isBackInMain=!1,this.main=new WO(null!=i?i:20),this.popOut=new HO(null!=i?i:20),o=(null==n?void 0:n.enableDecoupleCommandingFromApollo)?n.getActiveWindowsObservable():(0,he.G)(e.watchQuery({query:RO})).pipe((0,u.h)((({errors:e,loading:t})=>void 0===e&&!t)),(0,c.U)((({data:{activeWindows:e}})=>(this.isBackInMain=e.some((e=>e.id===f.ew)),e)))),this._activeWindowsSubscription=o.pipe((0,di.G)()).subscribe((([e,t])=>{this.update(e,t)})),this.leakDetectorService=t}destroy(){this._activeWindowsSubscription.unsubscribe()}getStats(){var e,t,i,n;const r=null===(e=this.leakDetectorService)||void 0===e?void 0:e.getReachableObjects(nr.I.UnwrappedWindow),s=null===(t=this.leakDetectorService)||void 0===t?void 0:t.getReachableObjects(nr.I.WindowWrapper),a=this.main.getStats(),{activeWindowIds:l}=a,c=(0,o.__rest)(a,["activeWindowIds"]),d=this.popOut.getStats(),{activeWindowIds:u}=d,m=(0,o.__rest)(d,["activeWindowIds"]),g=VO(m.popOutActive),h={backInMain:this.isBackInMain?{allEntityTypes:c.allEntityTypes,usedEntityTypes:c.usedEntityTypes,backInMainActive:c.mainActive,backInMainActiveCount:VO(c.mainActive),backInMainContentRecord:c.mainContentRecord}:void 0,t2main:this.isBackInMain?void 0:{allEntityTypes:c.allEntityTypes,allLayoutModes:c.allLayoutModes,usedEntityTypes:c.usedEntityTypes,t2MainActive:c.mainActive,t2MainActiveCount:VO(c.mainActive),t2MainContentRecord:c.mainContentRecord},popOut:Object.assign(Object.assign({},m),{popOutActiveCount:g,hasActivePopout:g>0}),mainActiveEntity:GO(c.mainActive),windowCount:null==r?void 0:r.size,windowWrapperCount:null==s?void 0:s.size,inMem:r?JO(r,[...l,...u]):void 0,windows:r?Array.from(r).map((e=>{var t;const{windowLeakInfoEntityType:i,windowLeakInfoWindowId:n,windowLeakInfoStartTime:o,windowLeakInfoEndTime:r}=null!==(t=e.windowLeakInfo)&&void 0!==t?t:{};return{windowLeakInfoWindowId:n,windowLeakInfoEntityType:i,viewportContext:e.viewportContext,windowLeakInfoStartTime:o,windowLeakInfoEndTime:r}})):void 0},p=(null!==(n=null===(i=h.t2main)||void 0===i?void 0:i.t2MainActiveCount)&&void 0!==n?n:0)+h.popOut.popOutActiveCount;return Object.assign(Object.assign({},h),{windowLeaks:void 0===h.windowCount?void 0:h.windowCount-p,windowWrapperLeaks:void 0===h.windowWrapperCount?void 0:h.windowWrapperCount-p})}update(e,t){this.main.update(t.filter(qO),e.filter(qO)),this.popOut.update(t.filter(zO),e.filter(zO))}}class QO{constructor(e){this.context=e,this.inited=!1,this.logger=e.loggerFactory.newLogger("WindowTrackerService","core-services-telemetry")}init(){var e;if(!this.inited){const{client:t,leakDetectorService:i,coreSettings:n,activeWindowsService:o}=this.context,r=(null!==(e=this.logger.errorToTelemetry)&&void 0!==e?e:this.logger.error).bind(this.logger);if(t){this.inited=!0;try{this.windowEntityTypeStats=new KO({client:t,leakDetectorService:i,entityTypeStatsLimit:null==n?void 0:n.get(b.J.Core).entityTypeStatsLimit,coreSettings:n,activeWindowsService:o})}catch(e){r("Failed to initialize WindowEntityTypeStats","webclient_framework_window_tracker_service")}}else r("Failed to initialize WindowEntityTypeStats - missing client","webclient_framework_window_tracker_service")}}getTelemetry(){var e;return this.inited||this.init(),null===(e=this.windowEntityTypeStats)||void 0===e?void 0:e.getStats()}}function YO(e,t){const i=e.location.hostname;return t&&t!==i}var XO=i(596025);function ZO(e,t,i,n,o,r){const s=r&&r.delta||0,a=function(e,t,i){let n;if("share-to-teams"===e)n=function(e,t){let i;if(t.performance&&t.performance.navigation&&0===t.performance.navigation.type){const{s:n}=e.getSearchState();if(n)i=parseInt(n,10);else{const e="outlook"===t.document.head.dataset.host,n=t.localStorage.getItem(XO.qB.STT_START_TIME);e&&n&&(i=parseInt(n,10),t.localStorage.removeItem(XO.qB.STT_START_TIME))}}return i}(t,i);return n}(e,n,o),l=a?{name:U.ck.ClickTimeAction,timestamp:i-s}:void 0,c=l?[l]:[];r&&c.push({name:r.name,timestamp:i});const d=a||i-s,u=t.newScenario(U.RG.ExperienceReady,{startTime:d});c.forEach((e=>{u.mark(e.name,{overrideTimestamp:e.timestamp})}))}function eM(e,t,i,n,o,r={cached:!1}){const s={name:e,delta:0},a=(0,hd.mR)(e,t,i,n.performance);return void 0!==a&&(s.delta=a,o.createScenarioWithoutStarting(e).stop({delta:a,cached:r.cached})),s}var tM=i(300426);class iM{constructor(e){this.telemetrySettings=null,this.disableColumnBlocker=!1,this.fixedColumnRules={},this.blockedColumnRules={},this.columnBlockingRules={},this.wildCardMergedTables={},this.wildCardTableEmpty=!0,this.updateColumnBlockingSettings=e=>{if(e){if(this.telemetrySettings=e,this.disableColumnBlocker=e.disableColumnBlocker||!1,this.disableColumnBlocker)return this.columnBlockingRules={},this.wildCardMergedTables={},void(this.wildCardTableEmpty=!0);let t={};e.blockedColumnRules&&(t=e.blockedColumnRules),this.blockedColumnRules=t;let i={};e.fixedColumnRules&&(i=e.fixedColumnRules),this.fixedColumnRules=i,this.generateRuleSet()}};e.getObservable(b.J.Telemetry).subscribe(this.updateColumnBlockingSettings),this.telemetrySettings=e.get(b.J.Telemetry),this.updateColumnBlockingSettings(this.telemetrySettings)}isContextColumnOk(e){return(0,L.isEmpty)(this.columnBlockingRules)||(0,L.isEmpty)(this.columnBlockingRules["*"])||(0,L.isEmpty)(this.columnBlockingRules["*"]["*"])||!this.columnBlockingRules["*"]["*"][e]}applyColumnBlockingRules(e,t,i,n){try{if(this.wildCardTableEmpty||this.wildCardMergedTables[e]||(this.columnBlockingRules[e]=(0,L.merge)(this.columnBlockingRules[e],this.columnBlockingRules["*"]),this.wildCardMergedTables[e]=!0),(0,L.isEmpty)(this.columnBlockingRules[e]))return;(0,L.isEmpty)(this.columnBlockingRules[e][t])?(0,L.isEmpty)(this.columnBlockingRules[e]["*"])||this.blockEventPropertyColumn(this.columnBlockingRules[e]["*"],i,n):this.blockEventPropertyColumn(this.columnBlockingRules[e][t],i,n)}catch(e){return void i.setProperty("diagBlockedColumns",(0,M.XC)({parseFailed:!0}))}}blockEventPropertyColumn(e,t,i){const n=t.properties,o={},r=null==i?void 0:i.packedData;(0,L.forEach)(e,((e,t)=>{(0,L.isEmpty)(n[t])||(n[t].value="",o[t]=e),r&&r.forEach((i=>{i[t]&&(i[t]=void 0,o[t]=e)}))})),(0,L.isEmpty)(o)||t.setProperty("diagBlockedColumns",(0,M.XC)(o))}generateRuleSet(){try{this.columnBlockingRules={},this.wildCardMergedTables={};const e=this.blockedColumnRules["*"],t=this.fixedColumnRules["*"];(0,L.forEach)(this.blockedColumnRules,((i,n)=>{if((0,L.isEmpty)(i))return;(0,L.isEmpty)(e)||"*"===n||(i=(0,L.merge)(i,e));!(0,L.isEmpty)(this.fixedColumnRules)&&!(0,L.isEmpty)(this.fixedColumnRules[n])&&!(0,L.isEmpty)(t)&&"*"!==n&&(this.fixedColumnRules[n]=(0,L.merge)(this.fixedColumnRules[n],t)),this.columnBlockingRules[n]={};const o={};(0,L.isEmpty)(i["*"])||this.mergeBlockedColumnsRulesForAllEventType(i,n,o),(0,L.isEmpty)(o)||(this.columnBlockingRules[n]["*"]=o),this.mergeBlockedColumnsRulesForEveryEventType(i,n,o),(0,L.isEmpty)(this.columnBlockingRules[n])?delete this.columnBlockingRules[n]:this.wildCardMergedTables[n]=!0})),this.wildCardTableEmpty=(0,L.isEmpty)(this.columnBlockingRules["*"])}catch(e){return}}mergeBlockedColumnsRulesForAllEventType(e,t,i){(0,L.forEach)(e["*"],((e,n)=>{e>(this.fixedColumnRules[t]&&this.fixedColumnRules[t]["*"]&&this.fixedColumnRules[t]["*"][n]||0)&&(i[n]=e)}))}mergeBlockedColumnsRulesForEveryEventType(e,t,i){(0,L.forEach)(e,((e,n)=>{"*"!==n&&((0,L.isEmpty)(this.fixedColumnRules[t])||(0,L.isEmpty)(this.fixedColumnRules[t][n])?this.columnBlockingRules[t][n]=(0,L.merge)(e,i):(this.columnBlockingRules[t][n]={},(0,L.forEach)(e,((e,i)=>{e>(this.fixedColumnRules[t][n][i]||0)&&(this.columnBlockingRules[t][n][i]=e)})),this.columnBlockingRules[t][n]=(0,L.merge)(this.columnBlockingRules[t][n],i),(0,L.isEmpty)(this.columnBlockingRules[t][n])&&delete this.columnBlockingRules[t][n]))}))}}var nM=i(589008),oM=i(969939),rM=i(157867),sM=i(853063),aM=i(561890);class lM extends aM.t{constructor(e){super(),this.messager=e,e.onmessage=e=>{var t,i;e.data&&(null===(i=(t=this.messageHandlers)[e.data.name])||void 0===i||i.call(t,e.data.params))}}postMessage(e,t,i){this.messager.postMessage({name:e,params:t},{transfer:i})}}class cM extends aM.t{constructor(e,t){super(),this.sharedWorkerUrl=t,this.worker=this.createSharedWorker(e,this.sharedWorkerUrl)}initialize(){}postMessage(e,t){try{this.worker.port.postMessage({name:e,params:t})}catch(e){console.warn(e)}}createSharedWorker(e,t){const i=t?new SharedWorker(t):e;return i.port.onmessage=e=>{if(!e||!e.data||!e.data.name)return;const t=this.messageHandlers[e.data.name];t&&t(e.data.params)},i}}const dM=(e,t,n)=>{const{url:o,hashParams:r}=n;if(e){const e=SharedWorker;SharedWorker=uM(e,t,r);const n=o?new cM(void 0,o):new cM(new SharedWorker(i.tu(new URL("/v2/worker/"+i.u(432871),i.b))));return SharedWorker=e,n}{const e=Worker;Worker=uM(e,t,r);const n=new lM(new Worker(i.tu(new URL("/v2/worker/"+i.u(573258),i.b))));return Worker=e,n}},uM=(e,t,i)=>class{constructor(n){try{return new e(t(i?`${n}#${(0,M.u4)(i)}`:n))}catch(i){return new e(t(n))}}};var mM=i(642601);const gM="Teams",hM=/(windows|win32)/i,pM=/ arm;/i,vM=/windows\sphone\s\d+\.\d+/i,yM=/(macintosh|mac os x|mac)/i,fM=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,SM=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,kM=/android/i,bM=()=>new sM.v,wM=(e,t,i)=>{var n,o;if(i){const r=null!==(n=e.get(b.J.Telemetry).workerEnabled)&&void 0!==n&&n,s=null!==(o=e.get(b.J.Telemetry).enableSharedWorker)&&void 0!==o&&o;if(r){const{coreSecurityService:n,windowBaseUrl:o}=i,r=n.getTrustedTypePolicy("@msteams/core-services-telemetry-worker#TelemetryWorker"),a=e=>r.createScriptURL(e,o);return()=>{const i=dM(s,a,{hashParams:{publicPath:t.__webpack_public_path__}});return new mM.A(i,e).init(),i}}return bM}return bM},CM=(e,t,i=oM.h.default)=>{tM.H.getInstance().initialize(t);const n=new iM(t);return Q.ip.getInstance().initialize(e,i),{eventSuppression:tM.H.getInstance(),columnSuppression:n,telemetrySender:Q.ip.getInstance()}},_M=(e,t,i,n,o=oM.h.default)=>{var r;const{clientType:s,userAgent:a}=i.config,{deviceId:l,sessionId:c,sessionStartTime:d}=i.host,u=n.get(b.J.Telemetry),{defaultToken:m,enableSharedWorker:g,isSilent:h,telemetryServer:p,enableCustomCacheSize:v,eventsLimitInMem:y,normalPrioritySendTimeInSecs:S,highPrioritySendTimeInSecs:k,autoFlushPercent:w,enableOneDsSdkNs:C,oneDsCollectorUrl:_,enableCompression:T,enablePrivacyGuard:I,enableLoggingGlobalDeviceId:j,privacyGuardIngestionToken:N,disableMTMAPrimaryId:E,debugMenuCaptureContext:x,debugMenuCaptureEvents:A,enableSDKContextOverrides:D}=u,{sharedWorkerUrl:F}=n.get(b.J.Host),O=null===(r=null==n?void 0:n.get(b.J.Core))||void 0===r?void 0:r.enableMTMA;if(!p||!m)throw t.error("Telemetry server url or app token not supplied. This is required by Aria"),(0,se.Tr)("telemetry-initialization",f.jK.Undefined,"init");const M=(e=>{let t=e;return t||(t=(0,xe.v4)()),t})(l),R=e.windowType!==rM.N.Anglr?"NS":"",P={userAgent:a,firstLaunchTime:e.appStartTime,tablePostfix:R,deviceId:M},L={debugMenuCaptureContext:!!x,debugMenuCaptureEvents:!!A},U=new nM.Mk;return U.collectorUrl=p,v&&y&&(U.eventsLimitInMem=y),{config:U,appTokens:{default:m},documentInfo:P,debugMenuSettings:L,isSilent:!!h,sessionId:c||void 0,sessionStartTime:d,clientType:s,sharedWorkerUrl:F||void 0,enableSharedWorker:!!g,eventsLimitInMem:y||3e3,normalPrioritySendTimeInSecs:S||15,highPrioritySendTimeInSecs:k||15,autoFlushPercent:w||.33,enableOneDsSdkNs:!!C,oneDsCollectorUrl:_||void 0,enableCompression:!!T,enablePrivacyGuard:!!I,enableLoggingGlobalDeviceId:!!j,privacyGuardIngestionToken:N||void 0,enableMTMA:O||void 0,disableMTMAPrimaryId:!!E,defaultLoggerName:o,enableSDKContextOverrides:!!D}},TM=(e,t,i,n,o,r,s,a,l)=>{var c;const{browser:d,browserVersion:u,clientContext:m,clientType:g,clientVersion:h,cpuArchitecture:p,osPlatform:v,osVersion:y,platformId:S,pullRequestId:k,buildId:w}=i.config,{bootType:C,panelContext:_,sessionId:T,startReason:I}=i.host,j=n.get(b.J.Telemetry),{defaultToken:N,telemetryServer:E,disableRingNamePrefixing:x,disablePlatformServiceOsVersion:A}=j,D=n.get(b.J.Metadata),{hostAppWebVersion:F}=n.get(b.J.Host);if(!E||!N)throw t.error("Telemetry server url or app token not supplied. This is required by Aria"),(0,se.Tr)("telemetry-initialization",f.jK.Undefined,"init");const O=D.environment===yt.s.life?JA.OV.Life:JA.OV.Work,M=wD(D,IM(!!x,e,r),l).ring,R=FM(o.userAgent),P=MM(o.userAgent),L=PM(v),U=LM(v);let W=p;"Mac OS X"===U&&(W="x64");const B=WM();s.setContext("AppInfo.ClientType",null!==(c=e.clientTypeTelemetry)&&void 0!==c?c:g),s.setContext("AppInfo.ClientContext",m),s.setContext("AppInfo.HostAppVersion",R),s.setContext("AppInfo.ProcessArchitecture",P),s.setContext("AppInfo.WebVersion",F),F&&s.setContext("AppInfo.HostAppWebVersion",DM(F)),s.setContext("AppInfo.Language",a.localeCode),s.setContext("AppInfo.Locale",a.localeCode),s.setContext("AppInfo.PlatformId",S);const $=OM(h,F);j.enableEnhancedTelemetry?s.setContext("AppInfo.Version",$):s.setContext("AppInfo.Version",h),s.setContext("AppInfo.VersionNew",$),s.setContext("AppInfo.PullRequestId",k),s.setContext("AppInfo.BuildId",w),s.setContext("AppInfo.ReactAppVersion",h),s.setContext("AppInfo.ExperienceName",e.experienceName),s.setContext("DeviceInfo.OsName",U),A||s.setContext("DeviceInfo.OsVersion",y),s.setContext("DeviceInfo.OsFamily",L),s.setContext("DeviceInfo.CpuArchitecture",W),s.setContext("EventInfo.isNS",!0),s.setContext("Panel.Context",_),s.setContext("Session.Id",T),s.setContext("startReason",I),s.setContext("UserInfo.Language",a.userLanguage),s.setContext("UserInfo.Ring",M),s.setContext("UserInfo.TimeZone",B),s.setContext("userAgent",o.userAgent),s.setContext("Window.Type",e.windowType),s.setContext("DeviceInfo.BrowserName",d),s.setContext("DeviceInfo.BrowserVersion",u),s.setContext("DeviceInfo.Id",o.deviceId),s.setContext("Tenant.Model",O),s.setContext("Session.TelemetryContext","web"),s.setContext("AppInfo.BootType",C),s.setContext("UserInfo.UserLocale",a.originLocaleCode),s.setContext("UserInfo.OSorBrowserLocale",wr.Bh.Desktop===g||wr.Bh.Maglev===g?a.osLocale:a.userLanguage),s.setContext("telemetryRegionFetchComplete",j.telemetryRegionFetchComplete),s.setContext("UserInfo.TelemetryRegion",j.telemetryRegion),jM(n,s,e,r,l),NM(n,s),xM($,n,s),EM(n,s)},IM=(e,t,i)=>!(!i||"react-web-client"!==t.experienceName)||e,jM=(e,t,i,n,o)=>{const r=e.getObservable(b.J.Metadata),{disableRingNamePrefixing:s}=e.get(b.J.Telemetry);if(r.subscribe((e=>{null==o||o.updateWebExperimentConfigMetadata(e),null==o||o.communicateWithHost();const r=wD(e,IM(!!s,i,n),o);t.setContext("UserInfo.Ring",r.ring),t.setContext("UserInfo.ETag",r.eTag),t.setContext("UserInfo.HostETag",r.hostETag),t.setContext("AppInfo.ExpIds",r.expIds),t.setContext("AppInfo.ExpRolloutIds",r.rolloutIds),t.setContext("AppInfo.Environment",r.environment)})),o){o.ecmObservable.subscribe((e=>{const i=e.find((e=>e.client===SD)),n=e.map((e=>e.config.expIds)).filter((e=>e.length>0)).join(","),o=CD(e).join(",");t.setContext("UserInfo.HostETag",null==i?void 0:i.config.eTag),t.setContext("AppInfo.ExpIds",n),t.setContext("AppInfo.ExpRolloutIds",o)}))}},NM=(e,t)=>{e.getObservable(b.J.UserResources).subscribe((e=>{const i=e.licenseType||void 0;t.setContext("UserInfo.LicenseType",i)}))},EM=(e,t)=>{e.getObservable(b.J.Smb).subscribe((e=>{const i=e.tenantSizeSegment||void 0;t.setContext("Tenant.SmbTenantSizeSegment",i)}))},xM=(e,t,i)=>{t.getObservable(b.J.Host).subscribe((n=>{n&&AM(e,t,i,n)}))},AM=(e,t,i,n)=>{const{enableEnhancedTelemetry:o,enableGetUserTypeFromHost:r}=t.get(b.J.Telemetry),s=n.desktopVersion||void 0,a=s?e.concat(",",s):e;s&&i.setContext("AppInfo.DesktopVersion",s),i.setContext("AppInfo.VersionNew",a),n.systemManufacturer&&i.setContext("DeviceInfo.Make",n.systemManufacturer),n.systemProductName&&i.setContext("DeviceInfo.Model",n.systemProductName),i.setContext("rendererCount",n.rendererCount),o&&i.setContext("AppInfo.Version",a),i.setContext("AppInfo.WebVersion",n.hostAppWebVersion),n.hostAppWebVersion&&i.setContext("AppInfo.HostAppWebVersion",DM(n.hostAppWebVersion)),r&&n.userType&&i.setContext("userType",n.userType)},DM=e=>{let t="";const i=e.indexOf("/");return i>-1&&(t=e.substring(i+1,e.length)),t},FM=e=>{let t;const i=e.indexOf(gM);if(i>-1){t=e.substring(i+5+1);const n=t.indexOf(" ");t=t.substring(0,n)}return t},OM=(e,t)=>t?e.concat(",",t):e,MM=e=>{let t=JA.Wz.unknown;return UM(e,JA.Wz.x64)?t=JA.Wz.x64:UM(e,JA.Wz.x86)?t=JA.Wz.x86:UM(e,JA.Wz.ia32)&&(t=JA.Wz.ia32),t},RM=e=>{const t=e.get(b.J.Telemetry),i=t.workerEnabled,n=t.enableSharedWorker;return i?n?"shared":"dedicated":"embed"},PM=e=>{let t=JA.Zc.UNKNOWN;const i=(null==e?void 0:e.match(hM))||(null==e?void 0:e.match(pM))||(null==e?void 0:e.match(vM)),n=(null==e?void 0:e.match(SM))||(null==e?void 0:e.match(kM)),o=(null==e?void 0:e.match(yM))||(null==e?void 0:e.match(fM));return i?t=JA.Zc.WINDOWS:n?t=JA.Zc.UNIX:o&&(t=JA.Zc.MACOSX),t},LM=e=>{switch(e){case wr.NR.Windows:return"Windows";case wr.NR.Mac:return"Mac OS X";case wr.NR.Linux:return"Linux";case wr.NR.ChromeOS:return"Chrome OS";case wr.NR.Android:return"Android";case wr.NR.IOS:return"iOS";case wr.NR.WindowsPhone:return"Windows Phone";case wr.NR.Unknown:return"Unknown";default:return e}},UM=(e,t)=>!!(e.indexOf(t)>-1),WM=()=>{const e=(new Date).getTimezoneOffset();let t=e%60,i=(e-t)/60;const n=i>0?"-":"+";t=Math.abs(t),i=Math.abs(i);const o=t<10?`0${t}`:t.toString();return`${n}${i<10?`0${i}`:i.toString()}:${o}`};var BM=i(685118);class $M extends Ce.i{constructor(){super(f.Yg.InitTelemetry,["coreSettings","coreSettingsContext","diagnosticsService","hostCommunicationService","loggerFactory","telemetryContextService","windowProvider"])}execute(e){var t,i,n,r,s,a,l;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=e.loggerFactory.newLogger("init-telemetry-task","core-services-tasks"),c=e.coreSettings.get(b.J.Telemetry),d=this.createMemoryAnalyzer(e.windowProvider,c);c.disableAriService||(e.appResponsivenessService=new SO(e.windowProvider,{loggerFactory:e.loggerFactory,windowProvider:e.windowProvider,coreSettings:e.coreSettings,hostCommunicationService:e.hostCommunicationService})),c.enableInpService&&(null===(i=null===(t=c.heartbeatConfiguration)||void 0===t?void 0:t.inpMetricsCollection)||void 0===i?void 0:i.enabled)&&(e.interactionToNextPaintService=new jO(e)),e.dataClientTrackingService=this.createDataClientTrackerService(e),this.createWindowTrackerService(e),yield this.createHeartbeatMonitor(e);const{crossClientRegistrationMethods:u,desktopActiveScenarios:m,desktopContext:g,deviceInfo:h,finalizeLegacyCrossClient:p,notifyDesktopScenarioFactoryReady:v,registerForCoreContext:y,systemCpuInfo:f,systemMemoryInfo:S}=yield this.initializeCrossClientTelemetry(o,e.hostCommunicationService),k={deviceInfo:h,systemCpuInfo:f,systemMemoryInfo:S},w=this.createCoreScenarioFactory(e,d,p,m,u),C=new PD(w,e.telemetryContextService,d,{isolateUserContext:null!==(n=e.coreSettings.get(b.J.Telemetry).isolateUserContext)&&void 0!==n&&n});return null==y||y(((e,t)=>{C.setCoreContext(e,t)})),null==v||v(),null===(r=e.hostCommunicationService)||void 0===r||r.setScenarioFactory(w),e.diagnosticsService.setScenarioFactory(w),e.coreSettingsContext.setScenarioFactory(w),yield this.createCoreTelemetryService(e,d,w,k,e.telemetryContextService,g),null===(l=null===(a=null===(s=e.windowProvider)||void 0===s?void 0:s.loader)||void 0===a?void 0:a.stopPieTimer)||void 0===l||l.call(a),this.createCoreUserBiService(e),this.startAppStartScenarios(e,w),e.altScenarioService=new NO({host:e.windowProvider,loggerFactory:e.loggerFactory,coreSettings:e.coreSettings,scenarioFactory:w}),e.hostCommunicationService&&(yield this.handOffContextCommsCallback(e.hostCommunicationService,e.coreSettings,C)),HM(C)}))}initializeCrossClientTelemetry(e,t){var i,n,r,s;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o={};if(t){try{const e=yield t.loadModule("scenario");e&&(e.getActiveScenarios&&(o.desktopActiveScenarios=yield e.getActiveScenarios({})),e.setScenarioCompletion&&(o.finalizeLegacyCrossClient=e.setScenarioCompletion),o.crossClientRegistrationMethods={},e.registerForScenarioMark&&e.registerForScenarioStart&&e.registerForScenarioStop&&(o.crossClientRegistrationMethods.marks={registerForScenarioStart:e.registerForScenarioStart,registerForScenarioMark:e.registerForScenarioMark,registerForScenarioStop:e.registerForScenarioStop}),e.registerForScenarioAppendEventData&&(o.crossClientRegistrationMethods.appendEventData=e.registerForScenarioAppendEventData),o.notifyDesktopScenarioFactoryReady=()=>{var t;null===(t=e.setWebAvailability)||void 0===t||t.call(e,!0)})}catch(t){e.errorToTelemetry&&e.errorToTelemetry(Vs.LoadModuleScenarioFailed,"webclient_framework_host_comms",void 0,!0)}try{const e=yield t.loadModule("osutils");e&&(o.deviceInfo=yield null===(i=e.getDeviceInfo)||void 0===i?void 0:i.call(e),o.systemCpuInfo=yield null===(n=e.getSystemCpuInfo)||void 0===n?void 0:n.call(e),o.systemMemoryInfo=yield null===(r=e.getSystemMemoryInfo)||void 0===r?void 0:r.call(e))}catch(t){e.errorToTelemetry&&e.errorToTelemetry(Vs.LoadModuleOsUtilsFailed,"webclient_framework_host_comms",void 0,!0)}try{const e=yield t.loadModule("telemetry"),i=null==e?void 0:e.registerForOnNewContext;i&&(o.registerForCoreContext=e=>{i((t=>{t.filter((e=>void 0===e.userContextId)).forEach((t=>e(t.column,t.value)))}))}),o.desktopContext=yield null===(s=null==e?void 0:e.getContext)||void 0===s?void 0:s.call(e,{columns:["launchIntent","desktopVersion","deviceAuthToken","windowsChannel","windowsSku","storageInfo","outOfProcState","installationSource"]})}catch(t){e.errorToTelemetry&&e.errorToTelemetry(Vs.LoadModuleTelemetryFailed,"webclient_framework_host_comms",void 0,!0)}}return o}))}handOffContextCommsCallback(e,t,i){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield e.loadModule("telemetry"),s=yield null===(n=null==o?void 0:o.getPreAuthUserSamplingId)||void 0===n?void 0:n.call(o);if(s&&(null===(r=this.setPreAuthUserId)||void 0===r||r.call(this,t,i,s)),o&&o.setContext){const e=o.setContext;(0,Ei.G)().setMultiContextCallback(((t,i,n)=>e([{column:t,value:i,userContextId:n}])))}if(o&&o.setCollectorContext){const e=o.setCollectorContext;(0,Ei.G)().setCollectorContextCallback(((t,i,n)=>e({enableTelemetryRegionReinit:t,telemetryRegion:i,telemetryRegionFetchComplete:n})))}}))}createMemoryAnalyzer(e,t){const{enableDesktopMemoryAnalyzer:i,isScenarioMemorySnapshotEnabled:n}=t;return i?new EO(!!n,e):void 0}createCoreScenarioFactory(e,t,i,n,o){const r=new hD({parentScenarioFactory:e.scenarioFactory,settings:dD(e.coreSettings),platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:e.correlation},e.config.startTimeMS,t,void 0,void 0,void 0,void 0,n,o,i);return e.scenarioFactory=r,r}createHeartbeatMonitor(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=new Ix.K(e);yield t.start(),e.heartbeatMonitor=t}))}createDataClientTrackerService(e){const t=[_e.pk.Inactive,_e.pk.LongInactive],i=[f.eT.Inactive,f.eT.LongInactive],n=e.platformService.config.clientType===wr.Bh.Maglev?()=>!!e.clientState&&t.includes(e.clientState.getState()):()=>!!e.appStateService&&i.includes(e.appStateService.getState());return new MO(e.coreSettings,e.leakDetectorService,e.userTrackingService,n)}createWindowTrackerService(e){e.windowTrackerService=new QO(e)}createCoreTelemetryService(e,t,i,n,r,s){var a;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{config:o,coreSettings:l,coreSecurityService:c,experimentationService:d,hostCommunicationService:u,loggerFactory:m,platformService:g,routingServices:h,windowProvider:p}=e,v=yield _E(u),y=(0,SE.pf)(p),f={osLocale:v,userLanguage:CE(p),localeCode:TE(p,h,l,y.localeCode),originLocaleCode:IE(p,h,l,y.localeCode)},{telemetryContext:S,provider:k}=((e,t,i,n,o,r)=>{const{loggerFactory:s,coreSettings:a,platformService:l,scenarioFactory:c,host:d}=i,u=s.newLogger("Telemetry","core-services-telemetry"),m=_M(e,u,l,a),g=o||new $A(u),{columnSuppression:h}=CM(s.newLogger("TelemetrySender","core-services-telemetry"),a),p=wM(a,d,n),v=RM(a),y=(0,Ei.G)();return y.initialize(Object.assign(Object.assign({},m),{workerOptions:{workerSetup:p,workerType:v},services:{logger:u,coreSettings:a,scenarioFactory:c,columnSuppressionService:h}}),u),TM(e,u,l,a,m.documentInfo,!1,g,t,r),{provider:y,telemetryContext:g}})({appStartTime:o.startTimeMS,experienceName:o.experienceName,windowType:o.windowType,clientTypeTelemetry:o.clientTypeTelemetry},f,{loggerFactory:m,platformService:g,coreSettings:l,scenarioFactory:i,host:p},{coreSecurityService:c,windowBaseUrl:p.document.location.origin},r,d);k.eventCapture=new BM.t(p,l,k.eventCapture);const w=new PD(i,S,t,{isolateUserContext:null!==(a=l.get(b.J.Telemetry).isolateUserContext)&&void 0!==a&&a});if(p.localStorage){const e=p.localStorage.getItem("ts.latestOid");null==w||w.setContext("UserInfo.Id",e)}o.externalCorrelationId&&w.setCoreContext("EventInfo.ExternalCorrelationId",o.externalCorrelationId),o.embedContext&&(w.setCoreContext("Window.EmbedContext",o.embedContext),w.setCoreContext("AppInfo.EmbedReferrer",function(e,t){try{const{referrer:i}=t.getSearchState(),n=e.document.referrer,o=e.parent.opener;let r=i;return YO(e,r)||(r=n&&(0,Cr.Lp)(n),YO(e,r)||(r=o&&o.location&&o.location.hostname||void 0,!YO(e,r)&&e.location.ancestorOrigins&&e.location.ancestorOrigins.length>0&&(r=e.location.ancestorOrigins[0]))),r||""}catch(e){return""}}(p,h.state))),this.setTelemetryContext(w,n,s),w.setCoreContext("AppInfo.ArchVersion","V2"),e.telemetryService=w}))}setPreAuthUserId(e,t,i){const n=e.get(b.J.Telemetry);i&&n.enablePreAuthIdSampling&&(t.setCoreContext("AppInfo.PreAuthUserSamplingId",i),tM.H.getInstance().setSamplingByPreAuthId(i))}createCoreUserBiService(e){var t;const{config:i}=e,n=null===(t=e.telemetryService)||void 0===t?void 0:t.createUserBiService(e,f.ew,{id:(0,xe.v4)(),source:k.D.StandAlone,startTimestamp:i.startTimeMS});e.userBiService=n}setTelemetryContext(e,t,i){const{deviceInfo:n,systemCpuInfo:o,systemMemoryInfo:r}=t;if(n&&(e.setCoreContext("DeviceInfo.Make",n.make),e.setCoreContext("DeviceInfo.Model",n.model),e.setCoreContext("DeviceInfo.CpuArchitecture",n.cpuArchitecture),e.setCoreContext("DeviceInfo.OsVersion",n.osVersion)),o&&(e.setCoreContext("CpuInfo.Cores",o.cpuCores.length.toString()),e.setCoreContext("CpuInfo.Model",o.cpuCores[0].model),e.setCoreContext("CpuInfo.Speed",o.cpuCores[0].speed)),r&&e.setCoreContext("DeviceInfo.TotalMemory",r.totalPhysicalMemoryBytes),i&&0!==i.length){const t=i.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.column]:t.value})),{}),n=t.launchIntent,o=t.desktopVersion,r=t.deviceAuthToken,s=t.windowsChannel,a=t.windowsSku,l=t.storageInfo,c=t.outOfProcState,d=t.installationSource;n&&e.setCoreContext("AppInfo.LaunchIntent",n),o&&e.setCoreContext("AppInfo.DesktopVersion",o),c&&e.setCoreContext("AppInfo.OutOfProcState",c),r&&e.setDeviceAuthToken(r),s&&e.setCoreContext("DeviceInfo.WindowsChannel",s),a&&e.setCoreContext("DeviceInfo.WindowsSku",a),l&&e.setCoreContext("DeviceInfo.StorageInfo",l),d&&e.setCoreContext("installationSource",d)}}startAppStartScenarios(e,t){const{config:i,routingServices:n,telemetryService:o,windowProvider:r}=e,s=this.getDownloadAndParseStepData(t,r);null==o||o.newCoreScenario(U.RG.AppStart,{startTime:i.startTimeMS}),ZO(i.experienceName,t,i.startTimeMS,n.state,r,s)}getDownloadAndParseStepData(e,t){let i;if(t.performance){t.performance.timing&&e.createScenarioWithoutStarting(U.RG.DomLoadingStart,{startTime:t.performance.timing.domLoading}).stop();const n=t.performance.getEntriesByType("resource").find((e=>"script"===e.initiatorType&&e.name.indexOf("main")>=0)),o=void 0!==n&&0===n.transferSize;i=eM(U.RG.DownloadAndParse,"execute-index-html-script","start-execute-main-bundle",t,e,{cached:o}),eM(U.RG.ResolveMainImports,"start-execute-main-bundle","resolve-main-imports-end",t,e)}return i}}const HM=e=>t=>{if("quit"===t)null==e||e.getTelemetryServicesCache().forEach((e=>{var t,i;return null===(i=(t=e.coreScenarioFactory).incompleteRunningScenarios)||void 0===i?void 0:i.call(t)}))};var qM=i(949300);class zM extends Ce.i{constructor(){super(f.Yg.InitUserBrbServiceTask,["activeWindowsService","scenarioFactory","loggerFactory","coreSettings","logsCollectorService","authenticationService","authenticationUser","platformService","discover","windowProvider","hostCommunicationService","endpointsManager","brbServiceManager","client","i18n"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsService:t,scenarioFactory:i,loggerFactory:n,coreSettings:o,logsCollectorService:r,authenticationService:s,authenticationUser:a,platformService:l,discover:c,windowProvider:d,hostCommunicationService:u,endpointsManager:m,brbServiceManager:g,client:h,i18n:p}=e;if(!a)throw new Error("authenticationUser is invalid, cannot register user brb service.");const v=(0,Ee.b4)(a);return g.registerUserBrbService(v,(()=>new qM.w(n,o,r,s,l,c,d,u,m,i,p,t,a,h))),e=>{"signout"===e&&g.unregisterUserBrbService(v)}}))}}class VM extends Ce.i{constructor(){super(f.Yg.InitializePulsarTask,["coreSettings","loggerFactory","platformService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,loggerFactory:i,platformService:n}=e,o=new $o(Po.TEAMS_CORE,{sessionId:n.host.sessionId,spanExporter:new Ho,loggerFactory:i,logToOTLCollector:!!t.get(b.J.Pulsar).logToOTLCollector});t.get(b.J.Pulsar).enablePulsarTelemetry&&(yield o.initialize()),e.pulsar=o}))}}class GM extends Ce.i{constructor(){super(f.Yg.RegisterCustomFrameThemes,["coreSettings","hostCommunicationService"])}execute(e){var t,i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:o,hostCommunicationService:s}=e,{primaryWindowTitleBarHeightPx:a,secondaryWindowTitleBarHeightPx:l}=o.get(b.J.Core),c=yield s.loadModule("windowcontrols");a&&l&&(null===(t=null==c?void 0:c.defineCustomFrameTheme)||void 0===t||t.call(c,"main",{buttonHeight:a,buttonWidth:44}),null===(i=null==c?void 0:c.defineCustomFrameTheme)||void 0===i||i.call(c,"default",{buttonHeight:l,buttonWidth:44}),null===(n=null==c?void 0:c.defineCustomFrameTheme)||void 0===n||n.call(c,"mainClassic",{buttonHeight:a,buttonWidth:44,light:{closeColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#c4314bff",mouseDown:"#a72037ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}},minMaxColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#4f52b2ff",mouseDown:"#3d3e78ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}}}}),null===(r=null==c?void 0:c.defineCustomFrameTheme)||void 0===r||r.call(c,"defaultClassic",{buttonHeight:l,buttonWidth:44,light:{closeColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#c4314bff",mouseDown:"#a72037ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}},minMaxColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#4f52b2ff",mouseDown:"#3d3e78ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}}}}))}))}}class JM extends Ce.i{constructor(){super(f.Yg.ReloadExperience,["coreSettings","platformService","rebootService","loggerFactory","scenarioFactory","windowProvider"]),this.isReloadRequired=(e,t)=>e&&t&&e!==t}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,platformService:i,rebootService:n,loggerFactory:o,scenarioFactory:r,windowProvider:s}=e,a=o.newLogger("ReloadExperienceTask","core-services-tasks"),{buildRing:l,assignedRing:c}=this.getRings(i,t);if(this.isReloadRequired(l,c)&&c){a.log(`Reload required: Assigned: ${c}, Build: ${l}`);return(yield n.rebootApp(ns.Z.RingSwitch,ns.d.ReloadAppTask,{qsps:{ring:c},maxRetries:1}))?this.deleteEcsCaches(s):this.reportReloadNotTriggered(l,c,a,r),e=>{"signout"===e&&n.clearRetryCount(ns.d.ReloadAppTask)}}a.debug(`No reload required: Assigned: ${c}, Build: ${l}`),n.clearRetryCount(ns.d.ReloadAppTask)}))}getRings(e,t){const{ring:i}=t.get(b.J.Metadata);return{assignedRing:(null==i?void 0:i.id)||void 0,buildRing:e.ecsOverrides.ring||void 0}}reportReloadNotTriggered(e,t,i,n){i.warn(`Ring Discrepancy: Assigned: ${t}, Build: ${e} `),n.createScenarioWithoutStarting(U.RG.BuildRingDiscrepancy).fail({message:e})}deleteEcsCaches(e){Object.keys(e.localStorage).filter((e=>e.endsWith(xm.EcsCache))).forEach((t=>e.localStorage.removeItem(t)))}}class KM extends Ce.i{constructor(){super(f.Yg.SetAppStateToTelemetryTask,["telemetryService","hostState","networkState","coreSettings"])}execute(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{telemetryService:n,hostState:o,networkState:r,coreSettings:s}=e;s.get(b.J.Telemetry).enableTelemetryCancelOnSuspendAndNetworkOffline&&(o&&n.initTelemetrySuspendStateSubscription(o,null!==(t=s.get(b.J.Telemetry).scenarioCancelOnSuspendStateChangeBlockList)&&void 0!==t?t:[]),r&&n.initTelemetryNetworkStateSubscription(r,null!==(i=s.get(b.J.Telemetry).scenarioCancelOnNetworkStateChangeBlockList)&&void 0!==i?i:[]))}))}}class QM extends Ce.i{constructor(){super(f.Yg.SetRingFinderCookieTask,["authenticationUser","coreSettings","loggerFactory","windowProvider","discover","i18NextWrapper"]),this.setAuthCookie=(e,t,i,n)=>{var o;if(void 0===(null===(o=e.document)||void 0===o?void 0:o.cookie))return void t.warn(`Cannot set cookie: '${i}'.`);t.log(`Setting '${i}' cookie.`);const r=new Date,s=r.setMonth(r.getMonth()+5);e.document.cookie=`${i}=${n};expires=${new Date(s).toUTCString()};path=/;secure;samesite=none`},this.subscribeToCountryCode=(e,t,i,n,o)=>{const r=null==t?void 0:t.getObservable(b.J.Metadata,["countryCode"]);this.metadataSettingsSubscription=null==r?void 0:r.subscribe((({countryCode:r})=>{const{enableCountryInRingFinder:s}=t.get(b.J.Core);s&&r&&r!==o.country&&(o.country=r,this.setAuthCookie(e,i,n,encodeURIComponent((0,M.u4)(o))))}))},this.cleanUpCookie=(e,t,i)=>{var n;void 0!==(null===(n=e.document)||void 0===n?void 0:n.cookie)&&(t.log(`Expiring '${i}' cookie.`),e.document.cookie=`${i}=;max-age=0;path=/;secure;samesite=none`)}}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,coreSettings:i,discover:n,loggerFactory:o,windowProvider:r,i18NextWrapper:s}=e,a=o.newLogger("SetRingFinderCookieTask","core-services-tasks");try{const{windowsInsiderChannel:e,windowsInsiderRing:o}=i.get(b.J.Host),{enableRegionParamForPDS:l,enableLocaleInRingFinder:c,enableCountryInRingFinder:d}=i.get(b.J.Core);let u;l&&(u=yield n.getRegion({id:t.id,tenantId:t.profile.tenantId,oid:t.profile.objectId,accountType:t.type,userName:t.loginUserName||""}));const m=c?s.locale:void 0,{countryCode:g}=i.get(b.J.Metadata),h=d?g:void 0,p={oid:t.profile.objectId,tid:t.profile.tenantId,wipChannel:e,wipRing:o,region:u,locale:m,country:h},v="ringFinder";return this.setAuthCookie(r,a,v,encodeURIComponent((0,M.u4)(p))),this.subscribeToCountryCode(r,i,a,v,p),e=>{var t;switch(null===(t=this.metadataSettingsSubscription)||void 0===t||t.unsubscribe(),this.metadataSettingsSubscription=void 0,e){case"signout":{const{cleanupRingFinderCookie:e}=i.get(b.J.Core);e&&this.cleanUpCookie(r,a,v);break}default:return}}}catch(e){a.error(`Failed to set ring finder cookie: ${(0,se.VK)(e)}`)}}))}}class YM extends Ce.i{constructor(){super(f.Yg.SetPrimaryUserOnTelemetry,["primaryUser","loggerFactory","telemetryContextService","hostCommunicationService"])}execute(e){var t,i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{primaryUser:o,loggerFactory:r,telemetryContextService:s,hostCommunicationService:a}=e;try{const e=(0,Ee.b4)(o),i=o.profile.tenantId;s.setPrimaryUser(e,i);const n=yield a.loadModule("telemetry");null===(t=null==n?void 0:n.setPrimaryUser)||void 0===t||t.call(n,e,i)}catch(e){const t=new Ne.G(Ne.$.TELEMETRY_PRIMARY_USER_SET_FAILURE,e,(0,Ee.b4)(o));null===(n=(i=r.newLogger("SetUserOnTelemetryContext","core-services-tasks")).error)||void 0===n||n.call(i,t.toTelemetryEntry())}}))}}class XM{constructor(){this.id=f.Yg.SetUserOnDiagnosticsService}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,coreSettings:i,diagnosticsService:n,logsCollectorService:o}=Lu("SetUserOnDiagnosticsServiceTask",e,"authenticationUser","coreSettings","diagnosticsService","logsCollectorService");o.setPrimaryUserID(t.id);const{enableMTMA:r}=i.get(b.J.Core);if(r){const i=n.createUserDiagnosticsService(t.profile.tenantId,t.profile.objectId,t.id);i&&(e.diagnosticsService=i,o.registerUserLogsProvider(t.id,i),e.loggerFactory=new oe(i,e.loggerFactory.cID))}else n.updateDiagnosticInfo(t.profile.tenantId,t.profile.objectId);return e=>{switch(e){case"quit":n.persistDiagnosticsAsPreviousSessionLogs();break;case"signout":t.id&&o.handleUserLogout(t.id),n.handleUserLogout(t.id)}}}))}}var ZM=i(100329);class eR extends Ce.i{constructor(){super(f.Yg.SignalCoreLifecycleChangesTask,["authenticationUser","client","clientState","config","coreSecurityService","coreSettings","coreUtilities","correlation","entityCommanding","experienceChangeReportingService","experienceLifecycleManager","hostCommunicationService","i18n","i18NextWrapper","localStorage","loggerFactory","networkState","platformService","rebootService","scenarioFactory","userBiService","windowProvider","notificationsHandler","logsCollectorService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{activeWindowsHistoryService:t,authenticationUser:i,client:n,clientState:r,clientAccessAdminPolicyCheckService:s,config:a,coreSecurityService:l,coreSettings:c,coreUtilities:{isEntityInView:d},correlation:u,entityCommanding:m,experienceChangeReportingService:g,experienceLifecycleManager:h,hostCommunicationService:p,i18n:v,i18NextWrapper:y,localStorage:f,loggerFactory:S,networkState:k,platformService:w,rebootService:C,scenarioFactory:_,userBiService:T,userTrackingService:I,windowProvider:j,notificationsHandler:N,logsCollectorService:E}=e,x=e.localMigratedSettings,A=S.newLogger("SignalCoreLifecycleChangesTask","core-services-tasks");if(!i||!(0,ZM.$l)(i))return void A.warn("Not creating user lifecycle manager as authenticated user is not available.");const{disableExperience:D}=c.get(b.J.Core),{crossCloudMeetingEnabled:F}=c.get(b.J.HostCapabilities),O=D&&i.role!==Es.w4.Anonymous,M=D&&!1===F&&i.role===Es.w4.Anonymous;if(O||M)return void A.warn(`Not creating user lifecycle manager as experience is disabled. UserRole ${i.role}, \n          disableExperience: ${D}, crossCloudMeetingEnabled: ${F}`);if(s){let e;try{e=yield s.isUserAllowed()}catch(t){A.warn(`isUserAllowed encountered exception: ${t}`),e=!0}if(!e)return void A.warn("Not creating user lifecycle manager as experience is disabled by admin policy.")}const R=u.id,P=(0,Ee.b4)(i);return h.manageUser(P,{activeWindowsHistoryService:t,authenticationUser:i,client:n,clientState:r,config:a,coreSecurityService:l,coreSettings:c,entityCommanding:m,i18n:v,i18NextWrapper:y,isEntityInView:d,localMigratedSettings:x,loggerFactory:S,networkState:k,platformService:w,rebootService:C,scenarioFactory:_,hostCommunicationService:p,userTrackingService:I,windowProvider:j,localStorage:f,userBiService:T,notificationsHandler:N,logsCollectorService:E}),g.report({correlationId:R,userContextId:P,type:ft.yU.UserAuthenticated,context:{target:"core-tasks-signal-core-lifecycle-changes-task"}}),(0,ZM.Ej)(c,f)||g.report({correlationId:R,type:ft.yU.UserConsentedToConsumeResources,userContextId:P,context:{target:"core-tasks-signal-core-lifecycle-changes-task"}}),e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){switch(e){case"quit":case"signout":yield h.removeUser(e,P);break;default:return}}))}))}}class tR extends Ce.i{constructor(){super(f.Yg.StoreBuildInfoTask,["localStorage","platformService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{localStorage:t,platformService:i}=e,n=i.config.buildVersion;n&&!n.toLocaleLowerCase().startsWith("local")&&t.set("buildNumber",n,"Framework","Experience")}))}}class iR extends Ce.i{constructor(){super(f.Yg.TrackExperienceIdle,["clientState","correlation","coreSettings","experienceChangeReportingService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{clientState:t,correlation:i,coreSettings:n,experienceChangeReportingService:r}=e,{enableExperienceIdleStateManagement:s}=n.get(b.J.Core);if(!s)return;const a=t.observe().subscribe((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=e===_e.pk.LongInactive;r.report({correlationId:i.id,type:ft.yU.ExperienceIdleStateChanged,context:{target:"core-tasks-signal-core-lifecycle-changes-task",isIdle:t}})}))));return e=>{switch(e){case"signout":case"quit":a.unsubscribe()}}}))}}class nR extends Ce.i{constructor(){super(f.Yg.UpdateDataClientContext,[])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){!function(e,t){var i,n,o;const r=Object.assign(Object.assign({},t),{pubsub:e.getServices().pubsub,send:(0,Za.UZ)(el.l,t.networkState.observeIsOnline())}),s=dp.singletonLink,a=sk.clientResolvers;if(!s||!a)throw new Error("Link and client resolvers should be created at this point");const{maxApolloResultCacheSize:l,enableApolloDoubleWriteFix:c}=t.coreSettings.get(b.J.Core),{enableApolloDevtools:d}=t.coreSettings.get(b.J.Diagnostics),u=null!=l?l:void 0,m=null===(i=t.leakDetectorService)||void 0===i?void 0:i.create(),g=DI({leakDetector:m,windowId:null===(n=e.cache.apolloLeakInfo)||void 0===n?void 0:n.apolloLeakInfoWindowId,entityType:null===(o=e.cache.apolloLeakInfo)||void 0===o?void 0:o.apolloLeakInfoEntityType,viewportContext:"cmd"},void 0,a,u,t.loggerFactory,t.scenarioFactory,void 0,d,ih.t.cmd,t.graphqlStoreStatsReporterService,c);gh(g,"cmdApolloClient",Boolean(d),t.platformService,t.config.experienceName);const h=EI.createUserDataRequestContext(r,g),p=RI(h,s);e.updateContext(h,p),g.setLink(p)}(e.client,e)}))}}class oR extends Ce.i{constructor(){super(f.Yg.UpdateNetworkStateDetection,[])}execute(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=e.authenticationUser&&(0,Ee.b4)(e.authenticationUser)||"",o=null===(i=(t=e.networkState).subscribeToEndpointsNetworkStateTracking)||void 0===i?void 0:i.call(t,n,e.endpointsManager.networkState);return e=>{"signout"===e&&o()}}))}}class rR extends Ce.i{constructor(){super(f.Yg.WaitForCDLWorkerTask,["loggerFactory","coreSettings","coreSettingsContext"])}execute(e){var t,i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{loggerFactory:n,coreSettings:o,coreSettingsContext:r}=e,{cdlWorkerService:s}=e,a=n.newLogger("WaitForCDLWorkerTask","core-services-tasks");if(!(0,nd.Q6)(o))return;const{isCDLWorkerCriticalToStartup:l}=o.get(b.J.Core);if(s){a.log("Waiting for CDL worker to finish initialization");const e=yield s.getCDLWorkerManager();if(e)e.syncEngineInitializationPromise.then((e=>{r.updatePlatformProviderSettings({bootType:e.bootType})}));else if(null===(t=a.errorToTelemetry)||void 0===t||t.call(a,`CDL worker manager not initialized. isCDLWorkerCriticalToStartup: ${l}.`,"cdl_wait_for_cdl_worker_task",void 0,!0),l)throw new Ne.G(Ne.$.CDL_WORKER_FAILURE)}else if(null===(i=a.warnToTelemetry)||void 0===i||i.call(a,`CDL worker service not present in core context. isCDLWorkerCriticalToStartup: ${l}.`,"cdl_wait_for_cdl_worker_task",void 0,!0),l)throw new Ne.G(Ne.$.CDL_WORKER_FAILURE)}))}}class sR extends Ce.i{constructor(){super(f.Yg.WrapChangeReportingServicesTask,["commandChangeReportingService","experienceChangeReportingService","authenticationUser"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{commandChangeReportingService:t,experienceChangeReportingService:i,authenticationUser:n}=e,o=(0,Ee.b4)(n);return e.commandChangeReportingService=Object.assign(Object.assign({},e.commandChangeReportingService),{report:e=>{t.report(Object.assign({userContextId:o},e))},observeChanges:t.observeChanges.bind(t)}),e.experienceChangeReportingService=Object.assign(Object.assign({},e.experienceChangeReportingService),{report:e=>{i.report(Object.assign({userContextId:o},e))},observeChanges:i.observeChanges.bind(i)}),Promise.resolve()}))}}class aR{constructor(e,t,i){this.cache=new Map,this.lastId=0,this.blacklist=["imgpsh_fullsize"],this.currentSize=0,this.cacheHits=0,this.cacheMisses=0,this.maxCacheSize=e,this.cachePruneRatio=t,this.scenarioFactory=i}add(e,t,i){var n;if(this.maxCacheSize<=0)return!1;if(!t)return!1;if(!this.shouldCache(e))return!1;let o;if(this.has(e,t)){const r=this.get(e,t);o=Object.assign(Object.assign({},r),i),r&&(r.blob!==i.blob&&URL.revokeObjectURL(r.blob),this.currentSize+=o.size-(null!==(n=null==r?void 0:r.size)&&void 0!==n?n:0))}else o=Object.assign(Object.assign({},i),{time:this.lastId++}),this.cacheMisses++,this.currentSize+=o.size;const r=this.getCacheKey(e,t);return this.cache.set(r,o),this.pruneIfNeeded(),!0}setCapacity(e,t){this.maxCacheSize=e,this.cachePruneRatio=t,this.pruneIfNeeded()}has(e,t){return!!t&&this.cache.has(this.getCacheKey(e,t))}get(e,t){if(!t)return;const i=this.getCacheKey(e,t),n=this.cache.get(i);return n&&(n.time=this.lastId++,this.cacheHits++),n}get size(){return this.cache.size}getCacheKey(e,t){return`${e}/${t}`}getCacheHitRatio(){const e=this.cacheHits+this.cacheMisses;if(!e)return 0;return Math.round(this.cacheHits/e*100)/100}shouldCache(e){for(const t of this.blacklist)if(e.includes(t))return!1;return!0}pruneIfNeeded(){if(this.currentSize>this.maxCacheSize){const e={};e.cacheCountBeforePruning=this.size;const t=this.scenarioFactory.newScenario(U.RG.AMSMemoryCachePrune),i=Array.from(this.cache.entries());i.sort(((e,t)=>e[1].time-t[1].time));const n=Math.max(this.currentSize-this.maxCacheSize,Math.ceil(this.maxCacheSize*this.cachePruneRatio));let o=0;for(const[e,t]of i){const i=t.size;if(!(o+i<=n))break;this.currentSize-=i,this.cache.delete(e),o+=i,URL.revokeObjectURL(t.blob)}e.cacheHitRatio=this.getCacheHitRatio(),e.cacheCountAfterPruning=this.size,t.stop(e)}}}class lR extends Ce.i{constructor(){super(f.Yg.CreateAMSImageCaches,["coreSettings","scenarioFactory"]),this.BYTE_MULTIPLIER=1e6,this.PRUNE_RATIO=.2}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,scenarioFactory:i}=e,n=new aR(0,this.PRUNE_RATIO,i);e.amsImageCache=n;const o=t.getObservable(b.J.ImageCache).subscribe((e=>{let t=0;"number"==typeof e.amsImageCacheMaxCapacityInMB&&(t=e.amsImageCacheMaxCapacityInMB),n.setCapacity(t*this.BYTE_MULTIPLIER,this.PRUNE_RATIO)}));return()=>o.unsubscribe()}))}}class cR{constructor(e,t,i,n){this._windowId=e,this._logger=t,this._enableDecoupleCommandingFromApollo=i,this._commandChangeReportingService=n,this._entityExtensionSubject=new s.t,this._extendedEntityContainerStateSubject=new s.t,this._modalState=void 0}observeModalState(){return this.enableDecoupleCommandingFromApollo?this._entityExtensionSubject:null}get enableDecoupleCommandingFromApollo(){return this._enableDecoupleCommandingFromApollo}observeContainerState(){return this._extendedEntityContainerStateSubject.complete(),this._extendedEntityContainerStateSubject=new s.t,this._extendedEntityContainerStateSubject}isBlockingEntityExtension(){return!!this._blockingEntityExtension}isBlockedByEntity(e){var t;return this.enableDecoupleCommandingFromApollo?(null===(t=this._blockingEntityExtension)||void 0===t?void 0:t.type)===e:null}setBlockingEntityExtension(e){this._blockingEntityExtension=e}setEntityExtension(e,t,i,n){var o,r,s;this._logger.log(`setEntityExtension is called with ${e} ${t} ${i}`),t!==(null===(o=this._modalState)||void 0===o?void 0:o.isExternal)||this.hasEntityChanged(i)?(this._modalState=Object.assign(Object.assign({},this._modalState),{isExternal:t,entity:i}),this._entityExtensionSubject.next({isExternal:!!(null===(r=this._modalState)||void 0===r?void 0:r.isExternal),entityExtension:null===(s=this._modalState)||void 0===s?void 0:s.entity,correlationId:e}),n&&this._commandChangeReportingService.report({correlationId:e,type:Ae.B.WindowUpdated,context:{target:"executeEntityCommand"}})):n&&this._commandChangeReportingService.report({correlationId:e,type:Ae.B.WindowNotUpdated,context:{target:"executeEntityCommand"}})}setContainerState(e,t){var i,n,o,r,s;e!==(null===(i=this._modalState)||void 0===i?void 0:i.containerState)&&(this._modalState=Object.assign(Object.assign({},this._modalState),{containerState:e}),(null===(n=this._modalState)||void 0===n?void 0:n.containerState)&&this._extendedEntityContainerStateSubject.next({containerState:null===(o=this._modalState)||void 0===o?void 0:o.containerState,hasEntityExtension:!!(null===(s=null===(r=this._modalState)||void 0===r?void 0:r.entity)||void 0===s?void 0:s.type)}),e!==ve.oq.Open&&t&&this.setEntityExtension((0,xe.v4)(),!1,void 0,t))}updateModalState(e){var t,i,n,o,r;e.id===this._windowId?(this.setEntityExtension(e.correlation.id,(null===(n=e.extendedEntityContainerState)||void 0===n?void 0:n.isExternal)||!1,(null===(o=e.activeEntities)||void 0===o?void 0:o.entityExtension)||void 0,!1),this.setContainerState(null===(r=e.extendedEntityContainerState)||void 0===r?void 0:r.containerState,!1)):null===(i=(t=this._logger).errorToTelemetry)||void 0===i||i.call(t,"updateModalState got called on wrong window","webclient_framework_foundation_core_services_active_windows")}hasEntityChanged(e){var t;const i=null===(t=this._modalState)||void 0===t?void 0:t.entity;return(null==i?void 0:i.id)!==(null==e?void 0:e.id)||(null==i?void 0:i.type)!==(null==e?void 0:e.type)||(null==i?void 0:i.action)!==(null==e?void 0:e.action)||(null==i?void 0:i.options)!==(null==e?void 0:e.options)}}class dR{constructor(e,t,i,n,o){this._userContextId=t,this._enableDecoupleCommandingFromApollo=n,this._modalManager=new cR(e,i,n,o)}get enableDecoupleCommandingFromApollo(){return this._enableDecoupleCommandingFromApollo}get modalManager(){return this._modalManager}setUserContextId(e){this._userContextId=e}validateUserContext(e){return this._userContextId!==e}}function uR({correlation:e,entity:t,openOnMainWindow:i,mainWindowLayoutMode:n,userContextId:o,windowId:r=f.ew}){var s;let a=r;this._logger.log(`handleExtendCommand is called with: openOnMainWindow:${i}, mainWindowLayoutMode:${n}, userContextId: ${o}, windowId: ${r}, entity: ${t}`),i&&(a=null===(s=this.getMainWindowWithLayoutMode(null!=n?n:ve.lO.standard))||void 0===s?void 0:s.id);const l=a?this.getActiveWindow(a):void 0;if(("switchaccountdialog"!==(null==t?void 0:t.type)||"view"!==(null==t?void 0:t.action))&&null!==(null==l?void 0:l.userContextId)&&this.getWindowLayoutService(a).validateUserContext(o))return this._logger.log("User context of source window does not match user context of command. Rejecting command"),void this._commandChangeReportingService.report({correlationId:e.id||"",type:Ae.B.Incomplete,context:{errorInfo:De.y.UserContextMismatch,target:"handleExtendCommand"}});const c=this.getWindowLayoutService(a);this._logger.log(`handleExtendCommand is acting on window ${a}`),c.modalManager.setEntityExtension(e.id,!1,t,!0)}class mR{constructor(e,t,i,n){this._enableDecoupleCommandingFromApollo=t,this._enableDecoupleCommandingFromApolloRerenderForCorrelation=i,this._commandChangeReportingService=n,this._activeWindowsSubject=new s.t,this.cleanup=(e,t)=>{this._logger.log(`cleaning up activeWindowsService for user: ${t} due to ${e}`)},this._activeWindows=new Map,this._windowLayoutServices=new Map,this._logger=e.newLogger("ActiveWindowsService","core-services-active-windows"),this._defaultMainWindowLayoutService=new dR(f.ew,void 0,this._logger,t,this._commandChangeReportingService),this._windowLayoutServices.set(f.ew,this._defaultMainWindowLayoutService)}getActiveWindowsObservable(){return this._activeWindowsSubject.pipe((0,c.U)((e=>Array.from(e.values()))))}getActiveWindowObservable(e){return this._activeWindowsSubject.pipe((0,c.U)((t=>t.get(e))),(0,u.h)((e=>!!e)),(0,Ws.x)(((e,t)=>this.comparator(e,t))))}getActiveWindows(){return Array.from(this._activeWindows.values())}getActiveWindow(e){return this._activeWindows.get(e)}setActiveWindows(e,t){const i=new Set(Array.from(this._activeWindows.keys()));this._activeWindows.clear(),e.forEach((e=>{this._createWindowLayoutService(e.id,e.userContextId||void 0),this._activeWindows.set(e.id,e),i.delete(e.id)})),i.forEach((e=>this._windowLayoutServices.delete(e))),null==t||t(),this._activeWindowsSubject.next(this._activeWindows)}removeActiveWindowById(e){this._windowLayoutServices.delete(e);const t=this._activeWindows.get(e);return this._activeWindows.delete(e),this._activeWindowsSubject.next(this._activeWindows),t}getStandardMainWindow(){const e=this.getActiveWindows();return null==e?void 0:e.find((e=>e.isMainWindow&&e.layoutConfig.layoutMode===ve.lO.standard))}getMainWindowWithLayoutMode(e){const t=this.getActiveWindows();return null==t?void 0:t.find((t=>t.isMainWindow&&t.layoutConfig.layoutMode===e))}getWindowLayoutService(e=f.ew){if(!this._enableDecoupleCommandingFromApollo)return this._defaultMainWindowLayoutService;const t=this._windowLayoutServices.get(e);if(!t)throw new Ne.G(Ne.$.CORE_SERVICES_MISSING,new Error(`windowLayoutService was not created for windowId: ${e}`));return t}executeCommand(e){return{handleExtendCommand:uR.bind(this)}[e]}getMatchingWindow(e,t,i){return this.getActiveWindows().find((n=>this._matchingWindowFinder(n,e,t,i)))}get enableDecoupleCommandingFromApollo(){return this._enableDecoupleCommandingFromApollo}_matchingWindowFinder(e,t,i,n){var o,r;if(i!==e.userContextId||(null==n?void 0:n.includes(e.id)))return!1;return[e.activeEntities.mainEntity,e.activeEntities.endEntity,null===(o=e.activeEntities.mainEntity)||void 0===o?void 0:o.linkedEntity,null===(r=e.activeEntities.endEntity)||void 0===r?void 0:r.linkedEntity].find((e=>t.find((t=>(null==e?void 0:e.type)===(null==t?void 0:t.type)&&(null==e?void 0:e.id)===(null==t?void 0:t.id)))))}_createWindowLayoutService(e,t){var i;this._windowLayoutServices.get(e)?null===(i=this._windowLayoutServices.get(e))||void 0===i||i.setUserContextId(t):this._windowLayoutServices.set(e,new dR(e,t,this._logger,this._enableDecoupleCommandingFromApollo,this._commandChangeReportingService))}comparator(e,t){return(null==e?void 0:e.userContextId)===(null==t?void 0:t.userContextId)&&this.hasSameActiveEntities(null==e?void 0:e.activeEntities,null==t?void 0:t.activeEntities)&&this.hasSameLayoutConfig(null==e?void 0:e.layoutConfig,null==t?void 0:t.layoutConfig)&&!((null==t?void 0:t.correlation.id)!==(null==e?void 0:e.correlation.id)&&this._enableDecoupleCommandingFromApolloRerenderForCorrelation)}hasSameActiveEntities(e,t){const i=Object.keys(pe.$z).filter((i=>{var n,o,r,s,a,l;const c=null==e?void 0:e[i],d=null==t?void 0:t[i];return(null==c?void 0:c.action)!==(null==d?void 0:d.action)||(null==c?void 0:c.id)!==(null==d?void 0:d.id)||(null===(n=null==c?void 0:c.linkedEntity)||void 0===n?void 0:n.action)!==(null===(o=null==d?void 0:d.linkedEntity)||void 0===o?void 0:o.action)||(null===(r=null==c?void 0:c.linkedEntity)||void 0===r?void 0:r.id)!==(null===(s=null==d?void 0:d.linkedEntity)||void 0===s?void 0:s.id)||(null===(a=null==c?void 0:c.linkedEntity)||void 0===a?void 0:a.type)!==(null===(l=null==d?void 0:d.linkedEntity)||void 0===l?void 0:l.type)||(null==c?void 0:c.options)!==(null==d?void 0:d.options)||(null==c?void 0:c.type)!==(null==d?void 0:d.type)}));return 0===i.length}hasSameLayoutConfig(e,t){if((null==e?void 0:e.isFullscreen)!==(null==t?void 0:t.isFullscreen)||(null==e?void 0:e.layoutMode)!==(null==t?void 0:t.layoutMode))return!1;const i=Object.keys(ve.mR).filter((i=>{var n,o;const r=null===(n=null==e?void 0:e.slots)||void 0===n?void 0:n[i],s=null===(o=null==t?void 0:t.slots)||void 0===o?void 0:o[i];return(null==r?void 0:r.height)!==(null==s?void 0:s.height)||(null==r?void 0:r.isHidden)!==(null==s?void 0:s.isHidden)||(null==r?void 0:r.width)!==(null==s?void 0:s.width)}));return 0===i.length}}class gR extends Ce.i{constructor(){super(f.Yg.CreateActiveWindowsServiceTask,["loggerFactory","coreSettings","commandChangeReportingService"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{commandChangeReportingService:t,coreSettings:i,loggerFactory:n}=e,{enableDecoupleCommandingFromApollo:o,enableDecoupleCommandingFromApolloRerenderForCorrelation:r}=i.get(b.J.Core),s=new mR(n,!!o,!!r,t);return e.activeWindowsService=s,e=>s.cleanup(e)}))}}var hR=i(839856);class pR{constructor(e,t,i){this.logger=i;const n=this;this.proxy=new Proxy(t,{get(t,o){const r=t[o];if(r)return"function"!=typeof r?r:(...s)=>{let a="";a=n.getParamsAsString(s,!0),i.log(`Calling ${e}.${String(o)}(${a})`);const l=r.apply(t,s);return l&&l.then&&l.then((t=>i.log(`${e}.${String(o)}(${a}) response: ${n.getParamsAsString(t)}`))).catch((t=>i.error(`${e}.${String(o)}(${a}) response: ${n.getParamsAsString(t)}`))),l};i.error(`${e}.${String(o)}: Not Available`)}})}getProxy(){return this.proxy}getParamsAsString(e,t=!1){let i="";try{i=t?e.map((e=>JSON.stringify(e))).join(","):JSON.stringify(e);const n=1e3;if("string"==typeof i&&i.length>n){const e="...";i=`${i.substring(0,n-e.length)}${e}"`}}catch(e){this.logger.log(`Failed to serialize params: ${e.message}`)}return i}}const vR="tmp.vdiOptimizationMode";class yR{constructor(e,t,i){this.loggerFactory=e,this.hostCommunicationService=t,this.windowProvider=i,this.logger=this.loggerFactory.newLogger("VDIPlatformService","core-services-vdi")}init(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{yield this.loadVDIModule();const i=yield null===(t=null===(e=this.vdiModule)||void 0===e?void 0:e.getAllVDISettings)||void 0===t?void 0:t.call(e);if(i){const{mode:e,provider:t,isAvRemoted:n,configFilter:r,optimizationMode:s,citrixVdaVersion:a,vmwareVdaVersion:l,sessionId:c,isWebRTCEnabled:d}=i,u=this.getVDIPlatformProvider(t);if(u===Jm.None)return;const m=this.getVDISubProvider(t),g=this.getProxiedVdiModule(),h=e=>Promise.reject(`${e}: Not Available`),p={isVDI:!0,mode:e,provider:u,subProvider:m,isAvRemoted:n,configFilter:"string"==typeof r&&r.length?r:null,sessionId:c,vdiOptimizationMode:s,isWebRTCEnabled:d,utils:{getWVDConfig:()=>{var e,t;return null!==(t=null===(e=g.getWVDConfig)||void 0===e?void 0:e.call(g))&&void 0!==t?t:h("getWVDConfig")},getWindowHandleAsHex:()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.getMainWindowId();return this.getNativeWindowHandleAsHex(null!=e?e:"invalid-id")})),getNativeWindowHandle:e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.getNativeWindowHandleAsHex(e)})),getVDILocalStackPolicy:()=>{var e,t;return null!==(t=null===(e=g.getVDILocalStackPolicy)||void 0===e?void 0:e.call(g))&&void 0!==t?t:h("getVDILocalStackPolicy")},getVMWareSecureWebPort:()=>{var e,t;return null!==(t=null===(e=g.getVMWareSecureWebPort)||void 0===e?void 0:e.call(g))&&void 0!==t?t:h("getVMWareSecureWebPort")},getCitrixMSTeamsRedir:()=>{var e,t;return null!==(t=null===(e=g.getCitrixMSTeamsRedir)||void 0===e?void 0:e.call(g))&&void 0!==t?t:h("getCitrixMSTeamsRedir")},getCitrixVdaVersion:()=>Promise.resolve(a),getVMwareVdaVersion:()=>Promise.resolve(l),getVMWareViewClientId:()=>{var e,t;return null!==(t=null===(e=g.getVMWareViewClientId)||void 0===e?void 0:e.call(g))&&void 0!==t?t:h("getVMWareViewClientId")},setVDIOptimizationMode:e=>this.setVDIOptimizationModeOverride(e),resetVDIOptimizationMode:()=>this.setVDIOptimizationModeOverride(void 0)}},v=this.getVDIOptimizationSettingsOverride(p);return p&&v&&(p.mode=v.mode,p.isAvRemoted=v.isAvRemoted,p.configFilter=v.configFilter,p.vdiOptimizationMode=v.vdiOptimizationMode,this.logger.log("VDIOptimizationSettingsOverride vdiPlatformConfig.vdiOptimizationMode:",p.vdiOptimizationMode)),p}}catch(e){let t="Unknown Error";this.vdiModule||(t="Failed to load vdiModule"),this.logger.error(`Failed to setup VDI environment: ${t}`)}}))}setVDIOptimizationModeOverride(e){switch(e){case hR.bT.webrtc:case hR.bT.slimcore:case hR.bT.none:this.windowProvider.localStorage.setItem(vR,e);break;default:this.windowProvider.localStorage.removeItem(vR)}}getVDIOptimizationModeOverride(){const e=this.windowProvider.localStorage.getItem(vR);switch(e){case hR.bT.webrtc:case hR.bT.slimcore:case hR.bT.none:return e;default:return}}getVDIOptimizationSettingsOverride(e){const t=this.getVDIOptimizationModeOverride();return t&&e?{mode:this.getVdiModeOverride(e.mode,t),isAvRemoted:hR.bT.webrtc===t,configFilter:this.getConfigFilterOverride(e.provider,t),vdiOptimizationMode:t}:null}getVdiModeOverride(e,t){let i="0";switch(t){case hR.bT.webrtc:i="1";break;case hR.bT.slimcore:i="2"}return 4===e.length?e[0]+i+e.substring(2):e}getConfigFilterOverride(e,t){let i="vdi";const n=this.getProviderConfigString(e);if(n)switch(t){case hR.bT.webrtc:i="vdi-av-".concat(n);break;case hR.bT.slimcore:i="vdi-slimcore-".concat(n)}return i}getProviderConfigString(e){switch(e){case Jm.CitrixXenDesktop:case Jm.CitrixXenApp:return"citrix";case Jm.VMWare:return"vmware";case Jm.WVD:return"wvd";default:return""}}getVDIPlatformProvider(e=hR.GV.None){let t=Jm.None;switch(e){case hR.GV.Citrix:t=Jm.CitrixXenDesktop;break;case hR.GV.VMware:t=Jm.VMWare;break;case hR.GV.AVD:case hR.GV.Windows365:t=Jm.WVD;break;case hR.GV.None:default:t=Jm.None}return t}getVDISubProvider(e=hR.GV.None){let t=Km.none;if(e===hR.GV.Windows365)t=Km.windows365;else t=Km.none;return t}getMainWindowId(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.loadWindowControlsModule().then((e=>{if(null==e?void 0:e.getWindowByTag)return e.getWindowByTag(Ni.px.Main);throw new Error("Could not load window controls module")})).then((e=>(this.logger.log(`[getMainWindowId] Got main window ID: ${e}`),e))).catch((e=>{throw this.logger.error("[getMainWindowId] Failed to retrieve main window ID"),e}))}))}getNativeWindowHandleAsHex(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.logger.log(`[getNativeWindowHandleAsHex] trying to get native window handle for windowId: ${e}`),this.getNativeWindowHandle(e).then((t=>{if(null==t?void 0:t.handle)return this.windowHandleToHex(t.handle);{const t=`Failed to retrieve native window handle for windowId: ${e}`;throw this.logger.log(`[getNativeWindowHandleAsHex] ${t}`),new Error(t)}})).then((e=>(this.logger.log(`[getNativeWindowHandleAsHex] Got native window handle as hex: ${e}`),e)))}))}getNativeWindowHandle(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.logger.log(`[getNativeWindowHandle] trying to get native window handle for windowId: ${e}`),this.loadOSUtilsModule().then((t=>{if(null==t?void 0:t.getHostWindowHandle)return t.getHostWindowHandle(e).then((t=>(this.logger.log(`[getNativeWindowHandle] Got native window handle for ${e}: ${null==t?void 0:t.handle}`),t))).catch((t=>{throw this.logger.error(`[getNativeWindowHandle] Failed to retrieve native window handle for ${e}`),t}));throw new Error("osUtils.getHostWindowHandle is not available")}))}))}windowHandleToHex(e){let t=e.toString(16);for(;t.length<16;)t=`0${t}`;return t.length%2!=0&&(t=`0${t}`),this.logger.log(`[windowHandleToHex] Converted native window handle ${e} to hex: ${t}`),this.convertWindowHandleHexEndianness(t)}convertWindowHandleHexEndianness(e){var t,i;return null!==(i=null===(t=null==e?void 0:e.match(/[0-9a-f]{2}/gi))||void 0===t?void 0:t.reverse().join(""))&&void 0!==i?i:null}loadVDIModule(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return void 0===this.vdiModule&&(this.vdiModule=yield this.hostCommunicationService.loadModule("vdi")),this.vdiModule}))}getProxiedVdiModule(){return!this.proxiedVDIModule&&this.vdiModule&&(this.proxiedVDIModule=new pR("vdiModule",this.vdiModule,this.logger).getProxy()),this.proxiedVDIModule}loadOSUtilsModule(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return void 0===this.osUtilsModule&&(this.osUtilsModule=yield this.hostCommunicationService.loadModule("osutils")),this.osUtilsModule}))}loadWindowControlsModule(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return void 0===this.windowControlsModule&&(this.windowControlsModule=yield this.hostCommunicationService.loadModule("windowcontrols")),this.windowControlsModule}))}}class fR{constructor(e){this.utils=e}setVdiService(e){this.service=e}provide(){return this.pluginlessMediaSupportService||this.service}setPluginlessMediaSupportService(e){this.pluginlessMediaSupportService=e}providePluginlessMediaSupportService(){return this.pluginlessMediaSupportService}setSlimCoreCallingSupportService(e){this.vdiSlimCoreCallingSupportService=e}provideCallingSupportService(){var e;return null!==(e=this.vdiSlimCoreCallingSupportService)&&void 0!==e?e:void 0}}class SR extends Ce.i{constructor(){super(f.Yg.InitVDIPlatformServiceTask,["loggerFactory","getPlatformConfigurationOverrides","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{loggerFactory:t,getPlatformConfigurationOverrides:i,windowProvider:n}=e,o=t.newLogger("InitVDIPlatformServiceTask","core-services-tasks");if((0,SE.IA)(n)&&!this.isTFL(n)){const r=(0,lE.C)(o),s=new yR(t,r,n),a=yield s.init();if(a){const t=(e,t)=>{const n=i(e,t);if(!n.vdi){const{provider:e,mode:t,isAvRemoted:i,configFilter:o,sessionId:r,isVDI:s,vdiOptimizationMode:l,isWebRTCEnabled:c,utils:d,subProvider:u}=a;n.vdi={isVDI:s,mode:t,provider:e,isAvRemoted:i,configFilter:o,sessionId:r,vdiOptimizationMode:l,isWebRTCEnabled:c,utils:d,subProvider:u}}return n};e.getPlatformConfigurationOverrides=t,e.vdiServiceProvider=new fR(a.utils)}}}))}isTFL(e){var t,i;return((null===(i=null===(t=e.loader)||void 0===t?void 0:t.getProperties())||void 0===i?void 0:i.environment)||yt.s.prod)===yt.s.life}}const kR={disableAnimations:!1};class bR extends Ce.i{constructor(){super(f.Yg.UpdateCoreSettingDependantClientPreferences,["coreSettings","clientPreferences"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{coreSettings:t,clientPreferences:i}=e,n=t.get(b.J.Core).disableAnimationsByDefault;void 0===i.getPreferences("animation").disableAnimations&&i.updatePreferences({animation:{disableAnimations:null!=n?n:kR.disableAnimations}})}))}}const wR="[LocalMigratedSettingsService]",CR="localMigratedSettingsService.completedConsumers",_R=["client-preferences","device-settings","i18n"];function TR(e,t){e.errorToTelemetry?e.errorToTelemetry(`${wR} ${t}`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0):e.error(`${wR} ${t}`)}class IR{constructor(e,t){this.localStorage=e,this.logger=t}isMarked(e){return this.markedConsumers.includes(e)}areAllMarked(){return 0===this.getUnmarked().length}getUnmarked(){const e=new Set(this.markedConsumers);return _R.filter((t=>!e.has(t)))}mark(e){this.isMarked(e)||(this.markedConsumers.push(e),this.localStorage.trySet(CR,JSON.stringify(this.markedConsumers),"Settings","Experience")||TR(this.logger,"failed to save completed consumers to local storage"))}get markedConsumers(){return void 0===this.cachedMarkedConsumers&&(this.cachedMarkedConsumers=[],this.readInitialCompletedConsumers()),this.cachedMarkedConsumers}readInitialCompletedConsumers(){var e;let t=null;try{t=this.localStorage.get(CR,"Experience")}catch(e){return void TR(this.logger,"failed to read initial completed consumers from local storage")}if((0,L.isNil)(t))return this.logger.log(`${wR} no previously completed consumers`),void(this.cachedMarkedConsumers=[]);try{this.cachedMarkedConsumers=JSON.parse(t)}catch(e){TR(this.logger,"failed to parse initial completed consumers value")}this.logger.log(`${wR} previously completed consumers: ${null===(e=this.cachedMarkedConsumers)||void 0===e?void 0:e.join(", ")}`)}}const jR="tmp.localMigratedSettings",NR=1e3;class ER{constructor(e,t,i,n,o,r){var s,a;this.coreSettings=e,this.scenarioFactory=o,this.timerPreviouslySet=!1,this.host=i,this.hostCommunicationService=n,this.logger=r.newLogger("LocalMigratedSettingsService","core-services-local-migrated-settings"),this.localMigratedSettings=e.get(b.J.LocalMigrated),this.completedConsumers=new IR(t,this.logger),this.scenario=o.newScenario(U.RG.LocalSettingsMigration,{timeoutMs:9e5});const l=Object.keys(this.localMigratedSettings);null===(a=(s=this.logger).infoToTelemetry)||void 0===a||a.call(s,`${wR} initialized migrated settings with ${l.length} keys: ${l.join(", ")}`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0);const c=function(e){if(!e.reservedMetadata)return;const t=e.reservedMetadata,i={};t.correlationId&&(i.migratedSettingsCorrelationId=t.correlationId);t.version&&(i.migratedSettingsSchemaVersion=t.version);t.reason&&(i.migrationReason=t.reason);t.created&&(i.migratedSettingsAgeSeconds=function(e){const t=new Date(e);if(isNaN(t.getTime()))return-1;const i=new Date;return Math.ceil((i.getTime()-t.getTime())/NR)}(t.created));return Object.keys(i).length>0?i:void 0}(this.localMigratedSettings);c&&this.scenario.appendEventData(c)}startTimer(){var e,t,i,n,o,r,s,a;if(this.timerPreviouslySet)return void(null===(t=(e=this.logger).logNoPii)||void 0===t||t.call(e,`${wR} Will not start timer again as it was previously started.`));if(this.completedConsumers.areAllMarked())return void(null===(n=(i=this.logger).logNoPii)||void 0===n||n.call(i,`${wR} Will not start timer again as all consumers have completed.`));this.timerPreviouslySet=!0;const l=xR(this.coreSettings);null===(r=(o=this.logger).logNoPii)||void 0===r||r.call(o,`${wR} Starting migration timer with timeout ${l}ms`),this.timer=this.host.setTimeout((()=>this.reportMigrationCompletion(!0)),l),null===(a=(s=this.scenarioFactory).changeTimeout)||void 0===a||a.call(s,this.scenario,l+3e4)}registerConsumer(e,t){return this.notifyConsumer(e,t),{unregister:()=>{}}}nothingToMigrate(){return 0===Object.keys(this.localMigratedSettings).length}notifyConsumer(e,t){var i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.nothingToMigrate()){if(this.completedConsumers.isMarked(e))null===(n=(i=this.logger).infoToTelemetry)||void 0===n||n.call(i,`${wR} Skipping previously migrated consumer ${e}.`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0);else{this.scenario.mark(U.ck.LocalSettingsMigrationStepConsumerStarted,{consumer:e});try{yield t(this.localMigratedSettings)}catch(t){return TR(this.logger,`handler for ${e} failed.`),void this.scenario.mark(U.ck.LocalSettingsMigrationStepConsumerCompleted,{consumer:e,consumerStatus:"Failed"})}this.scenario.mark(U.ck.LocalSettingsMigrationStepConsumerCompleted,{consumer:e,consumerStatus:"Completed"}),this.completedConsumers.mark(e)}this.completedConsumers.areAllMarked()&&(yield this.reportMigrationCompletion())}}))}reportMigrationCompletion(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{reportLocalMigratedSettingsCompletionToDesktop:t}=this.coreSettings.get(b.J.Core,["reportLocalMigratedSettingsCompletionToDesktop"]);if(this.timer&&this.host.clearTimeout(this.timer),this.timer=void 0,e?this.logger.log(`${wR} Migration timed out. Incomplete consumers: ${this.completedConsumers.getUnmarked().join(", ")}.`):this.logger.log(`${wR} Migration completed successfully.`),this.host.localStorage.getItem(jR))try{this.host.localStorage.removeItem(jR)}catch(e){return void this.scenario.fail({reason:"FailedRemoveMigratedSettingsFromLocalStorage",incompleteConsumers:this.completedConsumers.getUnmarked()})}if(t){let e;try{e=yield this.hostCommunicationService.loadModule("appswitcher")}catch(e){return void this.scenario.fail({reason:"FailedNoAppSwitcherModule",incompleteConsumers:this.completedConsumers.getUnmarked()})}const t=null==e?void 0:e.completeT1LocalSettingsMigration;if(!t)return void this.scenario.fail({reason:"FailedNoCompletionApi",incompleteConsumers:this.completedConsumers.getUnmarked()});try{t()}catch(e){return void this.scenario.fail({reason:"FailedNotifyMigrationCompletion",incompleteConsumers:this.completedConsumers.getUnmarked()})}}e?this.scenario.fail({reason:"TimedOut",incompleteConsumers:this.completedConsumers.getUnmarked()}):this.scenario.stop()}))}}const xR=e=>{const{localMigratedSettingsConsumptionTimeoutInMs:t}=e.get(b.J.Core,["localMigratedSettingsConsumptionTimeoutInMs"]);return null!=t?t:6e4};class AR extends Ce.i{constructor(){super(f.Yg.CreateLocalMigratedSettingsServiceTask,["clientPreferences","coreSettings","hostCommunicationService","localStorage","loggerFactory","scenarioFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{clientPreferences:t,coreSettings:i,hostCommunicationService:n,localStorage:r,loggerFactory:s,scenarioFactory:a,windowProvider:l}=e,c=s.newLogger("CreateLocalMigratedSettingsServiceTask","core-services-tasks"),{skip:d,reason:u}=function(e){if(function(e){const{disableLocalMigratedSettingsService:t}=e.get(b.J.Core,["disableLocalMigratedSettingsService"]);return!!t}(e))return{skip:!0,reason:"Service is disabled"};if(function(e){const t=e.get(b.J.LocalMigrated);if(!t)return!0;return 0===Object.keys(t).length}(e))return{skip:!0,reason:"Nothing to migrate"};return{skip:!1}}(i);if(d)return void c.log(`Skipping service creation. Reason: ${u}`);const m=function(e,t,i,n,o,r){return new ER(e,t,i,n,o,r)}(i,r,l,n,a,s);!function(e,t,i){e.registerConsumer("client-preferences",(e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const n={};if((0,L.isNil)(e.chatDensity)||(n.density={chatDensity:DR(e.chatDensity)}),(0,L.isNil)(e.messagePreviewShown)||(n.messagePreviews={messagePreviewsSetting:FR(e.messagePreviewShown)}),(0,L.isNil)(e.performanceMode)||(n.animation={disableAnimations:OR(e.performanceMode)}),!(0,L.isNil)(e.cachedImage)){const{imageId:t,path:i,imageSrc:o}=e.cachedImage,r={imageId:t,imagePath:i,imageSrc:o,imageNeedsMigration:!0};n.backgroundEffect={lastUsedBackgroundEffect:r},n.videoEffect={lastUsedBackgroundImage:r}}0!==Object.keys(n).length?(i.log(`Updating client preferences to: ${JSON.stringify(n)}`),t.updatePreferences(n)):i.log("No client preferences to update.")}))))}(m,t,c),e.localMigratedSettings=m}))}}const DR=e=>{switch(e){case"Comfy":default:return"comfy";case"Compact":return"compact"}},FR=e=>{switch(e){case"Default":default:return"default";case"ShowPreviews":return"showPreviews";case"HidePreviews":return"hidePreviews"}},OR=e=>"Low"===e;class MR extends Ce.i{constructor(){super(f.Yg.CreateAuthStateConnector,["networkState","authStateProvider","coreSettings"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{networkState:t,authStateProvider:i,coreSettings:n}=e,{enableNetworkOnlineDetection:o,disableNetworkDetectionOnResume:r}=n.get(b.J.Core);!r&&o&&t.subscribeAuthStateEvent(i)}))}}const RR="isOptedIntoT2Web";var PR;!function(e){e.AUTH_NOT_OPT_IN="auth_not_opt_in",e.ANON_NOT_SELECTED="anon_not_selected"}(PR||(PR={}));class LR extends Ce.i{constructor(){super(f.Yg.CreateAnonJoinPreflightTask,["windowProvider","coreSettings","authenticationService","scenarioFactory","localStorage","loggerFactory","platformService"])}execute(e){var t,i,n,r,s,a,l;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=e.windowProvider,c=e.coreSettings,d=e.authenticationService,u=e.scenarioFactory,m=e.localStorage,g=e.loggerFactory,h=e.platformService,p=g.newLogger("CreateAnonJoinPreflightTask","core-services-tasks"),v=u.findScenario(U.RG.AnonJoinPreflightCoreTask)||u.newScenario(U.RG.AnonJoinPreflightCoreTask),{enableT2PreflightForAnonUser:y,enableAnonJoinPreflightCoreTask:f,disableForceOptInT2ForAnonUsers:S}=c.get(b.J.Calling),k=new URL(o.location.href),w="true"===m.get(RR,"Global"),C="true"===k.searchParams.get("meetingjoin");if(null===(t=p.infoToTelemetry)||void 0===t||t.call(p,`[anon-join-core-task]: isOptedInT2-${w}, enableT2PreflightForAnonUser-${y}, enableAnonJoinPreflightCoreTask-${f}`,"cmd_horizontals_web_anon_join_task",void 0,!0),!C)return v.stop({reason:"meetingjoin QSP is not true"}),void(null===(i=p.infoToTelemetry)||void 0===i||i.call(p,"[anon-join-core-task]:meetingjoin QSP is not true","cmd_horizontals_web_anon_join_task",void 0,!0));if(!f)return this.verifyOptInStateBeforeContinueToT2({windowProvider:o,currentUrl:k,isOptedInT2:w,scenario:v,reason:"Core task feature flag enableAnonJoinPreflightCoreTask is not enabled.",logger:p,localStorage:m,platformService:h}),void(null===(n=p.infoToTelemetry)||void 0===n||n.call(p,"[anon-join-core-task]:Core task feature flag enableAnonJoinPreflightCoreTask is not enabled.","cmd_horizontals_web_anon_join_task",void 0,!0));const _=new URLSearchParams(k.hash),T=null!==(r=_.get("deeplinkId"))&&void 0!==r?r:void 0,I=yield d.getUser();return null===(s=p.infoToTelemetry)||void 0===s||s.call(p,`[anon-join-core-task]: user role ${null==I?void 0:I.role}`,"cmd_horizontals_web_anon_join_task",void 0,!0),I&&I.role!==Es.w4.Anonymous?(this.verifyOptInStateBeforeContinueToT2({windowProvider:o,currentUrl:k,isOptedInT2:w,scenario:v,reason:"Auth user.",deeplinkId:T,isAnon:!1,logger:p,localStorage:m,platformService:h}),void(null===(a=p.infoToTelemetry)||void 0===a||a.call(p,"[anon-join-core-task]:auth user end","cmd_horizontals_web_anon_join_task",void 0,!0))):y?(v.stop({reason:"Anon user selected as part of T2 preflight"}),S||m.set(RR,"true","CMD","Global"),void(null===(l=p.infoToTelemetry)||void 0===l||l.call(p,"[anon-join-core-task]:Anon user selected as part of T2 preflight","cmd_horizontals_web_anon_join_task",void 0,!0))):void this.redirectToT1Web({windowProvider:o,currentUrl:k,isOptedInT2:w,scenario:v,reason:"Anon user not selected as part of T2 preflight",deeplinkId:T,logger:p,localStorage:m,platformService:h,redirectReason:PR.ANON_NOT_SELECTED})}))}verifyOptInStateBeforeContinueToT2(e){var t,i;const{isOptedInT2:n,scenario:o,reason:r,logger:s}=e;if(n)return o.stop({reason:`${r} Opted into T2 web`}),void(null===(t=s.infoToTelemetry)||void 0===t||t.call(s,`[anon-join-core-task]:${r} Opted into T2 web`,"cmd_horizontals_web_anon_join_task",void 0,!0));null===(i=s.infoToTelemetry)||void 0===i||i.call(s,"[anon-join-core-task]:redirecting to T1 web","cmd_horizontals_web_anon_join_task",void 0,!0),this.redirectToT1Web(Object.assign(Object.assign({},e),{redirectReason:PR.AUTH_NOT_OPT_IN}))}redirectToT1Web({windowProvider:e,currentUrl:t,scenario:i,reason:n,deeplinkId:o,isAnon:r,logger:s,localStorage:a,platformService:l,redirectReason:c}){var d,u;const m=["clearcontainer","container","version"];for(const e of m)if(t.searchParams.has(e))return i.stop({reason:`${n} URL contains noRedirectQSPs ${e}, and skipping redirect to T1 web.`}),void(null===(d=s.infoToTelemetry)||void 0===d||d.call(s,`[anon-join-core-task]:${n} URL contains noRedirectQSPs ${e}, and skipping redirect to T1 web.`,"cmd_horizontals_web_anon_join_task",void 0,!0));t.pathname="/_",t.searchParams.delete("meetingjoin"),o&&i.appendEventData({deeplinkId:o}),i.stop({reason:`${n} Redirecting to T1 web with isAnon=${r}`}),null===(u=s.infoToTelemetry)||void 0===u||u.call(s,`[anon-join-core-task]:${n} Redirecting to T1 web with isAnon=${r}`,"cmd_horizontals_web_anon_join_task",void 0,!0),a.set("redirectReason",JSON.stringify({sessionId:l.host.sessionId,reason:c}),"CMD","Global"),e.location.replace(t.href)}}class UR extends Ce.i{constructor(){super(f.Yg.SetResourceBufferCacheTask,["coreSettings"]),this.key="resourceEntriesOverflowCache_TEST_ONLY",this.dumpEntriesBuffer=()=>{const e=localStorage.getItem(this.key);let t=JSON.parse(e||"[]");t=t.concat(performance.getEntriesByType("resource")),performance.clearResourceTimings(),localStorage.setItem(this.key,JSON.stringify(t))}}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=e.coreSettings,{persistResourceEntries:i}=t.get(b.J.Test),{userType:n}=t.get(b.J.Host);if(i&&n&&n.indexOf("test")>-1)return localStorage.setItem(this.key,"[]"),performance.addEventListener("resourcetimingbufferfull",this.dumpEntriesBuffer),()=>{performance.removeEventListener("resourcetimingbufferfull",this.dumpEntriesBuffer),localStorage.removeItem(this.key)}}))}}class WR extends Ce.i{constructor(){super(f.Yg.ClearHostSettingsTask,["loggerFactory"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{loggerFactory:t}=e,i=t.newLogger("ClearHostSettingsTask","core-services-tasks");e.hostSettings=void 0,i.log("ClearHostSettingsTask: Host settings cleared from task init context.")}))}}class BR extends Ce.i{constructor(){super(f.Yg.CreateHostedWindowContext,["hostedWindowContext","hostSettings"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{hostedWindowContext:t,hostSettings:i}=e,n=i.hostSettings;n&&(t.sessionStartTime=n.createdTime,t.localeCode=n.localeCode,t.ring=n.hostRingId),"general_gcc"===t.ring&&(null==n?void 0:n.enableDevTools)&&(t.ring="ring0_gcc")}))}}class $R extends Ce.i{constructor(){super(f.Yg.EmbedExitEarlyIfPreAuthOnlyTask,["config","hostCommunicationService","scenarioFactory","loggerFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{config:t,hostCommunicationService:i,scenarioFactory:n,loggerFactory:o,windowProvider:r}=e;if(!t.preInitAuth)return Promise.resolve();const s=n.newScenario(U.RG.EmbedPreAuth,{startTime:t.preInitAuthStartTime}),a=(0,xe.v4)();r.localStorage.setItem("embed-pre-auth-correlation-id",a),r.localStorage.setItem("embed-pre-auth-timestamp",Date.now().toString()),s.appendEventData({secondaryCorrelationId:a});const l=yield i.loadModule("core"),c=yield(0,Ei.G)();return new Promise((e=>{if(!l||!l.registerForOnContinueWithTeamsCoreTasks||!l.signalPreAuthComplete){const e="Failed to load coreModule in EmbedExitEarlyIfPreAuthOnlyTask to signal preauth complete.";throw s.stop({message:e}),new Error(e)}l.registerForOnContinueWithTeamsCoreTasks((({reason:t})=>{o.newLogger("EmbedExitEarlyIfPreAuthOnlyTask","core-services-tasks").log(`Continue with core tasks because: ${t}`),e()})),s.stop();const t=r.setTimeout((()=>{c.flush(!0).finally((()=>{var e;null===(e=null==l?void 0:l.signalPreAuthComplete)||void 0===e||e.call(l)})),r.clearTimeout(t)}),1e3)}))}))}}class HR extends Ce.i{constructor(){super(f.Yg.FetchHostSettingsTask,["config","hostedWindowContext","loggerFactory","windowProvider"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{config:t,hostedWindowContext:i,loggerFactory:n,windowProvider:o}=e,{isInCypressFrame:r,isInIframe:s}=i,a=n.newLogger("FetchHostSettingsTask","core-services-tasks");let l={};if(t.shouldFetchBootstrapData&&s&&!r)try{a.log("Hosted in web. Fetching host settings from host over IPC.");const e=yield o.opener.requestMessage(O.rY.GetStateData,{requestType:"hostSettings"});l=Object.assign({},e.hostSettings)}catch(e){a.errorToTelemetry&&a.errorToTelemetry(`Error fetching host settings over IPC ${e}`,"webclient_framework_foundation_core_services_tasks",void 0,!0)}else{a.log("Hosted in desktop. Getting host settings from window object.");const e=window;e.hostSettings&&(a.log("Found window.hostSettings."),l=Object.assign({},e.hostSettings),delete e.hostSettings)}if(!t.allowEmptyHostSettings&&!Object.keys(l).length)throw(0,se.Tr)(f.w5.Core,f.jK.Undefined,"FetchHostSettingsTask",void 0,"hostSettings are missing in experience that requires them.");a.log("setting context.hostSettings"),e.hostSettings=l}))}}var qR;!function(e){e[e.Unknown=5e4]="Unknown",e[e.GetSingletonStoreFailed=4e4]="GetSingletonStoreFailed",e[e.CreateStoreFailed=40001]="CreateStoreFailed",e[e.ActionNotSupported=40002]="ActionNotSupported"}(qR||(qR={}));var zR=i(568938),VR=i(302777),GR=i(706627);const JR={code:qR.CreateStoreFailed,message:"Store is not available"};function KR(e){return new QR(e)}class QR extends gi.y{constructor(e){const t=e?YR(e):(0,zR._)(JR);super((e=>t.subscribe(e))),this._dispatcher=e?Promise.resolve(e):Promise.reject(JR)}dispatch(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return(yield this._dispatcher).dispatch(e)}))}}const YR=e=>(0,l.D)(Promise.resolve(e)).pipe((0,vt.w)((e=>new gi.y((t=>e.subscribe((e=>t.next(e))))))),(0,VR._)(1),(0,GR.x)());class XR extends gi.y{constructor(e,t){const i=t.pipe((0,c.U)((t=>{var i;return null===(i=null==t?void 0:t.windows[e])||void 0===i?void 0:i.lifecycle})),(0,Ws.x)(L.isEqual),(0,u.h)((e=>void 0!==e)),(0,ci.o)((e=>void 0===e.closedTime),!0));super((e=>i.subscribe(e))),this._id=e,this._dispatcher=t}pushWltMarks(e){return this._dispatcher.dispatch({type:"RECORD_WINDOW_LIFECYCLE_MARKS",windowId:this._id,markers:e})}}var ZR=i(289539),eP=i(925135);class tP{constructor(e,t,i){if(this.exitFullscreen=e=>this._observableStore.dispatch((e=>({type:"SET_FULLSCREEN",windowId:e,fullscreen:!1}))(e)),this.focus=e=>this._observableStore.dispatch((e=>({type:"FOCUS_WINDOW",windowId:e}))(e)),this.maximize=e=>this._observableStore.dispatch((e=>({type:"TOGGLE_MAXIMIZE_WINDOW",windowId:e}))(e)),this.minimize=e=>this._observableStore.dispatch((e=>({type:"MINIMIZE_WINDOW",windowId:e}))(e)),this.requestFullscreen=e=>this._observableStore.dispatch((e=>({type:"SET_FULLSCREEN",windowId:e,fullscreen:!0}))(e)),this.show=e=>this._observableStore.dispatch((e=>({type:"SHOW_WINDOW",windowId:e}))(e)),this.windowTitleDblClick=e=>this._observableStore.dispatch((e=>({type:"INVOKE_DOUBLE_CLICK",windowId:e}))(e)),e.createInterprocessStore){const n=e.createInterprocessStore({logDebug:(...e)=>t.debug(...e),logError:(...e)=>t.error(...e),logInfo:(...e)=>t.log(...e),logScenario:e=>{i.newScenario(e.name).stop(void 0,e.status)}});this._observableStore=KR(n)}else this._observableStore=KR(null)}onWindowFullscreen(e){return this._observableStore.pipe((0,ZR.j)("windows",e),(0,eP.n)((e=>void 0===e)),(0,ci.o)((e=>{var t;return void 0===(null===(t=e.lifecycle)||void 0===t?void 0:t.closedTime)})),(0,ZR.j)("layout","fullscreen"),(0,Ws.x)())}onLifecycleMarks(e){return new XR(e,this._observableStore)}}class iP extends Ce.i{constructor(){super(f.Yg.InitInterprocessStore,["windowProvider","loggerFactory","scenarioFactory","coreSettings"])}execute(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{windowProvider:t,loggerFactory:i,scenarioFactory:n,coreSettings:o}=e;o.get(b.J.Core).disableInterprocessStore||(e.interprocessStoreService=new tP(t,i.newLogger("InterProcessStore","core-services-tasks"),n)),delete t.createInterprocessStore}))}}class nP extends Ce.i{constructor(){super(f.Yg.Polyfills,[])}execute(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.applyAsyncIteratorPolyfillIfNeeded()}))}applyAsyncIteratorPolyfillIfNeeded(){void 0===Symbol.asyncIterator&&(Symbol.asyncIterator=Symbol.asyncIterator||i(212673).$$asyncIterator)}}class oP{constructor(e){this.logsProviderTimeoutMs=2e4,this.coreProviders=[],this.userProviders={},this.primaryUserID="",this.allowZipLogFiles=!1,this.environmentName="",this.isDownloadLogStarted=new r.X(!1),this.observeDownloadLogStatus=()=>this.isDownloadLogStarted.asObservable(),this.setDownloadLogStatus=e=>{this.isDownloadLogStarted.next(e)},this.logger=e.newLogger("LogsCollectorService","core-services-logs-collector")}subscribeToCoreSettings(e){if(!e)return void this.logger.error("Failed to subscribe to core settings");e.getObservable(b.J.Diagnostics,["logsProviderTimeoutMs","shouldZipLogFiles"]).subscribe((({logsProviderTimeoutMs:e,shouldZipLogFiles:t})=>{e&&(this.logsProviderTimeoutMs=e),this.allowZipLogFiles=!!t}));e.getObservable(b.J.Metadata,["environment"]).subscribe((({environment:e})=>{e&&(this.environmentName=e)}))}registerCoreLogsProvider(e){var t,i;e.logsProviderName===y.DIAGNOSTICSSERVICE?this.diagnosticsLogProvider=e:this.coreProviders.some((t=>t.logsProviderName===e.logsProviderName))?null===(i=(t=this.logger).warnNoPii)||void 0===i||i.call(t,`Registering redundant core logger with name ${e.logsProviderName}`):this.coreProviders.push(e)}registerUserLogsProvider(e,t){var i,n;this.primaryUserID&&!e&&(e=this.primaryUserID),this.userProviders[e]?this.userProviders[e].some((e=>e.logsProviderName===t.logsProviderName))?null===(n=(i=this.logger).warnNoPii)||void 0===n||n.call(i,`Registering redundant user logger with name ${t.logsProviderName}`):this.userProviders[e].push(t):this.userProviders[e]=[t]}unregisterUserLogsProvider(e,t){var i,n;this.primaryUserID&&!e&&(e=this.primaryUserID),this.userProviders[e]?(this.userProviders[e]=this.userProviders[e].filter((e=>e.logsProviderName!==t)),0===this.userProviders[e].length&&delete this.userProviders[e]):null===(n=(i=this.logger).warnNoPii)||void 0===n||n.call(i,`Unregistering user logger with name ${t} failed, user ${e} not found`)}getCoreLogsProvider(e){return this.coreProviders.find((t=>t.logsProviderName===e))}getUserLogsProvider(e,t){var i;return null===(i=this.userProviders[e])||void 0===i?void 0:i.find((e=>e.logsProviderName===t))}handleUserLogout(e){delete this.userProviders[e]}callOnLogsFiles(e,t=!1,i=!1,n=0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.callOnUserLogsFiles(Object.keys(this.userProviders),e,t,i,n)}))}callOnUserLogsFiles(e,t,n=!1,r=!1,s=0){var a,l,c;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o;if(n&&this.allowZipLogFiles)try{const e=null===(a=yield i.e(981578).then(i.t.bind(i,527896,23)))||void 0===a?void 0:a.default;e&&(o=new e)}catch(e){null===(c=(l=this.logger).errorToTelemetry)||void 0===c||c.call(l,`Load jszip failed - ${e}`,"logs_loading_jszip")}const d={fileName:"summary.txt",content:"",isPiiFree:!0},u=e=>(null==o?void 0:o.file)?(o.file(e.fileName,e.content),Promise.resolve(!0)):(e.fileName=`WebLogs/${e.fileName}`,t(e)),m=yield this.callOnOnlyCoreLogsFiles(u,d,r,s),g=yield this.callOnOnlyUserLogsFiles(e,u,d,r,s),h=yield this.createSummaryFile(u,d);if(o){const e=yield o.generateAsync({type:"blob",compression:"DEFLATE"}),i=this.environmentName?`${this.environmentName.toUpperCase()}-`:"";return t({fileName:`${i}WebLogs-${(new Date).toISOString()}.zip`,content:e,isPiiFree:!0})}return m&&g&&h}))}getSystemInfo(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let e=new Map;try{const t=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield(0,W.E)(e.getSystemInfo(),this.logsProviderTimeoutMs)}catch(t){if((0,W.T)(t))return this.logger.error(`Timed out fetching system info from logs provider - ${e.logsProviderName}`),new Map;throw t}})),i=this.coreProviders.map(t);this.diagnosticsLogProvider&&i.push(t(this.diagnosticsLogProvider));const n=yield Promise.all(i);n&&n.length>0&&(e=n.reduce(((e,t)=>new Map([...Array.from(e.entries()),...Array.from(t.entries())]))))}catch(e){this.logger.error("Fetching system info from logs providers failed with error:",e)}return e}))}setPrimaryUserID(e){if(e&&!this.primaryUserID){this.primaryUserID=e;const t=this.userProviders[""];t&&(this.userProviders[this.primaryUserID]=t,delete this.userProviders[""])}}setGetSummaryFunction(e){this.generateSummary=e}getUserLogFileName(e,t){return`User (${e===this.primaryUserID?"Primary; ":""}${e})/${t}`}getCoreLogFileName(e){return`Core/${e}`}callOnOnlyCoreLogsFiles(e,t,i=!1,n=0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const o=t=>(t.fileName=t.userId?this.getUserLogFileName(t.userId,t.fileName):this.getCoreLogFileName(t.fileName),e(t));this.logger.log(`Fetching files from providers: ${this.coreProviders.reduce(((e,t)=>e+`${null==t?void 0:t.logsProviderName}, `),"")}`);const r=yield this.callOnLogsFilesOfLogsProviders(this.coreProviders,o,t,i,n),s=!this.diagnosticsLogProvider||(yield this.callOnLogsFilesOfLogsProviders([this.diagnosticsLogProvider],o,t,i,n));return r&&s}catch(e){return this.logger.error("Error calling callback on logs files from all logs providers - error:",e),!1}}))}callOnOnlyUserLogsFiles(e,t,i,n=!1,r=0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=[];return e.length>0&&e.forEach((e=>{if(this.userProviders[e]&&this.userProviders[e].length>0){const s=i=>(i.fileName=this.getUserLogFileName(e,i.fileName),t(i));o.push(this.callOnLogsFilesOfLogsProviders(this.userProviders[e],s,i,n,r))}})),(yield Promise.all(o)).every(Boolean)}))}timeoutSafeGetLogsFiles(e,t=!1,i=0){var n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield(0,W.E)(e.getLogsFiles(t,i),this.logsProviderTimeoutMs)}catch(t){if((0,W.T)(t))return null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,`Timed out fetching logs files from logs provider - ${e.logsProviderName}`,"logs_fetching_error"),[];throw t}}))}callOnLogsFilesOfLogsProviders(e,t,i,n=!1,r=0){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=e.map((e=>this.timeoutSafeGetLogsFiles(e,n,r))),s=yield Promise.all(o),a=[];s.forEach((e=>{e&&e.length>0&&a.push(...e)}));const l=a.map((e=>{try{return"latestErrors"===e.fileName?(i.content=`${i.content}${e.content}\r\n`,Promise.resolve(!0)):t(e)}catch(t){return this.logger.error(`Error calling callback on logs file, ${null==e?void 0:e.fileName} - error:`,t),!1}}));return(yield Promise.all(l)).every((e=>e))}))}createSummaryFile(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=yield null===(i=this.generateSummary)||void 0===i?void 0:i.call(this);return n&&(t.content=`${n}\r\n${t.content}`),e(t)}))}}var rP=i(328283);class sP{constructor(e,t){this.coreTaskManager=e,this.userRenderingContextMap=new Map,this.logger=t.newLogger("RenderingContextManager","core-services-activator")}cleanupWithPriority(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.defaultRenderingContext)return Promise.reject(new Ne.G(Ne.$.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=this.userRenderingContextMap.keys(),i=Array.from(t).map((t=>()=>this.cleanupActiveWindowsHistoryService(e,t)));yield dP(i,this.defaultRenderingContext)}))}createCoreServices(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log("createCoreServices: start");const i=yield this.coreTaskManager.notifyLifeCycleEvent(f.sM.Initialization),{coreTaskErrors:n}=i,r=(0,o.__rest)(i,["coreTaskErrors"]);this.defaultRenderingContext=r,this.logger.log("createCoreServices: done");const s=r&&Object.keys(r).sort(),a=`createCoreServices: ${(0,M.u4)(s)}`;return null===(t=(e=this.logger).infoToTelemetry)||void 0===t||t.call(e,a,"webclient_framework_foundation_core_init",void 0,!0),Object.assign(Object.assign({},r),{error:cP(n,r,this.logger)})}))}executePrimaryUserTasks(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.defaultRenderingContext)return Promise.reject(new Ne.G(Ne.$.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=(0,Ee.b4)(e);this.logger.log(`executePrimaryUserTasks(${t}): start`);const i=yield this.coreTaskManager.notifyLifeCycleEvent(f.sM.OnPrimaryUser,Object.assign(Object.assign({},this.defaultRenderingContext),{primaryUser:e,authenticationUser:e})),{coreTaskErrors:n}=i,r=(0,o.__rest)(i,["coreTaskErrors"]),s=cP(n,this.defaultRenderingContext,this.logger);if(delete r.authenticationUser,this.primaryUserContext=r,s)throw s;return this.logger.log(`executePrimaryUserTasks(${t}): done`),this.primaryUserContext}))}removeAllRenderingContexts(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.defaultRenderingContext)return Promise.reject(new Ne.G(Ne.$.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=this.userRenderingContextMap.keys(),i=Array.from(t).map((t=>()=>this.removeUserRenderingContext(e,t)));yield dP(i,this.defaultRenderingContext),this.primaryUserContext&&(yield this.coreTaskManager.destroyContext(this.primaryUserContext,e)),yield this.coreTaskManager.destroyContext(this.defaultRenderingContext,e)}))}getUserRenderingContext(e){return this.userRenderingContextMap.get(e)}getDefaultRenderingContext(){return this.defaultRenderingContext}getOrCreateUserRenderingContext(e){const t=(0,Ee.b4)(e);return this.defaultRenderingContext?(this.userRenderingContextMap.get(t)||this.userRenderingContextMap.set(t,this.createUserContextWithTelemetry(e,this.defaultRenderingContext)),this.userRenderingContextMap.get(t)):Promise.reject(new Ne.G(Ne.$.RENDERING_CONTEXT_DOES_NOT_EXIST,void 0,t))}removeUserRenderingContext(e,t){var i,n,r,s,a,l;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=this.userRenderingContextMap.get(t);if(o){let c;"unknown_destroy"===e&&(null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,"Removing user context due to unknown.","webclient_framework_foundation_core_services",void 0,!0)),this.userRenderingContextMap.delete(t);try{c=yield o}catch(e){let t;return t=e instanceof je.G&&je.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():e&&`${e.name}::${e.message}`,null===(s=(r=this.logger).errorToTelemetry)||void 0===s||s.call(r,`${Ne.$.CLEANUP}::contextPromise::${t}`,"webclient_framework_foundation_core_services",void 0,!0),!1}return e="unknown_destroy"===e?"signout":e,yield this.cleanupUserRenderingContext(c,e),(null===(l=null===(a=this.primaryUserContext)||void 0===a?void 0:a.primaryUser)||void 0===l?void 0:l.id)===t&&(yield this.cleanupPrimaryUserContext(e)),!0}return this.logger.warn("RenderingContextManager::contextPromise is not defined"),!1}))}createUserContextWithTelemetry(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{scenarioFactory:n}=t,o=!!(null===(i=t.coreSettings.get(b.J.Core))||void 0===i?void 0:i.enableMTMA),r=n.findScenario(U.RG.GetAuthUser),[s,a]=Ke(n);null==s||s.mark(U.ck.CoreUserContextStart);const l=Date.now(),c=(0,Ee.b4)(e);try{const t=yield this.createUserRenderingContext(e,o);return this.reportUserContextSuccess({getUserAuthScenario:r,expReadyScenario:a,clientStartScenario:s,scenarioStartTime:l,userContextId:c,isMTMAEnabled:o,scenarioFactory:t.scenarioFactory}),t}catch(e){const i=Qe(e,c);throw this.reportUserContextFailure({getUserAuthScenario:r,expReadyScenario:a,scenarioStartTime:l,error:i,userContextId:c,isMTMAEnabled:o,scenarioFactory:t.scenarioFactory}),i}}))}reportUserContextSuccess({getUserAuthScenario:e,expReadyScenario:t,clientStartScenario:i,scenarioStartTime:n,userContextId:o,isMTMAEnabled:r,scenarioFactory:s}){var a;e&&e.stop(),null==t||t.mark(U.ck.GetAuthUser),null==i||i.mark(U.ck.CoreUserContextStop),aP(s,o,n,null===(a=this.defaultRenderingContext)||void 0===a?void 0:a.windowProvider.performance,r).stop(void 0,"success")}reportUserContextFailure({getUserAuthScenario:e,expReadyScenario:t,scenarioStartTime:i,error:n,userContextId:o,isMTMAEnabled:r,scenarioFactory:s}){var a,l;e&&e.fail(),null==t||t.mark(U.ck.GetAuthUser,void 0,"failure"),aP(s,o,i,null===(a=this.defaultRenderingContext)||void 0===a?void 0:a.windowProvider.performance,r).fail(Object.assign({message:`Failed to create user context for ${o}`},Xe(n,null===(l=this.defaultRenderingContext)||void 0===l?void 0:l.coreSettings)))}cleanupActiveWindowsHistoryService(e,t){var i,n,r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let o;try{o=yield this.getUserRenderingContext(t)}catch(e){return}try{null===(i=null==o?void 0:o.activeWindowsHistoryService)||void 0===i||i.cleanup(e)}catch(e){const t=new Ne.G(Ne.$.CLEANUP,e);null===(r=(n=this.logger).errorToTelemetry)||void 0===r||r.call(n,t.toTelemetryEntry(),"webclient_framework_foundation_core_services_active_windows_history",void 0,!0)}}))}cleanupUserRenderingContext(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return yield this.coreTaskManager.destroyContext(e,t),!0}))}cleanupPrimaryUserContext(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.logger.log("Cleaning up primary user context..."),yield this.coreTaskManager.destroyContext(this.primaryUserContext,e),!0}))}createUserRenderingContext(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=(0,Ee.b4)(e);this.logger.log(`createUserContext(${i}): start`);const n=t?f.sM.OnUserAuthenticated_MTMA:f.sM.OnUserAuthenticated,r=yield this.coreTaskManager.notifyLifeCycleEvent(n,Object.assign(Object.assign({},this.defaultRenderingContext),{authenticationUser:e}),((e,t)=>{var o,r;return(null===(o=this.defaultRenderingContext)||void 0===o?void 0:o.windowProvider.performance)&&function(e,t,i,n,o){const r=o?Xe(o):void 0;i.mark(lP(n,t),{detail:{taskId:f.Yg[e],errorCode:null==r?void 0:r.errorCode}})}(e,i,null===(r=this.defaultRenderingContext)||void 0===r?void 0:r.windowProvider.performance,f.sM[n],t)})),{coreTaskErrors:s}=r,a=(0,o.__rest)(r,["coreTaskErrors"]),l=cP(s,this.defaultRenderingContext,this.logger);if(l)throw l;return this.logger.log(`createUserContext(${i}): done`),a}))}}function aP(e,t,i,n,o=!1){const r=e.createScenarioWithoutStarting(U.RG.CoreUserContextCreate,{startTime:i}),s=o?f.sM.OnUserAuthenticated_MTMA:f.sM.OnUserAuthenticated;return n&&function(e,t,i,n){const o=n.timeOrigin,r=n.getEntriesByName(t,"mark")||[];for(const t of r){const n=t.detail.taskId,r=t.detail.errorCode;e.mark(`${i}_${n}`,{overrideTimestamp:Math.round(t.startTime+o),errorCode:r})}n.clearMarks(t)}(r,lP(s,t),`core_task_${s}`,n),r}function lP(e,t){return`${e}_core_task_end_${t||""}`}function cP(e,t,i){let n;if(e&&(null==e?void 0:e.length)>0)if(null==t?void 0:t.coreSettings.get(b.J.Core).strictErrorMode)n=e[0];else{const t=e.filter((e=>e instanceof Pu.x));t.length>0&&t.forEach((e=>{var t;null===(t=i.errorToTelemetry)||void 0===t||t.call(i,e.toTelemetryEntry(),"webclient_framework_foundation_core_services",void 0,!0)})),n=e.find((e=>e instanceof Ne.G||e instanceof Ka.l||e instanceof Pu.x&&(e.prevError instanceof Ne.G||e.prevError instanceof Ka.l)))}return n}function dP(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(null===(i=null==t?void 0:t.coreSettings.get(b.J.Core))||void 0===i?void 0:i.readInSequence)for(const t of e)yield t();else yield Promise.all(e.map((e=>e())))}))}var uP=i(250033);i(818319);const mP={id:"com.microsoft.teams.corelayout",actors:["corelayout"],name:"CoreLayoutApp"};var gP=i(979176);const hP={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutResizeSlotDimensionsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"width"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slotName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SlotName"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resizeSlotDimensions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"Variable",name:{kind:"Name",value:"width"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"Argument",name:{kind:"Name",value:"slotName"},value:{kind:"Variable",name:{kind:"Name",value:"slotName"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SlotName"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}}]};var pP=i(528765);const vP={onEventReceived:e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var t,i,n,o,r,s,a;const{appViewState:l,eventInput:c,requestContext:{client:d,loggerFactory:u},windowId:m}=e,g=u.newLogger("apps-core-layout","apps-core-layout"),h=c.event;if(!function(e){if(e.originator!==gP.kn)return!1;for(const t in gP.uS)if(t===e.type)return!0;return!1}(h))return g.error(`Unhandled event ${c} is not a core layout event`),Promise.reject(new Error(`Unhandled event ${c.event.type} is not a core layout event`));switch(h.type){case gP.uS.criticalAppPhaseReached:return l.postCriticalPhaseReached.update(!1),void l.completePhaseReached.update(!1);case gP.uS.postCriticalAppPhaseReached:return void l.postCriticalPhaseReached.update(!0);case gP.uS.completeAppPhaseReached:return void l.completePhaseReached.update(!0);case gP.uS.resizeSlot:return void d.mutate({mutation:hP,variables:{slotName:null===(t=h.data)||void 0===t?void 0:t.call(h).slotName,width:null===(i=h.data)||void 0===i?void 0:i.call(h).width,windowId:m}});case gP.uS.updateAmsV2Domain:const{amsV2Domain:e}=h.data();return void(l.amsV2Domain.read()!==e&&l.amsV2Domain.update(e||""));case gP.uS.updateMeControlAvatarSrc:const{meControlAvatarSrc:u}=h.data();return void(l.meControlAvatarSrc.read()!==u&&l.meControlAvatarSrc.update(u||""));case gP.uS.updateBaseImageUrl:const{baseImageUrl:p}=h.data();return g.log(`Received baseImageUrl core-layout event with data ${p}`),void(l.baseImageUrl.read()!==p&&(g.log(`Updating baseImageUrl app view state ${p}`),l.baseImageUrl.update(p||"")));case gP.uS.updateIsImageAuthCookieValid:const{isImageAuthCookieValid:v}=(null===(n=h.data)||void 0===n?void 0:n.call(h))||{};return void(void 0!==v&&l.isImageAuthCookieValid.read()!==v&&l.isImageAuthCookieValid.update(v));case gP.uS.showMonitor:return Promise.resolve({command:pP.CN.showMonitor(null===(r=(o=c.event).data)||void 0===r?void 0:r.call(o))});case gP.uS.updateDialogState:return Promise.resolve({command:pP.CN.updateDialogState(null===(a=(s=c.event).data)||void 0===a?void 0:a.call(s))});case gP.uS.closeMonitor:return Promise.resolve({command:pP.CN.closeMonitor()});case gP.uS.hideMonitor:return Promise.resolve({command:pP.CN.hideMonitor()});case gP.uS.unhideMonitor:return Promise.resolve({command:pP.CN.unhideMonitor()});default:return g.error(`Unhandled event ${c}`),Promise.reject(new Error(`Unhandled event ${c.event.type}`))}}))};const yP={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutResizeHeaderMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"height"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resizeHeaderSlot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"Variable",name:{kind:"Name",value:"height"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}}]},fP={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutChangeSlotsVisibilityMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slotNames"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SlotName"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isHidden"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSlotsVisibility"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"slotNames"},value:{kind:"Variable",name:{kind:"Name",value:"slotNames"}},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SlotName"}}}}}},{kind:"Argument",name:{kind:"Name",value:"isHidden"},value:{kind:"Variable",name:{kind:"Name",value:"isHidden"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}}]},SP={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutChangeMonitorSlotMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityAction"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeMonitorSlotContent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"entityType"},value:{kind:"Variable",name:{kind:"Name",value:"entityType"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}}},{kind:"Argument",name:{kind:"Name",value:"entityAction"},value:{kind:"Variable",name:{kind:"Name",value:"entityAction"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}]}}]},kP={eventHandlers:vP,onCommandReceived:e=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){var t,i;const{activeWindowsService:n,commandInput:o,requestContext:{client:r,loggerFactory:s},slotDimensionsOptions:a,windowId:l}=e,{command:{action:c,actor:d,data:u}}=o,m=s.newLogger("CoreLayoutApp onCommandReceived","apps-core-layout");if(!(null===(t=mP.actors)||void 0===t?void 0:t.includes(d)))return void m.error(`Command  ${o.command} is sent to the wrong App.`);const{header:{height:g}}=a,{collapsed:h,expanded:p}=g||{};switch(c){case pP.Nw.collapseHeader:r.mutate({mutation:yP,variables:{height:h,windowId:l}});break;case pP.Nw.expandHeader:r.mutate({mutation:yP,variables:{height:p,windowId:l}});break;case pP.Nw.expandTab:{const{excludeHeader:e}=u||{},t=e?[kt.WL.NOTIFICATIONS,kt.WL.SUBNAV]:[kt.WL.HEADER,kt.WL.NOTIFICATIONS,kt.WL.SUBNAV];r.mutate({mutation:fP,variables:{slotNames:t,windowId:l,isHidden:!0}});break}case pP.Nw.maximizeTab:r.mutate({mutation:fP,variables:{slotNames:[kt.WL.HEADER,kt.WL.NAV,kt.WL.NOTIFICATIONS,kt.WL.SUBNAV,kt.WL.TITLE_BAR],windowId:l,isHidden:!0}});break;case pP.Nw.openCoreDialog:const{entity:e,correlation:t,targetWindow:s}=u;n.executeCommand("handleExtendCommand")({entity:e,correlation:{id:(null==t?void 0:t.id)||(0,xe.v4)(),startTimestamp:(null==t?void 0:t.startTimestamp)||Date.now(),source:(null==t?void 0:t.source)||k.D.Core},openOnMainWindow:!!(null==s?void 0:s.name),mainWindowLayoutMode:null==s?void 0:s.layoutMode,windowId:l,userContextId:l&&(null===(i=n.getActiveWindow(l))||void 0===i?void 0:i.userContextId)||null});break;case pP.Nw.updateDialogState:const{containerState:a}=u;n.getWindowLayoutService(l).modalManager.setContainerState(a,!0);break;case pP.Nw.resetLayoutOverrides:r.mutate({mutation:fP,variables:{slotNames:[kt.WL.HEADER,kt.WL.NAV,kt.WL.NOTIFICATIONS,kt.WL.SUBNAV,kt.WL.TITLE_BAR],windowId:l,isHidden:!1}});break;case pP.Nw.showMonitor:r.mutate({mutation:SP,variables:{windowId:l,entityType:"floatingmonitor",entityAction:"view",entityOptions:JSON.stringify(o.command.data)}});break;case pP.Nw.closeMonitor:r.mutate({mutation:SP,variables:{windowId:l,entityType:"floatingmonitor",entityAction:"leave"}});break;case pP.Nw.hideMonitor:r.mutate({mutation:fP,variables:{slotNames:[kt.WL.MONITOR],windowId:l,isHidden:!0}});break;case pP.Nw.unhideMonitor:r.mutate({mutation:fP,variables:{slotNames:[kt.WL.MONITOR],windowId:l,isHidden:!1}});break;default:m.error(`Command action ${c} is not supported at CoreLayoutApp.`)}})),onViewUpdateCommandResolved:()=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){})),viewStateRegistration:{gqlTypeName:"CoreLayoutAppViewState",queryFieldName:"coreLayoutAppViewState",navigationalFieldDefaultValues:{},nonNavigationalFieldDefaultValues:{amsV2Domain:"",baseImageUrl:"",completePhaseReached:!1,isImageAuthCookieValid:!1,meControlAvatarSrc:"",postCriticalPhaseReached:!1},computedValues:void 0}};const bP=function(){const e=()=>null;return Object.assign(Object.assign({},kP),{manifest:mP,render:()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return(0,uP.t)(e,{})}))})}(),wP="authenticated_user_subscription_failed",CP="create_user_context_failed",_P="init_core_service_failure",TP="show_taskbar_caution_indicator_failed",IP="user_data_undefined",jP="user_renderingContext_generation_error",NP=(e,t,i)=>{e.errorToTelemetry&&e.errorToTelemetry(t,i,void 0,!0)};class EP{constructor(e){var t,i,l,d,u,m;this._activeWindows=new r.X([]),this._contextSubject=new s.t(1),this._isCleanupRunning=!1,this.AppStateToCleanupReasonMap=new Map([[S.G5.quit,"quit"],[S.G5.restart,"restart"]]),this.cleanupOnAppStateChangedCallback=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{appState:t}=e;if(!st.has(t))return;if(this._isCleanupRunning){const e=new Ne.G(Ne.$.CLEANUP,new Error(`cleanupOnAppStateChangedCallback run more than once ${t}`));return void(this._logger.warnToTelemetry&&this._logger.warnToTelemetry(e.toTelemetryEntry(),"webclient_framework_foundation_core_services",void 0,!0))}this._isCleanupRunning=!0;const i=this.AppStateToCleanupReasonMap.get(t);if(!i){const e=new Ne.G(Ne.$.CLEANUP,new Error(`cleanupOnAppStateChangedCallback has undefined reason from ${t}`));throw NP(this._logger,e.toTelemetryEntry(),"webclient_framework_foundation_core_services"),e}yield at({hostCommunicationService:this.coreServices.hostCommunicationService,logger:this._logger,reason:i,renderingContextManager:this._renderingContextManager})})),this.trackAuthUsers=e=>{const t=this.isMTMACoreEnabled(e.coreSettings);return(0,a.z)((0,c.U)((e=>t?e:e.slice(0,1))),(0,c.U)((e=>e.map((e=>Object.assign(Object.assign({},e),{id:(0,Ee.b4)(e)}))))),de((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.onUserAuthenticated(e)}))),(e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.onUserDestroy(yield e)}))),((e,t)=>(0,o.__awaiter)(this,void 0,void 0,(function*(){return t}))),((e,i)=>{if(!t)throw i})))};const g=(0,F.J)(),h=(null==g?void 0:g.defaultConsoleLogLevel)||(null===(i=null===(t=null==g?void 0:g.loader)||void 0===t?void 0:t.getInitConsoleLogLevel)||void 0===i?void 0:i.call(t)),p=null===(d=null===(l=null==g?void 0:g.loader)||void 0===l?void 0:l.getProperties)||void 0===d?void 0:d.call(l),v=new K((null==p?void 0:p.sessionId)||"",e.config.experienceName,n.DiagnosticsLogsMain,null==h?void 0:h.preECSConsoleLogLevel,null==h?void 0:h.userConsoleLogLevel),y=new Y(g);v.setLogsCountReporter(y);const f=new oe(v,"00000000-0000-0000-0000-000000000000");this._config=e.config;const k=new we(f,this._config,bP,e.apps);this._logger=f.newLogger("Core","core-services-activator");const b=new oP(f);let w;p&&p.isMaglev&&p.preCoreHostCommService&&(w=p.preCoreHostCommService),this._preCoreLogsFileService=new rP.N(f,b,void 0,w),g.addEventListener("downloadLogs",(()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){yield this._preCoreLogsFileService.downloadLogsFiles(g)})))),b.registerCoreLogsProvider(v);const C=null===(m=null===(u=null==g?void 0:g.loader)||void 0===u?void 0:u.getLogsProvider)||void 0===m?void 0:m.call(u);C&&b.registerCoreLogsProvider(C),p&&p.isMaglev&&p.preCoreHostCommService&&this.registerForLogsDownloadSignalFromDesktop(g,p.preCoreHostCommService);const _=e.config.useReactWebClientCoreTasks?{Initialization:()=>[new Hd,new HA,new _F,new SR,new FA,new AA,new SA,new Gj,new Jd,new Sg,new bR,new jF,new VM,new Xu,new cE,new rO,new Jj,new ME,new iO,new $M,new aE,new AE,new PA,new BA,new DN,new xl,new fa,new KM,new nO,new gR,new Ag,new NA,new AR,new nE,new YN,new Sl,new LR,new RF,new Kj,new rE,new El,new oO,new UR,new Hj,new $d,new Ld,new od,new IF,new Uu,new uE,new pA,new UI,new VA,new Qd,new Kd,new MN,new wg,new Bj,new ON,new Wu,new KN,new Cg,new HF,new BF,new Kx,new GM,new tR,new Al,new IA,new OE,new FE,new lR,new eO],OnPrimaryUser:()=>[new XM,new YM,new LD,new QM,new hO,new qF,new JM,new wF],OnUserAuthenticated:()=>[new XM,new LD,new tl,new OF,new _l,new nA,new ts,new Ol,new sR,new nR,new rd,new uO,new xF,new xs,new MA,new eR,new TF,new gO,new Wu,new Rs,new zM,new Sa.K,new NF,new XF,new iR,new rR],OnUserAuthenticated_MTMA:()=>[new XM,new UD,new LD,new nA,new ts,new kg,new tl,new MR,new rE,new El,new DN,new _l,new oR,new sR,new TF,new gO,new Ol,new Pd,new Sa.K,new XF,new GA,new VA,new Qd,new wg,new ON,new Wu,new OF,new rd,new uO,new xF,new xs,new MA,new eR,new Rs,new zM,new NF,new iR,new rR]}:{Initialization:()=>[new nP,new Hd,new HA,new _F,new FA,new AA,new HR,new BR,new SA,new Gj,new Jd,new Sg,new gR,new VM,new Xu,new cE,new Jj,new ME,new $M,new AE,new PA,new DN,new xl,new fa,new WR,new NA,new nE,new YN,new Sl,new $R,new RF,new Kj,new rE,new El,new oO,new Hj,new $d,new Ld,new od,new Uu,new uE,new pA,new UI,new VA,new Qd,new Kd,new MN,new Bj,new ON,new Cg,new Kx,new KN,new iP,new Al,new IA,new OE,new eO],OnUserAuthenticated:()=>[new XM,new LD,new QM,new hO,new TF,new gO,new tl,new OF,new nA,new Ol,new nR,new rd,new uO,new xF,new eR,new zM,new rR]};this._taskManagerService=new et(f,k,e.config,e.loadConfigs,this.getDefaultCorrelation(),_,v,b,this.waitForRenderingContextReady.bind(this),this.isEntityInView.bind(this),e.criticalDynamicImports,e.getPlatformConfigurationOverrides),this._templateGenerator=e.generateChildWindowTemplate,this._trackWindowsOperator=Br,this._renderingContextManager=new sP(this._taskManagerService,f)}get activeWindows(){return this._activeWindows}init(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const i=yield this.initializeCoreServices();!function(e){const{coreSettings:t,logsCollectorService:i}=e,{testAutomation:n}=t.get(b.J.Test);if(n){const e=window;e.WeakRef&&(e.hooks||(e.hooks={}),e.hooks.__TEST_ONLY_LOGS_COLLECTOR_SERVICE_REF=new e.WeakRef(i))}}(i),this._config.supportsAsyncUserContext||(yield this.awaitUserContextIfAvailable()),this.signalCoreInitSuccess(i);const n={logger:this._logger,renderingContextManager:this._renderingContextManager};null===(t=null===(e=i.authenticationService)||void 0===e?void 0:e.registerCleanUpOnLogoutCallback)||void 0===t||t.call(e,k.D.Core,(e=>lt(Object.assign(Object.assign({},n),{coreSettings:i.coreSettings,reason:"signout",user:e&&(0,Ee.KQ)(e)})))),this.registerForAppStateChanged(i.hostCommunicationService)}catch(e){throw this.reportCoreInitError(e,this._coreServices),e}}))}get coreServices(){if(!this._coreServices)throw(0,se.Tr)("Entry",f.jK.NotPresent,"CoreServices not available");return this._coreServices}get userContexts(){return this._contextSubject}getDefaultCorrelation(){const e=Ue({source:k.D.ExternalCommand,externalId:this._config.externalCorrelationId});return e.id=`Core-${e.id}`,e}initializeCoreServices(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const e=yield this._renderingContextManager.createCoreServices(),{error:t}=e,i=(0,o.__rest)(e,["error"]);this._coreServices=i,this.initializeKPIs(i.scenarioFactory),t&&this.handleError(t);return this._coreServices.coreSettings.get(b.J.Core).chainObserveUsersAfter1stNavigationCompletes?this.setupNavigationHandling(i).then((()=>{var e;(null===(e=this._coreServices)||void 0===e?void 0:e.coreSettings.get(b.J.Core).enableSkipObserveAuthUsers)||this.observeAuthenticatedUsers(i)})):(this.setupNavigationHandling(i),this.observeAuthenticatedUsers(i)),i}))}signalCoreInitSuccess(e){var t,i,n,o,r,s,a;const[l,c]=Ke(e.scenarioFactory);null==c||c.mark(U.ck.InitCoreServicesComplete),null==l||l.mark(U.ck.CoreInitStop),l&&(null===(n=null===(i=null===(t=(0,F.J)())||void 0===t?void 0:t.loader)||void 0===i?void 0:i.stopPieTimer)||void 0===n||n.call(i)),this._logger.log("hostComms::setCoreInitialized"),e.hostCommunicationService.loadModule("core").then((e=>{var t;null===(t=null==e?void 0:e.setCoreInitialized)||void 0===t||t.call(e)})),this.markCoreInitCompleteInAltScenario(e.altScenarioService);const d=Date.now();e.telemetryService.setCoreInitTime(d),e.logsCollectorService.setGetSummaryFunction(Ye(null===(o=this._coreServices)||void 0===o?void 0:o.platformService,null===(r=this._coreServices)||void 0===r?void 0:r.i18n,null===(s=this._coreServices)||void 0===s?void 0:s.authenticationService,null===(a=this._coreServices)||void 0===a?void 0:a.coreSettings))}handleError(e){if(!this.canDisplayCriticalErrorPage(this._coreServices))throw this.reportCoreInitError(e,this._coreServices),e;this.reportCoreInitError(e,this._coreServices,U.ck.CoreInitFailure),this._contextSubject.error(Qe(e))}setupNavigationHandling(e){if(!this.canHandleNavigationIntents(e)){const t=e&&Object.keys(e).sort(),i=`Unable to process navigation intents, ${`${(0,M.u4)(t)}`}:: dataClient::${Boolean(null==e?void 0:e.client)}, deeplink::${Boolean(e.deeplinkService)}, entityCommanding::${Boolean(e.entityCommanding)}`;throw(0,se.Tr)(f.w5.Core,f.jK.CoreNavigationServicesMissing,i)}return e.coreSettings.get(b.J.Core).enableIframeTracking&&(this._trackWindowsOperator=cr),e.activeWindowsService.enableDecoupleCommandingFromApollo?this.observeWindowsWithoutApollo(e).subscribe(this._activeWindows):this.observeWindows(e).subscribe(this._activeWindows),((e,t)=>{const{windowProvider:i,loggerFactory:n,clientState:r,dataClientTrackingService:s,windowTrackerService:a,graphqlOpsCountService:l,leakDetectorService:c}=e,d=n.newLogger("Main-Window-Event-Listeners","core-services-activator");(0,yr.R)(i.opener,O.rY.ShouldShowChatNotification).pipe((0,fr.M)(t,r.observe())).subscribe((([n])=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){try{if(!n||!n.payload||!n.payload.convId)throw new Error(`Invalid payload for shouldShowChatNotification with ${JSON.stringify(n)}`);let o="chats";n.payload.entityType?o=n.payload.entityType:d.log(`null entityType received: ${n.payload.entityType}`),d.log(`Received shouldShowNotification request for conv ${n.payload.convId} with entityType ${o}`);const r=yield Ve({action:pe.uk.view,id:n.payload.convId,linkedEntity:null,type:o},e.client,d),s=!Ge(r,t,e.clientState,d);Sr(i,s,r),d.log(`Sending windowid: ${r} and shouldShowChatNotification: ${s} for conv ${n.payload.convId}`)}catch(e){d.error(`Failed to query window for entity with error ${e}`),Sr(i,!0,void 0)}})))),null==a||a.init(),(0,yr.R)(i.opener,O.rY.GetWindowEntityTypeStats).subscribe((()=>{i.opener.postMessage(O.rY.GetWindowEntityTypeStats,{windowEntityTypeStats:null==a?void 0:a.getTelemetry()})})),(0,yr.R)(i.opener,O.rY.GetApolloCacheStats).subscribe((()=>{i.opener.postMessage(O.rY.GetApolloCacheStats,{apolloCacheStats:null==s?void 0:s.getTelemetry()})})),l&&(0,yr.R)(i.opener,O.rY.GetCdlStats).subscribe((()=>{i.opener.postMessage(O.rY.GetCdlStats,{cdlStats:null==l?void 0:l.getLatestDataAndClear()})}));(0,yr.R)(i.opener,O.rY.GetHeartbeat).subscribe((()=>{let t="";e.appResponsivenessService&&(t=e.appResponsivenessService.getTelemetry()),i.opener.postMessage(O.rY.GetHeartbeat,{windowEntityTypeStats:null==a?void 0:a.getTelemetry(),apolloCacheStats:null==s?void 0:s.getTelemetry(),ariTelemetry:t,OLDStats:null==c?void 0:c.getTelemetry()})}))})(e,this.activeWindows),e.deeplinkService.init()}awaitUserContextIfAvailable(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){yield this._contextSubject.pipe((0,d.P)()).toPromise()}))}initializeKPIs(e){var t,i,n,o,r;if(e){const s=e.findScenario(U.RG.ClientStart),a=null===(n=null===(i=null===(t=(0,F.J)())||void 0===t?void 0:t.loader)||void 0===i?void 0:i.getProperties)||void 0===n?void 0:n.call(i);(null==a?void 0:a.deeplinkId)&&(null==s||s.appendEventData({deeplinkId:a.deeplinkId})),(null==a?void 0:a.RelaunchReason)&&(null==s||s.appendEventData({RelaunchReason:a.RelaunchReason}));const l=null===(o=(0,F.J)())||void 0===o?void 0:o.localStorage.getItem(w.Qt.T2WebOptInSessionId);l&&(null==s||s.appendEventData({t2WebOptInSessionId:l}));const c=null===(r=(0,F.J)())||void 0===r?void 0:r.localStorage.getItem(w.Qt.AttemptedWebBootCount);c&&(null==s||s.appendEventData({attemptedWebBootCount:c})),null==s||s.mark(U.ck.CoreInitStart)}const s=null==e?void 0:e.findScenario(U.RG.ExperienceReady);null==s||s.mark(U.ck.InitCoreServices),null==s||s.startStep(U.ck.GetAuthUser)}reportCoreInitError(e,t={},i){var n,r,s,a,l,c,d,u,m,g,h,p;const v=e instanceof je.G?(e=>e.prevError||(0,se.Tr)(f.w5.Core,f.jK.NotInitialized,e.code,void 0,e.message))(e):e,y=v.context===f.w5.Core?v:(0,se.Tr)(f.w5.Core,v.code||f.jK.NotInitialized,v.context,{innerError:v}),S=y.subContext||"UnknownCoreInitFailure",k=(0,re.A)((0,se.B9)(y));this._logger.warn(`Initializing Core failed. Message: ${k}, subContext: ${S}`);const[w,T]=Ke(t.scenarioFactory),I={errorCode:e instanceof je.G&&je.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():null!==(n=y.code)&&void 0!==n?n:f.jK.CoreInitFailure,reason:f.jK.CoreInitFailure},j=null===(r=(0,F.J)())||void 0===r?void 0:r.loader;i?(null==w||w.mark(i,I),null===(a=null===(s=null==t?void 0:t.altScenarioService)||void 0===s?void 0:s.altScenario)||void 0===a||a.mark(i,I)):(null==w||w.fail(I),null===(c=null===(l=null==t?void 0:t.altScenarioService)||void 0===l?void 0:l.altScenario)||void 0===c||c.fail(I)),w&&(null===(d=null==j?void 0:j.stopPieTimer)||void 0===d||d.call(j)),null===(m=null===(u=this._coreServices)||void 0===u?void 0:u.diagnosticsService)||void 0===m||m.persistDiagnosticsAsPreviousSessionLogs(),null==j||j.persistLoaderLogsAsPreviousSession(),null==T||T.fail({contentType:(0,re.A)(`${y.context}-${y.subContext}`),errorCode:(0,se.qZ)(y),errors:k,reason:_P}),null===(g=null==t?void 0:t.windowProvider)||void 0===g||g.opener.postMessage(C.W.CoreInitializationFailed,{errorDescription:S}),(null===(p=null===(h=null==t?void 0:t.coreSettings)||void 0===h?void 0:h.get(b.J.Core))||void 0===p?void 0:p.enableTaskbarIconOnCoreInitFailure)&&function(e,t){var i;(0,o.__awaiter)(this,void 0,void 0,(function*(){try{const t=yield null==e?void 0:e.loadModule("taskbar");null===(i=null==t?void 0:t.showBadge)||void 0===i||i.call(t,{icon:{glyphBadge:{glyph:_.t.attention}}})}catch(e){NP(t,`${TP}: ${e}`,"webclient_framework_foundation_core_services")}}))}(null==t?void 0:t.hostCommunicationService,this._logger)}markCoreInitCompleteInAltScenario(e){var t,i;null===(t=null===performance||void 0===performance?void 0:performance.mark)||void 0===t||t.call(performance,v),null===(i=null==e?void 0:e.altScenario)||void 0===i||i.mark(U.ck.PostCoreInitializationTasks)}waitForRenderingContextReady(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.isGettingContextByIdEnabled(null===(i=this._coreServices)||void 0===i?void 0:i.coreSettings)?this.getOrCreateRenderingContextForId(t):this._contextSubject.pipe((0,u.h)((t=>{var i;return!e||!!(null===(i=t.authenticationUser)||void 0===i?void 0:i.isAuthenticated)})),(0,d.P)()).toPromise()}))}getExistingContextForId(e){if(!e){const e=this._renderingContextManager.getDefaultRenderingContext();return e&&Promise.resolve(e)||Promise.reject(new Ne.G(Ne.$.RENDERING_CONTEXT_DOES_NOT_EXIST))}return this._renderingContextManager.getUserRenderingContext(e)}getContextObservable(e){var t,i;return!this.isGettingContextByIdEnabled(null===(t=this._coreServices)||void 0===t?void 0:t.coreSettings)||this._contextSubject.hasError?this._contextSubject:(0,l.D)(null!==(i=this.getExistingContextForId(e))&&void 0!==i?i:Promise.reject(new Ne.G(Ne.$.RENDERING_CONTEXT_DOES_NOT_EXIST)))}getOrCreateRenderingContextForId(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.getExistingContextForId(e);if(i)return i;const n=null===(t=this.coreServices)||void 0===t?void 0:t.authenticationService;if(!n)return Promise.reject(new Ne.G(Ne.$.CORE_SERVICES_MISSING,void 0,e));const r=yield function(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!t)throw new Ne.G(Ne.$.USERCONTEXTID_EMPTY,void 0,t);const n=yield i.getUser({correlation:e,accountId:t});if(!n)throw new Ne.G(Ne.$.USER_DOES_NOT_EXIST,void 0,t);if(!n.isAuthenticated)throw new Ne.G(Ne.$.USER_NOT_AUTHENTICATED,void 0,t);return(0,Ee.KQ)(n)}))}(Object.assign(Object.assign({},Ue({source:k.D.Core})),{scenarioName:U.RG.AuthWebCachedUser}),e,n);return yield this.tryExecutePrimaryUserTasks(),this._renderingContextManager.getOrCreateUserRenderingContext(r)}))}isMTMACoreEnabled(e){var t;return!!(null===(t=null==e?void 0:e.get(b.J.Core))||void 0===t?void 0:t.enableMTMA)&&!!this.isGettingContextByIdEnabled(e)}isGettingContextByIdEnabled(e){var t;return!!(null===(t=null==e?void 0:e.get(b.J.Auth))||void 0===t?void 0:t.enableIntegratedAuthApp)&&!!this._config.supportsAsyncUserContext}tryExecutePrimaryUserTasks(){var e,t,i,n;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this._taskManagerService.hasTasks(f.sM.OnPrimaryUser))return;if(null===(e=this._coreServices)||void 0===e?void 0:e.primaryUser)return;if(this._primaryUserTasksPromise)return this._primaryUserTasksPromise;const o=null===(t=this._coreServices)||void 0===t?void 0:t.authenticationService,r=yield null===(i=null==o?void 0:o.getCachedUsers)||void 0===i?void 0:i.call(o,Object.assign(Object.assign({},Ue({source:k.D.Core})),{scenarioName:U.RG.AuthWebCachedUser}),{isPrimaryUser:!0,isAuthenticated:!0}),s=null===(n=null==r?void 0:r.filter((e=>!0===e.isAuthenticated)))||void 0===n?void 0:n[0];return s&&!this._primaryUserTasksPromise&&(this._primaryUserTasksPromise=this._renderingContextManager.executePrimaryUserTasks((0,Ee.KQ)(s)).then((e=>{this._coreServices=e}))),this._primaryUserTasksPromise}))}observeAuthenticatedUsers(e){this.observeUsers(e,this._logger).pipe(this.trackAuthUsers(e),(0,m.K)((t=>{var i,n,o;const r=t instanceof je.G&&je.G.isFunction(t.toTelemetryEntry)?t:new Ne.G(null==t?void 0:t.code,t||new Error("Unknown error"));null===(n=(i=this._logger).errorToTelemetry)||void 0===n||n.call(i,`Core Initialization: ${jP}`,"webclient_framework_foundation_core_services",{errorCode:r.toTelemetryEntry()},!0);const s=(0,se.Tr)("Core",f.jK.NotInitialized,null===(o=r.prevError)||void 0===o?void 0:o.context,{innerError:r.prevError});throw e.errorState.error=s,e.coreSettings.get(b.J.Core).enableCoreErrorsV2?r:s})),(0,g.b)((()=>{const[t,i]=Ke(e.scenarioFactory);null==t||t.mark(U.ck.CoreRenderingContextReady)})),(0,c.U)((e=>e.length>0?e[0]:this._renderingContextManager.getDefaultRenderingContext()))).subscribe(this._contextSubject)}canDisplayCriticalErrorPage(e){return!!((null==e?void 0:e.rebootService)&&e.i18n&&e.scenarioFactory&&e.coreSettings&&e.hostCommunicationService&&!e.coreSettings.get(b.J.Core).enableThrowingToExperienceEntry&&e.coreSettings.get(b.J.Core).enableCoreErrorsV2)}canHandleNavigationIntents(e){return!!((null==e?void 0:e.client)&&e.deeplinkService&&e.entityCommanding)}registerForAppStateChanged(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){let i;try{i=yield e.loadModule("core")}catch(e){const t=`${zs}${Vs.LoadModuleCoreFailed} registerForAppStateChanged`;return void NP(this._logger,t,"webclient_framework_host_comms")}try{null===(t=null==i?void 0:i.registerForAppStateChanged)||void 0===t||t.call(i,this.cleanupOnAppStateChangedCallback)}catch(e){const t=`${zs}${Vs.RegisterForAppStateChangedFailed}`;return void NP(this._logger,t,"webclient_framework_host_comms")}}))}observeWindowsWithoutApollo(e){return e.activeWindowsService.getActiveWindowsObservable().pipe((0,c.U)((e=>e.map((t=>Object.assign(Object.assign({},t),{screenState:{numOpenWindows:e.length}}))))),this._trackWindowsOperator(this.getContextObservable.bind(this),e,this._templateGenerator,this._config.getExperienceWindowFeatures))}observeWindows(e){return(0,he.G)(e.client.watchQuery({query:it})).pipe((0,u.h)((({errors:e,loading:t})=>void 0===e&&!t)),(0,c.U)((({data:{activeWindows:e}})=>e.map((t=>Object.assign(Object.assign({},t),{screenState:{numOpenWindows:e.length}}))))),this._trackWindowsOperator(this.getContextObservable.bind(this),e,this._templateGenerator,this._config.getExperienceWindowFeatures))}observeUsers(e,t){const i=this.observeUsersEvents(e.client);return(0,he.G)(i).pipe((0,c.U)((e=>this.toUserContexts(e,t))),(0,m.K)((e=>{var t,i;const n=`Core Initialization: ${wP}`;throw null===(i=(t=this._logger).errorToTelemetry)||void 0===i||i.call(t,`${n} ${e.message}`,"webclient_framework_foundation_core_services",{errorCode:e.code,context:e.context,errors:`${null==e?void 0:e.reason}-${(0,M.u4)(null==e?void 0:e.serverResponse)}`},!0),Qe(e)})))}observeUsersEvents(e){const t={filter:{isAuthenticated:!0}},i=e.watchQuery({query:ot,variables:t});return i.subscribeToMore({document:nt,variables:t,updateQuery:(e,t)=>t.subscriptionData.data.authenticationUsersEvent}),i}onUserAuthenticated(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return yield this.tryExecutePrimaryUserTasks(),this._renderingContextManager.getOrCreateUserRenderingContext(e)}))}onUserDestroy(e){const t={logger:this._logger,renderingContextManager:this._renderingContextManager},i=e.authenticationUser;i&&lt(Object.assign(Object.assign({},t),{coreSettings:e.coreSettings,reason:"unknown_destroy",user:i}))}toUserContexts({data:e,loading:t,errors:i},n){var o;if(i)throw NP(n,CP,"webclient_framework_foundation_core_services"),(0,ae.E6)({graphQLErrors:i.concat(),extraInfo:void 0,networkError:null,name:"AuthenticationUsers subscription error",message:"Error in authentication users subscription"});if(!t){if(!e)return NP(n,IP,"webclient_framework_foundation_core_services"),[];return(null!==(o=e.authenticationUsers)&&void 0!==o?o:[]).filter((e=>!0===e.isAuthenticated)).map(this.toUserContext)}return[]}toUserContext(e){const{id:t,isAuthenticated:i,cloud:n,profile:{tenantId:o,objectId:r,puid:s},role:a,type:l,subType:c,loginUserName:d,homeAccountId:u}=e;return{id:t,isAuthenticated:i,profile:{tenantId:o,objectId:r,puid:s},cloud:n,role:a,type:l,subType:c,loginUserName:d,homeAccountId:u||void 0}}isEntityInView(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this._coreServices)return Promise.resolve(!1);const{clientState:i,coreSettings:n}=this._coreServices;return ze(e,t,i,this._activeWindows,this._logger,n)}))}registerForLogsDownloadSignalFromDesktop(e,t){var i;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const n=yield t.loadModule("logscollection");n&&(null===(i=null==n?void 0:n.registerForRequestWebLogsDownload)||void 0===i||i.call(n,(t=>{const i=!t.webLogsId;this._preCoreLogsFileService.downloadLogsFiles(e,i,t.webLogsId)})))}))}}},451249:(e,t,i)=>{"use strict";i.d(t,{B$:()=>C,_A:()=>_,V5:()=>T,eU:()=>I,Ig:()=>j,k6:()=>x,aJ:()=>A,U8:()=>D,sW:()=>O,mH:()=>R,Wn:()=>P,ok:()=>L,z5:()=>U,cC:()=>W,vL:()=>B,TA:()=>$,CQ:()=>H,fr:()=>q,fZ:()=>z,bY:()=>V});var n,o=i(740597),r=i(74583),s=i(466094),a=i(50805),l=i(8122),c=i(974509),d=i(955105),u=i(460193),m=i(827748),g=i(448850),h=i(905581),p=i(132756),v=i(287474),y=i(738646),f=i(804589),S=i(747741),k=i(932289),b=i(403084);!function(e){e.Otp="mail",e.GFed="google.com"}(n||(n={}));const w="9188040d-6c67-4c5b-b112-36a304b66dad",C=(e,t,i,n=!1)=>{var o,r,a;let l={};try{l=(0,u.s)().state.getSearchState()}catch(e){}const c=(null===(o=null==i?void 0:i.profile)||void 0===o?void 0:o.tid)||l.tid||l.Tid||l.tenantId||l.tenantid;if(i||e[0]&&e[1]){if(c){t.log("Anon flow - anonymous user created");const e=c===w?s.G7.life:s.G7.prod;return{isAuthenticated:!0,userName:(null==i?void 0:i.userName)||"anonymous",profile:{oid:`8:anon:${c}`,tid:c,upn:(null===(r=null==i?void 0:i.profile)||void 0===r?void 0:r.upn)||"",puid:""},role:s.w4.Anonymous,type:s.Ch.Anonymous,cloud:(null==i?void 0:i.cloud)||e}}if(n)return t.log("Anon flow - anonymous user created without tid"),{isAuthenticated:!0,userName:(null==i?void 0:i.userName)||"anonymous",profile:{oid:"8:anon:",tid:"",upn:(null===(a=null==i?void 0:i.profile)||void 0===a?void 0:a.upn)||"",puid:""},role:s.w4.Anonymous,type:s.Ch.Anonymous,cloud:(null==i?void 0:i.cloud)||s.G7.prod}}t.log("non anon flow - user undefined")},_=(e,t,i,n)=>{const{getTenantsServiceUrl:o,enableMTO:r}=(null==n?void 0:n.get(a.J.Auth))||{};return{method:t,url:`${o||"https://teams.microsoft.com/api/mt/part/dogfood/beta/users/tenantsv2"}?invalidate=${+new Date(Date.now())}`,serviceName:l.E.Auth,authOptions:{accountId:e,source:"core-auth-base"},apiName:i,headers:r?{"content-type":"application/json","x-ms-client-capabilities":"x-ms-mto-enabled"}:{"content-type":"application/json"}}},T=e=>!!e&&e.status===c.qb.NOT_AUTHORIZED&&"SkypeToken"===e.headers["x-invalid-token"],I=(e,t,i,n,o,r,s)=>{var l,c,d;if("True"!==(null===(l=null==t?void 0:t.headers)||void 0===l?void 0:l[f.kI])||e!==f.ej.IC3_GATEWAY_CAE_KEY&&e!==f.ej.IC3_GATEWAY_AAD_KEY&&e!==f.ej.IC3_GATEWAY_CAE_KEY_INT&&e!==f.ej.IC3_GATEWAY_AAD_KEY_INT)return e;if(!i)return null==o||o.addEventData(["missingWwwAuthHeader"]),e;if(!(0,S.ce)(i))return null==o||o.addEventData(["missingStmHeader"]),e;const u=t.authOptions||{};null==o||o.addEventData([`source:${null==u?void 0:u.source}`]);const m=(0,S.Ay)(i);switch(null==o||o.addEventData([`highestProtocol:${m}`]),e){case f.ej.IC3_GATEWAY_CAE_KEY:case f.ej.IC3_GATEWAY_CAE_KEY_INT:if(m===v.Zw.CAE)return e;break;case f.ej.IC3_GATEWAY_AAD_KEY:case f.ej.IC3_GATEWAY_AAD_KEY_INT:if(m===v.Zw.AAD||m===v.Zw.CAE)return e}if(m===v.Zw.AAD){(null==u?void 0:u.source)&&(0,S.Qk)(n,u.source,v.Zw.AAD),null==o||o.appendScenarioEventData({tokenFallbackType:"CAE_to_AAD"}),null==o||o.addEventData([`stmResource:${f.ej.IC3_GATEWAY_AAD_KEY}`,"stmFallbackWithAadToken"]);let{ic3NonCaeResource:e}=null!==(c=null==s?void 0:s.get(a.J.Auth))&&void 0!==c?c:{};return e||(e=f.ej.IC3_GATEWAY_AAD_KEY),e}if(m===v.Zw.Skype){(null==u?void 0:u.source)&&(0,S.Qk)(n,u.source,v.Zw.Skype),null==o||o.appendScenarioEventData({tokenFallbackType:(e===f.ej.IC3_GATEWAY_CAE_KEY||f.ej.IC3_GATEWAY_CAE_KEY_INT?"CAE":"AAD")+"_to_Skype"}),null==o||o.addEventData(["stmResource:skype"]);const i={context:"auth-helper",subContext:"getRetryResourceForStMigration",errorCode:f.SM.FallbackWithSkypeToken,message:"Highest protocal is Skype, retry with skypeToken",correlationId:null===(d=null==t?void 0:t.headers)||void 0===d?void 0:d.correlationId,isExpected:!0};throw null==r||r({error:Object.assign(Object.assign({},i),{name:"authError"})}),(0,k.Tr)(i)}return e},j=(e,t,i,n=!1,o=!1)=>{var a;return e.subType===s.Yf.Ccm?e:(0,r.isEmpty)(e.profile)||!e.profile.oid&&n||e.role===s.w4.Anonymous||e.userRole===s.jh.Anonymous||!e.isAuthenticated&&t[0]?(i.log("checking anon flow"),C(t,i,e,o)):(e.role=e.role===s.w4.Guest||1===(null===(a=e.profile)||void 0===a?void 0:a.acct)?s.w4.Guest:s.w4.Member,N(e),E(e),e.profile.oid=e.profile.oid||`8:defaultOid:${e.profile.tid}`,!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.userRole===s.jh.CrossCloudMeeting&&(e.role=s.w4.Anonymous,e.type=s.Ch.Anonymous),i.log(`User role = [${e.role}], type = [${e.type}], cloud = [${e.cloud}]`),e)},N=e=>{var t,i,o,r,a;if((null===(t=e.profile)||void 0===t?void 0:t.tid)===w)return void(e.type=s.Ch.MsaLife);const l=[s.Ch.Msa,s.Ch.Otp,s.Ch.GFed];if(e.type&&-1!==l.indexOf(e.type))return;let c=0===(null===(o=null===(i=e.profile)||void 0===i?void 0:i.altsecid)||void 0===o?void 0:o.indexOf("1:"))?s.Ch.Msa:s.Ch.Aad;(null===(r=e.profile)||void 0===r?void 0:r.idp)&&(null===(a=e.profile)||void 0===a?void 0:a.iss)!==e.profile.idp&&(c=e.profile.idp===n.Otp?s.Ch.Otp:c,c=e.profile.idp===n.GFed?s.Ch.GFed:c),e.type=c},E=e=>{e.type!==s.Ch.MsaLife?e.cloud&&e.cloud!==s.G7.prod||(e.cloud=s.G7.prod):e.cloud=s.G7.life},x=(e,t)=>{if(!e.anon||!t)return[!1,!1];t=decodeURIComponent(t);for(const i of e.anon)if(i.anonUrlMatch&&t.indexOf(i.anonUrlMatch)>-1)return[!0,F(i,t)];return[!1,!1]},A=(e,t)=>{const i=new Error("Tenant is has not completed redemption");return Object.assign(i,{context:"global-auth",subContext:"handleGetTenants",reason:"",errorCode:e,serverResponse:"",correlationId:t,isExpected:!0,innerError:""})},D=e=>{const t=new Error("Tenant is has not completed redemption");return Object.assign(t,{context:"global-auth",subContext:"handleGetTenants",reason:"",errorCode:f.SM.MissingRequiredFields,serverResponse:"",correlationId:e,isExpected:!0,innerError:""})},F=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const i of e.restrictions)if(t.indexOf(i)>-1)return!0;return!1},O=(e,t)=>{const{maxRetries:i,retryWindow:n,backoffTime:r,shouldRetry:s}=t,a=e=>n-(Date.now()-e);return(...t)=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const n=Date.now();let o=0,l=a(n),c="";for(;o++<=i&&l>0;)try{return yield Promise.resolve(e.apply(e,t))}catch(e){if(s&&!s(e))throw e;if(e&&s&&s(e)&&o>=i){const t=`;All retries elapsed or retryWindow expired, RetryCount: ${o}, RemainingTime: ${l}`;throw(0,h.Tr)(e.context,e.code,e.subContext?e.subContext:"",e.reason,e.message+t,e.serverResponse)}if(o>=i||a(n)<=0){c=null==e?void 0:e.message;break}yield(0,m._)(r),l=a(n)}throw M(o,c,a(n))}))},M=(e,t,i)=>(0,h.Tr)("AuthRetryWithBackoff",p.jK.MaxLimitReached,"elapsed",void 0,`${t}; All retries elapsed or retryWindow expired, RetryCount: ${e}, RemainingTime: ${i}`);var R;!function(e){e.WWW_AUTHENTICATE_HEADER="www-authenticate",e.ERROR_PREFIX="error=",e.CLAIMS_PREFIX="claims=",e.INSUFFICIENT_CLAIMS="insufficient_claims"}(R||(R={}));const P=(e,t)=>{const i={error:void 0,claims:void 0},n=null==e?void 0:e[R.WWW_AUTHENTICATE_HEADER];if(!n)return i;const o=n.split(",").filter(Boolean).map((e=>e.trim()));for(const e of o){const n=e.split('"');if(3===n.length)switch(n[0].toLocaleLowerCase()){case R.ERROR_PREFIX:i.error=n[1];break;case R.CLAIMS_PREFIX:i.claims=t?n[1]:(0,g.G)(n[1])}}return i},L=e=>{var t;return{id:e.id,tenantId:e.profile.tenantId,oid:e.profile.objectId,userName:null!==(t=e.loginUserName)&&void 0!==t?t:"",accountType:e.type}},U=(e,t)=>{if((null==e?void 0:e.isPartialContent)&&(null==t?void 0:t.length)>0){return t.filter((e=>e.tenantRelationship===f.Tv.MTO)).concat(e.tenants)}return e.tenants},W=(e,t)=>{var i;const{enableRenderingCrossCloudTenant:n,buildCloud:o}=null!==(i=null==t?void 0:t.get(a.J.Auth))&&void 0!==i?i:{};return e.cloudType!==o&&!n},B=(e,t,i)=>{const n=(e=>e&&"string"==typeof e?{claim:e}:e||{})(i),[o,r]=(0,b.OU)({options:n,source:e,scenarioName:y.RG.AcquireToken,subContext:t,startWithoutScenario:!0});return[n,o,r]},$=(e,t)=>({id:`dummy-user-${e.tenantId}-${t.homeAccountId}`,userName:t.userName,profile:{acct:1,altsecid:"",amr:[],aud:"",exp:-1,email:t.profile.email,family_name:"",given_name:t.profile.given_name,iat:1,iss:"",name:t.profile.name,preferred_username:t.userName||t.profile.email,nbf:-1,nonce:"",oid:`dummy-user-${e.tenantId}`,onprem_sid:"",sub:"",tid:e.tenantId,unique_name:t.profile.unique_name,upn:t.profile.email||t.profile.upn,ver:"1.0",isHomeAccount:!1},homeAccountId:t.homeAccountId||t.id,isAuthenticated:!1,type:e.tenantId===v.e0?s.Ch.MsaLife:s.Ch.Aad,cloud:e.cloudType,role:s.w4.Guest}),H=e=>{switch(e){case s.zC.prod:case s.zC.gcc:return s.G7.prod;case s.zC.dod:return s.G7.dod;case s.zC.gcch:return s.G7.gcch;case s.zC.gallatin:return s.G7.gallatin;default:return s.G7.prod}},q=(e,t,i,n,o)=>{const r=o?y.RG.AuthorizeRequest:y.RG.AcquireToken;i.correlation.scenarioName=r;const[s,a]=(0,b.OU)({options:i,source:"auth-service-module",scenarioName:r,subContext:e,timeoutMs:!1===i.silent?f.rF.ONE_HOUR:void 0,scenarioEventData:{isSilent:i.silent,endpointUrl:t,stmSource:n.source},eventData:["silent:"+(void 0===i.silent?-1:+!!i.silent),"uid:"+ +!!n.userIdentifier,`scheme:${n.scheme}`],startWithoutScenario:!0,isBatch:o});return[s,a]},z=(e,t)=>{const i=e.newLogger("AuthContextChange","create-auth-task-cross-tab-callbacks");let n;return{contextChangePost:e=>{var n;return null===(n=i.debugToTelemetry)||void 0===n||n.call(i,`Sent auth context changed cross tab message: ${e}`,"auth_context_change_cross_tab_post_message",{reason:e},!0),null==t?void 0:t.postMessage("RefreshForAuthContextChange")},contextChangeSubscribe:e=>(n=null==t?void 0:t.subscribeToMessage("RefreshForAuthContextChange",(t=>{var o;return null===(o=i.debugToTelemetry)||void 0===o||o.call(i,"Recieved auth context changed cross tab message","auth_context_change_cross_tab_subscription",void 0,!0),null==n||n(),e.authentication.showRefreshModal(d.D.Authentication)})),n)}},V=e=>{const t=[];for(let i=0;i<e.length;i++){e.charCodeAt(i)>f.uI.TWO_HUNDRED_FIFTY_FIVE&&t.push(e.charAt(i))}return t}},935232:(e,t,i)=>{"use strict";i.d(t,{_i:()=>c,rt:()=>d});var n=i(109062),o=i(354571),r=i(22085),s=i(130757),a=i(366758),l=i(910512);let c;const d=(e,t)=>(c||(c=new u(e,t)),c);class u{constructor(e,t){this._hostStateProvider=e,this._networkStateProvider=t}observeMachineOnline(){return this._networkStateProvider.observe().pipe((0,r.x)()).pipe((0,s.U)((e=>e===n.G.Online))).pipe((0,a.h)((e=>!0===e)))}observeMachineAwake(){return this._hostStateProvider.observe().pipe((0,l.g)("suspendedState")).pipe((0,s.U)((e=>e.suspendedState===o.V9.Resumed))).pipe((0,a.h)((e=>!0===e)))}isMachineAwake(){return this._hostStateProvider.getState().suspendedState===o.V9.Resumed}isMachineOnline(){return this._networkStateProvider.getState()===n.G.Online}}},462410:(e,t,i)=>{"use strict";i.d(t,{q:()=>d});var n,o,r=i(740597),s=i(974509),a=i(132756),l=i(905581),c=i(74583);!function(e){e[e.clean=0]="clean",e[e.registrationToken=1]="registrationToken",e[e.skypeToken=2]="skypeToken"}(n||(n={})),function(e){e.orgid="orgid",e.teamsvisitor="teamsvisitor",e.live="live",e.guest="guest"}(o||(o={}));class d{constructor(e){this.discover=e,this._getSkypeIdType=()=>(0,r.__awaiter)(this,void 0,void 0,(function*(){var e;const t=yield this.discover.skypeid(),i=null===(e=null==t?void 0:t.split(":"))||void 0===e?void 0:e[1];return o[i]}))}authorizeRequest(e,t="Authentication"){return(0,r.__awaiter)(this,void 0,void 0,(function*(){let i,n;const a=(e,o)=>(0,r.__awaiter)(this,void 0,void 0,(function*(){const r=Object.assign({},e.headers);if(this.registrationToken)r.RegistrationToken=this.registrationToken;else{i=n;const s=performance.now(),a=yield this._validateSkypeToken({invalidSkypeToken:n,forceRenew:o});n=a.skypeToken,yield this.validateAndThrowIfTokensAreSameOrInvalid("Skype::authorizeRequest",n,i,o),e.authPerformanceLogs=Object.assign(Object.assign({},e.authPerformanceLogs),{skypeTokenDelta:performance.now()-s,skypeTokenFromCache:a.fromCache}),r[t]=this.formatAuthHeader(t,n)}return e.headers=r,e}));return{request:yield a(e),resolver:(e,t)=>(0,r.__awaiter)(this,void 0,void 0,(function*(){const{status:n,headers:{"set-registrationtoken":r}}=e;if(n===s.qb.NOT_AUTHORIZED){const e=yield this._getSkypeIdType(),n=this.discover.shouldSkipTokenRefreshForAnon&&this.discover.shouldSkipTokenRefreshForAnon();if(e===o.teamsvisitor&&n)return;if(this.registrationToken&&delete this.registrationToken,!i)return a(t,!0)}else r&&n!==s.qb.NOT_FOUND&&this.parseToken(r)}))}}))}authorize(e,t="Authentication"){return i=>(0,r.__awaiter)(this,void 0,void 0,(function*(){let r,a,l=!1,c=n.clean;for(let d=0;d<=2;++d){const d=Object.assign({},i.headers),u=this.registrationToken;if(u)d.RegistrationToken=u;else{const e=performance.now(),n=yield this._validateSkypeToken({invalidSkypeToken:r,forceRenew:l});yield this.validateAndThrowIfTokensAreSameOrInvalid("Skype::authorize",null==n?void 0:n.skypeToken,r,l),r=n.skypeToken,i.authPerformanceLogs=Object.assign(Object.assign({},i.authPerformanceLogs),{skypeTokenDelta:performance.now()-e,skypeTokenFromCache:n.fromCache}),d[t]=this.formatAuthHeader(t,r)}i.headers=d,a=yield e(i);const{status:m,headers:{"set-registrationtoken":g}}=a;if(m===s.qb.NOT_AUTHORIZED){const e=yield this._getSkypeIdType(),t=this.discover.shouldSkipTokenRefreshForAnon&&this.discover.shouldSkipTokenRefreshForAnon();if(e===o.teamsvisitor&&t)break;if(u){if(u===this.registrationToken&&delete this.registrationToken,c===n.clean){r=void 0,c=n.registrationToken;continue}}else if(!l&&c!==n.skypeToken){l=!0,c=n.skypeToken;continue}}return g&&m!==s.qb.NOT_FOUND&&this.parseToken(g),a}return this.validateResponse(a)}))}validateAndThrowIfTokensAreSameOrInvalid(e,t,i,n){return(0,r.__awaiter)(this,void 0,void 0,(function*(){const o=t===i;if(this.discover.getSettingToDisableSkypeTokenValidation&&this.discover.getSettingToDisableSkypeTokenValidation(n,o))return;const r=this.discover.shouldThrowErrorIfSkypeTokenIsEmpty&&this.discover.shouldThrowErrorIfSkypeTokenIsEmpty(),s=!t||(0,c.isEmpty)(t.trim());if(o||r&&s){const i=yield this._getSkypeIdType();throw(0,l.Tr)("Discover",a.jK.FailedToUpdate,e,void 0,`Failed to update token. skypeId startsWith: ${i}, new token: ${+!!t}, isTokenSame: ${o}, isNewTokenEmptyOrUndefined: ${s}, forceRenew: ${n}`)}}))}_validateSkypeToken(e){return(0,r.__awaiter)(this,void 0,void 0,(function*(){return this.discover.validateSkypeTokenV2?this.discover.validateSkypeTokenV2(e):{skypeToken:yield this.discover.validateSkypeToken(e)}}))}validateResponse(e){if(!e)throw(0,l.Tr)(a.w5.Authentication,a.jK.UndefinedGlobalError,"",void 0,"Failed to authenticate response");return e}formatAuthHeader(e,t){return"Authentication"===e?`skypetoken=${t}`:"x-skypetoken"===e?t:`skype_token ${t}`}parseToken(e){const t=(0,c.fromPairs)(e.split(";").map((e=>e.split("=",2).map((e=>e.trim()))))),{expires:i}=t,n=(0,r.__rest)(t,["expires"]);n.endpointId&&(this.registrationToken=(0,c.toPairs)(n).map((e=>e.join("="))).join("; "))}}},961614:(e,t,i)=>{"use strict";i.d(t,{R:()=>n,u:()=>a});var n,o=i(38023),r=i(50805),s=i(74583);!function(e){e.Active="Active",e.Inactive="Inactive",e.LongInactive="LongInactive"}(n||(n={}));class a{constructor(e,t,i,r,l){this._host=e,this._activityCallback=r,this._trackDocumentVisibility=l,this.msUntilIdle=a.MsUntilIdleDefault,this.msUntilLongIdle=a.msUntilLongIdleDefault,this.handleMonitoredWindowEvent=(0,s.debounce)((()=>{this._idleStateBehaviorSubject.value!==n.Active&&this._idleStateBehaviorSubject.next(n.Active),this.restartIdleTimer(),this._activityCallback&&this._activityCallback()}),a.msDelayTime,{maxWait:this.msUntilIdle-a.msDelayTime*a.msMaxWaitTimeFactor,leading:!0}),this.handleIdleTimerTimeout=()=>{this._idleStateBehaviorSubject.next(n.Inactive),this._idleCountdownTimer=void 0,this.restartLongIdleTimer()},this.handleLongIdleTimerTimeout=()=>{this._idleStateBehaviorSubject.next(n.LongInactive),this._longIdleCountdownTimer=void 0},this.handleDocumentVisibilityChange=()=>{this._host.document.hidden?this._idleStateBehaviorSubject.next(n.Inactive):(this._idleStateBehaviorSubject.next(n.Active),this.restartIdleTimer())},this._idleStateBehaviorSubject=new o.X(n.Inactive),i&&this.setSettings(i),this.restartLongIdleTimer(),a.monitoredWindowEvents.forEach((t=>{e.addEventListener(t,this.handleMonitoredWindowEvent)})),l&&e.addEventListener("visibilitychange",this.handleDocumentVisibilityChange),t.newLogger("IdleTracker","core-services-client-state").log("Initialized")}observe(){return this._idleStateBehaviorSubject.asObservable()}getState(){return this._idleStateBehaviorSubject.value}createChildWindowIdleTracker(e,t,i){const n=this._activityCallback||this.handleMonitoredWindowEvent;return new a(e,t,i,n)}restartIdleTimer(){this.stopIdleTimers(),this._idleCountdownTimer=this._host.setTimeout(this.handleIdleTimerTimeout,this.msUntilIdle)}dispose(){this.stopIdleTimers(),a.monitoredWindowEvents.forEach((e=>{this._host.removeEventListener(e,this.handleMonitoredWindowEvent)})),this._trackDocumentVisibility&&this._host.removeEventListener("visibilitychange",this.handleDocumentVisibilityChange),this._idleStateBehaviorSubject.complete(),this.handleMonitoredWindowEvent.cancel()}setSettings(e){const{appIdleTimeoutInMs:t,appLongIdleTimeoutInMs:i}=e.get(r.J.Core);this.msUntilIdle=t||a.MsUntilIdleDefault,this.msUntilLongIdle=i||a.msUntilLongIdleDefault}restartLongIdleTimer(){void 0!==this._longIdleCountdownTimer&&(this._host.clearTimeout(this._longIdleCountdownTimer),this._longIdleCountdownTimer=void 0),this._longIdleCountdownTimer=this._host.setTimeout(this.handleLongIdleTimerTimeout,this.msUntilLongIdle)}stopIdleTimers(){void 0!==this._idleCountdownTimer&&(this._host.clearTimeout(this._idleCountdownTimer),this._idleCountdownTimer=void 0),void 0!==this._longIdleCountdownTimer&&(this._host.clearTimeout(this._longIdleCountdownTimer),this._longIdleCountdownTimer=void 0)}}a.monitoredWindowEvents=["scroll","DOMMouseScroll","mousewheel","touchstart","touchmove","mousemove","keydown"],a.msDelayTime=1e3,a.msMaxWaitTimeFactor=30,a.msUntilLongIdleDefault=12e5,a.MsUntilIdleDefault=3e5},218228:(e,t,i)=>{"use strict";var n,o,r,s,a;i.d(t,{m7:()=>n,bi:()=>o,GO:()=>a}),function(e){e.PASSED="PASSED",e.EDU="EDU",e.PSTN_CALLING="PSTN_CALLING",e.USER_CHOICE="USER_CHOICE",e.ADMIN_DISABLED="ADMIN_DISABLED",e.GUEST_USER="GUEST_USER",e.USER_FTS="USER_FTS",e.T1_DEFAULT="T1DEFAULT",e.T21_DEFAULT="T21DEFAULT",e.T21_ONLY="T21ONLY"}(n||(n={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohort",e.EarlyEnterpriseCohort="EarlyEnterpriseCohort",e.MidEnterpriseCohort="MidEnterpriseCohort",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohort",e.LateEnterpriseCohort="LateEnterpriseCohort",e.GovCloudCohort="GovCloudCohort",e.MacR36Cohort="MacR36Cohort",e.MacR4Cohort="MacR4Cohort",e.EduCohort="EduCohort",e.InternalRingCohort="InternalRingCohort",e.ExternalTapCohort="ExternalTapCohort",e.NoPPChannelCohort="NoPPChannelCohort"}(o||(o={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohortUplevel",e.EarlyEnterpriseCohort="EarlyEnterpriseCohortUplevel",e.MidEnterpriseCohort="MidEnterpriseCohortUplevel",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohortUplevel",e.LateEnterpriseCohort="LateEnterpriseCohortUplevel",e.GovCloudCohort="GovCloudCohortUplevel",e.MacR36Cohort="MacR36CohortUplevel",e.MacR4Cohort="MacR4CohortUplevel",e.EduCohort="EduCohortUplevel",e.InternalRingCohort="InternalRingCohortUplevel",e.ExternalTapCohort="ExternalTapCohortUplevel",e.NoPPChannelCohort="NoPPChannelCohortUplevel"}(r||(r={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohortDownlevel",e.EarlyEnterpriseCohort="EarlyEnterpriseCohortDownlevel",e.MidEnterpriseCohort="MidEnterpriseCohortDownlevel",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohortDownlevel",e.LateEnterpriseCohort="LateEnterpriseCohortDownlevel",e.GovCloudCohort="GovCloudCohortDownlevel",e.MacR36Cohort="MacR36CohortDownlevel",e.MacR4Cohort="MacR4CohortDownlevel",e.EduCohort="EduCohortDownlevel",e.InternalRingCohort="InternalRingCohortDownlevel",e.ExternalTapCohort="ExternalTapCohortDownlevel",e.NoPPChannelCohort="NoPPChannelCohortDownlevel"}(s||(s={})),function(e){e.M365_BusinessBasic="M365_BusinessBasic",e.M365_BusinessStandard="M365_BusinessStandard",e.M365_BusinessPremium="M365_BusinessPremium",e.M365_BusinessApps="M365_BusinessApps",e.M365_BusinessEssentials="M365_BusinessEssentials"}(a||(a={}))},872177:(e,t,i)=>{"use strict";var n;i.d(t,{hO:()=>n,K$:()=>o,v4:()=>r,F_:()=>s,qF:()=>a}),function(e){e.POP="pop",e.BEARER="Bearer"}(n||(n={}));const o="https://api.spaces.skype.com",r="ForceFallbackToWebAuth",s="ForceReloadIfSkypeAuthFail";var a;!function(e){e.InteractionBanner="interactionBanner",e.Logout="logout",e.UpdateMostRecentUser="updateMostRecentUser"}(a||(a={}))},845279:(e,t,i)=>{"use strict";var n;i.d(t,{l:()=>n,Q:()=>o}),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ONLINE=1]="ONLINE",e[e.OFFLINE=0]="OFFLINE"}(n||(n={}));const o=["ChatSync","Presence","Files","OneNote","Groups","Video","MasterTab","IndexDb","AdalTokens","AdalLogin","AdalReauth","SkypeTokens","SkypeLicense","SupportedBrowser","MSAGuestLicense","AppSession","CSAStartup"]},246632:(e,t,i)=>{"use strict";i.d(t,{QC:()=>n,_1:()=>o,fl:()=>r,w8:()=>s,nx:()=>a});const n="cdl-worker-startup-status",o="cdl-worker-verbose-log",r="cdl-worker-aggregated-user-data",s="cdl-worker-aggregated-user-badge-data",a="cdl-worker-global-user-data"},238446:(e,t,i)=>{"use strict";var n;i.d(t,{B:()=>n}),function(e){e.Abandoned="Abandoned",e.AfterOnCommandReceived="AfterOnCommandReceived",e.AfterOnEventReceived="AfterOnEventReceived",e.AlreadyFocused="AlreadyFocused",e.ApplicationHookReceivedCommand="ApplicationHookReceivedCommand",e.ApplicationHookContinuedCommand="ApplicationHookContinuedCommand",e.BeforeOnCommandReceived="BeforeOnCommandReceived",e.BeforeOnEventReceived="BeforeOnEventReceived",e.Blanked="Blanked",e.ChunkLoadStarted="ChunkLoadStarted",e.ChunkLoadSucceeded="ChunkLoadSucceeded",e.Close="Close",e.CommandAfterGetAppViewEntitiesSucceeded="CommandAfterGetAppViewEntitiesSucceeded",e.CommandBeforeGetAppViewEntities="CommandBeforeGetAppViewEntities",e.CommandHandledByOnCommandReceived="CommandHandledByOnCommandReceived",e.CommandHandledPriorToResolution="CommandHandledPriorToResolution",e.CommandMetaDataAdded="CommandMetaDataAdded",e.CommandReceived="CommandReceived",e.CommandReportingTimedOut="CommandReportingTimedOut",e.CommandResolutionStarted="CommandResolutionStarted",e.CommandStart="CommandStart",e.DeeplinkReceived="DeeplinkReceived",e.DeeplinkParsed="DeeplinkParsed",e.DeeplinkParseByAppStarted="DeeplinkParseByAppStarted",e.DeeplinkParseByAppSucceeded="DeeplinkParseByAppSucceeded",e.DelegatedCommandReceived="DelegatedCommandReceived",e.EventBubbled="EventBubbled",e.EventHandled="EventHandled",e.Hidden="Hidden",e.IntentReceived="IntentReceived",e.IntentTransferredCrossCloud="IntentTransferredCrossCloud",e.OnBeforeIntentAuthenticatedStarted="OnBeforeIntentAuthenticatedStarted",e.OnBeforeIntentAuthenticatedCompleted="OnBeforeIntentAuthenticatedCompleted",e.OnLoadingScreenDisplayStarted="OnLoadingScreenDisplayStarted",e.OnLoadingScreenDisplayCompleted="OnLoadingScreenDisplayCompleted",e.WaitForUserContextStarted="WaitForUserContextStarted",e.WaitForUserContextCompleted="WaitForUserContextCompleted",e.WaitForUserContextFailed="WaitForUserContextFailed",e.OnAfterIntentAuthenticatedStarted="OnAfterIntentAuthenticatedStarted",e.OnAfterIntentAuthenticatedCompleted="OnAfterIntentAuthenticatedCompleted",e.IntentHookStarted="IntentHookStarted",e.IntentHookResolved="IntentHookResolved",e.IntentHookRejected="IntentHookRejected",e.IntentHookCompleted="IntentCompleted",e.IntentExecuted="IntentExecuted",e.Failure="Failure",e.Focus="Focus",e.Incomplete="Incomplete",e.LayoutRendered="LayoutRendered",e.LayoutRenderUpdated="LayoutRenderUpdated",e.NavigationCommandStart="NavigationCommandStart",e.NotHandled="NotHandled",e.Rendered="Rendered",e.RenderStarted="RenderStarted",e.ScenarioEventDataAppended="ScenarioEventDataAppended",e.ScenarioMarked="ScenarioMarked",e.SlotPhasedRenderingTimedOut="SlotPhasedRenderingTimedOut",e.Toggled="Toggled",e.UnmountStarted="UnmountStarted",e.WindowCreated="WindowCreated",e.WindowUpdated="WindowUpdated",e.WindowNotUpdated="WindowNotUpdated"}(n||(n={}))},342737:(e,t,i)=>{"use strict";var n;i.d(t,{P:()=>n}),function(e){e[e.Canceled=0]="Canceled",e[e.Failure=1]="Failure",e[e.Incomplete=2]="Incomplete",e[e.Success=3]="Success"}(n||(n={}))},218551:(e,t,i)=>{"use strict";var n,o,r;i.d(t,{yU:()=>n,FV:()=>o,c4:()=>r}),function(e){e.ActiveEntitiesResolved="active_entities_resolved",e.ActiveEntitiesDestroyed="active_entities_destroyed",e.AppSelectionChanged="app_selection_changed_resolved",e.ExperienceIdleStateChanged="experience_idle_state_changed",e.InitialDeeplinkResolved="initial_deep_link_resolved",e.NavigationIntentExecuted="navigation_intent_executed",e.UserAuthenticated="user_authenticated",e.UserConsentedToConsumeResources="user_consented_to_consume_resources",e.PreWarmJobsCompleted="pre_warm_jobs_completed",e.WindowWarmJobsCompleted="window_warm_jobs_completed",e.ExperienceWarmJobsCompleted="experience_warm_jobs_completed"}(n||(n={})),function(e){e.LayoutRenderComplete="layout_render_complete",e.LayoutRenderCancelled="layout_render_cancelled",e.WindowStateChange="window_state_change",e.WindowOptionsChange="window_options_change",e.IdleCallback="idle_callback"}(o||(o={})),function(e){e.Started="app_started",e.Initialized="app_initialized",e.ExperienceWarm="experience_warm",e.UserWarm="user_warm",e.ExperienceLongIdle="experience_long_idle",e.WindowWarm="window_warm",e.Idle="idle"}(r||(r={}))},661424:(e,t,i)=>{"use strict";var n,o;i.d(t,{E:()=>n,u:()=>o}),function(e){e.openInExplorer="openInExplorer"}(n||(n={})),function(e){e.quickReply="quickReply",e.unknown="unknown",e.view="view",e.toast="toast"}(o||(o={}))},766052:(e,t,i)=>{"use strict";var n,o;i.d(t,{U:()=>n,K:()=>o}),function(e){e[e.NoOverride=0]="NoOverride",e[e.OverrideCloud=1]="OverrideCloud",e[e.OverrideIntent=2]="OverrideIntent",e[e.OverrideUserContext=3]="OverrideUserContext",e[e.TerminateNavigation=4]="TerminateNavigation"}(n||(n={})),function(e){e[e.MainWindow=0]="MainWindow",e[e.SourceWindow=1]="SourceWindow",e[e.Other=2]="Other"}(o||(o={}))},699355:(e,t,i)=>{"use strict";i.d(t,{Hl:()=>n,n0:()=>o,fo:()=>r});const n=["/l/auth-callback","/convene/events","/convene/meet","/embed-client/chats","/l/app","/l/auth/google","/l/autoinstallnotification","/l/calendar/scheduling-form","/l/calendar/surface","/l/campaign/chat","/l/campaign/meeting","/l/channel-dashboard","/l/channel","/l/chat","/l/claim","/l/community/create-event","/l/community/events","/l/community/create-post","/l/community/create","/l/community/edit","/l/community/add-member","/l/community/invite","/l/community","/l/discover-teams","/l/entity","/l/file","/l/fileshare","/l/invite/","/l/lobnotifications","/l/manageApps","/l/manage-teams/myinvites","/l/meeting/new","/l/meeting/details","/l/meetingrecap","/l/meetup-join","/l/message","/l/meeting-share","/l/present","/l/share-email","/l/store","/l/task","/l/team-dashboard","/l/team","/l/trial/teamsPremiumLicenseRequest","/l/trial/teamsPremiumTrial","/l/teamsInsider","/meet","/notdefaultapp","/l/stage","/subscriptionmanagement","/l/copilot","/l/virtualevent/new","/l/virtualevent","/l/change-file-open-preference","/l/loopthread"];var o,r;!function(e){e.core="core",e.flyout="flyout",e.default="default"}(o||(o={})),function(e){e.mini="mini",e.main="main"}(r||(r={}))},220555:(e,t,i)=>{"use strict";i.d(t,{Jk:()=>s,UH:()=>a});var n=i(226964);const o=n.string.pipe(new n.Type("URL",(e=>e instanceof URL),((e,t)=>{try{return(0,n.success)(new URL(e))}catch(i){return(0,n.failure)(e,t)}}),(e=>e.href))),r=(0,n.union)([(0,n.literal)("NA"),o.pipe(new n.Type("GTM URL",(e=>e instanceof URL&&e.pathname.endsWith("/")),(e=>(e.pathname.endsWith("/")||(e.pathname+="/"),(0,n.success)(e))),n.identity))]),s=(0,n.partial)({isFreemium:n.boolean,isBasicLiveEventsEnabled:n.boolean,isAdvComms:n.boolean,isTranscriptEnabled:n.boolean,eduLicenseSkuAndCategory:(0,n.union)([n.string,n.nullType]),isCopilot:n.boolean,isM365CopilotBusinessChat:n.boolean,isTPProtection:n.boolean,isTPCustomization:n.boolean,isTPManagement:n.boolean,isTPWebinar:n.boolean,isTPVirtualAppointments:n.boolean,isInfoProtectionPremium:n.boolean,isTeamsPhonePremium:n.boolean,isTeamsSmb:n.boolean,isAvatarsEnabled:n.boolean,isImmersiveSpaceEnabled:n.boolean,isTeamsPremiumSelfAssigned:n.boolean,isTeamsSharedDevices:n.boolean,trialLicenseEndDate:n.string,hasOnlyTeamsSharedDevices:n.boolean,isTeamsDeviceManagementEnabled:n.boolean,experimentationTeamsAddOnPlans:(0,n.array)(n.string),experimentationTeamsLicenseCategories:(0,n.array)(n.string)}),a=(0,n.partial)({ams:r,amsV2:r,appMonetizationService:r,appsSuggestionService:r,appService:r,biometricService:r,chatService:r,chatServiceAfd:r,chatSvcAggAfd:r,teamsPushServiceAfd:r,cmdArtifactsService:r,groupsServiceV2:r,iC3LocationService:r,mcpService:r,middleTier:r,mtImageService:r,phonelinkSmsService:r,powerPointStateService:r,peopleProfileService:r,search:r,tdmService:r,teamsAndChannelsProvisioningService:r,teamsEventsIntegration:r,unifiedPresence:r,urlp:r,urlpV2:r,userProfileService:r,calling_trouterUrl:r,calling_registrarUrl:r,consumerLicenses:r,virtualEventsService:r,userIntelligenceService:r},"region Gtms")},793989:(e,t,i)=>{"use strict";var n;i.d(t,{vW:()=>n,o_:()=>o,Tf:()=>r}),function(e){e[e.Background=0]="Background",e[e.Macro=1]="Macro",e[e.MacroSequential=2]="MacroSequential",e[e.RenderBlocking=3]="RenderBlocking",e[e.UserVisible=4]="UserVisible"}(n||(n={}));const o=-1;var r;!function(e){e[e.None=0]="None",e[e.Canceled=1]="Canceled",e[e.Received=2]="Received",e[e.Started=3]="Started",e[e.Complete=4]="Complete"}(r||(r={}))},109062:(e,t,i)=>{"use strict";var n,o;i.d(t,{G:()=>n,T:()=>o}),function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online"}(n||(n={})),function(e){e.Offline="Offline",e.Online="Online",e.Unknown="Unknown",e.SuspectedOffline="Suspected Offline"}(o||(o={}))},328942:(e,t,i)=>{"use strict";var n,o;i.d(t,{Z:()=>n,d:()=>o}),function(e){e.AppUpdatedUsingServiceWorker="AppUpdatedUsingServiceWorker",e.AuthTokenForceRefresh="AuthTokenForceRefresh",e.ClearContainer="ClearContainer",e.CloudMismatchOnLogIn="CloudMismatchOnLogIn",e.ErrorPageReboot="ErrorPageReboot",e.ErrorPageSignOut="ErrorPageSignOut",e.RemoveAuthenticatedUser="RemoveAuthenticatedUser",e.RingSwitch="RingSwitch",e.LanguageSwitch="LanguageSwitch",e.HighMemory="HighMemory",e.TeamsInsiderSwitch="TeamsInsiderSwitch",e.SimpleCollabSwitch="SimpleCollabSwitch",e.VDIRestartWorkflow="VDIRestartWorkflow",e.ClientAccessPolicyAdminDisabled="ClientAccessPolicyAdminDisabled",e.ClientAccessPolicyUserAllowed="ClientAccessPolicyUserAllowed"}(n||(n={})),function(e){e.Auth="Auth",e.DeveloperSwitchersService="DeveloperSwitchersService",e.ReloadAppTask="ReloadAppTask",e.WebClientUpdateService="WebClientUpdateService",e.RemoveAuthenticatedUserResolver="RemoveAuthenticatedUserResolver",e.Core="Core",e.SimpleCollabSwitch="SimpleCollabSwitch",e.ClientAccessAdminPolicyCheckService="ClientAccessAdminPolicyCheckService"}(o||(o={}))},47580:(e,t,i)=>{"use strict";i.d(t,{i:()=>s});var n=i(740597),o=i(818997),r=i(132756);class s{constructor(e,t){this.id=e,this.name=r.Yg[e],this.dependencies=t}executeSafe(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=[];for(const t of this.dependencies)null==e[t]&&i.push(t);if(i.length>0)throw o.x.fromMissingDependencies(this.name,i);try{return yield this.execute(e,t)}catch(e){throw o.x.fromExecutionError(this.name,e)}}))}}},301767:(e,t,i)=>{"use strict";var n,o;i.d(t,{t:()=>n,z:()=>o}),function(e){e.core="core",e.window="window",e.mtmaCore="mtmaCore",e.mtmaUser="mtmaUser",e.mtmaWindow="mtmaWindow",e.viewSchema="viewSchema",e.embed="embed",e.cmd="cmd",e.other="other"}(n||(n={})),function(e){e.query="query",e.watchQuery="watchQuery",e.mutate="mutate",e.subscribe="subscribe",e.readQuery="readQuery",e.writeQuery="writeQuery",e.readFragment="readFragment",e.writeFragment="writeFragment"}(o||(o={}))},815306:(e,t,i)=>{"use strict";var n,o;i.d(t,{b:()=>n,i:()=>o}),function(e){e[e.SingleAccount=0]="SingleAccount",e[e.MultipleAccounts=1]="MultipleAccounts"}(n||(n={})),function(e){e[e.SingleCloud=0]="SingleCloud",e[e.MultiCloud=1]="MultiCloud"}(o||(o={}))},157867:(e,t,i)=>{"use strict";var n,o;i.d(t,{Q:()=>n,N:()=>o}),function(e){e.Unknown="unknown",e.Prod="prod"}(n||(n={})),function(e){e.MW="MW",e.Anglr="Anglr",e.ShareToTeams="ShareToTeams",e.Files="Files",e.Calendar="Calendar",e.MtgOpt="MtgOpt",e.EmbedClient="EmbedClient",e.LmsIntegration="LmsIntegration",e.CallingEmbed="CallingEmbed",e.ReactWebClient="ReactWebClient",e.Example="Example"}(o||(o={}))},719388:(e,t,i)=>{"use strict";i.d(t,{I:()=>o});const n="IntentPersistenceService";class o{constructor(e){this._localStorage=e}getAllStoredDeeplinks(){const e=this._localStorage.get(n,"Experience");return this.jsonParseSafe(e)||{}}storeDeeplink(e,t){const i=this.getAllStoredDeeplinks();i[e]=t.toString(),this.persist(i)}deleteDeeplink(e){const t=this.getAllStoredDeeplinks();delete t[e],this.persist(t)}clear(){this._localStorage.remove(n,"Experience")}persist(e){this._localStorage.trySet(n,JSON.stringify(e),"Framework","Experience")}jsonParseSafe(e){if(e)try{return JSON.parse(e)}catch(e){return}}}},793441:(e,t,i)=>{"use strict";i.d(t,{xm:()=>o,qf:()=>r,vu:()=>s,b3:()=>a,j:()=>d,sW:()=>u});var n=i(726727);const o="[Authentication][DiscoverV2]";var r,s,a,l,c;!function(e){e.userLocale="X-Client-UI-Language",e.skypeTokenAuthzTypeHeader="ms-teams-authz-type",e.claimsChallengeCapable="claimsChallengeCapable",e.consistencyValue="ConsistencyLevel"}(r||(r={})),function(e){e.skypeTokenRefresh="TokenRefresh",e.skypeTokenExplicitLogin="ExplicitLogin",e.strongConsistencyMsInternalUserSignup="MS-Internal-UserSignup",e.strongConsistencyDefaultValue="Organization;ScenarioId={id}"}(s||(s={})),function(e){e[e.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD=n.gT.Two*n.gT.SECONDS_PER_MINUTE*n.gT.MILLI_PER_SECOND]="DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD"}(a||(a={})),function(e){e.skypeAuthAnonReloadJoinLocation="skypeAuthAnonReloadJoinLocation",e.skypeAuthForceAnonReload="skypeAuthForceAnonReload"}(l||(l={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FIVE=5]="FIVE",e[e.TEN=10]="TEN",e[e.FIFTEEN=15]="FIFTEEN",e[e.SIXTEEN=16]="SIXTEEN",e[e.THIRTY=30]="THIRTY",e[e.TWO_HUNDRED_FIFTY_FIVE=255]="TWO_HUNDRED_FIFTY_FIVE"}(c||(c={}));const d={SKYPE_SEND_REQUEST:"skype_send_request",SKYPE_RECEIVED_RESPONSE:"skype_received_response",SKYPE_RECEIVED_SAME_TOKEN:"skype_received_same_token",SKYPE_SEND_REQUEST_DESKTOP:"skype_send_request_desktop",SKYPE_SEND_REQUEST_WORKER:"skype_send_request_worker",SKYPE_TOKEN_RECEIVED_WORKER:"skype_token_received_worker",RECEIVE_CLAIM:"receive_claim"},u="NA"},341830:(e,t,i)=>{"use strict";i.d(t,{bO:()=>E,BD:()=>x,r2:()=>A,db:()=>F,LO:()=>M,uc:()=>R,qW:()=>P,ut:()=>L,S9:()=>U,Z2:()=>W,Mu:()=>B,Qe:()=>$,br:()=>H,ZC:()=>q,wh:()=>z,nD:()=>G,TB:()=>J,wC:()=>K,WA:()=>Q,H:()=>Y,nd:()=>X,lm:()=>Z,UE:()=>te,lZ:()=>ie,l2:()=>ne,JY:()=>oe,nH:()=>re,qO:()=>se,Ll:()=>ce});var n=i(740597),o=i(132756),r=i(905581),s=i(974509),a=i(220555),l=i(50805),c=i(8122),d=i(455572),u=i(226964),m=i(535151),g=i(738646),h=i(466094),p=i(287474),v=i(804589),y=i(932289),f=i(928665),S=i(959078),k=i(588470),b=i(136613),w=i(726727),C=i(89062),_=i(448850),T=i(793441),I=i(659726),j=i(296249);const N=[o.jK.NetworkOffline,o.jK.Forbidden,o.jK.ProxyAuthenticationRequired],E={context:T.xm,subContext:"_getDiscoverResponse",errorCode:o.jK.NetworkOffline,message:"Network is offline, not making any call",isExpected:!0},x={context:T.xm,subContext:"_getDiscoverResponse",errorCode:v.SM.InteractionRequired,message:"Interaction is required to get a skype token, not making any call",isExpected:!0},A=(e,t,i)=>{let n;if(!i){const{response:t}=e;n=null==t?void 0:t.isExpected}let s=e;s.context||(s=(0,r.Jn)(e,o.w5.Discover,o.jK.InvalidResponse,"",{error:e.stack},e.message||("string"==typeof e?e:(0,C.u4)(e))));const{serverResponse:{status:a,body:l,headers:c={}}={},context:d}=s;let{reason:u,message:m,code:g=o.jK.InvalidResponse,subContext:h=""}=s;return u=c?Object.assign(Object.assign({},u),{responseCorrelationId:c["correlation-id"],innerError:s}):u,m=(null==l?void 0:l.message)||m,h=(null==l?void 0:l.errorCode)||d,g=t?D(a):o.jK.NetworkOffline,(0,r.Tr)(o.w5.Discover,g,h,Object.assign(Object.assign({},u),{innerError:e}),m,s.serverResponse,n)},D=e=>{if(void 0===e)return o.jK.InvalidResponse;switch(e){case s.qb.FORBIDDEN:return o.jK.Forbidden;case s.qb.NOT_AUTHORIZED:return o.jK.Unauthorized;case s.qb.PROXY_AUTHENTICATION_REQUIRED:return o.jK.ProxyAuthenticationRequired;default:return o.jK.FailedToFetch}},F=(e,t,i)=>{if(!e)throw t;const n=Object.assign(Object.assign({},t),{errorCode:t.code,reason:(0,C.u4)(t.reason)});return(0,y.ZG)(t)?e.incomplete(n):ee(t)||!i&&(null==t?void 0:t.isExpected)?e.cancel(n):e.fail(n),t.reason&&(t.reason.isExpectedError=ee(t)),t},O=(0,u.type)({skypeid:u.string}),M=((0,u.type)({skypeTokenData:(0,u.type)({regionGtms:a.UH,token:(0,u.type)({skypeToken:u.string,expiration:u.number,userDetails:(0,u.partial)({region:u.string})})})},"token"),(e,t)=>{if(!e)return t.error("Can not get userId due to skypeToken is undefined"),"";const{skypeid:i}=(0,m.as)(O,(0,_.J)(e));return`8:${i}`}),R=e=>{let t=e.findScenario(g.RG.GetSkypeToken);return t||(t=e.newScenario(g.RG.GetSkypeToken),t.mark("Non authz error scenario")),t},P=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=(0,f.pW)();null==i||i.push("fn:getuid");const o=yield e.getUser({correlation:{id:n,source:"discover-helper::getUserIdentifierForDiscover",scenarioName:g.RG.AuthWebUser}});if(null==i||i.push("user:"+ +!!o),null==o?void 0:o.isAuthenticated){t.log(`[_getUserIdentifier][${n}]user found by getUser call`);return(0,S.Xx)(o)}const r=`[_getUserIdentifier] ${o?`User is not authenticated. UserId: [${o.id}] tenantId: [${o.profile.tid}]`:"user missing"}. ${null==i?void 0:i.join(";")}`;throw(0,y.Tr)({context:T.xm,subContext:"_getUserIdentifier",errorCode:o?v.SM.UserNotAuthenticated:v.SM.UserNotFoundError,isExpected:!0,message:r,correlationId:null!=n?n:(0,f.pW)()})})),L=(e,t,i,o,r,s,a,l,c)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){k.Jt.put(B(e),t.userDetails),null==i||i.push("userDetails:1"),yield(0,j.u)(t,a,s,l,c),k.Jt.put(W(e),t),null==i||i.push("skypeToken:1");const n=null==t?void 0:t.regionGtms;n&&(0,C.u4)(n).length>w.lP.DEFAULT_REGION_GTM_MIN_LENGTH?(k.Jt.put(U(e),n),null==i||i.push("regionGtms:1")):(null==i||i.push("regionGtms:-1"),r.error(`[_getDiscoverResponse][${o}] RegionGtm is missing in response, not able to cache.`))})),U=e=>({user:e,typeName:"Discover",key:v.op}),W=e=>({user:e,typeName:"Discover",key:v.rz}),B=e=>({user:e,typeName:"Discover",key:v.ru}),$=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,o;const r=Date.now(),{regionGtms:s,licenseDetails:a,skypeToken:l,tokens:c,region:d,regionOverride:u,regionSettings:m,skypeGuestUserToken:g,consumerLicenseDetails:h,userRegion:p,partition:v,userPartition:y}=yield e.body.json();null===(n=t.eventData)||void 0===n||n.push("parsejson:1");const f=l||c||g,S=null!==(o=null==f?void 0:f.skypeToken)&&void 0!==o?o:null==f?void 0:f.skypetoken;let k;return i.log(`[_acquireSkypeTokenWeb][${null==t?void 0:t.correlationId}] Response parsed succeed.`),h&&(k={timeStamp:new Date(r),consumerLicenseDetails:h}),{userId:M(S,i),regionGtms:s,licenseDetails:a,skypeToken:S,expires:new Date(r+(null==f?void 0:f.expiresIn)*w.gT.MILLI_PER_SECOND),region:d,userRegion:p,partition:v,userPartition:y,regionOverride:u,regionSettings:m,consumerLicenseDetails:k}})),H=(e,t,i)=>{if(e.push("fn:_getUserDetailFromHost"),!t)return void e.push("_bootstrapData:0");const{userId:n,region:o,licenseDetails:r,userRegion:s,partition:a,userPartition:l}=t;return n&&o&&r?{id:n,licenseDetails:r,region:o,userRegion:s,partition:a,userPartition:l}:(i.log(`[_getUserDetailFromHost] userId:${!!n}|region:${!!o}|licenseDetails:${!!r}|userRegionForMultiGeo:${!!s}|partition${!!a}|userPartition${!!l}`),void e.push(`userId:${!!n}|region:${!!o}|licenseDetails:${!!r}|userRegionForMultiGeo:${!!s}|partition${!!a}|userPartition${!!l}`))},q=(e,t)=>{var i;const n=M(e.skypeToken,t);return t.log(`[convertResponseToISkypeToken] Skypeid received from discovery. Region: ${null==e?void 0:e.region}`),{skypeToken:null==e?void 0:e.skypeToken,expiration:null===(i=null==e?void 0:e.expires)||void 0===i?void 0:i.getTime(),regionGtms:null==e?void 0:e.regionGtms,userDetails:{id:n,licenseDetails:Object.assign(Object.assign({},null==e?void 0:e.licenseDetails),{consumerLicenseDetails:null==e?void 0:e.consumerLicenseDetails}),region:null==e?void 0:e.region,userRegion:null==e?void 0:e.userRegion,partition:null==e?void 0:e.partition,userPartition:null==e?void 0:e.userPartition,regionOverride:null==e?void 0:e.regionOverride,regionSettings:null==e?void 0:e.regionSettings}}},z=(e,t,i,n,o)=>{const{skypeTokenValidationDisabled:r}=i.get(l.J.Auth),s=i.get(l.J.Host).skypeTokenValidationDisabled,a=r||s;return a&&V(e,t,n,o),!!a},V=(e,t,i,n)=>{if(t){i.log(`Skype token validation skipped. forceRenew:${e};isTokenSame:${t}`);const o=n.newScenario(g.RG.SkypeTokenValidationSkipped);o.appendEventData({message:`forceRenew:${e};isTokenSame:${t}`}),o.stop()}},G=(e,t,i)=>{var n;if(!(0,S.FG)(e.userIdentifier,(0,S.Xx)(t)))throw null===(n=e.eventData)||void 0===n||n.push("userMismatch"),i.warn("[_acquireSkypeTokenWeb] user obtained does not match provided userIdentifier, throw error."),(0,y.Tr)({context:T.xm,subContext:"_acquireSkypeTokenWeb",errorCode:v.SM.UserNotFoundError,message:"User obtained does not match provided userIdentifier.",correlationId:e.correlationId,isExpected:!0})},J=(e,t,i,n,o,r)=>{const{authOverrides:s}=i.get(l.J.Host),{authzEndpointUrl:a,authzUrl:d,regionGtmsEnv:u}=i.get(l.J.Auth),m=((e,t,i,n,o)=>{const{environment:r}=(null==n?void 0:n.get(l.J.Metadata))||{},{doNotPassTenantIdForAnonMeetingJoins:s}=(null==n?void 0:n.get(l.J.Calling))||{};let a={method:"POST",url:i?`${e}?region_gtms_env=${i}`:`${e}`,serviceName:c.E.Auth,apiName:"acquireSkypeTokenWeb"};if("Anonymous"===t.role)if(t.subType===h.Yf.Ccm){const e=ae(t);if(!e)throw(0,y.Tr)({context:"Authentication",subContext:"DiscoverHelper::getRequestConfig",errorCode:"MeetingDetailsNotFound",message:"No meetingUrl present for CCM user",correlationId:o,isExpected:!1});a=Object.assign(Object.assign({},a),{body:`{"meetingURL": "${e}"}`})}else a=s?Object.assign(Object.assign({},a),{url:`${e}/visitor`}):Object.assign(Object.assign({},a),{url:`${e}/visitor`,body:`{"tenantId": "${t.profile.tid}"}`});return r!==p.s_.life||"Guest"!==t.role&&"Anonymous"!==t.role||(a=Object.assign(Object.assign({},a),{url:`${e}/guest${i?`?region_gtms_env=${i}`:""}`})),a})((null==s?void 0:s.authzEndpointUrl)||a||d||v.ej.AUTHZ_DEFAULT_BASE_URL,e,u,i,t);return n.log(`[_getFormatRequest][${t}] Request formatted. `),m.headers=((e,t,i,n)=>{const o={},r=null==t?void 0:t.locale,{disableClaimsChallenge:s,enableSTMHeaderForAuthZ:a}=i.get(l.J.Auth);return r&&(o[T.qf.userLocale]=r),s||(o[T.qf.claimsChallengeCapable]="true"),a&&(o["X-MS-Migration"]="True"),o.clientRequestId=e,o["x-ms-skip-phone"]="true",void 0!==n&&(o["ms-teams-authz-type"]=n?T.vu.skypeTokenRefresh:T.vu.skypeTokenExplicitLogin),o})(t,o,i,r),m},K=(e,t)=>{var i;const n=le(e.licenseDetails,t);return Object.assign({id:e.id,region:e.region,userRegion:e.userRegion||void 0,partition:e.partition||void 0,userPartition:e.userPartition||void 0,tenant:{type:(null===(i=e.licenseDetails)||void 0===i?void 0:i.isFreemium)?d.OV.Freemium:d.OV.Work}},n)},Q=(e,t,i)=>{"object"==typeof e&&(e.context=e.context||T.xm,e.subContext=e.subContext||t,e.correlationId=e.correlationId||i)},Y=(e,t,i,n,o)=>{const r=`${null==e?void 0:e.subContext}: Failed to get skype token; correlationId:${e.correlationId}, status:${o}, message:${t}, eventData: ${null==i?void 0:i.join(";")}`;return e.isExpected?n.debug(r):n.error(r),e},X=(e,t,i)=>{const n=null==e?void 0:e.join(";"),o=(null==i?void 0:i.get(l.J.Metadata))||{},r=i.get(l.J.Auth);return{message:`${n}::isOnline-${t}::environment:${null==o?void 0:o.environment}`,endpointUrl:null==r?void 0:r.authzUrl,resource:null==r?void 0:r.authzResource}},Z=(e,t,i,n,r,a)=>{var c,d;const{serverResponse:{status:u,body:m}={}}=e;let{message:g,errorCode:h}=e;const{reason:p,code:v}=e,f=i&&!(e.context===o.w5.RejectHttpError&&v===o.jK.RemoteOperationFailed),S=null==t?void 0:t.join(";");u&&(h=D(u),g=m.message);const k={reason:p,message:g,eventData:S},b=(0,I.A)((0,C.u4)(k)),w=e.correlationId,_=(null==a?void 0:a.get(l.J.Metadata))||{},j=a.get(l.J.Auth);void 0===e.isExpected&&(e.isExpected=!f||N.indexOf(h)>-1);const E={context:null!==(c=null==e?void 0:e.context)&&void 0!==c?c:T.xm,subContext:null==e?void 0:e.subContext,message:`${g}::isOnline-${f}::env:${null==_?void 0:_.environment}`,errorCode:f?null!=h?h:v:o.jK.NetworkOffline,statusCode:u,correlationId:w,reason:b,endpointUrl:null==j?void 0:j.authzUrl,resource:null==j?void 0:j.authzResource,isExpected:!f||e.isExpected};if(!((null===(d=(0,C.u4)(e.reason))||void 0===d?void 0:d.indexOf("LoggedAlready"))>-1)&&n){let t=((e,t,i)=>{const{errorCode:n,code:r}=t;if(!e||t.isExpected||i===s.qb.FORBIDDEN||i===s.qb.PROXY_AUTHENTICATION_REQUIRED||n===o.jK.NetworkOffline||r===o.jK.NetworkOffline)return"cancel";if(n===o.jK.TimedOut||r===o.jK.TimedOut)return"incomplete";switch(i){case s.qb.NOT_AUTHORIZED:case-1:case s.qb.THROTTLED:return"incomplete";default:return"fail"}})(f,e,u);switch(t=(0,y.ZG)(e)?"incomplete":t,t){case"stop":n.stop(E);break;case"incomplete":n.incomplete(E);break;case"cancel":n.cancel(E);break;default:n.fail(E)}}return Y(e,g,t,r,u)};function ee(e){return N.indexOf(e.code)>-1||"Authentication::getUser"===e.subContext&&e.message.indexOf("User information is not available")>-1||e.message.indexOf("getUser: MSAL account not found")>-1||e.message.indexOf("Get skype token promise timed out, keep retrying. Is expected:true")>-1}function te(e,t,i,n){return t.getUser().then((()=>{const o=oe(n),{requireSkypetokenForMT:r}=n.get(l.J.Auth),s=t.authorize(e,o);return r?i.authorize(s,"x-skypetoken"):s}))}function ie(e,t,i){return t.getUser().then((()=>{const n=oe(i);return t.authorize(e,n)}))}function ne(e,t,i){return t.getUser().then((()=>{const{cmdMeetingArtifactsServiceResource:n}=i.get(l.J.CMDMeetingArtifactsService);return t.authorize(e,null!=n?n:"")}))}function oe(e){const{isRunningGlassjar:t,mtAuthResourceOverride:i}=e.get(l.J.Test);if(t&&i)return i;const{authOverrides:n}=e.get(l.J.Host),{mtResource:o}=e.get(l.J.Auth);return(null==n?void 0:n.mtResource)||o||p.O_.MT}const re=(e,t,i,n,o)=>{var r,s,a,c,u,m,g,h,v;if(!e)return void n.log("Failed to obtain telemetry details from discovery.");if(!i)return void n.log("Failed to obtain telemetry provider from getTelemetryProviderInstance.");const y=null===(r=e.licenseDetails)||void 0===r?void 0:r.isFreemium,{environment:f}=t.get(l.J.Metadata);((null===(s=e.licenseDetails)||void 0===s?void 0:s.experimentationTeamsLicenseCategories)||(null===(a=e.licenseDetails)||void 0===a?void 0:a.experimentationTeamsAddOnPlans))&&o.getUser().then((t=>{var n,o;i.setContext("UserInfo.ExpTeamsLicense",null===(n=e.licenseDetails)||void 0===n?void 0:n.experimentationTeamsLicenseCategories,void 0,t.profile.oid),i.setContext("UserInfo.ExpTeamsAddOnPlan",null===(o=e.licenseDetails)||void 0===o?void 0:o.experimentationTeamsAddOnPlans,void 0,t.profile.oid)})).catch((e=>n.error("Failed to get Oid from User Profile",e)));const S=f===p.s_.life?d.OV.Life:y?d.OV.Freemium:d.OV.Work;if(f===p.s_.life&&y&&n.warn("The Environment indicates TFL, but Freemium is true - defaulting telemetry to TFL Tenant.Model"),i.setContext("UserInfo.Region",e.region),i.setContext("Tenant.Model",S),null===(c=e.consumerLicenseDetails)||void 0===c?void 0:c.consumerLicenseDetails){const t=null===(g=null===(m=null===(u=e.consumerLicenseDetails)||void 0===u?void 0:u.consumerLicenseDetails)||void 0===m?void 0:m.licensedProducts)||void 0===g?void 0:g.map((e=>e.skuName)).sort().join(",");i.setContext("UserInfo.IsLicensed",!!(null===(v=null===(h=e.consumerLicenseDetails)||void 0===h?void 0:h.consumerLicenseDetails)||void 0===v?void 0:v.hasTeamsLicense)),i.setContext("UserInfo.Licenses",t)}},se=(e,t,i,o,r)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const{disableClaimsChallenge:n}=o.get(l.J.Auth);if(n)r.log("[unauthorizedErrorHandler] Claims challenge handling disabled.");else if(e)if(t)k.Jt.deleteType(t,"Token");else{const e=yield i.getUser();k.Jt.deleteType((0,S.Xx)(e),"Token")}else r.log("[unauthorizedErrorHandler] No header passed in.")})),ae=e=>{const t=k.Jt.getValue((0,b.VF)((0,S.Xx)(e)).meetingDetails);if(!t)return;const{messageId:i,conversationId:n,tenantId:o,rootMessageId:r}=t;return i===r?`${o}${n}${i}`:`${o}${n}${i}${r}`},le=(e,t)=>({isAdvComms:(null==e?void 0:e.isAdvComms)||!1,isTranscriptEnabled:(null==e?void 0:e.isTranscriptEnabled)||!1,isFreemium:(null==e?void 0:e.isFreemium)||!1,isTrial:(null==e?void 0:e.isTrial)||!1,isWebinarEnabled:(null==e?void 0:e.isWebinarEnabled)||!1,isPrivacyDataControlEnabled:(null==e?void 0:e.isPrivacyDataControlEnabled)||!1,eduLicenseSkuAndCategory:(null==e?void 0:e.eduLicenseSkuAndCategory)||void 0,isBasicLiveEventsEnabled:(null==e?void 0:e.isBasicLiveEventsEnabled)||!1,isCopilot:(null==e?void 0:e.isCopilot)||!1,isM365CopilotBusinessChat:(null==e?void 0:e.isM365CopilotBusinessChat)||!1,isTPProtection:(null==e?void 0:e.isTPProtection)||!1,isTPCustomization:(null==e?void 0:e.isTPCustomization)||!1,isTPManagement:(null==e?void 0:e.isTPManagement)||!1,isTPWebinar:(null==e?void 0:e.isTPWebinar)||!1,isTPVirtualAppointments:(null==e?void 0:e.isTPVirtualAppointments)||!1,isInfoProtectionPremium:(null==e?void 0:e.isInfoProtectionPremium)||!1,isTeamsPhonePremium:(null==e?void 0:e.isTeamsPhonePremium)||!1,isTeamsSmb:(null==e?void 0:e.isTeamsSmb)||!1,isAvatarsEnabled:(null==e?void 0:e.isAvatarsEnabled)||!1,isImmersiveSpacesEnabled:(null==e?void 0:e.isImmersiveSpacesEnabled)||!1,isTeamsPremiumSelfAssigned:(null==e?void 0:e.isTeamsPremiumSelfAssigned)||!1,isTeamsSharedDevices:(null==e?void 0:e.isTeamsSharedDevices)||!1,trialLicenseEndDate:ce(null==e?void 0:e.trialLicenseEndDate,t),hasOnlyTeamsSharedDevices:(null==e?void 0:e.hasOnlyTeamsSharedDevices)||!1,isTeamsDeviceManagementEnabled:(null==e?void 0:e.isTeamsDeviceManagementEnabled)||!1}),ce=(e,t)=>{try{if(e&&!isNaN(Date.parse(e)))return new Date(e)}catch(e){t.log("Failed to parse date string from license details")}}},296249:(e,t,i)=>{"use strict";i.d(t,{u:()=>u,p:()=>m});var n=i(740597),o=i(535059),r=i(942209),s=i(588470),a=i(136613),l=i(50805),c=i(738646),d=i(804589);function u(e,t,i,s,a){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{enableSkypeTokenEncryption:n,enableEncryptionKeyMaglev:u}=a.get(l.J.Auth);if(!n)return e;const m=i.newScenario(c.RG.AuthWebEncryptToken);m.mark("auth_web_encrypt_token_start");const g=yield(0,o.mM)(t,s,void 0,!!u);if(!g)return m.mark("auth_web_encrypt_token_stop",{reason:"tokenEncryption:MissingEncryptionKey"}),m.stop(),e;try{const i=t.crypto.getRandomValues(new Uint8Array(d.uI.SIXTEEN)),n=(new TextEncoder).encode(e.skypeToken),o=yield t.crypto.subtle.encrypt({name:"AES-CBC",iv:i},g,n);e.encryptedToken=(0,r.z)(o),e.iv=(0,r.z)(i),m.mark("auth_web_encrypt_token_stop",{reason:"tokenEncryption:success"}),m.stop()}catch(e){m.mark("auth_web_encrypt_token_stop",{error:e,reason:null==e?void 0:e.message},"failure"),m.fail()}return e}))}function m(e,t,i,d,u){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{enableSkypeTokenEncryption:n,enableEncryptionKeyMaglev:m}=u.get(l.J.Auth);if(!n||!e.encryptedToken||e.skypeToken)return e;const g=i.newScenario(c.RG.AuthWebDecryptToken);g.mark("auth_web_decrypt_token_start");const h=yield(0,o.mM)(t,d,void 0,!!m);if(!h)return g.mark("auth_web_decrypt_token_stop",{reason:"Missing encryption key for decryption"}),g.stop(),e;let p=e.iv;if(p||(p=s.Jt.getValue(a.Jl.initializationVector)),!p)return g.mark("auth_web_decrypt_token_stop",{reason:"Missing initialization vector for decryption"}),g.stop(),e;try{const i=(0,r.k)(p),n=(0,r.k)(e.encryptedToken),o=yield t.crypto.subtle.decrypt({name:"AES-CBC",iv:i},h,n);e.skypeToken=(new TextDecoder).decode(o),g.mark("auth_web_decrypt_token_stop"),g.stop()}catch(e){g.mark("auth_web_decrypt_token_stop",{error:e,reason:null==e?void 0:e.message},"failure"),g.fail()}return e}))}},916836:(e,t,i)=>{"use strict";i.d(t,{Jq:()=>V});var n=i(740597),o=i(220555),r=i(50805),s=i(455572),a=i(656690),l=i(8122),c=i(466094),d=i(974509),u=i(738646),m=i(400871),g=i(448850),h=i(89062),p=i(765923),v=i(683470),y=i(38023),f=i(366758),S=i(726727),k=i(793441),b=i(341830),w=i(223076);const C=(e,t)=>e.decode(t).getOrElseL((e=>{throw new TypeError((0,w.Rn)(e).join("\n"))}));var _=i(226964),T=i(535151),I=i(905581),j=i(132756),N=i(781662);const E=(0,_.partial)({isNotificationEnabled:_.boolean,isUnifiedPresenceEnabled:_.boolean,isOutOfOfficeIntegrationEnabled:_.boolean,isContactMigrationEnabled:_.boolean,isAppsDiscoveryEnabled:_.boolean,isFederationEnabled:_.boolean}),x=(0,_.partial)({licenseDetails:o.Jk}),A=(0,_.partial)({regionSettings:E}),D=(0,_.partial)({userRegion:_.string}),F=(0,_.partial)({partition:_.string}),O=(0,_.partial)({userPartition:_.string}),M=(0,_.intersection)([(0,_.type)({region:_.string,regionGtms:o.UH,tokens:(0,_.type)({skypeToken:_.string,expiresIn:_.number})}),(0,_.intersection)([A,x,D,F,O])]),R=(0,_.type)({skuId:_.string,skuName:_.string,maxMeetingDurationMinutes:_.number,maxMeetingParticipants:_.number}),P=(0,_.intersection)([(0,_.type)({hasTeamsLicense:_.boolean}),(0,_.partial)({teamsFree:(0,_.type)({maxMeetingDurationMinutes:_.number,maxMeetingParticipants:_.number}),licensedProducts:(0,_.array)(R)})]),L=(0,_.partial)({consumerLicenseDetails:P}),U=(0,_.intersection)([(0,_.type)({regionGtms:o.UH,skypeToken:(0,_.type)({skypetoken:_.string,expiresIn:_.number})}),L,x]),W=(0,_.type)({skypeTokenData:(0,_.type)({regionGtms:o.UH,token:(0,_.type)({skypeToken:_.string,expiration:_.number,userDetails:(0,_.partial)({region:_.string})})})},"token"),B=(0,_.type)({skypeid:_.string}),$=1e3,H="Discover",q="https://api.spaces.skype.com";function z(e){return v.getParser(e.navigator.userAgent).isBrowser("ie",!0)}class V{constructor(e,t,i,u,g,h,v,f,k,b,w,_=(0,p.J)()){var T,I;this.aad=e,this.coreSettings=u,this.scenarioFactory=g,this.isOnline=h,this.shouldNotDecodeTokenForIE=v,this.onDiscoverSuccess=f,this.onDiscoverFail=k,this.isCDLWorker=b,this.cdlAuthClient=w,this.globalScope=_,this._localStorageKeys=[],this.licenseTypeToTenantType=e=>e?s.OV.Freemium:s.OV.Work,this._canGetSkypeTokenFromHost=()=>!!this.bootstrapData,this._acquireSkypeTokenWorker=(e=!1)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var t,i;if(!this.cdlAuthClient)return Promise.reject("CDL worker auth client unavailable");try{const t=yield this.cdlAuthClient.getSkypeToken(e);return Object.assign(Object.assign({},t.userDetails),{skypeToken:t.skypeToken,regionGtms:C(o.UH,t.regionGtms),expires:new Date(t.expiration)})}catch(e){throw(null===(t=e.response)||void 0===t?void 0:t.serverResponse)&&(e.serverResponse=e.response.serverResponse),e.context=null!==(i=e.context)&&void 0!==i?i:H,e}})),this._acquireRegionGtmTableWorker=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;if(!(null===(e=this.cdlAuthClient)||void 0===e?void 0:e.getRegionGtmTable))return this.logger.log("cdl getRegionGtmTable not implemented"),Promise.resolve(void 0);const t=yield this.cdlAuthClient.getRegionGtmTable();return t?C(o.UH,t):(this.logger.log("cdl getRegionGtmTable did not get the table"),Promise.resolve(void 0))})),this._acquireUserDetailsWorker=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!this.cdlAuthClient)return Promise.reject("CDL worker auth client unavailable");const e=yield this.cdlAuthClient.getUserDetails();return this._mapUserDetailsToUser(e.id,e.userDetails)})),this._acquireSkypeTokenDesktop=()=>this.globalScope.opener.requestMessage(a.rY.GetStateData,{requestType:"skypeToken",timeout:S.lP.ACQUIRE_TOKEN_TIMEOUT}).then((e=>C(W,e))).then((({skypeTokenData:{regionGtms:e,token:{skypeToken:t,expiration:i,userDetails:n}}})=>Object.assign(Object.assign({},n),{skypeToken:t,regionGtms:e,expires:new Date(i)}))),this._acquireSkypeTokenWeb=()=>{const e=Date.now(),{authOverrides:t}=this.coreSettings.get(r.J.Host),{authzEndpointUrl:i,authzUrl:n,regionGtmsEnv:o}=this.coreSettings.get(r.J.Auth),{doNotPassTenantIdForAnonMeetingJoins:s}=this.coreSettings.get(r.J.Calling)||{},a=(null==t?void 0:t.authzEndpointUrl)||i||n||"https://authsvc.teams.microsoft.com/v1.0/authz";return this.aad.getUser().then((t=>{const i=this.getResponseFromLocalStorage(t.profile.oid,t.profile.tid);if(i)return i;let n={method:"POST",url:o?`${a}?region_gtms_env=${o}`:`${a}`,serviceName:l.E.Auth,apiName:"acquireSkypeTokenWeb"};if(t.role===c.w4.Anonymous&&(n=s?Object.assign(Object.assign({},n),{url:`${a}/visitor`}):Object.assign(Object.assign({},n),{url:`${a}/visitor`,body:`{"tenantId": "${t.profile.tid}"}`})),z(this.globalScope)&&this.shouldNotDecodeTokenForIE)return this.send().then((t=>t(n).then((({body:e})=>e.json())).then((t=>Object.assign(Object.assign({},t),{tokens:Object.assign(Object.assign({},t.tokens),{expires:new Date(e+t.tokens.expiresIn*$)})})))));{const i=this.send().then((e=>e(n).then((({body:e})=>e.json())))),o=t.type===c.Ch.MsaLife;return this.parseAuthzResponse(i,o,e)}}))},this.logger=t.newLogger("Discover","core-services-discover"),this.send=()=>function(e,t,i){return t.getUser().then((()=>{const{authzResource:n}=i.get(r.J.Auth);return t.authorize(e,n||q)}))}(i,e,this.coreSettings).then((e=>(0,m.B)(e,d.qb.OK))),this._skypeToken=new y.X(null),this.bootstrapData=this.coreSettings.get(r.J.Host).authBootstrapData,this.telemetryProvider=(0,N.G)(),null===(I=null===(T=e.observeMiddleTierToken)||void 0===T?void 0:T.call(e))||void 0===I||I.subscribe((e=>{void 0===e&&(this._discoveryResponse=void 0)}))}observeSkypeToken(){return this._skypeToken.pipe((0,f.h)((e=>null!==e)))}shouldThrowErrorIfSkypeTokenIsEmpty(){return!this.coreSettings.get(r.J.Auth).disableThrowingErrorIfSkypeTokenIsEmpty}getSettingToDisableSkypeTokenValidation(e,t){return(0,b.wh)(e,t,this.coreSettings,this.logger,this.scenarioFactory)}shouldSkipTokenRefreshForAnon(){return!this.coreSettings.get(r.J.Auth).disableSkipTokenRefreshForAnon}regionGtm(e){return z(this.globalScope)&&this.shouldNotDecodeTokenForIE?this.getDiscovery().then((t=>{let i=t.regionGtms[e];if(i)return i===k.sW||i.endsWith("/")||(i+="/"),i;throw(0,I.Tr)(H,j.jK.InvalidResponse,"regionGtm")})):this._getRegionGtmTable().then((e=>({regionGtms:e}))).catch((e=>{var t;if(this._canGetSkypeTokenFromHost()){return{regionGtms:C(o.UH,null===(t=this.bootstrapData)||void 0===t?void 0:t.regionGtms)}}throw e})).then((({regionGtms:{[e]:t}})=>{if(void 0===t)throw(0,I.Tr)(H,j.jK.InvalidResponse,"regionGtm",{},`${H}::regionGtm::${j.jK.InvalidResponse} - ${e} is missing in discover response`);return t===k.sW?t:t.href}))}skypeid(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.getUser();return new Promise((t=>t(e.id)))}))}getRegion(){return this.getDiscovery().then((({region:e})=>e)).catch((e=>{var t;if(this._canGetSkypeTokenFromHost()){const e=null===(t=this.bootstrapData)||void 0===t?void 0:t.region;if(!e)throw(0,I.Tr)(H,j.jK.InvalidResponse,"getRegion");return e}throw e}))}getUserRegionAndPartitionForMultiGeo(){return this.getDiscovery().then((({userRegion:e,userPartition:t,partition:i})=>({userRegion:e,userPartition:t,partition:i}))).catch((e=>{var t,i,n;if(this._canGetSkypeTokenFromHost()){const e=null===(t=this.bootstrapData)||void 0===t?void 0:t.userRegion,o=null===(i=this.bootstrapData)||void 0===i?void 0:i.userPartition,r=null===(n=this.bootstrapData)||void 0===n?void 0:n.partition;if(!e||!o||!r)throw(0,I.Tr)(H,j.jK.InvalidResponse,"getUserRegionAndPartitionForMultiGeo");return{userRegion:e,userPartition:o,partition:r}}throw e}))}getUser(){var e,t;let i;if(this._canGetSkypeTokenFromHost()){const i=null===(e=this.bootstrapData)||void 0===e?void 0:e.userId,n=null===(t=this.bootstrapData)||void 0===t?void 0:t.region;if(i)return this.logger.log(`skypeid and region received from host: ${i} ${n}`),Promise.resolve(this._mapHostSkypeTokenToUser(i,n||void 0));this.logger.warn("skypeid or region was not received from host when expected")}return this.isCDLWorker?this._acquireUserDetailsWorker():this.getSkypeTokenInfoFromDiscoveryResponse().then((e=>{var t,n,o,r,s,a,l,c,d,u,m,g,h,p,v,y,f,S,k,w,C,_,T,I,j;return i={id:e.userDetails.id,region:e.userDetails.region,userRegion:e.userDetails.userRegion||void 0,partition:e.userDetails.partition||void 0,userPartition:e.userDetails.userPartition||void 0,tenant:{type:this.licenseTypeToTenantType(null===(t=e.userDetails.licenseDetails)||void 0===t?void 0:t.isFreemium)},isAdvComms:null===(n=e.userDetails.licenseDetails)||void 0===n?void 0:n.isAdvComms,isTranscriptEnabled:null===(o=e.userDetails.licenseDetails)||void 0===o?void 0:o.isTranscriptEnabled,isFreemium:(null===(r=e.userDetails.licenseDetails)||void 0===r?void 0:r.isFreemium)||!1,isTrial:(null===(s=e.userDetails.licenseDetails)||void 0===s?void 0:s.isTrial)||!1,isWebinarEnabled:(null===(a=e.userDetails.licenseDetails)||void 0===a?void 0:a.isWebinarEnabled)||!1,isBasicLiveEventsEnabled:(null===(l=e.userDetails.licenseDetails)||void 0===l?void 0:l.isBasicLiveEventsEnabled)||!1,eduLicenseSkuAndCategory:(null===(c=e.userDetails.licenseDetails)||void 0===c?void 0:c.eduLicenseSkuAndCategory)||void 0,isCopilot:(null===(d=e.userDetails.licenseDetails)||void 0===d?void 0:d.isCopilot)||!1,isM365CopilotBusinessChat:(null===(u=e.userDetails.licenseDetails)||void 0===u?void 0:u.isM365CopilotBusinessChat)||!1,isTPProtection:(null===(m=e.userDetails.licenseDetails)||void 0===m?void 0:m.isTPProtection)||!1,isTPCustomization:(null===(g=e.userDetails.licenseDetails)||void 0===g?void 0:g.isTPCustomization)||!1,isTPManagement:(null===(h=e.userDetails.licenseDetails)||void 0===h?void 0:h.isTPManagement)||!1,isTPWebinar:(null===(p=e.userDetails.licenseDetails)||void 0===p?void 0:p.isTPWebinar)||!1,isTPVirtualAppointments:(null===(v=e.userDetails.licenseDetails)||void 0===v?void 0:v.isTPVirtualAppointments)||!1,isInfoProtectionPremium:(null===(y=e.userDetails.licenseDetails)||void 0===y?void 0:y.isInfoProtectionPremium)||!1,isTeamsPhonePremium:(null===(f=e.userDetails.licenseDetails)||void 0===f?void 0:f.isTeamsPhonePremium)||!1,isTeamsSmb:(null===(S=e.userDetails.licenseDetails)||void 0===S?void 0:S.isTeamsSmb)||!1,isAvatarsEnabled:(null===(k=e.userDetails.licenseDetails)||void 0===k?void 0:k.isAvatarsEnabled)||!1,isImmersiveSpacesEnabled:(null===(w=e.userDetails.licenseDetails)||void 0===w?void 0:w.isImmersiveSpacesEnabled)||!1,isTeamsPremiumSelfAssigned:(null===(C=e.userDetails.licenseDetails)||void 0===C?void 0:C.isTeamsPremiumSelfAssigned)||!1,isTeamsSharedDevices:(null===(_=e.userDetails.licenseDetails)||void 0===_?void 0:_.isTeamsSharedDevices)||!1,trialLicenseEndDate:(0,b.Ll)(null===(T=e.userDetails.licenseDetails)||void 0===T?void 0:T.trialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:(null===(I=e.userDetails.licenseDetails)||void 0===I?void 0:I.hasOnlyTeamsSharedDevices)||!1,isTeamsDeviceManagementEnabled:(null===(j=e.userDetails.licenseDetails)||void 0===j?void 0:j.isTeamsDeviceManagementEnabled)||!1},i}))}validateSkypeToken(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return(yield this.validateSkypeTokenV2(e)).skypeToken}))}validateSkypeTokenV2(e){const t=this.getDiscovery(),i=null==e?void 0:e.forceRenew,n=null==e?void 0:e.invalidSkypeToken;return t.then((({expires:e,skypeToken:t})=>{if(!i&&t!==n&&e.getTime()>Date.now()&&t)return{skypeToken:t,fromCache:!0};if(!t){this.scenarioFactory.newScenario(u.RG.SkypeTokenUndefined).stop()}return this.resetDiscoveryResponse(),this.getDiscovery(i).then((({skypeToken:e})=>({skypeToken:e,fromCache:!1})))}))}getSkypeTokenInfoFromDiscoveryResponse(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.getDiscovery().then((e=>{const{skypeid:t}=(0,T.as)(B,(0,g.J)(e.skypeToken)),i=`8:${t}`;this.logger.log(`skypeid received from discovery: ${i}. Region: ${e.region}`);const n={id:i,region:e.region,userRegion:null==e?void 0:e.userRegion,partition:null==e?void 0:e.partition,userPartition:null==e?void 0:e.userPartition,licenseDetails:Object.assign(Object.assign({},e.licenseDetails),{consumerLicenseDetails:null==e?void 0:e.consumerLicenseDetails}),regionOverride:null==e?void 0:e.regionOverride,regionSettings:e.regionSettings};return{regionGtms:e.regionGtms,skypeToken:e.skypeToken,expiration:e.expires.getTime(),userDetails:n}})).catch((e=>{throw this.logger.error(`failed to get skypeid from discovery: ${(0,h.u4)(e)}​​`),e}))}))}getConsumerLicenseDetails(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return this.getSkypeTokenInfoFromDiscoveryResponse().then((e=>{var t,i;return null===(i=null===(t=null==e?void 0:e.userDetails)||void 0===t?void 0:t.licenseDetails)||void 0===i?void 0:i.consumerLicenseDetails}))}))}_getRegionGtmTable(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this._regionGtmTable)return this._regionGtmTable;if(this.isCDLWorker){const e=yield this._acquireRegionGtmTableWorker();if(e)return this.logger.log("regionGtm table received from main thread"),this._regionGtmTable=e,e}return this.logger.log("regionGtm table will be obtained via discoveryResponse"),(yield this.getDiscovery()).regionGtms}))}parseAuthzResponse(e,t,i){return t?e.then((e=>C(U,e))).then((({regionGtms:e,licenseDetails:t,skypeToken:{skypetoken:n,expiresIn:o},consumerLicenseDetails:r})=>({regionGtms:e,skypeToken:n,expires:new Date(i+o*$),licenseDetails:t,consumerLicenseDetails:r?{consumerLicenseDetails:r,timeStamp:new Date}:void 0}))):e.then((e=>C(M,e))).then((({region:e,userRegion:t,partition:n,userPartition:o,licenseDetails:r,regionGtms:s,tokens:{skypeToken:a,expiresIn:l},regionSettings:c})=>({region:e,userRegion:t,partition:n,userPartition:o,regionGtms:s,skypeToken:a,expires:new Date(i+l*$),licenseDetails:r,regionSettings:c})))}getDiscovery(e=!1){if(!this._discoveryResponse){const t=this.scenarioFactory.newScenario(u.RG.GetSkypeToken),i=this._canGetSkypeTokenFromHost()?this._acquireSkypeTokenDesktop:this.isCDLWorker?this._acquireSkypeTokenWorker:this._acquireSkypeTokenWeb,n=this.getDiscoveryResponse(i,t,0,e);return this.setDiscoveryResponse(n)}return this._discoveryResponse}getDiscoveryResponse(e,t,i=0,o=!1){var s,a;return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const i=yield e(o);return t.stop(),this.onDiscoverSuccess&&this.onDiscoverSuccess(),(0,b.nH)(i,this.coreSettings,this.telemetryProvider,this.logger,this.aad),i}catch(n){let l=n;(null===(s=l.serverResponse)||void 0===s?void 0:s.body)&&(null===(a=l.serverResponse)||void 0===a?void 0:a.body.json)&&(l.serverResponse.body=yield l.serverResponse.body.json().catch((e=>{n.message+=`::${e.message}`})));const{disableResponseParsing:c}=this.coreSettings.get(r.J.Auth);if(l=(0,b.r2)(n,this.isOnline(),!!c),this.canRetry(i,l))return null==t||t.mark("retry_skype_token_step",{message:l.message,reason:(0,h.u4)(l)}),this.getDiscoveryResponse(e,t,++i,this.coreSettings.get(r.J.Auth).useForceRenewInSkypeTokenRetry?o:void 0);throw this.onDiscoverFail&&this.onDiscoverFail(this._canGetSkypeTokenFromHost()),this.resetDiscoveryResponse(),(0,b.db)(t,l,!!c)}}))}resetDiscoveryResponse(){this._discoveryResponse=void 0,this.clearFromLocalStorage()}canRetry(e,t){return e<1&&t.code!==j.jK.NetworkOffline&&t.code!==j.jK.Forbidden&&t.code!==j.jK.ProxyAuthenticationRequired}setDiscoveryResponse(e){return e=e.then((e=>(this.logger.log("discoveryResponse set in memory"),this._regionGtmTable=e.regionGtms,this._skypeToken.next(e.skypeToken),e))),this._discoveryResponse=e}getResponseFromLocalStorage(e,t){let i=this.getFromLocalStorage(e,t,"auth.gtm.table");const n=this.getFromLocalStorage(e,t,"auth.skype.token");return i&&n?(z(this.globalScope)&&this.shouldNotDecodeTokenForIE||(i=C(o.UH,i)),Object.assign(Object.assign({},n.userDetails),{skypeToken:n.skypeToken,expires:new Date(n.expiration),regionGtms:i})):null}getFromLocalStorage(e,t,i){var n;if(!(null===(n=this.globalScope)||void 0===n?void 0:n.localStorage))return;let o=`ts.${t}-${e}.${i}`,r=this.globalScope.localStorage.getItem(o);if(r||(o=`ts.${e}.${i}`,r=this.globalScope.localStorage.getItem(o)),r){this._localStorageKeys.push(o);try{return JSON.parse(r)}catch(e){this.logger.error(e)}}}clearFromLocalStorage(){var e;(null===(e=this.globalScope)||void 0===e?void 0:e.localStorage)&&(this._localStorageKeys.forEach((e=>{this.globalScope.localStorage.removeItem(e)})),this._localStorageKeys=[])}getAdditionalUserInfo(){var e,t,i;return{userRegion:(null===(e=this.bootstrapData)||void 0===e?void 0:e.userRegion)||void 0,userPartition:(null===(t=this.bootstrapData)||void 0===t?void 0:t.userPartition)||void 0,partition:(null===(i=this.bootstrapData)||void 0===i?void 0:i.partition)||void 0}}_mapHostSkypeTokenToUser(e,t){var i;const n=null===(i=this.bootstrapData)||void 0===i?void 0:i.licenseDetails,o=this.getAdditionalUserInfo();return Object.assign({id:e,region:t||void 0,tenant:{type:this.licenseTypeToTenantType(null==n?void 0:n.isFreemium)},isAdvComms:(null==n?void 0:n.isAdvComms)||!1,isTranscriptEnabled:(null==n?void 0:n.isTranscriptEnabled)||!1,isFreemium:(null==n?void 0:n.isFreemium)||!1,isTrial:(null==n?void 0:n.isTrial)||!1,isWebinarEnabled:(null==n?void 0:n.isWebinarEnabled)||!1,isPrivacyDataControlEnabled:(null==n?void 0:n.isPrivacyDataControlEnabled)||!1,eduLicenseSkuAndCategory:(null==n?void 0:n.eduLicenseSkuAndCategory)||void 0,isBasicLiveEventsEnabled:(null==n?void 0:n.isBasicLiveEventsEnabled)||!1,isCopilot:(null==n?void 0:n.isCopilot)||!1,isM365CopilotBusinessChat:(null==n?void 0:n.isM365CopilotBusinessChat)||!1,isTPProtection:(null==n?void 0:n.isTPProtection)||!1,isTPCustomization:(null==n?void 0:n.isTPCustomization)||!1,isTPManagement:(null==n?void 0:n.isTPManagement)||!1,isTPWebinar:(null==n?void 0:n.isTPWebinar)||!1,isTPVirtualAppointments:(null==n?void 0:n.isTPVirtualAppointments)||!1,isInfoProtectionPremium:(null==n?void 0:n.isInfoProtectionPremium)||!1,isTeamsPhonePremium:(null==n?void 0:n.isTeamsPhonePremium)||!1,isTeamsSmb:(null==n?void 0:n.isTeamsSmb)||!1,isAvatarsEnabled:(null==n?void 0:n.isAvatarsEnabled)||!1,isImmersiveSpacesEnabled:(null==n?void 0:n.isImmersiveSpacesEnabled)||!1,isTeamsPremiumSelfAssigned:(null==n?void 0:n.isTeamsPremiumSelfAssigned)||!1,isTeamsSharedDevices:(null==n?void 0:n.isTeamsSharedDevices)||!1,trialLicenseEndDate:(0,b.Ll)(null==n?void 0:n.trialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:(null==n?void 0:n.hasOnlyTeamsSharedDevices)||!1},o)}_mapUserDetailsToUser(e,t){const{region:i,userRegion:n,partition:o,userPartition:r,licenseDetails:s}=t;return{id:e,region:i,userRegion:n,partition:o,userPartition:r,tenant:{type:this.licenseTypeToTenantType(null==s?void 0:s.isFreemium)},isAdvComms:(null==s?void 0:s.isAdvComms)||!1,isTranscriptEnabled:(null==s?void 0:s.isTranscriptEnabled)||!1,isFreemium:(null==s?void 0:s.isFreemium)||!1,isTrial:(null==s?void 0:s.isTrial)||!1,isWebinarEnabled:(null==s?void 0:s.isWebinarEnabled)||!1,isBasicLiveEventsEnabled:(null==s?void 0:s.isBasicLiveEventsEnabled)||!1,eduLicenseSkuAndCategory:(null==s?void 0:s.eduLicenseSkuAndCategory)||void 0,isCopilot:(null==s?void 0:s.isCopilot)||!1,isM365CopilotBusinessChat:(null==s?void 0:s.isM365CopilotBusinessChat)||!1,isTPProtection:(null==s?void 0:s.isTPProtection)||!1,isTPCustomization:(null==s?void 0:s.isTPCustomization)||!1,isTPManagement:(null==s?void 0:s.isTPManagement)||!1,isTPWebinar:(null==s?void 0:s.isTPWebinar)||!1,isTPVirtualAppointments:(null==s?void 0:s.isTPVirtualAppointments)||!1,isInfoProtectionPremium:(null==s?void 0:s.isInfoProtectionPremium)||!1,isTeamsPhonePremium:(null==s?void 0:s.isTeamsPhonePremium)||!1,isTeamsSmb:(null==s?void 0:s.isTeamsSmb)||!1,isAvatarsEnabled:(null==s?void 0:s.isAvatarsEnabled)||!1,isImmersiveSpacesEnabled:(null==s?void 0:s.isImmersiveSpacesEnabled)||!1,isTeamsPremiumSelfAssigned:(null==s?void 0:s.isTeamsPremiumSelfAssigned)||!1,isTeamsSharedDevices:(null==s?void 0:s.isTeamsSharedDevices)||!1,trialLicenseEndDate:(0,b.Ll)(null==s?void 0:s.trialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:(null==s?void 0:s.hasOnlyTeamsSharedDevices)||!1}}}},251498:(e,t,i)=>{"use strict";i.d(t,{a:()=>g});var n=i(740597),o=i(462410),r=i(974509),s=i(756144);var a=i(905493),l=i(341830),c=i(50805),d=i(8122),u=i(804589),m=i(844729);class g{constructor(e,t,i,n,r,s){this.aad=e,this.discover=t,this.coreSettings=i,this.loggerFactory=n,this.platformService=r,this.experienceConfig=s,this.skype=new o.q(this.discover)}bind(e,t){switch(t){case"chatService":return this.chatServiceBind(e);case"cmdArtifactsService":return this.cmdArtifactsServiceBind(e);case"userProfileService":return i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return(0,s.G)(yield(0,l.lZ)(this.addAdditionalHeadersToSend(e),this.aad,this.coreSettings),yield this.discover.regionGtm(t))(i)}));case"middleTier":const i=this.coreSettings.get(c.J.Auth).sendMigrationHeaderToMtInGtm,o=this.coreSettings.get(c.J.Auth).disableSkypeTokenToMtInGtm,r={[u.kI]:"True"};return o?i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return(0,s.G)(yield(0,l.lZ)(this.addAdditionalHeadersToSend(e,r),this.aad,this.coreSettings),yield this.discover.regionGtm(t))(i)})):o=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return(0,s.G)(yield(0,l.UE)(this.addAdditionalHeadersToSend(e,i?r:void 0),this.aad,this.skype,this.coreSettings),yield this.discover.regionGtm(t))(o)}));case"unifiedPresence":return this.unifiedPresence||(this.unifiedPresence=this.unifiedPresenceBind(t)),this.unifiedPresence(e);case"urlp":case"urlpV2":case"ams":case"amsV2":return i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return(0,s.G)(this.skype.authorize(e,"Authorization"),yield this.discover.regionGtm(t))(i)}));case"mtImageService":return i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const{mtImageServiceOverrideUrl:n}=this.coreSettings.get(c.J.Test),o=n||(yield this.discover.regionGtm(t));return(0,s.G)(e,o)(i)}));default:return this.defaultBind(e,t)}}defaultBind(e,t){return i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.discover.regionGtm(t);return(0,s.G)(this.aad.authorize(e,n),n)(i)}))}unifiedPresenceBind(e){const{requireConsumerTypeHeader:t,requireSkypetoken:i}=this.coreSettings.get(c.J.Presence);return function(e,t){let i;return o=>a=>(0,n.__awaiter)(this,void 0,void 0,(function*(){for(let n=0;;++n){i||(i=yield t());const l=yield(0,s.G)(e(o,i),i)(Object.assign(Object.assign({},a),{headers:Object.assign(Object.assign({},a.headers),{BehaviorOverride:"redirectAs404"})})),{status:c,headers:{location:d}}=l;if(c!==r.qb.NOT_FOUND||!d||n>2)return l;i=new URL("/",d).href}}))}(((e,o)=>{const r=i?this.skype.authorize(e,"x-skypetoken"):this.aad.authorize(e,o);return t?e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return e=Object.assign(Object.assign({},e),{headers:Object.assign(Object.assign({},e.headers),{"x-ms-client-consumer-type":"teams4life"})}),r(e)})):r}),(()=>this.discover.regionGtm(e)))}chatServiceBind(e){return this.chatService||(this.chatService=(0,a.Db)((e=>this.skype.authorize(e)),(e=>this.discover.regionGtm(e)),this.coreSettings,this.loggerFactory)),this.chatService(e)}cmdArtifactsServiceBind(e){const{cmdMeetingArtifactsServiceEndpoint:t}=this.coreSettings.get(c.J.CMDMeetingArtifactsService);return i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){return(0,s.G)(yield(0,l.l2)(e,this.aad,this.coreSettings),null!=t?t:"")(i)}))}addAdditionalHeadersToSend(e,t){if(this.coreSettings.get(c.J.Core).enableCommonMtHeadersWithSend){const i=(0,m.h)(this.platformService,this.experienceConfig);return n=>e(Object.assign(Object.assign({},n),{headers:Object.assign(Object.assign(Object.assign(Object.assign({},i),t),{[d.f.xMsRequestId]:n.correlationId||""}),n.headers)}))}return e}}},428768:(e,t,i)=>{"use strict";var n,o;i.d(t,{f:()=>n,a:()=>o}),function(e){e.AssignExternalIcon="AssignExternalIcon",e.AssignedPriorityStatusToToast="AssignedPriorityStatusToToast",e.CallsActionTypeToNotificationActionFailed="CallsActionTypeToNotificationActionFailed",e.CallingToastActionMutationFailed="CallingToastActionMutationFailed",e.ChatActionTypeToNotificationActionFailed="ChatActionTypeToNotificationActionFailed",e.ChatTabsFetchFailed="ChatTabsFetchFailed",e.ChatToastActionMutationFailed="ChatToastActionMutationFailed",e.ChatToastEmoticonsQueryFailed="ChatToastEmoticonsQueryFailed",e.ChannelToastEmoticonsQueryFailed="ChannelToastEmoticonsQueryFailed",e.CollectionIdUndefined="CollectionIdUndefined",e.ConversionToHostEntityOptionsFailed="ConversionToHostEntityOptionsFailed",e.ConversationAlerts="ConversationAlerts",e.ConversationIsMuted="ConversationIsMuted",e.ConversationFetchFailed="ConversationFetchFailed",e.DateConversionFailed="DateConversionFailed",e.DefinedIfToastCanIgnoreConversationMuted="DefinedIfToastCanIgnoreConversationMuted",e.EmptyEvent="EmptyEvent",e.EventFromSelf="EventFromSelf",e.EventDiscarded="EventDiscarded",e.ExtractedSettings="ExtractedSettings",e.ImageFetchFailed="ImageFetchFailed",e.ImageUrlGenerationFailed="ImageUrlGenerationFailed",e.LogToastInfo="LogToastInfo",e.MappingCommandOptions="MappingCommandOptions",e.MappingOfToastInResolver="MappingOfToastInResolver",e.GraphItemToastUnhandledType="GraphItemToastUnhandledType",e.NoAutheticatedUserOrTrackingService="NoAutheticatedUserOrTrackingService",e.NotEnabled="NotEnabled",e.PriorityAssignmentSkipped="PriorityAssignmentSkipped",e.RequiredFieldMissing="RequiredFieldMissing",e.ReturningFetchedImage="ReturningFetchedImage",e.ReturningHardcodedImage="ReturningHardcodedImage",e.ReturningUserKeyForToastCollection="ReturningUserKeyForToastCollection",e.SkippingPriorityMessageFromLongpoll="SkippingPriorityMessageFromLongpoll",e.SubscriptionFailed="SubscriptionFailed",e.Subscribing="Subscribing",e.ToastCommandSent="ToastCommandSent",e.ToastEventIsAlreadyRead="ToastEventIsAlreadyRead",e.ToastEventReceivedInJob="ToastEventReceivedInJob",e.ToastEventReceivedInWorkerResolver="ToastEventReceivedInWorkerResolver",e.ToastImageAsDataUriIsUndefined="ToastImageAsDataUriIsUndefined",e.ToastNavigationDataNotFound="ToastNavigationDataNotFound",e.ToastSuppressedForWindowInFocus="ToastSuppressedForWindowInFocus",e.UnhandledType="UnhandledType",e.UnhandledSubtype="UnhandledSubtype",e.UpdateBlockingCacheWithOSDnD="UpdateBlockingCacheWithOSDnD",e.OSDnDBannerJobUserFetchFailed="OSDnDBannerJobUserFetchFailed",e.YieldingToastFromWorkerResolver="YieldingToastFromWorkerResolver",e.MentionHandledByActivityManager="MentionHandledByActivityManager",e.InvalidType="InvalidType",e.ToastDisabledByCoreSettings="ToastDisabledByCoreSettings",e.MissingConversationId="MissingConversationId",e.CommunityEvent="CommunityEvent",e.MappingException="MappingException",e.ProfileFetchFailed="ProfileFetchFailed",e.ToastThrottled="ToastThrottled"}(n||(n={})),function(e){e.PhonelinkSmsPrefix="phonelink:"}(o||(o={}))},500254:(e,t,i)=>{"use strict";i.d(t,{E:()=>a,z:()=>l});var n=i(740597),o=i(905581),r=i(132756);let s;const a=e=>t=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(!s)return e(t);return e(t).then((e=>(null==s||s.processResponse(e),e))).catch((e=>{throw null==s||s.processError(e),e}))}));function l(e,t){if(s){throw(0,o.Tr)(r.w5.Tasks,r.jK.AlreadyInitialized,"subscribeToSendNetworkTracking",void 0,"subscription exists")}s={processResponse:e,processError:t};return()=>{s=void 0}}},460193:(e,t,i)=>{"use strict";i.d(t,{I:()=>R,s:()=>P});var n,o,r=i(740597);!function(e){e.apps="apps",e.broadcasts="broadcasts",e.chats="chats",e.calls="calls",e.calendars="calendars",e.extensions="extensions",e.files="files",e.licenses="licenses",e.meetings="meetings",e.teamgallery="teamgallery"}(n||(n={})),function(e){e.list="list",e.create="create",e.join="join",e.error="error",e.view="view"}(o||(o={}));var s=i(846311),a=i(74583);const l=1e3,c=new Map,d=/^\/|\/$/g;function u(e,t){const i=t?":":"",n=e.id?`/${i}${e.id}`:"",o=e.action?`/${e.action}`:"";return`${e.resource}${n}${o}`}function m(e){const{descriptor:t,asPath:i,stem:n=""}=e,o=(0,r.__rest)(e,["descriptor","asPath","stem"]);let s=n;const a=t?t.resources:void 0;if(a&&a.length>0)for(const e of a)s=`${s}/${u(e,i)}`;return Object.assign(Object.assign({},o),{descriptor:t,asPath:i,stem:s})}function g(...e){return e.reduce(((e,t)=>(e.resources=e.resources.concat(t.resources),e.search=Object.assign(Object.assign({},e.search),t.search),e)),{resources:[],search:{}})}function h(e){return(0,a.flow)([m,f,S])(e).stem}function p(e){if(!e||0===e.length)return[];const t=c.get(e);if(t)return t;let i=[];const r=e.replace(d,"");if(0===r.length)return i;const s=r.split("/");try{const t=function(e){const t=[];let i=-1;for(const o of e){const e=o;n[e]&&(i++,t[i]=[]),i>=0&&t[i].push(e)}return t}(s);return t&&(i=t.map((e=>{let t;const i=2,n=3;switch(e.length){case n:t={resource:e[0],id:e[1],action:e[i]};break;case i:{const i=e[1];t=o[i]?{resource:e[0],action:e[1]}:{resource:e[0],id:e[1]};break}default:throw new Error("Invalid resource fragment format found, id or action is required.")}return t}))),c.size<l&&c.set(e,i),i}catch(e){throw new Error(`Unable to parse path into proper resources. ${e.message}`)}}function v(e){return(0,s.parse)(e||"")}function y(e){return(0,s.stringify)(e||{})}function f(e){const{context:t,asPath:i,stem:n=""}=e;let o=n;if(t){const e=t.router;if(!e)throw new Error("Cannot generate a relative path without a context. Verify a context was added provided");{const t=i?e.route.match.path:e.route.match.url;o="/"!==t?`${t}${o}`:o}}return Object.assign(Object.assign({},e),{stem:o})}function S(e){const{descriptor:t,asPath:i,stem:n=""}=e;let o=n;if(t){const e=y(t.search);e&&(o=`${o}${i?`/:${e}`:`?${e}`}`)}return Object.assign(Object.assign({},e),{stem:o})}function k(e){const{pathname:t,search:i}=e;return{resources:p(t),search:v(i)}}class b{constructor(e,t){this.history=t,this._logger=e.newLogger("Routing Service","core-services-routing")}navigate(e){const t=function(e){const{search:t}=e,i=(0,r.__rest)(e,["search"]),n=y(t);return{pathname:h({descriptor:i}),search:n}}(e);this.execute(t)}execute(e){this.history?this.history.push(e):this._logger.error("Unable to route using history. History initialized with undefined")}}class w{constructor(e,t,i){this._location=t,this._history=i,this._logger=e.newLogger("State Routing Service","core-services-routing")}getSearchState(){const e=this.getLocation();if(!e)return{};const t=e.search;return t!==this._previousSearch&&(this._previousSearch=t,this._currentState=v(t)),this._currentState||{}}getOrigin(){const e=this.getLocation();return e&&e.origin}getHost(){const e=this.getLocation();return e&&e.host}getPathname(){const e=this.getLocation();return e&&e.pathname}getLocation(){if(this._location||this._logger.error("Unable to execute on location. Location initialized with undefined"),this._location&&this._history&&this._history.location){const{search:e,pathname:t}=this._history.location;return Object.assign(Object.assign({},this._location),{search:e,pathname:t})}return this._location}}var C;!function(e){e.OrgChart="organization"}(C||(C={}));class _{constructor(e,t){this.routingService=e,this.rootRoutingService=t}toCreateChatWithUsers(e){this.routingService.navigate(this.createChatWithUsersDescriptor(e))}toChatById(e){this.routingService.navigate(this.chatByIdDescriptor(e))}toOrgChart(e){this.routingService.navigate(this.orgChartDescriptor(e))}toChatList(){this.routingService.navigate(this.chatListDescriptor())}chatByIdDescriptor(e){return this.concatToAppDescriptor({resources:[{resource:n.chats,id:e}]})}createChatWithUsersDescriptor(e){const t=JSON.stringify(e&&e.length>0?e.sort():[]);return this.concatToAppDescriptor({resources:[{resource:n.chats,action:o.create,id:t}]})}chatListDescriptor(){return this.concatToAppDescriptor({resources:[{resource:n.chats,action:o.list}]})}orgChartDescriptor(e){return g(this.createChatWithUsersDescriptor([e]),{resources:[{resource:n.extensions,id:C.OrgChart}]})}concatToAppDescriptor(e){return g(this.rootRoutingService.chatAppDescriptor(),e)}}class T{constructor(e,t){this.routingService=e,this.rootRoutingService=t}toCallById(e){this.routingService.navigate(this.callByIdDescriptor(e))}toCallList(){this.routingService.navigate(this.callsListDescriptor())}callByIdDescriptor(e){return this.concatToAppDescriptor({resources:[{resource:n.calls,id:e}]})}callsListDescriptor(){return this.concatToAppDescriptor({resources:[{resource:n.calls,action:o.list}]})}concatToAppDescriptor(e){return g(this.rootRoutingService.callingAppDescriptor(),e)}}var I,j=i(574229);class N{constructor(e){this._routingService=e}toAppById(e){this._routingService.navigate(this.appDescriptor(e))}chatAppDescriptor(){return this.appDescriptor(j.dS)}callingAppDescriptor(){return this.appDescriptor(j.Pz)}meetingOptionsAppDescriptor(){return this.appDescriptor(j.s_)}fileAppDescriptor(){return this.appDescriptor(j.Tu)}appDescriptor(e,t){return{resources:[{resource:n.apps,id:e,action:t}]}}}!function(e){e[e.Allow=0]="Allow",e[e.Block=1]="Block"}(I||(I={}));class E{constructor(){this._taps=[]}tap(e){return this._taps.push(e),()=>{this._taps=this._taps.filter((t=>t!==e))}}call(e){let t;for(const i of this._taps){const n=i({data:e,previousResult:t});void 0!==n&&(t=n)}return t}}class x{constructor(e){this._history=e,this.onNavigationBlocked=new E,this.onNavigationStart=new E,this.onNavigationSucceeded=new E,this._handleNavigationStart=e=>{if(!this._history||!this._history.location)return;const t=k(this._history.location),i=k(e);return this.onNavigationStart.call({from:t,to:i})===I.Block?(this.onNavigationBlocked.call({to:i}),!1):void 0},this._handleNavigationSuccess=e=>{const t=k(e);this.onNavigationSucceeded.call({to:t})},this._history&&this._history.block&&this._history.block(this._handleNavigationStart),this._history&&this._history.listen&&this._history.listen(this._handleNavigationSuccess)}}var A=i(905581),D=i(132756);class F{meetingOptionsPageDescriptor(e){const{tenantId:t,organizerId:i,threadId:o,messageId:r,additionalMessageId:s,search:a}=e;return{resources:[{resource:n.meetings,id:JSON.stringify({tenantId:t,organizerId:i,threadId:o,messageId:r,additionalMessageId:s})}],search:a}}meetingOptionsLicenseDescriptor(e){return{resources:[{resource:n.licenses,action:o.list}],search:e?e.search:void 0}}}class O{constructor(e,t){this._history=t,this._logger=e.newLogger("External Routing Service","core-services-routing")}serializeToPath(e){const{descriptor:t,exact:i}=e;let n="";return t&&(n=h({descriptor:t})),this._history?i||(n=this._history.createHref({pathname:n}).toString()):i&&this._logger.error("Unable to execute on history to generate absolute path. History initialized with undefined"),n}}let M;const R=(e,t,i)=>{const n=new b(e,t),o=new N(n),r={state:new w(e,i,t),root:o,call:new T(n,o),chat:new _(n,o),meeting:new F,external:new O(e,t),hooks:new x(t)};return M=r,M},P=()=>{if(!M)throw(0,A.Tr)("RoutingServices",D.jK.NotInitialized,"getInstance");return M}},368310:(e,t,i)=>{"use strict";i.d(t,{qo:()=>a,Q6:()=>r,bE:()=>s});var n=i(50805),o=i(74583);const r=e=>{const t=e.get(n.J.Host).enableSyncEngine;return(0,o.isNil)(t)?!!e.get(n.J.CdlWorker).enableSyncEngine:t},s=e=>{const t=e.get(n.J.Host).enableProfileManagerStore;return(0,o.isNil)(t)?!!e.get(n.J.People).enableProfileManagerStore:t},a=e=>{const{dataStoreMapType:t,disableDataStoreInMemoryProvider:i}=e.get(n.J.CdlWorker);return i?"none":t||"red-black-tree"}},656618:(e,t,i)=>{"use strict";i.d(t,{RT:()=>c,iI:()=>d,Y3:()=>u,u0:()=>m,JX:()=>g,xb:()=>h,mN:()=>S});var n=i(220180),o=i(964718),r=i(50805),s=i(143285);const a="99999999999",l="ringFinder",c="https://config.teams.microsoft.com",d="1.0.0.0",u="1415",m="MicrosoftTeams";function g(e){const t=Object.keys(s.z).filter((e=>isNaN(Number(e))));for(let i=0;i<t.length;i++)if(e===t[i])return i}function h({experienceName:e,coreSettings:t,platformService:i,user:o,locale:s,logger:a}){const g=function(e,t,i){const{primaryUserProfile:o}=e.get(r.J.Host);if(o)return{userId:o.oid,tenantId:o.tid};return i||function(e){try{const e=n.get(l);if(!e)return;const{oid:t,tid:i}=JSON.parse(decodeURIComponent(e));return{userId:t,tenantId:i}}catch(t){return void e.warn(`Error parsing ringFinder cookie when user not authenticated: ${t}`)}}(t)}(t,a,o),{ecsOverrides:h,config:{platformId:S,buildVersion:k,buildType:b,osPlatform:w}}=i,{ecsNamespaces:C,criticalEcsNamespaces:_,ecsEndpoint:T,enableEcsNativeRingResolution:I,disableSendOsVersionWithEcsRequest:j,enableUbrInOsVersion:N}=t.get(r.J.Core),E=function(e,t){const{environment:i="prod",ring:n,originalRing:o}=e,r={environment:i};t&&!o||(r.audienceGroup=n,r.teamsRing=n);return r}(h,I),{ecsHostUrl:x,electronVersion:A,windowsInsiderChannel:D,windowsInsiderRing:F}=t.get(r.J.Host),{deviceInfo:O}=t.get(r.J.Platform),M=h.hostUrl||x||T||c;return{version:`${S||u}_${d}`,domain:M,client:m,agents:C,criticalAgents:_,filters:Object.assign(Object.assign({},E),{experience:e,buildType:b,virtualization:y(t,i),osPlatform:w,wipChannel:D,wipRing:F,osVersion:j?void 0:p(O,!!N,a),id:null==g?void 0:g.userId,aaduserid:null==g?void 0:g.userId,tenantId:null==g?void 0:g.tenantId,experienceBuild:f(b,k),desktopVersion:v(t,i),electronVersion:A,teamsLocale:s})}}function p(e,t,i){var n;if(!e||!e.osVersion)return;let r=e.osVersion;if(t&&e.ubrVersion&&!isNaN(parseInt(e.ubrVersion,10))&&(r=`${e.osVersion}.${e.ubrVersion}`),(0,o.validate)(r))return r;null===(n=i.errorNoPii)||void 0===n||n.call(i,`osVersion parsed from deviceInfo is not a proper semver '${r}'.`)}function v(e,t){const{desktopVersion:i}=e.get(r.J.Host);if(i){const e=i.indexOf("/");return e>-1?i.substr(e+1):i}return t.host.hostAppVersion}function y(e,t){var i;const{virtualization:n}=e.get(r.J.Host);return null!=n?n:null===(i=t.config.vdi)||void 0===i?void 0:i.configFilter}function f(e,t){if("local"===e||"container"===e)return a;if(t){const e="1.0.0.20",i=6;if((t=`${t}`).startsWith(e)){const n=t.substring(e.length,e.length+i),o=t.substring(e.length+i);t=`${n}000${o}`}const n=parseInt(t,10);if(!isNaN(n))return n.toString()}}function S(e){if(!e)return;const t=e.getTime(),i=(new Date).getTime();return t<i?i-t:0}},308794:(e,t,i)=>{"use strict";i.d(t,{K:()=>l});var n=i(740597),o=i(47580),r=i(132756),s=i(891772),a=i(800418);class l extends o.i{constructor(){super(r.Yg.CreateAsyncMediaAuth,["gtmRegistry","discover","loggerFactory","coreSettings","windowProvider","platformService","endpointsManager","localStorage","authenticationService","config","authenticationUser","clientState","networkState","hostState"]),this.lifeCycleSubscriptions=[r.sM.OnUserAuthenticated,r.sM.OnUserAuthenticated_MTMA]}execute(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){e.mediaAuthService||(e.mediaAuthService=new a.b(s.l,e.gtmRegistry,e.discover,e.loggerFactory,e.coreSettings,e.windowProvider,e.platformService,e.endpointsManager,e.localStorage,e.authenticationService,e.config,e.authenticationUser,e.clientState,e.networkState,e.hostState))}))}}},412938:(e,t,i)=>{"use strict";i.d(t,{YK:()=>_,Lk:()=>E});var n,o=i(740597),r=i(50805),s=i(982190),a=i(974509),l=i(455572);!function(e){e.HEALTHY="healthy",e.UNHEALTHY="unhealthy",e.UNKNOWN="unknown"}(n||(n={}));var c=i(137021),d=i(89062),u=i(575644),m=i(781662),g=i(234207),h=i(905581);const p=3e4,v={headers:{sharePoint:{SPRequestGuid:"SPRequestGuid",SPClientServiceRequestDuration:"SPClientServiceRequestDuration",SPRequestDuration:"SPRequestDuration"}}},y="cache",f="cache-control",S="x-cache",k="electron";var b;!function(e){e.CDN="CDN",e.Shared="Shared",e.Browser="Browser",e.None="None"}(b||(b={}));let w="";function C(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{status:t,responseHeaders:i,requestHeaders:n,performance:r}=e,s=yield function(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){try{return yield(0,u.E)(e,p)}catch(e){return}}))}(r);return Object.assign(e,{requestHeaders:(a=n,I(["clientRequestId","x-ms-request-id"],a)),responseHeaders:N(t,i),performance:D(s)});var a}))}const _=(e,t,i,a="")=>{var l;const u=(null!==(l=t.get(r.J.Telemetry).httpnsDisabledServices)&&void 0!==l?l:[]).map((e=>e.toLowerCase()));return t=>(0,o.__awaiter)(void 0,void 0,void 0,(function*(){const{serviceName:r,apiName:l,result:p,innerError:v,operationLogs:y}=t;if(v&&(0,h.Wc)(v))return;t.operationLogs=yield function(e){const t=e.map((e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{type:t,duration:i,result:n,request:o}=e;return{type:t,duration:i,result:n,request:o&&(yield C(o))}}))));return Promise.all(t)}(y);const f=r.toLowerCase(),S=u.some((e=>e===f));w=a;const k=t.correlationId||(0,g.v4)(),b=M(r,l);i.log(`Data call ${b} is completed with ${p}. CorrelationId: ${k}`),S||t.operationLogs.forEach((t=>{if(t.request){const{name:i,method:n}=t.request;x(e,O(r,i||l,n),"EM",t,k)}})),function(e,t,i){var o,r;const{serviceName:a,apiName:l,createdTime:u,duration:g,parameters:h,result:p,innerError:v,operationLogs:y}=e,f=function(e,t){const i=(0,m.G)().getEndpointHealth(e,t);return void 0===i?n.UNKNOWN:i?n.HEALTHY:n.UNHEALTHY}(a,l);y.forEach((e=>{if(e.request){const{method:t}=e.request;!function(e,t,i,n,o,r,a){const l=t.request;if(l){const{duration:u,result:m}=t,{method:g,hostname:h,performance:p,responseHeaders:v,requestHeaders:y,dateTime:f,authPerformanceLogs:S}=l,k={apiName:n,serviceName:o,duration:u,result:T(m),correlationId:i,method:g,hostname:h,responseHeaders:(0,d.u4)(v),requestHeaders:(0,d.u4)(y),healthState:r,timestamp:f.toISOString(),hasInnerError:!!a};p&&(p.duration&&(k.perf_duration=p.duration.toString()),k.perf_details=(0,d.u4)(Object.assign(Object.assign({},p),S))),(0,c.P3)(s.x.Endpoint,e,k,void 0,void 0,void 0,w)}}(O(a,l,t),e,i,l,a,f,v)}}));const S={apiName:l,serviceName:a,duration:g,result:p,innerError:(0,d.u4)(v),correlationId:i,userAgent:t.navigator.userAgent,timestamp:u,operationLogs:(0,d.u4)(y),parameters:(0,d.u4)(h),ECT:null===(r=null===(o=t.navigator)||void 0===o?void 0:o.connection)||void 0===r?void 0:r.effectiveType,healthState:f},k=M(a,l);(0,c.P3)(s.x.Endpoint,k,S,void 0,void 0,void 0,w)}(t,e,k)}))};function T(e){let t;return e instanceof Error&&(t=e.innerException?`${e.reason} / ${(0,d.u4)(e.innerException)}`:e.reason),t||e||""}function I(e,t){const i={};return t&&e.forEach((e=>{t[e]&&(i[e]=t[e])})),i}function j(e=""){if(!e)return e;let t=0;return e.split(",").forEach((e=>{const i=e.split("/");t+=+i[0]+ +i[1]})),`${t}`}function N(e,t){return t?{contentLength:t["content-length"]||"-1",serverRequestId:t.contextid||t["x-serverrequestid"]||t["request-id"]||A(t),[y]:F(e,t),requestId:t["x-ms-request-id"],invalidToken:t["x-invalid-token"],afdCorrelationId:t["x-msedge-ref"],serverLatency:t["x-end2endlatencyms"],serviceOrigin:t["x-servicering"],cafeLatency:j(t["x-cafeproxylatency"])}:{}}const E=(e,t,i,n,o,r,s)=>{const l=s||a.qb[null==n?void 0:n.status]||"",c=function(e){const t={};if(e)for(const i of Object.keys(e.headers)){t[i.toLowerCase()]=e.headers[i]}return t}(n),{serviceName:d,apiName:u,method:m,authPerformanceLogs:g}=i;x(r,O(d,u,m),"SEND",{type:a.nz.Initial,duration:e,result:l,request:{name:u||"undefined",dateTime:t,method:i.method,hostname:n&&new URL(n.url).hostname,status:null==n?void 0:n.status,requestHeaders:i.headers||{},responseHeaders:c,performance:o,authPerformanceLogs:g}},i.correlationId)};const x=({navigator:e},t,i,n,o)=>{var r;const u=n.request;if(u){const{dateTime:m,method:g,hostname:h,status:p,requestHeaders:v,responseHeaders:f,performance:S,authPerformanceLogs:b}=u,C={ECT:null===(r=null==e?void 0:e.connection)||void 0===r?void 0:r.effectiveType,hostname:h,transport:i,requestCreatedTime:m.toISOString(),networkState:e.onLine?l.XR.ONLINE:l.XR.OFFLINE,method:g,resultCode:p,requestResult:T(n.result),contentLength:f["content-length"]||-1,serverRequestId:f.contextid||f["x-serverrequestid"]||f["request-id"]||A(f),correlationId:o,duration:n.duration,authPerformanceLogs:(0,d.u4)(b)};!function(e,t,i,n,o){const r=n&&n.clientRequestId,s=i["x-ms-request-id"]||n["x-ms-request-id"];e.requestId=s,r&&(e.clientRequestId=r);i["x-invalid-token"]&&(e.invalidToken=i["x-invalid-token"]);t!==a.qb.OK&&(e.afdCorrelationId=i["x-msedge-ref"]);e.hasClaims=!!o&&!!o.hasClaims}(C,p,f,v,b),C[y]=F(p,f),function(e,t,i){if(i){const n=i.domainLookupEnd-i.domainLookupStart,o=i.connectEnd-i.connectStart,r=i.redirectEnd-i.redirectStart;if(n>0&&(e.dns=n),o>0&&(e.tcp=o),r>0&&(e.redirect=r),e.size=i.transferSize,e.payload=i.encodedBodySize,e.start=i.startTime,e.reqStart=i.requestStart,e.respStart=i.responseStart,i.duration){const n=i.duration;(-1===t.userAgent.toLowerCase().indexOf(k)||e.duration&&n>e.duration)&&(e.duration=n)}}}(C,e,S),(0,c.P3)(s.x.Http,t,C,void 0,void 0,void 0,w)}};function A(e){let t=e[v.headers.sharePoint.SPRequestGuid.toLowerCase()]||"";return"[object String]"===Object.prototype.toString.call(t)&&t.length>0&&(t=[`${v.headers.sharePoint.SPRequestGuid}=${t}`,`${v.headers.sharePoint.SPClientServiceRequestDuration}=${e[v.headers.sharePoint.SPClientServiceRequestDuration.toLowerCase()]||""}`,`${v.headers.sharePoint.SPRequestDuration}=${e[v.headers.sharePoint.SPRequestDuration.toLowerCase()]||""}`].join(";")),t}function D(e){if(e){const{duration:t,domainLookupStart:i,domainLookupEnd:n,connectStart:o,connectEnd:r,redirectStart:s,redirectEnd:a,transferSize:l,encodedBodySize:c,startTime:d,requestStart:u,responseStart:m}=e;return{duration:t,dns:n-i,tcpHandshakeTime:r-o,redirectTime:a-s,transferSize:l,encodedBodySize:c,startTime:d,requestStart:u,responseStart:m}}return{}}function F(e,t){let i=b.None;if(t.hasOwnProperty(f)){const n=t[f];e===a.qb.NOT_MODIFIED?i=b.Browser:n.includes("no-store")||n.includes("no-cache")||(i=b.Browser,n.includes("public")&&(i+=", ".concat(b.Shared)))}else t.hasOwnProperty("expires")&&(i=b.Browser);if(t.hasOwnProperty(S)){t[S].toLowerCase().includes("hit")&&(i===b.None?i=b.CDN:i+=", ".concat(b.CDN))}return i}function O(e,t,i){return`${e}_${t||"undefined"}_${i}`}function M(e,t){return`${t}_${e}`}},659726:(e,t,i)=>{"use strict";i.d(t,{A:()=>u});var n=i(58838),o=i(100836),r=i(816772);const s="(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)",a="[0-9a-fA-F]{1,4}",l=`(\\s|^|\\[)(${`(?:${a}:){1,7}:|(?:${a}:){7}${a}|(?:${a}:){6}(?::${a}|${s})|(?:${a}:){5}(?:(?::${a}){1,2}|:${s})|(?:${a}:){4}(?:(?::${a}){1,3}|(?::${a}){0,1}:${s})|(?:${a}:){3}(?:(?::${a}){1,4}|(?::${a}){0,2}:${s})|(?:${a}:){2}(?:(?::${a}){1,5}|(?::${a}){0,3}:${s})|(?:${a}:){1}(?:(?::${a}){1,6}|(?::${a}){0,4}:${s})|(?::(?:(?::${a}){1,7}|(?::${a}){0,5}:${s}|:))|(?:fe80|FE80):(?::[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}`})(\\s|$|\\])`,c={[o.A4.SmtpAddress]:new RegExp("\\S+@\\S+\\.\\S+","g"),[o.A4.IPV4Address]:new RegExp(s,"g"),[o.A4.PhoneNumber]:new RegExp("(?:[^-\\d]|^)(?:\\+?1[-.]?)?\\(?([0-9]{3})\\)?[-.]?([0-9]{3})[-.]?([0-9]{4})(?!\\d)","g"),[o.A4.Uri]:new RegExp('((http[s]?:\\/\\/[^(\\/|\\?)]+\\S)|(data:text\\/)|(data:image)|(data:application)|(file:)|([s]?ftp:\\/\\/[\\S]+\\/)|(mailto:))(([^(.|")]+[^\\s]+))'),[o.A4.FilePath]:new RegExp(`((\\s(\\w+))(\\/).+?(?=((\\.${(0,r.D)().join(")|(\\.")})|($))))`,"g")};function d(e,t){switch(e){case o.A4.SmtpAddress:case o.A4.IPV4Address:case o.A4.PhoneNumber:case o.A4.FilePath:return t.replace(c[e],(e=>(0,n.sha256)(e)));case o.A4.IPv6Address:return function(e){const t=new RegExp(l,"g");let i,o="";do{if(i=t.exec(e),i&&4===i.length){const r=i.index+i[1].length;o=`${o}${e.substring(0,r)}${(0,n.sha256)(i[2])}`;const s=r+i[2].length;e=e.substring(s),t.lastIndex=0}}while(i);return`${o}${e}`}(t);case o.A4.Uri:{let i,o="";do{if(i=c[e].exec(t),i){const e=t.substring(0,i.index),r=t.substring(i.index).replace(i[i.length-1],(e=>(0,n.sha256)(e))),s=5;t=r.substring(s),o=`${o}${e}${r.substring(0,s)}`}}while(i);return o=`${o}${t}`,o}default:return}}function u(e,t=[]){if(e){0===t.length&&t.push(o.A4.Uri,o.A4.SmtpAddress,o.A4.IPV4Address,o.A4.IPv6Address,o.A4.PhoneNumber);for(const i of t)e=d(i,e)}return e}},907550:(e,t,i)=>{"use strict";i.d(t,{p:()=>l});var n=i(740597),o=i(974509),r=i(905581),s=i(132756),a=i(973730);function l(e){return t=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var i;try{return yield e(t)}catch(e){if(e instanceof TypeError&&(null===(i=e.message)||void 0===i?void 0:i.toLowerCase())===a.gZ){const i=t.headers&&t.headers.cache;if(i&&-1!==i.indexOf("only-if-cached"))return{status:o.qb.GATEWAY_TIMEOUT};e=(0,r.Tr)(s.w5.RejectHttpError,s.jK.RemoteOperationFailed,"rejectHttpError",void 0,e.message)}throw e}}))}},905493:(e,t,i)=>{"use strict";i.d(t,{Db:()=>g,tC:()=>h,j$:()=>p});var n=i(740597),o=i(974509),r=i(50805),s=i(467452),a=i(756144);const l=10,c="",d=/\/api\/chatsvc\/.*?\//,u="teams.microsoft.com",m="teams.live.com";function g(e,t,i,r){let s=c;const d=r.newLogger("chat-service-redirect","core-services-transport");return r=>u=>(0,n.__awaiter)(this,void 0,void 0,(function*(){let n=0;for(;;){v(s)&&(s=yield p(t,i,d));const m=yield(0,a.G)(e(r),s)(Object.assign(Object.assign({},u),{headers:Object.assign(Object.assign({},u.headers),{BehaviorOverride:"redirectAs404"})})),{status:g,headers:{location:y}}=m;if(!y||g!==o.qb.NOT_FOUND)return g===o.qb.SERVICE_UNAVAILABLE||g===o.qb.BAD_GATEWAY?(s=c,m):m;if(n>=l)return m;if(s=h(y,d),s===c)return m;n+=1}}))}function h(e,t){let i;try{i=new URL(e)}catch(i){return t.error(`Location header ${e} is invalid: error message ${i.message}`),c}if(i.hostname===u||i.hostname===m){const n=i.pathname.match(d);return n&&n[0]?`${i.origin}${n[0]}`:(t.error(`No match of chatServiceAfd 404 location with regex, url is ${e}`),c)}return t.log("Url is a ATM Url, use previous parsing strategy."),new URL("/",e).href}function p(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{chatServiceHostOverrideUrl:n}=t.get(r.J.Test);if(n)return(o=n).endsWith("/")?o:`${o}/`;var o;if(function(e){var t,i;return null!==(i=null!==(t=e.get(r.J.Host).enableUseChatServiceAfd)&&void 0!==t?t:e.get(r.J.ChatService).useChatServiceAfd)&&void 0!==i?i:void 0}(t))try{return yield e("chatServiceAfd")}catch(t){if((0,s.B)(t))return i.warn("Flag useChatServiceAfd is set but chatServiceAfd was not found in the GTM table. Falling back to chatService."),e("chatService");throw t}return e("chatService")}))}function v(e){return e===c}},973730:(e,t,i)=>{"use strict";i.d(t,{EH:()=>n,gZ:()=>o,dX:()=>r});const n=3e4,o="failed to fetch",r="Request Timed Out"},787623:(e,t,i)=>{"use strict";i.d(t,{S:()=>a});var n=i(740597),o=i(974509),r=i(905581),s=i(132756);function a(e){return t=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=yield e(t);if(i.status>=o.qb.BAD_REQUEST)throw(0,r.Tr)(s.w5.RejectHttpError,s.jK.RemoteOperationFailed,"rejectHttpError",void 0,void 0,i);return i}))}},753279:(e,t,i)=>{"use strict";i.d(t,{W:()=>h});var n=i(697594),o=i(248187),r=i(719695),s=i(320202),a=i(958293),l=i(401363),c=i(130757),d=i(711259),u=i(559783),m=i(258532);const g=([e,t])=>(t&&e.do((()=>{}),(e=>{throw e})),e),h=(e,t)=>{const i=e.pipe((0,o.R)(((e,i)=>e||!t(i)),!1)),h=e.pipe((0,r.P)(t),(0,s.V)(5e3));return(0,n.z)((0,a.i)(),(0,l.M)(i),(0,c.U)(g),(0,d.a)((e=>e.pipe((0,u.w)(h)))),(0,m.D)())}},264011:(e,t,i)=>{"use strict";i.d(t,{s:()=>s,r:()=>a});var n=i(132756),o=i(614665),r=i(575644);function s(e,t){return i=>c((()=>e(i)),t)}function a(e,t){return i=>d(c((()=>e(i)),t),t)}const l=(e,t)=>{if(e.context===n.w5.RejectHttpError&&t.retryCount++<(t.policy.maxRetryCountForOffline||t.policy.maxRetryCount)&&t.policy.shouldRetryRejectHttpError)return t.policy.errorHandler(e,t);if(!e.serverResponse)throw e;const{serverResponse:{status:i}}=e;if(i&&t.retryCount++<t.policy.maxRetryCount&&t.policy.shouldRetry(i))return t.retriesTable[i]=(t.retriesTable[i]||0)+1,t.policy.errorHandler(e,t);throw e},c=(e,t)=>(0,o.X)(e,l)({policy:t,delay:t.createDelay(),retryCount:0,retriesTable:{}}),d=(e,t)=>(0,r.E)(e,t.retryMaxTimeMs)},535674:(e,t,i)=>{"use strict";i.d(t,{A:()=>s});var n=i(401110),o=i(575644),r=i(973730);const s=({url:e,method:t,body:i,headers:s,credentials:a,timeout:l=r.EH,skipHeaders:c=!1})=>{const d=new AbortController;return(0,o.E)(n(e,{method:t,headers:c?{}:s&&new Headers(s),body:i,credentials:a,signal:d.signal}),l,r.dX,d).then((e=>{const t={};return e.headers.forEach(((e,i)=>t[i]=e)),{status:e.status,headers:t,body:e,url:e.url}}))}},891772:(e,t,i)=>{"use strict";i.d(t,{l:()=>l});var n=i(500254),o=i(740597),r=i(412938);var s=i(535674),a=i(907550);const l=(0,n.E)(function(e){return t=>(0,o.__awaiter)(this,void 0,void 0,(function*(){let n,o;const s=performance.now(),a=new Date;try{return o=yield e(t),o}catch(e){throw n=e.code||e.message,o=e.serverResponse,e}finally{const e=performance.now();!function(e,t,n,o,s){const a=i.g;(0,r.Lk)(o,t,n,e,e&&function(e){const t=performance.getEntriesByName(e);if(t.length>0&&"resource"===t[t.length-1].entryType)return t[t.length-1];return}(e.url),a,s)}(o,a,t,e-s,n)}}))}((0,a.p)(s.A)))},71119:(e,t,i)=>{"use strict";i.d(t,{r:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataApolloClientTacoArchiveTeamInfoQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"archiveTeamResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"archiveSharepointSite"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ArchiveTeamResult"}}},arguments:[]}]}}]}},701543:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"deletedMessages"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletedMessages"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"message"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"messageFieldsForDeletedMessages"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Message"}},arguments:[]}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DeletedMessage"}}}},arguments:[]}]}},...i(291768).j4.definitions]}},790888:(e,t,i)=>{"use strict";i.d(t,{C:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"dlpDialogData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"dlpDialogData"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isReport"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isOverride"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"justification"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"DlpDialogData"}},arguments:[]}]}}]}},434217:(e,t,i)=>{"use strict";i.d(t,{v:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"smartReplyFileSuggestion"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"smartReplyFileSuggestion"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fileName"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"url"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SmartReplyFileSuggestion"}}}]}}]}},403588:(e,t,i)=>{"use strict";i.d(t,{Om:()=>l,Ng:()=>c});var n=i(74583),o=i(50805);const r=[{predicate:e=>!!e.get(o.J.Presence).enablePresenceInWorker,resolvers:{query:["presence","presences"],mutation:["setPresence","setStatusNote","setCallStatePresence"],subscription:["presenceUpdateEvent","presenceUpdateEventBatch"]}},{predicate:e=>!!e.get(o.J.Host).enableEspInWorker||!!e.get(o.J.Esp).enableEsp,resolvers:{query:["espState","irisCampaign"],mutation:["recordEligibleSurface","recordDisplayedSurface","recordEspCompletedActions","triggerNotificationDisplay","triggerTfwNotificationDisplay"],subscription:["espTriggerEvent","espSurfaceShownEvent","espSurfacesUpdateEvent"]}},{predicate:e=>!!e.get(o.J.Guardians).enableMembersAndRelatedContactsWorkerResolver,resolvers:{query:["membersAndRelatedContacts"],mutation:[],subscription:[]}},{predicate:e=>!!e.get(o.J.Guardians).enableRelatedContactsWorkerResolver,resolvers:{query:["relatedContacts"],mutation:[],subscription:[]}},{predicate:e=>{var t,i;return!(!(null===(t=e.get(o.J.Host))||void 0===t?void 0:t.enableHybridDiscoverSurface)&&!(null===(i=e.get(o.J.DiscoverSurface))||void 0===i?void 0:i.enableHybridDiscoverSurface))},resolvers:{query:["feed"],mutation:["feedback","discoverSurfaceUserPreferenceForEntities","removeHasUpdatedItemsFlag","startPolling","stopPolling","userActionFeedbackLog","sendDiscoverFeedRenderAction","setLastVisitedSurface"],subscription:["replyChainSummaryEvent","discoverFeedHasUpdatedItems","feedEvent"]}},{predicate:e=>!!e.get(o.J.WhatsNew).enableWhatsNew,resolvers:{query:["whatsNewState"],mutation:["recordWhatsNewDisplayedFeature","recordWhatsNewEntryPointPromotion","recordWhatsNewEntryPointUserAction"],subscription:[]}},{predicate:e=>!!e.get(o.J.People).enableBatchUsersByEmailsAndPhonesWorkerResolver,resolvers:{query:["batchUsersByEmailsAndPhones"],mutation:[],subscription:[]}}],s=[{predicate:e=>!!e.get(o.J.Host).enableOfflineActionsManager&&!!e.get(o.J.Host).msgEnableOfflineReactions,resolvers:{query:[],mutation:["updateMessageEmotion"],subscription:[]}},{predicate:e=>!!e.get(o.J.Messaging).msgEnableAutoSetConsumptionHorizonResolver,resolvers:{query:[],mutation:["setConsumptionHorizon"],subscription:[]}},{predicate:e=>!!e.get(o.J.Extensibility).enableAdaptiveAppletCacheFromCDL,resolvers:{query:[],mutation:["cardCacheOperation"],subscription:[]}}],a=()=>({query:[],mutation:[],subscription:[]});function l(e,t,i){const{experimentalResolvers:r,stableResolvers:l}=e.get(o.J.Cdl),c=l&&l.resolvers&&(0,n.pick)(l.resolvers,["query","mutation","subscription"])||a();if(t.log(`Supported operations from config: ${JSON.stringify(c,m)}`),l&&l.version&&r&&r.version&&l.version>=r.version){const e=r.resolvers&&(0,n.pick)(r.resolvers,["query","mutation","subscription"])||a();t.log(`Supported operations from ECS: ${JSON.stringify(e,m)}`),(0,n.mergeWith)(c,e,g)}h(c,s,e,t);const p=(0,n.mapValues)(c,(e=>e?new Set(e):new Set)),{dataLayerSettings:v}=e.get(o.J.Host),y=v&&(0,n.pick)(v,["query","mutation","subscription"]);return i?d(y,p,t,"Angular"):u(y,"supportedResolversFromMainWindow",p,"resolversFromConfiguration",t,"Angular")}function c(e,t,i,s){const l=function(e,t){var i;let o;try{if(!t)throw new Error("CDL Worker did not return supported operations");o=JSON.parse(t)}catch(t){null===(i=e.errorToTelemetry)||void 0===i||i.call(e,`getWorkerSupportedOperations: Failed to set CDL Worker supported operations: ${t&&t.message}`,"cdl_worker_manager_get_worker_supported_operations_error",void 0,!0),o={query:[],mutation:[],subscription:[]}}const r=(0,n.mapValues)(o,(e=>e?new Set(e):new Set));return(0,n.pick)(r,["query","mutation","subscription"])}(t,i),{supportedResolvers:c,activitySupportedResolvers:m,mtmaMissedNotificationsSupportedResolvers:p,calendarSupportedResolvers:v,chatSupportedResolvers:y,chatPartiallySupportedResolvers:f,phonelinkSmsSupportedResolvers:S,appsUsageResolvers:k,tabsUsageResolvers:b,peopleTargetingSupportedResolvers:w,tflFeaturedCommunitiesSupportedResolvers:C}=e.get(o.J.CdlWorker),_=function(e){const t=a();return e.forEach((e=>e&&(0,n.mergeWith)(t,e,g))),t}([c,m,p,v,y,f,S,k,b,w,C]),T=(0,n.pick)(_,["query","mutation","subscription"]);return h(T,r,e,t),s?d(T,l,t,"Worker"):u(T,"resolversFromConfiguration",l,"supportedOperationsFromCDLWorker",t,"Worker")}function d(e,t,i,o){if(!e)return{query:new Set,mutation:new Set,subscription:new Set};i.log(`Supported operations received from ${o}: ${JSON.stringify(e,m)}`);const r=(0,n.mapValues)(e,((e,i)=>new Set(e.filter((e=>t[i]&&t[i].has(e))))));return i.log(`Merged datalayer settings with config: ${JSON.stringify(r,m)}`),r}function u(e,t,i,n,o,r){const s=function(e,t,i){const n={query:{},mutation:{},subscription:{}};return Object.keys(n).forEach((o=>{const r=e[o];if(r)for(const e of r)n[o][e]={fieldName:e,active:i,configurationDescription:t}})),n}(i,n,!1);return e?(Object.keys(e).forEach((i=>{if(!s[i])return;const n=e[i];if(n)for(const e of n){const n=s[i][e];n?n.active=!0:s[i][e]={fieldName:e,active:!1,configurationDescription:t}}})),function(e,t,i){const n={};Object.keys(t).forEach((e=>{const i=t[e];Object.keys(i).forEach((t=>{const o=i[t];if(!o.active){const t=o.configurationDescription;n[t]||(n[t]={query:[],mutation:[],subscription:[]}),n[t][e].push(o.fieldName)}}))})),Object.keys(n).forEach((t=>{const o=n[t],r=o.query,s=o.mutation,a=o.subscription;if(r.length>0||s.length>0||a.length>0){const n=`GraphQL Link for ${e}: ${t} has unsupported resolvers: query= ${r.length}, mutation=${s.length}, subscription=${a.length}.`;i.log(n)}}))}(r,s,o),s):(o.log(`No supported resolvers for ${r}`),s)}const m=(e,t)=>"object"==typeof t&&t instanceof Set?Array.from(t):t,g=(e,t)=>(0,n.isArray)(e)?e.concat(t):void 0;function h(e,t,i,o){const r=a();t.forEach((({predicate:e,resolvers:t})=>{e(i)&&(0,n.mergeWith)(r,t,g)})),o.log(`Supported additional operations: ${JSON.stringify(r,m)}`),(0,n.mergeWith)(e,r,g)}},454029:(e,t,i)=>{"use strict";i.d(t,{zz:()=>c,nG:()=>l,Fj:()=>d});var n=i(905581),o=i(132756),r=i(74583),s=i(701820);const a=(e,t)=>{let i=null;try{i=e.readQuery({query:s.gv.currentFilesQuery,variables:{fileContainerId:t}})}catch(e){}return i||(i={currentFiles:[]}),i.currentFiles},l=(e,t,i)=>a(i,t).find((t=>t.id===e)),c=(e,t,i)=>{const n={currentFiles:[...a(t,i).map((t=>{const i=e.findIndex((e=>e.id===t.id));if(-1===i)return t;const n=e[i];e.splice(i,1);return(0,r.merge)({},t,n)})),...e]};t.writeQuery({query:s.gv.currentFilesQuery,variables:{fileContainerId:i},data:n})},d=(e,t,i)=>{const r=a(i,t),l=r.find((t=>t.id===e));if(!l)throw(0,n.Tr)("FileUploadResolver",o.jK.NotPresent,"removecachefile",{logErrorMessage:`File with id: ${e} not found  in the cache`});const c=r.filter((t=>t.id!==e));return i.writeQuery({query:s.gv.currentFilesQuery,variables:{fileContainerId:t},data:{currentFiles:c}}),l}},185e3:(e,t,i)=>{"use strict";i.d(t,{k:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"customAppUploadResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customAppUploadResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customAppType"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CustomAppType"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CustomAppUploadResult"}}},arguments:[]}]}}]}},836666:(e,t,i)=>{"use strict";i.d(t,{g:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppDevicePermissionsUpdatedQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appDevicePermissionsUpdated"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"input"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"status"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppDevicePermissionsUpdatedStatus"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"AppDevicePermissionsUpdated"}}}]}}]}},315280:(e,t,i)=>{"use strict";i.d(t,{Q:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppsBadgeReadQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appsBadgeRead"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]}}]}},2300:(e,t,i)=>{"use strict";i.d(t,{I:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformInContextStoreLaunchInstalledAppResultQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"inContextStoreLaunchInstalledAppResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"capability"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"appDisplayName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"draftId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"InContextStoreLaunchInstalledAppResult"}},arguments:[]}]}}]}},612034:(e,t,i)=>{"use strict";i.d(t,{r:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformTabDeletionResultQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"threadId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelMeetingMessageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tabDeletionResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"threadId"},value:{kind:"Variable",name:{kind:"Name",value:"threadId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"Argument",name:{kind:"Name",value:"channelMeetingMessageId"},value:{kind:"Variable",name:{kind:"Name",value:"channelMeetingMessageId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"channelMeetingMessageId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tabId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"TabDeletionResult"}}}]}}]}},868521:(e,t,i)=>{"use strict";i.d(t,{F:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messageExtensionsAppsState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageExtensionsAppsState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toggleRefetch"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MessageExtensionsAppsState"}}}}]}}]}},511523:(e,t,i)=>{"use strict";i.d(t,{s:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"tabConfigurationResult"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"threadId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tabConfigurationResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"threadId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tabId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"tabConfigurationResult"}}}]}}]}},776806:(e,t,i)=>{"use strict";i.d(t,{S:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webhookConfirmationResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webhookConfirmationResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]}}]}},790997:(e,t,i)=>{"use strict";i.d(t,{w:()=>a});var n=i(58826),o=i(238446),r=i(74583);function s(e,t,i=!0,o){var s,a,l;let c=[];try{if(o.enableDecoupleCommandingFromApollo)c=o.getActiveWindows();else{const i=null===(s=e.readQuery({query:n.i8}))||void 0===s?void 0:s.activeWindows;i||null===(a=t.errorToTelemetry)||void 0===a||a.call(t,"cache.readquery has returned undefined or null for activeWindowsQuery","webclient_framework_foundation_core_services_entity_commanding",void 0,!0),c=i||[]}}catch(e){null===(l=t.errorToTelemetry)||void 0===l||l.call(t,"cache.readQuery failed for activeWindowsQuery","webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}return i?(0,r.cloneDeep)(c):c}const a=()=>({Query:{activeWindows:(e,t,{cache:i,loggerFactory:n,activeWindowsService:o})=>s(i,n.newLogger("activeWindows-query","data-client-windows"),!1,o)},Mutation:{removeWindow(e,{windowId:t},{cache:i,loggerFactory:r,commandChangeReportingService:a,activeWindowsService:l}){const c=r.newLogger("removeWindow-mutation","data-client-windows"),d=s(i,c,!0,l),u=d.findIndex((e=>e.id===t));if(u>=0){const e=function(e,t,i,o){const r=e.splice(t,1);return o.enableDecoupleCommandingFromApollo?o.removeActiveWindowById(r[0].id):i.writeQuery({query:n.i8,data:{activeWindows:e}}),r[0]}(d,u,i,l);return a.report({type:o.B.Close,correlationId:e.correlation.id,context:{target:"remove-window-mutation"},userContextId:e.userContextId||void 0}),e}return c.warn(`Removing window that does not exist ${t}`),null}}})},273586:(e,t,i)=>{"use strict";i.d(t,{k:()=>o});var n=i(58826);function o(e){e.writeQuery({query:n.i8,data:{activeWindows:[]}})}},286795:(e,t,i)=>{"use strict";i.d(t,{g:()=>n});const n={M365Application:["M365HubApplication","M365PlatformApplication"],M365ApplicationIcon:["InternalIcon","RemoteImage"],M365ApplicationsUpdated:["M365ApplicationsBadgeUpdated","M365ApplicationsConnectionUpdated"],M365ApplicationBadge:["M365ApplicationNumericBadge","M365ApplicationDotBadge","M365ApplicationStringBadge"],EventTrigger:["AppAcquisitionLink","AppSecondaryAction"],Node:["M365HubApplication","M365PlatformApplication","Conversation","Me","FullAccount","Cloud","ActiveTenant","InactiveTenant","MeInOtherTenant","Person","MePresence","PersonPresence","AvailabilityOption"],ConnectionEdge:["M365ApplicationEdge","AccountEdge","TenantEdge"],ConnectionEdgeWithCursorPagination:[],Connection:["M365ApplicationConnection","AccountConnection","TenantConnection"],ConnectionWithCursorPagination:[],MutationFailure:["PresenceMutationFailure","PresenceMutationFailureNetworkOffline"],BaseAccount:["FullAccount","Cloud"],Account:["FullAccount","Cloud"],Tenant:["ActiveTenant","InactiveTenant"],BaseTenant:["ActiveTenant","InactiveTenant"],Persona:["Me","MeInOtherTenant","Person"],Individual:["Me","MeInOtherTenant","Person"],Presence:["MePresence","PersonPresence"],PresenceExpiry:["PresenceExpiryPreDefined","PresenceExpiryCustom"],PresenceMutationResult:["PresenceMutationSuccess","PresenceMutationFailure","PresenceMutationFailureNetworkOffline"]}},651998:(e,t,i)=>{"use strict";i.d(t,{wf:()=>B,s_:()=>W});var n=i(740597),o=i(516909);const r=e=>e&&!!e.wamsStreamingUrl&&!!e.decryptionToken,s=(e,t,i)=>{var n,s,a,l;return{__typename:"Broadcast",id:e,admissionType:i.admissionType,type:t?o.G7.Overflow:o.G7.QuickStart,userRole:i.userRole||o.tf.Attendee,correlationId:i.correlationId,title:i.subject,utcStart:i.utcStart||null,utcEnd:i.utcEnd||null,location:i.location||null,streamingDetails:c(e,i),qna:Object.assign(Object.assign({},i.qna),{isEnabled:(null===(n=i.qna)||void 0===n?void 0:n.isEnabled)||!1,attendeeUrl:(null===(s=i.qna)||void 0===s?void 0:s.attendeeUrl)||"",moderatorUrl:(null===(a=i.qna)||void 0===a?void 0:a.moderatorUrl)||"",iosAutodiscoverUrl:(null===(l=i.qna)||void 0===l?void 0:l.iosAutodiscoverUrl)||"",__typename:"BroadcastQnaMetadata"}),yammer:i.yammer&&{__typename:"BroadcastYammerMetadata",broadcastId:i.yammer.broadcastId,groupId:i.yammer.groupId,isEnabled:i.yammer.isEnabled,eventUrl:i.yammer.event}||null,meetingStatus:i.meetingStatus||(r(i.stream)||r(i.altStream)?o.lf.Live:o.lf.Created),supportUrl:i.supportUrl,sdn:u(i)||null,transcription:g(e,i),aesKey:Object.assign({__typename:"AESKey"},h(i)),aesKeyRefresh:i.aesKeyRefresh,error:i.error||null,signalR:Object.assign({__typename:"SignalRDetails"},p(i)),streamResource:v(i),broadcastRestartVersion:i.broadcastRestartVersion||0,odspVodShareUrl:i.odspVodShareUrl||null,access:y(i),byoe:(null==i?void 0:i.byoe)||null}},a=e=>({__typename:"BroadcastAttendeeStream",wamsStreamingUrl:null==e?void 0:e.wamsStreamingUrl,decryptionToken:null==e?void 0:e.decryptionToken}),l=e=>({__typename:"BroadcastStreamingInfo",wamsStreamingUrl:(null==e?void 0:e.wamsStreamingUrl)||null,wamsHlsStreamingUrls:null,decryptionToken:(null==e?void 0:e.decryptionToken)||null,decryptionKey:{key:null,value:null},setKeyAuthorizationCookieUri:null,keyAuthorizationToken:null,sdn:d(e)||null,deliveryPipelineType:"AMS"}),c=(e,t)=>({__typename:"BroadcastStreamingDetails",id:e,stream:l(t.stream),altStream:l(t.altStream)}),d=e=>e&&e.sdnName&&e.sdnPluginUrl&&{__typename:"SDNDetails",name:e.sdnName,playbackInfo:e.sdnPlaybackInfo||"",pluginUrl:e.sdnPluginUrl,sdkUrl:""}||void 0,u=e=>e.stream&&d(e.stream)||e.altStream&&d(e.altStream),m=e=>e/1e3,g=(e,t)=>{var i,n,o,r,s,a;return{__typename:"BroadcastTranscription",id:e,isEnabled:null===(i=t.transcription)||void 0===i?void 0:i.isEnabled,isSuppressed:null===(n=t.transcription)||void 0===n?void 0:n.isSuppressed,translationLanguages:null===(o=t.transcription)||void 0===o?void 0:o.translationLanguages,transcriptionLanguage:null===(r=t.transcription)||void 0===r?void 0:r.transcriptionLanguage,captionsOriginUrl:null===(s=t.transcription)||void 0===s?void 0:s.captionsOriginUrl,captionsCacheUrl:null===(a=t.transcription)||void 0===a?void 0:a.captionsCacheUrl}},h=e=>{var t,i,n,o;return{id:(null===(t=e.aesKey)||void 0===t?void 0:t.id)||"",iv:(null===(i=e.aesKey)||void 0===i?void 0:i.iv)||"",expiry:(null===(n=e.aesKey)||void 0===n?void 0:n.expiry)||"",key:(null===(o=e.aesKey)||void 0===o?void 0:o.key)||""}},p=e=>{var t,i,n,o,r;return{attendeeHubName:(null===(t=null==e?void 0:e.signalR)||void 0===t?void 0:t.attendeeHubName)||null,eventTeamHubName:(null===(i=null==e?void 0:e.signalR)||void 0===i?void 0:i.eventTeamHubName)||null,url:(null===(n=null==e?void 0:e.signalR)||void 0===n?void 0:n.url)||null,querystrings:(null===(o=null==e?void 0:e.signalR)||void 0===o?void 0:o.querystrings)||null,setCookieUrl:(null===(r=null==e?void 0:e.signalR)||void 0===r?void 0:r.setCookieUrl)||null}},v=e=>{var t,i;return{__typename:"StreamResource",attendeeEmbed:(null===(t=e.streamResource)||void 0===t?void 0:t.attendeeEmbed)||"",encoderSource:(null===(i=e.streamResource)||void 0===i?void 0:i.encoderSource)||null}},y=e=>{var t,i,n;return(null==e?void 0:e.access)&&{__typename:"BroadcastAccess",useLiveEventAuthorizationV2:null===(t=null==e?void 0:e.access)||void 0===t?void 0:t.useLiveEventAuthorizationV2,disableLobby:null===(i=null==e?void 0:e.access)||void 0===i?void 0:i.disableLobby,inInvitation:null===(n=null==e?void 0:e.access)||void 0===n?void 0:n.inInvitation,attendeeAuthorization:f(e)}||void 0},f=e=>{var t;return(null===(t=null==e?void 0:e.access)||void 0===t?void 0:t.attendeeAuthorization)&&{__typename:"BroadcastAttendeeAuthorization",errorCode:e.access.attendeeAuthorization.errorCode,subCode:e.access.attendeeAuthorization.subCode,details:e.access.attendeeAuthorization.details}||void 0};const S={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"broadcast"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"roleHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"broadcast"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"roleHint"},value:{kind:"Variable",name:{kind:"Name",value:"roleHint"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"broadcastFragment"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Broadcast"}}}}]}},...i(362526)._L.definitions]},k={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showInMeetingReport"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferences"}}},arguments:[]}]}}]};var b=i(933736),w=i(738646),C=i(755083),_=i(905581);const T=e=>{const[t,i,n,r,s]=e.split("__");return{tenantId:t,organizerId:i,threadId:n,messageId:r,sessionId:s,roleHint:o.tf.Attendee}},I=(e,t,i,o,r,a)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{const n=(0,C.G5)(t),l=e.readQuery({query:S,variables:{id:n}});if(l)return l.broadcast;{const l=yield i.getAttendeeMeeting(o),c=s(t,r,l);return j(e,a,n,c),c}}catch(e){throw a.error(e),e}})),j=(e,t,i,n)=>{const o={broadcast:n};try{e.writeQuery({query:S,variables:{id:i},data:o})}catch(e){t.error(e)}},N=(e,t,i,o,r,s,a,l,c,d,u)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,m;if(E(e))return!1;const g=x(a,o,r,c,l,d),h=R(o,i);s.joinId=null===(m=null===(n=null==e?void 0:e.signalR)||void 0===n?void 0:n.querystrings)||void 0===m?void 0:m.joinid;const p=P(o,s,i,g,l,a,r,e.meetingStatus);try{const n=!r||u;return e.signalR&&e.signalR.url&&!e.error&&n?(yield t.subscribeToBroadcast(o,e.signalR,g,h,p),!0):!e.error&&(i.startPollingAttendeeMeeting(o,s,g,e.meetingStatus,!0),!0)}catch(t){return l.error(t),i.startPollingAttendeeMeeting(o,s,g,e.meetingStatus,!0),!0}})),E=e=>{var t;return e.meetingStatus===o.lf.Stopped&&(null===(t=e.streamingDetails)||void 0===t?void 0:t.stream.wamsStreamingUrl)},x=(e,t,i,n,o,r)=>(a,l)=>{const d=A(r,t);let u="",m="";try{const r=(0,C.G5)(t),h=n.readQuery({query:S,variables:{id:r}}),p=null==h?void 0:h.broadcast;let v;if(p)if(v=Object.assign({},p),l===b.N.transcriptionStateUpdate)v.transcription=g(t,a),u="SignalR",m=b.N.transcriptionStateUpdate;else if(l===b.N.streamUpdateHubEvent){const e=c(t,a);if(D(e,p.streamingDetails))return void d.stop({broadcastData:"Duplicated update skipped"});v.streamingDetails=F(p,e),v.broadcastRestartVersion=a.broadcastRestartVersion,v.meetingStatus=O(p.broadcastRestartVersion,a.broadcastRestartVersion),u="SignalR",m=b.N.streamUpdateHubEvent}else v=Object.assign({},s(t,i,a)),u="Attendee Polling";else v=Object.assign({},s(t,i,a));const y=M(v);o.log(y),d.stop({broadcastData:JSON.stringify({updateSource:u,updateType:m,details:y})}),e.publish(`${b.V}-${t}`,{broadcastUpdatedEvent:v}),o.log(`New broadcast info successfully published for ${t}`),j(n,o,r,v)}catch(e){o.error(e),d.fail({broadcastData:`Error while processing broadcast update. updateSource: ${u}, updateType: ${m}`,broadcastError:e&&e.message})}},A=(e,t)=>{const i=e.newScenario(w.RG.BroadcastSubscriptionUpdate);return i.appendEventData({"Thread.Id":(0,C.G5)(t)}),i},D=(e,t)=>(null==e?void 0:e.stream.wamsStreamingUrl)===(null==t?void 0:t.stream.wamsStreamingUrl)&&(null==e?void 0:e.altStream.wamsStreamingUrl)===(null==t?void 0:t.altStream.wamsStreamingUrl),F=(e,t)=>{var i,n,o;return{__typename:"BroadcastStreamingDetails",stream:(null==t?void 0:t.stream)||(null===(i=e.streamingDetails)||void 0===i?void 0:i.stream),altStream:(null==t?void 0:t.altStream)||(null===(n=e.streamingDetails)||void 0===n?void 0:n.altStream),id:(null==t?void 0:t.id)||(null===(o=e.streamingDetails)||void 0===o?void 0:o.id)}},O=(e,t)=>(t=t||0)>(e=e||0)?o.lf.Suspended:o.lf.Created,M=e=>{var t,i,n,o,r,s,a,l;const c=e.broadcastRestartVersion,d=e.meetingStatus,u=null===(i=null===(t=e.streamingDetails)||void 0===t?void 0:t.stream)||void 0===i?void 0:i.wamsStreamingUrl,m=!!(null===(o=null===(n=e.streamingDetails)||void 0===n?void 0:n.stream)||void 0===o?void 0:o.decryptionToken),g=null===(s=null===(r=e.streamingDetails)||void 0===r?void 0:r.altStream)||void 0===s?void 0:s.wamsStreamingUrl,h=!!(null===(l=null===(a=e.streamingDetails)||void 0===a?void 0:a.altStream)||void 0===l?void 0:l.decryptionToken),p=e.transcription;return`broadcastRestartVersion: ${c}, meetingStatus: ${d}, stream: ${u}, isDecryptionTokenAvailable: ${m}, altStream: ${g}, isAltDecryptionTokenAvailable: ${h}, isTranscriptionEnabled: ${null==p?void 0:p.isEnabled}, isTranscriptionSuppressed: ${null==p?void 0:p.isSuppressed}`},R=(e,t)=>()=>{t.stopPollingAttendeeMeeting(e)},P=(e,t,i,n,o,r,s,a)=>l=>{if(!l){o.log("broadcast-subscripotion disconnect callback called not intentionally. Subscribing to attendee service polling.");try{i.startPollingAttendeeMeeting(e,t,n,a,!1)}catch(t){L(o,r,t.message,e,s)}}},L=(e,t,i,n,o)=>{e.error("Error while starting broadcast updates subscription");const r=s(n,o,{error:{errorMessage:i}});t.publish(`${b.V}-${n}`,{broadcastUpdatedEvent:r})};var U=i(50805);const W={Query:{broadcastAttendeeMeeting(e,{broadcastAttendeeMeetingParams:t},{cache:i,coreSettings:o,getBroadcastAttendeeService:r,loggerFactory:s}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=o.get(U.J.MeetingArtifacts);let n=!0;const l=s.newLogger("broadcastAttendeeMeetingQuery","data-resolvers-browser-broadcast-attendee"),{overflowAttendance:c}=e;if(t){if(c)try{n=((e,t)=>{var i;if("Disabled"===t)return!1;if("Enabled"===t)return!0;const n=!(!e||!e.userPreferences||"true"!==e.userPreferences.showInMeetingReport&&"false"!==e.userPreferences.showInMeetingReport);return"EnabledUserOverride"===t?!n||"false"!==(null===(i=null==e?void 0:e.userPreferences)||void 0===i?void 0:i.showInMeetingReport):"DisabledUserOverride"!==t||!!n&&"false"!==(null==e?void 0:e.userPreferences.showInMeetingReport)})(i.readQuery({query:k}),e.allowTrackingInReportPolicy)}catch(e){l.error("Failed to fetch allowTrackingInReportPolicy"),l.error(e)}return{__typename:"BroadcastAttendeeMeeting",id:(d=yield(yield r()).getAttendeeMeeting(Object.assign(Object.assign({},t),{allowTrackingInReport:n}))).correlationId,title:d.subject,stream:a(d.stream),altStream:a(d.altStream),qna:d.qna,yammer:d.yammer&&{__typename:"YammerMetadata",broadcastId:d.yammer.broadcastId,groupId:d.yammer.groupId,isEnabled:d.yammer.isEnabled,eventUrl:d.yammer.event},supportUrl:d.supportUrl}}return null;var d}))},broadcastCaptions(e,{id:t,broadcastId:i,culture:o,currentPlayerTime:r},{cache:s,getBroadcastCaptionsService:a,loggerFactory:l}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=l.newLogger("broadcastCaptionsQuery","data-resolvers-browser-broadcast-attendee");if(!t&&!i||!o)return e.error("Invalid params sent to broadcastCaptions Query"),Promise.reject("Invalid params sent to broadcastCaptions Query");e.log(`Fetching the captions for: ID: ${t}, Culture: ${o}, Time: ${r}`);const n=t||(0,C.G5)(i);try{const e=s.readQuery({query:S,variables:{id:n}});if(e&&e.broadcast.aesKey&&e.broadcast.transcription){const t={aesKey:e.broadcast.aesKey,aesKeyRefresh:e.broadcast.aesKeyRefresh,correlationId:e.broadcast.correlationId,transcription:e.broadcast.transcription},i=yield a();i.setCurrentCaptionLanguage(n,o);return(e=>{const t=[];for(const i of e){if(""===i.Text)continue;const e={__typename:"Captions",start:m(i.TimestampMs),text:i.Text,end:m(i.EndTimestampMs)};t.push(e)}return t})(yield i.getCaptions(r,n,t,o))}}catch(t){e.error("Failed to fetch captions"),e.error(t)}return Promise.resolve([])}))},broadcast(e,{id:t,roleHint:i,joinId:r},{getBroadcastAttendeeService:a,loggerFactory:l}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const[e,n,c,d,u]=t.split("__");if(!(e&&n&&c&&d)){const e=`Invalid Id: ${t}`;throw l.newLogger("broadcast","data-resolvers-browser-broadcast-attendee").error(e),new Error(e)}const m=!!u,g=m?o.G7.Overflow:o.G7.QuickStart,h=yield(yield a()).getAttendeeMeeting({tenantId:e,organizerId:n,threadId:c,messageId:d,sessionId:u,roleHint:i,broadcastType:g,joinId:r||void 0});return s(t,m,h)}))}},Mutation:{startLiveStreamCaptions(e,{id:t,liveStreamId:i,culture:o},{cache:r,getBroadcastCaptionsService:s,getLiveStreamRenderingService:a,loggerFactory:l}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=l.newLogger("liveStreamCaptionsMutation","data-resolvers-browser-broadcast-attendee");try{const n=r.readQuery({query:S,variables:{id:t}});if(!n)throw new Error("Could not find broadcast data");const l=yield a(),c=yield s(),d=()=>l.getDiagnosticData(i).then((t=>(e.log(`The times are: ${t.currentAbsoluteTime}, ${t.currentMediaTime}, ${t.currentPlayPosition}`),t.currentAbsoluteTime))),u=e=>{l.addCues(i,e)},m={aesKey:n.broadcast.aesKey,aesKeyRefresh:n.broadcast.aesKeyRefresh,correlationId:n.broadcast.correlationId,transcription:n.broadcast.transcription};c.startCaptionsForStream(i,t,m,o,!1,"AzureMediaPlayer",d,u)}catch(t){e.error("Failed to fetch captions"),e.error(t)}return null}))},stopLiveStreamCaptions(e,{liveStreamId:t},{getBroadcastCaptionsService:i,getLiveStreamRenderingService:o,loggerFactory:r}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=r.newLogger("liveStreamCaptionsMutation","data-resolvers-browser-broadcast-attendee");e.log(`Stopping captions for stream ${t}`);try{const e=yield i(),n=yield o();return e.stopCaptionsForStream(t),n.clearCues(t),!0}catch(i){return e.error(`Error while stopping captions for stream ${t}`),e.error(i),!1}}))},toggleLiveStreamCaptionButton(e,{liveStreamId:t,shouldShowButton:i},{getLiveStreamRenderingService:o,loggerFactory:r}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=r.newLogger("toggleLiveStreamCaptionButton","data-resolvers-browser-broadcast-attendee");e.log(`Setting the caption button visibility in the player to ${i} for stream ${t}`);try{return(yield o()).showCaptions(t,i),!0}catch(n){return e.error(`Error while setting the caption button to ${i} for stream ${t}`),!1}}))},subscribeToBroadcastUpdates(e,{id:t},{loggerFactory:i,getBroadcastAttendeeService:o,getBroadcastSignalRService:r,pubsub:s,cache:a,coreSettings:l,scenarioFactory:c}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield o(),d=yield r(),u=i.newLogger("broadcastSubscribe","data-resolvers-browser-broadcast-attendee"),{enableSignalrForOverflow:m}=l.get(U.J.Broadcast),g=yield((e,t,i,o,r,s,a,l)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=T(e),c=!!n.sessionId;try{const d=yield I(r,e,t,n,c,s);return d?(o.publish(`${b.V}-${e}`,{broadcastUpdatedEvent:d}),yield N(d,i,t,e,c,n,o,s,r,a,l)):(L(s,o,"Error subscribing to broadcast updates",e,c),!1)}catch(t){return s.error(t),L(s,o,(0,_.VK)(t),e,c),!1}})))(t,e,d,s,a,u,c,!!m);return g}))},unsubscribeFromBroadcastUpdates(e,{id:t},{getBroadcastAttendeeService:i,getBroadcastSignalRService:o,loggerFactory:r}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=r.newLogger("broadcastUnsubscribe","data-resolvers-browser-broadcast-attendee");e.log(`Stopping subscription for broadcast ${t}`);try{(yield i()).stopPollingAttendeeMeeting(t);return(yield o()).unsubscribeFromBroadcast(t),!0}catch(i){return e.error(`Error while unsubscribing from broadcast ${t}`),e.error(i),!1}}))}},Subscription:{broadcastQnaFeedStatusEvent:{subscribe:(e,{id:t},{pubsub:i})=>i.asyncIterator(t)},broadcastUpdatedEvent:{subscribe:(e,{broadcastId:t},{pubsub:i})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return i.asyncIterator(`${b.V}-${t}`)}))}}},B=()=>({Mutation:{updateBroadcastQnaFeedStatus:(e,{id:t,isQnaFeedLoaded:i,hasNewMessages:n},{pubsub:o})=>(null==n&&null==i||o.publish(t,{broadcastQnaFeedStatusEvent:{isQnaFeedLoaded:!!i,hasNewMessages:!!n}}),{__typename:"BroadcastQnaFeedStatus",isQnaFeedLoaded:!!i,hasNewMessages:!!n})}})},982459:(e,t,i)=>{"use strict";i.d(t,{w:()=>a});var n=i(74583),o=i(878652);const r="calendarv2",s=e=>{const t=e.get(r);return t?(0,o.D)(t):{}},a={Query:{calendarSettingsFromLocalStorage:(e,t,{localStorage:i})=>(({shouldGetDateRangeType:e,shouldGetWorkHours:t,shouldGetWorkWeekDays:i},n)=>{const o=s(n);return{__typename:"ICalendarSettings",dateRangeType:e&&o.dateRangeType||null,workHours:t&&o.workHours?Object.assign({__typename:"IWorkHours"},o.workHours):null,workWeekDays:i&&o.workWeekDays||null,isLeftRailExpanded:o.isLeftRailExpanded}})(t,i)},Mutation:{saveCalendarSettingsInLocalStorage:(e,t,{localStorage:i})=>((e,t)=>{const i=s(t);return(0,n.forOwn)(e,((e,t)=>{null!=e&&(i[t]=e)})),t.trySet(r,JSON.stringify(i),"Calendar"),!0})(t,i)}}},19184:(e,t,i)=>{"use strict";i.d(t,{s:()=>Q});var n=i(740597),o=i(927168),r=i(545196),s=i(50805),a=i(793377),l=i(738646),c=i(916987),d=i(516909),u=i(402129),m=i(132756),g=i(905581),h=i(514958);const p=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=i.filter((e=>!e.shareUrl)).map((e=>e.id));if(0===n.length)return i;const o=yield e.shareDriveItems(n),r=new Map;o.forEach(((e,t)=>r.set(n[t],e)));const s=[];for(const e of i){const i=r.get(e.id);if(i){if(!i.link){const i=`ShareUrl (link.webUrl) is not present in createLink response for fileId: ${e.id}`,n={[h.z.internalErrorCode]:"ShareUrlIsMissingFromResponse",[h.z.logErrorMessage]:i};throw t.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat").error(`${i}. ${JSON.stringify(n)}`),(0,g.Tr)(m.w5.AddShareUrlOnSendMessage,m.jK.Undefined,"",n,i)}s.push(Object.assign(Object.assign({},e),{shareUrl:i.link.webUrl,shareId:i.shareId}))}else s.push(e)}return s})),v=e=>{var t;return!!(null===(t=null==e?void 0:e.files)||void 0===t?void 0:t.length)},y=(e,t,i)=>{const n=e.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat"),{reason:o}=i;if(o){const e={errorCode:o[h.z.internalErrorCode]||i.code||"ErrorCodeMissing",correlationId:o[h.z.correlationId],statusCode:o[h.z.httpCode],message:o[h.z.logErrorMessage]||"Log message is not present in reason bag",errors:o[h.z.logErrorMessage]};throw t.fail(e),n.error(`Failed to generate ShareUrl for files. ${JSON.stringify(e)}`),i}const r={errorCode:i.code||m.jK.Unknown,message:"thrown error is not an instance of IError. So not much data available",errors:`${i.context}_${i.subContext}`};throw t.fail(r),n.error(`Failed to generate ShareUrl for files and as well error is not instance of IError ${JSON.stringify(r)}`),i},f=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{return yield e()}catch(e){const n="Failed to lazy load drive item share service",o={[h.z.internalErrorCode]:e.code||"FailedToLazyLoadDriveItemShareService",[h.z.logErrorMessage]:n,innerError:e},r={errorCode:o[h.z.internalErrorCode],message:o[h.z.logErrorMessage]};i.fail(r);throw t.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat").error(`Failed to get DriveItemShareService. error: ${JSON.stringify(r)}`),(0,g.Tr)(m.w5.AddShareUrlOnSendMessage,m.jK.FailedToLazyLoadService,"",o,n)}})),S=e=>!!(null==e?void 0:e.files)&&!!(null==e?void 0:e.files.find((e=>"deeplink"===e.type)));var k=i(788667),b=i(74583),w=i(455572),C=i(663945),_=i(248965),T=i(711676),I=i(760005),j=i(500396),N=i(697337),E=i(200770),x=i(115272);const A={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"optionalTelemetry"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"optionalTelemetry"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidCorrelationId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"fluidDataLossOccurred"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"fluidDataLossPrevented"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasLoopComponentAndContent"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"embedLoopLinks"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"OptionalTelemetryDataBags"}},arguments:[]}]}}]};var D=i(451567),F=i(871538);const O=e=>{switch(e){case"Standard":return"NORMAL";case"Important":return"HIGH";case"Urgent":return"URGENT"}return null},M=e=>{var t;const i=null===(t=e.computed)||void 0===t?void 0:t.cards;if(!i)return!1;return!!(0,b.find)(i,(e=>"application/vnd.microsoft.card.fluid"===e.contentType||"application/vnd.microsoft.card.fluidEmbedCard"===e.contentType))},R=e=>{var t;if(W(e.content)>0)return!0;const i=null===(t=e.computed)||void 0===t?void 0:t.cards;return!!i&&i.some((e=>e.appName===F.SL))},P=e=>{var t;const i=null===(t=e.computed)||void 0===t?void 0:t.cards;if(i){const e=[];return i.forEach((t=>{e.push(t.appId)})),null==e?void 0:e.join(",")}return""},L=e=>{const t=new RegExp(N.T.reply,"g");return(e.match(t)||[]).length},U=(e,t)=>e.split(" ").filter((e=>e===`itemtype="${t}"`)).length,W=e=>e.split(" ").filter((e=>e===`type="${F.m7}"`)).length,B=e=>e?e.replace(/(<([^>]+)>)/gi,""):"",$=(e,t,i,n,o,r,s,a,l,c)=>{var d,u,m,g,h,p,v,y,f,S;return Object.assign(Object.assign({"DataBag.messagelength":B(e.content).length,"DataBag.size":e.content.length,"DataBag.importantflag":O(e.importance),"DataBag.messageType":a?l?"replyConversation":"newConversation":"Update"===t?"chatEdit":"newP2PMessage","DataBag.postType":"Announcement"===e.postType?"announcement":"normal","DataBag.richText":(S=e.messageType,"RichText/Html"===S),"DataBag.fluidCard":M(e),"DataBag.appId":P(e),"DataBag.sfbInteropMessage":"SfBInteropChat"===(null==r?void 0:r.chatType),"DataBag.mricollection":(null===(u=null===(d=null==r?void 0:r.memberIds)||void 0===d?void 0:d.map((e=>(0,T.Q2)(e))))||void 0===u?void 0:u.join(" "))||"","DataBag.rostersize":(null===(m=null==r?void 0:r.memberIds)||void 0===m?void 0:m.length)||0,"DataBag.attachments":(null===(g=e.files)||void 0===g?void 0:g.length)||0,"DataBag.attachmentIds":(null===(p=null===(h=e.files)||void 0===h?void 0:h.map((e=>e.id)))||void 0===p?void 0:p.join(" "))||"","DataBag.fileTypeList":(null===(y=null===(v=e.files)||void 0===v?void 0:v.map((e=>e.type)))||void 0===y?void 0:y.filter((e=>!(0,b.isNil)(e))))||[],"DataBag.suggestedFile":null===(f=e.files)||void 0===f?void 0:f.some((e=>"smartReply"===e.context)),"DataBag.leftRailDirective":a?"channel-list":"chat-list","Messaging.messageChannelType":c,"DataBag.messageID":e.id!==e.clientMessageId?e.id:void 0,"DataBag.replyChainId":l,"DataBag.isNewChat":!!s,"DataBag.newChatIntentId":s,"DataBag.tflOffNetworkEmailCount":(null==r?void 0:r.memberIds)?r.memberIds.filter((e=>e.startsWith(I.b6))).length:0,"DataBag.tflOffNetworkOneWayPhoneCount":(null==r?void 0:r.memberIds)?r.memberIds.filter((e=>e.startsWith(I.EI))).length:0,"DataBag.tflSMSMembersCount":(null==r?void 0:r.memberIds)?r.memberIds.filter(T.yj).length:0,"DataBag.offNetworkContactsSelected":(null==r?void 0:r.memberIds)?r.memberIds.filter(T.$i).length:0,"DataBag.hasAADFederatedMembers":(null==r?void 0:r.hasFederatedUser)||!1,"DataBag.hasMSAFederatedMembers":(null==r?void 0:r.hasTflConsumerUser)||!1,"DataBag.quotedReplyCount":L(e.content),"DataBag.groupTemplateType":null==r?void 0:r.groupTemplate,"DataBag.chatType":H(r),"DataBag.GIF":U(e.content,N.T.giphy),"DataBag.Sticker":U(e.content,N.T.sticker),"Designer.containsImageFromDesigner":R(e),"DataBag.composeVersion":n?"Simplified":"Classic"},((e,t)=>{const i={};if(e&&(null==t?void 0:t.isOneOnOne)&&(null==t?void 0:t.hasFederatedUser)){const e=D.eo.getTflExtendedDirectoryMembership(null==t?void 0:t.extendedDirectoryRedemptionRequired);e&&(i["DataBag.TFLUserInED"]=!0,i["DataBag.TFLUserEDState"]=e)}return i})(i,r)),{"DataBag.lifeCycleFlavor":q(r),"DataBag.wasEdited":"Update"===t,"Messaging.additionalContentPresent":o?B(e.content).length>0:void 0,"Messaging.additionalContentLength":o?B(e.content).length:void 0})},H=e=>(null==e?void 0:e.guardianChatInfo)?w.Ml.GuardianChat:null,q=e=>(null==e?void 0:e.awarenessLiveState)?"sync":"async",z=(e,t)=>t===C.Th.Channel?_.Mv.team:(null==e?void 0:e.isOneOnOne)?_.Mv.personal:(null==e?void 0:e.isMeeting)?_.Mv.meeting:(null==e?void 0:e.isOneOnOneBotChat)||(null==e?void 0:e.isOneOnOne)?_.Mv.general:_.Mv.group,V=(e,t,i,n,o,r,s,a,l,u,m,g,h,p,v,y)=>{var f,S,k;const b=((e,t)=>{var i,n;if(!e||e.chatSubType===j.k2.Channel)return t?C.Th.Channel:void 0;const o=null!==(n=null===(i=e.memberIds)||void 0===i?void 0:i.map((e=>e)))&&void 0!==n?n:[],r=(0,T._K)(e.id,e.isFederated,e.isOneOnOne,e.hasFederatedUser,o);return(0,c.NL)(e.id,e.chatType,e.isMeeting,e.isOneOnOne,e.isOneOnOneBotChat,r,e.isFederated)})(u,h);let w={};b===C.Th.Botchat&&(w=((e,t)=>{var i,n,o;const r=null===(i=null==e?void 0:e.memberIds)||void 0===i?void 0:i.find(T.bl);if(r){const e=r.substring(I.at.BotPrefix.length);try{const i=t.readQuery({query:E.Cj,variables:{installedContext:{scope:d.qi.Personal}}});if(i){const t=null===(n=i.installedAppsV2)||void 0===n?void 0:n.filter((t=>{var i,n,o;return(null===(o=null===(n=null===(i=null==t?void 0:t.definition)||void 0===i?void 0:i.bots)||void 0===n?void 0:n[0])||void 0===o?void 0:o.id)===e}));if(t&&t.length>0)return{id:null===(o=t[0])||void 0===o?void 0:o.id,capabilityId:e,scenarioCapability:_.Ky.bots}}}catch(e){}}return{}})(u,g));let N={};b!==C.Th.Channel&&b!==C.Th.Communities||(N=((e,t,i,n)=>{var o,r,s,a,l,c,d,u;let m;try{m=e.readQuery({query:x.h,variables:{conversationId:t}})}catch(e){n.error(`Failed to retrieve Team.Id and Team.OfficeGroupId from cache. Thread.Id: ${t}. Thread.Type: ${i}.`)}return{channelType:null==m?void 0:m.channelByID.channelType,teamId:null===(r=null===(o=null==m?void 0:m.channelByID)||void 0===o?void 0:o.owningTeam)||void 0===r?void 0:r.id,officeGroupId:null===(l=null===(a=null===(s=null==m?void 0:m.channelByID)||void 0===s?void 0:s.owningTeam)||void 0===a?void 0:a.teamSiteInformation)||void 0===l?void 0:l.groupId,memberCount:null===(u=null===(d=null===(c=null==m?void 0:m.channelByID)||void 0===c?void 0:c.owningTeam)||void 0===d?void 0:d.membershipSummary)||void 0===u?void 0:u.memberCount}})(g,e,b,r));const A=null!==(f=null==N?void 0:N.channelType)&&void 0!==f?f:null,D=function(e,t){let i=null;i=e?t?C.wh.discoverSurface:C.wh.Channel:C.wh.Chat;return i}(h,y),F=h?"channel":"chat",O=$(t,i,s,a,l,u,m,h,p,A);o.recordPanelAction({actionGesture:C.uS.click,actionOutcome:C.$K.submit,actionOutcomeNew:C.$K.submit,actionScenarioType:l?C.Yu.forwardMessage:C.Yu.composeMsg,actionScenario:C.Tk.composeSendMessage,appId:O["DataBag.appId"]||"",appScope:z(u,b).toString(),appScenarioCapability:void 0!==O["DataBag.appId"]?_.Ky.messaging.toString():"",moduleName:l?C.rA.forwardButton:C.rA.sendButton,moduleNameNew:l?C.rA.forwardButton:C.rA.sendButton,moduleType:C.PO.sendMessageButton,moduleTypeNew:C.PO.sendMessageButton,officeGroupId:null!=(null==N?void 0:N.officeGroupId)?null==N?void 0:N.officeGroupId:void 0,panelRegion:C.Ai.main,panelType:D,panelRegionNew:C.Ai.main,panelTypeNew:D,panelUri:l?"app.conversation":void 0,threadId:e,teamId:null!=v?v:null==N?void 0:N.teamId,threadMembers:null!==(S=null==N?void 0:N.memberCount)&&void 0!==S?S:null===(k=null==u?void 0:u.memberIds)||void 0===k?void 0:k.length,threadType:b,actionWorkload:h?C.sz.channelContent:C.sz.chatContent,actionSubworkload:C.eD.composeMsg,tabId:"",tabType:"conversations",tabIdNew:"",tabTypeNew:"conversations",tabOrdinal:1,appName:F,dataBag:{id:"",data:Object.assign(Object.assign(Object.assign({},n),O),G(g,y,p)),dispose:()=>{}},extensibilityData:w},r)};function G(e,t,i){var n,o,r,s,a;const l={};let c=null;try{c=e.readQuery({query:A})}catch(e){}const d=null==c?void 0:c.optionalTelemetry;return void 0!==(null==d?void 0:d.fluidDataLossOccurred)&&null!==(null==d?void 0:d.fluidDataLossOccurred)&&(l["DataBag.fluidDataLossOccurred"]=null===(n=null==c?void 0:c.optionalTelemetry)||void 0===n?void 0:n.fluidDataLossOccurred),void 0!==(null==d?void 0:d.fluidDataLossPrevented)&&null!==(null==d?void 0:d.fluidDataLossPrevented)&&(l["DataBag.fluidDataLossPrevented"]=null===(o=null==c?void 0:c.optionalTelemetry)||void 0===o?void 0:o.fluidDataLossPrevented),void 0!==(null==d?void 0:d.fluidCorrelationId)&&null!==(null==d?void 0:d.fluidCorrelationId)&&(l["Messaging.fluidCorrelationId"]=null===(r=null==c?void 0:c.optionalTelemetry)||void 0===r?void 0:r.fluidCorrelationId),void 0!==(null==d?void 0:d.embedLoopLinks)&&null!==(null==d?void 0:d.embedLoopLinks)&&(l["Messaging.embedLoopLinks"]=null===(s=null==c?void 0:c.optionalTelemetry)||void 0===s?void 0:s.embedLoopLinks),void 0!==(null==d?void 0:d.hasLoopComponentAndContent)&&null!==(null==d?void 0:d.hasLoopComponentAndContent)&&(l["Messaging.hasLoopComponentAndContent"]=null===(a=null==c?void 0:c.optionalTelemetry)||void 0===a?void 0:a.hasLoopComponentAndContent),t&&(l["DiscoverSurface.requestId"]=t,l["DataBag.messageID"]=i),l}var J=i(20615),K=i(76705);const Q={Mutation:{sendMessageWorker(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return Y(e,t)}))},sendMessage(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return Y(e,t)}))}}},Y=(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const{convId:i,action:o,originalConvId:r,withChatNetworkFallback:c,searchSessionId:m,sendFromChannel_ToBeRefactored:g,isCommentStream:h}=e,b=e.message,{cache:w,coreSettings:C,loggerFactory:_,offlineCacheManager:T,getDriveItemShareService:I,scenarioFactory:j,channelView:N,channelOrder:E,teamId:x,getPeopleService:A,requestId:D,authenticationUser:F,themeType:O}=t,{enableInstalledAppsV2:M,enableBotsFileSharing:R,enableAppsQueryOptimization:P,botFileInfoFetchTimeout:L}=C.get(s.J.Extensibility),{enableFilesShareLinksInvite:U,enableSharingByCreateLinkAPI:W,enableFilesShareLinksFetchFederatedUsersAPI:B,enableFilesShareLinksFetchTflConsumerUsersAPI:$,enableSendMessageLoggingForDebugging:H}=C.get(s.J.Files),{msgEnableChannelsV2:q}=C.get(s.J.Host),{enableScheduleMessage:z,enableSimplifiedCompose:G}=C.get(s.J.Messaging),Q=!!G,{enableMeetingChatAttachmentsInMCO:Y,meetingChatAttachmentsMap:oe}=C.get(s.J.ArtifactsPlatform),{userIdPrefix:re}=C.get(s.J.Calling),{environment:se}=C.get(s.J.Metadata),ae=se===a.s.life,le=_.newLogger("chatMutationForwardResolvers","data-resolvers-browser-chat"),ce=function(e,t,i){const n=(0,u.qr)(e,t);return i.findScenario(n)}(o,b,j),de=yield(0,k.mb)(i,w,t,le,_,c,null,null,void 0,r||"");null==ce||ce.mark(l.ck.ChatSendMessageGotChat);const ue=Z(r,w,le),me=yield X(t);null==ce||ce.mark(l.ck.ChatSendMessageServicesLazyLoadComplete);const ge=(0,k.Fb)(w,i,M,P),he=(0,k.QD)(w),pe=ee(t,le);Y&&function(e,t,i,o,r,s,a,c,u){var m,g,h,p,v,y;(0,n.__awaiter)(this,void 0,void 0,(function*(){const{scenario:n}=(0,J.aN)(l.RG.AddAttachmentToMCO,r),f=null===(m=null==e?void 0:e.files)||void 0===m?void 0:m.length;try{if(f&&("Recurring"===(null===(g=null==t?void 0:t.meetingInformation)||void 0===g?void 0:g.meetingType)||"Scheduled"===(null===(h=null==t?void 0:t.meetingInformation)||void 0===h?void 0:h.meetingType))){const l=yield c(),m=(yield te((null===(p=null==t?void 0:t.meetingInformation)||void 0===p?void 0:p.organizerId)||"",l,u))||"",g=`${null===(v=t.me)||void 0===v?void 0:v.objectId}@${t.addedByTenantId}`,h=`${t.meetingInformation.organizerId}@${t.meetingInformation.tenantId}`,f=t.meetingInformation.iCalUid||"",S=e.files,b=[];let w="",C="",_=!1;if(S.forEach((e=>{var n,o;const r=(null==e?void 0:e.type)||"";for(const e of i||[])if(e.enabled){if(null===(n=e.fileType)||void 0===n?void 0:n.includes(r)){w=e.appType,C=e.appId,_=!0;break}(null===(o=e.fileType)||void 0===o?void 0:o.includes("all"))&&(_=!0)}if(_){const i=ne(e,t,w,C);b.push(i),w="",C="",_=!1}})),b.length>0){const e=(0,k.i$)(t,f,h,g,m);e?(null===(y=a.errorToTelemetry)||void 0===y||y.call(a,e,"cmd_meetings_collab_object_add_resources_to_collab_object_event"),n.fail({reason:e})):(0,K.A)(s,r,o,d.ce.MeetingChat,f,f,h,g,b,ie(t,m))}}n.stop()}catch(e){(0,J.S3)(a,e,n,"cmd_meetings_collab_object_add_resources_to_collab_object_event","addAttachemntsToMCO failed with errorCode")}}))}(b,de,oe,_,j,t.getCollabObjectService,le,A,re);const ve={"DataBag.searchSessionId":m,"DataBag.isChannelsV2":!!q,"DataBag.channelView":N,"Channels.channelOrder":E,"Compose.sendPostAsEmail":!!(null==b?void 0:b.sendPostAsEmail),"Messaging.isShadowMTOMember":"Mto"===(null==F?void 0:F.subType),"Messaging.isMTOMember":null,"Messaging.hasMTOMembers":null==de?void 0:de.hasFederatedMTOUser};let ye=yield(0,k.JB)(t,b,o,i,pe,Object.assign(Object.assign({},me),{cache:w,offlineCacheManager:T,telemetryDatabag:ve,convId:i,conversationMembers:null==de?void 0:de.memberIds,getInstalledMessageExtensionApps:ge,getAppDefinitions:he,authenticationUser:F}),ce,!!g,null!=h&&h,O);return W&&b&&((0,k.Oc)(le,"Adding share url to files payload pram- addShareUrlToFiles","send_message_forward_resolver",H),ye=yield((e,t,i,o)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(v(o)){const n=t.newScenario(l.RG.FilesCreateShareLink),r=yield f(e,i,n);try{const e=yield p(r,i,o.files);return n.stop(),Object.assign(Object.assign({},o),{files:e})}catch(e){y(i,n,e)}}return Object.assign({},o)})))(I,j,_,ye)),(0,k.Oc)(le,"calling updateFluidMessageShareUrl","send_message_forward_resolver",H),ye=yield(0,k.KE)(ye,le,t),(0,k.Oc)(le,"calling getBotDownloadUrlForFiles","send_message_forward_resolver",H),ye=yield(0,k.R_)(me.botsPlatformService,ye,R,_,de,L),ye=(0,k.wX)(ye,de),(U||z)&&de&&(0,k.iX)(de)&&!S(ye)&&(null==ce||ce.mark(l.ck.ChatSendMessageFileShareLinksChats),(0,k.Oc)(le,"Creating Sharelinks if the files attached in Chat with no share url getMessageWithFileShareLinks","send_message_forward_resolver",H),ye=yield(0,k.Ju)(ye,de,t,le,B,$)),(U||z)&&g&&!S(ye)&&(null==ce||ce.mark(l.ck.ChatSendMessageFileShareLinksChannels),(0,k.Oc)(le,"Creating Sharelinks if the files attached in Channel with no share url getMessageWithFileShareLinksForChannel","send_message_forward_resolver",H),ye=yield(0,k.DE)(ye,w,i,le,t)),null==ce||ce.mark(l.ck.ChatSendMessageBiTelemetry),((e,t,i,n,{loggerFactory:o,userBiService:r,cache:s},a,l,c,d,u,m,g,h,p)=>{const v=o.newLogger("sendMessageTelemetry","data-resolvers-browser-chat");r?V(e,t,i,n,r,v,a,l,c,d,u,s,m,g,h,p):v.warn("userBiService is null")})(i,ye,o,ve,t,ae,Q,(0,k.Cf)(b),de,ue,g,null==b?void 0:b.replyChainId,x,D),null==ce||ce.mark(l.ck.ChatSendMessageForwardResolverComplete),Object.assign(Object.assign({},e),{message:ye})})),X=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const{getAppBasedLinkService:t,getAsyncMediaService:i,getUrlPreviewService:n,getImageProxyService:o,getFilesReferenceService:r,getBotsPlatformService:s}=e,[a,l,c,d,u,m]=yield Promise.all([i(),o(),n(),r(),t(),s()]);return{asyncMediaService:a,imageProxyService:l,urlPreviewService:c,fileReferenceService:d,appBasedLinkService:u,botsPlatformService:m}})),Z=(e,t,i)=>{var n;let r=null;if((0,c.UL)(e))try{const i=t.readQuery({query:o.i,variables:{convId:e}});r=null!==(n=null==i?void 0:i.newChatIntentId)&&void 0!==n?n:null}catch(e){i.error("Failed to find newChatIntentId in cache")}return r},ee=(e,t)=>{var i;let n=!0;const{cache:o,coreSettings:a}=e,{enableConnectedExperiences:l}=a.get(s.J.Messaging);if(!l)return n;try{const e=o.readQuery({query:r.K});n="false"!==(null===(i=null==e?void 0:e.userPreferences)||void 0===i?void 0:i.controllerConnectedServicesEnabled)}catch(e){t.error("Failed to find userPreferences in cache")}return n},te=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=`${i}${e}`,o=(yield t.getPeopleProfilesByMris([n],"MeetingChat")).get(n);return null==o?void 0:o.userPrincipalName})),ie=(e,t)=>{var i;return{meetingUrl:(null===(i=e.meetingInformation)||void 0===i?void 0:i.meetingJoinUrl)||"https://teams.microsoft.com",threadId:e.id,messageId:"0",organizerUpn:t}},ne=(e,t,i,n)=>{var o;return{location:(null==e?void 0:e.objectUrl)||"",type:d.ce.MeetingChat,subType:i||"",metadata:{appTitle:i||"",appId:n||"",userId:(null===(o=null==t?void 0:t.me)||void 0===o?void 0:o.objectId)||"",fileTitle:(null==e?void 0:e.title)||"",imageUrl:(null==e?void 0:e.previewUrl)||"",shareUrl:(null==e?void 0:e.shareUrl)||"",fileId:(null==e?void 0:e.id)||"",fileType:(null==e?void 0:e.type)||"",baseUrl:(null==e?void 0:e.baseUrl)||""}}}},788667:(e,t,i)=>{"use strict";i.d(t,{QD:()=>J,R_:()=>V,mb:()=>se,i$:()=>ce,Fb:()=>K,Ju:()=>X,DE:()=>Z,iX:()=>ae,Cf:()=>z,Oc:()=>de,PJ:()=>q,JB:()=>$,wX:()=>le,KE:()=>ie});var n=i(740597),o=i(74583),r=i(491465),s=i(50805),a=i(738646),l=i(516909),c=i(664585),d=i(916987),u=i(846077);let m=class{transform(e,t){var i,n,r,s,a,l;if(e.parent&&1===e.parent.children.length&&"div"===(null===(i=e.parent.name)||void 0===i?void 0:i.toLowerCase())&&"root"===(null===(n=e.parent.parent)||void 0===n?void 0:n.type)){if((!e.children||0===e.children.length)&&"text"===e.type)return t.isPureText=!0,void(t.textContent=(0,o.unescape)(e.data));if("tag"===e.type&&"p"===(null===(r=e.name)||void 0===r?void 0:r.toLowerCase())&&1===(null===(s=e.children)||void 0===s?void 0:s.length)&&"text"===e.children[0].type)return t.isPureText=!0,void(t.textContent=(0,o.unescape)(null===(a=e.children)||void 0===a?void 0:a[0].data));if("tag"===e.type&&"p"===(null===(l=e.name)||void 0===l?void 0:l.toLowerCase()))return e.name="div",e}}};m=(0,n.__decorate)([(0,u.wx)({name:"BotMessageContentSerializer",filter:"*"})],m);var g=i(722256),h=i(539744),p=i(711676),v=i(876661),y=i(760005),f=i(113851);var S=i(188143),k=i(871538),b=i(671168),w=i(575644),C=i(697337),_=i(2246),T=i(627997),I=i(549351);const j={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserChatAppDefinitionsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"scope"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppsFilterOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appDefinitions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"scope"},value:{kind:"Variable",name:{kind:"Name",value:"scope"}},__type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}},__type:{kind:"NamedType",name:{kind:"Name",value:"AppsFilterOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"appDefinition"}}]},__type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"AppDefinition"}}}}]}},...i(795820).Eb.definitions]};var N=i(115272),E=i(200770),x=i(902541);const A={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"installedChatAppsWithPreCheck"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"InstalledAppsOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedChatAppsWithPreCheck"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}},__type:{kind:"NamedType",name:{kind:"Name",value:"InstalledAppsOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"installedAppFields"}}]},__type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"InstalledApp"}}}}]}},...x.W4.definitions]},D={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"installedApps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"installedScopes"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppsFilterOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedApps"},arguments:[{kind:"Argument",name:{kind:"Name",value:"installedScopes"},value:{kind:"Variable",name:{kind:"Name",value:"installedScopes"}},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}}}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}},__type:{kind:"NamedType",name:{kind:"Name",value:"AppsFilterOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"installedAppFields"}}]},__type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"InstalledApp"}}}}]}},...x.W4.definitions]};var F=i(38613);const O={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"messageContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"content"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"version"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}}]};let M=class{transform(e,t){if(e&&e.attribs&&_.zj.cacheKey in e.attribs&&e.attribs[_.zj.cacheKey]===t.cacheKey)return t.instancesReplaced++,void 0!==t.value?e.attribs[t.prop]=t.value:t.prop in e.attribs&&void 0===t.value&&delete e.attribs[t.prop],e}};M=(0,n.__decorate)([(0,u.wx)({name:"InlineVideoUpdater",filter:[{itemtype:C.T.amsVideo}]})],M);const R="external_tfw_tfl_users",P="external_tfw_users",L="external_tfl_users",U="internal_users",W=(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const i=e.loggerFactory.newLogger("postTransformationCleanup","data-resolvers-browser-chat");e.nonBlockingDeletableCacheKeys.length&&(i.log(`AsyncSendSerialization: Cleaning up ${e.nonBlockingDeletableCacheKeys.length} cached items.`),null==t||t.mark(a.ck.ChatSendMessageSerializationCacheCleanup));for(const t of e.nonBlockingDeletableCacheKeys)try{(yield e.offlineCacheManager.delete(t))||i.warn(`AsyncSendSerialization: Failed to delete cached image with key: ${t}`)}catch(e){i.warn(`AsyncSendSerialization: Failed to delete cache image with key: ${t}. Also, we experienced an error, which is being considered non blocking to ensure we do not cause a terminal send issue.`)}})),B=(e,t,i,o,r,s,l,c)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const{cache:n,loggerFactory:d}=e,m=d.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),h=(0,u.te)(g.bl,t,i);try{z(r)||(yield(0,I.yG)(n,e,o,r,s,h,i.messageProperties,c),null==l||l.mark(a.ck.ChatSendMessageOptimisticResponsePosted))}catch(e){m.error(`client lie generation failed for conversation: ${o} clientMessageId: ${r.clientMessageId} error: ${e}`)}return(0,u.zL)(g.Vf,h,Object.assign(Object.assign({},i),{videoMessageLieUpdater:(e,t,i)=>((e,t,i,n,o)=>{if(!t)throw Error("clientMessageId undefined");const r=`Message:${t}`;let s;try{s=e.readFragment({id:r,fragment:O})}catch(e){throw e}if(!s)throw Error(`Message lie ${r} not found.`);if(!s.content)throw Error(`Message lie ${r} has no content.`);const a={cacheKey:i,prop:n,value:o,instancesReplaced:0},l=(0,u.te)([M],s.content,a);if(1!==a.instancesReplaced)throw Error(`${a.instancesReplaced} instances found instead of 1`);{const i=(0,F.MX)()[0].toString();try{e.writeFragment({id:r,fragment:O,data:{__typename:"Message",id:t,content:l,version:i}})}catch(e){throw e}}})(n,r.clientMessageId,e,t,i)}),W)})),$=(e,t,i,o,r,l,c,d,u,m)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const{content:g,computed:h,files:p,clientMessageId:v,deeplinks:y,title:S}=t,k=(0,n.__rest)(t,["content","computed","files","clientMessageId","deeplinks","title"]),{coreSettings:b,i18n:w,loggerFactory:C,scenarioFactory:_}=e,{enableCommentStreamEmoticonFormat:T}=b.get(s.J.Messaging),I=Object.assign(Object.assign(Object.assign({conversationId:o,connectedExperienceEnabled:r,existingLinks:(null==h?void 0:h.embeddedLinks)||[],messageProperties:h?Object.assign(Object.assign({},h),{embeddedLinks:[],mentions:h.mentions?[...h.mentions]:void 0,onBehalfOf:h.onBehalfOf?[...h.onBehalfOf]:void 0}):{},files:p?[...p]:[],coreSettings:b,loggerFactory:C,i18n:w,scenarioFactory:_,nonBlockingDeletableCacheKeys:[]},u&&{isLiteEmoticon:!0,disableBigEmoticons:!0,isEmoticonTagFormat:!!T}),l),m&&{themeType:m}),j=C.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),N=yield B(e,g,I,o,t,i,c,d),E=((e,t)=>{const{enableEntityConversationInMWTab:i}=e.get(s.J.Extensibility);if(!i)return[];const n=f.h.getInstance(),o=n.getSubEntityDeepLinkInfo();return o&&t&&n.getClientMessageId()===t?(n.setSubEntityDeepLinkInfo(void 0),n.setClientMessageId(void 0),[o]):[]})(b,v||void 0),{updatedTitle:x,updatedCards:A,updatedAmsReferences:D}=yield H(S||"",I);return j.log(`serialized message ${v}`),null==c||c.mark(a.ck.ChatSendMessageSerializationComplete),Object.assign({content:N,computed:Object.assign(Object.assign({},I.messageProperties),{cards:A,amsReferences:D}),files:I.files,deeplinks:E.length>0?E:y,clientMessageId:v,title:x},k)})),H=(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var i,n,o,r;let s=e,a=t.messageProperties.cards,l=t.messageProperties.amsReferences;if(null==a?void 0:a.length){const e=a.find((e=>e.appId===k.lq&&e.contentType===k.hY));if(e){let c=JSON.parse(e.content);if((null===(i=c.imageData)||void 0===i?void 0:i.origImage)&&(null===(r=null===(o=null===(n=c.imageData)||void 0===n?void 0:n.croppedImage)||void 0===o?void 0:o.src)||void 0===r?void 0:r.startsWith("blob:"))){const i=yield(0,b.Hk)(c.imageData.croppedImage.src),n="MicrosoftTeams-image.png",o=yield t.asyncMediaService.uploadItem(i,t.conversationId,"IMAGE",n,S.r1.Inline),r=o.inlineSizeUrl.replace("/imgo","/imgpsh_fullsize");c=Object.assign(Object.assign({},c),{imageData:Object.assign(Object.assign({},c.imageData),{croppedImage:Object.assign(Object.assign({},c.imageData.croppedImage),{id:o.objectId,src:r}),origImage:Object.assign(Object.assign({},c.imageData.origImage),{id:o.objectId,src:r})})}),l=(null==l?void 0:l.length)?[...l,o.objectId]:[o.objectId];const d=Object.assign(Object.assign({},e),{content:JSON.stringify(c)});a=a.map((e=>e.appId===k.lq&&e.contentType===k.hY?d:e)),s=""}}}return{updatedTitle:s,updatedCards:a,updatedAmsReferences:l}})),q=(e,t)=>{const{loggerFactory:i,offlineCacheManager:n}=e,o={logger:i.newLogger("chat-resolvers-utils","data-resolvers-browser-chat"),offlineCacheManager:n},r=(0,u.te)(g.D,t.content,o);return Object.assign(Object.assign({},t),{content:r})},z=e=>!!(null==e?void 0:e.forwardMessageId)&&!!(null==e?void 0:e.forwardMessageOriginalConvId),V=(e,t,i,o,r,s)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(!r||!i||!t.files||0===t.files.length)return t;if(!(null==r?void 0:r.isOneOnOneBotChat))return t;const n=o.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),a=s||1e4,l=yield Promise.all(t.files.map((t=>G(t,e,n,a))));return Object.assign(Object.assign({},t),{files:l})})),G=(e,t,i,o)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=e.objectUrl;if(n){let r;try{r=yield(0,w.E)(t.getBotFileDownloadUrl(n,i),o,"get bot downlaod url timed out")}catch(e){r=null,i.error("getBotDownloadUrlForFiles: failed to get file info")}if(r)return Object.assign(Object.assign({},e),{downloadUrl:r})}return e})),J=e=>()=>{var t;try{const i=e.readQuery({query:j,variables:{options:{capabilityFilter:["Messaging"]}}});return null===(t=null==i?void 0:i.appDefinitions)||void 0===t?void 0:t.filter((e=>!!e))}catch(e){return}},K=(e,t,i,n)=>()=>{var r;try{if(i){const i=Q(e,t,n);return(0,o.compact)(null==i?void 0:i.filter((e=>{var t;return null===(t=null==e?void 0:e.definition)||void 0===t?void 0:t.messageExtensions})).map((e=>e&&Y(e)?e:null)))}{const i=e.readQuery({query:D,variables:{conversationId:t,installedScopes:[l.qi.Personal,l.qi.GroupChat],options:{capabilityFilter:["Messaging"]}}});return(0,o.compact)(null===(r=null==i?void 0:i.installedApps)||void 0===r?void 0:r.map((e=>e&&Y(e)?e:null)))}}catch(e){return}},Q=(e,t,i)=>{var n;let o=null;try{o=e.readQuery({query:E.Cj,variables:{installedContext:{scope:l.qi.Personal}}})}catch(e){o=null}let r=null;try{if(i){const i=e.readQuery({query:A,variables:{conversationId:t}});r=null==i?void 0:i.installedChatAppsWithPreCheck}else{const i=e.readQuery({query:E.Cj,variables:{installedContext:{conversationId:t,scope:l.qi.GroupChat}}});r=null==i?void 0:i.installedAppsV2}}catch(e){r=null}const s=null!=r?r:[];return(null!==(n=null==o?void 0:o.installedAppsV2)&&void 0!==n?n:[]).concat(s)},Y=e=>(0,o.includes)([l.JM.Installed,l.JM.InstalledAndFavorited,l.JM.InstalledAndPermanent],e.installationState),X=(e,t,{getSharepointShareService:i,getPeopleService:o,discover:r,scenarioFactory:s},l,c,d)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;if((null===(n=null==e?void 0:e.files)||void 0===n?void 0:n.length)&&!(null==t?void 0:t.isOneOnOneBotChat)){const n=s.newScenario(a.RG.FileSharelinkMessageSend),u=yield i(),m=yield o(),g=yield r.skypeid();let h=[];try{n.mark(a.ck.FetchingUserDetailsStarted);h=(yield re(t,m,n,l,c,d)).filter((e=>e.mri!==g)),n.mark(a.ck.ShareUrlInviteCallForChatStarted);const i=yield u.shareFiles(e.files,h,n);return n.stop(),Object.assign(Object.assign({},e),{files:i})}catch(e){throw ee(e,n,h.length),l.error("getMessageWithFileShareLinks: Failed to create the shareLink for Chat's message."),e}}return e})),Z=(e,t,i,o,{getSharepointShareService:r,scenarioFactory:s})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,l;const c=te(t,i,o),{teamSiteInformation:d,smtpAddress:u}=(null===(n=null==c?void 0:c.channelByID)||void 0===n?void 0:n.owningTeam)||{},m=(null==d?void 0:d.sharepointSiteUrl)||null,g=(null==d?void 0:d.groupId)||null;if(m&&u&&g&&(null===(l=null==e?void 0:e.files)||void 0===l?void 0:l.length)&&e.files[0].baseUrl!==m){const t=s.newScenario(a.RG.FileSharelinkMessageSend);try{const i=yield r();t.mark(a.ck.ShareUrlInviteCallForChannelStarted);const n=[{id:g,smtpAddresses:[u],objectId:g}],o=yield i.shareFiles(e.files,n,t);return t.stop(),Object.assign(Object.assign({},e),{files:o})}catch(e){ee(e,t,1),o.error("getMessageWithFileShareLinksForChannel: Failed to create the shareLink for Channel's message")}}return e})),ee=(e,t,i)=>{var n,o,r,s;const a={errorCode:`${null===(n=null==e?void 0:e.serverResponse)||void 0===n?void 0:n.status}`,errors:JSON.stringify([null==e?void 0:e.code]),correlationId:null===(o=null==e?void 0:e.reason)||void 0===o?void 0:o.correlationId,errorMessage:null===(r=null==e?void 0:e.reason)||void 0===r?void 0:r.logErrorMessage,numOfUsers:i,reason:null===(s=null==e?void 0:e.reason)||void 0===s?void 0:s.reason};t.fail(a)},te=(e,t,i)=>{try{return e.readQuery({query:N.h,variables:{conversationId:t}})}catch(e){return i.error("getChannelFieldsForFileSharing: Failed to find channels related data"),null}},ie=(e,t,{getFluidService:i})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,o;if(e&&e.content&&e.fluidUrlPermissionInfo&&e.fluidUrlPermissionInfo.grantPermissionVariables){const{siteUrl:r,driveId:s,itemId:a,queryParams:l,linkType:c,scope:d,recipientList:u,createShareLinkOptions:m}=e.fluidUrlPermissionInfo.grantPermissionVariables,g=yield i();try{const t=yield g.createShareLink(r,s,a,l,c,d,u,m),i=null===(n=null==t?void 0:t.link)||void 0===n?void 0:n.webUrl,p=null===(o=e.computed)||void 0===o?void 0:o.cards;if(p&&i){const t=p.find((e=>e.contentType===h.p.FluidEmbed||"fluid-card"===e.appId));if(t&&t.contentType===h.p.FluidEmbed){const n=t.cardClientId,o=JSON.parse(t.content).componentUrl,r=ne(t,i),s=oe(e.content,C.T.fluidEmbedLink,i,o,n);return Object.assign(Object.assign({},e),{content:s,computed:Object.assign(Object.assign({},e.computed),{cards:r})})}if(t&&"fluid-card"===t.appId){const n=ne(t,i);return Object.assign(Object.assign({},e),{computed:Object.assign(Object.assign({},e.computed),{cards:n})})}}}catch(e){t.warn(`Error creating fluid sharelink in chat resolvers: ${e}`)}}return e})),ne=(e,t)=>{const i=[],n=e.contentType===h.p.FluidEmbed?JSON.parse(e.content).sourceType:null,o=JSON.stringify({componentUrl:t,sourceType:n}),r=Object.assign(Object.assign({},e),{content:o});return i.push(r),i},oe=(e,t=C.T.fluidLink,i,n,o)=>{const r=T.N.parseDOM(e),s=T.N.DomUtils.findAll((e=>"a"===e.name&&T.N.DomUtils.getAttributeValue(e,_.zj.itemtype)===t&&!!T.N.DomUtils.getAttributeValue(e,"href")),r),a=T.N.DomUtils.getAttributeValue(r[1],"itemid"),l=T.N.DomUtils.getAttributeValue(s[0],"href");if((e=>e.length>=1)(s)&&s[0]&&a&&o&&l&&n&&i&&a===o&&l===n){return e.replace(/href="(.*?)"/,`href="${i}`)}return e},re=(e,t,i,r,s,l)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{const n=e.hasFederatedUser,r=e.hasTflConsumerUser,[d,u]=r?(0,o.partition)(e.memberIds,(t=>(0,p.Nl)(t)&&!(0,v.Bl)(e.id))):[[],e.memberIds];let m;s&&n?(i.mark(a.ck.FetchingFederatedUser),m=yield(0,c.a2)(u||[],t)):m=yield(0,c.Mv)(u||[],t);let g,h=[];return l&&r&&(i.mark(a.ck.FetchingTflConsumerUser),h=yield(0,c.LH)(d||[],t)),g=n&&r?R:n?P:r?L:U,i.mark(a.ck.FetchingUserDetailsCompleted,{message:g}),m.concat(h)}catch(e){throw r.error("getUsersForShareLink: Failed to fetch users from People Service(mt)."),e}})),se=(e,t,i,o,s,a,l,c,u,m)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n,g;let h;try{h=null===(n=t.readQuery({query:r.vh,variables:{convId:e}}))||void 0===n?void 0:n.chat}catch(e){o.error("Failed to find chat in cache")}if(a&&!h){const t=yield i.getCSAService(),n=yield t.getChat(e);n&&(h=(0,d._$)(n,s,l,{id:c},u))}const p=(0,d.UL)(m)||(0,d.AK)(m);if(!h&&p&&m){e=m;try{h=null===(g=t.readQuery({query:r.vh,variables:{convId:e}}))||void 0===g?void 0:g.chat}catch(e){o.error("Failed to find chat in cache")}}return h})),ae=({chatType:e})=>"Chat"===e||"Meeting"===e,le=(e,t)=>{var i,n;const r=!(0,o.isEmpty)(null==t?void 0:t.botMembers),s=!!(null===(n=null===(i=e.computed)||void 0===i?void 0:i.mentions)||void 0===n?void 0:n.find((e=>"bot"===e.mentionType)));if(!((null==t?void 0:t.isOneOnOneBotChat)||r&&s))return e;const a={},l=(0,u.te)([m],e.content,a);return a.isPureText&&!(0,o.isNil)(a.textContent)?Object.assign(Object.assign({},e),{content:a.textContent,messageType:"BotMessageBack"===e.messageType?"BotMessageBack":y.Cs.Text}):Object.assign(Object.assign({},e),{content:l})},ce=(e,t,i,n,o)=>{var r;let s="";return e||(s=s?s.concat(", Chat Object ( thus meetingUrl)"):s.concat("Missing Chat Object ( thus meetingUrl)")),t||(s=s?s.concat(", externalEntityKey"):s.concat("Missing externalEntityKey")),i||(s=s?s.concat(", organizer"):s.concat("Missing organizer")),n||(s=s?s.concat(", user"):s.concat("Missing user")),e&&!(null===(r=e.meetingInformation)||void 0===r?void 0:r.meetingJoinUrl)&&(s=s?s.concat(", meetingUrl"):s.concat("Missing meetingUrl")),o||(s=s?s.concat(", organizerUpn"):s.concat("Missing organizerUpn")),s||void 0},de=(e,t,i,n)=>{n&&e.log(t,i)}},115272:(e,t,i)=>{"use strict";i.d(t,{h:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserChatChannelIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelByID"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"channelType"},__type:{kind:"NamedType",name:{kind:"Name",value:"ChannelType"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"owningTeam"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"smtpAddress"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TeamSiteInformation"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"membershipSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"memberCount"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"MembershipSummary"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Team"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Channel"}}}}]}}]}},200770:(e,t,i)=>{"use strict";i.d(t,{Cj:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"installedAppsV2"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"installedContext"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallContext"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"InstalledAppsOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedAppsV2"},arguments:[{kind:"Argument",name:{kind:"Name",value:"installedContext"},value:{kind:"Variable",name:{kind:"Name",value:"installedContext"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallContext"}}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}},__type:{kind:"NamedType",name:{kind:"Name",value:"InstalledAppsOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"installedAppFields"}}]},__type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"InstalledApp"}}}}]}},...i(902541).W4.definitions]}},810786:(e,t,i)=>{"use strict";i.d(t,{D:()=>o});var n=i(718306);const o={Mutation:{updateFilePermission(e,{updateFilePermissionInput:t},{cache:i}){if(!t)return!1;const{fileId:o,shareUrl:r,shareId:s,scope:a}=t,l=n.Ps`
  fragment filePermissionUpdate on FileUpload {
    id
    shareUrl
    shareId
    permissionScope
  }
`;let c;const d=`FileUpload:${o}`;try{c=i.readFragment({fragment:l,id:d})}catch(e){throw e}if(!c)throw new Error("Expected initial files to be populated before a command is executed");const u=Object.assign(Object.assign({},c),{shareUrl:r,shareId:s,permissionScope:a});return i.writeFragment({fragment:l,id:d,data:u}),!0},updatePermissionScopeInFileUpload(e,{updatePermissionScopeInput:t},{cache:i}){if(!t)return!1;const{fileId:o,scope:r}=t;if(!o)return!1;const s={permissionScope:r,__typename:"FileUpload"};try{i.writeFragment({fragment:n.Ps`
  fragment updatePermissionScope on FileUpload {
    permissionScope
  }
`,id:`FileUpload:${o}`,data:s})}catch(e){return!1}return!0},updateMessageApiFileProperties(e,{fileUploadRedeemPayload:t},{cache:i,loggerFactory:o}){var s,a,l,c,d,u;const m=o.newLogger("updateMessageApiFileProperties","data-resolvers-browser-files");if(!t)return!1;const{fileId:g}=t;if(!g)return!1;const h=n.Ps`
  fragment filePropertiesUpdate on FileUpload {
    id
    sharepointIds
    site
    publication
  }
`;let p;const v=`FileUpload:${g}`;try{p=i.readFragment({fragment:h,id:v})}catch(e){throw e}if(!p)throw new Error("Expected initial files to be populated before a command is executed");if((null===(s=p.sharepointIds)||void 0===s?void 0:s.siteUrl)||(null===(a=p.site)||void 0===a?void 0:a.dataLocationCode)||(null===(l=p.publication)||void 0===l?void 0:l.level)){const e=`SWM file properties should already be populated via sharelink flow for fileId: ${g}`;return null===(c=m.infoToTelemetry)||void 0===c||c.call(m,e,"file_permission_client_resolvers",void 0,!0),!1}const y=r(p,t);try{i.writeFragment({fragment:h,id:v,data:y});const e=`Updated SWM file poperties for fileId: ${g}`;null===(d=m.infoToTelemetry)||void 0===d||d.call(m,e,"file_permission_client_resolvers",void 0,!0)}catch(e){const t=`Failed updating SWM file properties for fileId: ${g}`;return null===(u=m.infoToTelemetry)||void 0===u||u.call(m,t,"file_permission_client_resolvers",void 0,!0),!1}return!0}}},r=(e,t)=>Object.assign(Object.assign({},e),{sharepointIds:t.sharepointIds,site:t.site,publication:t.publication})},20615:(e,t,i)=>{"use strict";i.d(t,{o9:()=>a,Uk:()=>l,aN:()=>c,S3:()=>d});var n=i(659726),o=i(74187),r=i(995344),s=i(234207);const a=e=>(0,n.A)(e)||"<scrubbed>",l=e=>e.map((e=>e.type)).sort().toString(),c=(e,t)=>{const i=t.newScenario(e);let n=i.id;return(0,r.z)(n)||(n=(0,s.v4)()),i.appendEventData({correlationId:n}),{scenario:i,correlationId:n}};function d(e,t,i,n,r){var s,a,l,c,d,u,m,g,h;const p={message:null===(s=t.reason)||void 0===s?void 0:s[o.zm.logErrorMessage],statusCode:null===(a=t.reason)||void 0===a?void 0:a[o.zm.httpStatusCode],errorCode:null===(l=t.reason)||void 0===l?void 0:l[o.zm.internalErrorCode],subError:null===(c=t.reason)||void 0===c?void 0:c[o.zm.subError],correlationId:null===(d=t.reason)||void 0===d?void 0:d[o.zm.correlationId],cmdRequestId:null===(u=t.reason)||void 0===u?void 0:u[o.zm.cmdRequestId],reportingService:null===(m=t.reason)||void 0===m?void 0:m[o.zm.reportingService]};!function(e,t,i,n){e.errorToTelemetry?e.errorToTelemetry(t,i,n,!0):e.error(t)}(e,`${r} ${null===(g=t.reason)||void 0===g?void 0:g[o.zm.internalErrorCode]}, errorMessage: ${null===(h=t.reason)||void 0===h?void 0:h[o.zm.logErrorMessage]}`,n,p),i.fail(p)}},76705:(e,t,i)=>{"use strict";i.d(t,{s_:()=>g,A:()=>h});var n=i(740597),o=i(132756),r=i(738646),s=i(74187),a=i(516909),l=i(905581),c=i(74583),d=i(20615);let u;const m=e=>u||(u=e.newLogger("meeting-artifacts-resolvers","data-resolvers-browser-meeting-artifacts")),g={Query:{meetingArtifacts(e,{meetingArtifactType:t,externalEntityKey:i,organizer:o,user:s},{getCollabObjectService:a,scenarioFactory:l,loggerFactory:c,callerApp:g}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{scenario:e,correlationId:n}=(0,d.aN)(r.RG.ReadCollabObject,l),h=(0,d.o9)(i);e.appendEventData({externalEntityKey:h}),m(c),u.log(`Read collab object for ${h}`);try{const r=yield a(),l=yield r.readCollabObject(n,i,o,s,g),c=((null==l?void 0:l.resources)||[]).filter((e=>e.type.toLowerCase()===t.toLowerCase())).map((e=>({id:e.id,type:v(e.type),location:e.location,metadata:e.metadata})));u.log(`type of resources received after reading collabObject ${(0,d.Uk)(c)}`);const m={changeKey:null==l?void 0:l.changeKey,resources:c};return e.stop({message:(0,d.Uk)(c)}),m}catch(t){return(0,d.S3)(u,t,e,"cmd_meetings_collab_object_read_collab_object_event","get meetingArtifacts query failed with errorCode"),Promise.reject(t)}}))},allMeetingArtifacts(e,{externalEntityKey:t,organizer:i,user:o},{getCollabObjectService:s,scenarioFactory:a,loggerFactory:l,callerApp:c}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{scenario:e,correlationId:n}=(0,d.aN)(r.RG.ReadCollabObject,a),g=(0,d.o9)(t);e.appendEventData({externalEntityKey:g}),m(l),u.log(`Read collab object to get all meeting artifacts for ${g}`);try{const r=yield s(),a=yield r.readCollabObject(n,t,i,o,c),l=((null==a?void 0:a.resources)||[]).filter((e=>y(e.type))).map((e=>Object.assign({id:e.id,type:v(e.type),location:e.location,subType:e.subType},e.metadata)));u.log(`type of resources received after reading collabObject to get all meeting artifacts are ${(0,d.Uk)(l)}`);const m={changeKey:null==a?void 0:a.changeKey,resources:l};return e.stop({message:(0,d.Uk)(l)}),m}catch(t){return(0,d.S3)(u,t,e,"cmd_meetings_collab_object_read_collab_object_event","get meetingArtifacts query failed with errorCode"),Promise.reject(t)}}))},allMeetingArtifactsBatch(e,{meetingArtifactsBatchInputList:t},{getCollabObjectService:i,scenarioFactory:o,loggerFactory:s}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{scenario:e,correlationId:n}=(0,d.aN)(r.RG.ReadCollabObjectBatchRequest,o);m(s),u.log(`Read group of meeting artifacts for ${t.length} meetings start`);try{const o=yield i(),r=yield o.readCollabObjectBatchRequest(n,function(e){const t={collabIds:{}};return e.forEach((e=>{t.collabIds=Object.assign(Object.assign({},t.collabIds),{[e.iCalUid]:{smtp:e.organizer}})})),t}(t)),s=function(e){const t=[];if(null==e?void 0:e.collabMap){const i=e.collabMap;Object.keys(i).forEach((e=>{var n;const o={iCalUid:e,value:{resources:((null===(n=i[e].collab)||void 0===n?void 0:n.resources)||[]).filter((e=>y(e.type))).map((e=>Object.assign({id:e.id,type:v(e.type),location:e.location,subType:e.subType},e.metadata)))}};t.push(o)}))}return t}(r);return u.log(`Read group of meeting artifacts for ${s.length} meetings success`),e.stop(),s}catch(t){return(0,d.S3)(u,t,e,"cmd_meetings_collab_object_read_collab_object_batch_request_event","get meetingArtifacts batch request query failed with errorCode"),Promise.reject(t)}}))},reserveMeetingArtifact(e,{externalEntityKey:t,seriesExternalEntityKey:i,organizer:o,user:s,meetingParams:l},{getCollabObjectService:c,scenarioFactory:g,loggerFactory:h,callerApp:v}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{scenario:e,correlationId:n}=(0,d.aN)(r.RG.ReserveResourceToCollabObject,g),y=(0,d.o9)(t),f=(0,d.o9)(i);e.appendEventData({externalEntityKey:y,seriesExternalEntityKey:f}),m(h),u.log(`Reserve meeting artifact for instance externalEntityKey: ${y}, series externalEntityKey: ${f}`);try{const r=a.ce.Notes,d=yield c(),u=yield d.reserveResourceToCollabObject(n,function(e,t,i,n,o,r){return{type:e.toLowerCase(),externalEntityKey:t,seriesExternalEntityKey:i,meetingUrl:r.meetingUrl,threadId:r.threadId,messageId:r.messageId,organizerUpn:r.organizerUpn,organizer:n,user:o}}(r,t,i,o,s,l),v);if(null==u?void 0:u.collab){const t=p(r,u);return e.stop(),Object.assign(Object.assign({},u),{collab:{changeKey:null==u?void 0:u.collab.changeKey,resources:t}})}return e.stop(),u}catch(t){return(0,d.S3)(u,t,e,"cmd_meetings_collab_object_reserve_resource_to_collab_object_event","reserveMeetingArtifact query failed with errorCode"),Promise.reject(t)}}))},readAndOptionallyReserveMeetingArtifact(e,{externalEntityKey:t,organizer:i,user:o},{getCollabObjectService:s,scenarioFactory:l,loggerFactory:c,callerApp:g}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{scenario:e,correlationId:n}=(0,d.aN)(r.RG.ReadAndOptionallyReserveResourceToCollabObject,l),h=(0,d.o9)(t);e.appendEventData({externalEntityKey:h}),m(c),u.log(`Read and Optionally Reserve meeting artifact for instance externalEntityKey: ${h}`);try{const r=a.ce.Notes,l=yield s(),c=yield l.readAndOptionallyReserveResourceToCollabObject(n,function(e,t,i,n){return{type:e.toLowerCase(),externalEntityKey:t,organizer:i,user:n}}(r,t,i,o),g);if(null==c?void 0:c.collab){const t=p(r,c);return e.stop(),Object.assign(Object.assign({},c),{collab:{changeKey:null==c?void 0:c.collab.changeKey,resources:t}})}return e.stop(),c}catch(t){return(0,d.S3)(u,t,e,"cmd_meetings_collab_object_read_and_optionally_reserve_resource_to_collab_object_event","readAndOptionallyReserveMeetingArtifact query failed with errorCode"),Promise.reject(t)}}))}},Mutation:{addMeetingArtifacts(e,{externalEntityKey:t,seriesExternalEntityKey:i,organizer:o,user:r,meetingParams:s,meetingArtifacts:a},{getCollabObjectService:l,scenarioFactory:c,loggerFactory:d,callerApp:u}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return h(l,c,d,u,t,i,o,r,a,s)}))},commitMeetingArtifact(e,{externalEntityKey:t,seriesExternalEntityKey:i,organizer:o,user:l,secret:u,resourceUri:g,metadata:h},{getCollabObjectService:p,scenarioFactory:v,loggerFactory:y,callerApp:f}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=m(y),{scenario:n,correlationId:S}=(0,d.aN)(r.RG.CommitResourceToCollabObject,v);try{const r=yield p(),m=(0,d.o9)(t),v=(0,d.o9)(i);return e.log(`commit Meeting Artifact to instance externalEntityKey: ${m}, series externalEntityKey: ${v}`),n.appendEventData({externalEntityKey:m,seriesExternalEntityKey:v}),u?(yield r.commitResourceToCollabObject(S,function(e,t,i,n,o,r,s,a){var l;const d=null!==(l=a)&&void 0!==l?l:{};return{type:e.toLowerCase(),externalEntityKey:t,seriesExternalEntityKey:i,organizer:n,user:o,secret:r,resourceUri:s,metadata:(0,c.omitBy)(k(d),c.isEmpty)}}(a.ce.Notes,t,i,o,l,u,g,h),f),n.stop(),!0):(e.error("commit Meeting Artifact API called without secret"),n.fail({errorCode:s.py.INVALID_SECRET.toString(),message:s.WK.INVALID_SECRET}),!1)}catch(t){return(0,d.S3)(e,t,n,"cmd_meetings_collab_object_commit_resource_to_collab_object_event","commit Meeting Artifact commit mutation failed with errorCode"),Promise.reject(t)}}))},updateMeetingArtifacts(e,{externalEntityKey:t,seriesExternalEntityKey:i,organizer:a,user:c,meetingParams:u,changeKey:g,meetingArtifacts:h},{getCollabObjectService:p,scenarioFactory:v,loggerFactory:y,callerApp:f}){var k;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=m(y),{scenario:n,correlationId:b}=(0,d.aN)(r.RG.UpdateResourcesOnCollabObject,v),w=(0,d.o9)(t),C=(0,d.o9)(i);e.log(`Update meeting artifacts for externalEntityKey: ${w} and seriesExternalEntityKey: ${C}`);try{const r=yield p(),m=null!==(k=h)&&void 0!==k?k:[];if(n.appendEventData({externalEntityKey:w,seriesExternalEntityKey:C,message:(0,d.Uk)(m)}),0===m.length){const t=(0,l.Tr)(o.w5.CmdArtifactsServiceClient,o.jK.InvalidInput,"meetingArtifactsResolver.updateMeetingArtifacts",{[s.zm.internalErrorCode]:s.py.EMPTY_INPUT,[s.zm.logErrorMessage]:s.WK.EMPTY_INPUT},s.WK.EMPTY_INPUT.toString());return(0,d.S3)(e,t,n,"cmd_meetings_collab_object_add_resources_to_collab_object_event","addMeetingArtifactsCalled with an empty array of meeting artifacts"),!1}return yield r.updateResourcesOnCollabObject(b,function(e,t,i,n,o,r,s){return{externalEntityKey:e,seriesExternalEntityKey:t,organizer:i,user:n,meetingUrl:o.meetingUrl,threadId:o.threadId,messageId:o.messageId,organizerUpn:o.organizerUpn,changeKey:r,resources:S(s)}}(t,i,a,c,u,g,m),f),n.stop(),!0}catch(t){return(0,d.S3)(e,t,n,"cmd_meetings_collab_object_update_resource_on_collab_object_event","UpdateMeetingArtifacts mutation failed"),Promise.reject(t)}}))}},MeetingArtifactV2Union:{__resolveType:e=>e.type===a.ce.Transcript?"MeetingArtifactV2Transcript":e.type===a.ce.TranscriptV2?"MeetingArtifactV2TranscriptV2":e.type===a.ce.Recording?"MeetingArtifactV2Recording":e.type===a.ce.Notes?"MeetingArtifactV2Notes":e.type===a.ce.MeetingContent?"MeetingArtifactV2MeetingContent":"MeetingArtifactV2Default"}};function h(e,t,i,o,a,l,c,u,g,h){var p;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=m(i),{scenario:v,correlationId:y}=(0,d.aN)(r.RG.AddResourcesToCollabObject,t);v.appendEventData({callerApp:o});try{const t=yield e(),i=(0,d.o9)(a);n.log(`Adding meeting artifacts to externalEntityKey: ${i}`);const r=null!==(p=g)&&void 0!==p?p:[];return v.appendEventData({externalEntityKey:i,message:(0,d.Uk)(r)}),0===r.length?(n.error("addMeetingArtifacts called with and empty array of meeting artifacts"),v.fail({errorCode:s.py.EMPTY_INPUT.toString(),message:s.WK.EMPTY_INPUT}),!1):(yield t.addResourcesToCollabObject(y,function(e,t,i,n,o,r){return{externalEntityKey:e,seriesExternalEntityKey:t,organizer:i,user:n,meetingUrl:o.meetingUrl,threadId:o.threadId,messageId:o.messageId,organizerUpn:o.organizerUpn,resources:S(r)}}(a,l,c,u,h,r),o),v.stop(),!0)}catch(e){return(0,d.S3)(n,e,v,"cmd_meetings_collab_object_add_resources_to_collab_object_event","addMeetingArtifacts mutation failed with errorCode"),Promise.reject(e)}}))}const p=(e,t)=>{var i,n;return null===(n=null===(i=null==t?void 0:t.collab)||void 0===i?void 0:i.resources)||void 0===n?void 0:n.filter((t=>t.type.toLowerCase()===a.ce[e].toLowerCase())).map((e=>Object.assign(Object.assign({},e),{id:e.id,type:v(e.type),location:e.location,metadata:e.metadata,subType:e.subType})))},v=e=>{for(const t of Object.keys(a.ce))if(t.toLowerCase()===e.toLowerCase())return a.ce[t];return e},y=e=>{for(const t of Object.keys(a.ce))if(t.toLowerCase()===e.toLowerCase())return!0;return!1},f=e=>{var t,i;const n=null!==(t=e.metadata)&&void 0!==t?t:{};return{id:e.id,location:e.location,type:e.type,subType:null!==(i=null==n?void 0:n.appTitle)&&void 0!==i?i:"",metadata:k(n)}},S=e=>e.map(f),k=e=>(e=>{let t={};if(e.state){const i=t;t=Object.assign(Object.assign({},i),{state:e.state})}if(e.isShared){const i=t;t=Object.assign(Object.assign({},i),{isShared:e.isShared})}if(e.linkScope){const i=t;t=Object.assign(Object.assign({},i),{linkScope:e.linkScope})}if(e.hostClient){const i=t;t=Object.assign(Object.assign({},i),{hostClient:e.hostClient})}if(e.appId){const i=t;t=Object.assign(Object.assign({},i),{appId:e.appId})}if(e.appTitle){const i=t;t=Object.assign(Object.assign({},i),{appTitle:e.appTitle})}if(e.fileTitle){const i=t;t=Object.assign(Object.assign({},i),{fileTitle:e.fileTitle})}if(e.imageUrl){const i=t;t=Object.assign(Object.assign({},i),{imageUrl:e.imageUrl})}if(e.userId){const i=t;t=Object.assign(Object.assign({},i),{userId:e.userId})}if(e.shareUrl){const i=t;t=Object.assign(Object.assign({},i),{shareUrl:e.shareUrl})}if(e.fileId){const i=t;t=Object.assign(Object.assign({},i),{fileId:e.fileId})}if(e.fileType){const i=t;t=Object.assign(Object.assign({},i),{fileType:e.fileType})}if(e.baseUrl){const i=t;t=Object.assign(Object.assign({},i),{baseUrl:e.baseUrl})}if(e.objectUrl){const i=t;t=Object.assign(Object.assign({},i),{objectUrl:e.objectUrl})}if(e.meetingContentMetadataObject){const i=t;t=Object.assign(Object.assign({},i),{meetingContentMetadataObject:e.meetingContentMetadataObject})}if(e.thumbnailUrl){const i=t;t=Object.assign(Object.assign({},i),{thumbnailUrl:e.thumbnailUrl})}return t})(e)},748429:(e,t,i)=>{"use strict";i.d(t,{w:()=>s,s:()=>a});var n=i(740597),o=i(37117),r=i(866009);const s={Query:{meetingBotMetaInfo(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{getMeetingBotService:e}=i,t=yield e();return{meetingBotMri:yield t.getBotId(),__typename:"MeetingBotMetaInfo"}}))},meetingBotCalendarEvents(e,{start:t,end:i},o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield o.getMeetingBotService();return(yield e.fetchCalendarEvents(t,i)).filter((e=>!e.isAllDayEvent&&e.isOnlineMeeting)).map((e=>{var t;return{id:e.objectId,start:new Date(e.startTime).toUTCString(),end:new Date(e.endTime).toUTCString(),iCalUID:e.iCalUID,subject:e.subject,objectId:e.objectId,conversationId:null===(t=e.skypeTeamsDataObj)||void 0===t?void 0:t.cid,skypeTeamsMeetingUrl:e.skypeTeamsMeetingUrl,isCancelled:e.isCancelled,isAllDayEvent:e.isAllDayEvent}}))}))},meetingBotChatIdForCalendarEvent(e,{eventId:t},i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return(yield i.getMeetingBotService()).fetchChatIdForCalendarEvent(t)}))}},Mutation:{postMeetingStarted(e,{absentAttendees:t,hasRecordingStarted:i,meetingId:r,isForced:s},a){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield a.getMeetingBotService();if(!s&&e.isMeetingEventSent(r,o.$.MeetingStart))return"absentAttendee checked";if(e.setMeetingEventSent(r,o.$.MeetingStart),t&&t.length>0){const n=yield e.postEventToBot({Scenario:o.$.MeetingStart,MeetingInfo:{HasRecordingStarted:i,AbsentAttendee:t}});return`${null==n?void 0:n.status}`}return"no absent attendees"}))},postGreetingToMeetingBot(e,{input:{meetingId:t,organizerId:i,recordingState:r,hasPresentedDeck:s,hasRecordingStarted:a,hasProactiveAction:l,absentAttendee:c,timeElapedSinceMeetingStartedInMinutes:d,hasNextMeeting:u,endTime:m,isRecurrent:g}},h){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield h.getMeetingBotService();if(e.isMeetingEventSent(t,o.$.InMeetingGreeting)||e.isMeetingEventSent(t,o.$.MeetingStart))return!1;e.setMeetingEventSent(t,o.$.InMeetingGreeting);return!!(yield e.postEventToBot({Scenario:o.$.InMeetingGreeting,MeetingInfo:{MeetingId:t,AbsentAttendee:c,OrganizerId:i,RecordingState:r,HasPresentedFile:s,HasProactiveAction:l,HasRecordingStarted:a,TimeElapedSinceMeetingStartedInMinutes:d,HasNextMeeting:u,EndTime:m,IsRecurrent:g,Subject:"Subject"}}))}))},tryStartMeetingBotPublisher(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{getMeetingBotService:e,loggerFactory:t}=i;t.newLogger("MeetingBot Resolver","data-resolvers-browser-meeting-artifacts").log("tryStartMeetingBotPublisher");const n=yield e();return yield n.startPublisher(),!0}))},sendActionStatus(e,{botAction:t,isActionSucess:i,nextMeetingName:r},s){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield s.getMeetingBotService();return yield e.postEventToBot({Scenario:o.$.InMeetingActionStatusUpdated,MeetingInfo:{InMeetingAction:t,IsActionSucceed:i,NextMeetingName:r}}),!0}))},sendRunningLateForNextMeetingNotification(e,{iCalUID:t,subject:i,objectId:r,conversationId:s},a){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield a.getMeetingBotService();return yield e.postEventToBot({Scenario:o.$.RunningLate,MeetingInfo:{CallId:t,ThreadId:s,Subject:i,MeetingUid:r}}),!0}))},removeCalendarEvent(e,{eventId:t},i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield i.getMeetingBotService();return yield e.removeCalendarEvent(t),"Message sent"}))},sendMeetingBotMessage(e,{text:t,conversationId:i},o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return(yield o.getMeetingBotService()).sendMeetingBotMessage(t,i)}))},sendMeetingObjectId(e,{meetingObjectId:t},i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield i.getMeetingBotService();return yield e.postEventToBot({Scenario:o.$.InMeetingShareFile,MeetingInfo:{MeetingId:t}}),!0}))},reportUsageToMeetingBot(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return(yield i.getMeetingBotService()).reportUsageToMeetingBot()}))},triggerBotAction(e,{conversationId:t,botAction:i,actionId:o},r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield r.getMeetingBotService(),n=yield e.fetchChatIdForCalendarEvent(t);return r.pubsub.publish("meetingBotActionEvent",{meetingBotActionEvent:{conversationId:n,botAction:i,actionId:o},__typename:"meetingBotActionEvent"}),!0}))},sendMessageToConversation(e,{conversationId:t,message:i,files:o},r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(o&&!o.length)return!1;const e=yield r.getMeetingBotService();return yield e.sendToConversation(t,i,o),!0}))}}},a={Subscription:{meetingBotActionEvent:{subscribe:(0,r.OF)(((e,t,{pubsub:i})=>i.asyncIterator(["meetingBotActionEvent"])),((e,t)=>t.conversationId===e.meetingBotActionEvent.conversationId))}}}},715953:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserMeetingRoomMeetingRoomFrontOfRoomCallPanelsStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meetingRoomFrontOfRoomCallPanelsState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"rightPanel"},__type:{kind:"NamedType",name:{kind:"Name",value:"MeetingRoomFrontOfRoomCallPanel"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"MeetingRoomFrontOfRoomCallPanelsState"}}}]}}]}},331713:(e,t,i)=>{"use strict";i.d(t,{s:()=>a});var n=i(524686),o=i(715953);var r=i(740597);const s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserMeetingRoomWhiteboardWalkUpStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"whiteboardWalkUpState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"WhiteboardWalkUpState"}},arguments:[]}]}}]},a={Query:{meetingRoomFrontOfRoomCallPanelsState:(e,{teamsCallId:t},{cache:i})=>{let r=(0,n.n1)(t);try{const e=i.readQuery({query:o.Z,variables:{teamsCallId:t}}),n=null==e?void 0:e.meetingRoomFrontOfRoomCallPanelsState;r=null!=n?n:r}catch(e){}return r},whiteboardWalkUpState:(e,t,{cache:i,loggerFactory:n})=>{var o;try{const e=i.readQuery({query:s});return null!==(o=null==e?void 0:e.whiteboardWalkUpState)&&void 0!==o?o:"Inactive"}catch(e){const t=null==n?void 0:n.newLogger("whiteboardWalkUpState","data-resolvers-browser-meeting-room");null==t||t.error("failed to get data")}return"Inactive"}},Mutation:{setMeetingRoomFrontOfRoomCallPanelsState:(e,{teamsCallId:t,state:i},{cache:r,loggerFactory:s})=>{var a;const l=null==s?void 0:s.newLogger("setMeetingRoomFrontOfRoomCallPanelsState","data-resolvers-browser-meeting-room");let c=(0,n.n1)(t);try{const e=r.readQuery({query:o.Z,variables:{teamsCallId:t}});(null==e?void 0:e.meetingRoomFrontOfRoomCallPanelsState)&&(c=e.meetingRoomFrontOfRoomCallPanelsState)}catch(e){null==l||l.error("No data found in cache for meetingRoomFrontOfRoomCallPanelsState, using default value")}const d={__typename:"MeetingRoomFrontOfRoomCallPanelsState",id:c.id,rightPanel:null!==(a=i.rightPanel)&&void 0!==a?a:null};try{r.writeQuery({query:o.Z,variables:{teamsCallId:t},data:{meetingRoomFrontOfRoomCallPanelsState:d}})}catch(e){null==l||l.error("setMeetingRoomFrontOfRoomCallPanelsState to cache failed.")}return d},updateWhiteboardWalkUpState:(e,{state:t},{cache:i,loggerFactory:n})=>(0,r.__awaiter)(void 0,void 0,void 0,(function*(){const e=null==n?void 0:n.newLogger("updateWhiteboardWalkUpState","data-resolvers-browser-meeting-room");try{i.writeQuery({query:s,data:{whiteboardWalkUpState:t.whiteboardWalkUpState}})}catch(t){null==e||e.error("updateWhiteboardWalkUpState to cache failed.")}return!0}))}}},524686:(e,t,i)=>{"use strict";i.d(t,{n1:()=>o,vq:()=>r});var n=i(740597);const o=e=>({__typename:"MeetingRoomFrontOfRoomCallPanelsState",id:e,rightPanel:null}),r=({entrypointType:e,dataRequestContext:t,callback:i})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const{getCallingService:n,loggerFactory:o,cancellationListener:r}=t,a=o.newLogger("invokeCallingApi","data-resolvers-browser-meeting-room"),l=yield n(e);return a.log(`Emitting meeting-room event request via api for endpoint: ${e}`),i(l,s(),r)})),s=()=>({hostRendererId:"",component:"Resolver"})},872494:(e,t,i)=>{"use strict";i.d(t,{k:()=>n});const n="payment-service"},216023:(e,t,i)=>{"use strict";i.d(t,{s:()=>s});var n=i(872494),o=i(923863);let r;const s={Mutation:{updatePaymentDetailsInCache:(e,{eventId:t,paymentDetails:i},{cache:s,loggerFactory:a})=>{var l;(e=>{r||(r=e.newLogger(n.k,"data-resolvers-browser-payment"))})(a);try{const e=(null===(l=s.readQuery({query:o.Z,variables:{eventId:t}}))||void 0===l?void 0:l.paymentDetails)||{},n=Object.assign(Object.assign(Object.assign({},e),i),{__typename:"PaymentDetails"});return s.writeQuery({query:o.Z,variables:{eventId:t},data:{paymentDetails:n}}),Object.assign(Object.assign({},n),{__typename:"PaymentDetails"})}catch(e){throw r.error("Payment client resolver failed to update payment details in cache",e),e}}}}},923863:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"paymentDetails"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"eventId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paymentDetails"},arguments:[{kind:"Argument",name:{kind:"Name",value:"eventId"},value:{kind:"Variable",name:{kind:"Name",value:"eventId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"eventId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"paymentProvider"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PaymentProvider"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"product"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"description"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"price"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"currency"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Currency"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Price"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PaymentProduct"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PaymentDetails"}}}}]}}]}},135103:(e,t,i)=>{"use strict";i.d(t,{w:()=>p});var n=i(740597),o=i(178608),r=i(516909),s=i(74583);function a(e,t){return t.isGeneral&&e.memberRole!==r.k_.Admin&&function(e){return e.teamSettings&&e.teamSettings.generalChannelPosting===r.S1.OwnersPost}(e)}function l(e,t){return e.isUserMuted?"MutedTeamMember":a(e,t)?"OnlyOwnersCanPost":"None"}var c=i(802683);function d(e,t){var i,n;return{id:t.id,channelType:m(t.channelType),isGeneral:t.isGeneral||!1,displayName:t.displayName,disallowedToPostReason:l(e,t),consumptionHorizon:t.consumptionHorizon?Object.assign(Object.assign({},t.consumptionHorizon),{__typename:"ClientConsumptionHorizon"}):null,filesRelativePath:(null===(i=t.defaultFileSettings)||void 0===i?void 0:i.filesRelativePath)||null,memberRole:g(t.memberRole),isModerator:t.isModerator||!1,channelSettings:{__typename:"ChannelSettings",channelPostPermissions:h(null===(n=t.channelSettings)||void 0===n?void 0:n.channelPostPermissions)},sharepointSiteUrl:t.sharepointSiteUrl||null,team:{id:e.id,displayName:e.displayName,groupId:e.teamSiteInformation.groupId,sharepointSiteUrl:e.teamSiteInformation.sharepointSiteUrl||null,pictureETag:e.pictureETag||null,smtpAddress:e.smtpAddress,teamSettings:e.teamSettings,__typename:"ClientTeam"},isArchived:t.isArchived,isDeleted:t.isDeleted,__typename:"ChannelWithTeam"}}function u(e){return(0,s.flatMap)(e,(e=>e.filteredChannels.map(d.bind(void 0,e))))}function m(e){switch(e){case r.xu.Standard:return"Standard";case r.xu.Private:return"Private";case r.xu.Shared:return"Shared";default:return null}}const g=e=>{switch(e){case r.k_.Admin:return r.k_.Admin;case r.k_.Guest:return r.k_.Guest;case r.k_.User:return r.k_.User;case r.k_.Undefined:default:return r.k_.Undefined}},h=e=>{switch(e){case"Moderators":return"Moderators";case"EveryoneButGuests":return"EveryoneButGuests";default:return"Everyone"}},p={Query:{channelSearch:(e,{searchQuery:t},i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){let e=yield v(i);if(0===e.length)return{__typename:"ChannelSearchResults",resultsByChannelName:[],resultsByTeamName:[]};e=e.filter((e=>!e.isDeleted)).map((e=>Object.assign(Object.assign({},e),{channels:e.channels.filter((e=>!e.isDeleted))})));const n=new RegExp((0,s.escapeRegExp)(t.toLowerCase())),o=(0,s.cloneDeep)(e).filter((e=>n.test(e.displayName.toLowerCase()))).map((e=>(e.filteredChannels=e.channels,e)));return{__typename:"ChannelSearchResults",resultsByChannelName:u(e.map((e=>(e.filteredChannels=e.channels.filter((e=>n.test(e.displayName.toLowerCase()))),e)))),resultsByTeamName:u(o)}})),channel:(e,{channelId:t},i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const e=yield v(i);let n;return(0,s.forEach)(e,(e=>{const i=(0,s.find)(e.channels,{id:t});return!i||(n=d(e,i),!1)})),n}))}};function v(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{authenticationUser:t,cache:i,coreSettings:n,localStorage:r,loggerFactory:s,scenarioFactory:a}=e;let l;try{({teams:l}=i.readQuery({query:o.TK}))}catch(e){s.newLogger("ClientResolvers","data-resolvers-browser-teams").warn("Cache error, returning empty data instead");const d=t&&(yield(0,c.Qp)(t,n,r,a));if(d){const e=d.map(c.uX);i.writeQuery({query:o.TK,data:{teams:e}})}l=d||[]}return l}))}},178608:(e,t,i)=>{"use strict";i.d(t,{TK:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"teamsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isDeleted"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isUserMuted"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"memberRole"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TeamMemberRole"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"smtpAddress"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"pictureETag"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"teamSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"generalChannelPosting"},__type:{kind:"NamedType",name:{kind:"Name",value:"GeneralChannelPosting"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TeamSettings"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"TeamSiteInformation"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"teamType"},__type:{kind:"NamedType",name:{kind:"Name",value:"TeamType"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"channels"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"channelType"},__type:{kind:"NamedType",name:{kind:"Name",value:"ChannelType"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isDeleted"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isArchived"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isGeneral"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isShown"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"timeStamp"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ConsumptionHorizon"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"defaultFileSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filesRelativePath"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"DefaultFileSettings"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"memberRole"},__type:{kind:"NamedType",name:{kind:"Name",value:"TeamMemberRole"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"channelSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelPostPermissions"},__type:{kind:"NamedType",name:{kind:"Name",value:"ChannelPostPermissions"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"ChannelSettings"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isModerator"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Channel"}}}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Team"}}}}},arguments:[]}]}}]}},802683:(e,t,i)=>{"use strict";i.d(t,{uX:()=>w,Qp:()=>N,xm:()=>F,GC:()=>M});var n=i(740597),o=i(74583),r=i(50805),s=i(738646),a=i(321748),l=i(876661),c=i(760005),d=i(500396),u=i(916987),m=i(765923),g=i(516909);const h=7,p=2,v="conversations",y="skypexspaces",f="Teams:conversation-manager",S="teams-list",k=7;function b(e){var t,i;return Object.assign(Object.assign(Object.assign({__typename:"Channel"},(0,o.defaults)((0,o.pick)(e,["id","channelType","displayName","isArchived","isDeleted","isGeneral","isModerator","isShown","memberRole"]),{channelType:null,isArchived:null,isDeleted:null,isModerator:null,memberRole:null})),{channelSettings:(0,o.defaults)(e.channelSettings,{__typename:"ChannelSettings",channelPostPermissions:null}),defaultFileSettings:{__typename:"DefaultFileSettings",filesRelativePath:(null===(t=e.defaultFileSettings)||void 0===t?void 0:t.filesRelativePath)||null},sharepointSiteUrl:e.sharepointSiteUrl||null}),(null===(i=e.consumptionHorizon)||void 0===i?void 0:i.id)?{consumptionHorizon:{__typename:"ConsumptionHorizon",id:e.consumptionHorizon.id,timeStamp:e.consumptionHorizon.timeStamp||null}}:{consumptionHorizon:null})}function w(e){var t;return Object.assign(Object.assign({__typename:"Team"},(0,o.defaults)((0,o.pick)(e,["id","displayName","isDeleted","isUserMuted","memberRole","smtpAddress","pictureETag","teamType"]),{isUserMuted:null,pictureETag:null,smtpAddress:null,teamType:null})),{teamSettings:{__typename:"TeamSettings",generalChannelPosting:(null===(t=e.teamSettings)||void 0===t?void 0:t.generalChannelPosting)||null},teamSiteInformation:Object.assign({__typename:"TeamSiteInformation"},(0,o.defaults)((0,o.pick)(e.teamSiteInformation,["groupId","sharepointSiteUrl"]),{groupId:null,sharepointSiteUrl:null})),channels:(e.channels||[]).map(b)})}function C(e){try{return JSON.parse(e)}catch(e){return}}function _(e){if(!e||0===e.length)return;const t=new Map,i=new Map;e.filter((e=>e&&(0,l.HU)(e))).map((e=>t.set(e.id,function(e){var t;const i=e.threadProperties;return Object.assign({id:e.id,displayName:i[c.Q5.SpaceThreadTopic]||"",isDeleted:(0,l.uY)(e),memberRole:j((null===(t=e.memberProperties)||void 0===t?void 0:t.role)||c.nL.None),teamSiteInformation:{groupId:i[c.Q5.GroupId]||"",sharepointSiteUrl:i[c.Q5.SiteUrl]},smtpAddress:i[c.Q5.TeamSmtpAddress],pictureETag:i[c.Q5.PictureETag],isFavorite:(0,l.Dq)(e),channels:[]},function(e){const t=C(e.threadProperties[c.Q5.TeamAdminSettings]);return t?{teamSettings:t.userSettings,teamGuestSettings:t.guestSettings}:{teamSettings:{}}}(e))}(e)))),e.filter((e=>e&&(0,l.J6)(e)&&e.threadProperties)).map((e=>i.set(e.id,{teamId:e.threadProperties[c.Q5.SpaceId],channel:T(e)}))),i.forEach((e=>{const{teamId:i,channel:n}=e,o=i&&t.get(i);o&&(n.team=o,o.channels.push(n))}));const n=Array.from(t.values());return n.length>0?n:void 0}function T(e){const t=e.threadProperties,i=t[c.Q5.SpaceTypes]===d.tG.Private;return{id:e.id,displayName:(i?t[c.Q5.SpaceThreadTopic]:(0,l.T7)(e))||"",description:t[c.Q5.TopicDescription]||"",isDeleted:(0,l.uY)(e),isGeneral:(0,l.HU)(e),channelType:I(t[c.Q5.SpaceTypes]),tabs:[],isShown:(0,l.Dq)(e),isShownByDefault:"true"===t[c.Q5.FavDefault],sharepointSiteUrl:i?t[c.Q5.SiteUrl]:void 0,defaultFileSettings:{filesRelativePath:t[c.Q5.FolderRelativeUrl]},consumptionHorizon:(0,u.CH)(e)}}function I(e){switch(e){case d.tG.Private:return g.xu.Private;case d.tG.Shared:return g.xu.Shared;case d.tG.None:default:return g.xu.Standard}}function j(e){switch(e){case c.nL.Admin:return g.k_.Admin;case c.nL.Guest:return g.k_.Guest;case c.nL.User:return g.k_.User;case c.nL.None:default:return g.k_.Undefined}}function N(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{enableChannelLocalCache:n,channelLocalCacheMaxDays:s,enableChannelIndexedDBCache:a,disableChannelIndexedDBNextCache:l}=t.get(r.J.Search);let c,d=!1;if(a&&(c=yield F(e.profile.objectId,e.profile.tenantId,o,!!l),d=void 0!==c),n&&(function(e,t){const i=O(e),n=new Date(Date.now()),o=new Date((null==i?void 0:i.timestamp)||0);o.setDate(o.getDate()+t),o<n&&e.remove(S)}(i,d?0:s||k),!c)){const e=O(i);c=null==e?void 0:e.teams}return c}))}let E;const x=3e5;let A;const D=(0,m.J)();function F(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return E||(E=function(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const r=i.newScenario(s.RG.GetTeamsChannelsFromIndexedDB),l=o=>(0,n.__awaiter)(this,void 0,void 0,(function*(){try{return yield function(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=function(e,t,i){return i?`${f}:${t}:${e}`:`${y}-${e}`}(e,t,i),r=function(e){return e?p:h}(i);return(0,a.q8)(n,r,v,"",o,!0)}))}(e,t,o,i)}catch(e){return void r.appendEventData({errors:JSON.stringify(e)})}}));let c;if(o||(c=yield l(!0)),c||(c=yield l(!1)),c)try{const e=_(c);return r.stop({message:e?"Successfully fetched.":"Conversations store does not contain any teams or channels."}),e}catch(e){return void r.fail({errors:"Fails to convert conversations to teams."})}else r.fail({errors:"unable to read conversations from indexedbd"})}))}(e,t,i,o),A=D.setTimeout((()=>{E=void 0,D.clearTimeout(A),A=void 0}),x),E)}))}function O(e){const t=e.get(S);if(t)return C(t)}function M(e,t){e.trySet(S,JSON.stringify({timestamp:Date.now(),teams:t}),"Messaging")}},808998:(e,t,i)=>{"use strict";i.d(t,{k:()=>n});const n="webinar-service"},324823:(e,t,i)=>{"use strict";i.d(t,{C:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webinarImageQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"webinarId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webinarImage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"webinarId"},value:{kind:"Variable",name:{kind:"Name",value:"webinarId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"image"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WebinarImage"}}}}]}}]}},873029:(e,t,i)=>{"use strict";i.d(t,{HY:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webinar"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"webinarId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webinar"},arguments:[{kind:"Argument",name:{kind:"Name",value:"webinarId"},value:{kind:"Variable",name:{kind:"Name",value:"webinarId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"allWebinarFiels"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Webinar"}}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"allWebinarFiels"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Webinar"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"eventDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"description"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"startTime"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endTime"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"accessPolicy"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WebinarAccessPolicy"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"status"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WebinarStatus"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isFull"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"privacyProfileStatementLink"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"capacity"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"price"},__type:{kind:"NamedType",name:{kind:"Name",value:"Float"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WebinarDetails"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"speakerBios"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"speakerId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"description"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WebinarSpeakerBio"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"questionnaire"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"questionId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"order"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"name"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WebinarQuestionnaireType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"options"},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isRequired"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isPredefined"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WebinarQuestion"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isUserAlreadyRegistered"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"joinLink"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"participantRole"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WebinarParticipantRole"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"registrationId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"paymentTransactionId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}}]}.definitions]}},168961:(e,t,i)=>{"use strict";i.d(t,{O:()=>o,a:()=>r});var n=i(873029);const o=(e,t)=>{try{const i=e.readQuery({query:n.HY,variables:{webinarId:t}});if(!i||!i.webinar)throw new Error("Invalid cached webinar data");return i.webinar}catch(e){throw e}},r=(e,t,i,r)=>{try{const r=o(i,e),s=Object.assign(Object.assign({},r),{questionnaire:t.map((e=>{var t,i,n;return Object.assign(Object.assign({},e),{name:null!==(t=e.name)&&void 0!==t?t:null,displayName:null!==(i=e.displayName)&&void 0!==i?i:null,options:null!==(n=e.options)&&void 0!==n?n:null,__typename:"WebinarQuestion"})}))});i.writeQuery({variables:{webinarId:e},query:n.HY,data:{webinar:s}})}catch(e){throw r.error("Webinar resolver fails to update webinar questions in cache."),e}}},107195:(e,t,i)=>{"use strict";i.d(t,{s:()=>c});var n=i(808998),o=i(873029),r=i(324823),s=i(168961);let a;const l=e=>a||(a=e.newLogger(n.k,"data-resolvers-browser-webinar")),c={Mutation:{updateWebinarDetails:(e,{webinarId:t,detailsInput:i},{cache:n,loggerFactory:r})=>{l(r);try{const e=(0,s.O)(n,t),r=Object.assign(Object.assign({},e),{eventDetails:Object.assign(Object.assign(Object.assign({},e.eventDetails),i),{__typename:"WebinarDetails"})});return n.writeQuery({variables:{webinarId:t},query:o.HY,data:{webinar:r}}),{_:!0,__typename:"Webinar"}}catch(e){throw a.error("Webinar resolver fails to update webinar details in cache."),e}},updateWebinarQuestions:(e,{webinarId:t,questionsInput:i},{cache:n,loggerFactory:o})=>(l(o),(0,s.a)(t,i,n,a),{_:!0,__typename:"Webinar"}),updateWebinarSpeakers:(e,{webinarId:t,speakersInput:i},{cache:n,loggerFactory:r})=>{l(r);try{const e=(0,s.O)(n,t),r=Object.assign(Object.assign({},e),{speakerBios:i.map((e=>Object.assign(Object.assign({},e),{__typename:"WebinarSpeakerBio"})))});return n.writeQuery({variables:{webinarId:t},query:o.HY,data:{webinar:r}}),{_:!0,__typename:"Webinar"}}catch(e){throw a.error("Webinar resolver fails to update webinar speakers in cache."),e}},updateWebinarImage:(e,{webinarId:t,webinarImageInput:i},{cache:n,loggerFactory:o})=>{l(o);try{return n.writeQuery({variables:{webinarId:t},query:r.C,data:{webinarImage:{image:i.image,__typename:"WebinarImage"}}}),{_:!0,__typename:"Webinar"}}catch(e){throw a.error("Webinar resolver fails to update webinar image in cache."),e}}}}},664585:(e,t,i)=>{"use strict";i.d(t,{Mv:()=>s,kO:()=>a,a2:()=>c,LH:()=>d,sU:()=>u,I_:()=>m});var n=i(740597),o=i(74583),r=i(205480);function s(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return l(e,t)}))}function a(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return l(e,t,i,o)}))}function l(e,t,i,s){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const a=(0,o.uniqBy)(e,(e=>e)),l=(0,o.chunk)(a.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT),c=yield Promise.all(l.map((e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield t.getPeopleProfilesByMris(e,i,!0,!1,!0);return yield m(n,i,s),n})))));let d=[];return c.forEach((e=>{d=d.concat(Array.from(e.values(),(e=>(0,r.ne)(e))))})),d}))}function c(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=(0,o.uniqBy)(e,(e=>e)),s=(0,o.chunk)(n.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(yield Promise.all(s.map((e=>t.getPeopleProfilesIncludeFederatedByMris(e,!0,!1,i))))).map((e=>Array.from(e.values(),(e=>(0,r.ne)(e))))).reduce(((e,t)=>e.concat(t)),[])}))}function d(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=(0,o.uniqBy)(e,(e=>e)),s=(0,o.chunk)(n.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(yield Promise.all(s.map((e=>t.getTflConsumerProfilesByMris(e,i||null))))).map((e=>Array.from(e.values(),(e=>(0,r.ne)(e))))).reduce(((e,t)=>e.concat(t)),[])}))}function u(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=(0,o.uniqBy)(e,(e=>e)),s=(0,o.chunk)(n.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(yield Promise.all(s.map((e=>t.getSkypeConsumerProfilesByMris(e,i||null))))).map((e=>Array.from(e.values(),(e=>(0,r.ne)(e))))).reduce(((e,t)=>e.concat(t)),[])}))}const m=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){i&&(yield i.combineFeatureSettingsWithProfiles(e,t||"combine feature settings"))}))},693954:(e,t,i)=>{"use strict";i.d(t,{P8:()=>n});const n={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"chatFieldsWithCachedTitle"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"title"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"shortTitle"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"creator"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tenantId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"picture"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"guardianChatInfo"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"groupTemplate"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isBotBlocked"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isOneOnOneBotChat"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isDisabled"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isMuted"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"lastMessage"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversChatListItemLastMessageFragment"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"LastMessage"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"memberIds"},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasFederatedUser"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasTflSmsVerifiedUser"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasTflConsumerUser"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"cfet"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasTypingUsers"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"tflOffNetworkUserLength"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isUserMember"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"localClientId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isRead"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isSfB"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isFederated"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isExternal"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isMeeting"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"extendedDirectoryRedemptionRequired"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasMissedCall"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasMissedMention"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasMissedReaction"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"arrivalTimeAriaLabel"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"quarantineCounter"},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"avatarUrl"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isPhonelinkSmsChat"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"interopConversationStatus"},__type:{kind:"NamedType",name:{kind:"Name",value:"InteropConversationStatus"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"activeCallConversationType"},__type:{kind:"NamedType",name:{kind:"Name",value:"ActiveCallConversationType"}},arguments:[]}]}},...i(307877).J.definitions]}},24606:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});var n=i(693954),o=i(230248),r=i(647780);const s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chatListWithCachedTitle"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"recentChatsFirst"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"recentChatsAfter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsFirst"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsAfter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsLocale"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}},type:{kind:"NamedType",name:{kind:"Name",value:"ChatTypeFilter"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includePinnedChats"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedContacts"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"excludePinnedChatsFromRecents"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!0}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"alwaysShowSuggestedContacts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxChatCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"0"}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedGroupChats"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeTopFixedChatListItems"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"recentsChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"recentChatsFirst"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"recentChatsAfter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"ChatTypeFilter"}}},{kind:"Argument",name:{kind:"Name",value:"excludePinnedChats"},value:{kind:"Variable",name:{kind:"Name",value:"excludePinnedChatsFromRecents"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"chatFieldsWithCachedTitle"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversChatMissedActivitiesOfConversationFragment"}}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MissedActivityOfConversation"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatListChannelConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversChatChatListChannelConversationFragment"}}]}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatListItem"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"cursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatsEdge"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasNextPage"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatsConnection"}}}},{kind:"Field",name:{kind:"Name",value:"pinnedChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"ChatTypeFilter"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includePinnedChats"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"chatFieldsWithCachedTitle"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversChatMissedActivitiesOfConversationFragment"}}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MissedActivityOfConversation"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatListChannelConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversChatChatListChannelConversationFragment"}}]}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatListItem"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"cursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatsEdge"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasNextPage"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatsConnection"}}}},{kind:"Field",alias:{kind:"Name",value:"suggestedContacts"},name:{kind:"Name",value:"suggestedContactsInChatList"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsFirst"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsAfter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"locale"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsLocale"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"alwaysShowSuggestedContacts"},value:{kind:"Variable",name:{kind:"Name",value:"alwaysShowSuggestedContacts"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"Argument",name:{kind:"Name",value:"filterOutFrequentlyUsedContacts"},value:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedContacts"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"mri"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"description"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"email"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"phone"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"dbKey"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"userType"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContactsSuggestionsItem"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContactsSuggestionsEdge"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasNextPage"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContactsSuggestionsConnection"}}}},{kind:"Field",name:{kind:"Name",value:"suggestedGroupChats"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedGroupChats"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"groupChatName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"groupChatMembers"},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"chatListDummyItemDisplayName"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"chatListDummyItemSubtitle"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"GroupChatSuggestionsItem"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"frequentlyUsedContacts"},arguments:[{kind:"Argument",name:{kind:"Name",value:"maxChatCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxChatCount"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"mri"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"email"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"phone"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContactsSuggestionsItem"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"cursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContactsSuggestionsEdge"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasNextPage"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContactsSuggestionsConnection"}}}},{kind:"Field",name:{kind:"Name",value:"topFixedChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}},__type:{kind:"NamedType",name:{kind:"Name",value:"ChatTypeFilter"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeTopFixedChatListItems"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"chatFieldsWithCachedTitle"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversChatMissedActivitiesOfConversationFragment"}}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MissedActivityOfConversation"}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatListChannelConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversChatChatListChannelConversationFragment"}}]}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatListItem"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"cursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatsEdge"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endCursor"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"hasNextPage"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PageInfo"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ChatsConnection"}}}}]}},...n.P8.definitions,...o.E.definitions,...r.s.definitions]}},230248:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});const n={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataResolversChatMissedActivitiesOfConversationFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MissedActivityOfConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"activityId"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"icon"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"sourceMessageId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"timestamp"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MissedActivityOfConversationType"}}},arguments:[]}]}}]}},853644:(e,t,i)=>{"use strict";i.d(t,{F:()=>r});var n=i(740597),o=i(365056);function r(e){let t;const i=()=>t&&t.return&&t.return();return new o.y((o=>{try{e().then((e=>{if(e.next instanceof Function){if(t=e,o.closed)return void i();!function(e,t){var i,o,r,s;(0,n.__awaiter)(this,void 0,void 0,(function*(){const a={[Symbol.asyncIterator]:()=>e};try{try{for(var l,c=!0,d=(0,n.__asyncValues)(a);l=yield d.next(),!(i=l.done);){s=l.value,c=!1;try{const e=s;t.next(e)}finally{c=!0}}}catch(e){o={error:e}}finally{try{c||i||!(r=d.return)||(yield r.call(d))}finally{if(o)throw o.error}}t.complete()}catch(e){t.error(e)}}))}(e,o)}else o.next(e),o.complete()}),o.error.bind(o))}catch(e){o.error(e)}return i}))}},804654:(e,t,i)=>{"use strict";i.d(t,{g:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversConnectedCalendarShowHardDeleteSurfaceDialogQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shouldShowHardDeleteConnectedCalendarSurfaceDialog"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]}}]}},69585:(e,t,i)=>{"use strict";i.d(t,{s:()=>r});var n=i(740597),o=i(804654);const r={Mutation:{setShouldShowHardDeleteConnectedCalendarSurfaceDialog:(e,{showDialog:t},{cache:i,loggerFactory:r})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{i.writeQuery({query:o.g,data:{shouldShowHardDeleteConnectedCalendarSurfaceDialog:t}})}catch(e){r.newLogger("setShouldShowHardDeleteConnectedCalendarSurfaceDialogMutation","data-resolvers-connected-calendar").error("Failed to write to client cache the show hard-delete connected calendar surface dialog mutation")}return t}))}}},735194:(e,t,i)=>{"use strict";i.d(t,{y:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"localizationSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"localizationSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentLocale"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LocalizationSettings"}}},arguments:[]}]}}]}},593196:(e,t,i)=>{"use strict";i.d(t,{s:()=>a});var n=i(740597),o=i(735194),r=i(446652),s=i(899517);const a={Query:{localizationSettings(e,t,{hostCommunicationService:i,platformService:o,routingServices:a,i18n:l}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield d(a.state.getSearchState()||{});if(e)return{currentLocale:e};if(localStorage.getItem("localeCode"))return{currentLocale:localStorage.getItem("localeCode")};if(o.config.clientType===r.Bh.Web)return{currentLocale:l.locale};let t;try{const e=yield c(i);e?(t=(0,s.vw)(e).locale,yield l.setLocale(t)):t=l.locale}catch(e){t=l.locale}return{currentLocale:t}}))}},Mutation:{updateCurrentLocale(e,{newLocale:t},{cache:i,hostCommunicationService:s,loggerFactory:a,platformService:c,i18n:d}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const e={localizationSettings:{__typename:"LocalizationSettings",currentLocale:t}};return yield d.setLocale(t),localStorage.setItem("localeCode",t),i.writeQuery({query:o.y,data:e}),c.config.clientType!==r.Bh.Web&&(yield l(a,s,t)),{currentLocale:t}}catch(e){return{currentLocale:d.locale}}}))}}},l=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;const o=e.newLogger("LocalizationSettingsResolvers","data-resolvers-localization-settings");try{const e=yield t.loadModule("osutils");(yield null===(n=null==e?void 0:e.setAppLocale)||void 0===n?void 0:n.call(e,{localeName:i}))||o.warn("hostingCommunicationService language set has failed")}catch(e){o.warn("hostingCommunicationService failed to load")}})),c=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var t;const i=yield e.loadModule("osutils"),n=yield null===(t=null==i?void 0:i.getAppLocale)||void 0===t?void 0:t.call(i);return null==n?void 0:n.localeName})),d=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){if(e.localeCode)return e.localeCode;if(e.language)return e.language.toLowerCase();if(!e.setting)return;const t=e.setting;let i;if(Array.isArray(t)){for(const e of t)if(e.startsWith("localeCode:")){i=e;break}}else t.startsWith("localeCode:")&&(i=t);return i?i.split(":")[1]:void 0}))},670974:(e,t,i)=>{"use strict";i.d(t,{rY:()=>r,Ok:()=>s});var n=i(109458);function o(e){if(e.definitions.length>1)return null;const t=e.definitions[0];return"FragmentDefinition"!==t.kind?null:t}function r(e){const t=(0,n.S)(e);if(!(null==t?void 0:t.name))throw new Error("Operation name must be set");return t.name.value}function s(e){var t;let i=(0,n.S)(e);return i||(i=o(e)),(null===(t=null==i?void 0:i.name)||void 0===t?void 0:t.value)||null}},939864:(e,t,i)=>{"use strict";i.d(t,{$Z:()=>h,aw:()=>m,nl:()=>u});var n=i(740597),o=i(251188),r=i(301767),s=i(101027),a=i(464944),l=i(738646);class c extends a.h{constructor(e,t){super(e),this.definitionOverflowLogged=new Set,this.isDuplicateWrite=e=>this.lastWrite&&this.lastDiff&&this.lastWrite===this.lastDiff.precedingWrite&&e.result===this.lastDiff.result;const{loggerFactory:i,scenarioFactory:n,graphqlStoreStatsReporterService:o,storeType:r,enableApolloDoubleWriteFix:s}=t;this.storeType=r,this.enableApolloDoubleWriteFix=s,i&&(this.logger=i.newLogger("InMemoryCacheWrapper","frameworks-apollo")),n&&(this.scenarioFactory=n),o&&(this.graphqlStoreStatsReporterService=o)}write(e){var t,i,n,o,r,s,a;let l,c=0;try{if(this.lastWrite&&this.isDuplicateWrite(e)&&(null===(t=this.graphqlStoreStatsReporterService)||void 0===t||t.markDuplicateWrite(this.storeType,e.query,null!==(i=this.lastWrite.elapsed)&&void 0!==i?i:0),this.enableApolloDoubleWriteFix))return this.lastWrite.result;l=null===(n=this.graphqlStoreStatsReporterService)||void 0===n?void 0:n.markWriteStart(this.storeType,e.query);const s=super.write(e);return l&&(c=null!==(r=null===(o=this.graphqlStoreStatsReporterService)||void 0===o?void 0:o.markWriteEnd(l))&&void 0!==r?r:0),this.lastWrite={result:s,elapsed:c},s}catch(e){throw null===(s=this.logger)||void 0===s||s.error(e.message),l&&(null===(a=this.graphqlStoreStatsReporterService)||void 0===a||a.markWriteError(l)),e}}read(e){var t,i;let n;try{n=null===(t=this.graphqlStoreStatsReporterService)||void 0===t?void 0:t.markReadStart(this.storeType,e.query);const o=super.read(e);return n&&(null===(i=this.graphqlStoreStatsReporterService)||void 0===i||i.markReadEnd(n)),o}finally{this.logResultCacheOverflowOnce("read",e.query)}}modify(e){var t,i,n,o;let r;try{r=null===(t=this.graphqlStoreStatsReporterService)||void 0===t?void 0:t.markWriteStart(this.storeType,`modify ${e.id||"ROOT_QUERY"}`);const n=super.modify(e);return r&&(null===(i=this.graphqlStoreStatsReporterService)||void 0===i||i.markWriteEnd(r)),n}catch(e){throw null===(n=this.logger)||void 0===n||n.error(e.message),r&&(null===(o=this.graphqlStoreStatsReporterService)||void 0===o||o.markWriteError(r)),e}}diff(e){var t,i;let n;try{n=null===(t=this.graphqlStoreStatsReporterService)||void 0===t?void 0:t.markDiffStart(this.storeType,e.query);const o=super.diff(e);return n&&(null===(i=this.graphqlStoreStatsReporterService)||void 0===i||i.markDiffEnd(n)),this.lastDiff={result:o.result,precedingWrite:this.lastWrite},o}finally{this.logResultCacheOverflowOnce("diff",e.query)}}logResultCacheOverflowOnce(e,t){var i,n,o,r,s;const a=t.definitions[0],c=this.getLastResultCacheOverflow();if(!this.scenarioFactory||c<=0||"OperationDefinition"!==a.kind)return;let d;if(a.name||1!==a.selectionSet.selections.length||"FragmentSpread"!==a.selectionSet.selections[0].kind){d={definitionKind:"query",definitionName:null!==(s=null===(r=a.name)||void 0===r?void 0:r.value)&&void 0!==s?s:"(unnamed)",overflowSize:c,method:e}}else{d={definitionKind:"fragment",definitionName:null!==(o=null===(n=null===(i=a.selectionSet.selections[0])||void 0===i?void 0:i.name)||void 0===n?void 0:n.value)&&void 0!==o?o:"",overflowSize:c,method:e}}const u=`${d.definitionKind}-${d.definitionName}`;if(!this.definitionOverflowLogged.has(u)){this.scenarioFactory.createScenarioWithoutStarting(l.RG.ApolloResultCacheOverflow).stop(d),this.definitionOverflowLogged.add(u)}}getLastResultCacheOverflow(){var e,t,i;return(null!==(i=(null!==(t=(null!==(e=this.storeReader)&&void 0!==e?e:{}).executeSelectionSet)&&void 0!==t?t:{}).__DEBUG_ONLY_optimismCache)&&void 0!==i?i:{}).__DEBUG_ONLY_lastOverflow||0}}const d=c,u=(e={})=>{const{apolloLeakOptions:t,cache:i,loggerFactory:s,scenarioFactory:a,enableApolloDevtools:l,enableApolloDoubleWriteFix:c,storeType:d=r.t.other,graphqlStoreStatsReporterService:u}=e,h=(0,n.__rest)(e,["apolloLeakOptions","cache","loggerFactory","scenarioFactory","enableApolloDevtools","enableApolloDoubleWriteFix","storeType","graphqlStoreStatsReporterService"]),p=new o.f(Object.assign(Object.assign({},h),{cache:i||m({apolloLeakOptions:t,loggerFactory:s,scenarioFactory:a,storeType:d,graphqlStoreStatsReporterService:u,enableApolloDoubleWriteFix:c}),assumeImmutableResults:!0,connectToDevTools:Boolean(l)}));return g(p,t),p},m=(e={})=>{var t,{apolloLeakOptions:i,loggerFactory:o,scenarioFactory:a,graphqlStoreStatsReporterService:l,storeType:c,enableApolloDoubleWriteFix:u}=e,m=(0,n.__rest)(e,["apolloLeakOptions","loggerFactory","scenarioFactory","graphqlStoreStatsReporterService","storeType","enableApolloDoubleWriteFix"]);const h={loggerFactory:o,scenarioFactory:a,graphqlStoreStatsReporterService:l,storeType:c||r.t.other,enableApolloDoubleWriteFix:u},p=new d(m,h);return null===(t=null==i?void 0:i.leakDetector)||void 0===t||t.track(s.I.ApolloCache,p),g(p,i),p},g=(e,{userContextId:t,windowId:i,entityType:n,viewportContext:o}={})=>{e.apolloLeakInfo={apolloLeakInfoStartTime:(new Date).toISOString(),apolloLeakInfoEntityType:n,apolloLeakInfoUserContextId:t,apolloLeakInfoViewportContext:o,apolloLeakInfoWindowId:i}},h=e=>{e.apolloLeakInfo||(e.apolloLeakInfo={}),e.apolloLeakInfo.apolloLeakInfoEndTime=(new Date).toISOString()}},209406:(e,t,i)=>{"use strict";i.d(t,{T:()=>o});var n=i(185535);const o=e=>{const t=performance.now();return{cacheSize:n({data:e.data.data,optimisticData:e.optimisticData.data}),measuringTime:performance.now()-t}}},561849:(e,t,i)=>{"use strict";i.d(t,{l:()=>s});var n=i(530014),o=i(599768);const r=["NoNetwork","RemoteOperationFailed"];class s extends n.G{constructor(e,t){super({type:"AuthError",code:a(e,t),prevError:"boolean"==typeof e?void 0:e})}getBoundaryProps(){switch(this.code){case"SIGN_IN_RESTRICTIONS":return{title:"default_signinrestrictions_title",description:"default_signinrestrictions_description",actions:["RESTART"]};case"ERROR_GETUSER_WHEN_ANON_NOT_SUPPORTED":return{title:"default_error_getuser_when_anon_not_supported_title",description:"default_error_getuser_when_anon_not_supported_description"};case"OFFLINE":return{title:"default_auth_no_network_title",description:"default_auth_no_network_description",actions:["RESTART"]};default:return{title:"default_authentication_title",description:"default_authentication_description",actions:["RESTART","SIGN_OUT"]}}}static fromSerialized(e){if("AuthError"!==(null==e?void 0:e.type))return null;const t=new s(void 0,e.code);return t.deserialize(e),t}}function a(e,t){if(t)return t;if("boolean"==typeof e)return e?"SIGN_IN_RESTRICTIONS":"UNKNOWN";if((0,o.a)(e)){const t=e.code;switch(t){case"SignInRestrictions":return"SIGN_IN_RESTRICTIONS";case"ErrorGetUserWhenAnonNotSupported":return"ERROR_GETUSER_WHEN_ANON_NOT_SUPPORTED";default:return r.includes(t)?"OFFLINE":"UNKNOWN"}}return"UNKNOWN"}},818997:(e,t,i)=>{"use strict";i.d(t,{x:()=>o});var n=i(530014);class o extends n.G{static fromExecutionError(e,t){return new o({code:"EXECUTION_FAILURE",taskName:e,prevError:t})}static fromMissingDependencies(e,t){return new o({code:"MISSING_DEPENDENCIES",taskName:e,dependencies:t,message:`${JSON.stringify(t)} are required, but not initialized.`})}constructor({code:e,taskName:t,prevError:i,dependencies:n,message:o}){super({type:"TaskError",code:e,prevError:i,message:o}),this.taskName=t,this.missingDependencies=n}getBoundaryProps(){return"EXECUTION_FAILURE"===this.code&&this.prevError instanceof n.G?this.prevError.getBoundaryProps():super.getBoundaryProps()}toJSON(){return Object.assign(Object.assign({},super.toJSON()),{taskName:this.taskName,prevError:this.prevError,missingDependencies:JSON.stringify(this.missingDependencies)})}toTelemetryCode(){var e;return`[${this.type}::${this.taskName}::${this.code}::${null===(e=this.missingDependencies)||void 0===e?void 0:e.join()}]`}static fromSerialized(e){if("TaskError"!==(null==e?void 0:e.type))return null;const t=new o({code:e.code,taskName:e.taskName,prevError:e.prevError,dependencies:e.dependencies});return t.deserialize(e),t}}},864452:(e,t,i)=>{"use strict";i.d(t,{m:()=>o});var n=i(740597);const o=()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return i.e(604793).then(i.bind(i,604793))}))},807510:(e,t,i)=>{"use strict";i.r(t),i.d(t,{createRelayEnvironment:()=>u,findInsertionIndex:()=>m.cQ,getValueAtKeyPath:()=>m.QA,insertEdgeSorted:()=>m.fM,sortConnection:()=>m.pK,sortConnectionEdgesWithDescriptors:()=>m.JC,sortEdges:()=>m.mj});var n=i(740597),o=i(12817),r=i(872889),s=i(202388),a=i(962109),l=i(459735),c=i(196503),d=i(50596);const u=({link:e,loggerFactory:t,userBiService:i,isLiveResolverEnabled:u,gcReleaseBufferSize:m,configName:g})=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var n;const h=null===(n=i.getWindowId)||void 0===n?void 0:n.call(i),p=t.newLogger("relay","data-client-core"),v=r;v.ENABLE_CLIENT_EDGES=!0,v.ENABLE_RELAY_RESOLVERS=v.ENABLE_RELAY_RESOLVERS||u,d.onUnhandledError(((e,t)=>{t?(p.errorToTelemetry&&p.errorToTelemetry("Relay: Uncaught thrown error","cdl_links_data_client_core",void 0,!0),p.error(`Relay: Uncaught thrown error: ${e}`)):p.error(`Relay: Unhandled emitted error: ${e}`)}));const y={gcReleaseBufferSize:null!=m?m:10},f=u?new c(new a,y):new l(new a,y),S=new s({store:f,network:{execute:(t,i,n,r)=>function(e,t,i,n,r){const s=t.text;if(!s){const e=`[${t.name}] Request text not available for operation`;return r.error(e),d.create((t=>t.error(new Error(e))))}return d.from(o.i.execute(e,{query:s,variables:i,operationName:t.name,context:{windowId:n}}))}(e,t,i,h,p)},configName:g});return S}));var m=i(942968)},942968:(e,t,i)=>{"use strict";i.d(t,{cQ:()=>o,fM:()=>r,mj:()=>s,pK:()=>a,JC:()=>l,QA:()=>u});var n=i(486331);function o(e,t){const i=e.getLinkedRecords("edges");if(!i)return-1;if(0===i.length)return 0;const n=d(c(e)),o=i.findIndex((e=>n(t,e)<0));return-1===o?i.length:o}function r(e,t){const i=o(e,t);if(-1===i)return;const n=e.getLinkedRecords("edges");null==n||n.splice(i,0,t),e.setLinkedRecords(n,"edges")}function s(e,t){return l(t,c(e))}function a(e){const t=e.getLinkedRecords("edges");if(!t||0===t.length)return;const i=s(e,t);i&&e.setLinkedRecords(i,"edges")}function l(e,t){let i=!1;const n=d(t),o=e.slice().sort(((e,t)=>{const o=n(e,t);return 0!==o&&(i=!0),o}));return i?o:void 0}function c(e){const t=e.getLinkedRecords("sortInfo");return n((null==t?void 0:t.length)>0,"Connection must have sortInfo"),t.map((e=>{const t=e.getValue("keyPath"),i=e.getValue("direction");return n(t&&i,"Sort descriptor must have keyPath and direction"),{keyPath:t,direction:i}}))}function d(e){const t=e.map((e=>({direction:e.direction,keyPathComponents:e.keyPath.split(".")})));return(e,i)=>{let o=0;for(const{keyPathComponents:r,direction:s}of t){const t=m(e,r),a=m(i,r);if(n(typeof t==typeof a,"Cannot sort on different types"),"string"==typeof t&&"string"==typeof a?o="ASC"===s?t.localeCompare(a):a.localeCompare(t):"number"==typeof t&&"number"==typeof a?o="ASC"===s?t-a:a-t:"boolean"==typeof t&&"boolean"==typeof a?o="ASC"===s?+t-+a:+a-+t:n(!1,"Cannot sort on given types"),0!==o)return o}return o}}function u(e,t){return m(e,t.split("."))}function m(e,t){return t.reduce(((e,i,o)=>{const r=t.length-1===o?null==e?void 0:e.getValue(i):null==e?void 0:e.getLinkedRecord(i);return n(void 0!==r,`Cannot get value at non-existent key-path: ${i}`),r}),e)}},800418:(e,t,i)=>{"use strict";i.d(t,{b:()=>I});var n=i(740597),o=i(264011),r=i(400871),s=i(787623),a=i(974509),l=i(8122),c=i(50805),d=i(132756),u=i(354571),m=i(234207),g=i(38023),h=i(22085),p=i(921961),v=i(726727),y=i(827748),f=i(236380),S=i(905581);const k=3e5;var b=i(659726);const w="beta/imageauth/cookie",C="beta/users/{objectId}/cookiev2",_=1e3,T=new Map([[v.ej.SKYPE_KEY,["ams","amsV2"]],[v.ej.MT_KEY,["mtImageService"]]]);class I{constructor(e,t,i,n,d,u,m,h,v,b,T,I,j,N,E){var x;this._gtmRegistry=t,this._discover=i,this.coreSettings=d,this.windowProvider=u,this.platformService=m,this.localStorage=v,this._authenticationService=b,this.config=T,this.user=I,this.clientState=j,this.networkState=N,this.hostState=E,this._imageAuthCookieExpiryTsKey="ImageAuthCookieExpiryTime",this._activeAmsRequest={},this._baseImageUrlSubject=new g.X(null),this._isInitialized=!1,this._isImageAuthCookieValidSubject=new g.X(!1),this._imageCookieRetryInterval=2e4,this._imageCookieRetryMaxCount=5,this._isSetupImageCookieInProgress=!1,this.checkImageAuthCookie=()=>{let e=-1;const t=(new Date).getTime()/_,i=this.localStorage&&this.localStorage.get(this._imageAuthCookieExpiryTsKey,"Global")||"-1";e=parseInt(i,10);const n=e>t,o=n?`Image auth cookie has NOT expired. Expiry time stamp: ${e}`:`Image auth cookie has expired. Expiry time stamp: ${e}`;this._logger.log(o),this._isImageAuthCookieValidSubject.next(n),this.startImageAuthCookiePollingTimer(n,e)},this.getRequest=(e,{requestUrl:t,requestBody:i,headers:n,serviceName:o},r)=>this._gtmRegistry.bind(this._send,e)({url:t,headers:n,credentials:"include",method:"POST",body:i,serviceName:o,apiName:r}),this.setupImageAuthCookie=()=>Promise.resolve({constructRequest:()=>{var e,t;return{url:this._isMTMAProfilePicturesEnabled&&(null===(e=this.user)||void 0===e?void 0:e.id)?C.replace("{objectId}",null===(t=this.user)||void 0===t?void 0:t.id):w,method:"POST",headers:{"x-ms-client-caller":"imageAuthCookieSetupEM","x-ms-client-type":(0,p.I)(this.platformService,this.config)},credentials:"include",apiName:"imageAuthCookie"}},allowedResponses:[a.qj.HTTP_2XX],retryPolicy:this.imageCookieRetryPolicy()}),this.setupImageAuthCookieEndpoints=({discover:e,authenticationResources:t})=>({baseUrlPromise:()=>e.regionGtm("middleTier"),serviceName:l.E.MiddleTier,authResource:t.mtAuthResource,models:{setupImageAuthCookie:this.setupImageAuthCookie()}}),this._logger=n.newLogger("Content Media Auth","services-io-browser-aync-media"),this._send=(0,o.r)((0,r.B)((0,s.S)(e),a.qb.NO_CONTENT,a.qb.OK),(x=this._logger,{shouldRetry:e=>(0,S.o7)(e)||[a.qb.THROTTLED,-1].indexOf(e)>-1,errorHandler:(e,t)=>{const{serverResponse:{status:i}}=e;if(!t.retriesTable[i])throw new Error(`AsyncMediaAuthServiceRetryPolicy: retry count for ${i} is empty`);return x.error(`asyncMediaAuthServiceRetryPolicy: retrying '[${t.retryCount}]' times due to response status - '[${i}]'`),(0,y._)(t.delay.next())},retryMaxTimeMs:k,maxRetryCount:6,createDelay:()=>new f.df(1e3,2,k)})),this._setupImageAuthCookieApi=h.createApi(this.setupImageAuthCookieEndpoints),this._imageCookieRetryInterval=d.get(c.J.People).imageCookieRetryInterval||2e4,this._imageCookieRetryMaxCount=d.get(c.J.People).imageCookieRetryMaxCount||5,this._isMTMAProfilePicturesEnabled=!!d.get(c.J.People).enableProfilePicturesWithObjectId,this._isDeleteImageAuthCookieEnabled=!!d.get(c.J.People).enableDeleteImageAuthCookie,this._isMTMAProfilePicturesEnabled&&(this._imageAuthCookieExpiryTsKey=`${this._imageAuthCookieExpiryTsKey}_${null==I?void 0:I.id}`)}initAsyncMediaAuthService(){if(this._isInitialized)return;this.initBaseImageUrl().catch((()=>{this._logger.error("Error in initCookieImageAuth")}));const{enableAmsCookieValidation:e}=this.coreSettings.get(c.J.Core),{isImageAuthCookiePollingCheckEnabled:t}=this.coreSettings.get(c.J.People),{skipAmsAuthRequest:i,disableTokenCacheReadEvent:n}=this.coreSettings.get(c.J.Auth);e&&t?this.checkImageAuthCookie():i?this._isImageAuthCookieValidSubject.next(!0):(this._discover.validateSkypeToken().catch((()=>{})),this.subscribeToToken(v.ej.SKYPE_KEY),n?this.subscribeToMiddleTierToken():this.subscribeToToken(v.ej.MT_KEY),this.subscribeToClientAndMachineStates()),this._isInitialized=!0}logout(){var e,t,i,o;return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n,r=l.E.Skype;const s=v.ej.MT_KEY,{mtResource:a}=yield this.coreSettings.get(c.J.Auth);if(a&&this._isDeleteImageAuthCookieEnabled&&(null===(e=this.user)||void 0===e?void 0:e.id)&&(null===(t=this._authenticationService)||void 0===t?void 0:t.acquireTokenV2)){const{token:e}=yield null===(i=this._authenticationService)||void 0===i?void 0:i.acquireTokenV2(a),t=null!==(o=T.get(s))&&void 0!==o?o:[],d=this.getHeaders(e,s);n=this._isMTMAProfilePicturesEnabled?"beta/users/{objectId}/deletecookiev2".replace("{objectId}",this.user.id):"beta/imageauth/deletecookie",r=l.E.MiddleTier;const{requireSkypetokenForMT:u}=this.coreSettings.get(c.J.Auth);return u&&(d["x-skypetoken"]=yield this._discover.validateSkypeToken()),this._logger.log("queueing request for deleting image auth cookie"),this.queueRequests(t,s,{requestUrl:n,headers:d,requestBody:undefined,serviceName:r},"deleteCookieOnLogout"),this._activeAmsRequest[s][0]}}))}startImageAuthCookiePollingTimer(e,t){this._imageAuthCookiePollingTimerId&&(this._logger.log(`Clearing image auth cookie polling. Timer ID: ${this._imageAuthCookiePollingTimerId}`),this.windowProvider.clearInterval(this._imageAuthCookiePollingTimerId));const i=Math.abs(t*_-(new Date).getTime()),n=e?i:5e3;this._imageAuthCookiePollingTimerId=this.windowProvider.setInterval((()=>this.checkImageAuthCookie()),n);const o=e?`Image auth cookie valid. expiry check timer started. Timer ID: ${this._imageAuthCookiePollingTimerId}`:`Image auth cookie NOT valid. polling validity timer started. Timer ID: ${this._imageAuthCookiePollingTimerId}`;e||this._logger.warn(o)}initBaseImageUrl(){var e;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const t=null!==(e=T.get(v.ej.MT_KEY))&&void 0!==e?e:[],i=yield this.getBaseUrl(t[0]);i&&this._baseImageUrlSubject.next(i)}))}getBaseUrl(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const t=yield this._discover.regionGtm(e);return t||this._logger.error("baseImageUrl is undefined"),t}catch(t){const i=`Fetching baseImageUrl failed from regionGTM, passed gtm: ${e.length}, errorCode: ${null==t?void 0:t.code}, errorContext: ${null==t?void 0:t.context}, errorMessage: ${null==t?void 0:t.message}`,n=(0,b.A)(i);return this._logger.errorToTelemetry?this._logger.errorToTelemetry(n,"async_media_auth_service",void 0,!0):this._logger.error(i),Promise.reject(t)}}))}subscribeToToken(e){var t;e===v.ej.SKYPE_KEY&&this._discover.observeSkypeToken().subscribe((e=>this.persistTokenToAMS(e,v.ej.SKYPE_KEY))),e===v.ej.MT_KEY&&(null===(t=this._authenticationService)||void 0===t||t.observeMiddleTierToken().subscribe((e=>this.persistTokenToAMS(e,v.ej.MT_KEY))))}getHeaders(e,t){const i={},n=(0,m.v4)();return i.Authorization=`${t===v.ej.SKYPE_KEY?"skype_token":"Bearer"} ${e}`,i["Content-Type"]="application/x-www-form-urlencoded",i.RequestId=n,i.CorrelationId=n,i.TransactionId=n,i["x-ms-client-type"]=(0,p.I)(this.platformService,this.config),i}persistTokenToAMS(e,t){var i,o;return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n,r,s,a=l.E.Skype;const u=null!==(i=T.get(t))&&void 0!==i?i:[],m=this.getHeaders(e,t);if(!e)return Promise.resolve(null);if(this._activeAmsRequest[t])return this._activeAmsRequest[t];switch(this._logger.log(`persistTokenToAMS: received new token for ${t}`),t){case v.ej.SKYPE_KEY:n=`skypetoken=${e}`,r="v1/skypetokenauth",a=l.E.Skype;break;case v.ej.MT_KEY:r=this._isMTMAProfilePicturesEnabled&&(null===(o=this.user)||void 0===o?void 0:o.id)?C.replace("{objectId}",this.user.id):w,a=l.E.MiddleTier,s=yield this.getBaseUrl(u[0]);const{requireSkypetokenForMT:t}=this.coreSettings.get(c.J.Auth),{disableSkypeTokenInCookieRequest:i}=this.coreSettings.get(c.J.People);t&&!i&&(m["x-skypetoken"]=yield this._discover.validateSkypeToken())}return this._logger.log(`persistTokenToAMS: queueing request for ${t}`),this.queueRequests(u,t,{requestUrl:r,headers:m,requestBody:n,serviceName:a},"persistTokenToAMS"),Promise.all(this._activeAmsRequest[t]).then((()=>{this._activeAmsRequest[t]=void 0,this._logger.log(`persistTokenToAMS: persist token for ${t}`),t===v.ej.MT_KEY&&(this.setImageAuthCookieValidityAndExpiry(),s?this._baseImageUrlSubject.next(s):this._logger.error("baseImageUrl is undefined"))})).catch((e=>{this._logger.error(`Unable to persist token: tokenType ${t} error ${e}`),this._activeAmsRequest[t]=void 0;const{enableRetryAuthCookieWithEM:i}=this.coreSettings.get(c.J.People);i&&(null==e?void 0:e.code)===d.jK.RemoteOperationFailed&&t===v.ej.MT_KEY&&(this._logger.log("persistTokenToAMS: retry cookie set up with EM"),this.setupImageAuthCookieAndExpiry())})),this._activeAmsRequest[t]}))}queueRequests(e,t,i,n){this._activeAmsRequest[t]=[],e.map((e=>{this._activeAmsRequest[t].push(this.getRequest(e,i,n))}))}checkAuthCookieValidity(){var e,t,i,o,r,s;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this.isImageCookieExpired()){this._logger.log(`image auth cookie expired for account ${null===(e=this.user)||void 0===e?void 0:e.id}`),this._isImageAuthCookieValidSubject.next(!1);if(null===(t=this.networkState)||void 0===t?void 0:t.isOnline()){const{mtResource:e}=yield this.coreSettings.get(c.J.Auth);if(e&&(null===(i=this._authenticationService)||void 0===i?void 0:i.acquireTokenV2)){const t=Math.round(Date.now()/_);this._logger.log(`force token refresh now ${t} for account ${null===(o=this.user)||void 0===o?void 0:o.id}`);const i=yield null===(r=this._authenticationService)||void 0===r?void 0:r.acquireTokenV2(e);this._logger.log(`refreshed token expiry ${null==i?void 0:i.expires} for account ${null===(s=this.user)||void 0===s?void 0:s.id}`)}}}}))}subscribeToClientAndMachineStates(){var e,t,i,o;const{enableAuthCookieValidityCheck:r}=this.coreSettings.get(c.J.People);r&&(null===(e=this.clientState)||void 0===e||e.observe().subscribe((e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var t;this._logger.log(`receive clientState ${e} for account ${null===(t=this.user)||void 0===t?void 0:t.id}`);(e===u.pk.Active||e===u.pk.VeryActive)&&this.checkAuthCookieValidity()})))),null===(t=this.networkState)||void 0===t||t.observeIsOnline().subscribe((e=>{var t;this._logger.log(`receive isOnline ${e} for account ${null===(t=this.user)||void 0===t?void 0:t.id}`),e&&this.checkAuthCookieValidity()})),null===(i=this.hostState)||void 0===i||i.observe().pipe((0,h.x)(((e,t)=>e.machineLockState===t.machineLockState))).subscribe((e=>{var t;this._logger.log(`receive machineLockState ${e.machineLockState} for account ${null===(t=this.user)||void 0===t?void 0:t.id}`),e.machineLockState===u.UV.Active&&this.checkAuthCookieValidity()})),null===(o=this.hostState)||void 0===o||o.observe().pipe((0,h.x)(((e,t)=>e.machineIdleState===t.machineIdleState))).subscribe((e=>{var t;this._logger.log(`receive machineIdleState ${e.machineIdleState} for account ${null===(t=this.user)||void 0===t?void 0:t.id}`),e.machineIdleState===u.fI.Active&&this.checkAuthCookieValidity()})))}subscribeToMiddleTierToken(){var e;null===(e=this._authenticationService)||void 0===e||e.observeMiddleTierToken().subscribe((e=>{if(e||this.isImageCookieExpired()){const t=e?"token changed":"cookie expired";this._logger.log(`Set up image auth cookie due to: ${t}`),this.setupImageAuthCookieAndExpiry()}else this._isImageAuthCookieValidSubject.next(!0)}))}setImageAuthCookieValidityAndExpiry(){var e,t,i;return(0,n.__awaiter)(this,void 0,void 0,(function*(){this._isImageAuthCookieValidSubject.next(!0);const{mtResource:n}=(yield this.coreSettings.get(c.J.Auth))||{};if(n&&(null===(e=this._authenticationService)||void 0===e?void 0:e.acquireTokenV2)){const e=yield null===(t=this._authenticationService)||void 0===t?void 0:t.acquireTokenV2(n),o=null==e?void 0:e.expires;o&&(null===(i=this.localStorage)||void 0===i||i.set(this._imageAuthCookieExpiryTsKey,o.toString(),"Auth","Global")),this._logger.log(`Successfully set up image auth cookie expiry ${o}`)}}))}setupImageAuthCookieAndExpiry(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!this._isSetupImageCookieInProgress){this._isSetupImageCookieInProgress=!0,this._logger.log("Setting up image auth cookie");try{yield this._setupImageAuthCookieApi.setupImageAuthCookie(),this.setImageAuthCookieValidityAndExpiry()}catch(e){this._logger.error(`setupImageAuthCookieAndExpiry error ${e}`)}finally{this._isSetupImageCookieInProgress=!1}}}))}isImageCookieExpired(){var e;const t=Math.round(Date.now()/_),i=(null===(e=this.localStorage)||void 0===e?void 0:e.get(this._imageAuthCookieExpiryTsKey,"Global"))||"-1";return parseInt(i,10)<t}imageCookieRetryPolicy(){return{shouldRetry:(e,t,i)=>{if(t>=a.qb.OK&&t<=a.qb.NOT_MODIFIED)return!1;const n=e<this._imageCookieRetryMaxCount&&t!==a.qb.BAD_REQUEST&&t!==a.qb.NOT_AUTHORIZED&&t!==a.qb.FORBIDDEN;return this._logger.warn(`imageCookieRetryPolicy retry count ${e} responseCode ${t} canRetry ${n}`),n},nextDelay:e=>this._imageCookieRetryInterval*Math.pow(2,e)}}get baseImageUrlObservable(){return this._baseImageUrlSubject.asObservable()}get isImageAuthCookieValidObservable(){return this._isImageAuthCookieValidSubject.asObservable()}get baseImageUrl(){return this._baseImageUrlSubject.value}get isImageAuthCookieValid(){return this._isImageAuthCookieValidSubject.value}}},453489:(e,t,i)=>{"use strict";i.d(t,{D:()=>g});var n=i(740597),o=i(74583),r=i(846077),s=i(697337),a=i(627997);const l=new RegExp(/animated-emoticon.*?/),c=/img|table/,d=e=>!!e&&a.N.DomUtils.getAttributeValue(e,"itemtype")===s.T.customEmoji,u=e=>!!e&&(a.N.DomUtils.getAttributeValue(e,"itemtype")===s.T.emoji||l.test(a.N.DomUtils.getAttributeValue(e,"class")||"")),m=3;let g=class{preTransform(e,t){const i=(0,o.isUndefined)(t.superSizeEmoticons)?0:t.superSizeEmoticons;var n;"br"===e.name?t.containsPotentiallyIncludedWhitespace=!0:(0,o.isNumber)(i)&&(t.superSizeEmoticons=u(e)||d(e)?(n=i,!t.containsPotentiallyIncludedWhitespace&&n<m&&n+1):!(e=>e&&!u(e.parent)&&!d(e.parent)&&!(e.parent&&u(e.parent.parent))&&(c.test(e.name||"")||!(!e.data||!e.data.replace(" ","").replace(/[\u200B-\u200D\uFEFF]/g,"").trim())))(e)&&i)}};g=(0,n.__decorate)([(0,r.wx)({name:"BigEmoticonPreprocessor",filter:"*"})],g)},722256:(e,t,i)=>{"use strict";i.d(t,{D:()=>et,fh:()=>Ye,Vf:()=>Ze,bl:()=>Xe});var n=i(740597),o=i(74583),r=i(50805),s=i(738646),a=i(846077),l=i(575644),c=i(43889),d=i(627997),u=i(2246);const m=e=>{e&&d.N.DomUtils.hasAttrib(e,u.zj.type)&&delete e.attribs[u.zj.type]};var g=i(402750),h=i(645534),p=i(697337),v=i(68950),y=i(516909);const f={fileDetailsPromiseResolved:"file_deatails_promise_resolved"};let S=class{constructor(){this._allowAsyncChicletCreation=!1,this._asyncLinkConversionDetailsByItemId=new Map,this._loggerCb=o.noop,this._timeout=0}preTransform(e,t){var i;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!e||!t||!d.N.DomUtils.hasAttrib(e,"href"))return;this._setupConstants(t);const n=e.attribs[u.zj.itemid];if(!n)return;const r=!!d.N.DomUtils.hasAttrib(e,u.zj.dataProcessedUrl)&&"true"===e.attribs[u.zj.dataProcessedUrl];if(this._allowAsyncChicletCreation&&!r){const r=(0,o.unescape)(e.attribs.href),{fileReferenceService:a}=t,c=a.parseFileLabelFromUrl(r);if(!c)return void m(e);const d=null===(i=this._scenarioFactory)||void 0===i?void 0:i.newScenario(s.RG.AsyncLinkToChiclet),u=this._asyncLinkConversionDetailsByItemId.get(n);if(u)return void A(u,r,d,(e=>this._asyncLinkConversionDetailsByItemId.set(n,e)));try{const e=(0,l.E)(a.getFileDetails(c,"chat",["fluid"]),this._timeout,"file details call timed out");this._asyncLinkConversionDetailsByItemId.set(n,{fileDetailsPromise:e,scenario:d,linkInfo:{href:r,count:1}})}catch(t){const i=(null==t?void 0:t.message)||"";return x(e,d,i)}}return e}))}transform(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!(e&&d.N.DomUtils.hasAttrib(e,"href")&&t&&t.files&&t.messageProperties&&t.existingLinks))return;const i=e.attribs[u.zj.itemid];if(!i)return;const n=this._asyncLinkConversionDetailsByItemId.get(i);if(n){const{scenario:i}=n;try{const o=yield b(t,e,n);return i&&i.stop(),o}catch(t){return m(e),void(0,g.V)(t,this._loggerCb,i)}}if(!d.N.DomUtils.hasAttrib(e,u.zj.itemProps))return E(e,t);const{files:o}=t;try{const n=N(o,e);if(!n)return;const{shareUrl:r,title:s}=n;r&&(e.attribs.href=r),C(e,s,r),w(n,i,t)}catch(e){return}return e}))}_setupConstants({coreSettings:e,loggerFactory:t,scenarioFactory:i}){this._loggerCb=k(t.newLogger("SharepointLinkSerializer","services-io-files-compose-serializer-extensions")),this._scenarioFactory=i;const{enableFilesAsyncChicletCreationInMultiWindow:n,asyncChicletCreationTimeout:o}=e.get(r.J.Files);this._allowAsyncChicletCreation=!!n,this._timeout=o||3e3}};S=(0,n.__decorate)([(0,a.HR)({name:"SharepointLinkSerializer",filter:"a"})],S);const k=e=>t=>{e.error(t)},b=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const{fileDetailsPromise:n,scenario:o}=i,r=yield n;return o&&o.mark(f.fileDetailsPromiseResolved),w(r,r.fileId,e),((e,t)=>{const{files:i}=t;return-1!==i.findIndex((t=>t.id===e.fileId))})(r,e)||j(e,(({objectUrl:e,shareUrl:t,type:i,fileId:n,title:o,baseUrl:r,shareId:s,fileSourceDetail:a})=>{const l=(0,v.gD)(e),{permissionScope:c}=a||{permissionScope:""};return{id:n,baseUrl:r,objectUrl:e,shareUrl:t,shareId:s,type:i,title:o,permissionScope:c,state:y.cj.reference,isReferencedFile:!0,serviceName:y.a4.p2p,previewUrl:"",chicletBreadcrumbs:{sourceChannelName:(null==l?void 0:l.sourceChannelName)||null,sourceTeamName:(null==l?void 0:l.sourceTeamName)||null},previewHeight:null,previewWidth:null,progressComplete:null,hasUploadFailed:!1}})(r)),m(t),t})),w=(e,t,i)=>{const{objectUrl:n,shareUrl:o,title:r,type:s}=e,a=T({objectUrl:n,shareUrl:o,itemid:t,type:s,title:r});I(i,a)},C=(e,t,i)=>{e.children&&_(t,e,i)},_=(e,t,i)=>{const n=[t];for(;0!==n.length;){const r=n.pop();if(r&&r.children)for(const s of r.children){if("text"===s.type&&(0,o.startsWith)(s.data,"https"))return s.data=e,t.attribs&&(t.attribs.title=i),!0;n.push(s)}}return!1},T=({objectUrl:e,shareUrl:t,itemid:i,type:n,title:o})=>({title:o,objectUrl:e,description:"",fileShareUrlMeta:{id:i,objectUrl:e,type:n,shareUrl:t}}),I=(e,t)=>{e.messageProperties.embeddedLinks=[...e.messageProperties.embeddedLinks||[],t],e.telemetryDatabag["DataBag.links"]=(e.telemetryDatabag["DataBag.links"]||0)+1},j=(e,t)=>{e.files.push(t)},N=(e,t)=>{const i=t.attribs[u.zj.itemid],n=e.find((e=>e.id===i));if(n){const{shareUrl:e,title:t,objectUrl:i,type:o}=n;return{shareUrl:e||"",title:t||"",type:o||"",objectUrl:i||""}}if(t.attribs[u.zj.itemtype]===p.T.filesHyperlink){const e=t.attribs[u.zj.itemProps];if(e){const t=(0,o.unescape)((0,o.unescape)(e)),i=JSON.parse(t),{type:n,objectUrl:r,shareUrl:s,title:a}=i;return{shareUrl:s,title:a,objectUrl:r,type:n}}}},E=(e,t)=>{if(d.N.DomUtils.hasAttrib(e,"href")){const i=e.attribs.href||"",n=t.existingLinks.filter((e=>{var t;return(null===(t=e.fileShareUrlMeta)||void 0===t?void 0:t.shareUrl)===i}));if(n&&n.length&&n[0].fileShareUrlMeta)return I(t,(0,c.i)(n[0],"__typename")),e}},x=(e,t,i)=>{m(e),null==t||t.fail({errorCode:h.le.telemetry.errorCodes.asyncLinkConversionPretransformFailure,errors:JSON.stringify(i)})},A=(e,t,i,n)=>{const{linkInfo:o}=e;let r="";if(o&&t===o.href){const{count:i}=o;r=`Duplicate links: ${i}`,n(Object.assign(Object.assign({},e),{linkInfo:{href:t,count:i+1}}))}else r="Different href for same itemid";null==i||i.incomplete({errorCode:h.le.telemetry.errorCodes.asyncLinkMultiplePretransform,errors:r})};var D=i(985047),F=i(817095),O=i(760005),M=i(711676);let R=class{constructor(){this._shouldGroupMentions=()=>this._enableComposeFrameworkV2&&this._enableGroupedMentions,this._unescapeMentionText=e=>this._enableComposeFrameworkV2?(0,o.unescape)(e).replace(/&nbsp;/g," "):e,this._removeExtraSpacesInMention=e=>{var t;null===(t=e.parent)||void 0===t||t.children.forEach((e=>{"text"!==e.type||" "!==e.data&&!this._isWhitespaceFromComposeV2(e.data)||d.N.DomUtils.removeElement(e)}))},this._getMentionKey=e=>{var t,i,n;const o=null===(i=null===(t=e.children)||void 0===t?void 0:t[0])||void 0===i?void 0:i.data;return`${null===(n=e.attribs)||void 0===n?void 0:n[u.zj.mri]}_${o}`},this._mergeMentions=(e,t)=>{if(!e.attribs)return;const i=e.attribs[u.zj.mri]||"";let n=this._getNextContigousMention(e,i);for(;e.children&&e.children.length>0&&n;){const o=n.children;if(o&&o.length>0&&o[0].data){const i=this._getMentionKey(n),r=t.get(i);r?t.set(i,r+1):t.set(i,1),e.children[0].data+=` ${o[0].data}`}n=this._getNextContigousMention(n,i)}},this._isWhitespaceFromComposeV2=e=>!("&nbsp;"!==e||!this._shouldGroupMentions()),this._getNextContigousMention=(e,t)=>{var i;if(!e||!e.next)return null;const n=e.next,o=t===(null===(i=null==n?void 0:n.attribs)||void 0===i?void 0:i[u.zj.mri]);return" "===n.data||this._isWhitespaceFromComposeV2(n.data)||o?n:null},this._enableComposeFrameworkV2=!1,this._enableGroupedMentions=!1}transform(e,t){var i,n,s;const{enableComposeFrameworkV2:a}=t.coreSettings.get(r.J.Messaging),{enableGroupedMentions:l}=t.coreSettings.get(r.J.Compose);if(this._enableComposeFrameworkV2=!!a,this._enableGroupedMentions=!!l,!(e&&t&&t.messageProperties&&d.N.DomUtils.hasAttrib(e,u.zj.mri)))return;t.seenMentions||(t.seenMentions=new Map);const c=this._getMentionKey(e),m=t.seenMentions.get(c);if(m)return 1===m?t.seenMentions.delete(c):t.seenMentions.set(c,m-1),null;this._mergeMentions(e,t.seenMentions);const{messageProperties:g,telemetryDatabag:h}=t;g.mentions||(g.mentions=[]),g.onBehalfOf||(g.onBehalfOf=[]);const v=`${g.mentions.length+g.onBehalfOf.length}`,y=this._unescapeMentionText((0,F.Q)(e)),f=(null===(i=null==e?void 0:e.attribs)||void 0===i?void 0:i[u.zj.type])||(P(e)?"bot":"person");if("tag"===f){const t=(null===(s=null===(n=null==e?void 0:e.attribs)||void 0===n?void 0:n[u.zj.mri])||void 0===s?void 0:s.startsWith("s"))?"PeopleTargeting.numScheduledTagMentions":"PeopleTargeting.numTeamTagMentions";h[t]=(h[t]||0)+1}else h["DataBag.atmentions"]=(h["DataBag.atmentions"]||0)+1;const S=(0,F.ln)(D.s.span),k=(0,F.rw)((0,o.escape)(y)),b=d.N.DomUtils.hasAttrib(e,u.zj.stale),w=d.N.DomUtils.getAttributeValue(e,u.zj.mri)||"";return d.N.DomUtils.appendChild(S,k),b||("webhook"===f?(g.onBehalfOf.push({itemId:v,displayName:y,userId:w,mentionType:f}),g.mentions.push({itemId:`${Number(v)+1}`,displayName:y,userId:O.BB.InterceptorBotMris[0],mentionType:f})):g.mentions.push({itemId:v,displayName:y,userId:w,mentionType:f}),S.attribs[u.zj.itemtype]=p.T.mention,S.attribs[u.zj.itemscope]="",S.attribs[u.zj.itemid]=v),this._removeExtraSpacesInMention(e),S}};R=(0,n.__decorate)([(0,a.wx)({name:"AtMentionSerializer",filter:"mention"}),(0,n.__metadata)("design:paramtypes",[])],R);const P=e=>{var t;return(0,M.bl)((null===(t=null==e?void 0:e.attribs)||void 0===t?void 0:t[u.zj.mri])||"")};let L=class{transform(e,t){if(!e.attribs)return void t.logger.error("image attribs is missing");const i=d.N.DomUtils.getAttributeValue(e,u.zj.cacheKey);if(i&&i.length)return e.attribs["data-cke-saved-src"]=void 0,e.attribs.src=t.offlineCacheManager.getCachedUrlByKey(i),e;t.logger.error("image missing cache key")}};L=(0,n.__decorate)([(0,a.wx)({name:"CachedImageSerializer",filter:[{itemtype:p.T.cachedImage}]})],L);let U=class{preTransform(e){return null}};U=(0,n.__decorate)([(0,a.wx)({name:"RemoveHiddenSelectionSerializer",filter:["data-cke-hidden-sel"]})],U);var W=i(513125);let B=class{transform(e){if(e.data&&W.Eh.test(e.data))return e.data=e.data.replace(new RegExp(W.Eh,"g"),""),e}};B=(0,n.__decorate)([(0,a.wx)({name:"RemoveZwsSerializer",filter:"text",transient:!0})],B);const $="data-only-whitespace",H=/^(\s|[\u200B-\u200D\uFEFF])*$/;let q=class{preTransform(e,t){return z(e)?void(t.whiteSpaceId&&t.whiteSpaceId++):(t.whiteSpaceId||(t.whiteSpaceId=1),e.attribs||(e.attribs={}),e.attribs[$]=`${t.whiteSpaceId+1}`,e)}};q=(0,n.__decorate)([(0,a.wx)({name:"WhiteSpacePreprocessor",filter:["div","p","br","span","text"],transient:!0})],q);const z=e=>!H.test((0,F.Q)(e))||!!d.N.DomUtils.findOne((e=>{if(e.attribs&&Object.keys(e.attribs).length||!e.name)return!0;switch(e.name.toLowerCase()){case"br":case"div":case"p":case"span":break;default:return!0}return!1}),[e]);let V=class{transform(e,t){const i=d.N.DomUtils.getAttributeValue(e,$);return!t.whiteSpaceId||!i||+i>t.whiteSpaceId?null:(e.attribs&&delete e.attribs[$],e)}};V=(0,n.__decorate)([(0,a.wx)({name:"TrailingWhiteSpaceSerializer",filter:[$],transient:!0})],V);var G=i(945148);const J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataM365ChatSuggestionStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365ChatSuggestionState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convId"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"experience"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"M365ChatExperience"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"M365ChatSuggestionState"}}},arguments:[]}]}}]},K={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataM365ChatGeoLocationQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365GeoLocation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"latitude"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Float"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"longitude"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Float"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"M365GeoLocation"}},arguments:[]}]}}]};let Q=class{transform(e,t){const{messageProperties:i,coreSettings:n,conversationMembers:s,cache:a,convId:l,loggerFactory:c}=t,{m365ChatBotIds:m,copilotBotDataVersion:g}=n.get(r.J.Messaging);if(!(Y(m,s,i,c,a,l,g,e)&&e&&t&&t.messageProperties&&d.N.DomUtils.hasAttrib(e,u.zj.itemtype)))return;const h=d.N.DomUtils.getAttributeValue(e,u.zj.itemtype);if(h!==p.T.editorCiqFile&&h!==p.T.editorCiqPeople&&h!==p.T.editorCiqMeeting&&h!==p.T.editorCiqEmail&&h!==p.T.editorCiqChat)return;const v=d.N.DomUtils.getAttributeValue(e,u.zj.itemProps);return v&&X((0,o.unescape)(v),i,null!=g?g:oe,h),e}};Q=(0,n.__decorate)([(0,a.wx)({name:"CopilotSerializer",filter:"*"})],Q);const Y=(e,t,i,n,o,r,s,a)=>{var l,c;const d=null!==(l=null==t?void 0:t.filter((e=>null==e?void 0:e.startsWith("28:"))))&&void 0!==l?l:[];let u=!1;if(1===(null==d?void 0:d.length)&&e){const t=e.indexOf(d[0]);void 0!==t&&(u=t>-1)}let m=null===(c=i.mentions)||void 0===c?void 0:c.find((e=>e.mentionType===ne));if(u&&!m){const e=Z(r,n,o,a);m={itemId:"0",userId:"3209c41b-0e5c-45cb-b72e-68dcecbaa23d",mentionType:ne,displayName:JSON.stringify(Object.assign({copilotBotDataVersion:null!=s?s:"1.0",files:[],people:[],meetings:[],chats:[],emails:[]},e))},i.mentions=[m]}return u},X=(e,t,i,n)=>{var o;let r=null===(o=t.mentions)||void 0===o?void 0:o.find((e=>e.mentionType===ne));r||(r={itemId:"0",userId:"3209c41b-0e5c-45cb-b72e-68dcecbaa23d",mentionType:ne,displayName:JSON.stringify({copilotBotDataVersion:"1.0",files:[],people:[],meetings:[],chats:[],emails:[]})});const s=JSON.parse(r.displayName),a=s.files,l=s.people,c=s.meetings,d=s.chats,u=s.emails,m=s.experienceType,g=s.locationInfo;let h;try{h=JSON.parse(ie(ie(e)))}catch(e){return}n===p.T.editorCiqFile&&a.push(h),n===p.T.editorCiqPeople&&l.push(h),n===p.T.editorCiqMeeting&&c.push(h),n===p.T.editorCiqChat&&d.push(h),n===p.T.editorCiqEmail&&u.push(h);const v={experienceType:m,locationInfo:g,copilotBotDataVersion:i||s.CopilotBotDataVersion,files:a,people:l,meetings:c,chats:d,emails:u};r.displayName=JSON.stringify(v),t.mentions=[r]},Z=(e,t,i,n)=>{const o=t.newLogger("CopilotSerializer","services-io-browser-compose-serializer-extensions");return{experienceType:ee(e,o,i,n),locationInfo:te(i,o)}},ee=(e,t,i,n)=>{const o="Default";if(!n)return o;const{experience:r,convId:s}=((e,t)=>{var i;let n=null;try{n=e.readQuery({query:J})}catch(e){null==t||t.error("Cannot read zero prompt state from the cache.")}const{convId:o,experience:r}=null!==(i=null==n?void 0:n.m365ChatSuggestionState)&&void 0!==i?i:{};return{convId:o,experience:r}})(i,t);return s===e&&r?r:o},te=(e,t)=>{const{latitude:i,longitude:n}=((e,t)=>{var i;let n=null;try{n=e.readQuery({query:K})}catch(e){null==t||t.error("Cannot read zero prompt state from the cache.")}const{latitude:o,longitude:r}=null!==(i=null==n?void 0:n.m365GeoLocation)&&void 0!==i?i:{};return{latitude:o,longitude:r}})(e,t);return i&&n?{lat:i,long:n}:void 0},ie=e=>e?e.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;/g,"&"):"",ne="Copilot",oe="1.0";var re=i(453489),se=i(709009);let ae=class{transform(e,t){const i=e.attribs["data-orig-src"],n=e.attribs.itemid;if(!i||!n)return;const o=t.superSizeEmoticons?"large":"small",r=(0,se.cn)(o),s=e.attribs.alt,a=(0,F.ln)("img",{alt:s,itemid:n,itemtype:p.T.customEmoji,src:i,style:`width:${r}px;height:${r}px;`}),l=(0,F.ln)("span",{contenteditable:"false"});return d.N.DomUtils.appendChild(l,a),l}};ae=(0,n.__decorate)([(0,a.wx)({name:"CustomEmojiSerializer",filter:{itemtype:p.T.customEmoji}})],ae);var le=i(160368);let ce=class{transform(e){return d.N.DomUtils.getAttributeValue(e,u.zj.itemProps)&&delete e.attribs[u.zj.itemProps],e}};ce=(0,n.__decorate)([(0,a.wx)({name:"FluidEmbedSerializer",filter:{itemtype:p.T.fluidEmbedLink}})],ce);var de=i(598143),ue=i(539744);let me=class{transform(e,t){const i=d.N.DomUtils.getAttributeValue(e,"href");if(!i||!e.attribs)return;const n=i.replace(/&amp;/g,"&");d.N.DomUtils.getAttributeValue(e,u.zj.itemProps)&&delete e.attribs[u.zj.itemProps];const o={appId:"fluid-card",cardClientId:(0,de.Z)(),contentType:ue.p.Fluid,content:JSON.stringify({componentUrl:n})};return t.messageProperties.cards=[o],t.files=void 0,e}};me=(0,n.__decorate)([(0,a.wx)({name:"FluidSerializer",filter:{itemtype:p.T.fluidLink}})],me);var ge=i(974509),he=i(188143),pe=i(734625),ve=i(519036),ye=i(671168),fe=i(659645);let Se=class{constructor(){this.getImageBlobUrlFromCache=(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=yield e.offlineCacheManager.get(t),n=yield i.blob();return URL.createObjectURL(n)})),this.processCachedImage=(e,t)=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var i;const n=d.N.DomUtils.getAttributeValue(e,u.zj.cacheKey);if(!n)return void this._logger.error("Cached image missing key attribute.");this._logger.log(`processing cached image: ${n}`);const o=null===(i=this._scenarioFactory)||void 0===i?void 0:i.newScenario(s.RG.SerializeCachedImage);try{const i=d.N.DomUtils.getAttributeValue(e,"src"),r=!!(null==i?void 0:i.startsWith("blob"));let a;try{const e=yield t.offlineCacheManager.get(n);a=yield null==e?void 0:e.blob()}catch(e){a=null,this._logger.warn(`processCachedImage: Could not find cached image with key=${n} in offlineCacheManager`)}if(!a&&r&&i&&(a=yield(0,ye.Hk)(i)),null===a)throw Error("Could not get image Blob neither from cache nor from blob data");null==o||o.mark(s.ck.SerializeCachedImageGotData);const l=yield this.uploadImage(a,t);be(e,l,t),null==o||o.mark(s.ck.SerializeCachedImageUploadedData),yield this.markCachedImageForDeletionIfUploaded(l,e,n,t,o)}catch(e){throw this._logger.error(`processCachedImage: Failed to process cached image with key=${n}`),null==o||o.fail(),e}finally{null==o||o.stop()}return e}))}transform(e,t){if(this._logger=t.loggerFactory.newLogger("InlineImageSerializer","services-io-browser-compose-serializer-extensions"),(0,fe.eD)(e.attribs.src))return Promise.resolve(e);if(e.attribs.itemtype===p.T.customEmoji)return Promise.resolve(e);if(!this.isConfigValid(t))return this._logger.error("invalid config"),Promise.resolve(void 0);this._scenarioFactory=t.scenarioFactory,this._settings=t.coreSettings;let i=d.N.DomUtils.getAttributeValue(e,"src");const{enableImprovedImageHandling:n,enableComposeFrameworkV2:o,enableImageBlobConversionForMessageEdit:s}=this._settings.get(r.J.Messaging);if(!i)return this._logger.error("image src is missing"),Promise.resolve(void 0);if((n||s)&&o){const t=d.N.DomUtils.getAttributeValue(e,"data-orig-src");i=t&&(0,pe.KD)(t)?t:i}const a=e.attribs.itemtype===p.T.amsImage||e.attribs.itemtype===p.T.cachedImage||e.attribs.itemtype===p.T.inlineImage?d.N.DomUtils.getAttributeValue(e,u.zj.itemid):void 0,l=null!=a?a:(0,pe.KD)(i);if(l)return this.handleAmsSourceTag(l,e,t);const c=d.N.DomUtils.getAttributeValue(e,u.zj.itemtype)===p.T.cachedImage,m=d.N.DomUtils.getAttributeValue(e,u.zj.itemtype)===p.T.inlineImage&&i.startsWith("blob:");return c||m?this.processCachedImage(e,t):i.startsWith("http://")||i.startsWith("https://")?(0,ve.kf)(i)?this.processKnownImage(i,t.telemetryDatabag):this.handleKnownProtcolSourceTag(i,"HttpUrl",e,t):i.startsWith("blob:")?this.handleKnownProtcolSourceTag(i,"BlobUrl",e,t):(this._logger.error("Unsupported image! deleting it."),Promise.resolve(null))}uploadPermissionsUpdateToCache(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{this._logger.log("uploadPermissionsUpdateToCache: uploading image permissions update to offline cache storage");const i={type:"PermissionsUpdate",amsId:e,convId:t.conversationId},n=JSON.stringify(i),[o,r]=yield t.offlineCacheManager.saveDynamic(new Response(n,{headers:new Headers({"Content-Type":"application/json","Cache-Control":"max-age=259200, s-maxage=0, private","Content-Length":`${n.length}`,Date:(new Date).toUTCString()})}));return this._logger.log(`uploadPermissionsUpdateToCache: Uploaded image permissions update to offline cache, response URL: ${r} objectId: ${o}`),t.messageProperties.offlineAssets=[...t.messageProperties.offlineAssets||[],o],o}catch(e){throw this._logger.error("uploadPermissionsUpdateToCache: uploading image permissions update to offline cache store failed!"),e}}))}handleAmsSourceTag(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const n="AMS",o=yield i.asyncMediaService.forwardContent(e,i.conversationId);return this._logger.log(`forwarded ams image ${e} to ${o.objectId}`),i.messageProperties.amsReferences=[...i.messageProperties.amsReferences||[],o.objectId],be(t,Object.assign(Object.assign({},o),{uploadType:n}),i),t}catch(e){const{enableAutoEditV2:t}=this._settings.get(r.J.Messaging);if(!t)throw this._logger.error("handleAmsSourceTag: forward content failed!"),e;this._logger.warn("handleAmsSourceTag: initial forward content failed, attempting to upload image to cache")}try{return yield this.uploadPermissionsUpdateToCache(e,i),ke(i),t}catch(e){throw this._logger.error("handleAmsSourceTag: forward content failed! Fallback uploading to the cache also failed!"),e}}))}handleKnownProtcolSourceTag(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const n=yield we(e,t,o),r=yield this.uploadImage(n,o);return be(i,r,o),i}catch(e){throw this._logger.error("handleKnownProtcolSourceTag: pasted from web image upload failed"),this.addDiagnosticCodeToError(e),e}}))}uploadImage(e,t,i=!1){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{return yield this.uploadImageToAms(e,t,this._logger)}catch(n){this._logger.error("uploadImage: image upload to AMS failed!");const{enableCacheStorageInSendMessageMW:o,msgEnableRestrictImagePasting:s}=this._settings.get(r.J.Messaging);if(!o||s||i)throw n;this._logger.debug("Trying to upload inline image to cache storage");return yield this.uploadToCache(e,t,this._logger)}}))}uploadImageToAms(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=t.asyncMediaService.createAmsScenario(s.RG.AmsImageUpload);try{const o="AMS",r=yield t.asyncMediaService.uploadItem(e,t.conversationId,"IMAGE","MicrosoftTeams-image.png",he.r1.Inline);return i.log(`Uploaded image to ams, image: ${r.inlineSizeUrl} objectId: ${r.objectId}`),n.stop(),t.messageProperties.amsReferences=[...t.messageProperties.amsReferences||[],r.objectId],Object.assign(Object.assign({},r),{uploadType:o})}catch(e){throw n.fail({errors:e.message}),i.error("Ams image upload failed!"),e}}))}uploadToCache(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{i.log("uploading inline image to offline cache storage");const[n,o]=yield t.offlineCacheManager.saveDynamic(new Response(e,{headers:new Headers({"Content-Type":e.type,"Cache-Control":"max-age=259200, s-maxage=0, private","Content-Length":`${e.size}`,Date:(new Date).toUTCString()})}));i.log(`Uploaded image to offline cache, image: ${o} objectId: ${n}`);const r="OfflineCache";t.messageProperties.offlineAssets=[...t.messageProperties.offlineAssets||[],n];return{objectId:n,inlineSizeUrl:yield this.getImageBlobUrlFromCache(t,n),uploadType:r}}catch(e){throw i.error("uploadToCache: uploading inline image to offline cache store failed!"),e}}))}markCachedImageForDeletionIfUploaded(e,t,i,o,r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){return"OfflineCache"!==e.uploadType&&(null==r||r.mark(s.ck.SerializeCachedImageDeletedEntry,void 0),o.nonBlockingDeletableCacheKeys.push(i),t.attribs&&delete t.attribs[u.zj.cacheKey],!0)}))}isConfigValid(e){return!!(e&&e.asyncMediaService&&e.messageProperties&&e.imageProxyService&&e.conversationId&&e.telemetryDatabag&&e.offlineCacheManager)}processKnownImage(e,t){return e.endsWith(".gif")&&(t["DataBag.giphy"]=(t["DataBag.giphy"]||0)+1),Promise.resolve(void 0)}addDiagnosticCodeToError(e){if(e.serverResponse&&e.serverResponse.status){if(e.serverResponse.status===ge.qb.UNSUPPORTED_MEDIA_TYPE)e.reason=Object.assign(Object.assign({},e.reason),{errorCode:pe.hA.IMAGE_SIZE_TOO_LARGE})}}};Se=(0,n.__decorate)([(0,a.HR)({name:"InlineImageSerializer",filter:["img","image"]})],Se);const ke=e=>{e.telemetryDatabag["DataBag.inlineImages"]=(e.telemetryDatabag["DataBag.inlineImages"]||0)+1},be=(e,t,i)=>{e.attribs||(e.attribs={}),e.attribs.id=t.objectId,e.attribs.itemid=t.objectId,e.attribs.href=t.inlineSizeUrl,e.attribs["target-src"]=t.inlineSizeUrl,e.attribs.src=t.inlineSizeUrl,e.attribs[u.zj.itemtype]="AMS"===t.uploadType?p.T.amsImage:p.T.cachedImage,ke(i)},we=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){let n=null;return"BlobUrl"===t?n=yield(0,ye.Hk)(e):"HttpUrl"===t&&(n=yield i.imageProxyService.getImageAsBlob(e)),n}));var Ce=i(765923),_e=i(558632),Te=i(64217),Ie=i(727064),je=i(643133),Ne=i(222358);let Ee=class{transform(e,t){var i,o,a,l;return(0,n.__awaiter)(this,void 0,void 0,(function*(){this._logger=t.loggerFactory.newLogger("InlineVideoSerializer","services-io-browser-compose-serializer-extensions");const{enableInlineVideoMessageClosedCaptionsMultiLanguageSupport:n}=t.coreSettings.get(r.J.Messaging),c=t.scenarioFactory.newScenario(s.RG.InlineVideoAsyncTransform),{conversationId:d,videoMessageLieUpdater:u}=t;if(!(e&&e.attribs&&0!==Object.keys(e.attribs).length&&t.asyncMediaService&&t.offlineCacheManager&&u))return c.fail({errorCode:"unexpected_precondition"}),void(null===(o=(i=this._logger).errorToTelemetry)||void 0===o||o.call(i,`unexpected precondition : element - ${e}`,"messaging_inline_video_serializer_error_tracking",void 0,!0));this._offlineCacheManager=t.offlineCacheManager,this._asyncMediaService=t.asyncMediaService;const m=xe(e);if(!m)return c.fail({errorCode:"malformed_video_message"}),void(null===(l=(a=this._logger).errorToTelemetry)||void 0===l||l.call(a,`malformed video message: element - ${e}, additionalData - ${t}`,"messaging_inline_video_serializer_error_tracking",void 0,!0));c.appendEventData({correlationId:m.cacheKey});const g=yield this.resolveAMSItem(c,d,u,m);if(n){const e=t.scenarioFactory.newScenario(s.RG.VideoMessageTranscriptMetadataUpload);e.appendEventData({correlationId:m.cacheKey}),yield this.uploadTranscriptMetadata(e,g,t.i18n,m.cacheKey,u,m.transcriptUploadStatus),e.stop()}const h=t.scenarioFactory.newScenario(s.RG.VideoMessageThumbnailUpload);h.appendEventData({correlationId:m.cacheKey}),yield this.bestEffortUploadAMSVideoThumbnail(h,g,u,m),h.stop(),yield this.uploadAMSVideo(c,g,u,m),t.messageProperties.amsReferences=[...t.messageProperties.amsReferences||[],g];const p=this.createVideoMessageTag(e.attribs,m.src);return this.bestEffortCleanOfflineCacheManager(c,m.cacheKey,!!m.thumbnailUploadProgress),c.stop(),p}))}createVideoMessageTag(e,t){const i=(0,F.ln)("video",{src:t,itemscope:"",itemtype:p.T.amsVideo,"data-duration":e[u.zj.duration],width:e[u.zj.width],height:e[u.zj.height]});return i.children=[(0,F.rw)(Ie.R2)],i}resolveAMSItem(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const n=yield this.createAMSObjectIfRequired(e,t,i,o.cacheKey,o.src);return o.src=n.src,n.objectId}catch(t){throw e.fail({errorCode:"create_ams_object_failed"}),new Error(`create ams object failed:${t.toString()}`)}}))}createAMSObjectIfRequired(e,t,i,o,r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!r){e.mark(s.ck.ItemCreationStart);const n=yield this._asyncMediaService.createVideoObject(t,o),r=(0,Ie.$N)(n.amsUrl,n.objectId);return this.bestEffortMessageLieUpdate(e,i,o,u.zj.src,r),e.mark(s.ck.ItemCreationStop),Object.assign(Object.assign({},n),{src:r})}e.mark(s.ck.UploadRetry);return{objectId:(0,pe.KD)(r),amsUrl:(0,_e.DW)(r),src:r}}))}bestEffortUploadAMSVideoThumbnail(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(o.thumbnailUploadProgress&&o.thumbnailUploadProgress.progress!==o.thumbnailUploadProgress.total)try{const n=yield this.uploadAMSVideoThumbnail(e,t,i,o.cacheKey);o.thumbnailUploadProgress=n}catch(t){this._logger.warn("video thumbnail upload failed",t),e.fail({errorCode:"thumbnail_upload_failed"})}}))}uploadAMSVideoThumbnail(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){e.mark(s.ck.ThumbnailUploadStart);const n=yield this._offlineCacheManager.get((0,je.cQ)(o)),r=yield n.blob();yield this._asyncMediaService.uploadVideoThumbnail(t,r,o);const a={progress:r.size,total:r.size};return this.bestEffortMessageLieUpdate(e,i,o,u.zj.thumbnailUploadProgress,(0,Ie.tl)(a.progress,a.total)),e.mark(s.ck.ThumbnailUploadStop),a}))}uploadTranscriptMetadata(e,t,i,o,r,a){var l,c;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(a!==Ie.b3.success){const n=i.locale,a=null===(l=i.osLocaleInfo)||void 0===l?void 0:l.regionalFormat,d=[...(null===(c=(0,Ce.J)())||void 0===c?void 0:c.navigator.languages)||[]],m=(0,Ne.r)(n,a,d);try{e.mark(s.ck.TranscriptMetadataUploadStart,{message:m}),yield this._asyncMediaService.uploadTranscriptMetadata(t,m||"en-us",o),this.bestEffortMessageLieUpdate(e,r,o,u.zj.transcriptUploadStatus,Ie.b3.success),e.mark(s.ck.TranscriptMetadataUploadStop)}catch(t){e.fail({errorCode:"video_transcript_metadata_upload_failed"}),this.bestEffortMessageLieUpdate(e,r,o,u.zj.transcriptUploadStatus,Ie.b3.failure)}}}))}uploadAMSVideo(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{e.mark(s.ck.VideoUploadStart);const n=yield this._offlineCacheManager.get((0,je.If)(o.cacheKey)),r=yield n.blob();yield this._asyncMediaService.uploadVideo(t,o.uploadProgress.progress,r,this.updateMessageLieVideoUploadProgress(e,i,o),o.cacheKey),e.mark(s.ck.VideoUploadStop)}catch(t){throw e.fail({errorCode:"video_upload_failed"}),new Error(`video upload failed:${t.toString()}`)}}))}bestEffortCleanOfflineCacheManager(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{yield this._offlineCacheManager.delete((0,je.If)(t))}catch(t){this._logger.warn("video cache cleanup failed",t),e.mark(s.ck.VideoCacheCleanFailed)}try{i&&(yield this._offlineCacheManager.delete((0,je.cQ)(t)))}catch(t){this._logger.warn("thumbnail cache cleanup failed",t),e.mark(s.ck.ThumbnailCacheCleanFailed)}}))}updateMessageLieVideoUploadProgress(e,t,i){return n=>{const o=n+1;i.uploadProgress.progress=o,this.bestEffortMessageLieUpdate(e,t,i.cacheKey,u.zj.uploadProgress,(0,Ie.tl)(i.uploadProgress.progress,i.uploadProgress.total))}}bestEffortMessageLieUpdate(e,t,i,n,o){try{t(i,n,o)}catch(t){e.mark(s.ck.MessageLieUpdateFailed),this._logger.warn(t.toString())}}};Ee=(0,n.__decorate)([(0,a.HR)({name:"InlineVideo",filter:[{itemtype:p.T.amsVideo}]})],Ee);const xe=e=>{const t=d.N.DomUtils.getAttributeValue,i=t(e,u.zj.itemtype),n=t(e,u.zj.cacheKey),o=t(e,u.zj.src),r=t(e,u.zj.transcriptUploadStatus),s=t(e,u.zj.uploadProgress),a=t(e,u.zj.thumbnailUploadProgress),l=t(e,u.zj.duration),c=t(e,u.zj.width),m=t(e,u.zj.height);if(!i||!n||!s||!c||!m||!l||Number.isNaN(c)||Number.isNaN(m)||!(0,Ie.cJ)(s))return;const g={itemType:i,cacheKey:n,uploadProgress:(0,Ie.VI)(s),width:+c,height:+m,duration:+(0,Te.J)(l),transcriptUploadStatus:r||Ie.b3.pending};return o&&(g.src=o),a&&(g.thumbnailUploadProgress=(0,Ie.VI)(a)),g};let Ae=class{transform(e,t){var i,r,a,l;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(!e||!t.messageProperties)return;const n=t.loggerFactory.newLogger("VideoMessageComposeSerializer","services-io-browser-video-message-compose-serializer"),c=t.scenarioFactory.newScenario(s.RG.VideoMessageComposeTransform);c.mark(s.ck.VideoMessageValidation);const u=(0,o.unescape)(d.N.DomUtils.getAttributeValue(e,W.Qq)),m=d.N.DomUtils.getAttributeValue(e,W.fK);if(!u||!m)return null===(i=n.errorToTelemetry)||void 0===i||i.call(n,`The props are invalid from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null;c.mark(s.ck.VideoMessageParsing);let g=null;try{g=JSON.parse(u)}catch(t){return null===(r=n.errorToTelemetry)||void 0===r||r.call(n,`Failed to parse props from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null}if(!g||!g.amsObjectUrl)return null===(a=n.errorToTelemetry)||void 0===a||a.call(n,`The amsObjectUrl is missing from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null;try{c.mark(s.ck.VideoMessageUpdateCard),this._updateCard(m,g,t),c.mark(s.ck.VideoMessageCreateTag);return this.createVideoMessageTag(g,m)}catch(e){return null===(l=n.errorToTelemetry)||void 0===l||l.call(n,"Failed to create the video tag additionalData","messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null}}))}createVideoMessageTag(e,t){const i=(0,F.ln)("video",{src:e.amsObjectUrl,cardId:t,itemscope:"",itemtype:p.T.amsVideo,"data-duration":(0,Ie.Hu)(e.duration),width:e.width.toString(),height:e.height.toString()});return i.children=[(0,F.rw)(Ie.R2)],i}_updateCard(e,t,i){var n;const{amsObjectId:o}=t,r=i.messageProperties.amsReferences||[];i.messageProperties.amsReferences=[...r,o];const s=(null===(n=i.messageProperties.cards)||void 0===n?void 0:n.filter((t=>t.cardClientId!==e)))||[];i.messageProperties.cards=s}};Ae=(0,n.__decorate)([(0,a.HR)({name:"VideoMessage",filter:{[W.$S]:"VideoMessageCard"}})],Ae);var De=i(771256);const Fe=(e,t,i)=>{e.forEach((e=>Oe(e,t,i)))},Oe=(e,t,i)=>{(0,De.gU)(e,{type:"TextBlock"},(e=>{Me(e.text,t,i)})),(0,De.gU)(e,{type:"FactSet"},(e=>{e.facts.forEach((e=>{Me(e.title,t,i),Me(e.value,t,i)}))}))},Me=(e,t,i)=>{const n=e.toLowerCase(),o='itemid="',r=n.indexOf(o),s=r+8;if(r>-1){const o=n.substring(s,s+1);if(t&&o){const n=Re(o,t,i);n&&(e=e.replace(new RegExp(o,"g"),n))}}},Re=(e,t,i)=>{let n="";return t.forEach((t=>{if(t.itemId===e){const{messageProperties:e,telemetryDatabag:o}=i;e.mentions||(e.mentions=[]),n=`${e.mentions.length}`;const r=t.displayName||"",s=t.mentionType||"",a=t.userId||"";o["DataBag.atmentions"]=(o["DataBag.atmentions"]||0)+1,e.mentions.push({itemId:n,displayName:r,userId:a,mentionType:s})}})),n};var Pe=i(690250);let Le=class{transform(e,t){if(!e||!t||!t.messageProperties)return;const{loggerFactory:i,coreSettings:s}=t,a=s.get(r.J.Extensibility).enableJITInstallForACv2FromComposeV2||!1,l=i.newLogger("MessageExtensionCardSerializer","services-io-browser-compose-serializer-extensions"),c=(0,o.unescape)(d.N.DomUtils.getAttributeValue(e,W.Qq)),u=d.N.DomUtils.getAttributeValue(e,W.fK);if(!c)return l.error("The props was missing"),null;if(!u)return l.error("The id of the card was missing"),null;try{const i=t.messageProperties.cards||[],{card:r,renderJitInstallConsentFooter:s}=JSON.parse(c);if(!(0,o.isObject)(r))throw new Error("not valid JSON object");(0,o.isString)(r.contentType)&&r.contentType.toLowerCase()===Pe.s.Adaptive&&r.content&&((e,t)=>{const i=JSON.parse(e),n=i.body,o=(0,De.NI)(i);o&&n&&Fe(n,o,t)})(r.content,t);const{__typename:l}=r,m=(0,n.__rest)(r,["__typename"]);m.cardClientId=u,t.messageProperties.cards=[...i,m];const g=d.N.DomUtils.getElements({"data-tid":"jit-install-consent-footer"},e);(a?!!s:!(0,o.isEmpty)(g))&&(t.messageProperties.appIdsToInstall=(0,o.union)(t.messageProperties.appIdsToInstall,[r.appId]));const h=(0,F.ln)("span",{content:u,itemprop:"cardId"}),v=(0,F.ln)("span",{class:"inline-compose-card",itemid:u,itemscope:"",itemtype:p.T.inputExtension});return d.N.DomUtils.appendChild(v,h),v}catch(e){return l.error("Error while adding message extension card to message",e),null}}};Le=(0,n.__decorate)([(0,a.wx)({name:"MessageExtension",filter:{[W.$S]:"MessageExtensionCard"}})],Le);var Ue=i(878652);let We=class{constructor(){}transform(e,t){const{loggerFactory:i}=t;if(!e)return;const n=(0,o.unescape)(d.N.DomUtils.getAttributeValue(e,W.Qq));if(!n)return;const r=(0,Ue.D)(n);if((0,o.isEmpty)(r))return void i.newLogger("QuotedReplySerializer","services-io-browser-compose-serializer-extensions").error("Json parsing failed: ",n);const{from:s,messageId:a,preview:l,timestamp:c,userName:u}=r;if(!(s&&a&&l&&u))return void i.newLogger("QuotedReplySerializer","services-io-browser-compose-serializer-extensions").error("Json parsing failed: ",n);const m=(0,F.ln)("blockquote",{itemscope:"",itemtype:p.T.reply,itemid:a}),g=(0,F.ln)("strong",{itemprop:"mri",itemid:s}),h=(0,F.rw)((0,o.escape)(u));if(d.N.DomUtils.appendChild(g,h),d.N.DomUtils.appendChild(m,g),c){const e=(0,F.ln)("span",{itemprop:"time",itemid:c.toString()});d.N.DomUtils.appendChild(m,e)}const v=(0,F.ln)("p",{itemprop:"preview"}),y=(0,F.rw)((0,o.escape)(l));return d.N.DomUtils.appendChild(v,y),d.N.DomUtils.appendChild(m,v),m}};We=(0,n.__decorate)([(0,a.wx)({name:"QuotedReply",filter:{[W.$S]:"QuotedReplyCard"}}),(0,n.__metadata)("design:paramtypes",[])],We);let Be=class{transform(e){return(0,o.isEmpty)(e.children)&&d.N.DomUtils.appendChild(e,(0,F.rw)(" ")),e}};Be=(0,n.__decorate)([(0,a.wx)({name:"TableCellSerializer",filter:"td",transient:!0})],Be);let $e=class{transform(e){return e.attribs.class="copy-paste-table",e.attribs.itemprop="copy-paste-table",e}};$e=(0,n.__decorate)([(0,a.wx)({name:"TableSerializer",filter:"table",transient:!0})],$e);var He=i(825668),qe=i(331748);let ze=class{transform(e,{authenticationUser:t,convId:i}){if(!e||!d.N.DomUtils.hasAttrib(e,u.zj.itemid))return;const n=(0,F.ln)(D.s.span),o=(0,F.rw)((0,F.Q)(e));d.N.DomUtils.appendChild(n,o);const r=d.N.DomUtils.getAttributeValue(e,u.zj.itemid)||"",s=t?(0,He.I6)({userAadObjectId:t.profile.objectId,tenantAadObjectId:t.profile.tenantId}):void 0;return null==s||s.logEvent(qe.z.ManualTagSend,{topicId:r,isTopicNameNumeric:!isNaN(parseFloat(this._getTopicName(e))),contextId:i}),n.attribs[u.zj.itemtype]=p.T.topic,n.attribs[u.zj.itemid]=r,n}_getTopicName(e){const t=(0,F.Q)(e);return t.startsWith("#")?t.substring(1):t}};ze=(0,n.__decorate)([(0,a.wx)({name:"TopicSerializer",filter:"topic"})],ze);var Ve=i(132756),Ge=i(80033);let Je=class{transform(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=t.coreSettings.get(r.J.Extensibility).postSendTimeoutInMs||2e3,{areUrlPreviewsAllowed:n}=t.coreSettings.get(r.J.Messaging);if(!!!n||!t.connectedExperienceEnabled||!e||!t.messageProperties||t.messageProperties.urlPreview||!t.urlPreviewService||!t.appBasedLinkService||!d.N.DomUtils.hasAttrib(e,"href"))return;const o=t.loggerFactory.newLogger("UrlPreviewSerializer","services-io-browser-compose-serializer-extensions"),s=e.attribs.href||"",a=[this.getUrlPreviewFromAppTimed(s,i,t,o),this.getUrlPreviewTimed(s,i,t,o)],[l,c]=yield Promise.all(a),u=l||c&&Qe(c);return u?(t.messageProperties.urlPreview=u,e):void 0}))}getUrlPreviewFromAppTimed(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{enableAppBasedLink:n}=i.coreSettings.get(r.J.Extensibility),{enableGetRichLinkToTeamOrChannel:a}=i.coreSettings.get(r.J.TeamsAndChannels),{deepLinkDomains:c}=i.coreSettings.get(r.J.Messaging);if(!n)return Promise.resolve(void 0);const d={enableDomainLinks:a,currentDomainLinks:c};if((0,Ge.D)(e,d))return;const u=i.scenarioFactory.newScenario(s.RG.ExtGetAppPreviewPostSend),m=i.getInstalledMessageExtensionApps(),g="post send app preview timed out";try{const n=yield(0,l.E)(i.appBasedLinkService.getUrlPreviewFromApp(e,m,i.getAppDefinitions,u,i.convId),t,g);return u.stop(),n}catch(t){return Ke(t)&&t.code===Ve.jK.TimedOut&&t.context===Ve.w5.Timed?u.incomplete({errors:g}):u.fail(),void o.warn(`fetching app preview for url: ${e} failed with error: ${t}`)}}))}getUrlPreviewTimed(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{enableGetRichLinkToTeamOrChannel:n}=i.coreSettings.get(r.J.TeamsAndChannels),{deepLinkDomains:s}=i.coreSettings.get(r.J.Messaging),a={enableDomainLinks:n,currentDomainLinks:s};if(!(0,Ge.D)(e,a))try{return yield(0,l.E)(i.urlPreviewService.getPreview(e),t,"url preview timed out")}catch(t){return void o.warn(`fetching url preview for url: ${e} failed with error: ${t}`)}}))}};Je=(0,n.__decorate)([(0,a.HR)({name:"URLPreviewSerializer",filter:"a",transient:!0})],Je);const Ke=e=>!!(e&&((0,o.get)(e,"code")&&(0,o.get)(e,"context")||(0,o.get)(e,"reason"))),Qe=e=>({url:e.url,title:e.title,description:e.description,previewEnabled:!0,thumbnail:e.thumbnail,thumbnailMeta:e.thumbnail_meta}),Ye=[R],Xe=[B,U,re.D,R,Q,ze,Be,$e,ae,le.p,q,V,me,ce,Le,We],Ze=[Se,G.O,Ae,Je,S,Ee],et=[L]},990489:(e,t,i)=>{"use strict";i.d(t,{T:()=>o});var n=i(38023);class o{constructor(){this._executeCommandSubject=new n.X(void 0),this.executeCommand=(e,t)=>{this._executeCommandSubject.next({windowId:e,commandId:t})}}get executeCommandObservable(){return this._executeCommandSubject.asObservable()}}},328283:(e,t,i)=>{"use strict";i.d(t,{N:()=>s});var n=i(740597),o=i(50805),r=i(575644);class s{constructor(e,t,i,n){this.logsCollectorService=t,this.coreSettings=i,this.hostCommunicationService=n,this.defaultLogsFilesDownloadDelayIntervalMs=333,this.defaultLogsFileUploadTimer=15e3,this.logger=e.newLogger("LogsFilesService","services-io-browser-logs-files")}downloadLogsFiles(e,t=!0,i){var r,s,a,l;return(0,n.__awaiter)(this,void 0,void 0,(function*(){this.logsCollectorService.setDownloadLogStatus(!0);let c=!0,d=this.defaultLogsFilesDownloadDelayIntervalMs;if(this.coreSettings){const e=this.coreSettings.get(o.J.Diagnostics);c=e.enableLogsFilesDownload||!1,d=e.logsFilesDownloadDelayIntervalMs||this.defaultLogsFilesDownloadDelayIntervalMs}if(!c)return this.logger.error(`Unabled to download logs files - logs files download is not enabled: ${c}`),!1;if(!e)return this.logger.error(`Unabled to download logs files - no host present: ${e}`),!1;const u=this.hostCommunicationService&&i;let m=0;const g=yield this.logsCollectorService.callOnLogsFiles((t=>(0,n.__awaiter)(this,void 0,void 0,(function*(){let o;const r=new Promise((r=>{o=e.setTimeout((()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=u?yield this.uploadLogsFileToVirtualServer(t,e,i,!1):yield this.downloadLogsFile(t,e);r(n)}))),m*d)})).then((t=>(void 0!==o&&e.clearTimeout(o),t)));return m++,r}))),t);if(g){if(u){const e=yield null===(a=this.hostCommunicationService)||void 0===a?void 0:a.loadModule("logscollection");null===(l=null==e?void 0:e.webLogsDownloadCompleted)||void 0===l||l.call(e,{webLogsId:i})}}else{if(u)return null===(s=(r=this.logger).errorToTelemetry)||void 0===s||s.call(r,"Failed to upload all logs files to virtual server","logs_downloading"),this.downloadLogsFiles(e,!0);this.logger.error("Failed to download all logs files")}return this.logsCollectorService.setDownloadLogStatus(!1),g}))}downloadLogsFile(e,t){let i,n="";try{let o;o="string"==typeof e.content?new Blob([null==e?void 0:e.content],{type:"text/plain;charset=utf-8"}):e.content,n=URL.createObjectURL(o);const r=t.document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",null==e?void 0:e.fileName),r.click(),r.remove(),i=!0}catch(t){this.logger.error(`Failed to download logs file ${null==e?void 0:e.fileName} - error:`,t),i=!1}return n&&URL.revokeObjectURL&&URL.revokeObjectURL(n),Promise.resolve(i)}uploadLogsFileToVirtualServer(e,t,i,o){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n=!1;try{const s=`${t.location.origin}/desktop/upload/log-collector/${i}/${e.fileName}`,a=t.fetch(s,{method:"PUT",headers:{"Content-Type":"text/plain"},body:e.content}),l=yield(0,r.E)(a,this.defaultLogsFileUploadTimer);l.ok?n=!0:this.logger.error(`Failed to upload logs file to virtual server - ${null==e?void 0:e.fileName}, isRetry - ${o}, status - ${l.statusText}`)}catch(t){this.logger.error(`Failed to upload logs file to virtual server - ${null==e?void 0:e.fileName}, - isRetry- ${o}, - in ${this.defaultLogsFileUploadTimer} ms, - error:`,t)}return n||o?Promise.resolve(n):this.uploadLogsFileToVirtualServer(e,t,i,!0)}))}}},838440:(e,t,i)=>{"use strict";i.d(t,{XD:()=>r,jW:()=>s,Ko:()=>a,F$:()=>l,OB:()=>c,bF:()=>d});var n=i(740597),o=i(58826);const r=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const{data:t}=yield e.query({query:o.i8});return null==t?void 0:t.activeWindows})),s=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const t=yield r(e);return null==t?void 0:t.find((e=>e.isMainWindow&&"standard"===e.layoutConfig.layoutMode))})),a=e=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const t=yield r(e);return null==t?void 0:t.filter((e=>e.isMainWindow))})),l=e=>{try{const t=e.readQuery({query:o.i8});return null==t?void 0:t.activeWindows}catch(e){return}},c=e=>e.watchQuery({query:o.i8}),d=(e,t)=>{try{return e.writeQuery({query:o.i8,data:{activeWindows:t}}),!0}catch(e){return!1}}},281423:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataActiveWindowsSaveReactiveVarsToHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"saveReactiveVarsToHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"Argument",name:{kind:"Name",value:"appIds"},value:{kind:"Variable",name:{kind:"Name",value:"appIds"}},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}]}}]}},58826:(e,t,i)=>{"use strict";i.d(t,{i8:()=>c});const n={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WindowOptions"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"left"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"top"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]}]}}]},o={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"action"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"options"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"windowOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowOptions"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"WindowOptions"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"linkedEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_linkedEntity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"LinkedEntity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"entityState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"flushableByLinkedEntity"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityState"}}},arguments:[]}]}},...n.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_linkedEntity"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LinkedEntity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"type"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"action"},__type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}},arguments:[]}]}}]}.definitions]},r={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_window"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Window"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"startTimestamp"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"source"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"clientLaunchId"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Correlation"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"extendedEntityContainerState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"containerState"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExtendedContainerState"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isExternal"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExtendedEntityContainerState"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"blockingEntityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"blockedEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"blockedCommand"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"visibilityState"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityVisibilityState"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"stateTransition"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityStateTransition"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"startTimestamp"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"source"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Correlation"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"EntityCommand"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"blockedEntityOptions"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"BlockingEntityExtension"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isMainWindow"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isNotificationsWindow"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isInitialWindowStateHidden"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"userContextId"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"layoutConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layoutMode"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LayoutModes"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isFullscreen"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"slots"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contextualNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"header"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"end"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"main"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"monitor"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"nav"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"notifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"inAppNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"start"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"subNav"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"titleBar"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"toasts"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isHidden"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"width"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotLayoutConfig"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"SlotsLayoutConfig"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LayoutConfig"}}},arguments:[]}]}},...o.definitions]},s={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeEntities"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActiveEntities"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subNavEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"headerEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"startEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"endEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"entityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"monitorEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"inAppNotificationsEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},arguments:[]}]}},...o.definitions]},a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryItem"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WindowHistoryItem"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeEntities"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActiveEntities"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"reactiveVars"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"JSONData"}}},arguments:[]}]}},...s.definitions]},l={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationState"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Window"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"windowHistoryNavigationState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"canNavigateBack"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"canNavigateForward"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"backHistory"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationItem"}}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WindowHistoryNavigationItem"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"forwardHistory"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationItem"}}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WindowHistoryNavigationItem"}}}}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WindowHistoryNavigationState"}}},arguments:[]}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationItem"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WindowHistoryNavigationItem"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"windowHistoryIndex"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"entity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Entity"}}},arguments:[]}]}},...o.definitions]}.definitions]},c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataActiveWindowsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeWindows"}}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Window"}}}}},arguments:[]}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeWindows"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Window"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"windowOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowOptions"}}]},__type:{kind:"NamedType",name:{kind:"Name",value:"WindowOptions"}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_window"}},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeEntities"}}]},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActiveEntities"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"windowHistory"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryItem"}}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"WindowHistoryItem"}}}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"currentWindowHistoryIndex"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},arguments:[]},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationState"}}]}},...n.definitions,...r.definitions,...s.definitions,...a.definitions,...l.definitions]}.definitions]}},817861:(e,t,i)=>{"use strict";i.d(t,{x:()=>C});var n,o=i(740597),r=i(74583);!function(e){e.Info="Info",e.Warning="Warning",e.Error="Error",e.Debug="Debug"}(n||(n={}));var s=i(419925),a=i(955105),l=i(50805),c=i(516909),d=i(405501);const u={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationUserQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"defaultName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"isMailAddress"},value:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"Argument",name:{kind:"Name",value:"defaultName"},value:{kind:"Variable",name:{kind:"Name",value:"defaultName"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"mri"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"email"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"User"}}}]}}]},m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationGetUsersQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mriOrEmailArray"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mriOrEmailArray"},value:{kind:"Variable",name:{kind:"Name",value:"mriOrEmailArray"}},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"Argument",name:{kind:"Name",value:"isMailAddress"},value:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"mri"},__type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"email"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"displayName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"emailForQuery"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"User"}}}}}]}}]},g={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationPresenceSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PresenceSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presenceUpdateEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PresenceSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"availability"},__type:{kind:"NamedType",name:{kind:"Name",value:"Availability"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"activity"},__type:{kind:"NamedType",name:{kind:"Name",value:"Activity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isOutOfOffice"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"lastSeenAt"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"Presence"}}}]}}]},h={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationPresencesQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userPresenceRequestArray"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPresenceRequest"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userPresenceRequestArray"},value:{kind:"Variable",name:{kind:"Name",value:"userPresenceRequestArray"}},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPresenceRequest"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"availability"},__type:{kind:"NamedType",name:{kind:"Name",value:"Availability"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"activity"},__type:{kind:"NamedType",name:{kind:"Name",value:"Activity"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isOutOfOffice"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"lastSeenAt"},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}},arguments:[]}]},__type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Presence"}}}}}}]}}]},p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationFireCallingIntentMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntentInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fireCallingIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingIntent"},value:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntentInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntent"}}}]}}]},v={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationUserCallingSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCallingSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isCallingAllowed"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]},{kind:"Field",name:{kind:"Name",value:"isPstnCallingAllowed"},__type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},arguments:[]}]},__type:{kind:"NamedType",name:{kind:"Name",value:"UserCallingSettings"}},arguments:[]}]}}]},y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationIsPstnQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"uri"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"officeIntegrationIsPSTN"},arguments:[{kind:"Argument",name:{kind:"Name",value:"uri"},value:{kind:"Variable",name:{kind:"Name",value:"uri"}},__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],__type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}]}}]},f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationTenantVerifiedDomainQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantVerifiedDomain"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}},__type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],__type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}]}}]};var S,k;!function(e){e[e.UnInitialized=0]="UnInitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(S||(S={})),function(e){e.FreDialogDisplayedKey="office-integration-fre-dialog-displayed",e.HasManuallyUnregisteredIMProviderKey="office-integration-has-manually-unregistered"}(k||(k={}));const b="sip:",w=new Map([["InACall","OnThePhone"],["InAConferenceCall","InAMeeting"],["InAMeeting","InAMeeting"],["Presenting","Presenting"],["OffWork","Offline"],["Available","Online"],["Inactive","Idle"],["Busy","Busy"],["DoNotDisturb","Focusing"],["BeRightBack","BeRightBack"],["Away","Away"],["Offline","Offline"],["UrgentInterruptionsOnly","Focusing"],["PresenceUnknown","Unknown"],["OutOfOffice","OutOfOffice"]]);class C{static Instance(e,t,i,n,o,r,s,a){return C.instance||(C.instance=new C(e,t,i,n,o,r,s,a)),C.instance}static defaultInstance(){return C.instance}constructor(e,t,i,n,d,u,m,g){this.hostCommunicationService=e,this.coreSettings=t,this.client=i,this.entityCommanding=d,this.windowProvider=u,this.localStorage=m,this.authenticationUser=g,this.initializedState=S.UnInitialized,this.unsubscribers=[],this.entityCommand={stateTransition:s.su.none,visibilityState:s.fe.show,correlation:{source:a.D.OfficeIntegration}},this.presenceSubscriptionMap=new Map,this.uriToMriCacheMap=new Map,this.selfMri="",this.selfActivity=c.cS.PresenceUnknown,this.debouncedUnresolvedUriMap=new Map,this.unknownUserSet=new Set,this.verifiedDomains=[],this.getUserCallingSettingsAsync=()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{data:e}=yield this.client.query({query:v,variables:{}});return e.userCallingSettings})),this.getIsPstnAsync=e=>(0,o.__awaiter)(this,void 0,void 0,(function*(){const{data:t}=yield this.client.query({query:y,variables:{uri:e}});return t.officeIntegrationIsPSTN})),this.logger=n.newLogger("OfficeIntegration","services-io-data-office-integration");const h=this.coreSettings.get(l.J.People).debounceUriToMriProfileQueryInMilliSeconds||1e3;this.batchProfileQuery=(0,r.debounce)((()=>(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!(0,r.isEmpty)(this.debouncedUnresolvedUriMap)){const e=this.debouncedUnresolvedUriMap;this.debouncedUnresolvedUriMap=new Map,yield this.resolveUrisToMrisFromServiceIntoCache(Array.from(e.values()));const t=Array.from(e.keys()),i=this.resolveUrisToMrisFromCache(t),n=t.filter((e=>i.has(e)));(0,r.isEmpty)(n)||this.handleTrackPresence(n)}}))),h);const p=this.coreSettings.get(l.J.Presence).officeIntegrationPresenceSubscriptionExpiryMs||18e4;this.removeStaleSubscriptions=(0,r.debounce)((()=>{const e=Date.now(),t=this.presenceSubscriptionMap.size;this.presenceSubscriptionMap.forEach(((t,i)=>{t.lastPollingTime+p<e&&(t.presenceSubscription.unsubscribe(),this.presenceSubscriptionMap.delete(i))})),this.logger.log(`removeStaleSubscriptions size from ${t} to ${this.presenceSubscriptionMap.size}`)}),p)}initialize(){var e,t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.coreSettings.get(l.J.People).enableOfficeIntegration)return!1;if(this.initializedState!==S.UnInitialized)return!1;this.initializedState=S.Initializing;const i=yield this.getModule();if(i){const{isRegistered:o,isAdminAccessRequired:r,isUacEnabled:s}=(yield null===(e=i.isRegisteredIMProvider)||void 0===e?void 0:e.call(i))||{};if(this.logger.log(`initialize isRegistered ${o} isAdminAccessRequired ${r} isUacEnabled ${s}`),o)return this.startService(i);if(r&&s)this.startOfficeIntegrationFREDialog();else if(r||this.isLocalStoragePropertySet(k.HasManuallyUnregisteredIMProviderKey)){const e=`Failed to register due to isAdminAccessRequired ${r} isUacEnabled \n          ${s} HasManuallyUnregisteredIMProviderKey ${this.isLocalStoragePropertySet(k.HasManuallyUnregisteredIMProviderKey)}`;this.handleLogToTelemetry(e,"office_integration_register_im_provider",n.Warning)}else{const e=yield null===(t=i.registerIMProvider)||void 0===t?void 0:t.call(i,!1,!!s);if(0===e)return this.startService(i);{const t=`Failed to register during silent registration with result ${e}`;this.handleLogToTelemetry(t,"office_integration_register_im_provider",n.Warning,{errorCode:null==e?void 0:e.toString(16)})}}return!1}return!1}))}finalize(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(!this.coreSettings.get(l.J.People).enableOfficeIntegration)return!1;if(this.initializedState!==S.Initializing)return!1;const t=yield this.getModule();if(t){const{isRegistered:i}=(yield null===(e=t.isRegisteredIMProvider)||void 0===e?void 0:e.call(t))||{};if(i)return this.startService(t);const o="finalize is called without IM provider registered";return this.handleLogToTelemetry(o,"office_integration_fre_register_finalize_failed",n.Warning),!1}return!1}))}shutdown(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.initializedState!==S.Initialized)return!1;this.initializedState=S.UnInitialized,this.unsubscribers.forEach((e=>e()));const t=yield this.getModule();if(t){return!!(null===(e=t.stopComServer)||void 0===e?void 0:e.call(t))}return!1}))}isRegisteredIMProvider(){var e;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const t=yield this.getModule();return null===(e=null==t?void 0:t.isRegisteredIMProvider)||void 0===e?void 0:e.call(t)}))}registerIMProvider(e,t,i){var r;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const o=yield this.getModule();if(o){const s=yield null===(r=o.registerIMProvider)||void 0===r?void 0:r.call(o,e,t),a=`registerIMProvider result ${s} from ${i}. isAdminAccessRequired ${e} isUacEnabled ${t}`;return this.handleLogToTelemetry(a,"office_integration_register_im_provider",n.Info,{errorCode:null==s?void 0:s.toString(16)}),0===s}return!1}))}unregisterIMProvider(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.getModule();if(i){const o=yield null===(t=i.unregisterIMProvider)||void 0===t?void 0:t.call(i),r=`unregisterIMProvider result ${o} from ${e}`;return this.handleLogToTelemetry(r,"office_integration_unregister_im_provider",n.Info,{errorCode:null==o?void 0:o.toString(16)}),0===o}return!1}))}toggleIMProvider(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{isRegistered:t,isAdminAccessRequired:i,isUacEnabled:n}=(yield this.isRegisteredIMProvider())||{};if(t){this.setLocalStorageProperty(k.HasManuallyUnregisteredIMProviderKey,"true");const t=yield this.unregisterIMProvider(e);return yield this.waitForRegistryUpdate(),t}this.setLocalStorageProperty(k.HasManuallyUnregisteredIMProviderKey,"false");if(yield this.registerIMProvider(!!i,!!n,e)){const e=yield this.getModule();return!!e&&(this.startService(e),yield this.waitForRegistryUpdate(),!0)}return!1}))}waitForRegistryUpdate(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){let e;yield new Promise((t=>{e=this.windowProvider.setTimeout(t,250)})),this.windowProvider.clearTimeout(e)}))}isLocalStoragePropertySet(e){var t;return"true"===(null===(t=this.localStorage)||void 0===t?void 0:t.get(e))}setLocalStorageProperty(e,t){var i;null===(i=this.localStorage)||void 0===i||i.set(e,t,"Platform")}getModule(){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.officeIntegrationModule||(this.officeIntegrationModule=yield this.hostCommunicationService.loadModule("officeintegration")),this.officeIntegrationModule}))}startService(e){var t,i,n,r,s,a,l,c,d,m;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(this.initializedState===S.Initialized)return!1;let o;this.initializedState=S.Initialized,o=null===(t=e.registerForStartChat)||void 0===t?void 0:t.call(e,(e=>this.handleStartChat(e))),o&&this.unsubscribers.push(o),o=null===(i=e.registerForStartCall)||void 0===i?void 0:i.call(e,((e,t,i)=>this.handleStartCall(e,t,i))),o&&this.unsubscribers.push(o),o=null===(n=e.registerForTrackPresence)||void 0===n?void 0:n.call(e,(e=>this.handleTrackPresence(e))),o&&this.unsubscribers.push(o),o=null===(r=e.registerForUntrackPresence)||void 0===r?void 0:r.call(e,(e=>this.handleUntrackPresence(e))),o&&this.unsubscribers.push(o),o=null===(s=e.registerForLogStatement)||void 0===s?void 0:s.call(e,((e,t)=>this.handleLogStatement(e,t))),o&&this.unsubscribers.push(o);const g=(null===(a=this.authenticationUser)||void 0===a?void 0:a.loginUserName)||"",{data:h}=yield this.client.query({query:u,variables:{userId:g,isMailAddress:!0},context:{callerInfo:"office-integration-start"}}),p=null==h?void 0:h.user;if(p){const e=null===(l=p.userPrincipalName)||void 0===l?void 0:l.toLowerCase(),t=null===(c=p.email)||void 0===c?void 0:c.toLowerCase();p.mri&&(this.selfMri=p.mri,e&&this.uriToMriCacheMap.set(e,p.mri),t&&t!==e&&this.uriToMriCacheMap.set(t,p.mri))}const v=yield this.client.query({query:f,variables:{userId:g}});(null===(d=v.data)||void 0===d?void 0:d.tenantVerifiedDomain)&&(this.verifiedDomains=v.data.tenantVerifiedDomain);return!!(yield null===(m=e.startComServer)||void 0===m?void 0:m.call(e,(null==p?void 0:p.userPrincipalName)||g))}))}startOfficeIntegrationFREDialog(){if(this.isLocalStoragePropertySet(k.FreDialogDisplayedKey))this.logger.log("Skipping FRE as it has already been displayed for user");else{this.entityCommanding.shell.openFreDialog(this.entityCommand),this.setLocalStorageProperty(k.FreDialogDisplayedKey,"true");const e="Start office integration FRE through user dialog registration";this.handleLogToTelemetry(e,"office_integration_fre_register_dialog",n.Info)}}notifyPresence(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=yield this.getModule();return null===(t=null==i?void 0:i.notifyPresence)||void 0===t?void 0:t.call(i,e)}))}convertLastSeenAt(e){if(e){return new Date(e).getTime()}}notifyInitialPresence(e,t){const i=[];e.presences.forEach((e=>{const n=c.cS[e.activity||c.cS.PresenceUnknown];e.id===this.selfMri&&e.activity&&(this.selfActivity=e.activity),i.push({id:e.id,requestedUri:t.get(e.id)||"",status:w.get(n)||n,lastSeenAt:this.convertLastSeenAt(e.lastSeenAt)})})),this.notifyPresence(i)}handleTrackPresence(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enableFederatedPresenceForOfficeIntegration:t}=this.coreSettings.get(l.J.People),{disableRealTimePresenceForOfficeIntegration:i,presenceForOfficeIntegrationPollingIntervalMs:n}=this.coreSettings.get(l.J.Presence);t||(0,r.isEmpty)(this.verifiedDomains)||(e=e.filter((e=>{const t=e.substring(e.indexOf("@")+1);return(0,r.some)(this.verifiedDomains,(e=>e===t.toLocaleLowerCase()))})));const o=yield this.mapUrisToMris(e,!0),s=[],a=new Map,d=n||12e4,u=Date.now();if(e.forEach((e=>{const t=o.get(e);if(t){const n=this.presenceSubscriptionMap.get(t);if(n){const o=n.lastPollingTime+d<u;n.lastPollingTime=u,(i&&o||!n.requestedUris.has(e)||t===this.selfMri&&c.cS.PresenceUnknown===this.selfActivity)&&(n.requestedUris.add(e),s.push({userId:t,source:"ups"}),a.set(t,e))}else{const n=i?"local":"ups",o=this.client.subscribe({query:g,variables:{userId:t,source:n},context:{callerInfo:"office-integration"}}).subscribe((({data:e})=>{e&&this.notifyUpdatedPresence(e)})),r={requestedUris:new Set,presenceSubscription:o,lastPollingTime:u};r.requestedUris.add(e),this.presenceSubscriptionMap.set(t,r),s.push({userId:t,source:"ups"}),a.set(t,e)}}})),i&&this.removeStaleSubscriptions(),!(0,r.isEmpty)(s)){const{data:e}=yield this.client.query({query:h,variables:{userPresenceRequestArray:s},context:{callerInfo:"office-integration"}});e&&this.notifyInitialPresence(e,a)}}))}mapUrisToMris(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=this.resolveUrisToMrisFromCache(e);if(i.size===e.length)return i;{const{enableDebounceUriToMriProfileQuery:n}=this.coreSettings.get(l.J.People),o=t&&n,s=[];return e.forEach((e=>{if(!i.has(e)){const t=e.startsWith(b)?e.substring(4):e;s.push(t),o&&this.debouncedUnresolvedUriMap.set(e,t)}})),(0,r.isEmpty)(s)?i:o?(this.batchProfileQuery(),i):(yield this.resolveUrisToMrisFromServiceIntoCache(s),this.resolveUrisToMrisFromCache(e))}}))}resolveUrisToMrisFromServiceIntoCache(e){var t;return(0,o.__awaiter)(this,void 0,void 0,(function*(){if(e=e.filter((e=>!this.unknownUserSet.has(e.toLowerCase()))),(0,r.isEmpty)(e))return;const{data:i}=yield this.client.query({query:m,variables:{mriOrEmailArray:e,isMailAddress:!0},context:{callerInfo:"office-integration-uri-resolution"}});null===(t=null==i?void 0:i.getUsers)||void 0===t||t.forEach((e=>{var t,i,n;if(e.mri&&"unknown_email_address@invalid.teams.ms"!==e.email){const o=null===(t=e.userPrincipalName)||void 0===t?void 0:t.toLowerCase(),r=null===(i=e.email)||void 0===i?void 0:i.toLowerCase(),s=null===(n=e.emailForQuery)||void 0===n?void 0:n.toLowerCase();o&&this.uriToMriCacheMap.set(o,e.mri),r&&r!==o&&this.uriToMriCacheMap.set(r,e.mri),s&&s!==o&&s!==r&&this.uriToMriCacheMap.set(s,e.mri)}else e.userPrincipalName&&this.unknownUserSet.add(e.userPrincipalName.toLowerCase())}))}))}resolveUrisToMrisFromCache(e){const t=new Map;return e.forEach((e=>{const i=e.toLowerCase(),n=i.startsWith(b)?i.substring(4):i,o=this.uriToMriCacheMap.get(n);o&&t.set(e,o)})),t}notifyUpdatedPresence(e){const t=e.presenceUpdateEvent;if(t){const e=t.id,i=this.presenceSubscriptionMap.get(e);if(i){const n=[],o=c.cS[t.activity||c.cS.PresenceUnknown],r=w.get(o)||o,s=this.convertLastSeenAt(t.lastSeenAt);i.requestedUris.forEach((t=>{n.push({id:e,requestedUri:t,status:r,lastSeenAt:s})})),e===this.selfMri&&t.activity&&(this.selfActivity=t.activity),this.notifyPresence(n)}}}handleUntrackPresence(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){(yield this.mapUrisToMris(e)).forEach(((e,t)=>{const i=this.presenceSubscriptionMap.get(e);i&&(i.requestedUris.delete(t),(0,r.isEmpty)(i.requestedUris)&&(i.presenceSubscription.unsubscribe(),this.presenceSubscriptionMap.delete(e)))}))}))}handleStartChat(e){return(0,o.__awaiter)(this,void 0,void 0,(function*(){this.logger.log("Starting chat");const t=e.split(";").filter((e=>!!e.trim())),i=yield this.mapUrisToMris(t),o=`mapped ${i.size} uris`;this.handleLogToTelemetry(o,"office_integration_handle_chat",n.Info);const s=Array.from(i.values());(0,r.isEmpty)(s)?this.handleLogToTelemetry("No mapped uris to start chat","office_integration_handle_chat",n.Warning):this.navigateToChat(s)}))}navigateToChat(e,t=s.su.new){return(0,o.__awaiter)(this,void 0,void 0,(function*(){return this.entityCommanding.chat.chatWithUsers({userIds:e,entityCommand:{stateTransition:t,visibilityState:s.fe.show,correlation:{source:a.D.OfficeIntegrationChat}},entityOptions:{shouldCheckChatPolicy:!0}})}))}handleStartCall(e,t,i){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const{enableOfficeIntegrationCalling:i}=this.coreSettings.get(l.J.Calling);try{const[o,r]=yield Promise.all([this.getUserCallingSettingsAsync(),this.getIsPstnAsync(e)]);if(!i||r&&!(null==o?void 0:o.isPstnCallingAllowed)||!r&&!(null==o?void 0:o.isCallingAllowed))return void this.handleLogToTelemetry("Office integration calling or policy is disabled","office_integration_handle_call",n.Warning,{context:JSON.stringify({enableOfficeIntegrationCalling:i,isPSTN:r,isVideo:t,isCallingAllowed:null==o?void 0:o.isCallingAllowed,isPstnCallingAllowed:null==o?void 0:o.isPstnCallingAllowed})});this.handleLogToTelemetry("Starting call","office_integration_handle_call",n.Info,{context:JSON.stringify({enableOfficeIntegrationCalling:i,isPSTN:r,isVideo:t})});const s=r?this.getPstnCallingIntent(e):yield this.getVoipCallingIntentAndNavigateChat(e,t);yield this.client.mutate({mutation:p,variables:{callingIntent:s}}),this.handleLogToTelemetry("Successfully triggered call","office_integration_handle_call",n.Info,{context:JSON.stringify({enableOfficeIntegrationCalling:i,isVideo:t})})}catch(e){this.handleLogToTelemetry("Failed to start call","office_integration_handle_call",n.Error,{context:JSON.stringify({enableOfficeIntegrationCalling:i,isVideo:t}),errors:(null==e?void 0:e.message)||e})}}))}getPstnCallingIntent(e){return{type:"OneToOneCall",joinOptions:{},coordinates:{oneToOne:{mri:(0,d.DI)(e)}}}}getVoipCallingIntentAndNavigateChat(e,t){return(0,o.__awaiter)(this,void 0,void 0,(function*(){const i=(yield this.mapUrisToMris([e])).get(e);if(!i)throw new Error("No mapped uri to start call");return yield this.navigateToChat([i],s.su.flush),{type:"OneToOneCall",coordinates:{oneToOne:{mri:i}},joinOptions:{outgoingVideo:t}}}))}handleLogStatement(e,t){switch(t){case n.Info:this.logger.log(e);break;case n.Debug:this.logger.debug(e);break;case n.Error:this.logger.error(e);break;case n.Warning:this.logger.warn(e)}}handleLogToTelemetry(e,t,i,o,r=!0){switch(i){case n.Info:this.logger.infoToTelemetry?this.logger.infoToTelemetry(e,t,o,r):this.logger.log(e);break;case n.Debug:this.logger.debugToTelemetry?this.logger.debugToTelemetry(e,t,o,r):this.logger.debug(e);break;case n.Error:this.logger.errorToTelemetry?this.logger.errorToTelemetry(e,t,o,r):this.logger.error(e);break;case n.Warning:this.logger.warnToTelemetry?this.logger.warnToTelemetry(e,t,o,r):this.logger.warn(e)}}}},80033:(e,t,i)=>{"use strict";i.d(t,{D:()=>f,W:()=>S});var n=i(740597),o=i(74583),r=i(234207),s=i(50805),a=i(738646),l=i(199033),c=i(760005),d=i(905581),u=i(132756),m=i(834347),g=i(181620),h=i(34564),p=i(516909),v=i(55417);const y=["teams","/l/message/","chat"],f=(e,t)=>{if(!(null==t?void 0:t.enableDomainLinks))return y.every((t=>e.includes(t)));try{const i=new URL(e),n=t.currentDomainLinks;return!!n&&n.some((e=>{const t=new URL(e);return i.hostname===t.hostname}))}catch(e){return!0}};class S{constructor(e,t,i,n){this.botsPlatformService=t,this.scenarioFactory=i,this.queryLinkRequestsInProgress={},this.enableAppBasedLinkSsoAuth=e.get(s.J.Extensibility).enableAppBasedLinkSsoAuth,this.tokenPrefetchBots=e.get(s.J.Extensibility).tokenPrefetchBots,this.ssoForBotsDefaultWebResourceEnabledBotIds=e.get(s.J.Extensibility).ssoForBotsDefaultWebResourceEnabledBotIds,this.enableAnonymousAppBasedLink=e.get(s.J.Extensibility).enableAnonymousAppBasedLink,this.anonymousAppBasedLinkApps=e.get(s.J.Extensibility).anonymousAppBasedLinkApps,this.enablePreAuthCard=e.get(s.J.Extensibility).enablePreAuthCard,this.logger=n.newLogger("AppBasedLinkService","services-io-app-based-link"),this.enableGetRichLinkToTeamOrChannel=e.get(s.J.TeamsAndChannels).enableGetRichLinkToTeamOrChannel,this.deepLinkDomains=e.get(s.J.Messaging).deepLinkDomains}getUrlPreviewFromApp(e,t,i,r,s){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n="",a=!1;const l={enableDomainLinks:this.enableGetRichLinkToTeamOrChannel,currentDomainLinks:this.deepLinkDomains};if(v.o===s||f(e,l))return void this.logger.debug(`LinkUnfurling: getUrlPreviewFromApp: url is a chat url and no link preview is needed for url: ${e}`);let c=t&&(0,m.A4)(e,t);if(!c&&this.enableAnonymousAppBasedLink){const t=i()||[];(0,o.isEmpty)(t)&&(n="no app defs");const r=(0,m.A4)(e,t.map((e=>({installationState:p.JM.NotInstalled,installedScope:p.qi.Personal,id:e.id,definition:e}))));(null==r?void 0:r.definition)&&(0,m.C4)((0,m.dX)(r.definition),this.enableAnonymousAppBasedLink,this.anonymousAppBasedLinkApps)&&(c=r,a=!0)}const d=(null==c?void 0:c.definition)&&(0,m.dX)(c.definition);if(!d)return(0,o.isEmpty)(t)&&!n&&(n="no installed apps"),void r.incomplete({errors:n});let u;if(a?(u=yield this.getAnonymousAppPreview(e,d,s),this.logger.debug(`LinkUnfurling: Fetching anonymous app preview for url: ${e}`)):(u=yield this.getAppPreview(e,d,s),this.logger.debug(`LinkUnfurling: Fetching app preview for url: ${e}`)),"HasResult"!==(null==u?void 0:u.type)||!u.messageExtensionItem)return void this.logger.debug(`LinkUnfurling: No app preview found for url: ${e}`);const{previewCard:g}=u.messageExtensionItem;return g?(0,h.j)(e,g):void 0}))}getAnonymousAppPreview(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const n=this.getQueryLinkVariables(e,t,i);if(!n)throw(0,d.Tr)("AppBasedLinkService",u.jK.InvalidInput,"getAnonymousAppPreview",void 0,this.getErrorMessage("Invalid message extension passed to invoke",t));this.queryLinkRequestsInProgress[e]||(this.queryLinkRequestsInProgress[e]=this.queryLink(n,t.id,a.RG.ExtGetAnonymousAppPreview,void 0,"composeExtension/anonymousQueryLink"));const o=yield this.queryLinkRequestsInProgress[e];return delete this.queryLinkRequestsInProgress[e],!o||this.isEmptyResult(o)?null:this.matchedAnonymousResult(e,t,o)}catch(t){throw delete this.queryLinkRequestsInProgress[e],t}}))}getAppPreview(e,t,i,o,r){return(0,n.__awaiter)(this,void 0,void 0,(function*(){try{const n=yield this.tryPrefetchingToken(t,r,this.logger),s={},a=null!=r?r:n,l=!!a,c=yield this.getMessageExtensionResult(e,t,i,o,a,s);return delete this.queryLinkRequestsInProgress[e],!c||this.isEmptyResult(c)?null:this.matchedResult(e,t,c,l,i,o,s)}catch(t){throw delete this.queryLinkRequestsInProgress[e],t}}))}matchedAnonymousResult(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){switch(i.type){case"result":return this.logger.debug(`LinkUnfurling: Initiating result type response for url: ${e}`),this.handleResultResponse(e,i,t);case"auth":return this.logger.debug(`LinkUnfurling: Initiating anonymous auth for url: ${e}`),this.handleAnonymousAuthConfigResponse(e,i,t);default:return this.logger.error(this.getErrorMessage(`LinkUnfurling: Invalid value ${i.type} for field 'type' in invoke response`,t)),null}}))}matchedResult(e,t,i,o,r,s,a){return(0,n.__awaiter)(this,void 0,void 0,(function*(){switch(i.type){case"result":return this.logger.debug(`LinkUnfurling: Initiating result type response for url: ${e}`),this.handleResultResponse(e,i,t);case"auth":case"config":return"config"===i.type?this.logger.debug(`LinkUnfurling: Initiating config type response for url: ${e}`):this.logger.debug(`LinkUnfurling: Initiating auth type response for url: ${e}`),this.handleAuthConfigResponse(e,i,t);case"silentAuth":if(o)return this.logger.error(this.getErrorMessage(`LinkUnfurling: Result type ${i.type} not allowed for duplicate request`,t)),null;if(this.enableAppBasedLinkSsoAuth){if(null==a?void 0:a.consentOverride)return this.handleSsoAuthResponse({isFailure:!1,isConsentRequired:!0,token:void 0},i,e,t,r,s);const n=yield this.tryGetAuthToken(t);return this.handleSsoAuthResponse(n,i,e,t,r,s)}default:return this.logger.error(this.getErrorMessage(`Invalid value ${i.type} for field 'type' in invoke response`,t)),null}}))}isEmptyResult(e){const t=Object.keys(e);return 1===t.length&&"__typename"===t[0]}handleSsoAuthResponse(e,t,i,o,r,s){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{isFailure:n,isConsentRequired:a,token:l}=e;if(n)return null;if(l&&!a){return yield this.getAppPreview(i,o,r,s,{token:l})}return this.handleAuthConfigResponse(i,t,o)}))}getWebApplicationInfo(e){var t;const i=e.messageExtensions&&e.messageExtensions[0].botId;return i&&this.ssoForBotsDefaultWebResourceEnabledBotIds&&(null===(t=this.ssoForBotsDefaultWebResourceEnabledBotIds)||void 0===t?void 0:t.indexOf(i))>=0?{botId:i,resource:`api://botid-${i}`}:{botId:i,resource:e.resource}}tryPrefetchingToken(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{botId:n,resource:o}=this.getWebApplicationInfo(e);if(t||!this.enableAppBasedLinkSsoAuth||!n||!o||!this.tokenPrefetchBots||-1===this.tokenPrefetchBots.indexOf(n))return null;const r=this.scenarioFactory.newScenario(a.RG.AppBasedLinkAadAuth);r.appendEventData({"Bot.Id":n,context:"tokenPrefetch"});try{const e=yield this.botsPlatformService.getAuthTokenForBot(n,o,!0,i);return r.stop(),{token:e}}catch(e){r.incomplete({errors:"tryPrefetchingToken: Token failed to acquire"})}return null}))}tryGetAuthToken(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{botId:t,resource:i}=this.getWebApplicationInfo(e);if(!t||!i)return{isFailure:!0,isConsentRequired:!1,token:void 0};const n=this.scenarioFactory.newScenario(a.RG.AppBasedLinkAadAuth);n.appendEventData({"Bot.Id":t,context:"silent:true"});try{const e=yield this.botsPlatformService.getAuthTokenForBot(t,i,!0,this.logger);return n.stop(),{isFailure:!1,isConsentRequired:!1,token:e}}catch(e){return e.code===u.jK.UserConsentRequired?(n.incomplete(),{isFailure:!1,isConsentRequired:!0,token:void 0}):e.code===u.jK.InvalidInput?(n.stop(),{isFailure:!0,isConsentRequired:!1,token:void 0}):(n.fail({errorCode:e.code}),{isFailure:!0,isConsentRequired:!1,token:void 0})}}))}getMessageExtensionResult(e,t,i,o,r,s){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=this.getQueryLinkVariables(e,t,i,o,r);return n?(this.queryLinkRequestsInProgress[e]||(this.queryLinkRequestsInProgress[e]=this.queryLink(n,t.id,a.RG.GetAppPreviewResult,s)),this.queryLinkRequestsInProgress[e]):(this.logger.error(this.getErrorMessage("Invalid message extension passed to invoke",t)),Promise.resolve(null))}))}queryLink(e,t,i,n,o){var s;const a=(0,r.v4)(),c=this.scenarioFactory.newScenario(i);return c.appendEventData({"Bot.Id":e.botInvokeParams.botMri,"App.Id":t,"Thread.Id":null!==(s=e.botInvokeParams.threadId)&&void 0!==s?s:"",correlationId:a}),this.botsPlatformService.executeBotInvoke(e.botInvokeParams,e.invokeValue,l.CB,this.logger,a,o||"composeExtension/queryLink",void 0,void 0,c).then((e=>(c.stop(),e))).catch((t=>{if(this.logger.warn(`Invoke failed with error: ${t} and args: ${JSON.stringify(e)}`),this.handleInvokeFailure(c,t,n),null==n?void 0:n.consentOverride)return{type:"silentAuth"};throw t}))}handleInvokeFailure(e,t,i){if(t)if((e=>!!e&&!!(0,o.get)(e,"code")&&!!(0,o.get)(e,"message"))(t))switch(t.code){case u.jK.BotError:case u.jK.BotDisabledByAdmin:e.stop({errorCode:t.code,errors:JSON.stringify([t.message])});break;case u.jK.UserConsentRequired:e.incomplete({errorCode:t.code,errors:JSON.stringify([t.message])}),i&&(i.consentOverride=!0);break;default:e.fail({errorCode:t.code,errors:JSON.stringify([t.message])})}else e.fail({errorCode:u.jK.Unknown});else e.fail()}handleResultResponse(e,t,i){const n=(0,o.first)(t.items),s=null==n?void 0:n.card,{defaultPreviewType:a,cachePolicyType:l}=this.processSuggestedActions(t.suggestedActions);if(s){const t=(0,r.v4)().replace(new RegExp("-","g"),""),c=(0,o.cloneDeep)(s),d=(null==n?void 0:n.previewCard)||this.isSupportedPreviewCardType(c)&&c;return d?Object.assign(Object.assign({__typename:"AppPreviewResult",id:e,type:"HasResult",messageExtensionItem:{__typename:"MessageExtensionItem",previewCard:d,card:{__typename:"Card",contentType:s.contentType,content:s.content,cardClientId:t,appId:i.id,appName:i.name,appIcon:i.largeImageUrl}}},a&&{defaultPreviewType:a}),l&&{cachePolicyType:l}):(this.logger.error(this.getErrorMessage(`Could not use card with content type: ${s.contentType} as a preview card`,i)),null)}return null}handleAnonymousAuthConfigResponse(e,t,i){var n,o,r;let s;return this.enablePreAuthCard&&(null===(n=t.items)||void 0===n?void 0:n.length)&&(s=null===(o=t.items[0])||void 0===o?void 0:o.card),(null===(r=t.suggestedActions)||void 0===r?void 0:r.actions)&&this.logger.warn("Suggested actions are not supported for anonymous query link invoke!"),{__typename:"AppPreviewResult",id:e,type:"MatchButNeedAuthOrConfig",permissionDetails:{__typename:"AppBasedLinkPermissionDetails",id:i.id,card:s,isAnonymous:!0}}}handleAuthConfigResponse(e,t,i){var n,r,s,a;const l=null===(r=null===(n=t.suggestedActions)||void 0===n?void 0:n.actions)||void 0===r?void 0:r[0];let c;if(this.enablePreAuthCard&&(null===(s=t.items)||void 0===s?void 0:s.length)&&(c=null===(a=t.items[0])||void 0===a?void 0:a.card),l&&i.validDomains&&(0,g.Fd)(l.value,(0,o.compact)(i.validDomains)))return{__typename:"AppPreviewResult",id:e,type:"MatchButNeedAuthOrConfig",permissionDetails:{__typename:"AppBasedLinkPermissionDetails",id:i.id,card:c,openUrlResult:{__typename:"AppBasedLinkOpenUrlResult",title:l.title,url:l.value,isAuth:"auth"===t.type||"silentAuth"===t.type}}};const{resource:d}=this.getWebApplicationInfo(i);return"silentAuth"===t.type&&!l&&d?{__typename:"AppPreviewResult",id:e,type:"MatchButNeedAuthOrConfig",permissionDetails:{__typename:"AppBasedLinkPermissionDetails",id:i.id,aadAuthResult:{__typename:"AppBasedLinkAadAuthResult",resource:d}}}:(this.logger.error(this.getErrorMessage("Invalid auth/config result from bot",i)),null)}isSupportedPreviewCardType(e){const t=e.contentType.toLowerCase();return"application/vnd.microsoft.card.hero"===t||"application/vnd.microsoft.card.thumbnail"===t}getQueryLinkVariables(e,t,i,n,o){var r,s;const a=null===(r=t.messageExtensions)||void 0===r?void 0:r[0];if(a){return{botInvokeParams:{threadId:null!=i?i:"",botMri:`${c.at.BotPrefix}${null!==(s=a.botId)&&void 0!==s?s:""}`},invokeValue:JSON.stringify(Object.assign(Object.assign({url:e},n&&{state:n}),o&&{authentication:o}))}}}getErrorMessage(e,t){return`${e} for app id: ${t.id}`}processSuggestedActions(e){var t;let i,n;return e?(null===(t=e.actions)||void 0===t||t.forEach((e=>{switch(e.type){case"setDefaultUrlPreviewType":i=this.getPreviewType(e.value),i||this.logger.error(`Invalid invoke response: invalid setDefaultUrlPreviewType ${e.value}`);break;case"setCachePolicy":try{const t=JSON.parse(e.value);n=this.getCachePolicy(t.type)}catch(t){this.logger.error(`Invalid invoke response: setCachePolicy requires stringified JSON payload, but got ${e.value}`);break}n||this.logger.error("Invalid invoke response: invalid cache policy type");break;default:this.logger.error(`Invalid invoke response: unsupported suggestedAction type: ${e.type}`)}})),{defaultPreviewType:i,cachePolicyType:n}):{defaultPreviewType:i,cachePolicyType:n}}getPreviewType(e){switch(e){case"Thumbnail":return"Thumbnail";case"Card":return"Card";default:return}}getCachePolicy(e){if("no-cache"===e)return"NoCache"}}},55417:(e,t,i)=>{"use strict";i.d(t,{o:()=>n});const n="48:notes"},941992:(e,t,i)=>{"use strict";i.d(t,{pF:()=>n,I0:()=>o,jI:()=>r,xb:()=>s,yv:()=>m,Pn:()=>h,Vx:()=>p,Gl:()=>v,XD:()=>y,JV:()=>f,KI:()=>C});var n,o,r,s,a=i(740597),l=i(905581),c=i(132756);!function(e){e[e.Unknown=1]="Unknown",e[e.InvalidContinueResponse=2]="InvalidContinueResponse",e[e.InvalidMessageResponse=3]="InvalidMessageResponse",e[e.BothCardAndUrl=4]="BothCardAndUrl",e[e.MissingCardAndUrl=5]="MissingCardAndUrl",e[e.InvalidAdaptiveCard=6]="InvalidAdaptiveCard",e[e.InvalidUrl=7]="InvalidUrl"}(n||(n={})),function(e){e[e.InvalidInvokeResponseType=1]="InvalidInvokeResponseType"}(o||(o={})),function(e){e[e.InvalidInvokeResponseType=1]="InvalidInvokeResponseType"}(r||(r={})),function(e){e[e.Unknown=1]="Unknown",e[e.InvalidContinueResponse=2]="InvalidContinueResponse",e[e.InvalidAdaptiveCards=3]="InvalidAdaptiveCards",e[e.InvalidSubmitTaskResponse=4]="InvalidSubmitTaskResponse"}(s||(s={}));const d="BotsPlatformResolvers",u="retry-after",m=e=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const t=yield S(e),i=k(t.errorCode),n=b(t);return i?(0,l.Tr)(d,c.jK.BotError,"executeBotInvoke",void 0,n,void 0):g(e,n)})),g=(e,t)=>412===e.status?(0,l.Tr)(d,c.jK.UserConsentRequired,"executeBotInvoke",void 0,t,void 0):429===e.status?(0,l.Tr)(d,c.jK.Throttled,"executeBotInvoke",void 0,t,{status:e.status,headers:{[u]:e.headers[u]},body:{},url:""}):403===e.status&&t.toLowerCase().includes("BotDisabledByAdmin".toLowerCase())?(0,l.Tr)(d,c.jK.Forbidden,"executeBotInvoke",void 0,t,void 0):(0,l.Tr)(d,c.jK.RemoteOperationFailed,"executeBotInvoke",void 0,t,void 0),h=e=>{const t=e&&n[e]||void 0;return(0,l.Tr)(d,c.jK.InvalidResponse,"executeTaskModuleInvoke",void 0,t,void 0)},p=e=>{const t=e&&s[e]||void 0;return(0,l.Tr)(d,c.jK.InvalidResponse,"executeAdaptiveCardTabInvoke",void 0,t,void 0)},v=()=>(0,l.Tr)(d,c.jK.Unauthorized,"getCurrentUserName",void 0,void 0,void 0),y=e=>{const t=e&&r[e]||void 0;return(0,l.Tr)(d,c.jK.InvalidResponse,"executeMessageExtensionInvoke",void 0,t,void 0)},f=e=>{const t=e&&o[e]||void 0;return(0,l.Tr)(d,c.jK.InvalidResponse,"executeBotConfigInvoke",void 0,t,void 0)},S=e=>(0,a.__awaiter)(void 0,void 0,void 0,(function*(){const t=yield e.body.text();return t&&t.length>0?JSON.parse(t):{}})),k=e=>null!=e&&(1008===e||209===e),b=e=>`Error code: ${e.errorCode} message: ${w(e.message)}`,w=e=>{const t=e&&e.match(/<[^>]*>/g);return t&&t.length>0?t[0]:""},C=(e,t)=>{const i="^((https|api):/(/.+)?/botid-{botId})".replace("{botId}",t);return new RegExp(i,"i").test(e)}},297765:(e,t,i)=>{"use strict";i.d(t,{j:()=>s});var n=i(697337),o=i(771256),r=i(738646);const s=(e,t)=>{const i=(0,o.NI)(e),n=e.body;n&&i&&a(n,i,t)},a=(e,t,i)=>{const n=null==i?void 0:i.newScenario(r.RG.ExtCardMentionsInvoke),o={hasMentions:!1};e.forEach((e=>l(e,t,o))),n&&(o.hasMentions?n.mark(r.ck.ExtCardMentionsInvokeComplete):n.mark(r.ck.ExtCardMentionsInvokeMissing),n.stop())},l=(e,t,i)=>{(0,o.gU)(e,{type:"TextBlock"},(e=>{c(t,i)(e)})),(0,o.gU)(e,{type:"FactSet"},(e=>{d(t,i)(e)}))},c=(e,t)=>i=>{e.forEach(((e,n)=>{i.text=u(i.text,n,e,t)}))},d=(e,t)=>i=>{i.facts.forEach((i=>{e.forEach(((e,n)=>{i.title=u(i.title,n,e,t),i.value=u(i.value,n,e,t)}))}))},u=(e,t,i,o)=>{const{mentionsText:r,isMentionsApplied:s}=m(e,t,i,n.T.mention);return o.hasMentions=o.hasMentions||s,r},m=(e,t,i,n)=>{let o=!1;if(-1!==e.indexOf(t)){const r=`<span contenteditable="false" itemscope="" itemtype="${n}" itemid="${i.itemId}">${h(g(t))}</span>`;e=e.replace(new RegExp(t,"g"),r),o=!0}return{mentionsText:e,isMentionsApplied:o}},g=e=>e.substring(4,e.length-5),h=e=>e?e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;"):""},199033:(e,t,i)=>{"use strict";i.d(t,{CB:()=>l,G8:()=>c,$Z:()=>d});var n=i(74583),o=i(461270),r=i(941992),s=i(297765),a=i(690250);const l=(e,t)=>{const i={__typename:"MessageExtensionResult"},n=null==e?void 0:e.composeExtension;if(!n)return i;const o=n.type,r=n.text,l=n.attachments,c=n.suggestedActions;if(!l){const e=u(n.activityPreview);return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},i),o&&{type:o}),r&&{text:r}),c&&{suggestedActions:c}),e&&{activityPreview:e})}const d=n.attachmentLayout;l.forEach((e=>{e.contentType.toLowerCase()===a.s.Adaptive&&(0,s.j)(e.content,t)}));const m=Object.assign(Object.assign(Object.assign(Object.assign({items:Array.from(l,(e=>({card:{content:JSON.stringify(e.content),contentType:e.contentType},previewCard:e.preview?{content:JSON.stringify(e.preview.content),contentType:e.preview.contentType}:void 0})))},o&&{type:o}),d&&{attachmentLayout:d}),c&&{suggestedActions:c}),r&&{text:r});return Object.assign(Object.assign({},i),m)},c=e=>{if((0,n.isEmpty)(e))return(0,o.VF)(e);switch(e.responseType){case"composeExtension":return l(e);case"task":return(0,o.VF)(e);default:throw(0,r.XD)(r.jI.InvalidInvokeResponseType)}},d=e=>{if(!Array.isArray(e))return;const t=e.map((e=>{const t=(0,n.first)(null==e?void 0:e.attachments);return{type:null==e?void 0:e.type,attachments:t&&[{contentType:t.contentType,content:t.content&&JSON.parse(t.content)}]}})).filter((e=>!!e.attachments));return(0,n.isEmpty)(t)?void 0:t},u=e=>{if(!Array.isArray(e))return;const t=e.map((e=>{const t=(0,n.first)(null==e?void 0:e.attachments);return{type:null==e?void 0:e.type,attachments:t&&[{contentType:t.contentType,content:t.content&&JSON.stringify(t.content)}]}})).filter((e=>!!e.attachments));return(0,n.isEmpty)(t)?void 0:t}},461270:(e,t,i)=>{"use strict";i.d(t,{VF:()=>r,ef:()=>s,Ic:()=>u});var n=i(74583),o=i(941992);const r=e=>{if((0,n.isEmpty)(e))return u();if(a(e))return c(e.task);if(l(e))return d(e.task);throw(0,o.Pn)(o.pF.Unknown)},s=e=>{const t=e.value,i=(0,n.get)(t,"url"),r=(0,n.get)(t,"card");let s;if(!r&&!i)throw(0,o.Pn)(o.pF.MissingCardAndUrl);if(r&&i)throw(0,o.Pn)(o.pF.BothCardAndUrl);if(r)s=g(e);else if(!(0,n.isString)(i))throw(0,o.Pn)(o.pF.InvalidUrl);const{title:a,fallbackUrl:l,completionBotId:c,height:d,width:u}=t;return{title:a,fallbackUrl:l,completionBotId:c,url:i,card:s,height:m(d),width:m(u)}},a=e=>e.task&&"continue"===e.task.type&&(0,n.isObject)(e.task.value),l=e=>e.task&&"message"===e.task.type&&(0,n.isString)(e.task.value),c=e=>{const t=s(e);return{__typename:"TaskModuleTaskContinue",type:e.type,value:t}},d=({type:e,value:t})=>({__typename:"TaskModuleTaskMessage",type:e,value:t}),u=()=>({__typename:"TaskModuleTaskDone",text:"Done"}),m=e=>{if((0,n.isString)(e)){return{__typename:"DimensionInString",value:e}}if((0,n.isNumber)(e)){return{__typename:"DimensionInFloat",value:e}}return null},g=e=>{const t=e.value.card;try{if(t&&h(t)){const{content:e={},contentType:i}=t;return{__typename:"Card",contentType:i,content:JSON.stringify(e)}}throw(0,o.Pn)(o.pF.InvalidAdaptiveCard)}catch(e){throw(0,o.Pn)(o.pF.InvalidAdaptiveCard)}},h=e=>{const t=(0,n.get)(e,"contentType");return(0,n.isString)(t)&&t.toLowerCase()==="application/vnd.microsoft.card.adaptive".toLowerCase()}},276747:(e,t,i)=>{"use strict";i.d(t,{bD:()=>n,Rz:()=>b,kK:()=>w,c:()=>C,qT:()=>_,K8:()=>T,qg:()=>I,pd:()=>j,se:()=>N,Fh:()=>E,vJ:()=>x,jc:()=>A,Dm:()=>s,wx:()=>a,rS:()=>F,D7:()=>O,Gz:()=>M});var n,o,r,s,a,l=i(740597),c=i(234207),d=i(50805),u=i(446652),m=i(89062),g=i(738646);function h(e){const{clientId:t}=e.get(d.J.Brb);return t}function p(e){const{licenseType:t}=e.get(d.J.UserResources);return t}function v(e,t,i,o){const{adoTagsForAllItems:r,categories:s}=e.get(d.J.Brb),a=null==s?void 0:s.find((e=>(null==e?void 0:e.id)===t)),l=(null==a?void 0:a.additionalAdoTags)||"",c=i.get(n.Ring)||"unknownRing",m=function(e,t){var i,n,o;const{platformAdoTagPrefix:r,platformAdoTagSuffix:s}=e.get(d.J.Brb);let a=`${r||"teams"}_${s||t.config.browser}`;return r&&s&&(null===(i=null==t?void 0:t.config)||void 0===i?void 0:i.platformId)===u.us.Web&&(a=(null===(n=null==t?void 0:t.config)||void 0===n?void 0:n.browser)?`${a}_${null===(o=null==t?void 0:t.config)||void 0===o?void 0:o.browser}`:a),a}(e,o);return[r,l,c,m,i.get(n.MTMA)?"MTMA":""].filter((e=>e)).join(";")}function y(e,t,i){const o=`${function(e){const t=e.get(n.Build)||"";return t.startsWith("local")?"[LOCAL] ":t.indexOf("oncdn")>=0?"[CONTAINER] ":""}(i)||""}${e||""}`,{brbItemTitleMaxLength:r}=t.get(d.J.Brb);return S(o,r||1500)}function f(e,t){const{brbItemDescriptionMaxLength:i}=t.get(d.J.Brb);return S(e||"",i||5e3)}function S(e,t){return(e=e||"No text provided").length>t?`${e.substring(0,t-3)}...`:e}function k(e){let t="";const i=e.get(n.MTMA);i&&"MTMA"===i&&(t="<h3>(This is MTMA scenario, please check logs from user's other accounts under Links tab)</h3><br>");let o="";return null==e||e.forEach(((e,t)=>{o=`${o}<b>${t}:</b> ${e}<br>`})),`<h3><strong>All the logs & screenshots (if attached) are available in the devlogs link which is present in the Links tab.</strong></h3><br>${t}${o}`.trim()}function b(e,t,i){var n,r;return(0,l.__awaiter)(this,void 0,void 0,(function*(){try{const i=yield t.loadModule("toasts");if(i){const t=yield null===(n=null==i?void 0:i.getFocusAssistStateAsync)||void 0===n?void 0:n.call(i);e.set(o.FocusAssistant,t||"");const s=yield null===(r=null==i?void 0:i.getGlobalNotificationSettingsAsync)||void 0===r?void 0:r.call(i);e.set(o.GlobalNotificationSettings,(null==s?void 0:s.global)||"")}}catch(e){i.log("Failed to obtain system notification settings: ",e)}}))}function w(e,t,i,o,r){var s,a,l,c,m,g,h,p,v,y,f,S;e.set(n.UserEmail,(null===(s=null==t?void 0:t.profile)||void 0===s?void 0:s.email)||(null===(a=null==t?void 0:t.profile)||void 0===a?void 0:a.upn)||(null===(l=null==t?void 0:t.profile)||void 0===l?void 0:l.preferred_username)||""),e.set(n.UserType,(null===(c=null==t?void 0:t.type)||void 0===c?void 0:c.toString())||""),e.set(n.TenantID,(null===(m=null==t?void 0:t.profile)||void 0===m?void 0:m.tid)||""),e.set(n.Ring,(null===(h=null===(g=i.get(d.J.Metadata))||void 0===g?void 0:g.ring)||void 0===h?void 0:h.id)||""),e.set(n.UserID,(null===(v=null===(p=null==t?void 0:t.profile)||void 0===p?void 0:p.oid)||void 0===v?void 0:v.toString())||"");const k=(null===(y=i.get(d.J.Brb))||void 0===y?void 0:y.sendBrbMSAlias)?o.config.clientType===u.Bh.Maglev?null==t?void 0:t.userName:(null===(f=null==t?void 0:t.profile)||void 0===f?void 0:f.upn)||(null===(S=null==t?void 0:t.profile)||void 0===S?void 0:S.email):"";e.set(n.MSAlias,k||"");const{sessionId:b}=i.get(d.J.Platform);e.set(n.SessionId,b||""),e.set(n.Language,(null==r?void 0:r.locale)||"")}function C(e,t,i){var o;return(0,l.__awaiter)(this,void 0,void 0,(function*(){try{const i=yield t.loadModule("osutils");if(i){const t=yield null===(o=null==i?void 0:i.getDeviceInfo)||void 0===o?void 0:o.call(i);e.set(n.OsVersion,(null==t?void 0:t.osVersion)||""),e.set(n.UbrVersion,(null==t?void 0:t.ubrVersion)||""),e.set(n.DeviceID,(null==t?void 0:t.deviceId)||"unkown deviceID"),e.set(n.SystemManufacturer,(null==t?void 0:t.make)||""),e.set(n.DeviceModel,(null==t?void 0:t.model)||""),e.set(n.AppCenterInstallerId,(null==t?void 0:t.appCenterInstallerId)||"")}}catch(e){i.log("Error while obtaining BRB device informations: ",e)}}))}function _(e,t,i){var o;return(0,l.__awaiter)(this,void 0,void 0,(function*(){try{e.set(n.slimCoreVersion,(null===(o=null==t?void 0:t.SlimCore)||void 0===o?void 0:o.getVersion().toString())||"unkown slimcore version")}catch(e){i.log("Impossible fetch slimcore version: ",e)}}))}function T(e,t,i,o){var r,s,a;return(0,l.__awaiter)(this,void 0,void 0,(function*(){try{const{browser:o,browserVersion:l,clientVersion:c}=i.get(d.J.Platform);e.set(n.Browser,o||""),e.set(n.BrowserVersion,l||""),e.set(n.WebClientBuild,c||"");const{systemInfoClient:u}=i.get(d.J.Brb);e.set(n.Client,u||"");const{desktopVersion:m}=i.get(d.J.Host);e.set(n.DesktopClientVersion,m||"unknown"),e.set(n.Platform,(null===(s=null===(r=null==t?void 0:t.config)||void 0===r?void 0:r.platformId)||void 0===s?void 0:s.toString())||""),e.set(n.Os,(null===(a=null==t?void 0:t.config)||void 0===a?void 0:a.osPlatform)||"")}catch(e){o.log("Failed to obtain app information: ",e)}}))}function I(e,t,i){return(0,l.__awaiter)(this,void 0,void 0,(function*(){try{const{enableCustomNotificationsForCalls:i,enableCustomNotificationsForChats:n,enableCustomNotificationsOnDesktop:r}=t.get(d.J.Core);e.set(o.CustomNotificationOnDesktop,r?"Enabled":"Disabled"),e.set(o.CustomNotificationForCalls,i?"Enabled":"Disabled"),e.set(o.CustomNotificationForChats,n?"Enabled":"Disabled")}catch(e){i.log("Failed to obtain app information: ",e)}}))}function j(e,t,i){try{const{callingEnableUnifiedJoinFlowForPlaceCalls:i}=t.get(d.J.Calling);e.set(r.callingEnableUnifiedJoinFlowForPlaceCalls,i?"Enabled":"Disabled")}catch(e){i.log("Failed to obtain FF callingEnableUnifiedJoinFlowForPlaceCalls status: ",e)}}function N(e,t){var i;return(0,l.__awaiter)(this,void 0,void 0,(function*(){const o=yield null===(i=null==t?void 0:t.getCachedUsers)||void 0===i?void 0:i.call(t,{id:(0,c.v4)(),scenarioName:g.RG.AuthWebCachedUser,source:"brb-utils::addMTMAInfo"}),r=(null==o?void 0:o.length)&&o.length>1;e.set(n.MTMA,r?"MTMA":"")}))}function E(e,t,i,o,r){return(0,m.u4)({ReportTitle:y(e.text,t,o),ReportDescription:f(e.text,t),CategoryName:e.categoryId,UploadID:(0,c.v4)(),InitiatorIDs:[],ClientID:h(t),ClientVersion:D(o),CorelibVersion:"",Ring:o.get(n.Ring),SkypeAuthToken:i,TenantName:"",TenantID:o.get(n.TenantID),UserID:o.get(n.UserID),Email:o.get(n.UserEmail),MSAlias:o.get(n.MSAlias)||"",SkipEmailNotification:!1,SkipVsoTicketCreation:!1,SystemInfo:k(o),VsoTags:v(t,e.categoryId,o,r),LicenseType:p(t),IsAutoBrb:"true"===o.get(n.IsAutoBrb)})}function x(e,t,i){var o;const{extendBrbReportsUrl:r,clientId:s}=t.get(d.J.Brb);return{baseUrl:null!==(o=null==r?void 0:r.substring(0,r.lastIndexOf("/")))&&void 0!==o?o:"",title:e.text,clientId:null!=s?s:"",clientVersion:D(i),ring:i.get(n.Ring)}}function A(e,t,i,o,r){return(0,m.u4)({ReportTitle:y(e.text,o,r),ReportDescription:f(e.text,o),CategoryName:e.categoryId,SkypeAuthToken:t,UploadID:(0,c.v4)(),InitiatorIDs:[i],ClientID:h(o),ClientVersion:D(r),Email:r.get(n.UserEmail),TenantID:r.get(n.TenantID),UserID:r.get(n.UserID),Ring:r.get(n.Ring)})}function D(e){return e.get(n.WebClientBuild)||"1.1.11.1111_11/1.1.1.1111111111"}function F(e,t,i,n,o){let r=n;r=r?r===a.ApiFailure?a.ApiFailure:r.includes(a.TimedOut)?a.TimedOut:a.Unknown:void 0;let s=e.get(t);return s?(s.uploadStatus=i,s.byteSize=null!=o?o:s.byteSize,s.error=null!=r?r:s.error):(s={uploadStatus:i,byteSize:o,error:r},e.set(t,s)),r}function O(e){let t=!0;const i=[];for(const[n,o]of e.entries()){const e=o.byteSize?`(${o.byteSize} bytes)`:"",r=`Status: ${o.uploadStatus}`;t=o.uploadStatus===s.Success&&t;const a=`FileName: ${n} ${e}, ${r}${o.error?`, error: ${o.error}`:""}`;i.push(a)}return{content:i.join("\r\n"),allLogFilesUploaded:t,summaryFileUploaded:!1}}function M(e){const t=e.split("/"),i=t.length>1?t[t.length-1]:e;return e.includes("WebLogs/Core")?`WebLogs/Core/${i}`:e.includes("WebLogs/User")?`WebLogs/User/${i}`:i}!function(e){e.UserEmail="UserEmail",e.TenantID="TenantID",e.Ring="Ring",e.UserID="UserID",e.WebClientBuild="WebClient build",e.Build="Build",e.MTMA="MTMA",e.MSAlias="MSAlias",e.DeviceID="Device ID",e.Language="Language",e.SystemManufacturer="System Manufacturer",e.DeviceModel="Device Model",e.DesktopVersion="Desktop Version",e.slimCoreVersion="Slimcore Version",e.UbrVersion="Update Build Revision",e.Platform="Platform",e.Os="OS",e.OsVersion="OS Version",e.Browser="Browser",e.BrowserVersion="Browser Version",e.Client="Client",e.UserType="User Type",e.SessionId="Session Id",e.DesktopClientVersion="Desktop Client Version",e.AppCenterInstallerId="AppCenter Installer ID",e.IsAutoBrb="IsAutoBrb"}(n||(n={})),function(e){e.FocusAssistant="Focus Assistant",e.GlobalNotificationSettings="Global Notification Settings",e.CustomNotificationOnDesktop="Custom Notification on Desktop",e.CustomNotificationForChats="Custom Notification for Chats",e.CustomNotificationForCalls="Custom Notification for Calls"}(o||(o={})),function(e){e.callingEnableUnifiedJoinFlowForPlaceCalls="Enable Unified Join Flow For Place Calls"}(r||(r={})),function(e){e.Requested="Requested",e.Success="Success",e.Failure="Failure"}(s||(s={})),function(e){e.TimedOut="TimedOut",e.Unknown="Unknown",e.ApiFailure="ApiFailure",e.NetworkError="NetworkError"}(a||(a={}))},949300:(e,t,i)=>{"use strict";i.d(t,{w:()=>f});var n=i(740597),o=i(50805),r=i(738646),s=i(8122),a=i(974509),l=i(276747),c=i(94136);const d=e=>{const t=e.loggerFactory.newLogger("BrbServiceEndpointsManager","services-io-brb");return{baseUrl:"https://brbv2",serviceName:s.E.BRB,models:{createBrbItem:m(e,t),uploadLogsFile:g(e,t),releaseBrbItem:h(e,t),extendBrbReports:u(e,t)}}},u=(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return{allowedResponses:[a.qb.OK],constructRequest:(i,n,r,s)=>{if(!n){const e=`Skype token is not present: ${n}`;throw t.error(e),new Error(e)}const{extendBrbReportsUrl:a}=e.coreSettings.get(o.J.Brb);if(!a){const e=`Failed to retrieve extend BRB report url from core settings: ${a}`;throw t.error(e),new Error(e)}let c;try{c=(0,l.jc)(i,n,r,e.coreSettings,s)}catch(e){throw t.error("Failed to get extend BRB report request body:",e),e}const d=new URL(a);return{method:"POST",url:d.href,headers:{Host:d.hostname,"Content-Type":"application/json","Content-Length":`${c.length}`},body:c}},abortOnTimeout:!1}})),m=(e,t)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){return{allowedResponses:[a.qb.OK],constructRequest:(i,n,r)=>{if(!i){const e=`Skype token is not present: ${i}`;throw t.error(e),new Error(e)}const{createBrbRequestUrl:s}=e.coreSettings.get(o.J.Brb);if(!s){const e=`Failed to retrieve create BRB request url from core settings: ${s}`;throw t.error(e),new Error(e)}let a;try{a=(0,l.Fh)(n,e.coreSettings,i,r,e.platformService)}catch(e){throw t.error("Failed to get create BRB item request body:",e),e}const c=new URL(s);return{method:"POST",url:c.href,headers:{Host:c.hostname,"Content-Type":"application/json","Content-Length":`${a.length}`},body:a}}}})),g=(e,t)=>Promise.resolve({allowedResponses:[a.qb.CREATED],constructRequest:(i,n)=>{if(!i){const e=`Create BRB item response body is not present: ${i}`;throw t.error(e),new Error(e)}if(!n){const e=`Logs file is not present: ${n}`;throw t.error(e),new Error(e)}const{enableGzipUpload:r,minSizeToGzip:s}=e.coreSettings.get(o.J.Brb,["enableGzipUpload","minSizeToGzip"]),a=new URL(i.ContainerUrl);let l,d,u;return r&&"string"==typeof n.content&&n.content.length>(null!=s?s:2e3)?(l=(0,c.gzip)(n.content),d=l.length,u=!0):(l=n.content,d="string"==typeof n.content?n.content.length:n.content.size,u=!1),{method:"PUT",url:`${a.href}/${n.fileName}?${i.SASToken}`,headers:Object.assign({Host:a.hostname,"Content-Type":"text/plain","Content-Length":d.toString(),"x-ms-blob-type":"BlockBlob"},u?{"Content-Encoding":"gzip"}:{}),body:l}},transformResponse:()=>Promise.resolve(!0),abortOnTimeout:!1}),h=(e,t)=>Promise.resolve({allowedResponses:[a.qb.OK],constructRequest:i=>{if(!i){const e=`Container ID is not present: ${i}`;throw t.error(e),new Error(e)}const{releaseBrbRequestUrlPrefix:n}=e.coreSettings.get(o.J.Brb);if(!n){const e=`Failed to retrieve release BRB request url prefix from core settings: ${n}`;throw t.error(e),new Error(e)}const r=new URL(`${n}${i}`);return{method:"POST",url:r.href,headers:{Host:r.hostname,"Content-Length":"0"}}},transformResponse:()=>Promise.resolve(!0),abortOnTimeout:!1});var p=i(575644),v=i(838440);class y{constructor(e,t,i,n,o,r,s,a,l,c,d,u,m){this.coreSettings=t,this.logsCollectorService=i,this.authenticationService=n,this.platformService=o,this.discover=r,this.host=s,this.hostCommunicationService=a,this.brbServiceApi=l,this.i18n=c,this.activeWindowsService=d,this.authenticationUser=u,this.apolloClient=m,this.defaultUploadDesktopLogsTimeoutMs=2e4,this.logger=e.newLogger("BrbServiceTasks","services-io-brb")}getSystemInfo(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=new Map;let t;e.set("TimeStamp",(new Date).toISOString()),this.logger.debug("... starting getSystemInfo() brb");try{t=yield this.authenticationService.getUser()}catch(e){this.logger.error("Failed to fetch user:",e)}(0,l.kK)(e,t,this.coreSettings,this.platformService,this.i18n);const{enableMTMA:i}=this.coreSettings.get(o.J.Core);i&&(yield(0,l.se)(e,this.authenticationService)),yield(0,l.qT)(e,this.host,this.logger),yield(0,l.K8)(e,this.platformService,this.coreSettings,this.logger),yield(0,l.c)(e,this.hostCommunicationService,this.logger),yield(0,l.Rz)(e,this.hostCommunicationService,this.logger),yield(0,l.qg)(e,this.coreSettings,this.logger),(0,l.pd)(e,this.coreSettings,this.logger);let n=new Map;try{n=(yield this.logsCollectorService.getSystemInfo())||new Map}catch(e){this.logger.error("Failed to fetch system info from logs collector service:",e)}return new Map([...Array.from(e.entries()),...Array.from(n.entries())])}))}createBrbItem(e,t){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let i;try{const n=yield this.discover.validateSkypeToken();i=yield this.brbServiceApi.createBrbItem(n,e,t)}catch(e){return this.logger.error("Failed creating BRB item:",e),null}return i}))}extendBrbReports(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n;try{const o=yield this.discover.validateSkypeToken();n=yield this.brbServiceApi.extendBrbReports(e,o,t,i)}catch(e){return this.logger.error("Failed extending BRB report"),null}return n}))}uploadWebLogsFiles(e,t){var i;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const s=new Map,{enableMTMA:a}=this.coreSettings.get(o.J.Core),{maxBRBLogsCountInLogFile:c}=this.coreSettings.get(o.J.Diagnostics),d=i=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=i.content instanceof Blob?i.content.size:new Blob([i.content]).size,o=`File name: ${i.fileName}, size: ${n} bytes, container: ${e.ContainerID}}`;(0,l.rS)(s,i.fileName,l.Dm.Requested,void 0,n);const a=(0,l.Gz)(i.fileName);try{const c=yield this.brbServiceApi.uploadLogsFile(e,i),d=c?l.Dm.Success:l.Dm.Failure;return(0,l.rS)(s,i.fileName,d,d?void 0:l.wx.ApiFailure,n),null==t||t.mark(r.ck.UploadWebLogsFiles,{reason:o,size:n,context:a},d?"success":"failure"),c}catch(e){return this.logger.error(`Failed to upload logs file - ${i.fileName} - error:`,e),(0,l.rS)(s,i.fileName,l.Dm.Failure,e.toString(),n),null==t||t.mark(r.ck.UploadWebLogsFiles,{reason:o,size:n,context:a},"failure"),!1}}));try{a&&(null===(i=this.authenticationUser)||void 0===i?void 0:i.id)?yield this.logsCollectorService.callOnUserLogsFiles([this.authenticationUser.id],d,!1,!1,c||void 0):yield this.logsCollectorService.callOnLogsFiles(d,!1,!1,c||void 0)}catch(e){return this.logger.error("Failed when calling upload on all logs files:",e),s}return s}))}uploadDesktopLogsFiles(e,t,i){var s;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n="Desktop-Logs-and-Screenshots",a=new Map,c=yield this.hostCommunicationService.loadModule("brb");if(!c)return this.logger.log("uploadDesktopLogsFiles(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),a;let d;const{enableMTMA:u}=this.coreSettings.get(o.J.Core);if(u&&this.apolloClient&&this.activeWindowsService){const e=null===(s=this.authenticationUser)||void 0===s?void 0:s.id,i=this.activeWindowsService.enableDecoupleCommandingFromApollo?this.activeWindowsService.getActiveWindows():yield(0,v.XD)(this.apolloClient),n=[];i.forEach((t=>{t.userContextId===e&&n.push(t.id)})),d=null==t?void 0:t.filter((e=>n.includes(e)))}else d=t;if(!c.uploadDesktopLogs)return this.logger.error("uploadDesktopLogs not available on brb module."),a;const m={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature},screenshotIds:d},{uploadDesktopLogsTimeoutMs:g}=this.coreSettings.get(o.J.Brb);try{this.logger.log(`uploadDesktopLogsFiles(): upload desktop logs and screenshots with timer to container: ${e.ContainerID}`);const t=null!=g?g:this.defaultUploadDesktopLogsTimeoutMs,o=yield(0,p.E)(c.uploadDesktopLogs(m),t,`uploadDesktopLogs timed out. Ran for ${t} ms.`),s=!!(null==o?void 0:o.status);return(0,l.rS)(a,n,s?l.Dm.Success:l.Dm.Failure,s?void 0:l.wx.ApiFailure),null==i||i.mark(r.ck.UploadDesktopLogsFiles,s?void 0:{reason:`${l.wx.ApiFailure}`},s?"success":"failure"),a}catch(e){this.logger.error("Failed to upload desktop logs files. Error:",e);const t=(0,p.T)(e)?l.wx.TimedOut:l.wx.Unknown;return(0,l.rS)(a,n,l.Dm.Failure,t),null==i||i.mark(r.ck.UploadDesktopLogsFiles,{reason:t},"failure"),a}}))}uploadHeapSnapshotFiles(e,t){var i,o;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n="Heap-Snapshot",s=new Map,a=yield this.hostCommunicationService.loadModule("brb");if(!a)return this.logger.log("uploadHeapSnapshotFiles(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),s;if(!a.uploadHeapSnapshot)return this.logger.error("uploadHeapSnapshot not available on brb module."),s;const c={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature}};try{const e=yield a.uploadHeapSnapshot(c),i=!!(null==e?void 0:e.status);return(0,l.rS)(s,n,i?l.Dm.Success:l.Dm.Failure,i?void 0:l.wx.ApiFailure),null==t||t.mark(r.ck.UploadHeapSnapshotFiles,i?void 0:{reason:`${l.wx.ApiFailure}`},i?"success":"failure"),s}catch(e){this.logger.error("Failed to upload heapsnapshot files. Error:",e),null===(o=(i=this.logger).errorToTelemetry)||void 0===o||o.call(i,"Failed to upload heap snapshot file","brb");const a=(0,l.rS)(s,n,l.Dm.Failure,e.toString());return null==t||t.mark(r.ck.UploadHeapSnapshotFiles,{reason:a},"failure"),s}}))}uploadMemoryTracingFile(e,t){var i,o;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n="Memory-Tracing",s=new Map,a=yield this.hostCommunicationService.loadModule("brb");if(!a)return this.logger.log("uploadMemoryTracingFile(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),s;if(!a.uploadMemoryTracing)return this.logger.error("uploadMemoryTracing not available on brb module."),s;const c={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature}};try{const e=yield a.uploadMemoryTracing(c),i=!!(null==e?void 0:e.status);return(0,l.rS)(s,n,i?l.Dm.Success:l.Dm.Failure,i?void 0:l.wx.ApiFailure),null==t||t.mark(r.ck.UploadMemoryTracingFile,i?void 0:{reason:`${l.wx.ApiFailure}`},i?"success":"failure"),s}catch(e){this.logger.error("Failed to upload memory tracing file. Error:",e),null===(o=(i=this.logger).errorToTelemetry)||void 0===o||o.call(i,"Failed to upload memory tracing file","brb");const a=(0,l.rS)(s,n,l.Dm.Failure,e.toString());return null==t||t.mark(r.ck.UploadMemoryTracingFile,{reason:a},"failure"),s}}))}releaseBrbItem(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let t;try{t=yield this.brbServiceApi.releaseBrbItem(e)}catch(e){return this.logger.error("Failed to release the BRB item - error:",e),!1}return t}))}uploadFileUploadSummary(e,t,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=(0,l.D7)(t);try{const t=yield this.brbServiceApi.uploadLogsFile(e,{fileName:"brb-file-upload-summary.txt",content:n.content,isPiiFree:!0});return null==i||i.mark(r.ck.UploadFileUploadSummary),n.summaryFileUploaded=t,n}catch(e){const t=e.toString().includes("TimedOut")?l.wx.TimedOut:l.wx.Unknown;return null==i||i.mark(r.ck.UploadFileUploadSummary,{reason:t},"failure"),n.summaryFileUploaded=!1,n}}))}}class f{constructor(e,t,i,n,o,r,s,a,l,c,u,m,g,h){this.coreSettings=t,this.hostCommunicationService=a,this.scenarioFactory=c,this.defaultDisclaimer='NOTE: Data sent in feedback submissions will be "Support Data" under your agreement for Microsoft 365, including any information that would otherwise be considered "Customer Data" or "Personal Data". Please do not submit feedback that may include data you do not wish to provide to Microsoft as "Support Data".',this.logger=e.newLogger("BrbService","services-io-brb");const p=l.createApi(d);this.brbServiceTasks=new y(e,t,i,n,o,r,s,a,p,u,m,g,h)}registerRootToolsManager(e){try{this.rtm=e}catch(t){this.logger.error("could not get getRootToolsManager",e)}}getSystemInfo(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){let e=new Map;try{e=yield this.brbServiceTasks.getSystemInfo()}catch(e){this.logger.error("Failed to fetch system info:",e)}return Promise.resolve(e)}))}getBrbFormData(){var e,t;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{categories:i,disclaimer:n}=this.coreSettings.get(o.J.Brb),r=[];return null==i||i.forEach((e=>{e&&r.push({id:e.id,name:e.name})})),null===(t=(e=this.logger).logNoPii)||void 0===t||t.call(e,"Returning data for BRB form",r),{disclaimer:n||this.defaultDisclaimer,categories:r}}))}getBrbScreenshots(e){var t,i,o,r,s,a,l;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=yield this.hostCommunicationService.loadModule("brb");if(!n)return void(null===(i=(t=this.logger).logNoPii)||void 0===i||i.call(t,"getBrbScreenshots(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."));null===(r=(o=this.logger).logNoPii)||void 0===r||r.call(o,"Requesting screenshots from host");const c=yield null===(s=n.getScreenshotThumbnails)||void 0===s?void 0:s.call(n,{width:e.width,height:e.height||void 0});return null===(l=(a=this.logger).logNoPii)||void 0===l||l.call(a,"Returning host-provided screenshots"),null==c?void 0:c.screenshots}))}createBrbItem(e,t){var i,s;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{enableBrb:n}=this.coreSettings.get(o.J.Brb);if(!n)return void(null===(s=(i=this.logger).logNoPii)||void 0===s||s.call(i,"Create BRB item not enabled - setting:",n));const a=this.scenarioFactory.newScenario(r.RG.BrbCreateItem,{timeoutMs:36e5});a.appendEventData({isAutoBrb:t}),a.mark(r.ck.BrbSubmitted);const l=yield this.processCreateBrbRequest(e,!!t);if("error"!==l.kind)return a.stop(),{containerId:l.response.ContainerID};a.fail({reason:l.reason})}))}extendBrbReports(e,t,i){var s,a,l,c;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{enableBrb:n}=this.coreSettings.get(o.J.Brb),d=this.scenarioFactory.newScenario(r.RG.BrbExtendReports);if(d.appendEventData({isAutoBrb:i}),!n){const e="Current account is not internal ring account";return null===(a=(s=this.logger).errorNoPii)||void 0===a||a.call(s,e),d.cancel({reason:e}),!1}const u=yield this.processExtendBrbReportsRequest(e,t.containerId);return u?d.stop():d.fail(),null===(c=(l=this.logger).logNoPii)||void 0===c||c.call(l,"Finished extending brb report"),u}))}processExtendBrbReportsRequest(e,t){var i,o,r,s;return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n=new Map;try{n=yield this.brbServiceTasks.getSystemInfo()}catch(e){null===(o=(i=this.logger).errorNoPii)||void 0===o||o.call(i,"Failed to fetch system info")}let a=null;try{a=yield this.brbServiceTasks.extendBrbReports(e,t,n)}catch(e){return null===(s=(r=this.logger).errorNoPii)||void 0===s||s.call(r,"Failed to Extend BRB Reports"),!1}if(!a)return this.logger.error(`Request to Extend BRB Reports failed to receive response body: ${a}`),!1;let l=!1;try{l=yield this.uploadFilesToBrbItem(a,e.includeHeapSnapshot,e.screenshotIds?[...e.screenshotIds]:void 0),l||this.logger.error(`Failed to upload all logs files to first party container: ${t}`)}catch(e){this.logger.error(`Error when uploading all logs files to first party container: ${t}`)}return!0}))}processCreateBrbRequest(e,t){var i,r,s,a,c,d,u,m;return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n=new Map;try{n=yield this.brbServiceTasks.getSystemInfo()}catch(e){this.logger.error("Failed to fetch system info:",e)}n.set(l.bD.IsAutoBrb,t?"true":"");let g=null;try{g=yield this.brbServiceTasks.createBrbItem(e,n)}catch(e){return this.logger.error("Failed to create BRB item:",e),{kind:"error",reason:"Failed to create BRB item"}}if(!g)return this.logger.error(`Request to create BRB item failed to receive response body: ${g}`),{kind:"error",reason:"Request to create BRB item failed to receive response body"};this.triggerRemoteEvent(e.categoryId,g.ContainerID);let h=!1;try{h=yield this.uploadFilesToBrbItem(g,e.includeHeapSnapshot,e.screenshotIds?[...e.screenshotIds]:void 0)}catch(e){this.logger.error("Failed to upload all logs files:",e)}h||null===(r=(i=this.logger).errorToTelemetry)||void 0===r||r.call(i,"Failed to upload all logs files - attempting to complete BRB item","brb");const{enableBrbReleaseLogsContainer:p}=this.coreSettings.get(o.J.Brb);if(p){let e=!1;try{null===(a=(s=this.logger).logNoPii)||void 0===a||a.call(s,"Start releasing Brb item."),e=yield this.brbServiceTasks.releaseBrbItem(g.ContainerID)}catch(e){return this.logger.error("Failed to release BRB item:",e),{kind:"error",reason:"Failed to release BRB item"}}if(!e){const e="Failed to release the BRB item";return null===(d=(c=this.logger).errorNoPii)||void 0===d||d.call(c,e),{kind:"error",reason:e}}}else null===(m=(u=this.logger).logNoPii)||void 0===m||m.call(u,"Skip releasing Brb item.");return{kind:"response",response:g}}))}uploadFilesToBrbItem(e,t=!1,i){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=this.scenarioFactory.newScenario(r.RG.BrbUploadLogs),o=[];let s=new Map;t&&(s=yield this.brbServiceTasks.uploadHeapSnapshotFiles(e,n),o.push(this.brbServiceTasks.uploadMemoryTracingFile(e,n))),o.push(this.brbServiceTasks.uploadWebLogsFiles(e,n)),o.push(this.brbServiceTasks.uploadDesktopLogsFiles(e,i,n));(yield Promise.all(o)).forEach((e=>{e.forEach(((e,t)=>{s.set(t,e)}))}));const a=yield this.brbServiceTasks.uploadFileUploadSummary(e,s,n),l=a.allLogFilesUploaded&&a.summaryFileUploaded;return l?n.stop():n.fail(),l}))}isRemoteBrbCategory(e){return["1","2","3","49","50","76","11"].indexOf(e)>=0}triggerRemoteEvent(e,t,i){if(!this.rtm)return this.logger.warn("RootToolsManager undefined"),!1;const{enableRemoteBrbEvent:n}=this.coreSettings.get(o.J.Brb,["enableRemoteBrbEvent"]);if(!n||!this.isRemoteBrbCategory(e))return this.logger.warn("Did not trigger remote event"),!1;try{return this.rtm.sendBRBEvent({uploadId:t}),this.logger.log("Triggered remote event for container ",t),!0}catch(e){return this.logger.error("Failed to trigger remote event"),!1}}}},933736:(e,t,i)=>{"use strict";i.d(t,{V:()=>n,N:()=>o});const n="broadcast-updated-event",o={streamUpdateHubEvent:"streamUpdate",captionsUpdate:"captionsUpdate",subscribeToStreamUpdatesHubEvent:"subscribeToStreamUpdates",notifyStreamSwitch:"notifyStreamSwitch",transcriptionStateUpdate:"transcriptionStateUpdate"}},486390:(e,t,i)=>{"use strict";var n,o;i.d(t,{mN:()=>n,GB:()=>o,yR:()=>r,oo:()=>s,Q0:()=>a,ex:()=>l,PR:()=>c,gh:()=>d,LC:()=>u,Ky:()=>m,ji:()=>g}),function(e){e.InProgress="InProgress",e.Success="Success",e.Error="Error",e.PartialSuccess="PartialSuccess"}(n||(n={})),function(e){e.StatusEntity="Microsoft.SkypeSpaces.MiddleTier.Models.StatusEntity"}(o||(o={}));const r="x-serverrequestid",s="call_blocking_list_refreshed",a=36e5,l="https://teams.microsoft.com/";var c;!function(e){e.getBlockedContacts="getBlockedContacts",e.postBlockedContacts="postBlockedContacts"}(c||(c={}));const d="api/",u=[{id:c.getBlockedContacts,path:"mt/part/msft/beta/userSettings/blocklist"},{id:c.postBlockedContacts,path:"mt/part/msft/beta/userSettings/blocklist/manage"}],m="https://teams.live.com/";var g;!function(e){e.Add="Add",e.Remove="Remove"}(g||(g={}))},609485:(e,t,i)=>{"use strict";i.d(t,{HI:()=>n,LC:()=>o,aO:()=>r,YK:()=>s,UQ:()=>a});const n={addMembersToThread:"addMembersToThread",createThread:"createThread",deleteConversation:"deleteConversation",locationSharingQuery:"locationSharingQuery",removeMemberFromThread:"removeMemberFromThread",reportUser:"reportUser",updateThreadProperties:"updateThreadProperties"},o={addMembersToThread:"beta/groups/{threadId}/members",createThread:"beta/groups/create",deleteConversation:"beta/groups/{threadId}/deleteChat",locationSharingQuery:"https://teams.live.com/api/location/prod",removeMemberFromThread:"beta/groups/{threadId}/members/{userMri}",reportUser:"/beta/users/{userMri}/report",updateThreadProperties:"beta/groups/{threadId}/properties"},r="ConsumerGroupsService",s="{threadId}",a="{userMri}"},231194:(e,t,i)=>{"use strict";i.d(t,{jP:()=>p,O5:()=>f,Nc:()=>S});var n=i(50805),o=i(8122),r=i(299295),s=i(844729),a=i(609485),l=i(372521);const c="v1/threads/{threadId}/members",d="v1/threads",u="v1/threads/{threadId}",m="v1/threads/{threadId}/members/{userMri}",g="/v1/users/{userMri}/report",h="v1/threads/{threadId}/properties",p="https://groupssvc.fl.teams.microsoft.com/teams.readwrite";function v(e){return Promise.resolve({constructRequest:e,rejectHttpError:!0})}const y=(e,t,i)=>{const n=(0,s.h)(t,i),o=(0,r.g)(v,n);return{addMembersToThread:o((0,l.Hd)(e.groupsServiceAddToRosterEndpoint||c,e.groupsServiceThreadIdParameterToken||a.YK)),createThread:o((0,l._)(e.groupsServiceCreateGroupEndpoint||d)).withTransform(l.jI),deleteConversation:o((0,l.uz)(e.groupsServiceDeleteConversationEndpoint||u,e.groupsServiceThreadIdParameterToken||a.YK)),locationSharingQuery:o(l.Jo),removeMemberFromThread:o((0,l.Jr)(e.groupsServiceRemoveFromRosterEndpoint||m,e.groupsServiceThreadIdParameterToken||a.YK,e.groupsServiceUserMriParameterToken||a.UQ)),reportUser:o((0,l.zR)(e.reportUserEndpoint||g,e.groupsServiceUserMriParameterToken||a.UQ)).withTransform(l.Vo),updateConversationTopic:o((0,l.lh)(e.groupsServiceUpdatePropertiesEndpoint||h,e.groupsServiceThreadIdParameterToken||a.YK))}},f=e=>{const{coreSettings:t,platformService:i,authenticationResources:r,authenticationService:s,config:a}=e,l=t.get(n.J.ConsumerGroups);return{serviceName:o.E.GroupsServiceV2,baseUrlPromise:()=>e.discover.regionGtm("groupsServiceV2"),authResource:S(s,r,p),models:y(l,i,a)}},S=(e,t,i)=>n=>e.getUser().then((()=>{const o=t.composeAuthResources((t=>e.authorizeRequest(t,i)),t.skypeXTokenAuthResource);return o(n)}))},372521:(e,t,i)=>{"use strict";i.d(t,{Hd:()=>l,_:()=>c,Jr:()=>d,lh:()=>u,uz:()=>m,Jo:()=>g,zR:()=>h,jI:()=>p,Vo:()=>v});var n=i(740597),o=i(8122),r=i(863553),s=i(760005),a=i(609485);const l=(e,t)=>(i,n,r=!0)=>{const l=e.replace(t,encodeURIComponent(i)),c=r?{members:n.map((e=>({id:e.id,role:s.nL.Admin,shareHistoryTime:0})))}:{members:n.map((e=>({id:e.id,role:e.role,shareHistoryTime:0})))};return{url:l,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(c),serviceName:o.E.GroupsServiceV2,apiName:a.HI.addMembersToThread}},c=e=>(t,i,n,r)=>{const l="true"===i[s.Q5.IsStickyThread],c=""===n,d=""===r,u={members:t.map((e=>({id:e.id,role:l?s.nL.User:s.nL.Admin}))),properties:i,inviterMri:c?void 0:n,inviteLink:d?void 0:r};return{url:e,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(u),serviceName:o.E.GroupsServiceV2,apiName:a.HI.createThread}},d=(e,t,i)=>(n,r)=>({url:e.replace(t,encodeURIComponent(n)).replace(i,encodeURIComponent(r)),method:"DELETE",headers:{"content-type":"application/json"},serviceName:o.E.GroupsServiceV2,apiName:a.HI.removeMemberFromThread}),u=(e,t)=>(i,n)=>{const r={topic:n};return{url:e.replace(t,encodeURIComponent(i)),method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(r),serviceName:o.E.GroupsServiceV2,apiName:a.HI.updateThreadProperties}},m=(e,t)=>i=>({url:e.replace(t,encodeURIComponent(i)),method:"DELETE",headers:{"content-type":"application/json"},serviceName:o.E.GroupsServiceV2,apiName:a.HI.deleteConversation}),g=(e,t)=>{const i={Query:e};return{url:`${t}/graphql`,method:"POST",headers:{"content-type":"application/json;charset=utf-8"},body:JSON.stringify(i),serviceName:o.E.MiddleTier,apiName:a.HI.locationSharingQuery}},h=(e,t)=>(i,n)=>({url:e.replace(t,encodeURIComponent(i)),method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(n),serviceName:o.E.GroupsServiceV2,apiName:a.HI.reportUser});function p(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{status:t,headers:{location:i},body:n}=e;if(void 0===i)throw new Error("location undefined");return{status:t,threadId:(0,r.F)(i),responseBody:n}}))}function v(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const{body:t,status:i}=e;return{status:i,responseBody:t}}))}},232894:(e,t,i)=>{"use strict";i.d(t,{Ut:()=>n,$O:()=>r,rv:()=>s,bw:()=>a,X9:()=>l,i5:()=>c,kA:()=>d,rg:()=>u,Ms:()=>m,h:()=>g,EQ:()=>h});var n,o=i(737109);!function(e){e.feed="TeamsFeed",e.syncFeed="TeamsFeedSync"}(n||(n={}));const r={defaultSection:"TeamsFeed",defaultTimeSortedSection:"TeamsFeedTimeSorted",defaultItemsToFetch:3,defaultLoadMoreItemsCount:5,defaultItemsToCompare:3,defaultReadSignalMinDwellTime:5e3,defaultCDLLoadMoreItemsCount:5,defaultDataSyncIntervalTime:3e5,defaultDiscoverTriagingTime:3e5,defaultServerCacheRetentionTimeInHrsSinceFirstCall:72,defaultDiscoverPollingInterval:3e5,defaultMinPageSizeForLoadMoreAPI:1,optimizeHydrationConfig:{durationToAllowBackgroundHydration:864e5,defaultLastVisitedSurface:o.ai.channel,enableHydrationOnTeamsClick:!1},lastVisitedSection:"LastVisited"},s=3,a=1e3,l=6e4,c=2,d=["408","409","429","504"],u={maxRetryCount:s,maxDelayTimeMs:l,exponentialDelayFactor:c,retryableErrorCodes:d,initialDelayMs:a};var m,g,h;!function(e){e.api="api",e.indexDB="indexdb",e.cdlCache="cdlcache",e.apolloCache="apollocache",e.unknown="unknown"}(m||(m={})),function(e){e.polling="polling",e.startup="startup",e.switch="switch",e.scroll="scroll",e.removeContent="removeContent",e.retry="retry",e.newUpdatesPoll="newUpdatesPoll",e.optimizer="optimizer",e.startupSync="startupSync",e.pollingSync="pollingSync",e.teamsClick="teamsClick"}(g||(g={})),function(e){e.emptyApiResponse="EMPTY_API_RESPONSE",e.validationFailed="VALIDATION_FAILED",e.hydrationFailed="HYDRATION_FAILED"}(h||(h={}))},737109:(e,t,i)=>{"use strict";var n,o,r;i.d(t,{X:()=>n,fT:()=>o,ai:()=>r}),function(e){e.SyncEngine="syncEngine",e.UserPreferenceChanged="userPreferenceChanged",e.UnknownCallInitiator="unknownCallInitiator",e.Optimizer="optimizer",e.teamsClick="teamsClick"}(n||(n={})),function(e){e.SyncEngine="syncEngine",e.StartPollMutation="startPollMutation"}(o||(o={})),function(e){e.discover="discover",e.channel="channel"}(r||(r={}))},867328:(e,t,i)=>{"use strict";var n,o,r;i.d(t,{Hw:()=>n,F4:()=>o,cL:()=>r}),function(e){e[e.Valid=0]="Valid",e[e.Expired=1]="Expired",e[e.NoData=2]="NoData",e[e.NoCache=3]="NoCache"}(n||(n={})),function(e){e.Filters="Filters",e.None="None",e.ConsumerKey="ConsumerKey"}(o||(o={})),function(e){e.OnExpiry="OnExpiry",e.Never="Never"}(r||(r={}))},704680:(e,t,i)=>{"use strict";var n;i.d(t,{m:()=>n}),function(e){e[e.Success=0]="Success",e[e.Success_NoChanges=1]="Success_NoChanges",e[e.Abandoned_ClientVeryActive=2]="Abandoned_ClientVeryActive",e[e.Abandoned_NoNetwork=3]="Abandoned_NoNetwork",e[e.Error_TimedOut=4]="Error_TimedOut",e[e.Error_TransformFailed=5]="Error_TransformFailed",e[e.Error_BrowserError=6]="Error_BrowserError",e[e.Error_Unknown=7]="Error_Unknown",e[e.NotStarted=8]="NotStarted"}(n||(n={}))},143285:(e,t,i)=>{"use strict";var n;i.d(t,{z:()=>n}),function(e){e[e.Manual=0]="Manual",e[e.WhenExpired=1]="WhenExpired"}(n||(n={}))},881209:(e,t,i)=>{"use strict";i.d(t,{bn:()=>C,fh:()=>_,un:()=>w});var n=i(740597),o=i(223005),r=i(234207),s=i(143285),a=i(704680),l=i(867328);const c="c72ea287-ed77-4fa6-a480-3712406c367e";class d{constructor(e,t,i){this.serviceName=e,this.ecsParameters=i,this.logger=t.newLogger(`EcsClient_${this.serviceName}`,"services-io-ecs")}initializeCache(e){return(0,n.__awaiter)(this,void 0,void 0,(function*(){this.cache={storage:e.storage,partitionOptions:{strategy:e.partitionBy||l.F4.None,excludeFilters:e.excludeFiltersFromPartition||[],consumerKey:e.consumerKey},invalidate:e.invalidateCache||l.cL.Never};const{configKey:t,metadataKey:i}=this.generateCacheKeys();try{const e=yield this.cache.storage.getItem(t),n=yield this.cache.storage.getItem(i);if(e){const i=JSON.parse(e),o=n?JSON.parse(n):{requestStatus:a.m.Success};this.data=Object.assign({ecsConfiguration:i},o),this.logger.log(`Cache successfully loaded: ${t}`)}else this.logger.log(`No cached data found: ${t}`)}catch(e){this.logger.log(`Error while loading from cache '${t}', error:`,e)}}))}get(){var e;return(null===(e=this.cache)||void 0===e?void 0:e.invalidate)===l.cL.OnExpiry&&this.cacheState===l.Hw.Expired&&(this.logger.log("Cache expired, clearing cache"),this.clearCache()),this.data}get expiration(){var e,t;const i=null===(t=null===(e=this.data)||void 0===e?void 0:e.headers)||void 0===t?void 0:t.Expires;return i&&new Date(i)}get cacheState(){return void 0===this.cache?l.Hw.NoCache:this.data?this.expiration&&this.expiration.valueOf()>Date.now()?l.Hw.Valid:l.Hw.Expired:l.Hw.NoData}getDiagnosticInfo(){return{ecsParameters:this.ecsParameters,expirationTime:this.expiration}}generateCacheKeys(){if(void 0===this.cache)throw new Error("Cannot generate keys until after initializeCache() is called");const{strategy:e,excludeFilters:t,consumerKey:i}=this.cache.partitionOptions;let n=`ecs.cache.${this.serviceName}`;switch(e){case l.F4.ConsumerKey:if(!i)throw new Error("Cannot generate key using PartitionStrategy.ConsumerKey if consumerKey is not provided");n=`${i}`;break;case l.F4.Filters:{if(!this.ecsParameters)throw new Error("Cannot generate key using PartitionStrategy.Filters if ecsParameters is not set during instantiation");const e=this.ecsParameters.filters||{};t.length&&t.forEach((t=>{e[t]&&delete e[t]}));const i=Object.values(e).filter((e=>void 0!==e||null!==e));i.length&&(n+=`.${i.join(".")}`);break}case l.F4.None:}const o=`${n}.metadata`;return this.logger.debug(`Storage Keys calculated: ${n}, ${o}`),{configKey:n,metadataKey:o}}clearCache(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this.data=void 0,void 0===this.cache)return;const{configKey:e,metadataKey:t}=this.generateCacheKeys();yield this.cache.storage.removeItem(e),yield this.cache.storage.removeItem(t),this.logger.log(`Cache for '${e}' and ${t} cleared.`)}))}}var u=i(974509),m=i(74583);const g="ECSCanary=1",h="EcsClientWeb",p=(e,t,i,n)=>Promise.resolve({constructRequest:(t,o,r)=>({apiName:"getConfiguration",url:e,method:"GET",headers:Object.assign(Object.assign(Object.assign({},i),n),r?{"If-None-Match":r}:void 0),correlationId:t}),customTelemetry:y,transformResponse:f(t),allowedResponses:[u.qb.OK,u.qb.NOT_MODIFIED,u.qb.CREATED,u.qb.NO_CONTENT]});function v(e,t,i){const n=function(e){return`${e.domain}/config/v1/${e.client}/`}(e),o=function(e){const t=[];if((0,m.forOwn)(e.filters,((e,i)=>{e&&t.push(`${i}=${e}`)})),e.agents){const i=e.agents.join(",");t.push(`agents=${i}`)}return t.push(g),`${e.version}?${t.join("&")}`}(e),r=function(e){const t=e.client,i=e.version;return{"X-ECS-Client-Last-Telemetry-Events":`ecs_client_library_name=${h},ecs_client_app_name=${t},ecs_client_version=${i}`}}(e);return{endpointUrl:`${n}${o}`,endpointModels:()=>({baseUrl:n,serviceName:t,models:{getConfigurationAsync:p(o,i,r,e.additionalHeaders)}})}}function y(e,t,i){return JSON.stringify({correlationId:e,serviceName:t,eTag:i,initialFetch:void 0===i})}const f=e=>t=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){var i,n;switch(e.debug(`Response headers: ${JSON.stringify(t.headers)}`),t.status){case u.qb.OK:{const o=yield t.body.json(),r=null!==(i=t.headers.expires)&&void 0!==i?i:o.Headers.Expires,s=null!==(n=t.headers.etag)&&void 0!==n?n:o.Headers.ETag,l=o.Headers.CountryCode;return{requestStatus:a.m.Success,ecsConfiguration:o,headers:S(e,r,s,l)}}case u.qb.NOT_MODIFIED:case u.qb.CREATED:case u.qb.NO_CONTENT:return{requestStatus:a.m.Success_NoChanges,headers:S(e,t.headers.expires,t.headers.etag)};default:throw new Error(`Response status ${t.status} unexpectedly allowed`)}})),S=(e,t,i,n)=>{let o=Date.parse(t);if(isNaN(o)){const e=t.match(/\d+/g);if(e&&1===e.length&&(o=Number.parseInt(t,10)),isNaN(o))throw new Error(`Invalid or missing expiration date: '${t}'`)}if(!i)throw new Error("Missing etag value");return n||e.warn("Missing country code"),{ETag:i,Expires:new Date(o),CountryCode:n}};class k extends d{constructor(e,t,i,n,o,r,a){super(e,i,t),this.ecsParameters=t,this.endpointsManager=n,this.fetchPrecheck=o,this.transformData=r,this.fetchMode=s.z.Manual,this.clientType="EcsClient";const{endpointUrl:l,endpointModels:c}=v(this.ecsParameters,this.serviceName,this.logger);this.fetchUrl=l,this.ecsApi=this.endpointsManager.createApi(c),a&&(this.data=a.data,this.cache=a.cache)}fetch(){var e,t;return(0,n.__awaiter)(this,void 0,void 0,(function*(){const i=void 0===this.eTag,n=(0,r.v4)();this.lastAttemptedFetch=new Date,this.logger.log(`Getting ECS configuration from ${this.fetchUrl}. correlationId=${n}, isInitialFetch=${i}`);const o=(null===(e=this.fetchPrecheck)||void 0===e?void 0:e.call(this))||!0;if(!0!==o)return this.scheduleNextConfigurationFetch(),this.logger.debug(`${o.errorMessage}. correlationId=${n}`),{requestStatus:o.requestStatus};try{const e=yield this.ecsApi.getConfigurationAsync(n,this.serviceName,this.eTag);this.logger.log(`ECS configuration fetch complete. status=${a.m[e.requestStatus]}, correlationId=${n}, isInitialFetch=${i}`),this.data=this.onSuccess(e,n),this.configIds=null===(t=e.ecsConfiguration)||void 0===t?void 0:t.ConfigIDs,this.updateCache()}catch(e){return this.onError(e,n)}return this.scheduleNextConfigurationFetch(),this.data}))}startFetchSchedule(e,t){this.host=e,this.callbackFunction=t,this.fetchMode=s.z.WhenExpired,this.logger.debug("Starting ECS configuration fetch schedule in WhenExpired mode."),this.scheduleNextConfigurationFetch()}updateParameters(e){const t=this.fetchUrl,{endpointUrl:i,endpointModels:n}=v(e,this.serviceName,this.logger);return this.fetchUrl=i,this.ecsApi=this.endpointsManager.createApi(n),this.ecsParameters=e,t!==this.fetchUrl}dispose(){this.fetchMode=s.z.Manual,this.clearConfigurationFetchSchedule()}getDiagnosticInfo(){return{configIds:this.configIds,ecsParameters:this.ecsParameters,etag:this.eTag,fetchUrl:this.fetchUrl,lastAttemptedFetch:this.lastAttemptedFetch,lastSuccessfulFetch:this.lastSuccessfulFetch,nextScheduledFetch:this.nextScheduledFetch,fetchMode:this.fetchMode,expirationTime:this.expiration}}get eTag(){var e,t;return null===(t=null===(e=this.data)||void 0===e?void 0:e.headers)||void 0===t?void 0:t.ETag}updateCache(){var e;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(void 0===this.cache)return;const{storage:t}=this.cache,{configKey:i,metadataKey:o}=this.generateCacheKeys();if(!(null===(e=this.data)||void 0===e?void 0:e.ecsConfiguration)||0===Object.keys(this.data.ecsConfiguration).length)return void this.logger.log(`updateCache() received empty data. Cache State: ${l.Hw[this.cacheState]} (Storage key: ${i})`);const r=this.data,{ecsConfiguration:s}=r,a=(0,n.__rest)(r,["ecsConfiguration"]);yield t.setItem(i,JSON.stringify(s)),yield t.setItem(o,JSON.stringify(a)),this.logger.log(`Cache '${i}' updated.`)}))}onSuccess(e,t){var i;let n;switch(e.requestStatus){case a.m.Success:if(!e.ecsConfiguration)throw new Error("ECS configuration is unexpectedly undefined on a successful response");if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");if(!this.ecsParameters.disableSentinelConfigValidation&&!this.validateSentinelConfig(e.ecsConfiguration))throw new Error("Sentinel Config is missing from response");n=(null===(i=this.transformData)||void 0===i?void 0:i.call(this,e))||e;break;case a.m.Success_NoChanges:if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");n=Object.assign(Object.assign({},this.data),{requestStatus:e.requestStatus,headers:e.headers}),this.data=n,this.updateCache(),this.logger.debug(`ECS configuration is unchanged. eTag=${this.eTag}, correlationId=${t}`);break;default:throw new Error(`Received unexpected request status of ${a.m[e.requestStatus]}`)}return this.lastSuccessfulFetch=this.lastAttemptedFetch,n}onError(e,t){var i,n;const r=this.processErrorText(e,"unknown error");let s=a.m.Error_Unknown;switch(e.reason){case o.A.TimedOut:s=a.m.Error_TimedOut;break;case o.A.TransformFailed:s=a.m.Error_TransformFailed;break;default:s=(null==e?void 0:e.reason)===o.A.RejectHttpError&&void 0===(null===(i=null==e?void 0:e.serverResponse)||void 0===i?void 0:i.status)?a.m.Error_BrowserError:a.m.Error_Unknown}return this.logger.error(`Fetching ECS configuration failed. error=${e}, innerExceptionMessage=${null===(n=e.innerException)||void 0===n?void 0:n.message} correlationId=${t}`),{requestStatus:s,errorMessage:r}}processErrorText(e,t){var i;let n=t;return e&&(n=(null===(i=Object.keys(e))||void 0===i?void 0:i.length)>0?JSON.stringify(e):e.message,e.innerException&&(n+=` innerExceptionMessage: ${e.innerException.message}`)),n}validateSentinelConfig(e){var t;return e[c]?(this.logger.log("ECS Sentinel Config is present in ECS response at the root level"),!0):(null===(t=e.ECS)||void 0===t?void 0:t[c])?(this.logger.log("ECS Sentinel Config is present in ECS response inside ECS object"),!0):(this.logger.error("ECS Sentinel Config is missing from ECS response"),!1)}clearConfigurationFetchSchedule(){this.setTimeoutHandle&&this.host&&(this.host.clearTimeout(this.setTimeoutHandle),this.setTimeoutHandle=void 0,this.logger.debug("Cleared existing queued configuration fetch"))}scheduleNextConfigurationFetch(){if(this.clearConfigurationFetchSchedule(),this.fetchMode===s.z.Manual)return void this.logger.debug("No need to queue configuration fetch in manual mode, ignoring...");if(!this.host)return void this.logger.error("No host provided, cannot schedule next configuration fetch");const e=this.calculateFetchInterval();this.setTimeoutHandle=this.host.setTimeout((()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.fetch();this.callbackFunction&&this.callbackFunction(e)}))),e),this.nextScheduledFetch=new Date(Date.now()+e),this.logger.debug(`Next ECS configuration fetch will occur in ${e}ms at ${this.nextScheduledFetch}`)}calculateFetchInterval(){var e;if(this.fetchMode===s.z.Manual)throw new Error(`Calculating fetch interval is not supported when using ${s.z[this.fetchMode]} fetch mode.`);const t=(null!==(e=this.expiration)&&void 0!==e?e:new Date).valueOf()-Date.now();return t<k.MinimumRefreshIntervalInMilliseconds?(this.logger.warn(`Calculated refresh interval of ${t}ms based on expires header was below the allowed minimum of ${k.MinimumRefreshIntervalInMilliseconds}ms. Minimum value will be used instead.`),k.MinimumRefreshIntervalInMilliseconds):t}}k.MinimumRefreshIntervalInMilliseconds=18e5;class b extends d{constructor(){super(...arguments),this.clientType="LocalEcsClient"}createClient({ecsParameters:e,endpointsManager:t,loggerFactory:i,fetchPrecheck:n,transformData:o}){const r={data:this.data,cache:this.cache};return new k(this.serviceName,e,i,t,n,o,r)}}function w({serviceName:e,cacheOptions:t,loggerFactory:i}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=new b(e,i);return yield n.initializeCache(t),n}))}function C({serviceName:e,ecsParameters:t,loggerFactory:i,endpointsManager:n,fetchPrecheck:o,transformData:r}){return new k(e,t,i,n,o,r)}function _({serviceName:e,ecsParameters:t,cacheOptions:i,loggerFactory:o,endpointsManager:r,fetchPrecheck:s,transformData:a}){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const n=new k(e,t,o,r,s,a);return yield n.initializeCache(i),n}))}},388522:(e,t,i)=>{"use strict";var n,o,r;i.d(t,{Jv:()=>n,OP:()=>o,cw:()=>r}),function(e){e.NotInstalled="NotInstalled",e.InstalledNotActive="InstalledNotActive",e.InstalledActive="InstalledActive"}(n||(n={})),function(e){e.Teams1="Teams1",e.Teams2="Teams2"}(o||(o={})),function(e){e.DownloadedAndInstalled="DownloadedAndInstalled",e.FailedToDownload="FailedToDownload",e.FailedToInstall="FailedToInstall",e.DownloadPageOpened="DownloadPageOpened"}(r||(r={}))},665380:(e,t,i)=>{"use strict";var n,o,r,s,a;i.d(t,{$y:()=>n,f8:()=>o}),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Unknown="Unknown",e.Resumed="Resumed",e.Suspending="Suspending"}(n||(n={})),function(e){e.Light="Light",e.Dark="Dark",e.Contrast="Contrast",e.OSTheme="OSTheme"}(o||(o={})),function(e){e.Unknown="Unknown",e.Crashed="Crashed",e.LaunchFailed="LaunchFailed",e.OutOfMemory="OutOfMemory",e.Terminated="Terminated",e.Unexpected="Unexpected",e.Unresponsive="Unresponsive"}(r||(r={})),function(e){e.Unknown="Unknown",e.BrowserProcessExited="BrowserProcessExited",e.FrameRenderProcessExited="FrameRenderProcessExited",e.GpuProcessExited="GpuProcessExited",e.MainWindow="MainWindow",e.PpapiPluginProcessExited="PpapiPluginProcessExited",e.PpapiBrokerProcessExited="PpapiBrokerProcessExited",e.RenderProcessExited="RenderProcessExited",e.RenderProcessUnresponsive="RenderProcessUnresponsive",e.SandboxHelperProcessExited="SandboxHelperProcessExited",e.UtilityProcessExited="UtilityProcessExited"}(s||(s={})),function(e){e.Internal="Internal",e.Clone="Clone",e.Extend="Extend",e.External="External"}(a||(a={}))},749531:(e,t,i)=>{"use strict";var n;i.d(t,{t:()=>n}),function(e){e.activity="activity",e.alarm="alarm",e.alert="alert",e.attention="attention",e.busy="busy",e.error="error",e.oofDoNotDisturb="oofDoNotDisturb",e.oofAvailable="oofAvailable",e.oofAway="oofAway",e.oofBusy="oofBusy",e.oofOffline="oofOffline",e.oofUnknown="oofUnknown",e.available="available",e.away="away",e.doNotDisturb="doNotDisturb",e.offline="offline",e.unknown="unknown"}(n||(n={}))},839856:(e,t,i)=>{"use strict";var n,o,r,s;i.d(t,{GV:()=>o,bT:()=>s}),function(e){e.Unknown="Unknown",e.Persistent="Persistent",e.NonPersistent="NonPersistent"}(n||(n={})),function(e){e.None="None",e.Citrix="Citrix",e.VMware="VMware",e.AVD="AVD",e.Windows365="Windows365"}(o||(o={})),function(e){e.Unknown="Unknown",e.Dedicated="Dedicated",e.Shared="Shared"}(r||(r={})),function(e){e.none="none",e.webrtc="webrtc",e.slimcore="slimcore"}(s||(s={}))},37117:(e,t,i)=>{"use strict";var n;i.d(t,{$:()=>n}),function(e){e.None="none",e.DayStart="dayStart",e.MeetingPrep="meetingPrep",e.MeetingStart="meetingStart",e.MeetingStarted="meetingStarted",e.MeetingEnd="meetingEnd",e.Feedback="feedback",e.InMeetingActionStatusUpdated="inMeetingActionStatusUpdated",e.InMeetingGreeting="inMeetingGreeting",e.InMeetingShareFile="inMeetingShareFile",e.RunningLate="inMeetingRunningLate",e.ReportUsage="reportUsage"}(n||(n={}))},113851:(e,t,i)=>{"use strict";i.d(t,{h:()=>n});class n{constructor(){}static getInstance(){return this.platformAppConversationService||(this.platformAppConversationService=new n),this.platformAppConversationService}setSubEntityDeepLinkInfo(e){this.deepLink=e}getSubEntityDeepLinkInfo(){return this.deepLink}setClientMessageId(e){this.clientMessageId=e}getClientMessageId(){return this.clientMessageId}}},891822:(e,t,i)=>{"use strict";i.d(t,{r_:()=>r,Sb:()=>s,gt:()=>a,eS:()=>l,JW:()=>c,Qs:()=>d,ZD:()=>u,nf:()=>m,z$:()=>g});var n=i(50805),o=i(594827);const r=e=>"string"==typeof e&&o.zV.indexOf(e)>-1,s=e=>e&&0!==e.length?e[0].toLowerCase()+e.substring(1):e,a=()=>{const e={};return null===o.KB||void 0===o.KB||o.KB.forEach((t=>{const i=t.split("-");2===i.length&&(e[i[1]]=i[0])})),e},l=()=>{const e={};return null===o.KB||void 0===o.KB||o.KB.forEach((t=>{const i=t.split("-");2===i.length&&(e[i[0]]=i[1])})),e},c=e=>{const t=[],i=[],n=Array.from(o.$6).concat(Array.from(o.OL)),r=new Set(null!=n?n:[]);return e.forEach((e=>{r.has(e)?i.push(e):t.push(e)})),{policiesNamespaces:t,settingsNamespaces:i}},d=e=>{if(!e)return e;const t=l();Object.keys(t).forEach((i=>{const n=t[i];e[i]&&!e[n]&&(e[n]=e[i]),e[n]&&!e[i]&&(e[i]=e[n])}));const i={};u().forEach((t=>{e[t]&&(i[t]=e[t])}));const n=Object.assign(Object.assign({},e.policySettings),i);return Object.keys(n).length>0&&(e.policySettings=n),e},u=()=>["byot","callingLineIdentityPolicy","clientPolicy","dialPlanPolicy","locationPolicy","teamsInteropPolicy","teamsMeetingPolicy","voicePolicy"],m=(e,t,i)=>{var n,o,r;if("userPropertiesSettings"===e){const s=t,a=(null==s?void 0:s.isOnCloud)?["rest","substrate"]:["ews"];for(const t of a)if("TaskTimedOut"===(null===(r=null===(o=null===(n=null==s?void 0:s.autodiscoverSettings)||void 0===n?void 0:n[t])||void 0===o?void 0:o.mailboxDiscoverabilityError)||void 0===r?void 0:r.errorCode)){i[e]="TaskTimedOut";break}}},g=(e,t)=>{var i,o;const r=null!==(i=e("policies").namespaces)&&void 0!==i?i:[],s=null!==(o=t.get(n.J.Core,["unsupportedPoliciesNamespaces"]).unsupportedPoliciesNamespaces)&&void 0!==o?o:[],{enableDeviceStoreMetadataFetch:a}=t.get(n.J.Marketplace);a||s.push("deviceStoreMetadata");const{enableFetchingSmbTenantSettings:l}=t.get(n.J.Smb);l||s.push("smbTenantSettings");const{enableTeamsUserPhoneNumbersFetching:c}=t.get(n.J.Calling);return c||s.push("teamsUserPhoneNumbers"),0===s.length?r:r.filter((e=>!s.includes(e)))}},594827:(e,t,i)=>{"use strict";i.d(t,{$6:()=>n,OL:()=>o,Ao:()=>r,KB:()=>s,zV:()=>a});const n=["adminSettings","clientSettings","deviceStoreMetadata","educationSettings","organizationSettings","smbTenantSettings","tenantProperties","tenantSettingsV2","tenantSiteUrl","tenantVoiceSettings","userPropertiesSettings","userResourcesSettings","voiceAdminSettings","teamsMessagingConfiguration","teamsLinkPolicy","teamsUserPhoneNumbers"],o=["ageConsentPolicy"],r=["branchSurvivabilityPolicy","broadcastMeetingPolicy","callingLineIdentityPolicy","callingPolicy","callParkPolicy","dialPlanPolicy","educationAssignmentsAppPolicy","feedbackPolicy","filesPolicy","meetingPolicy","messagingPolicy","policySettings","shiftsPolicy","syntheticAutomatedCallPolicy","targetingPolicy","teamsAndChannelsPolicy","updateManagementPolicy","upgradePolicy","vdiPolicy","voicemailPolicy","byot","callingLineIdentity","clientPolicy","externalAccessPolicy","locationPolicy","onlineDialinConferencingPolicy","onlineVoicemailPolicy","onlineVoiceRoutingPolicy","teamsBranchSurvivabilityPolicy","teamsCallingPolicy","teamsCallParkPolicy","teamsChannelsPolicy","teamsEducationAssignmentsAppPolicy","teamsEmergencyCallingPolicy","teamsEmergencyCallRoutingPolicy","teamsEnhancedEncryptionPolicy","teamsEventsPolicy","teamsFeedbackPolicy","teamsFilesPolicy","teamsInteropPolicy","teamsMediaLoggingPolicy","teamsMeetingBrandingPolicy","teamsMeetingBroadcastPolicy","teamsMeetingPolicy","teamsMessagingPolicy","teamsRoomVideoTeleConferencingPolicy","teamsShiftsPolicy","teamsSyntheticAutomatedCallPolicy","teamsTargetingPolicy","teamsUpdateManagementPolicy","teamsUpgradePolicy","teamsVdiPolicy","teamsVoiceApplicationsPolicy","tenantDialPlan","voicePolicy","teamsVirtualAppointmentsPolicy","teamsAppPermissionPolicy","teamsAppSetupPolicy"],s=["callingLineIdentity-callingLineIdentityPolicy","onlineVoicemailPolicy-voicemailPolicy","teamsBranchSurvivabilityPolicy-branchSurvivabilityPolicy","teamsCallingPolicy-callingPolicy","teamsCallParkPolicy-callParkPolicy","teamsChannelsPolicy-teamsAndChannelsPolicy","teamsEducationAssignmentsAppPolicy-educationAssignmentsAppPolicy","teamsFeedbackPolicy-feedbackPolicy","teamsFilesPolicy-filesPolicy","teamsMeetingBroadcastPolicy-broadcastMeetingPolicy","teamsMeetingPolicy-meetingPolicy","teamsMessagingPolicy-messagingPolicy","teamsShiftsPolicy-shiftsPolicy","teamsSyntheticAutomatedCallPolicy-syntheticAutomatedCallPolicy","teamsTargetingPolicy-targetingPolicy","teamsUpdateManagementPolicy-updateManagementPolicy","teamsUpgradePolicy-upgradePolicy","teamsVdiPolicy-vdiPolicy","tenantDialPlan-dialPlanPolicy"],a=Array.from(n).concat(Array.from(o)).concat(Array.from(r))},188143:(e,t,i)=>{"use strict";var n,o,r;i.d(t,{f5:()=>n,Ko:()=>o,r1:()=>r}),function(e){e.ActiveUserOperation="AUO",e.PassiveOperation="PO",e.BackgroundOperation="BO"}(n||(n={})),function(e){e.UploadFile="ShareUploadFile",e.RemoveFile="ShareAbort"}(o||(o={})),function(e){e.Unknown="Unknown",e.Inline="Inline",e.Attached="Attached"}(r||(r={}))},342097:(e,t,i)=>{"use strict";i.d(t,{vc:()=>n,Bd:()=>o,d5:()=>r});const n={EmptyEvent:"EmptyEvent",NotEnabled:"NotEnabled",RequiredFieldMissing:"RequiredFieldMissing",SubscriptionFailed:"SubscriptionFailed",MethodNotAvailable:"showBadge not available on taskbar module.",ModuleUnableToLoad:"HostComms is unable to load taskbar module. We are running on Web or Teams 1.0. Bailing out."},o={ModuleLoaded:"HostComms has loaded taskbar module. Setting badge.",UpdatedEvent:"Updated Taskbar Badge Count:"},r="TaskbarService"},699532:(e,t,i)=>{"use strict";i.d(t,{K:()=>Te});var n=i(516909),o=i(8122),r=i(974509),s=i(844729),a=i(299295),l=i(740597),c=i(145279),d=i(223005),u=i(89062),m=i(48824);const g={source:"teamsAndChannels"},h=()=>({authOptions:g,apiName:"canCreateTWT",url:"beta/teams/canCreateTWT",method:"GET"}),p=e=>({authOptions:g,apiName:"createTeam",url:"beta/teams/create",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),v=(e,t)=>({authOptions:g,apiName:"editTeam",url:`beta/teams/${e}`,method:"PATCH",body:JSON.stringify(t),headers:{"content-type":"application/json"}}),y=(e,t,i)=>({authOptions:g,apiName:"profilepicture",url:`beta/teams/${e}/profilepicture?threadId=${t}`,method:"POST",body:i,headers:{"content-type":"application/json"}}),f=e=>(0,l.__awaiter)(void 0,void 0,void 0,(function*(){if(e.status===r.qb.OK)return!0;throw new Error(`Request to server failed with ${null==e?void 0:e.status} request url: ${null==e?void 0:e.url}`)})),S=e=>({authOptions:g,apiName:"defaultProfilePicture",url:`beta/teams/defaultProfilePicture?displayName=${e}&highResolution=true`,method:"GET",headers:{"content-type":"application/json"}}),k=e=>(0,l.__awaiter)(void 0,void 0,void 0,(function*(){if(e.status===r.qb.OK&&(null==e?void 0:e.body)){const t=yield e.body.blob();return(yield(0,m.n)(t))||""}throw(0,c.T)(d.A.TransformFailed,e)})),b=e=>({authOptions:g,apiName:"findJoinRequests",url:"beta/teams/findJoinRequests",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),w=e=>({authOptions:g,apiName:"getChannelEmailSettingsRequest",url:`beta/channels/${e}/email`,method:"GET",headers:{"content-type":"application/json"}}),C=e=>({authOptions:g,apiName:"migrateGroupToTeam",url:`beta/teams/migrateGroup/${encodeURIComponent(e.groupId)}`,body:(0,u.u4)(Object.assign(Object.assign({},e),{teamType:Object.keys(n.C9).indexOf(e.teamType)})),method:"PUT",headers:{"content-type":"application/json"}}),_=e=>({authOptions:g,apiName:"myGroupMemberships",url:`beta/teams/usergroups?teamType=${e}`,method:"GET",headers:{"content-type":"application/json"}}),T=(e,t)=>({authOptions:g,apiName:"createChannelEmailSettingsRequest",url:`beta/channels/${e}/email`,body:JSON.stringify(t),method:"POST",headers:{"content-type":"application/json"}}),I=(e,t)=>({authOptions:g,apiName:"updateChannelEmailSettingsRequest",url:`beta/channels/${e}/email`,body:JSON.stringify(t),method:"PUT",headers:{"content-type":"application/json"}}),j=e=>({authOptions:g,apiName:"removeChannelEmailSettingsRequest",url:`beta/channels/${e}/email`,method:"DELETE",headers:{"content-type":"application/json"}}),N=(e,t)=>({authOptions:g,apiName:"handleBulkJoinRequests",url:`beta/teams/bulkJoinRequestAdminAction?silentAction=${t}`,method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),E=(e,t)=>({authOptions:g,apiName:"handleJoinRequest",url:`beta/teams/joinRequestAdminAction?silentAction=${t}`,method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),x=(e,t,i)=>({authOptions:g,apiName:"leaveChannel",url:`beta/teams/${e}/channels/${t}/members/${i}`,method:"DELETE",headers:{"content-type":"application/json"}}),A=e=>({authOptions:g,apiName:"userGroupSettings",url:"beta/users/groupsSettings",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),D=e=>({authOptions:g,apiName:"groupSettings",url:`beta/teams/${e}/groupSettings`,method:"GET"}),F=e=>({authOptions:g,apiName:"setFavoritedTimeForStaleTeams",url:"beta/users/setFavoriteTime",body:JSON.stringify(e),method:"PUT",headers:{"content-type":"application/json"}}),O=(e,t,i)=>({authOptions:g,apiName:"removePrivateChannelMembership",url:`beta/teams/${e}/channels/${t}/members/${i}`,method:"DELETE",headers:{"content-type":"application/json"}}),M=(e,t)=>({authOptions:g,apiName:"restoreChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${encodeURIComponent(t)}/restore`,method:"PATCH"}),R=(e,t,i)=>({authOptions:g,apiName:"deleteChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${encodeURIComponent(t)}`,method:"DELETE",body:JSON.stringify(i),headers:{"content-type":"application/json"}}),P=e=>({authOptions:g,apiName:"getSensitivityLabels",url:`beta/users/sensitivityLabels?includeUnscopedLabels=${e}`,method:"GET"}),L=()=>({authOptions:g,apiName:"getSensitivityPolicySettings",url:"beta/users/sensitivityPolicySettings",method:"GET"}),U=(e,t)=>({authOptions:g,apiName:"sponsorJoinRequest",url:`beta/teams/sponsorJoinRequest/${e}`,method:"POST",body:JSON.stringify(t),headers:{"content-type":"application/json"}}),W=e=>e.body.json().then((e=>{var t,i;if(null==e?void 0:e.value)return Object.assign(Object.assign({},e.value),{groupId:null===(i=null===(t=e.value)||void 0===t?void 0:t.siteInfo)||void 0===i?void 0:i.groupId})})).catch((()=>{throw(0,c.T)(d.A.TransformFailed,e)})),B=e=>(0,l.__awaiter)(void 0,void 0,void 0,(function*(){const t=yield e.body.json();if(t&&t.joinRequestsPerTeam){const e=t.joinRequestsPerTeam,i=Object.keys(e),n=[];for(const t of i)if(e[t])for(const i of e[t])i.teamId=t,n.push(i);return t.joinRequestsPerTeam=n,t}})),$=e=>({authOptions:g,apiName:"validateTeamName",url:"beta/teams/validateNaming",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),H=e=>({authOptions:g,apiName:"allChannels",url:`beta/teams/${e}/allchannels`,method:"PUT",body:JSON.stringify({Channels:[{Type:"standard",State:["deleted"]},{Type:"private",State:["deleted"]},{Type:"shared",State:["deleted"]}]}),headers:{"content-type":"application/json"}}),q=e=>({authOptions:g,apiName:"allChannels",url:`beta/teams/${e}/allchannels`,method:"PUT",body:JSON.stringify({Channels:[{Type:"standard",State:["archived"]},{Type:"private",State:["archived"]},{Type:"shared",State:["archived"]}]}),headers:{"content-type":"application/json"}}),z=(e,t)=>({authOptions:g,apiName:"updateTeamMembership",url:`beta/teams/${encodeURIComponent(e)}/members`,method:"PUT",body:JSON.stringify(t),headers:{"content-type":"application/json"}}),V=(e,t,i,n)=>({authOptions:g,apiName:"updateTeamMembership",url:`beta/teams/${e}/members`,method:"PUT",body:JSON.stringify({groupId:t,userMri:i,updateType:n}),headers:{"content-type":"application/json"}}),G=(e,t,i,n)=>({authOptions:g,apiName:"updatePrivateChannelMembership",url:`beta/teams/${e}/channels/${t}/members/${i}`,method:"PATCH",body:JSON.stringify({mri:i,role:n}),headers:{"content-type":"application/json"}}),J=e=>({authOptions:g,apiName:"resetTeamJoinCode",url:`beta/teams/${e}/joinCode`,method:"PUT",headers:{"content-type":"application/json"}}),K=e=>({authOptions:g,apiName:"removeTeamJoinCode",url:`beta/teams/${e}/joinCode`,method:"DELETE",headers:{"content-type":"application/json"}}),Q=e=>({authOptions:g,apiName:"getTeamJoinCode",url:`beta/teams/${e}/joinCode`,method:"GET"}),Y=e=>({authOptions:g,apiName:"renewTeam",url:`beta/teams/${e}/renew`,method:"POST"}),X=(e,t)=>({authOptions:g,apiName:"updateTeamDiscoverability",url:`beta/teams/${e}/discoverable`,method:"PUT",body:JSON.stringify(t)}),Z=e=>({authOptions:g,apiName:"getRecommendedTeams",url:`beta/teams/suggested?accessType=${e}&enableFallback=true`,method:"GET"}),ee=e=>({authOptions:g,apiName:"joinTeamById",url:`beta/teams/joinRequest/${e}`,method:"POST",headers:{"content-type":"application/json"}}),te=(e,t,i)=>({authOptions:g,apiName:"searchRecommendedTeams",url:`beta/teams/find?keywords=${encodeURIComponent(t)}&accessType=${e}&enableKeywordSearch=false&top=100&skipToken=${encodeURIComponent(i||"")}`,method:"GET"}),ie=e=>({authOptions:g,apiName:"joinTeamWithCode",url:"beta/teams/joinByCode",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),ne=e=>({authOptions:g,apiName:"cancelJoinRequest",url:`beta/teams/cancelJoinRequest/${e}`,method:"POST",headers:{"content-type":"application/json"}}),oe=e=>({authOptions:g,apiName:"deleteTeam",url:`beta/teams/${encodeURIComponent(e)}/delete`,method:"DELETE",headers:{"content-type":"application/json"}}),re=e=>({authOptions:g,apiName:"archiveTeam",url:`beta/teams/${encodeURIComponent(e)}/archive`,method:"POST",headers:{"content-type":"application/json"}}),se=(e,t)=>({authOptions:g,apiName:"unarchiveChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${t}/unarchive`,method:"POST",headers:{"content-type":"application/json"}}),ae=(e,t)=>({authOptions:g,apiName:"archiveChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${t}/archive`,method:"POST",headers:{"content-type":"application/json"}}),le=e=>({authOptions:g,apiName:"unarchiveTeam",url:`beta/teams/${encodeURIComponent(e)}/unarchive`,method:"POST",headers:{"content-type":"application/json"}}),ce=(e,t)=>({authOptions:g,apiName:"setChannelShowForMember",url:`beta/teams/${e}/setDefaultChannel`,method:t?"PUT":"DELETE",headers:{"content-type":"application/json"}}),de=(e,t)=>({authOptions:g,apiName:"createChannel",url:`beta/teams/${e}/channels`,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}),ue=e=>(0,l.__awaiter)(void 0,void 0,void 0,(function*(){return e.body.json().then((e=>({id:e.value.objectId}))).catch((()=>{throw(0,c.T)(d.A.TransformFailed,e)}))})),me=(e,t,i)=>({authOptions:g,apiName:"updateChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${encodeURIComponent(t)}`,method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(i)}),ge=(e,t,i,n)=>{const o={users:i,groupId:t},r=n?"?allowBotsInChannel=true":"";return{authOptions:g,method:"PUT",url:`beta/teams/${encodeURIComponent(e)}/bulkUpdateRoledMembers${r}`,body:(0,u.XC)(o),headers:{"content-type":"application/json"}}},he=(e,t,i)=>{const n={value:i};return{authOptions:g,method:"PUT",url:`beta/teams/${encodeURIComponent(e)}/channels/${encodeURIComponent(t)}/members`,body:(0,u.XC)(n),headers:{"content-type":"application/json"}}},pe=(e,t)=>{const i=t.map((e=>e.mri));return{authOptions:g,method:"POST",url:`beta/teams/sponsorJoinRequest/${encodeURIComponent(e)}`,body:(0,u.XC)(i),headers:{"content-type":"application/json"}}},ve=e=>({authOptions:g,apiName:"getTeamInfo",url:`beta/teams/getTeamInfo?groupId=${e}`,method:"GET",headers:{"content-type":"application/json"}}),ye=(e,t,i)=>{const n=Object.assign(Object.assign({},i),{userType:"Guest"}),o=`beta/teams/${encodeURIComponent(e)}/${t}/inviteAndAddGuest`;return{authOptions:g,apiName:"inviteAndAddGuest",url:o,method:"PUT",headers:{"content-type":"application/json"},body:(0,u.u4)(n)}},fe=(e,t,i,n)=>{const o={type:"Team"===e?"team":"channel",containerId:t,groupId:i,itemId:n,allowXtenantAccess:"SharedChannel"===e};return{authOptions:g,apiName:"deeplink",url:"beta/deeplink",method:"POST",body:JSON.stringify(o),headers:{"content-type":"application/json"}}},Se=(e,t)=>({authOptions:g,apiName:"cloneTeam",url:`beta/teams/${encodeURIComponent(e)}/clone`,method:"POST",headers:{"content-type":"application/json"},body:(0,u.u4)(Object.assign(Object.assign({},t),{accessType:Object.keys(n.eU).indexOf(t.accessType.toString())}))}),ke=e=>({authOptions:g,apiName:"templateProvisioningStatus",url:`beta/teams/${encodeURIComponent(e)}/templateProvisioningStatus`,method:"GET",headers:{"content-type":"application/json"}}),be=e=>{const{authenticationResources:t,discover:i,platformService:n,config:r}=e,l=(0,s.h)(n,r),c=(0,a.g)(we,l),d=(0,a.g)(Ce,l);return{baseUrlPromise:()=>i.regionGtm("middleTier"),serviceName:o.E.MiddleTier,authResource:t.mtAuthWithSkypeXTokenResource,models:{canCreateTWT:c(h),createTeam:c(p).withTransform(W),deletedChannels:c(H),archivedChannels:c(q),editTeam:c(v),changeTeamPicture:c(y).withTransform(f),getDefaultTeamPicture:c(S).withTransform(k),findJoinRequests:c(b).withTransform(B),getChannelEmailSettings:d(w),migrateGroupToTeam:c(C),myGroupMemberships:c(_),createChannelEmailSettings:d(T),updateChannelEmailSettings:d(I),removeChannelEmailSettings:d(j),handleBulkJoinRequests:c(N),handleJoinRequest:c(E),leaveChannel:c(x),groupSettings:c(D),myGroupSettings:c(A),removePrivateChannelMembership:c(O),setFavoritedTimeForStaleTeams:c(F),restoreChannel:c(M),deleteChannel:c(R),editChannel:c(me),sensitivityLabels:c(P),sensitivityPolicySettings:c(L),sponsorJoinRequest:c(U),updatePrivateChannelMembership:c(G),updateTeamMembership:c(V),validateTeamName:c($),removeTeamMembership:c(z),resetTeamJoinCode:c(J),removeTeamJoinCode:c(K),getTeamJoinCode:c(Q),renewTeam:c(Y),updateTeamDiscoverability:c(X),getRecommendedTeams:c(Z),joinTeamById:c(ee),searchRecommendedTeams:c(te),joinTeamWithCode:c(ie),cancelJoinRequest:c(ne),archiveTeamRequest:c(re),unarchiveTeamRequest:c(le),archiveChannelRequest:c(ae),unarchiveChannelRequest:c(se),deleteTeamRequest:c(oe),leaveTeamRequest:Ce(z),setChannelShowForMember:c(ce),createChannel:c(de).withTransform(ue),addBulkMembersToTeam:c(ge),addBulkMembersToPrivateChannel:c(he),requestToAddMembersToTeam:c(pe),getTeamByGroupId:c(ve),inviteAndAddGuestToTeam:Ce(ye),teamsAndChannelsPageDeepLinkUrl:c(fe),cloneTeam:c(Se),templateProvisioningStatus:c(ke)}}};function we(e){return Promise.resolve({constructRequest:e,allowedResponses:[r.qj.HTTP_2XX]})}function Ce(e){return Promise.resolve({constructRequest:e,allowedResponses:[r.qj.HTTP_2XX,r.qj.HTTP_4XX]})}var _e=i(500396);class Te{constructor(e){this._transport=e.createApi(be)}canCreateTWT(){return this._transport.canCreateTWT()}createTeam(e){const t=Object.assign(Object.assign({},e),{accessType:this.convertTeamAccessType(e.accessType)});return this._transport.createTeam(t)}deletedChannels(e){return this._transport.deletedChannels(e)}archivedChannels(e){return this._transport.archivedChannels(e)}editTeam(e,t){return this._transport.editTeam(e,t)}changeTeamPicture(e,t,i){return this._transport.changeTeamPicture(e,t,i)}getDefaultTeamPicture(e){return this._transport.getDefaultTeamPicture(e)}findJoinRequests(e){return this._transport.findJoinRequests(e)}getChannelEmailSettings(e){return this._transport.getChannelEmailSettings(e)}createChannelEmailSettings(e,t){return this._transport.createChannelEmailSettings(e,t)}updateChannelEmailSettings(e,t){return this._transport.updateChannelEmailSettings(e,t)}removeChannelEmailSettings(e){return this._transport.removeChannelEmailSettings(e)}handleBulkJoinRequests(e,t){return this._transport.handleBulkJoinRequests(e,t)}handleJoinRequest(e,t){return this._transport.handleJoinRequest(e,t)}leaveChannel(e,t,i){return this._transport.leaveChannel(e,t,i)}setFavoritedTimeForStaleTeams(e){return this._transport.setFavoritedTimeForStaleTeams(e)}removePrivateChannelMembership(e,t,i){return this._transport.removePrivateChannelMembership(e,t,i)}removeTeamMembership(e,t){return this._transport.removeTeamMembership(e,t)}restoreChannel(e,t){return this._transport.restoreChannel(e,t)}deleteChannel(e,t,i){return this._transport.deleteChannel(e,t,i)}myGroupSettings(e){return this._transport.myGroupSettings(e)}groupSettings(e){return this._transport.groupSettings(e)}sensitivityLabels(e=!1){return this._transport.sensitivityLabels(e)}sensitivityPolicySettings(){return this._transport.sensitivityPolicySettings()}sponsorJoinRequest(e,t){return this._transport.sponsorJoinRequest(e,t)}validateTeamName(e){return this._transport.validateTeamName(e)}updateTeamMembership(e,t,i,n){return this._transport.updateTeamMembership(e,t,i,n)}updatePrivateChannelMembership(e,t,i,n){return this._transport.updatePrivateChannelMembership(e,t,i,n)}resetTeamJoinCode(e){return this._transport.resetTeamJoinCode(e)}removeTeamJoinCode(e){return this._transport.removeTeamJoinCode(e)}getTeamJoinCode(e){return this._transport.getTeamJoinCode(e)}renewTeam(e){return this._transport.renewTeam(e)}updateTeamDiscoverability(e,t){return this._transport.updateTeamDiscoverability(e,t)}getRecommendedTeams(e){return this._transport.getRecommendedTeams(e)}joinTeamById(e){return this._transport.joinTeamById(e)}searchRecommendedTeams(e,t,i){return this._transport.searchRecommendedTeams(e,t,i)}joinTeamWithCode(e){return this._transport.joinTeamWithCode(e)}cancelJoinRequest(e){return this._transport.cancelJoinRequest(e)}archiveTeamRequest(e){return this._transport.archiveTeamRequest(e)}unarchiveTeamRequest(e){return this._transport.unarchiveTeamRequest(e)}archiveChannelRequest(e,t,i){return this._transport.archiveChannelRequest(e,t,i)}unarchiveChannelRequest(e,t){return this._transport.unarchiveChannelRequest(e,t)}deleteTeamRequest(e){return this._transport.deleteTeamRequest(e)}leaveTeamRequest(e,t){return this._transport.leaveTeamRequest(e,t)}setChannelShowForMember(e,t){return this._transport.setChannelShowForMember(e,t)}myGroupMemberships(e){return this._transport.myGroupMemberships(e)}createChannel(e,t){return this._transport.createChannel(e,t)}editChannel(e,t,i){return this._transport.editChannel(e,t,i)}addBulkMembersToTeam(e,t,i,n){return this._transport.addBulkMembersToTeam(e,t,i,n)}addBulkMembersToPrivateChannel(e,t,i){return this._transport.addBulkMembersToPrivateChannel(e,t,i)}requestToAddMembersToTeam(e,t){return this._transport.requestToAddMembersToTeam(e,t)}migrateGroupToTeam(e){return this._transport.migrateGroupToTeam(e)}getTeamByGroupId(e){return this._transport.getTeamByGroupId(e)}inviteAndAddGuestToTeam(e,t,i){return this._transport.inviteAndAddGuestToTeam(e,t,i)}teamsAndChannelsPageDeepLinkUrl(e,t,i,n){return this._transport.teamsAndChannelsPageDeepLinkUrl(e,t,i,n)}cloneTeam(e,t){return this._transport.cloneTeam(e,t)}templateProvisioningStatus(e){return this._transport.templateProvisioningStatus(e)}convertTeamAccessType(e){return e===n.eU.Public?_e.eU.Public:_e.eU.Private}}},34564:(e,t,i)=>{"use strict";i.d(t,{j:()=>r});var n=i(340690),o=i(659726);const r=(e,t)=>{var i;try{const n=JSON.parse(t.content);return{url:e,title:n.title&&s(n.title),description:n.text&&s(n.text),thumbnail:n.images&&(null===(i=n.images[0])||void 0===i?void 0:i.url)}}catch(e){throw new Error(`parsing preview content failed with error: ${(0,o.A)(e.message||"")}`)}},s=e=>(new n._).stripHtml(e)||""},805012:(e,t,i)=>{"use strict";i.d(t,{BZ:()=>s});var n=i(765923);const o="isOptedIntoT2Web",r="web_app_switcher_opt_out_redirection_fail";class s{constructor(e,t,i){this.localStorage=e,this.crossTabsService=i,this.logger=t.newLogger("WebAppSwitcherService","services-io-web-app-switcher"),this.logger.log("WebAppSwitcherService initialized")}optOutOfT2Web(e,t){var i,n,o,s;this.crossTabsService?(null===(s=(o=this.logger).warnNoPii)||void 0===s||s.call(o,"Opting user out of T2",e),this.doRedirection(!0,!0,!0,e,t)):null===(n=(i=this.logger).errorToTelemetry)||void 0===n||n.call(i,"Cross tabs service is undefined",r,{commandSource:e},!0)}redirectThisTabToT1(e){this.doRedirection(!1,!1,!1,e)}doRedirection(e,t,i,o,s){var a,l,c,d,u;let m;try{m=this.getT1Url(s)}catch(e){return void(null===(l=(a=this.logger).errorToTelemetry)||void 0===l||l.call(a,"Failed to get T1 url",r,{commandSource:o},!0))}t&&!this.clearOptInFlag(o)||(e&&(null===(c=this.crossTabsService)||void 0===c||c.postMessage("T2WebOptOut")),null===(u=(d=this.logger).warnToTelemetry)||void 0===u||u.call(d,"Redirecting to T1 web","web_app_switcher_opt_out_redirection_success",{endpointUrl:m,commandSource:o},!0),i&&this.localStorage.trySet("lastT2WebOptOutInfo",JSON.stringify({source:null!=o?o:"Unknown",timestamp:Date.now()}),"Framework","Global"),(0,n.J)().location.replace(m))}clearOptInFlag(e){var t,i,n,s,a,l;return this.localStorage.get(o,"Global")?(this.localStorage.remove(o,"Global"),this.localStorage.get(o,"Global")?(null===(s=(n=this.logger).errorToTelemetry)||void 0===s||s.call(n,"Failed to clear opt-in flag",r,{commandSource:e},!0),!1):(null===(l=(a=this.logger).warnNoPii)||void 0===l||l.call(a,"isOptedIntoT2Web flag cleared from local storage",e),!0)):(null===(i=(t=this.logger).errorToTelemetry)||void 0===i||i.call(t,"Opt-in flag not found",r,{commandSource:e},!0),!1)}getT1Url(e){let t;const i=(0,n.J)();if(e){const i=new URL(e),n=i.pathname+i.search+i.hash,o=new URL(i.origin);o.pathname="/_",o.hash=n,t=o}else{const e=new URL(i.location.href);t=new URL(e.origin)}return t.href}}},61754:(e,t,i)=>{"use strict";i.d(t,{Q:()=>n});class n{static get Instance(){return n._instance||(n._instance=new n),n._instance}constructor(){this.outstandingRequests=void 0,this.mostRecentRequest=void 0,this.requestsMapping=void 0,this.decimalPlaces=void 0,this.subscriber=void 0,this.decimalPlaces=3}processRequest(e,t,i){if(!this.subscriber)return;const{requests:n}=this.outstandingRequests;n.has(e)||n.set(e,{requestsByName:new Map});const{requestsByName:o}=n.get(e),r=o.get(t)||0;o.set(t,r+1),this.requestsMapping.set(i,{operationName:t,operationType:e}),this.notify()}processResponse(e,t){if(!this.subscriber||!this.requestsMapping.has(e))return;const{operationName:i,operationType:n}=this.requestsMapping.get(e);if("subscription"===n)return;this.requestsMapping.delete(e);const o=this.outstandingRequests&&this.outstandingRequests.requests;if(o.has(n)){const{requestsByName:e}=o.get(n);let t=e.get(i);1===t?e.delete(i):t>0&&e.set(i,--t)}const r={requestInfo:{operationName:i,operationType:n},responseTime:t&&parseFloat(t.toFixed(this.decimalPlaces))};this.mostRecentRequest=r,this.notify()}subscribe(e){this.subscriber=e,this.outstandingRequests={requests:new Map},this.requestsMapping=new Map}unsubscribe(){this.subscriber=void 0,this.outstandingRequests=void 0,this.requestsMapping=void 0}notify(){this.subscriber.processUpdate(this.outstandingRequests,this.mostRecentRequest)}}n._instance=void 0},26618:(e,t,i)=>{"use strict";i.d(t,{f5:()=>s,zB:()=>a,m0:()=>l,$J:()=>c,mw:()=>d,Mf:()=>u,NF:()=>m,UL:()=>g,hR:()=>p,Ij:()=>v,gE:()=>y,Tx:()=>f,IB:()=>b,yN:()=>_,RA:()=>T,OO:()=>I,e2:()=>j,uD:()=>N,yQ:()=>E});var n=i(646388),o=i(89062),r=i(94136);const s="=====",a="Core",l="Logs",c="Core",d=(e,t)=>{const i="function"==typeof e.timeStamp.getTime?e.timeStamp:new Date(e.timeStamp),n="function"==typeof t.timeStamp.getTime?t.timeStamp:new Date(t.timeStamp);return i.getTime()-n.getTime()},u=e=>{if(!e||0===e.length)return"";let t="";return e.forEach((e=>{var i,n,o;if(e)if((null===(i=e.message)||void 0===i?void 0:i.startsWith(s))&&(null===(n=e.message)||void 0===n?void 0:n.endsWith(s)))t+=`\n${e.message}\r\n`;else{const i="function"==typeof(null===(o=e.timeStamp)||void 0===o?void 0:o.toISOString)?e.timeStamp.toISOString():e.timeStamp,n="string"==typeof e.levelName?e.levelName.substring(0,3):"unknownLevelName";t+=`${i} ${n}\t${e.message}\r\n`}})),(0,o.LQ)(t)},m=(e,t,i,n,o=!1)=>{if(!e)return;let s=JSON.stringify(void 0===n?t:{sessionId:n,logsArray:t});o&&(s=(0,r.gzip)(s,{to:"string"})),e.setItem(i,s)},g=(e,t,i,n)=>{if(!t)return;const o=t.getItem(i);if(o){const t=JSON.parse(o);if(Array.isArray(t)&&t.length>0){const i=t.map((e=>h(e))).sort(((e,t)=>e.timeStamp.getTime()-t.timeStamp.getTime()));e.addEvents(i)}}n&&t.removeItem(i)};function h(e){const t={message:`DiagnosticsService - Converting event from localStorage failed - ${e}`,isPiiFree:!0,level:n.i.Error,levelName:"error",timeStamp:new Date};try{const i=e;if("timeStamp"in i){if("string"==typeof i.timeStamp){if(isNaN(Date.parse(i.timeStamp)))return t;i.timeStamp=new Date(i.timeStamp)}return i}}catch(e){}return t}const p=(e,t,i,r,s,a=!1)=>{i.length>512&&(i=i.substring(0,512)+"...");const l={message:i=(0,o.LQ)(i),level:t,levelName:n.i[t],timeStamp:s||new Date,isPiiFree:r};return e.addEvent(l,a),l},v=e=>(null==e?void 0:e.length)?e.filter((e=>e.isPiiFree)):e,y=(e,t,i)=>{let n="";try{const o=f(e,t,!1);o&&o.logsArray.length>0&&(i&&(o.logsArray=v(o.logsArray)),n=u(o.logsArray))}catch(e){n="Previous session logs parsing failed"}return n},f=(e,t,i)=>{let n=null==e?void 0:e.getItem(t);if(n)try{if("{"!==n.charAt(0)&&"["!==n.charAt(0))try{n=(0,r.ungzip)(n,{to:"string"})}catch(e){}const o=JSON.parse(n);if(n=null,o)return i&&e.removeItem(t),"logsArray"in o?{sessionId:o.sessionId,logsArray:o.logsArray.map((e=>h(e)))}:{sessionId:"",logsArray:o}}catch(e){}},S="tmp.previousSessionLogs",k="tmp.previousSessionErrorLogs",b=(e,t=!1)=>`${t?k:S}${e?`-${e}`:""}`,w="persistedDiagnostics",C="persistedErrorDiagnostics",_=(e,t=!1)=>`${t?C:w}${e?`-${e}`:""}`,T=(e,t,i,r)=>{const s=e.getBufferedEvents();if(s&&s.length>0){const a={message:`DiagnosticsService: The following logs were persisted from a previous session ${r}`,isPiiFree:!0,level:n.i.Info,levelName:"info",timeStamp:new Date};((e,t,i)=>{e&&e.setItem(t,(0,o.u4)(i))})(t,i,[{message:`DiagnosticsService: The above logs were persisted from a previous session ${r}`,isPiiFree:!0,level:n.i.Info,levelName:"info",timeStamp:s[0].timeStamp},...s,a]),e.addEvent({message:`DiagnosticsService: Persisting diagnostic events for next load. Key: ${i}`,isPiiFree:!0,level:n.i.Warn,levelName:"warn",timeStamp:new Date})}},I=(e,t)=>{try{const i=new Set([b(void 0,!0),b(void 0,!1)].concat(t.map((e=>b(e,!0))),t.map((e=>b(e,!1)))));Object.keys(e).filter((e=>(e.startsWith(S)||e.startsWith(k))&&!i.has(e))).forEach((t=>e.removeItem(t)))}catch(e){}},j=e=>{try{Object.keys(e).filter((e=>e.startsWith(w)||e.startsWith(C))).forEach((t=>e.removeItem(t)))}catch(e){}},N=(e,t)=>{try{const i=b(t,!1);e.removeItem(i);const n=b(t,!0);e.removeItem(n)}catch(e){}},E=e=>{try{const t="previousLoaderDiagnostics";Object.keys(e.localStorage).filter((e=>e.startsWith(S)||e.startsWith(k)||e.indexOf(t)>=0)).forEach((t=>e.localStorage.removeItem(t)))}catch(e){}}},299295:(e,t,i)=>{"use strict";i.d(t,{K:()=>s,g:()=>a});var n=i(740597),o=i(584192),r=i(844729);const s=(e,t,i)=>s=>{const{discover:a,authenticationResources:c,platformService:d,config:u}=s,m=(0,r.h)(d,u),{headers:g}=t,h=(0,n.__rest)(t,["headers"]),p=Object.assign(Object.assign({},m),g);return{baseUrlPromise:()=>a.regionGtm("middleTier"),serviceName:e,authResource:c.mtAuthResource,models:i((e=>{const t=Promise.resolve(Object.assign({constructRequest:(0,o.$)(e,p)},h));return l(t)}))}},a=(e,t,i)=>n=>{const r=e((0,o.$)(n,t),i);return l(r)},l=e=>{const t=Object.assign(e,{allow:i=>(e.then((e=>e.allowedResponses=i)),t),withCustomTelemetry:i=>(e.then((e=>e.customTelemetry=i)),t),withRetry:i=>(e.then((e=>e.retryPolicy=i)),t),withResponse:i=>(e.then((e=>e.responseType=i)),t),withTransform:i=>(e.then((e=>e.transformResponse=i)),t)});return t}},145279:(e,t,i)=>{"use strict";function n(e,t,i){const n=new Error(e);return Object.assign(n,{reason:e,serverResponse:t,innerException:i})}i.d(t,{T:()=>n})},584192:(e,t,i)=>{"use strict";function n(e,t){return t?(...i)=>{const n=e(...i);return Object.assign(Object.assign({},n),{headers:Object.assign(Object.assign({},t),n.headers)})}:e}i.d(t,{$:()=>n})},80811:(e,t,i)=>{"use strict";i.d(t,{E:()=>n,Z:()=>o});const n="beta/atpsafelinks/getpolicy/",o="atp-safelinks-policy"},723506:(e,t,i)=>{"use strict";i.d(t,{c:()=>v});var n=i(740597),o=i(738646),r=i(303307),s=i(80811),a=i(50805),l=i(787623),c=i(8122),d=i(299295),u=i(974509);const m=()=>({url:s.E,method:"GET",serviceName:c.E.AtpSafelinksService,apiName:"safelink"}),g=(0,d.K)(c.E.AtpSafelinksService,{rejectHttpError:!0,allowedResponses:[u.qj.HTTP_2XX]},(e=>({getPolicy:e(m)}))),h=e=>{const t=(0,l.S)(e);return{getPolicy:p(t)}},p=e=>()=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const t=yield e(m());return yield t.body.json()}));class v{constructor(e,t,i,n,o,r){this.send=e,this.scenarioFactory=t,this.localStorage=n,this.coreSettings=o,this.logger=i.newLogger("AtpSafelinksService","services-utilities-atp-safelinks"),this.atpSafelinksServiceTransport=((e,t,i)=>{const{enableEndpointsManagerOnAtpSafelinksService:n}=i.get(a.J.Messaging);return n?t.createApi(g):h(e)})(this.send,r,this.coreSettings)}initPolicy(){return(0,n.__awaiter)(this,void 0,void 0,(function*(){const e=this.scenarioFactory.newScenario(o.RG.ATPGetPolicyTask);try{yield this.getPolicy(),e.stop()}catch(t){const i=`Error getting ATP Safelinks policy: ${t.message||""}`;this.logger.error(i),e.fail({errors:i})}}))}getPolicy(){var e;return(0,n.__awaiter)(this,void 0,void 0,(function*(){return null!==(e=this.getPolicyFromLocalStore())&&void 0!==e?e:this.getPolicyFromRemote()}))}getPolicyFromLocalStore(){let e=null;try{const t=this.localStorage.get(s.Z);if(t){const i=JSON.parse(t);(0,r.z)(i.cookie,i.webAffinitizedUrl)?e=i:this.logger.log("Invalid policy found from localStorage, fetching new policy")}}catch(e){this.logger.error(`Error while getting ATP safelinks policy from localStorage: ${e}`)}return e}getPolicyFromRemote(){var e;return(0,n.__awaiter)(this,void 0,void 0,(function*(){let t=null;const i=this.scenarioFactory.newScenario(o.RG.ATPGetPolicy);try{const n=yield this.atpSafelinksServiceTransport.getPolicy();null===(e=this.localStorage)||void 0===e||e.trySet(s.Z,JSON.stringify(n),"Messaging"),this.logger.log(`ATP Policy isATPSafelinksEnabled: ${n.isATPSafelinksEnabled}`),i.stop(),t=n}catch(e){this.logger.error(`AtpSafelinks GetPolicy API failed with Error: ${e&&e.message}`),i.fail({errors:"atp_get_policy_failed"})}return t}))}}},804589:(e,t,i)=>{"use strict";i.d(t,{aw:()=>n,ZU:()=>o,Fz:()=>r,l6:()=>s,$N:()=>a,yc:()=>l,DT:()=>c,SM:()=>d,wK:()=>u,_V:()=>m,fL:()=>g,IY:()=>h,rz:()=>p,ru:()=>v,op:()=>y,ej:()=>f,Hw:()=>S,QN:()=>b,gX:()=>w,ex:()=>_,s9:()=>T,uI:()=>I,rF:()=>j,_6:()=>N,zP:()=>E,GA:()=>x,f:()=>A,u1:()=>D,kI:()=>F,j:()=>O,Tv:()=>M,$l:()=>R});const n="TflFreProfileCardDisplayed",o="LogoutState",r="authSessionId",s="tmp.previous.silent.signin",a="in-progress",l={nopa:"2"},c={coa:"1"},d={AuthProviderLoadError:"AuthProviderLoadError",ErrorGetUserWhenAnonNotSupported:"ErrorGetUserWhenAnonNotSupported",UserNotLicensed:"Forbidden",CloudMismatch:"CloudMismatch",InitFailure:"Core-auth init failure",InteractionRequired:"InteractionRequired",UnsupportedAccountType:"UnsupportedAccountType",InvalidScopeResource:"invalid_scope",MultipleUsersPresentWithSpecifiedIdentifier:"MultipleUsersPresentWithSpecifiedIdentifier",NativeAuthModuleNotPresent:"NativeAuthModuleNotPresent",NoAccountFound:"NoAccountFound",RemoteOperationFailed:"RemoteOperationFailed",SignInRestrictions:"SignInRestrictions",SsoFirstAccountFailed:"SsoFirstAccountFailed",NoNetwork:"NoNetwork",MachineAsleep:"MachineAsleep",TenantUnredeemed:"TenantUnredeemed",ErrorCodeMissingForTenantLogin:"ErrorCodeMissingForTenantLogin",UserNotAuthenticated:"UserNotAuthenticated",UserNotFoundError:"User not found",LoginRequired:"login_required",ConsentRequired:"consent_required",PopUpWindowError:"popup_window_error",EmptyResponse:"EmptyResponse",InvalidResponse:"InvalidResponse",InvalidToken:"InvalidToken",UnsupportedParameter:"UnsupportedParameter",UserAuthNotAvailable:"UserAuthNotAvailable",MissingRequiredFields:"MissingRequiredFields",CannotUpdateCurrentAccount:"CannotUpdateCurrentAccount",FallbackWithSkypeToken:"FallbackWithSkypeToken",HiddenUserErrorForLogin:"HiddenUserErrorForLogin",MsaUserNotAllowed:"MsaUserNotAllowed",LogOutTriggeredFromCrossCloud:"Log out triggered cross cloud",AcquireTokenCloudMismatch:"AcquireTokenCloudMismatch"},u={NoNetwork:"NoNetwork",ApiContractViolation:"ApiContractViolation",UiAlreadyShowing:"Cannot sign in when UI is showing"},m="https://login.microsoftonline.com/",g=[{cloud:"prod",authority:m},{cloud:"gallatin",authority:"https://login.partner.microsoftonline.cn/"},{cloud:"dod",authority:"https://login.microsoftonline.us/"},{cloud:"gcch",authority:"https://login.microsoftonline.us/"},{cloud:"life",authority:m},{cloud:"airgap09",authority:"https://login.microsoftonline.microsoft.scloud/"},{cloud:"airgap08",authority:"https://login.microsoftonline.eaglex.ic.gov/"}],h="InteractionRequiredAuthError",p="skype-token",v="discover-user-details",y="discover-region-gtm";var f,S;!function(e){e.LOKI_TFL_AUTH_TOKEN_AUDIENCE="liveprofilecard.access",e.MT_AAD_KEY="https://api.spaces.skype.com",e.MT_KEY="middleTier",e.SKYPE_KEY="skype",e.SIGNIN_RESTRICTIONS_KEY="SignInRestrictions",e.AUTHZ_DEFAULT_BASE_URL="https://authsvc.teams.microsoft.com/v1.0/authz",e.GROUPS_SERVICE="https://groupssvc.fl.teams.microsoft.com/teams.readwrite",e.IC3_GATEWAY_CAE_KEY="https://ic3.teams.office.com",e.IC3_GATEWAY_AAD_KEY="https://ic3-non-cae.teams.office.com",e.IC3_GATEWAY_CAE_KEY_INT="https://ic3-testing.teams.office.com",e.IC3_GATEWAY_AAD_KEY_INT="https://ic3-non-cae-testing.teams.office.com"}(f||(f={})),function(e){e.openId="openId",e.profile="profile"}(S||(S={}));let k=["[auth][authserviceBack][error] Due to current app state '[isOnline=false]' cannot start retry fetch of ADAL tokens","[auth][authservice][error] Due to current app state '[isOnline=false]' cannot start retry fetch of ADAL tokens","[auth][authservice][error] Cannot start retry fetch of ADAL tokens without relogin. Rejecting token request","aborted","A silent sign-in request was sent but none of the currently signed in user(s) match the requested login hint","Cannot start retry fetch of ADAL tokens without relogin. Rejecting token request","Cannot start retry fetch of ADAL tokens, isPassive: false","Cancelling all retries due to: orchestration authenticationService_offline","Cancelling all retries due to: Relogin succeeded. Need to refresh tokens","Due to current app state cannot start retry fetch of ADAL tokens","noAccessForResource","resourceRequiresConsent","resourceDisabled","Seamless single sign on failed for the user. This can happen if the user is unable to access on premises AD or intranet zone is not configured correctly","tokenRevoked","tpmError","Webclient Auth request reached maximum timeout - 60000.","popup_window_error"];const b=e=>(e&&(k=[...k,...e]),k),w=()=>k;let C=[];const _=e=>(e&&(C=[...C,...e]),C),T=e=>C.includes(e);var I,j,N;!function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FOUR=4]="FOUR",e[e.FIVE=5]="FIVE",e[e.TEN=10]="TEN",e[e.FIFTEEN=15]="FIFTEEN",e[e.SIXTEEN=16]="SIXTEEN",e[e.TWENTYFOUR=24]="TWENTYFOUR",e[e.THIRTY=30]="THIRTY",e[e.TWO_HUNDRED_FIFTY_FIVE=255]="TWO_HUNDRED_FIFTY_FIVE"}(I||(I={})),function(e){e[e.SECONDS_PER_MINUTE=60]="SECONDS_PER_MINUTE",e[e.MINUTES_PER_HOUR=60]="MINUTES_PER_HOUR",e[e.MILLI_PER_SECOND=1e3]="MILLI_PER_SECOND",e[e.SECONDS_FIVE_MINUTES=300]="SECONDS_FIVE_MINUTES",e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.ONE_DAY=864e5]="ONE_DAY"}(j||(j={})),function(e){e.services="f8cdef31-a31e-4b4a-93e4-5f571e91255a"}(N||(N={}));const E="9188040d-6c67-4c5b-b112-36a304b66dad",x="wids",A="74ebf54e-8a4c-453c-a5ea-3ff41b70afe6",D="b44d8d43-c828-450b-9b6f-ae3788447705",F="X-MS-Migration",O=(I.TWO,j.MILLI_PER_SECOND,j.SECONDS_PER_MINUTE,{SKYPE_REQUEST:"skype_request_start",SKYPE_REQUEST_STOP:"skype_request_stop",SKYPE_SEND_REQUEST:"skype_send_request_start",SKYPE_SEND_REQUEST_STOP:"skype_send_request_stop",SKYPE_RECEIVED_RESPONSE:"skype_received_response",SKYPE_SEND_REQUEST_DESKTOP:"skype_send_request_desktop",SKYPE_SEND_REQUEST_WORKER:"skype_send_request_worker",SKYPE_TOKEN_RECEIVED_WORKER:"skype_token_received_worker",RECEIVE_CLAIM:"receive_claim"}),M={MTO:"MTO"},R={TENANTSV2:"/beta/users/tenantsv2"}},186921:(e,t,i)=>{"use strict";i.d(t,{q:()=>o});var n=i(287474);const o=new class{constructor(){this.logLevel=n.in.Info,this.localCallback=void 0,this.error=e=>this.logMessage(n.in.Error,e),this.warning=e=>this.logMessage(n.in.Warning,e),this.warn=e=>this.logMessage(n.in.Warning,e),this.info=e=>this.logMessage(n.in.Info,e),this.log=e=>this.logMessage(n.in.Info,e),this.verbose=e=>this.logMessage(n.in.Verbose,e),this.debug=e=>this.logMessage(n.in.Verbose,e)}initialize(e,t=n.in.Verbose){this.localCallback=e,this.logLevel=t}executeCallback(e,t){this.localCallback?this.localCallback(e,t):console&&console.log(t)}logMessage(e,t){if(e>this.logLevel)return;const i=`[Auth]: ${t}`;this.executeCallback(e,i)}}},176843:(e,t,i)=>{"use strict";i.d(t,{n:()=>n});class n{}n._authTelemetryCollection={},n._correlationMap={},n._userBiServiceMap={},n.getUserBiService=e=>n._userBiServiceMap[e]||n._userBiServiceMap.GLOBAL,n.setUserBiService=(e,t)=>{t?n._userBiServiceMap[e]=t:delete n._userBiServiceMap[e]},n.getAuthTelemetry=e=>n._authTelemetryCollection[e],n.setAuthTelemetry=(e,t)=>n._authTelemetryCollection[e]=t,n.delete=e=>{delete n._authTelemetryCollection[e];const t=Object.keys(n._correlationMap);for(const i in t)if(n._correlationMap.hasOwnProperty(t[i])){const o=t[i],r=n._correlationMap[o];r&&(n._correlationMap[o]=r.filter((t=>t!==e)))}},n.getCorrelation=e=>n._correlationMap[e],n.setCorrelation=e=>{if(!e.scenarioName)return;const t=n.getCorrelation(e.scenarioName)||[];-1===t.indexOf(e.id)&&t.push(e.id),n._correlationMap[e.scenarioName]=t}},210158:(e,t,i)=>{"use strict";i.d(t,{q:()=>c});var n=i(663945),o=i(186921),r=i(928665),s=i(59482),a=i(932289),l=i(176843);class c{constructor(e,t,i,c,d,u,m,g,h){var p;this._scenarioFactory=e,this._correlation=t,this._asyncAuthCache=i,this._subContext=c,this._shouldCreateScenario=d,this._isBatch=u,this._timeoutMs=m,this._telemetryService=g,this._eventData=[],this._localScenarioEventData={},this._loggingPrefix="",this.appendScenarioEventData=e=>{this._scenario&&this._scenario.appendEventData(e),this._localScenarioEventData=Object.assign(Object.assign({},this._localScenarioEventData),e)},this.addEventData=e=>{Array.prototype.push.apply(this._eventData,e)},this.getEventData=()=>[...this._eventData],this.addScenarioMark=(e,t={},i)=>{t=this._mapEventData(t,i),this._scenario?this._scenario.mark(e,t,t.status):this.addEventData([`${e}:${t.status}`]),this.logMessage(`${this._loggingPrefix} [${e}][${t.status}][scenarioEventData][${(0,r.u4)(t)}]`)},this.closeScenario=(e={},t,i,n)=>{var r;if(e=this._mapEventData(e,t),i)return e.reason&&this.addEventData([`reason:${e.reason}`]),e.errorCode&&this.addEventData([`errorCode:${e.errorCode}`]),void this.addEventData([`${this._subContext}$:${e.status}`]);if(this._isBatch&&this._correlation.scenarioName&&(this._batchScenarioStartTime&&(e.perfDelta=performance.now()-this._batchScenarioStartTime),e.correlationId=null!==(r=e.correlationId)&&void 0!==r?r:this._correlation.id,"success"===e.status?(0,s.ft)(this._scenarioFactory,this._asyncAuthCache,this._correlation.scenarioName,e,n):"failure"===e.status?(0,s.EJ)(this._scenarioFactory,this._asyncAuthCache,this._correlation.scenarioName,e,n):(0,s.vB)(this._scenarioFactory,this._asyncAuthCache,this._correlation.scenarioName,e,n)),!this._scenario){const t=this._shouldCreateScenario?o.q.warn:o.q.log,i=this._shouldCreateScenario?"[N/A]":"";return this.logEventData(t,`${this._loggingPrefix} [stop]${i} [scenarioEventData]`,e),void l.n.delete(this._correlation.id)}switch(e.status){case"incomplete":this._scenario.incomplete(e);break;case"failure":this._scenario.fail(e);break;case"abandoned":this._scenario.cancel(e);break;default:this._scenario.stop(e)}const a="failure"===e.status?o.q.error:o.q.log;this.logEventData(a,`${this._loggingPrefix} [stop][${e.status}] [e]`,e),l.n.delete(this._correlation.id)},this.createScenario=(e,t,i)=>{this._scenario?this.logMessage(`createScenario called with [${this._subContext}][${(0,r.u4)(this._correlation)}]::${e}, but there is already a scenario with that correltion id`,o.q.warn):(this._createScenario(e,i||this._timeoutMs,Object.assign(Object.assign({},this._localScenarioEventData),t)),this.logMessage(`${this._loggingPrefix} [create] - scenario created`))},this.recordAuthUserBiTelemetry=(e,t)=>{const i={panelRegion:n.Ai.main,panelType:n.wh.AuthStart,actionWorkload:n.sz.auth,actionSubworkload:n.eD.sisu,actionScenarioType:n.Yu.appAuth,actionScenario:t.scenario,actionGesture:t.actionGesture||n.uS.auto},r=l.n.getUserBiService(e||"GLOBAL");r&&r.recordPanelAction(i,o.q)},this.setUserToTelemetryContext=e=>{var t;e&&(null===(t=this._telemetryService)||void 0===t||t.setAuthContext(e),this.addScenarioMark(`${this._correlation.scenarioName}_set_user_on_telemetry_context`))},this.setUserDetailsToTelemetryContext=e=>{var t;if(e){const{region:i}=e;void 0!==i&&(null===(t=this._telemetryService)||void 0===t||t.setCoreContext("UserInfo.Region",i)),this.addScenarioMark(`${this._correlation.scenarioName}_set_tenant_details_on_telemetry_context`)}},this._mapEventData=(e,t)=>{var i;return e.subContext=e.subContext||this._subContext,(e=Object.assign(Object.assign({},this._localScenarioEventData),e)).error&&(e.error=Object.assign(Object.assign({},e.error),{message:e.error.message,errorMetaData:void 0}),e.errorCode=null!==(i=e.error.code)&&void 0!==i?i:e.error.errorCode,this.addEventData([`errorCode:${e.error.errorCode}`])),!t&&e.error&&(t=(0,a.ZG)(e.error)?"incomplete":"failure"),e.eventData=this._eventData.join(","),e.status=t||"success",e},this._createScenario=(e,t,i)=>{var n,r,s;const a=t?{timeoutMs:t}:{};this._scenario=null!==(n=this._scenarioFactory.findScenario(e))&&void 0!==n?n:this._scenarioFactory.newScenario(e,a);try{null===(s=(r=this._scenarioFactory).hoistScenarioToCore)||void 0===s||s.call(r,this._scenario)}catch(e){o.q.log(`${this._loggingPrefix} ${e.message}`)}this._scenario.appendEventData(Object.assign({secondaryCorrelationId:this._correlation.id,commandSource:this._correlation.source},i)),this._shouldCreateScenario=!0},this.loggingPrefix=()=>`[Telemetry][${this._correlation.id}][${this._correlation.scenarioName}]`,this.logEventData=(e,t,i)=>{i.error||delete i.error;const n=this.splitStringEqually((0,r.u4)(i));for(const i of n)this.logMessage(`${t}${i}`,e)},this.splitStringEqually=(e,t=300)=>{const i=new RegExp(`.{1,${t}}`,"g"),n=e.match(i);return n||[]},this.logMessage=(e,t)=>{this._isBatch||(t?t(e):o.q.log(e))},this._loggingPrefix=this.loggingPrefix(),this._isBatch&&(this._batchScenarioStartTime=performance.now()),d&&(h?this._scenario=h:(null===(p=this._correlation)||void 0===p?void 0:p.scenarioName)&&this._createScenario(this._correlation.scenarioName,this._timeoutMs,void 0)),this.logMessage(`${this._loggingPrefix} [start] - telemetry provider created for ${this._subContext}, source: ${this._correlation.source} with shouldCreateScenario: [${d}]`),this._eventData.push(`^source:${this._correlation.source},fn:${this._subContext}`)}get correlation(){return Object.assign({},this._correlation)}}},551400:(e,t,i)=>{"use strict";i.d(t,{sX:()=>l,mH:()=>u,Wn:()=>m});var n=i(740597),o=i(50805),r=i(448850);const s={access_token:{xms_cc:{values:["CP1"]}}},a=JSON.stringify(s),l=(e,t,i,n,r)=>{const l=((e,t)=>{const{caeEnabledResources:i}=(null==t?void 0:t.get(o.J.Auth))||{};return!(!e||!i||!(Array.isArray(i)&&i.findIndex((t=>e.includes(t)))>-1))})(e,r);let u=d(t,i,n);if(l&&(u=((e,t)=>{var i;if(!t)return a;try{const e=JSON.parse(t);return(null==e?void 0:e.access_token)?JSON.stringify({access_token:Object.assign(Object.assign({},e.access_token),s.access_token)}):a}catch(t){return void(null===(i=null==e?void 0:e.errorToTelemetry)||void 0===i||i.call(e,"getClaimsForRequest: Json parsing failed","auth_add_claims_to_request",void 0,!0))}})(n,u)),null==i||i.addEventData(["cp1"+((null==u?void 0:u.includes("CP1"))?"on":"off")]),t&&u&&u!==a){const e=c(u,n);e&&(null==i||i.addEventData([`claimsChallengeHeaderList:${e}`]))}return u},c=(e,t)=>{var i,o;try{const{access_token:t}=JSON.parse(e);if(t){if((null===(i=t.xms_caeerror)||void 0===i?void 0:i.value)&&!isNaN(Number(t.xms_caeerror.value))){const{xms_caeerror:e}=t,i=(0,n.__rest)(t,["xms_caeerror"]),o=`xms_caeerror_${e.value}`;return[...Object.keys(i),o].join()}return Object.keys(t).join()}return null}catch(e){return null===(o=null==t?void 0:t.errorToTelemetry)||void 0===o||o.call(t,"getClaimChallengeKeys: Json parsing failed","auth_add_claims_to_request",void 0,!0),null}},d=(e,t,i)=>{var n;if(e&&"string"==typeof e&&""!==e.trim())try{const n=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)?(0,r.G)(e):e,o=JSON.parse(n);if(o&&"object"==typeof o)return null==t||t.addEventData(["claim:"+ +!!n]),n;null==t||t.addEventData(["invalidJSON"]),null==i||i.log("Claims are not a valid json object, returning undefined.")}catch(e){null==t||t.addEventData(["base64DecodeFail"]),null===(n=null==i?void 0:i.errorToTelemetry)||void 0===n||n.call(i,"validateAndDecodeClaims: invalid base64 string input","auth_add_claims_to_request",void 0,!0)}};var u;!function(e){e.WWW_AUTHENTICATE_HEADER="www-authenticate",e.ERROR_PREFIX="error=",e.CLAIMS_PREFIX="claims=",e.INSUFFICIENT_CLAIMS="insufficient_claims"}(u||(u={}));const m=(e,t)=>{const i={error:void 0,claims:void 0},n=null==e?void 0:e[u.WWW_AUTHENTICATE_HEADER];if(!n)return i;const o=n.split(",").filter(Boolean).map((e=>e.trim()));for(const e of o){const n=e.split('"');if(3===n.length)switch(n[0].toLocaleLowerCase()){case u.ERROR_PREFIX:i.error=n[1];break;case u.CLAIMS_PREFIX:i.claims=t?n[1]:(0,r.G)(n[1])}}return i}},59482:(e,t,i)=>{"use strict";i.d(t,{Q7:()=>c,ft:()=>d,EJ:()=>u,vB:()=>m,mM:()=>g});var n=i(740597),o=i(186921),r=i(928665);const s=1e3,a="batch_",l=e=>({typeName:"BatchScenario",user:e});function c(e){const t=e.getAllOfType("User");null==t||t.forEach((t=>{try{const i={user:{tenantId:t.profile.tid,oid:t.profile.oid,accountType:t.type,userName:t.userName,id:t.id},typeName:"BatchScenario"};e.del(i)}catch(e){o.q.log("[deleteAllBatchDataFromStorage] - failed to delete batcScenario from storage")}}))}function d(e,t,i,n,o){h(e,t,`${a}${i}`,(e=>(e.successMetaData=y(n,e.successMetaData),e.successMetaData.batchScenarioCounter)),o)}function u(e,t,i,n,o){h(e,t,`${a}${i}`,(e=>(e.failureMetaData=y(n,e.failureMetaData),e.failureMetaData.batchScenarioCounter)),o)}function m(e,t,i,n,o){h(e,t,`${a}${i}`,(e=>(e.abandonedMetaData=y(n,e.abandonedMetaData),e.abandonedMetaData.batchScenarioCounter)),o)}const g=(e,t,i)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){const n=l(i),o=yield t.getValue(n);if(o){for(const t in o)if(o[t]){const n=o[t];p(e,t,n,i.id)}t.del(n)}}));function h(e,t,i,n,r){if(!r)return void o.q.log("[updateBatchScenarioCount] Unable to get batch cache key: user is not defined");const a=l(r);t.getValue(a).then((l=>{var c;const d=null!==(c=null==l?void 0:l[i])&&void 0!==c?c:{};n(d)>=s?(p(e,i,d,r.id),function(e,t,i,n){try{o.q.log(`[clearBatchScenarioFromCache] scenario: ${i}`),null==n||delete n[i],e.put(t,n)}catch(e){o.q.log(`[clearBatchScenarioFromCache] ${null==e?void 0:e.message}`)}}(t,a,i,l)):function(e,t,i,n,r){try{return r?r[i]=n:r={[i]:n},e.put(t,r),!0}catch(e){return o.q.log(`[setBatchScenarioToAuthCache] ${null==e?void 0:e.message}`),!1}}(t,a,i,d,l)}))}function p(e,t,i,n){(null==i?void 0:i.successMetaData)&&v(e,t,i.successMetaData,"success",n),(null==i?void 0:i.failureMetaData)&&v(e,t,i.failureMetaData,"failure",n),(null==i?void 0:i.abandonedMetaData)&&v(e,t,i.abandonedMetaData,"abandoned",n)}function v(e,t,i,n,s){const a=e.newScenario(t),l=(0,r.pW)();o.q.log(`[sendBatchScenario] for ${t}, status: ${n}, correlationId:${l}`);const c={accountId:s,context:"auth-telemetry-helper",secondaryCorrelationId:l,batchScenarioData:i};switch(n){case"success":a.stop(c);break;case"failure":a.fail(c);break;default:a.cancel(c)}}function y(e,t){return t?(t.batchScenarioCounter++,t.batchEventData.push(e)):t={batchScenarioCounter:1,batchEventData:[e]},t}},932289:(e,t,i)=>{"use strict";i.d(t,{Tr:()=>s,q2:()=>a,MD:()=>l,Yf:()=>c,ZG:()=>d,fj:()=>u});var n=i(804589),o=i(132756),r=i(928665);function s(e){const t=new Error(e.message);return Object.assign(t,{context:e.context,subContext:e.subContext,reason:e.reason,errorCode:e.errorCode,serverResponse:e.serverResponse,correlationId:e.correlationId,isExpected:e.isExpected,innerError:e.innerError})}const a=(e,t,i)=>{switch(e.code){case o.jK.NoNetwork:return l({name:"offlineEndPage",code:e.code,context:"authentication",subContext:"auth-webview2::_loginInternal",message:e.message,correlationId:t,isExpected:e.isExpected||!1,errorCode:e.code,innerError:e.innerError,authSubErrorCode:"OfflineError",errorMetaData:void 0});case o.jK.SignInRestrictions:return l({name:"signInRestrictionEndPage",code:e.code,context:"authentication",subContext:"auth-webview2::_loginInternal",message:e.message,correlationId:t,isExpected:e.isExpected||!1,errorCode:e.code,innerError:e.innerError,authSubErrorCode:"SignInRestriction",errorMetaData:i})}return e};function l(e){const t=new Error(e.message);return Object.assign(t,{authSubErrorCode:e.authSubErrorCode,errorMetaData:e.errorMetaData,context:e.context,subContext:e.subContext,reason:e.reason,errorCode:e.errorCode,serverResponse:e.serverResponse,correlationId:e.correlationId,isExpected:e.isExpected,innerError:e.innerError})}function c(e){return(0,n.gX)().indexOf(e)>=0}function d(e){return e&&(e.isExpected||c(e.errorCode)||!!(t=e.message)&&(0,n.gX)().map((e=>t.indexOf(e)>=0)).filter(Boolean).length>0);var t}function u(e,t,i,n=!0){let s,a,c="";switch(t){case"LicenseError":s="licenseEndPage",a="show-license-error",c=o.jK.Forbidden;break;case"SignInRestriction":s="signInRestrictionEndPage",a="show-signin-restriction-error",c=o.jK.SignInRestrictions;break;default:s="",a=""}const{name:d,email:u,pictureBlob:m,customError:g}=e;return l({authSubErrorCode:t,errorCode:c,errorMetaData:{accountId:i,name:d,email:u,pictureBlob:m,userLoggedIn:n},name:s,message:(null==g?void 0:g.message)||"",correlationId:(null==g?void 0:g.correlationId)||(0,r.pW)(),context:(null==g?void 0:g.context)||"endPageDataToAuthError",subContext:(null==g?void 0:g.subContext)||a})}},747741:(e,t,i)=>{"use strict";i.d(t,{pZ:()=>g,eH:()=>h,Qk:()=>p,JX:()=>S,xT:()=>k,ce:()=>C,Ay:()=>_});var n=i(740597),o=i(287474),r=i(466094),s=i(738646),a=i(50805),l=i(551400),c=i(804589),d=i(403084),u=i(928665);const m=c.uI.TWENTYFOUR*c.rF.ONE_HOUR;function g(e,t,i,s,d,u,m,g,h){var p;return(0,n.__awaiter)(this,void 0,void 0,(function*(){let n=o.Zw.Skype;const[v,b]=I(t,g),{forceRenew:w,tokenToRenew:j}=h||{};let N=!1,{ic3NonCaeResource:E,ic3CaeResource:x}=d.get(a.J.Auth);E||(E=c.ej.IC3_GATEWAY_AAD_KEY),x||(x=c.ej.IC3_GATEWAY_CAE_KEY),N=(null===(p=yield i.getUser())||void 0===p?void 0:p.type)===r.Ch.Anonymous,null==v||v.addScenarioMark("ic3-gateway-token-helper-get-token-start",{commandSource:t,context:`preferredTokenTypes: ${e.map((e=>o.Zw[e]))}`});const A=N?o.Zw.Skype:k(t,d);let D;if(null==v||v.addScenarioMark("ic3-gateway-token-helper-get-token-type-from-config",{commandSource:t,context:`SupportedTokenType: ${o.Zw[A]}`}),!N&&void 0!==u){const e="WWW-Authenticate",n=u.get(e);if(n){let e;if(null==v||v.addScenarioMark("ic3-gateway-token-helper-parse-www-authn-header",{commandSource:t,context:"WWW-Authenticate headers present: true"}),void 0!==(e=T(n))){const t=(0,l.sX)(x,e,v,m,d);return f(x,o.Zw.CAE,i,v,b,t)}C(n)&&(null==v||v.addScenarioMark("ic3-gateway-token-helper-parse-www-authn-header",{commandSource:t,context:"isSkypeTokenMigrationHeader: true"}),D=_(n),null==v||v.addScenarioMark("ic3-gateway-token-helper-header-is-stm",{commandSource:t,context:`protocolFromHeader: ${o.Zw[D]}`}))}}switch(n=N?o.Zw.Skype:S(e,A,D),null==v||v.addScenarioMark("ic3-gateway-token-helper-protocol-to-use",{commandSource:t,context:`protocolToUse: ${o.Zw[n]}`}),n){case o.Zw.Skype:return y(s,v,b,w);case o.Zw.AAD:return f(E,n,i,v,b,void 0,j);case o.Zw.CAE:return f(x,n,i,v,b);default:throw null==b||b({authEventData:"ic3-gateway-token-helper-get-token-end",reason:"Cannot determine protocol to use.",status:"failure"}),new Error(`cannot determine protocol to use. ${e}, ${t}, ${i}, ${s}, ${d}, ${u}`)}}))}const h=(e,t,i)=>{if(!e||!t)return;const n=e.get(t);if(n){if(!v(n.fallbackTime,i))return n.tokenType;e.delete(t)}},p=(e,t,i)=>{e&&t&&void 0!==i&&e.set(t,{tokenType:i,fallbackTime:(new Date).getTime()})},v=(e,t)=>{const{stmFallbackMapTimerInHr:i}=t.get(a.J.Auth),n=i?i*c.rF.ONE_HOUR:m;return(new Date).getTime()-e>n},y=(e,t,i,r)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{null==t||t.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-start",{authEventData:`forceRenew: ${r}`}),yield e.validateSkypeToken({forceRenew:r});const n=yield e.getSkypeTokenInfoFromDiscoveryResponse(),s=Object.assign({},n);return s.expiration=Math.round(s.expiration/c.rF.MILLI_PER_SECOND),null==t||t.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-end",{authEventData:`expiry in seconds: ${s.expiration}`,message:`expiry in seconds: ${s.expiration}`,status:"success"}),null==i||i(),{token:s,tokenType:o.Zw.Skype}}catch(e){throw null==t||t.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-end",{error:e,status:"failure"}),null==i||i({error:e}),e}})),f=(e,t,i,o,r,s,a)=>(0,n.__awaiter)(void 0,void 0,void 0,(function*(){try{if(null==o||o.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-start",{authEventData:`resource: ${e}, tokenToRenew: ${!!a}`}),i.acquireTokenV2){const n=Object.assign({tflClaim:a},void 0!==s&&{claim:s}),l=yield i.acquireTokenV2(e,n),d=Date.now(),u=((null==l?void 0:l.expires)-c.rF.SECONDS_PER_MINUTE)*c.rF.MILLI_PER_SECOND;return u<=d&&(null==o||o.addScenarioMark("ic3-gateway-token-helper-retry-aad-token-expiry-offset",{authEventData:`resource: ${e}, expiry in seconds: ${l.expires}, now: ${d}, time_diff: ${u-d}, fromCache: ${l.fromCache}`,message:`resource: ${e}, expiry in seconds: ${l.expires}, now: ${d}, time_diff: ${u-d}, fromCache: ${l.fromCache}`})),null==o||o.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-end",{authEventData:`resource: ${e}, expiry_AuthService: ${l.expires}, fromCache: ${l.fromCache}`,message:`resource: ${e}, expiry_AuthService: ${l.expires}, fromCache: ${l.fromCache}`,status:"success"}),null==r||r(),{token:l,tokenType:t}}throw null==r||r({authEventData:`resource: ${e}`,reason:"IAuthenticationService does not have acquireTokenV2",status:"failure"}),new Error("IAuthenticationService does not have acquireTokenV2")}catch(t){throw null==o||o.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-end",{authEventData:`resource: ${e}`,status:"failure",error:t}),null==r||r({error:t}),t}})),S=(e,t,i)=>{e.sort(((e,t)=>t-e));const n=[e[0],t];return void 0!==i&&n.push(i),n.sort(((e,t)=>e-t)),n[0]},k=(e,t,i,n)=>{if(void 0===e||void 0===t||(null==n?void 0:n.type)===r.Ch.Anonymous)return o.Zw.Skype;const{skypeTokenMigrationServiceInfo:s}=t.get(a.J.Auth),l=null==s?void 0:s.find((t=>(null==t?void 0:t.source)===e));if(void 0===l)return o.Zw.Skype;null==i||i.addEventData([`source: ${null==l?void 0:l.source}, isOnboarded: ${null==l?void 0:l.isOnboarded},type: ${null==l?void 0:l.tokenType}`]);const c=null==l?void 0:l.isOnboarded,d=null==l?void 0:l.tokenType;return c&&d?b(d):o.Zw.Skype},b=e=>{switch(e){case"Skype":return o.Zw.Skype;case"AAD":return o.Zw.AAD;case"CAE":return o.Zw.CAE}return e};var w;!function(e){e.TOKEN_TYPES="token_types="}(w||(w={}));const C=e=>e&&e.indexOf(w.TOKEN_TYPES)>-1&&e.indexOf(o.hO.BEARER)>-1,_=e=>{const t=null==e?void 0:e.toLowerCase();return(null==t?void 0:t.indexOf("cae"))>-1?o.Zw.CAE:(null==t?void 0:t.indexOf("aad"))>-1?o.Zw.AAD:(null==t||t.indexOf("skype"),o.Zw.Skype)},T=e=>{const t={[l.mH.WWW_AUTHENTICATE_HEADER]:e},i=(0,l.Wn)(t);return i&&i.error===l.mH.INSUFFICIENT_CLAIMS?i.claims:void 0},I=(e,t)=>{const i=s.RG.GetIC3GatewayToken,n={id:void 0!==t?t:(0,u.pW)(),scenarioName:i,source:e};try{const[e,t]=(0,d.OU)({options:{correlation:n},source:"ic3-gateway-token-helper",scenarioName:i,subContext:"ic3-gateway-token-helper::getIC3GateWayToken",startWithoutScenario:!1});return[e,t]}catch(e){return[void 0,void 0]}}},921961:(e,t,i)=>{"use strict";i.d(t,{I:()=>o});var n=i(446652);function o(e,t){var i;const o=null!==(i=null==t?void 0:t.clientTypeServiceHeader)&&void 0!==i?i:e.config.clientType,r=null==t?void 0:t.embedContext;return o===n.Bh.CDLWorker?n.Bh.CDLWorker:o===n.Bh.Embed&&r?`${n.Bh.Embed}-${r}`:o}},448850:(e,t,i)=>{"use strict";i.d(t,{J:()=>r,G:()=>s});var n=i(905581),o=i(132756);function r(e){if(!e)throw(0,n.Tr)(o.w5.Authentication,o.jK.InvalidInput,"parseJWT",void 0,`invalid token, value = ${e}`);try{const[,t]=e.split("."),i=s(t);return JSON.parse(i)}catch(t){throw(0,n.Tr)(o.w5.Authentication,o.jK.InvalidInput,"parseJWT",{innerError:t},`token contains dot = ${e.includes(".")}; token length = ${e.length}`)}}function s(e){if(!e)throw(0,n.Tr)(o.w5.Authentication,o.jK.InvalidInput,"base64DecodeStringUrlSafe",void 0,`invalid base64 string input, value = ${e}`);return e=e.replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(atob(e)))}},458561:(e,t,i)=>{"use strict";i.d(t,{g:()=>o});var n=i(74583);const o=(e,t)=>{if((0,n.isArray)(e))return t}},995344:(e,t,i)=>{"use strict";function n(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}i.d(t,{z:()=>n})},844729:(e,t,i)=>{"use strict";i.d(t,{h:()=>r});var n=i(8122),o=i(921961);function r(e,t,i,r){return{[n.f.xMsClientType]:(0,o.I)(e,t),[n.f.xMsClientVersion]:e.config.clientVersion,[n.f.xMsSessionId]:e.host.sessionId,[n.f.xMsRequestId]:i||"",[n.f.xMsClientCaller]:r||""}}},726727:(e,t,i)=>{"use strict";var n,o,r;i.d(t,{gT:()=>n,lP:()=>o,ej:()=>r}),function(e){e[e.Two=2]="Two",e[e.FOUR=4]="FOUR",e[e.FIVE=5]="FIVE",e[e.FIFTEEN=15]="FIFTEEN",e[e.TWENTY_FOUR=24]="TWENTY_FOUR",e[e.THIRTY=30]="THIRTY",e[e.ONE_HUNDRED=100]="ONE_HUNDRED",e[e.SECONDS_PER_MINUTE=60]="SECONDS_PER_MINUTE",e[e.MINUTES_PER_HOUR=60]="MINUTES_PER_HOUR",e[e.MILLI_PER_SECOND=1e3]="MILLI_PER_SECOND",e[e.MILLI_PER_MINUTE=6e4]="MILLI_PER_MINUTE",e[e.MILLISECONDS_PER_HOUR=36e5]="MILLISECONDS_PER_HOUR",e[e.MILLISECONDS_PER_DAY=864e5]="MILLISECONDS_PER_DAY"}(n||(n={})),function(e){e[e.LOAD_FRAME_TIMEOUT=15e3]="LOAD_FRAME_TIMEOUT",e[e.EXPIRE_OFFSET_SECONDS=600]="EXPIRE_OFFSET_SECONDS",e[e.MT_TOKEN_INTERVAL=12e4]="MT_TOKEN_INTERVAL",e[e.ACQUIRE_TOKEN_TIMEOUT=6e4]="ACQUIRE_TOKEN_TIMEOUT",e[e.DEFAULT_ACQUIRE_TOKEN_MAX_RETRIES=3]="DEFAULT_ACQUIRE_TOKEN_MAX_RETRIES",e[e.DEFAULT_ACQUIRE_TOKEN_RETRY_WINDOW=3e4]="DEFAULT_ACQUIRE_TOKEN_RETRY_WINDOW",e[e.DEFAULT_ACQUIRE_TOKEN_BACKOFF_TIME=2e3]="DEFAULT_ACQUIRE_TOKEN_BACKOFF_TIME",e[e.ELECTRON_ACQUIRE_TOKEN_TIMEOUT=22e4]="ELECTRON_ACQUIRE_TOKEN_TIMEOUT",e[e.ACQUIRE_TOKEN_SCENARIO_TIMEOUT=24e4]="ACQUIRE_TOKEN_SCENARIO_TIMEOUT",e[e.DEFAULT_SKYPE_MAX_DELAY_TIME_MS=3e4]="DEFAULT_SKYPE_MAX_DELAY_TIME_MS",e[e.DEFAULT_SKYPE_MAX_RETRY_DURATION_MS=15e3]="DEFAULT_SKYPE_MAX_RETRY_DURATION_MS",e[e.DEFAULT_SKYPE_MAX_RETRY_COUNT=3]="DEFAULT_SKYPE_MAX_RETRY_COUNT",e[e.DEFAULT_SKYPE_MIN_RETRY_INTERVAL_MS=1e3]="DEFAULT_SKYPE_MIN_RETRY_INTERVAL_MS",e[e.DEFAULT_SKYPE_EXP_DELAY_FACTOR=2]="DEFAULT_SKYPE_EXP_DELAY_FACTOR",e[e.DEFAULT_REGION_GTM_MIN_LENGTH=10]="DEFAULT_REGION_GTM_MIN_LENGTH"}(o||(o={})),function(e){e.LOKI_TFL_AUTH_TOKEN_AUDIENCE="liveprofilecard.access",e.MT_AAD_KEY="https://api.spaces.skype.com",e.MT_KEY="middleTier",e.SKYPE_KEY="skype",e.AUTHZ_DEFAULT_BASE_URL="https://authsvc.teams.microsoft.com/v1.0/authz",e.GROUPS_SERVICE="https://groupssvc.fl.teams.microsoft.com/teams.readwrite",e.UNIFIED_CONSENT_WEB_AUTH_URL="https://consentservice.microsoft.com/web/UnifiedUserConsent.ReadWrite",e.UNIFIED_CONSENT_CHECKIN_AUTH_URL="https://consentservice.microsoft.com/checkin/UnifiedUserConsent.Read",e.CSA_PHONELINK_AUTH_URL="https://chatsvcagg-tfl.teams.microsoft.com/user_impersonation"}(r||(r={}))},820140:(e,t,i)=>{"use strict";i.d(t,{WD:()=>n,av:()=>o,ax:()=>r,Hs:()=>s,nC:()=>a,bM:()=>l});const n="mainAppWindowActiveEntities",o="appActiveEntitiesHistory",r="mainWindowNavHistory",s="mainWindowNavHistoryIndex",a=e=>{const t=["mainAppWindowActiveEntities","mainWindowNavHistory","mainWindowNavHistoryIndex"];return e&&t.push(`${e}-mainAppWindowActiveEntities`,`${e}-mainWindowNavHistory`,`${e}-mainWindowNavHistoryIndex`),t},l=(e,t)=>`${t?`${t}-`:""}${e}`},649247:(e,t,i)=>{"use strict";i.d(t,{q:()=>n});const n=e=>e instanceof Date&&!isNaN(e.getTime())},375754:(e,t,i)=>{"use strict";i.d(t,{H:()=>l,c:()=>c});var n=i(740597),o=i(328942),r=i(132756),s=i(738646),a=i(928665);const l="serviceId";class c{constructor(e,t,i,s,a,l){this.rebootService=e,this.host=t,this.logger=i,this.authenticationService=s,this.localStorage=a,this.experienceConfig=l,this.switchRing=e=>(0,n.__awaiter)(this,void 0,void 0,(function*(){yield this.clearCachedIndexFile();const t={qsps:{ring:e}};this.rebootService.rebootApp(o.Z.RingSwitch,o.d.DeveloperSwitchersService,t)})),this.clearContainer=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){yield this.clearCachedIndexFile();this.rebootService.rebootApp(o.Z.ClearContainer,o.d.DeveloperSwitchersService,{qsps:{clearcontainer:"true"}})})),this.clearCachedIndexFile=()=>(0,n.__awaiter)(this,void 0,void 0,(function*(){var e;try{if(void 0!==this.host.caches){const t=yield this.host.caches.open(r.eL);yield t.delete(`/${null===(e=this.experienceConfig)||void 0===e?void 0:e.basePath}/`)}}catch(e){this.logger.error(`Clear cached index file before switching ring failed with error: ${e}`)}}))}switchService(e){var t,i,o,r;return(0,n.__awaiter)(this,void 0,void 0,(function*(){if(this.logger.log(`Switch service to ${e}`),this.authenticationService.logout){const n=this.localStorage.get(l,"Experience")||void 0;this.localStorage.trySet(l,e,"Framework","Experience");const o=`logging out user to switch to service ${e}`;null===(i=(t=this.logger).infoToTelemetry)||void 0===i||i.call(t,o,"service_switch",{currentState:n,newState:e},!0);const r={id:(0,a.pW)(),source:"developer-switchers-resolvers",scenarioName:s.RG.AuthWebLogout};return yield this.authenticationService.logout({reason:o,correlation:r}),Promise.resolve(!0)}const n="authenticationService.logout not implemented!";return null===(r=(o=this.logger).errorToTelemetry)||void 0===r||r.call(o,n,"service_switch",{newState:e,error:n},!0),Promise.resolve(!1)}))}}},68950:(e,t,i)=>{"use strict";i.d(t,{gD:()=>u,fM:()=>m});var n=i(298117),o=i(475230);const r=new RegExp(o.yH.oneNoteTargetRegex),s=new RegExp(o.yH.oneNoteSectionRegex),a=e=>{const t=r.exec(e);let i="";return t&&(i=t[1]),i},l=e=>{const t=s.exec(e);let i="";return t&&(i=t[1]),i},c=new RegExp(o.yH.oneDriveFile),d=new RegExp(o.yH.sharePointFile),u=(e,t,i)=>{const r=(0,n.Q)(e),s=r?r.replace(o.yH.trailingSlashRegex,""):"";let a=null;if(c.test(e)){a={sourceTeamName:o.HV.personal,sourceChannelName:s.split("/").pop()}}else if(d.test(e)){const t=s.split("/").pop()||"",i=2;a={sourceTeamName:decodeURIComponent(t),sourceChannelName:decodeURIComponent(e.substring(s.length-1).split("/")[i])}}if(t===o.BY.extension&&-1!==(null==i?void 0:i.indexOf(o.BY.extensionWithDot))){const e=h(i);(null==e?void 0:e.sectionGroup)&&a&&(a.sourceChannelName=`${a.sourceChannelName} > ${e.sectionGroup}`),(null==e?void 0:e.section)&&a&&(a.sourceChannelName=`${a.sourceChannelName} > ${e.section}`)}return a},m=(e,t)=>{let i=null;const n=decodeURIComponent(e);let o=a(n),r=l(o),s="";if(r.includes("/")){const e=r.lastIndexOf("/");o=o.substring(e+1),r=r.substring(e+1)}r=g(r);const c=t;t=r;const d=o.indexOf("/");if(-1!==d){const e=o.lastIndexOf("|");let i=o.substring(d+1,e);i=g(i),t=i,s=r}return i={title:t,noteBook:c,section:s},i},g=e=>e.replace(/(?:\\(.))/g,"$1"),h=e=>{let t=null,i="",n="",o="";e&&(i=decodeURIComponent(e));let r=a(i),s=l(r);if(s.includes("/")){const e=s.lastIndexOf("/");if(o=s.substring(0,e),o){const e=o.split("/");let t="";e.forEach((e=>{t=""===t?e:`${t} > ${e}`})),o=t}r=r.substring(e+1),s=s.substring(e+1)}return-1!==r.indexOf("/")&&(n=s),t={sectionGroup:g(o),section:g(n)},t}},402750:(e,t,i)=>{"use strict";i.d(t,{V:()=>a});var n=i(514958),o=i(385589),r=i(475230),s=i(905581);const a=(e,t,i)=>{const a=c(e),d=(0,s.O$)(e,n.z.internalErrorCode),u=(0,s.O$)(e,n.z.httpCode,(null==e?void 0:e.code)||d||""),m={errorMessage:a,serverRequestId:(0,s.O$)(e,n.z.correlationId)};t(a),(0,o.X)(parseInt(u||"",10))&&!l(parseInt(u||"",10),d)?i&&i.fail({errors:JSON.stringify(m),errorCode:`${u}`}):i&&i.incomplete({errors:JSON.stringify(m),errorCode:`${u||r.BS.Unhandled}`})},l=(e,t)=>e&&e===r.Bx.badRequest&&t&&t===r.BS.InvalidRequest,c=e=>{let t=(0,s.O$)(e,n.z.logErrorMessage,(null==e?void 0:e.message)||"");const i=(0,s.O$)(e,"innerError",{message:""});t=`${t}. ${i?i.message:""}`;const o={context:null==e?void 0:e.context,subContext:null==e?void 0:e.subContext};return t=`${t}. ${JSON.stringify(o)}`,t}},596025:(e,t,i)=>{"use strict";i.d(t,{qB:()=>n,rF:()=>o,IJ:()=>r,Zw:()=>s});const n={SSO_TOKEN:"OutlookSSOToken",ADDIN_ERROR:"OutlookAddInError",SSO_READY:"OutlookSSOReady",USE_CACHED_SSO_TOKEN:"OutlookUseCachedSSOToken",SSO_COMPLETE_TIME:"OutlookSSOCompleteTime",DIALOG_TRIGGER_TIME:"OutlookDialogTriggerTime",CONTEXT:"STTOutlookContext",STEP_MARKERS:"STTOutlookStepMarkers",AUTH_STRAP_ERROR:"STTOutlookAuthStrapError",AUTH_STRAP_REDIRECT_TIME:"STTOutlookAuthStrapRedirect",OAUTH_START_TIME:"OutlookOAuthStartTime",OAUTH_ELAPSED_TIME:"OutlookOAuthElapsedTime",PLATFORM_INFO:"OutlookPlatformInfo",STT_START_TIME:"STTExperienceStartTime"};var o,r,s;!function(e){e[e.HOURS_PER_DAY=24]="HOURS_PER_DAY",e[e.MINUTES_PER_HOUR=60]="MINUTES_PER_HOUR",e[e.SECONDS_PER_MINUTE=60]="SECONDS_PER_MINUTE",e[e.MILLISECS_PER_SECOND=1e3]="MILLISECS_PER_SECOND",e[e.TOKEN_EXP_MINUTE=10]="TOKEN_EXP_MINUTE",e[e.SSO_TIMEOUT_MILLISEC=7e3]="SSO_TIMEOUT_MILLISEC",e[e.SSO_RETRY_INTERVAL=100]="SSO_RETRY_INTERVAL",e[e.SSO_CLAIM_TIMEOUT_MINUTES=5]="SSO_CLAIM_TIMEOUT_MINUTES",e[e.SSO_CLAIM_TIMEOUT_MILLISEC=3e5]="SSO_CLAIM_TIMEOUT_MILLISEC",e[e.SSO_CLAIM_RETRY_INTERVAL=1e3]="SSO_CLAIM_RETRY_INTERVAL",e[e.STT_USAGE_EXPIRATION_DAYS=15]="STT_USAGE_EXPIRATION_DAYS",e[e.STT_USAGE_EXPIRATION_MILLISEC=1296e6]="STT_USAGE_EXPIRATION_MILLISEC"}(o||(o={})),function(e){e.NotProvided="NotProvided",e.Expired="Expired",e.Valid="Valid",e.Invalid="Invalid"}(r||(r={})),function(e){e.SSO="SSO",e.OAuth="OAuth"}(s||(s={}))},929778:(e,t,i)=>{"use strict";i.d(t,{j:()=>s});var n=i(697594),o=i(248187),r=i(130757);const s=(e,t,i,s)=>(0,n.z)((0,o.R)(((i,n)=>Array.from(function*(e,t,i,n){const o=e[Symbol.iterator](),r=t[Symbol.iterator]();let s=o.next(),a=r.next();for(;!a.done||!s.done;)a.done||!s.done&&a.value.id>s.value[0].id?(n(s.value[1]),s=o.next()):s.done||a.value.id<s.value[0].id?(yield[a.value,i(a.value)],a=r.next()):(yield[a.value,s.value[1]],s=o.next(),a=r.next())}(i,Array.from(n).sort(((e,t)=>e.id.localeCompare(t.id))),(t=>{try{return{type:"value",value:e(t)}}catch(e){return s&&s(t,e),{type:"error",error:e}}}),(e=>{if("error"!==e.type)return t(e.value)})))),[]),(0,r.U)((e=>e.filter((e=>"value"===e[1].type)).map((e=>i(e[0],e[1].value))))))},535151:(e,t,i)=>{"use strict";i.d(t,{as:()=>n});const n=(e,t)=>{if(e.is(t))return t;throw new TypeError}},643133:(e,t,i)=>{"use strict";i.d(t,{Sq:()=>n,wX:()=>o,hq:()=>r,OE:()=>s,ZU:()=>a,If:()=>l,cQ:()=>c,an:()=>d,JH:()=>u});const n="video-message",o="video-message-gc",r="Creation-Epoch",s=(e,t)=>{const i=parseInt(t||"",10);return isNaN(i)||e-i>144e5},a=(e,t)=>e-t>2592e5,l=e=>d(e,"videoBlob"),c=e=>d(e,"thumbnailBlob"),d=(e,t)=>`${n}?cacheId=${e}&type=${t}`,u=e=>{try{const t=new URL(e);if(t.pathname.slice(Math.max(0,t.pathname.length-n.length))!==n)return;const i=t.searchParams.get("cacheId"),o=t.searchParams.get("type"),r="videoBlob"===o||"thumbnailBlob"===o?o:void 0;return i&&r?{cacheId:i,type:r}:void 0}catch(e){return}}},122057:(e,t,i)=>{var n={"./ar-sa/activity.js":[298228,625622],"./ar-sa/artifacts-platform.js":[88162,134508],"./ar-sa/audience-view-dialog.js":[888145,158571],"./ar-sa/auth.js":[595308,625622],"./ar-sa/autosuggest.js":[543117,625622],"./ar-sa/avatar.js":[607748,625622],"./ar-sa/biometric-enrollment.js":[772192,575363],"./ar-sa/breakout-rooms.js":[992492,384177],"./ar-sa/broadcast.js":[567708,410412],"./ar-sa/calendar.js":[864153,642143],"./ar-sa/calling.js":[195108,396624],"./ar-sa/campaign-notifications.js":[191240,625622],"./ar-sa/carousel-multi-card.js":[null],"./ar-sa/cast.js":[74267,625622],"./ar-sa/channels.js":[141251,625622],"./ar-sa/chat-list.js":[445002,625622],"./ar-sa/coach-report.js":[660310,690514],"./ar-sa/comment-stream.js":[413591,403734],"./ar-sa/communities.js":[336272,625622],"./ar-sa/compose.js":[548512,625622],"./ar-sa/contacts.js":[637084,625622],"./ar-sa/datepicker.js":[316194,682989],"./ar-sa/desktop.js":[null],"./ar-sa/digital-signage.js":[null],"./ar-sa/discover-surface.js":[475585,170918],"./ar-sa/edu.js":[934064,73297],"./ar-sa/embed.js":[113687,625622],"./ar-sa/errors.js":[530122,625622],"./ar-sa/esp.js":[601750,210828],"./ar-sa/extensibility-ptz-extension.js":[null],"./ar-sa/extensibility-room-remote.js":[null],"./ar-sa/extensibility.js":[114969,625622],"./ar-sa/feedback.js":[749779,237598],"./ar-sa/files.js":[832242,625622],"./ar-sa/framework.js":[6173,625622],"./ar-sa/freemium-upgrade.js":[null],"./ar-sa/freemium.js":[922242,396624],"./ar-sa/funstuff.js":[137745,122675],"./ar-sa/gallery.js":[358430,374917],"./ar-sa/growth.js":[282773,625622],"./ar-sa/guardians.js":[975917,841795],"./ar-sa/health.js":[78071,808438],"./ar-sa/help.js":[null],"./ar-sa/hololens.js":[500181,396624],"./ar-sa/host-controls.js":[5994,262667],"./ar-sa/jana.js":[276413,707481],"./ar-sa/lightbox.js":[405856,625622],"./ar-sa/live-persona-card.js":[435088,625622],"./ar-sa/live-persona-editor.js":[608250,698249],"./ar-sa/lms-integration.js":[null],"./ar-sa/meet-for-work.js":[119432,149974],"./ar-sa/meeting-analytics.js":[179106,600629],"./ar-sa/meeting-apis-app.js":[null],"./ar-sa/meeting-bot.js":[null],"./ar-sa/meeting-collaboration.js":[814319,528749],"./ar-sa/meeting-flyout.js":[363053,625622],"./ar-sa/meeting-meet-app.js":[3367,625622],"./ar-sa/meeting-options.js":[325264,608656],"./ar-sa/meeting-recap.js":[273372,9143],"./ar-sa/meeting-room-console.js":[null],"./ar-sa/meeting-stream-app.js":[null],"./ar-sa/message-escalate-dialog.js":[781308,614542],"./ar-sa/messaging.js":[185498,625622],"./ar-sa/mobile-attach.js":[null],"./ar-sa/mtma-missed-notifications.js":[990846,625622],"./ar-sa/nova.js":[874036,625622],"./ar-sa/people-app.js":[null],"./ar-sa/people-picker.js":[591045,625622],"./ar-sa/people-targeting.js":[967062,995682],"./ar-sa/people.js":[1227,625622],"./ar-sa/person.js":[748843,625622],"./ar-sa/phonelink-sms.js":[629996,763045],"./ar-sa/pre-core.js":[null],"./ar-sa/premium-benefits.js":[805199,614133],"./ar-sa/presence.js":[703038,625622],"./ar-sa/queues.js":[67334,723966],"./ar-sa/recurrence.js":[738554,396362],"./ar-sa/rsc-application-permissions.js":[null],"./ar-sa/search.js":[212523,682989],"./ar-sa/semantic-object.js":[256916,504317],"./ar-sa/settings.js":[19448,625622],"./ar-sa/share-in-meetings.js":[null],"./ar-sa/share-to-teams-outlook-addin.js":[null],"./ar-sa/share-to-teams-third-party.js":[null],"./ar-sa/share-to-teams.js":[455594,574853],"./ar-sa/shortcut.js":[307893,625622],"./ar-sa/shortcuts.js":[594776,625622],"./ar-sa/simple-collab.js":[412227,625622],"./ar-sa/smart-device.js":[null],"./ar-sa/survey.js":[271363,434287],"./ar-sa/sv-flyout.js":[742358,625622],"./ar-sa/teams-and-channels.js":[364241,715523],"./ar-sa/teams-insider.js":[574280,625622],"./ar-sa/telemetry.js":[426556,625622],"./ar-sa/tfl-homepage.js":[262728,625622],"./ar-sa/tfl-onboarding.js":[954278,625622],"./ar-sa/toast-notifications.js":[223006,625622],"./ar-sa/trusted-ui.js":[null],"./ar-sa/unified-search.js":[295939,574853],"./ar-sa/unsupported-browser.js":[null],"./ar-sa/url-preview.js":[622171,625622],"./ar-sa/video-capture.js":[21592,364091],"./ar-sa/video-message.js":[131535,751789],"./ar-sa/virtual-consumer-events.js":[542348,164269],"./ar-sa/virtual-events.js":[385164,534918],"./ar-sa/webinar.js":[987909,369621],"./ar-sa/welcome-bot.js":[null],"./ar-sa/whats-new.js":[126945,625622],"./ar-sa/wiki.js":[null],"./az-latn-az/activity.js":[687364,451822],"./az-latn-az/artifacts-platform.js":[111918,323871],"./az-latn-az/audience-view-dialog.js":[573645,88553],"./az-latn-az/auth.js":[430280,451822],"./az-latn-az/autosuggest.js":[12614,451822],"./az-latn-az/avatar.js":[455166,451822],"./az-latn-az/biometric-enrollment.js":[312605,896555],"./az-latn-az/breakout-rooms.js":[37296,790149],"./az-latn-az/broadcast.js":[242698,212243],"./az-latn-az/calendar.js":[784508,572324],"./az-latn-az/calling.js":[23929,997686],"./az-latn-az/campaign-notifications.js":[144149,451822],"./az-latn-az/carousel-multi-card.js":[null],"./az-latn-az/cast.js":[429021,451822],"./az-latn-az/channels.js":[892980,451822],"./az-latn-az/chat-list.js":[935940,451822],"./az-latn-az/coach-report.js":[77752,551052],"./az-latn-az/comment-stream.js":[389229,914557],"./az-latn-az/communities.js":[971158,451822],"./az-latn-az/compose.js":[459118,451822],"./az-latn-az/contacts.js":[609885,451822],"./az-latn-az/datepicker.js":[877411,580016],"./az-latn-az/desktop.js":[null],"./az-latn-az/digital-signage.js":[null],"./az-latn-az/discover-surface.js":[157995,953303],"./az-latn-az/edu.js":[581861,375543],"./az-latn-az/embed.js":[125631,451822],"./az-latn-az/errors.js":[455173,451822],"./az-latn-az/esp.js":[34051,705406],"./az-latn-az/extensibility-ptz-extension.js":[null],"./az-latn-az/extensibility-room-remote.js":[null],"./az-latn-az/extensibility.js":[639092,451822],"./az-latn-az/feedback.js":[612295,170418],"./az-latn-az/files.js":[305138,451822],"./az-latn-az/framework.js":[967296,451822],"./az-latn-az/freemium-upgrade.js":[null],"./az-latn-az/freemium.js":[985993,997686],"./az-latn-az/funstuff.js":[304579,850506],"./az-latn-az/gallery.js":[13550,188146],"./az-latn-az/growth.js":[471030,451822],"./az-latn-az/guardians.js":[615265,706767],"./az-latn-az/health.js":[384375,386032],"./az-latn-az/help.js":[null],"./az-latn-az/hololens.js":[381837,997686],"./az-latn-az/host-controls.js":[443087,776357],"./az-latn-az/jana.js":[223783,398056],"./az-latn-az/lightbox.js":[463515,451822],"./az-latn-az/live-persona-card.js":[20600,451822],"./az-latn-az/live-persona-editor.js":[490024,306031],"./az-latn-az/lms-integration.js":[null],"./az-latn-az/meet-for-work.js":[292367,391829],"./az-latn-az/meeting-analytics.js":[175229,469482],"./az-latn-az/meeting-apis-app.js":[null],"./az-latn-az/meeting-bot.js":[null],"./az-latn-az/meeting-collaboration.js":[869178,461215],"./az-latn-az/meeting-flyout.js":[893412,451822],"./az-latn-az/meeting-meet-app.js":[309995,451822],"./az-latn-az/meeting-options.js":[884935,983695],"./az-latn-az/meeting-recap.js":[143912,70849],"./az-latn-az/meeting-room-console.js":[null],"./az-latn-az/meeting-stream-app.js":[null],"./az-latn-az/message-escalate-dialog.js":[767625,870902],"./az-latn-az/messaging.js":[146971,451822],"./az-latn-az/mobile-attach.js":[null],"./az-latn-az/mtma-missed-notifications.js":[77989,451822],"./az-latn-az/nova.js":[549160,451822],"./az-latn-az/people-app.js":[null],"./az-latn-az/people-picker.js":[257045,451822],"./az-latn-az/people-targeting.js":[33099,424677],"./az-latn-az/people.js":[193730,451822],"./az-latn-az/person.js":[643245,451822],"./az-latn-az/phonelink-sms.js":[34067,257164],"./az-latn-az/pre-core.js":[null],"./az-latn-az/premium-benefits.js":[345927,868532],"./az-latn-az/presence.js":[599444,451822],"./az-latn-az/queues.js":[202888,427903],"./az-latn-az/recurrence.js":[981881,724092],"./az-latn-az/rsc-application-permissions.js":[null],"./az-latn-az/search.js":[456853,580016],"./az-latn-az/semantic-object.js":[986718,770293],"./az-latn-az/settings.js":[144439,451822],"./az-latn-az/share-in-meetings.js":[null],"./az-latn-az/share-to-teams-outlook-addin.js":[null],"./az-latn-az/share-to-teams-third-party.js":[null],"./az-latn-az/share-to-teams.js":[673975,154423],"./az-latn-az/shortcut.js":[658541,451822],"./az-latn-az/shortcuts.js":[819260,451822],"./az-latn-az/simple-collab.js":[839975,451822],"./az-latn-az/smart-device.js":[null],"./az-latn-az/survey.js":[772445,172479],"./az-latn-az/sv-flyout.js":[96338,451822],"./az-latn-az/teams-and-channels.js":[642409,274403],"./az-latn-az/teams-insider.js":[367276,451822],"./az-latn-az/telemetry.js":[79433,451822],"./az-latn-az/tfl-homepage.js":[317572,451822],"./az-latn-az/tfl-onboarding.js":[379901,451822],"./az-latn-az/toast-notifications.js":[272620,451822],"./az-latn-az/trusted-ui.js":[null],"./az-latn-az/unified-search.js":[541976,154423],"./az-latn-az/unsupported-browser.js":[null],"./az-latn-az/url-preview.js":[579462,451822],"./az-latn-az/video-capture.js":[97013,461803],"./az-latn-az/video-message.js":[486314,292584],"./az-latn-az/virtual-consumer-events.js":[99695,590526],"./az-latn-az/virtual-events.js":[910969,266179],"./az-latn-az/webinar.js":[469951,716804],"./az-latn-az/welcome-bot.js":[null],"./az-latn-az/whats-new.js":[231175,451822],"./az-latn-az/wiki.js":[null],"./bg-bg/activity.js":[271390,950747],"./bg-bg/artifacts-platform.js":[956094,333560],"./bg-bg/audience-view-dialog.js":[907319,419562],"./bg-bg/auth.js":[923495,950747],"./bg-bg/autosuggest.js":[115652,950747],"./bg-bg/avatar.js":[571935,950747],"./bg-bg/biometric-enrollment.js":[40165,87417],"./bg-bg/breakout-rooms.js":[286088,751764],"./bg-bg/broadcast.js":[245489,243890],"./bg-bg/calendar.js":[535505,292712],"./bg-bg/calling.js":[367578,154788],"./bg-bg/campaign-notifications.js":[800223,950747],"./bg-bg/carousel-multi-card.js":[null],"./bg-bg/cast.js":[699103,950747],"./bg-bg/channels.js":[906821,950747],"./bg-bg/chat-list.js":[334918,950747],"./bg-bg/coach-report.js":[239658,930972],"./bg-bg/comment-stream.js":[251148,765924],"./bg-bg/communities.js":[946077,950747],"./bg-bg/compose.js":[40584,950747],"./bg-bg/contacts.js":[821789,950747],"./bg-bg/datepicker.js":[757005,93050],"./bg-bg/desktop.js":[null],"./bg-bg/digital-signage.js":[null],"./bg-bg/discover-surface.js":[324353,777384],"./bg-bg/edu.js":[979877,676953],"./bg-bg/embed.js":[469220,950747],"./bg-bg/errors.js":[130743,950747],"./bg-bg/esp.js":[153596,687921],"./bg-bg/extensibility-ptz-extension.js":[null],"./bg-bg/extensibility-room-remote.js":[null],"./bg-bg/extensibility.js":[30873,950747],"./bg-bg/feedback.js":[249425,213722],"./bg-bg/files.js":[447659,950747],"./bg-bg/framework.js":[374608,950747],"./bg-bg/freemium-upgrade.js":[null],"./bg-bg/freemium.js":[929706,154788],"./bg-bg/funstuff.js":[82961,574010],"./bg-bg/gallery.js":[310654,40416],"./bg-bg/growth.js":[793190,950747],"./bg-bg/guardians.js":[924970,984975],"./bg-bg/health.js":[759762,665641],"./bg-bg/help.js":[null],"./bg-bg/hololens.js":[722758,154788],"./bg-bg/host-controls.js":[972002,54425],"./bg-bg/jana.js":[787676,649030],"./bg-bg/lightbox.js":[79091,950747],"./bg-bg/live-persona-card.js":[960370,950747],"./bg-bg/live-persona-editor.js":[798306,850739],"./bg-bg/lms-integration.js":[null],"./bg-bg/meet-for-work.js":[682769,877414],"./bg-bg/meeting-analytics.js":[971873,798696],"./bg-bg/meeting-apis-app.js":[null],"./bg-bg/meeting-bot.js":[null],"./bg-bg/meeting-collaboration.js":[723047,99504],"./bg-bg/meeting-flyout.js":[611422,950747],"./bg-bg/meeting-meet-app.js":[387788,950747],"./bg-bg/meeting-options.js":[786780,72333],"./bg-bg/meeting-recap.js":[612996,36018],"./bg-bg/meeting-room-console.js":[null],"./bg-bg/meeting-stream-app.js":[null],"./bg-bg/message-escalate-dialog.js":[77514,453120],"./bg-bg/messaging.js":[153968,950747],"./bg-bg/mobile-attach.js":[null],"./bg-bg/mtma-missed-notifications.js":[696268,950747],"./bg-bg/nova.js":[575596,950747],"./bg-bg/people-app.js":[null],"./bg-bg/people-picker.js":[358008,950747],"./bg-bg/people-targeting.js":[809330,263237],"./bg-bg/people.js":[939180,950747],"./bg-bg/person.js":[417112,950747],"./bg-bg/phonelink-sms.js":[875957,263667],"./bg-bg/pre-core.js":[null],"./bg-bg/premium-benefits.js":[173487,303143],"./bg-bg/presence.js":[641233,950747],"./bg-bg/queues.js":[578802,200650],"./bg-bg/recurrence.js":[232682,904685],"./bg-bg/rsc-application-permissions.js":[null],"./bg-bg/search.js":[185417,93050],"./bg-bg/semantic-object.js":[66619,938652],"./bg-bg/settings.js":[798720,950747],"./bg-bg/share-in-meetings.js":[null],"./bg-bg/share-to-teams-outlook-addin.js":[null],"./bg-bg/share-to-teams-third-party.js":[null],"./bg-bg/share-to-teams.js":[501089,56738],"./bg-bg/shortcut.js":[183282,950747],"./bg-bg/shortcuts.js":[439841,950747],"./bg-bg/simple-collab.js":[151537,950747],"./bg-bg/smart-device.js":[null],"./bg-bg/survey.js":[82625,878864],"./bg-bg/sv-flyout.js":[728558,950747],"./bg-bg/teams-and-channels.js":[689885,730235],"./bg-bg/teams-insider.js":[207829,950747],"./bg-bg/telemetry.js":[612708,950747],"./bg-bg/tfl-homepage.js":[464975,950747],"./bg-bg/tfl-onboarding.js":[126555,950747],"./bg-bg/toast-notifications.js":[623136,950747],"./bg-bg/trusted-ui.js":[null],"./bg-bg/unified-search.js":[27584,56738],"./bg-bg/unsupported-browser.js":[null],"./bg-bg/url-preview.js":[989155,950747],"./bg-bg/video-capture.js":[896494,692235],"./bg-bg/video-message.js":[808889,189711],"./bg-bg/virtual-consumer-events.js":[869202,203290],"./bg-bg/virtual-events.js":[232420,714927],"./bg-bg/webinar.js":[756834,428488],"./bg-bg/welcome-bot.js":[null],"./bg-bg/whats-new.js":[872404,950747],"./bg-bg/wiki.js":[null],"./ca-es-valencia/activity.js":[12467,207056],"./ca-es-valencia/artifacts-platform.js":[408541,363857],"./ca-es-valencia/audience-view-dialog.js":[66496,604918],"./ca-es-valencia/auth.js":[156705,207056],"./ca-es-valencia/autosuggest.js":[367912,207056],"./ca-es-valencia/avatar.js":[252446,207056],"./ca-es-valencia/biometric-enrollment.js":[240891,162716],"./ca-es-valencia/breakout-rooms.js":[682573,870057],"./ca-es-valencia/broadcast.js":[748779,884441],"./ca-es-valencia/calendar.js":[945905,678220],"./ca-es-valencia/calling.js":[618139,156722],"./ca-es-valencia/campaign-notifications.js":[852129,207056],"./ca-es-valencia/carousel-multi-card.js":[null],"./ca-es-valencia/cast.js":[340614,207056],"./ca-es-valencia/channels.js":[255741,207056],"./ca-es-valencia/chat-list.js":[632874,207056],"./ca-es-valencia/coach-report.js":[533486,159556],"./ca-es-valencia/comment-stream.js":[514259,9160],"./ca-es-valencia/communities.js":[446515,207056],"./ca-es-valencia/compose.js":[374365,207056],"./ca-es-valencia/contacts.js":[987475,207056],"./ca-es-valencia/datepicker.js":[372784,301400],"./ca-es-valencia/desktop.js":[null],"./ca-es-valencia/digital-signage.js":[null],"./ca-es-valencia/discover-surface.js":[504406,782196],"./ca-es-valencia/edu.js":[988085,282305],"./ca-es-valencia/embed.js":[258081,207056],"./ca-es-valencia/errors.js":[321064,207056],"./ca-es-valencia/esp.js":[775643,74837],"./ca-es-valencia/extensibility-ptz-extension.js":[null],"./ca-es-valencia/extensibility-room-remote.js":[null],"./ca-es-valencia/extensibility.js":[318357,207056],"./ca-es-valencia/feedback.js":[446402,906998],"./ca-es-valencia/files.js":[226584,207056],"./ca-es-valencia/framework.js":[55604,207056],"./ca-es-valencia/freemium-upgrade.js":[null],"./ca-es-valencia/freemium.js":[717759,156722],"./ca-es-valencia/funstuff.js":[628342,66011],"./ca-es-valencia/gallery.js":[196271,230191],"./ca-es-valencia/growth.js":[254194,207056],"./ca-es-valencia/guardians.js":[435602,486855],"./ca-es-valencia/health.js":[3438,434626],"./ca-es-valencia/help.js":[null],"./ca-es-valencia/hololens.js":[929743,156722],"./ca-es-valencia/host-controls.js":[451483,484323],"./ca-es-valencia/jana.js":[741691,114965],"./ca-es-valencia/lightbox.js":[405037,207056],"./ca-es-valencia/live-persona-card.js":[463066,207056],"./ca-es-valencia/live-persona-editor.js":[408057,646735],"./ca-es-valencia/lms-integration.js":[null],"./ca-es-valencia/meet-for-work.js":[206974,189591],"./ca-es-valencia/meeting-analytics.js":[396298,610652],"./ca-es-valencia/meeting-apis-app.js":[null],"./ca-es-valencia/meeting-bot.js":[null],"./ca-es-valencia/meeting-collaboration.js":[468590,677740],"./ca-es-valencia/meeting-flyout.js":[626336,207056],"./ca-es-valencia/meeting-meet-app.js":[23535,207056],"./ca-es-valencia/meeting-options.js":[988223,245915],"./ca-es-valencia/meeting-recap.js":[912737,973771],"./ca-es-valencia/meeting-room-console.js":[null],"./ca-es-valencia/meeting-stream-app.js":[null],"./ca-es-valencia/message-escalate-dialog.js":[307400,781288],"./ca-es-valencia/messaging.js":[3674,207056],"./ca-es-valencia/mobile-attach.js":[null],"./ca-es-valencia/mtma-missed-notifications.js":[704847,207056],"./ca-es-valencia/nova.js":[304086,207056],"./ca-es-valencia/people-app.js":[null],"./ca-es-valencia/people-picker.js":[281561,207056],"./ca-es-valencia/people-targeting.js":[864092,231402],"./ca-es-valencia/people.js":[75049,207056],"./ca-es-valencia/person.js":[897923,207056],"./ca-es-valencia/phonelink-sms.js":[183074,262146],"./ca-es-valencia/pre-core.js":[null],"./ca-es-valencia/premium-benefits.js":[331810,497937],"./ca-es-valencia/presence.js":[346318,207056],"./ca-es-valencia/queues.js":[836480,327612],"./ca-es-valencia/recurrence.js":[460728,691643],"./ca-es-valencia/rsc-application-permissions.js":[null],"./ca-es-valencia/search.js":[499971,301400],"./ca-es-valencia/semantic-object.js":[2617,817638],"./ca-es-valencia/settings.js":[416674,207056],"./ca-es-valencia/share-in-meetings.js":[null],"./ca-es-valencia/share-to-teams-outlook-addin.js":[null],"./ca-es-valencia/share-to-teams-third-party.js":[null],"./ca-es-valencia/share-to-teams.js":[928115,500906],"./ca-es-valencia/shortcut.js":[919731,207056],"./ca-es-valencia/shortcuts.js":[701357,207056],"./ca-es-valencia/simple-collab.js":[666972,207056],"./ca-es-valencia/smart-device.js":[null],"./ca-es-valencia/survey.js":[794807,270706],"./ca-es-valencia/sv-flyout.js":[445921,207056],"./ca-es-valencia/teams-and-channels.js":[17256,295589],"./ca-es-valencia/teams-insider.js":[304003,207056],"./ca-es-valencia/telemetry.js":[408335,207056],"./ca-es-valencia/tfl-homepage.js":[500923,207056],"./ca-es-valencia/tfl-onboarding.js":[656013,207056],"./ca-es-valencia/toast-notifications.js":[513251,207056],"./ca-es-valencia/trusted-ui.js":[null],"./ca-es-valencia/unified-search.js":[451392,500906],"./ca-es-valencia/unsupported-browser.js":[null],"./ca-es-valencia/url-preview.js":[275142,207056],"./ca-es-valencia/video-capture.js":[547471,478526],"./ca-es-valencia/video-message.js":[732839,273177],"./ca-es-valencia/virtual-consumer-events.js":[170648,967509],"./ca-es-valencia/virtual-events.js":[166362,699458],"./ca-es-valencia/webinar.js":[34011,513478],"./ca-es-valencia/welcome-bot.js":[null],"./ca-es-valencia/whats-new.js":[691254,207056],"./ca-es-valencia/wiki.js":[null],"./ca-es/activity.js":[219480,483240],"./ca-es/artifacts-platform.js":[87800,461336],"./ca-es/audience-view-dialog.js":[294035,792193],"./ca-es/auth.js":[590272,483240],"./ca-es/autosuggest.js":[462820,483240],"./ca-es/avatar.js":[596172,483240],"./ca-es/biometric-enrollment.js":[101372,206279],"./ca-es/breakout-rooms.js":[340251,739625],"./ca-es/broadcast.js":[366520,264078],"./ca-es/calendar.js":[65327,45196],"./ca-es/calling.js":[277835,396079],"./ca-es/campaign-notifications.js":[96211,483240],"./ca-es/carousel-multi-card.js":[null],"./ca-es/cast.js":[806436,483240],"./ca-es/channels.js":[886868,483240],"./ca-es/chat-list.js":[668979,483240],"./ca-es/coach-report.js":[48935,85637],"./ca-es/comment-stream.js":[295285,73731],"./ca-es/communities.js":[999489,483240],"./ca-es/compose.js":[961357,483240],"./ca-es/contacts.js":[281997,483240],"./ca-es/datepicker.js":[630467,499648],"./ca-es/desktop.js":[null],"./ca-es/digital-signage.js":[null],"./ca-es/discover-surface.js":[954229,717704],"./ca-es/edu.js":[271104,861024],"./ca-es/embed.js":[317485,483240],"./ca-es/errors.js":[450345,483240],"./ca-es/esp.js":[80584,403626],"./ca-es/extensibility-ptz-extension.js":[null],"./ca-es/extensibility-room-remote.js":[null],"./ca-es/extensibility.js":[142619,483240],"./ca-es/feedback.js":[147435,593930],"./ca-es/files.js":[908523,483240],"./ca-es/framework.js":[408222,483240],"./ca-es/freemium-upgrade.js":[null],"./ca-es/freemium.js":[741027,396079],"./ca-es/funstuff.js":[187769,698012],"./ca-es/gallery.js":[380508,605363],"./ca-es/growth.js":[503341,483240],"./ca-es/guardians.js":[129003,337232],"./ca-es/health.js":[119534,823264],"./ca-es/help.js":[null],"./ca-es/hololens.js":[178328,396079],"./ca-es/host-controls.js":[535841,441467],"./ca-es/jana.js":[927267,644495],"./ca-es/lightbox.js":[114404,483240],"./ca-es/live-persona-card.js":[784037,483240],"./ca-es/live-persona-editor.js":[957699,580387],"./ca-es/lms-integration.js":[null],"./ca-es/meet-for-work.js":[383095,815469],"./ca-es/meeting-analytics.js":[415163,335020],"./ca-es/meeting-apis-app.js":[null],"./ca-es/meeting-bot.js":[null],"./ca-es/meeting-collaboration.js":[179961,481166],"./ca-es/meeting-flyout.js":[313713,483240],"./ca-es/meeting-meet-app.js":[412928,483240],"./ca-es/meeting-options.js":[739407,417589],"./ca-es/meeting-recap.js":[192498,788864],"./ca-es/meeting-room-console.js":[null],"./ca-es/meeting-stream-app.js":[null],"./ca-es/message-escalate-dialog.js":[326868,914629],"./ca-es/messaging.js":[969388,483240],"./ca-es/mobile-attach.js":[null],"./ca-es/mtma-missed-notifications.js":[232864,483240],"./ca-es/nova.js":[382646,483240],"./ca-es/people-app.js":[null],"./ca-es/people-picker.js":[121792,483240],"./ca-es/people-targeting.js":[908073,527639],"./ca-es/people.js":[381498,483240],"./ca-es/person.js":[211378,483240],"./ca-es/phonelink-sms.js":[762931,611443],"./ca-es/pre-core.js":[null],"./ca-es/premium-benefits.js":[482552,428428],"./ca-es/presence.js":[423059,483240],"./ca-es/queues.js":[960409,400287],"./ca-es/recurrence.js":[698906,87237],"./ca-es/rsc-application-permissions.js":[null],"./ca-es/search.js":[969225,499648],"./ca-es/semantic-object.js":[697997,116676],"./ca-es/settings.js":[7038,483240],"./ca-es/share-in-meetings.js":[null],"./ca-es/share-to-teams-outlook-addin.js":[null],"./ca-es/share-to-teams-third-party.js":[null],"./ca-es/share-to-teams.js":[716774,594772],"./ca-es/shortcut.js":[708220,483240],"./ca-es/shortcuts.js":[951071,483240],"./ca-es/simple-collab.js":[95685,483240],"./ca-es/smart-device.js":[null],"./ca-es/survey.js":[92859,284765],"./ca-es/sv-flyout.js":[972159,483240],"./ca-es/teams-and-channels.js":[860774,376001],"./ca-es/teams-insider.js":[154447,483240],"./ca-es/telemetry.js":[717785,483240],"./ca-es/tfl-homepage.js":[605919,483240],"./ca-es/tfl-onboarding.js":[740381,483240],"./ca-es/toast-notifications.js":[207965,483240],"./ca-es/trusted-ui.js":[null],"./ca-es/unified-search.js":[790744,594772],"./ca-es/unsupported-browser.js":[null],"./ca-es/url-preview.js":[860458,483240],"./ca-es/video-capture.js":[111666,653075],"./ca-es/video-message.js":[286812,673889],"./ca-es/virtual-consumer-events.js":[527260,465344],"./ca-es/virtual-events.js":[564248,849448],"./ca-es/webinar.js":[745923,257405],"./ca-es/welcome-bot.js":[null],"./ca-es/whats-new.js":[106914,483240],"./ca-es/wiki.js":[null],"./cs-cz/activity.js":[850979,132076],"./cs-cz/artifacts-platform.js":[650946,967953],"./cs-cz/audience-view-dialog.js":[714313,154039],"./cs-cz/auth.js":[390459,132076],"./cs-cz/autosuggest.js":[280930,132076],"./cs-cz/avatar.js":[569204,132076],"./cs-cz/biometric-enrollment.js":[720178,542985],"./cs-cz/breakout-rooms.js":[947363,742109],"./cs-cz/broadcast.js":[529226,95844],"./cs-cz/calendar.js":[582789,120132],"./cs-cz/calling.js":[643919,53615],"./cs-cz/campaign-notifications.js":[393461,132076],"./cs-cz/carousel-multi-card.js":[null],"./cs-cz/cast.js":[886323,132076],"./cs-cz/channels.js":[890629,132076],"./cs-cz/chat-list.js":[901315,132076],"./cs-cz/coach-report.js":[120311,922194],"./cs-cz/comment-stream.js":[836044,336006],"./cs-cz/communities.js":[854671,132076],"./cs-cz/compose.js":[676964,132076],"./cs-cz/contacts.js":[678314,132076],"./cs-cz/datepicker.js":[469988,600284],"./cs-cz/desktop.js":[null],"./cs-cz/digital-signage.js":[null],"./cs-cz/discover-surface.js":[339989,958646],"./cs-cz/edu.js":[951703,735611],"./cs-cz/embed.js":[569257,132076],"./cs-cz/errors.js":[679807,132076],"./cs-cz/esp.js":[539044,707536],"./cs-cz/extensibility-ptz-extension.js":[null],"./cs-cz/extensibility-room-remote.js":[null],"./cs-cz/extensibility.js":[155869,132076],"./cs-cz/feedback.js":[48257,755771],"./cs-cz/files.js":[879807,132076],"./cs-cz/framework.js":[587042,132076],"./cs-cz/freemium-upgrade.js":[null],"./cs-cz/freemium.js":[629143,53615],"./cs-cz/funstuff.js":[883899,94207],"./cs-cz/gallery.js":[270755,662990],"./cs-cz/growth.js":[697938,132076],"./cs-cz/guardians.js":[436047,943212],"./cs-cz/health.js":[108255,453356],"./cs-cz/help.js":[null],"./cs-cz/hololens.js":[770883,53615],"./cs-cz/host-controls.js":[638686,740542],"./cs-cz/jana.js":[178198,911177],"./cs-cz/lightbox.js":[727105,132076],"./cs-cz/live-persona-card.js":[447546,132076],"./cs-cz/live-persona-editor.js":[229782,673280],"./cs-cz/lms-integration.js":[null],"./cs-cz/meet-for-work.js":[568920,37436],"./cs-cz/meeting-analytics.js":[960296,911637],"./cs-cz/meeting-apis-app.js":[null],"./cs-cz/meeting-bot.js":[null],"./cs-cz/meeting-collaboration.js":[767012,51704],"./cs-cz/meeting-flyout.js":[966953,132076],"./cs-cz/meeting-meet-app.js":[281203,132076],"./cs-cz/meeting-options.js":[835352,459166],"./cs-cz/meeting-recap.js":[149887,243158],"./cs-cz/meeting-room-console.js":[null],"./cs-cz/meeting-stream-app.js":[null],"./cs-cz/message-escalate-dialog.js":[238752,992480],"./cs-cz/messaging.js":[214264,132076],"./cs-cz/mobile-attach.js":[null],"./cs-cz/mtma-missed-notifications.js":[635060,132076],"./cs-cz/nova.js":[727746,132076],"./cs-cz/people-app.js":[null],"./cs-cz/people-picker.js":[180046,132076],"./cs-cz/people-targeting.js":[1236,440824],"./cs-cz/people.js":[968097,132076],"./cs-cz/person.js":[337686,132076],"./cs-cz/phonelink-sms.js":[328386,943397],"./cs-cz/pre-core.js":[null],"./cs-cz/premium-benefits.js":[33542,483314],"./cs-cz/presence.js":[47206,132076],"./cs-cz/queues.js":[208699,988486],"./cs-cz/recurrence.js":[582906,98857],"./cs-cz/rsc-application-permissions.js":[null],"./cs-cz/search.js":[792429,600284],"./cs-cz/semantic-object.js":[492091,385869],"./cs-cz/settings.js":[214625,132076],"./cs-cz/share-in-meetings.js":[null],"./cs-cz/share-to-teams-outlook-addin.js":[null],"./cs-cz/share-to-teams-third-party.js":[null],"./cs-cz/share-to-teams.js":[359768,125532],"./cs-cz/shortcut.js":[477026,132076],"./cs-cz/shortcuts.js":[105821,132076],"./cs-cz/simple-collab.js":[690849,132076],"./cs-cz/smart-device.js":[null],"./cs-cz/survey.js":[716441,788207],"./cs-cz/sv-flyout.js":[495872,132076],"./cs-cz/teams-and-channels.js":[665418,126263],"./cs-cz/teams-insider.js":[746684,132076],"./cs-cz/telemetry.js":[326694,132076],"./cs-cz/tfl-homepage.js":[331010,132076],"./cs-cz/tfl-onboarding.js":[718543,132076],"./cs-cz/toast-notifications.js":[673999,132076],"./cs-cz/trusted-ui.js":[null],"./cs-cz/unified-search.js":[364298,125532],"./cs-cz/unsupported-browser.js":[null],"./cs-cz/url-preview.js":[629621,132076],"./cs-cz/video-capture.js":[512694,579880],"./cs-cz/video-message.js":[216950,347924],"./cs-cz/virtual-consumer-events.js":[557383,454148],"./cs-cz/virtual-events.js":[289218,119374],"./cs-cz/webinar.js":[194524,151397],"./cs-cz/welcome-bot.js":[null],"./cs-cz/whats-new.js":[41703,132076],"./cs-cz/wiki.js":[null],"./cy-gb/activity.js":[743940,952344],"./cy-gb/artifacts-platform.js":[712725,860319],"./cy-gb/audience-view-dialog.js":[349682,351685],"./cy-gb/auth.js":[248369,952344],"./cy-gb/autosuggest.js":[100459,952344],"./cy-gb/avatar.js":[314393,952344],"./cy-gb/biometric-enrollment.js":[756524,317734],"./cy-gb/breakout-rooms.js":[515442,615483],"./cy-gb/broadcast.js":[676909,818364],"./cy-gb/calendar.js":[551864,477661],"./cy-gb/calling.js":[549471,705875],"./cy-gb/campaign-notifications.js":[702240,952344],"./cy-gb/carousel-multi-card.js":[null],"./cy-gb/cast.js":[284581,952344],"./cy-gb/channels.js":[859756,952344],"./cy-gb/chat-list.js":[536168,952344],"./cy-gb/coach-report.js":[926494,678153],"./cy-gb/comment-stream.js":[822669,887683],"./cy-gb/communities.js":[727934,952344],"./cy-gb/compose.js":[402422,952344],"./cy-gb/contacts.js":[116014,952344],"./cy-gb/datepicker.js":[940215,398842],"./cy-gb/desktop.js":[null],"./cy-gb/digital-signage.js":[null],"./cy-gb/discover-surface.js":[473938,292044],"./cy-gb/edu.js":[707153,214301],"./cy-gb/embed.js":[296109,952344],"./cy-gb/errors.js":[975418,952344],"./cy-gb/esp.js":[200144,459982],"./cy-gb/extensibility-ptz-extension.js":[null],"./cy-gb/extensibility-room-remote.js":[null],"./cy-gb/extensibility.js":[809065,952344],"./cy-gb/feedback.js":[574807,384120],"./cy-gb/files.js":[393450,952344],"./cy-gb/framework.js":[221199,952344],"./cy-gb/freemium-upgrade.js":[null],"./cy-gb/freemium.js":[395356,705875],"./cy-gb/funstuff.js":[851538,160982],"./cy-gb/gallery.js":[666524,954009],"./cy-gb/growth.js":[990805,952344],"./cy-gb/guardians.js":[230418,394476],"./cy-gb/health.js":[260026,337425],"./cy-gb/help.js":[null],"./cy-gb/hololens.js":[311440,705875],"./cy-gb/host-controls.js":[660184,563297],"./cy-gb/jana.js":[918403,64332],"./cy-gb/lightbox.js":[702070,952344],"./cy-gb/live-persona-card.js":[552222,952344],"./cy-gb/live-persona-editor.js":[886732,868098],"./cy-gb/lms-integration.js":[null],"./cy-gb/meet-for-work.js":[947290,339730],"./cy-gb/meeting-analytics.js":[668957,891041],"./cy-gb/meeting-apis-app.js":[null],"./cy-gb/meeting-bot.js":[null],"./cy-gb/meeting-collaboration.js":[516907,304788],"./cy-gb/meeting-flyout.js":[298702,952344],"./cy-gb/meeting-meet-app.js":[381564,952344],"./cy-gb/meeting-options.js":[450017,910122],"./cy-gb/meeting-recap.js":[418848,613299],"./cy-gb/meeting-room-console.js":[null],"./cy-gb/meeting-stream-app.js":[null],"./cy-gb/message-escalate-dialog.js":[670499,803073],"./cy-gb/messaging.js":[199699,952344],"./cy-gb/mobile-attach.js":[null],"./cy-gb/mtma-missed-notifications.js":[804984,952344],"./cy-gb/nova.js":[394668,952344],"./cy-gb/people-app.js":[null],"./cy-gb/people-picker.js":[143781,952344],"./cy-gb/people-targeting.js":[950071,914044],"./cy-gb/people.js":[333745,952344],"./cy-gb/person.js":[510313,952344],"./cy-gb/phonelink-sms.js":[767190,784017],"./cy-gb/pre-core.js":[null],"./cy-gb/premium-benefits.js":[337524,330690],"./cy-gb/presence.js":[959406,952344],"./cy-gb/queues.js":[737663,5748],"./cy-gb/recurrence.js":[588834,940125],"./cy-gb/rsc-application-permissions.js":[null],"./cy-gb/search.js":[407976,398842],"./cy-gb/semantic-object.js":[95257,855200],"./cy-gb/settings.js":[862364,952344],"./cy-gb/share-in-meetings.js":[null],"./cy-gb/share-to-teams-outlook-addin.js":[null],"./cy-gb/share-to-teams-third-party.js":[null],"./cy-gb/share-to-teams.js":[733739,120765],"./cy-gb/shortcut.js":[519918,952344],"./cy-gb/shortcuts.js":[907560,952344],"./cy-gb/simple-collab.js":[66470,952344],"./cy-gb/smart-device.js":[null],"./cy-gb/survey.js":[257311,250936],"./cy-gb/sv-flyout.js":[667419,952344],"./cy-gb/teams-and-channels.js":[781786,424444],"./cy-gb/teams-insider.js":[861758,952344],"./cy-gb/telemetry.js":[937415,952344],"./cy-gb/tfl-homepage.js":[836020,952344],"./cy-gb/tfl-onboarding.js":[270746,952344],"./cy-gb/toast-notifications.js":[619511,952344],"./cy-gb/trusted-ui.js":[null],"./cy-gb/unified-search.js":[597371,120765],"./cy-gb/unsupported-browser.js":[null],"./cy-gb/url-preview.js":[842671,952344],"./cy-gb/video-capture.js":[216894,504484],"./cy-gb/video-message.js":[47900,803941],"./cy-gb/virtual-consumer-events.js":[253533,231759],"./cy-gb/virtual-events.js":[261375,998813],"./cy-gb/webinar.js":[87450,855320],"./cy-gb/welcome-bot.js":[null],"./cy-gb/whats-new.js":[315046,952344],"./cy-gb/wiki.js":[null],"./da-dk/activity.js":[615959,906990],"./da-dk/artifacts-platform.js":[64012,613980],"./da-dk/audience-view-dialog.js":[244353,237123],"./da-dk/auth.js":[564194,906990],"./da-dk/autosuggest.js":[602696,906990],"./da-dk/avatar.js":[432169,906990],"./da-dk/biometric-enrollment.js":[560380,533884],"./da-dk/breakout-rooms.js":[688180,513691],"./da-dk/broadcast.js":[748687,764009],"./da-dk/calendar.js":[544983,700826],"./da-dk/calling.js":[948710,610319],"./da-dk/campaign-notifications.js":[957007,906990],"./da-dk/carousel-multi-card.js":[null],"./da-dk/cast.js":[885723,906990],"./da-dk/channels.js":[832977,906990],"./da-dk/chat-list.js":[387150,906990],"./da-dk/coach-report.js":[299702,105183],"./da-dk/comment-stream.js":[856465,827120],"./da-dk/communities.js":[988949,906990],"./da-dk/compose.js":[533217,906990],"./da-dk/contacts.js":[413855,906990],"./da-dk/datepicker.js":[269252,704120],"./da-dk/desktop.js":[null],"./da-dk/digital-signage.js":[null],"./da-dk/discover-surface.js":[813588,983999],"./da-dk/edu.js":[59300,156716],"./da-dk/embed.js":[778224,906990],"./da-dk/errors.js":[742152,906990],"./da-dk/esp.js":[639958,436856],"./da-dk/extensibility-ptz-extension.js":[null],"./da-dk/extensibility-room-remote.js":[null],"./da-dk/extensibility.js":[45056,906990],"./da-dk/feedback.js":[328711,830598],"./da-dk/files.js":[888405,906990],"./da-dk/framework.js":[828214,906990],"./da-dk/freemium-upgrade.js":[null],"./da-dk/freemium.js":[732174,610319],"./da-dk/funstuff.js":[877967,355706],"./da-dk/gallery.js":[83627,657426],"./da-dk/growth.js":[372739,906990],"./da-dk/guardians.js":[788317,552876],"./da-dk/health.js":[347430,280520],"./da-dk/help.js":[null],"./da-dk/hololens.js":[548706,610319],"./da-dk/host-controls.js":[115605,717943],"./da-dk/jana.js":[406035,956121],"./da-dk/lightbox.js":[461895,906990],"./da-dk/live-persona-card.js":[453175,906990],"./da-dk/live-persona-editor.js":[2817,24348],"./da-dk/lms-integration.js":[null],"./da-dk/meet-for-work.js":[314427,392796],"./da-dk/meeting-analytics.js":[685983,507004],"./da-dk/meeting-apis-app.js":[null],"./da-dk/meeting-bot.js":[null],"./da-dk/meeting-collaboration.js":[33910,855531],"./da-dk/meeting-flyout.js":[358957,906990],"./da-dk/meeting-meet-app.js":[677254,906990],"./da-dk/meeting-options.js":[106372,210749],"./da-dk/meeting-recap.js":[496302,723063],"./da-dk/meeting-room-console.js":[null],"./da-dk/meeting-stream-app.js":[null],"./da-dk/message-escalate-dialog.js":[749743,57020],"./da-dk/messaging.js":[812086,906990],"./da-dk/mobile-attach.js":[null],"./da-dk/mtma-missed-notifications.js":[17736,906990],"./da-dk/nova.js":[86801,906990],"./da-dk/people-app.js":[null],"./da-dk/people-picker.js":[209706,906990],"./da-dk/people-targeting.js":[2432,514533],"./da-dk/people.js":[597843,906990],"./da-dk/person.js":[346359,906990],"./da-dk/phonelink-sms.js":[926853,811210],"./da-dk/pre-core.js":[null],"./da-dk/premium-benefits.js":[510666,631157],"./da-dk/presence.js":[605482,906990],"./da-dk/queues.js":[188247,934672],"./da-dk/recurrence.js":[487004,23280],"./da-dk/rsc-application-permissions.js":[null],"./da-dk/search.js":[631926,704120],"./da-dk/semantic-object.js":[122623,503966],"./da-dk/settings.js":[899472,906990],"./da-dk/share-in-meetings.js":[null],"./da-dk/share-to-teams-outlook-addin.js":[null],"./da-dk/share-to-teams-third-party.js":[null],"./da-dk/share-to-teams.js":[507669,74120],"./da-dk/shortcut.js":[563267,906990],"./da-dk/shortcuts.js":[780664,906990],"./da-dk/simple-collab.js":[801405,906990],"./da-dk/smart-device.js":[null],"./da-dk/survey.js":[233911,274590],"./da-dk/sv-flyout.js":[693277,906990],"./da-dk/teams-and-channels.js":[727218,545321],"./da-dk/teams-insider.js":[626888,906990],"./da-dk/telemetry.js":[898502,906990],"./da-dk/tfl-homepage.js":[996277,906990],"./da-dk/tfl-onboarding.js":[37856,906990],"./da-dk/toast-notifications.js":[585305,906990],"./da-dk/trusted-ui.js":[null],"./da-dk/unified-search.js":[993456,74120],"./da-dk/unsupported-browser.js":[null],"./da-dk/url-preview.js":[169296,906990],"./da-dk/video-capture.js":[807026,417274],"./da-dk/video-message.js":[231422,503266],"./da-dk/virtual-consumer-events.js":[258225,383524],"./da-dk/virtual-events.js":[346895,282118],"./da-dk/webinar.js":[492657,478755],"./da-dk/welcome-bot.js":[null],"./da-dk/whats-new.js":[324879,906990],"./da-dk/wiki.js":[null],"./de-de/activity.js":[831656,536397],"./de-de/artifacts-platform.js":[853517,813802],"./de-de/audience-view-dialog.js":[717560,914712],"./de-de/auth.js":[31766,536397],"./de-de/autosuggest.js":[198757,536397],"./de-de/avatar.js":[368491,536397],"./de-de/biometric-enrollment.js":[539415,562050],"./de-de/breakout-rooms.js":[764295,157427],"./de-de/broadcast.js":[729303,67131],"./de-de/calendar.js":[621183,468734],"./de-de/calling.js":[957171,497507],"./de-de/campaign-notifications.js":[968482,536397],"./de-de/carousel-multi-card.js":[null],"./de-de/cast.js":[339457,536397],"./de-de/channels.js":[772757,536397],"./de-de/chat-list.js":[22592,536397],"./de-de/coach-report.js":[675847,312374],"./de-de/comment-stream.js":[205879,224189],"./de-de/communities.js":[217698,536397],"./de-de/compose.js":[371071,536397],"./de-de/contacts.js":[829345,536397],"./de-de/datepicker.js":[924189,109545],"./de-de/desktop.js":[null],"./de-de/digital-signage.js":[null],"./de-de/discover-surface.js":[497805,535964],"./de-de/edu.js":[232394,486943],"./de-de/embed.js":[52052,536397],"./de-de/errors.js":[520899,536397],"./de-de/esp.js":[397492,959048],"./de-de/extensibility-ptz-extension.js":[null],"./de-de/extensibility-room-remote.js":[null],"./de-de/extensibility.js":[774283,536397],"./de-de/feedback.js":[876678,892214],"./de-de/files.js":[789749,536397],"./de-de/framework.js":[709707,536397],"./de-de/freemium-upgrade.js":[null],"./de-de/freemium.js":[168527,497507],"./de-de/funstuff.js":[899793,935521],"./de-de/gallery.js":[765771,432106],"./de-de/growth.js":[760567,536397],"./de-de/guardians.js":[146923,257052],"./de-de/health.js":[349952,926884],"./de-de/help.js":[null],"./de-de/hololens.js":[147035,497507],"./de-de/host-controls.js":[595807,133230],"./de-de/jana.js":[535658,480713],"./de-de/lightbox.js":[980893,536397],"./de-de/live-persona-card.js":[1878,536397],"./de-de/live-persona-editor.js":[168981,572848],"./de-de/lms-integration.js":[null],"./de-de/meet-for-work.js":[504586,804102],"./de-de/meeting-analytics.js":[931236,75667],"./de-de/meeting-apis-app.js":[null],"./de-de/meeting-bot.js":[null],"./de-de/meeting-collaboration.js":[936824,51093],"./de-de/meeting-flyout.js":[714761,536397],"./de-de/meeting-meet-app.js":[42019,536397],"./de-de/meeting-options.js":[136940,731908],"./de-de/meeting-recap.js":[20167,756204],"./de-de/meeting-room-console.js":[null],"./de-de/meeting-stream-app.js":[null],"./de-de/message-escalate-dialog.js":[109714,100741],"./de-de/messaging.js":[32515,536397],"./de-de/mobile-attach.js":[null],"./de-de/mtma-missed-notifications.js":[234800,536397],"./de-de/nova.js":[778853,536397],"./de-de/people-app.js":[null],"./de-de/people-picker.js":[724989,536397],"./de-de/people-targeting.js":[583277,444465],"./de-de/people.js":[119238,536397],"./de-de/person.js":[129642,536397],"./de-de/phonelink-sms.js":[860582,535820],"./de-de/pre-core.js":[null],"./de-de/premium-benefits.js":[629087,385798],"./de-de/presence.js":[384614,536397],"./de-de/queues.js":[60550,75296],"./de-de/recurrence.js":[865561,830590],"./de-de/rsc-application-permissions.js":[null],"./de-de/search.js":[253013,109545],"./de-de/semantic-object.js":[677039,704288],"./de-de/settings.js":[784026,536397],"./de-de/share-in-meetings.js":[null],"./de-de/share-to-teams-outlook-addin.js":[null],"./de-de/share-to-teams-third-party.js":[null],"./de-de/share-to-teams.js":[290598,21514],"./de-de/shortcut.js":[786389,536397],"./de-de/shortcuts.js":[885191,536397],"./de-de/simple-collab.js":[942266,536397],"./de-de/smart-device.js":[null],"./de-de/survey.js":[622225,555204],"./de-de/sv-flyout.js":[373486,536397],"./de-de/teams-and-channels.js":[489562,641272],"./de-de/teams-insider.js":[250481,536397],"./de-de/telemetry.js":[771706,536397],"./de-de/tfl-homepage.js":[953906,536397],"./de-de/tfl-onboarding.js":[733569,536397],"./de-de/toast-notifications.js":[944361,536397],"./de-de/trusted-ui.js":[null],"./de-de/unified-search.js":[717065,21514],"./de-de/unsupported-browser.js":[null],"./de-de/url-preview.js":[267432,536397],"./de-de/video-capture.js":[236313,864466],"./de-de/video-message.js":[623652,315682],"./de-de/virtual-consumer-events.js":[125140,673678],"./de-de/virtual-events.js":[846167,587150],"./de-de/webinar.js":[748598,481516],"./de-de/welcome-bot.js":[null],"./de-de/whats-new.js":[22200,536397],"./de-de/wiki.js":[null],"./el-gr/activity.js":[122434,884766],"./el-gr/artifacts-platform.js":[43130,229407],"./el-gr/audience-view-dialog.js":[45397,797146],"./el-gr/auth.js":[383125,884766],"./el-gr/autosuggest.js":[222619,884766],"./el-gr/avatar.js":[894735,884766],"./el-gr/biometric-enrollment.js":[666654,692186],"./el-gr/breakout-rooms.js":[779262,108998],"./el-gr/broadcast.js":[27555,352433],"./el-gr/calendar.js":[822575,16487],"./el-gr/calling.js":[282770,23762],"./el-gr/campaign-notifications.js":[607571,884766],"./el-gr/carousel-multi-card.js":[null],"./el-gr/cast.js":[13288,884766],"./el-gr/channels.js":[121906,884766],"./el-gr/chat-list.js":[507330,884766],"./el-gr/coach-report.js":[173623,508058],"./el-gr/comment-stream.js":[951413,585153],"./el-gr/communities.js":[306308,884766],"./el-gr/compose.js":[113030,884766],"./el-gr/contacts.js":[226943,884766],"./el-gr/datepicker.js":[629617,939387],"./el-gr/desktop.js":[null],"./el-gr/digital-signage.js":[null],"./el-gr/discover-surface.js":[332026,848170],"./el-gr/edu.js":[891581,622685],"./el-gr/embed.js":[927087,884766],"./el-gr/errors.js":[641245,884766],"./el-gr/esp.js":[267187,29475],"./el-gr/extensibility-ptz-extension.js":[null],"./el-gr/extensibility-room-remote.js":[null],"./el-gr/extensibility.js":[661032,884766],"./el-gr/feedback.js":[379816,860596],"./el-gr/files.js":[185425,884766],"./el-gr/framework.js":[13107,884766],"./el-gr/freemium-upgrade.js":[null],"./el-gr/freemium.js":[570830,23762],"./el-gr/funstuff.js":[416644,999385],"./el-gr/gallery.js":[366956,290265],"./el-gr/growth.js":[660384,884766],"./el-gr/guardians.js":[215036,722799],"./el-gr/health.js":[924368,113484],"./el-gr/help.js":[null],"./el-gr/hololens.js":[105183,23762],"./el-gr/host-controls.js":[556355,34799],"./el-gr/jana.js":[375649,352626],"./el-gr/lightbox.js":[649702,884766],"./el-gr/live-persona-card.js":[557221,884766],"./el-gr/live-persona-editor.js":[687044,564212],"./el-gr/lms-integration.js":[null],"./el-gr/meet-for-work.js":[959047,461300],"./el-gr/meeting-analytics.js":[849150,296105],"./el-gr/meeting-apis-app.js":[null],"./el-gr/meeting-bot.js":[null],"./el-gr/meeting-collaboration.js":[512112,550099],"./el-gr/meeting-flyout.js":[490626,884766],"./el-gr/meeting-meet-app.js":[450431,884766],"./el-gr/meeting-options.js":[545427,195002],"./el-gr/meeting-recap.js":[580786,2784],"./el-gr/meeting-room-console.js":[null],"./el-gr/meeting-stream-app.js":[null],"./el-gr/message-escalate-dialog.js":[824673,993207],"./el-gr/messaging.js":[780246,884766],"./el-gr/mobile-attach.js":[null],"./el-gr/mtma-missed-notifications.js":[864519,884766],"./el-gr/nova.js":[868841,884766],"./el-gr/people-app.js":[null],"./el-gr/people-picker.js":[77290,884766],"./el-gr/people-targeting.js":[505038,559752],"./el-gr/people.js":[734320,884766],"./el-gr/person.js":[239723,884766],"./el-gr/phonelink-sms.js":[494484,416005],"./el-gr/pre-core.js":[null],"./el-gr/premium-benefits.js":[852729,338542],"./el-gr/presence.js":[594987,884766],"./el-gr/queues.js":[293907,881275],"./el-gr/recurrence.js":[334927,33925],"./el-gr/rsc-application-permissions.js":[null],"./el-gr/search.js":[52655,939387],"./el-gr/semantic-object.js":[544916,492521],"./el-gr/settings.js":[708537,884766],"./el-gr/share-in-meetings.js":[null],"./el-gr/share-to-teams-outlook-addin.js":[null],"./el-gr/share-to-teams-third-party.js":[null],"./el-gr/share-to-teams.js":[140749,401199],"./el-gr/shortcut.js":[686757,884766],"./el-gr/shortcuts.js":[758717,884766],"./el-gr/simple-collab.js":[448815,884766],"./el-gr/smart-device.js":[null],"./el-gr/survey.js":[285738,466953],"./el-gr/sv-flyout.js":[748586,884766],"./el-gr/teams-and-channels.js":[490614,711265],"./el-gr/teams-insider.js":[19019,884766],"./el-gr/telemetry.js":[247528,884766],"./el-gr/tfl-homepage.js":[796494,884766],"./el-gr/tfl-onboarding.js":[100467,884766],"./el-gr/toast-notifications.js":[131432,884766],"./el-gr/trusted-ui.js":[null],"./el-gr/unified-search.js":[62625,401199],"./el-gr/unsupported-browser.js":[null],"./el-gr/url-preview.js":[44554,884766],"./el-gr/video-capture.js":[705381,101345],"./el-gr/video-message.js":[420374,86142],"./el-gr/virtual-consumer-events.js":[542849,48548],"./el-gr/virtual-events.js":[830190,796736],"./el-gr/webinar.js":[189920,798654],"./el-gr/welcome-bot.js":[null],"./el-gr/whats-new.js":[332422,884766],"./el-gr/wiki.js":[null],"./en-gb/activity.js":[485273,724937],"./en-gb/artifacts-platform.js":[161640,727959],"./en-gb/audience-view-dialog.js":[754655,617828],"./en-gb/auth.js":[390153,724937],"./en-gb/autosuggest.js":[127858,724937],"./en-gb/avatar.js":[183536,724937],"./en-gb/biometric-enrollment.js":[46759,286608],"./en-gb/breakout-rooms.js":[977996,701254],"./en-gb/broadcast.js":[379249,273851],"./en-gb/calendar.js":[155841,433580],"./en-gb/calling.js":[441651,694057],"./en-gb/campaign-notifications.js":[323644,724937],"./en-gb/carousel-multi-card.js":[null],"./en-gb/cast.js":[243677,724937],"./en-gb/channels.js":[139958,724937],"./en-gb/chat-list.js":[34324,724937],"./en-gb/coach-report.js":[3166,95683],"./en-gb/comment-stream.js":[721910,68754],"./en-gb/communities.js":[664007,724937],"./en-gb/compose.js":[829922,724937],"./en-gb/contacts.js":[432708,724937],"./en-gb/datepicker.js":[988078,993820],"./en-gb/desktop.js":[null],"./en-gb/digital-signage.js":[null],"./en-gb/discover-surface.js":[253269,476547],"./en-gb/edu.js":[172255,103707],"./en-gb/embed.js":[425074,724937],"./en-gb/errors.js":[234194,724937],"./en-gb/esp.js":[538378,139886],"./en-gb/extensibility-ptz-extension.js":[null],"./en-gb/extensibility-room-remote.js":[null],"./en-gb/extensibility.js":[106415,724937],"./en-gb/feedback.js":[88476,494084],"./en-gb/files.js":[133060,724937],"./en-gb/framework.js":[847093,724937],"./en-gb/freemium-upgrade.js":[null],"./en-gb/freemium.js":[432300,694057],"./en-gb/funstuff.js":[842870,915446],"./en-gb/gallery.js":[754447,944284],"./en-gb/growth.js":[681896,724937],"./en-gb/guardians.js":[645655,388664],"./en-gb/health.js":[530486,407949],"./en-gb/help.js":[null],"./en-gb/hololens.js":[209137,694057],"./en-gb/host-controls.js":[844840,255477],"./en-gb/jana.js":[692827,333421],"./en-gb/lightbox.js":[539703,724937],"./en-gb/live-persona-card.js":[705762,724937],"./en-gb/live-persona-editor.js":[682211,781891],"./en-gb/lms-integration.js":[null],"./en-gb/meet-for-work.js":[734850,255306],"./en-gb/meeting-analytics.js":[53171,299290],"./en-gb/meeting-apis-app.js":[null],"./en-gb/meeting-bot.js":[null],"./en-gb/meeting-collaboration.js":[448927,161855],"./en-gb/meeting-flyout.js":[323951,724937],"./en-gb/meeting-meet-app.js":[927017,724937],"./en-gb/meeting-options.js":[840957,536821],"./en-gb/meeting-recap.js":[264322,478432],"./en-gb/meeting-room-console.js":[null],"./en-gb/meeting-stream-app.js":[null],"./en-gb/message-escalate-dialog.js":[692543,321647],"./en-gb/messaging.js":[969756,724937],"./en-gb/mobile-attach.js":[null],"./en-gb/mtma-missed-notifications.js":[628266,724937],"./en-gb/nova.js":[44945,724937],"./en-gb/people-app.js":[null],"./en-gb/people-picker.js":[940872,724937],"./en-gb/people-targeting.js":[852248,580648],"./en-gb/people.js":[441139,724937],"./en-gb/person.js":[595025,724937],"./en-gb/phonelink-sms.js":[37400,40880],"./en-gb/pre-core.js":[null],"./en-gb/premium-benefits.js":[793223,224786],"./en-gb/presence.js":[978506,724937],"./en-gb/queues.js":[697149,972463],"./en-gb/recurrence.js":[841212,137390],"./en-gb/rsc-application-permissions.js":[null],"./en-gb/search.js":[365631,993820],"./en-gb/semantic-object.js":[281596,206396],"./en-gb/settings.js":[637825,724937],"./en-gb/share-in-meetings.js":[null],"./en-gb/share-to-teams-outlook-addin.js":[null],"./en-gb/share-to-teams-third-party.js":[null],"./en-gb/share-to-teams.js":[879578,439370],"./en-gb/shortcut.js":[830876,724937],"./en-gb/shortcuts.js":[453006,724937],"./en-gb/simple-collab.js":[806818,724937],"./en-gb/smart-device.js":[null],"./en-gb/survey.js":[988810,142549],"./en-gb/sv-flyout.js":[709696,724937],"./en-gb/teams-and-channels.js":[611512,763823],"./en-gb/teams-insider.js":[881467,724937],"./en-gb/telemetry.js":[496978,724937],"./en-gb/tfl-homepage.js":[923515,724937],"./en-gb/tfl-onboarding.js":[80163,724937],"./en-gb/toast-notifications.js":[994428,724937],"./en-gb/trusted-ui.js":[null],"./en-gb/unified-search.js":[601166,439370],"./en-gb/unsupported-browser.js":[null],"./en-gb/url-preview.js":[999474,724937],"./en-gb/video-capture.js":[960443,937398],"./en-gb/video-message.js":[255755,881735],"./en-gb/virtual-consumer-events.js":[369115,515111],"./en-gb/virtual-events.js":[394782,887434],"./en-gb/webinar.js":[361179,433105],"./en-gb/welcome-bot.js":[null],"./en-gb/whats-new.js":[30719,724937],"./en-gb/wiki.js":[null],"./en-us/activity.js":[60520,50906],"./en-us/artifacts-platform.js":[280189,583005],"./en-us/audience-view-dialog.js":[259545,137252],"./en-us/auth.js":[83902,50906],"./en-us/autosuggest.js":[493977,50906],"./en-us/avatar.js":[665401,50906],"./en-us/biometric-enrollment.js":[232769,344667],"./en-us/breakout-rooms.js":[712680,117233],"./en-us/broadcast.js":[6162,788811],"./en-us/calendar.js":[158300,336537],"./en-us/calling.js":[102466,246657],"./en-us/campaign-notifications.js":[733785,50906],"./en-us/carousel-multi-card.js":[null],"./en-us/cast.js":[78499,50906],"./en-us/channels.js":[814117,50906],"./en-us/chat-list.js":[889367,50906],"./en-us/coach-report.js":[390464,697206],"./en-us/comment-stream.js":[693333,721599],"./en-us/communities.js":[666071,50906],"./en-us/compose.js":[652407,50906],"./en-us/contacts.js":[767921,50906],"./en-us/datepicker.js":[843754,20538],"./en-us/desktop.js":[null],"./en-us/digital-signage.js":[null],"./en-us/discover-surface.js":[844621,428433],"./en-us/edu.js":[136835,267881],"./en-us/embed.js":[307155,50906],"./en-us/errors.js":[763500,50906],"./en-us/esp.js":[898367,317797],"./en-us/extensibility-ptz-extension.js":[null],"./en-us/extensibility-room-remote.js":[null],"./en-us/extensibility.js":[718907,50906],"./en-us/feedback.js":[391219,394436],"./en-us/files.js":[341579,50906],"./en-us/framework.js":[954208,50906],"./en-us/freemium-upgrade.js":[null],"./en-us/freemium.js":[501548,246657],"./en-us/funstuff.js":[251122,391946],"./en-us/gallery.js":[484025,711746],"./en-us/growth.js":[274198,50906],"./en-us/guardians.js":[98822,258259],"./en-us/health.js":[373414,848588],"./en-us/help.js":[null],"./en-us/hololens.js":[98998,246657],"./en-us/host-controls.js":[464621,334558],"./en-us/jana.js":[419835,654615],"./en-us/lightbox.js":[394736,50906],"./en-us/live-persona-card.js":[982513,50906],"./en-us/live-persona-editor.js":[65967,432916],"./en-us/lms-integration.js":[null],"./en-us/meet-for-work.js":[197104,464880],"./en-us/meeting-analytics.js":[243650,590631],"./en-us/meeting-apis-app.js":[null],"./en-us/meeting-bot.js":[null],"./en-us/meeting-collaboration.js":[962021,972986],"./en-us/meeting-flyout.js":[210370,50906],"./en-us/meeting-meet-app.js":[130968,50906],"./en-us/meeting-options.js":[875934,292819],"./en-us/meeting-recap.js":[736872,42849],"./en-us/meeting-room-console.js":[null],"./en-us/meeting-stream-app.js":[null],"./en-us/message-escalate-dialog.js":[728298,93760],"./en-us/messaging.js":[17698,50906],"./en-us/mobile-attach.js":[null],"./en-us/mtma-missed-notifications.js":[872008,50906],"./en-us/nova.js":[453178,50906],"./en-us/people-app.js":[null],"./en-us/people-picker.js":[511645,50906],"./en-us/people-targeting.js":[506156,420443],"./en-us/people.js":[38565,50906],"./en-us/person.js":[920713,50906],"./en-us/phonelink-sms.js":[412849,889082],"./en-us/pre-core.js":[null],"./en-us/premium-benefits.js":[945779,548894],"./en-us/presence.js":[613451,50906],"./en-us/queues.js":[437346,630154],"./en-us/recurrence.js":[647048,402525],"./en-us/rsc-application-permissions.js":[null],"./en-us/search.js":[327920,20538],"./en-us/semantic-object.js":[229442,87562],"./en-us/settings.js":[550500,50906],"./en-us/share-in-meetings.js":[null],"./en-us/share-to-teams-outlook-addin.js":[null],"./en-us/share-to-teams-third-party.js":[null],"./en-us/share-to-teams.js":[848498,335626],"./en-us/shortcut.js":[605988,50906],"./en-us/shortcuts.js":[69836,50906],"./en-us/simple-collab.js":[810995,50906],"./en-us/smart-device.js":[null],"./en-us/survey.js":[162863,667569],"./en-us/sv-flyout.js":[91097,50906],"./en-us/teams-and-channels.js":[55662,126819],"./en-us/teams-insider.js":[200231,50906],"./en-us/telemetry.js":[553318,50906],"./en-us/tfl-homepage.js":[648010,50906],"./en-us/tfl-onboarding.js":[308585,50906],"./en-us/toast-notifications.js":[622802,50906],"./en-us/trusted-ui.js":[null],"./en-us/unified-search.js":[593988,335626],"./en-us/unsupported-browser.js":[null],"./en-us/url-preview.js":[645425,50906],"./en-us/video-capture.js":[961970,745303],"./en-us/video-message.js":[989906,612083],"./en-us/virtual-consumer-events.js":[682937,186413],"./en-us/virtual-events.js":[822136,548906],"./en-us/webinar.js":[689665,621372],"./en-us/welcome-bot.js":[null],"./en-us/whats-new.js":[335216,50906],"./en-us/wiki.js":[null],"./es-es/activity.js":[311245,880184],"./es-es/artifacts-platform.js":[274746,467608],"./es-es/audience-view-dialog.js":[125212,376583],"./es-es/auth.js":[459692,880184],"./es-es/autosuggest.js":[717371,880184],"./es-es/avatar.js":[580284,880184],"./es-es/biometric-enrollment.js":[241924,995859],"./es-es/breakout-rooms.js":[759383,917196],"./es-es/broadcast.js":[754019,21033],"./es-es/calendar.js":[951608,283992],"./es-es/calling.js":[930887,544570],"./es-es/campaign-notifications.js":[12963,880184],"./es-es/carousel-multi-card.js":[null],"./es-es/cast.js":[388307,880184],"./es-es/channels.js":[405974,880184],"./es-es/chat-list.js":[656660,880184],"./es-es/coach-report.js":[492773,602943],"./es-es/comment-stream.js":[567394,664258],"./es-es/communities.js":[30194,880184],"./es-es/compose.js":[622715,880184],"./es-es/contacts.js":[253980,880184],"./es-es/datepicker.js":[644563,786549],"./es-es/desktop.js":[null],"./es-es/digital-signage.js":[null],"./es-es/discover-surface.js":[565157,305777],"./es-es/edu.js":[50357,50302],"./es-es/embed.js":[457267,880184],"./es-es/errors.js":[926137,880184],"./es-es/esp.js":[494736,76605],"./es-es/extensibility-ptz-extension.js":[null],"./es-es/extensibility-room-remote.js":[null],"./es-es/extensibility.js":[303399,880184],"./es-es/feedback.js":[926456,109433],"./es-es/files.js":[432527,880184],"./es-es/framework.js":[481449,880184],"./es-es/freemium-upgrade.js":[null],"./es-es/freemium.js":[152169,544570],"./es-es/funstuff.js":[772684,638860],"./es-es/gallery.js":[448441,246477],"./es-es/growth.js":[921072,880184],"./es-es/guardians.js":[84722,336153],"./es-es/health.js":[959169,156354],"./es-es/help.js":[null],"./es-es/hololens.js":[638974,544570],"./es-es/host-controls.js":[806893,182353],"./es-es/jana.js":[449054,2729],"./es-es/lightbox.js":[280407,880184],"./es-es/live-persona-card.js":[483468,880184],"./es-es/live-persona-editor.js":[557168,712936],"./es-es/lms-integration.js":[null],"./es-es/meet-for-work.js":[68554,347038],"./es-es/meeting-analytics.js":[906702,553069],"./es-es/meeting-apis-app.js":[null],"./es-es/meeting-bot.js":[null],"./es-es/meeting-collaboration.js":[147099,254970],"./es-es/meeting-flyout.js":[617018,880184],"./es-es/meeting-meet-app.js":[923198,880184],"./es-es/meeting-options.js":[173523,500140],"./es-es/meeting-recap.js":[936362,776418],"./es-es/meeting-room-console.js":[null],"./es-es/meeting-stream-app.js":[null],"./es-es/message-escalate-dialog.js":[771418,119233],"./es-es/messaging.js":[899921,880184],"./es-es/mobile-attach.js":[null],"./es-es/mtma-missed-notifications.js":[293308,880184],"./es-es/nova.js":[890684,880184],"./es-es/people-app.js":[null],"./es-es/people-picker.js":[671397,880184],"./es-es/people-targeting.js":[549834,871409],"./es-es/people.js":[113407,880184],"./es-es/person.js":[59952,880184],"./es-es/phonelink-sms.js":[143547,953707],"./es-es/pre-core.js":[null],"./es-es/premium-benefits.js":[134436,369295],"./es-es/presence.js":[746729,880184],"./es-es/queues.js":[124461,319516],"./es-es/recurrence.js":[316710,458276],"./es-es/rsc-application-permissions.js":[null],"./es-es/search.js":[83360,786549],"./es-es/semantic-object.js":[538243,404904],"./es-es/settings.js":[41280,880184],"./es-es/share-in-meetings.js":[null],"./es-es/share-to-teams-outlook-addin.js":[null],"./es-es/share-to-teams-third-party.js":[null],"./es-es/share-to-teams.js":[183534,959258],"./es-es/shortcut.js":[933922,880184],"./es-es/shortcuts.js":[777648,880184],"./es-es/simple-collab.js":[346473,880184],"./es-es/smart-device.js":[null],"./es-es/survey.js":[227518,705170],"./es-es/sv-flyout.js":[257902,880184],"./es-es/teams-and-channels.js":[322393,673773],"./es-es/teams-insider.js":[491810,880184],"./es-es/telemetry.js":[671230,880184],"./es-es/tfl-homepage.js":[988960,880184],"./es-es/tfl-onboarding.js":[905246,880184],"./es-es/toast-notifications.js":[731874,880184],"./es-es/trusted-ui.js":[null],"./es-es/unified-search.js":[223872,959258],"./es-es/unsupported-browser.js":[null],"./es-es/url-preview.js":[281735,880184],"./es-es/video-capture.js":[701394,345804],"./es-es/video-message.js":[668243,285783],"./es-es/virtual-consumer-events.js":[298904,467835],"./es-es/virtual-events.js":[179491,206431],"./es-es/webinar.js":[360716,898261],"./es-es/welcome-bot.js":[null],"./es-es/whats-new.js":[910271,880184],"./es-es/wiki.js":[null],"./es-mx/activity.js":[782151,102701],"./es-mx/artifacts-platform.js":[623093,176902],"./es-mx/audience-view-dialog.js":[350324,423859],"./es-mx/auth.js":[600229,102701],"./es-mx/autosuggest.js":[4074,102701],"./es-mx/avatar.js":[215e3,102701],"./es-mx/biometric-enrollment.js":[942753,156149],"./es-mx/breakout-rooms.js":[803811,481174],"./es-mx/broadcast.js":[490022,112502],"./es-mx/calendar.js":[580521,138885],"./es-mx/calling.js":[806645,457699],"./es-mx/campaign-notifications.js":[739180,102701],"./es-mx/carousel-multi-card.js":[null],"./es-mx/cast.js":[96347,102701],"./es-mx/channels.js":[731075,102701],"./es-mx/chat-list.js":[709393,102701],"./es-mx/coach-report.js":[534300,956210],"./es-mx/comment-stream.js":[512606,642439],"./es-mx/communities.js":[233269,102701],"./es-mx/compose.js":[924017,102701],"./es-mx/contacts.js":[42278,102701],"./es-mx/datepicker.js":[632446,849810],"./es-mx/desktop.js":[null],"./es-mx/digital-signage.js":[null],"./es-mx/discover-surface.js":[770587,688466],"./es-mx/edu.js":[961422,857709],"./es-mx/embed.js":[137572,102701],"./es-mx/errors.js":[186140,102701],"./es-mx/esp.js":[942730,315580],"./es-mx/extensibility-ptz-extension.js":[null],"./es-mx/extensibility-room-remote.js":[null],"./es-mx/extensibility.js":[22685,102701],"./es-mx/feedback.js":[383136,956260],"./es-mx/files.js":[214835,102701],"./es-mx/framework.js":[163817,102701],"./es-mx/freemium-upgrade.js":[null],"./es-mx/freemium.js":[766512,457699],"./es-mx/funstuff.js":[253692,93734],"./es-mx/gallery.js":[202797,311136],"./es-mx/growth.js":[785826,102701],"./es-mx/guardians.js":[882238,858686],"./es-mx/health.js":[495256,587846],"./es-mx/help.js":[null],"./es-mx/hololens.js":[336898,457699],"./es-mx/host-controls.js":[890233,443188],"./es-mx/jana.js":[416341,412981],"./es-mx/lightbox.js":[34357,102701],"./es-mx/live-persona-card.js":[882517,102701],"./es-mx/live-persona-editor.js":[758329,234038],"./es-mx/lms-integration.js":[null],"./es-mx/meet-for-work.js":[717823,418185],"./es-mx/meeting-analytics.js":[933253,547331],"./es-mx/meeting-apis-app.js":[null],"./es-mx/meeting-bot.js":[null],"./es-mx/meeting-collaboration.js":[266842,226590],"./es-mx/meeting-flyout.js":[957743,102701],"./es-mx/meeting-meet-app.js":[546333,102701],"./es-mx/meeting-options.js":[283775,440553],"./es-mx/meeting-recap.js":[412142,98289],"./es-mx/meeting-room-console.js":[null],"./es-mx/meeting-stream-app.js":[null],"./es-mx/message-escalate-dialog.js":[409086,535376],"./es-mx/messaging.js":[332222,102701],"./es-mx/mobile-attach.js":[null],"./es-mx/mtma-missed-notifications.js":[428406,102701],"./es-mx/nova.js":[99140,102701],"./es-mx/people-app.js":[null],"./es-mx/people-picker.js":[740055,102701],"./es-mx/people-targeting.js":[566666,694543],"./es-mx/people.js":[65897,102701],"./es-mx/person.js":[946411,102701],"./es-mx/phonelink-sms.js":[526293,536494],"./es-mx/pre-core.js":[null],"./es-mx/premium-benefits.js":[453134,330165],"./es-mx/presence.js":[820291,102701],"./es-mx/queues.js":[804690,845483],"./es-mx/recurrence.js":[602910,8275],"./es-mx/rsc-application-permissions.js":[null],"./es-mx/search.js":[95644,849810],"./es-mx/semantic-object.js":[142505,667442],"./es-mx/settings.js":[708340,102701],"./es-mx/share-in-meetings.js":[null],"./es-mx/share-to-teams-outlook-addin.js":[null],"./es-mx/share-to-teams-third-party.js":[null],"./es-mx/share-to-teams.js":[647085,446402],"./es-mx/shortcut.js":[549203,102701],"./es-mx/shortcuts.js":[683284,102701],"./es-mx/simple-collab.js":[196356,102701],"./es-mx/smart-device.js":[null],"./es-mx/survey.js":[697422,610501],"./es-mx/sv-flyout.js":[253764,102701],"./es-mx/teams-and-channels.js":[964913,782856],"./es-mx/teams-insider.js":[18498,102701],"./es-mx/telemetry.js":[777616,102701],"./es-mx/tfl-homepage.js":[747618,102701],"./es-mx/tfl-onboarding.js":[971189,102701],"./es-mx/toast-notifications.js":[45891,102701],"./es-mx/trusted-ui.js":[null],"./es-mx/unified-search.js":[81793,446402],"./es-mx/unsupported-browser.js":[null],"./es-mx/url-preview.js":[381097,102701],"./es-mx/video-capture.js":[127209,488029],"./es-mx/video-message.js":[758468,828853],"./es-mx/virtual-consumer-events.js":[605821,378894],"./es-mx/virtual-events.js":[644445,45157],"./es-mx/webinar.js":[94914,433454],"./es-mx/welcome-bot.js":[null],"./es-mx/whats-new.js":[93340,102701],"./es-mx/wiki.js":[null],"./et-ee/activity.js":[186694,468304],"./et-ee/artifacts-platform.js":[159365,150399],"./et-ee/audience-view-dialog.js":[881077,161768],"./et-ee/auth.js":[14293,468304],"./et-ee/autosuggest.js":[282832,468304],"./et-ee/avatar.js":[402085,468304],"./et-ee/biometric-enrollment.js":[838819,96148],"./et-ee/breakout-rooms.js":[891978,2101],"./et-ee/broadcast.js":[738635,420957],"./et-ee/calendar.js":[991415,700075],"./et-ee/calling.js":[526163,646978],"./et-ee/campaign-notifications.js":[264015,468304],"./et-ee/carousel-multi-card.js":[null],"./et-ee/cast.js":[148416,468304],"./et-ee/channels.js":[754586,468304],"./et-ee/chat-list.js":[579300,468304],"./et-ee/coach-report.js":[390260,346839],"./et-ee/comment-stream.js":[596931,85136],"./et-ee/communities.js":[571387,468304],"./et-ee/compose.js":[241010,468304],"./et-ee/contacts.js":[186490,468304],"./et-ee/datepicker.js":[82211,594819],"./et-ee/desktop.js":[null],"./et-ee/digital-signage.js":[null],"./et-ee/discover-surface.js":[941302,828178],"./et-ee/edu.js":[565355,455536],"./et-ee/embed.js":[365862,468304],"./et-ee/errors.js":[936183,468304],"./et-ee/esp.js":[799e3,819521],"./et-ee/extensibility-ptz-extension.js":[null],"./et-ee/extensibility-room-remote.js":[null],"./et-ee/extensibility.js":[211870,468304],"./et-ee/feedback.js":[815274,136954],"./et-ee/files.js":[639447,468304],"./et-ee/framework.js":[495682,468304],"./et-ee/freemium-upgrade.js":[null],"./et-ee/freemium.js":[13787,646978],"./et-ee/funstuff.js":[366681,555695],"./et-ee/gallery.js":[194436,774224],"./et-ee/growth.js":[246362,468304],"./et-ee/guardians.js":[45202,156275],"./et-ee/health.js":[34780,954964],"./et-ee/help.js":[null],"./et-ee/hololens.js":[370602,646978],"./et-ee/host-controls.js":[556909,298789],"./et-ee/jana.js":[397604,195484],"./et-ee/lightbox.js":[609622,468304],"./et-ee/live-persona-card.js":[551955,468304],"./et-ee/live-persona-editor.js":[368756,147679],"./et-ee/lms-integration.js":[null],"./et-ee/meet-for-work.js":[543448,523041],"./et-ee/meeting-analytics.js":[582659,958359],"./et-ee/meeting-apis-app.js":[null],"./et-ee/meeting-bot.js":[null],"./et-ee/meeting-collaboration.js":[760020,760438],"./et-ee/meeting-flyout.js":[553895,468304],"./et-ee/meeting-meet-app.js":[428283,468304],"./et-ee/meeting-options.js":[185354,596007],"./et-ee/meeting-recap.js":[503380,397822],"./et-ee/meeting-room-console.js":[null],"./et-ee/meeting-stream-app.js":[null],"./et-ee/message-escalate-dialog.js":[972309,63434],"./et-ee/messaging.js":[492704,468304],"./et-ee/mobile-attach.js":[null],"./et-ee/mtma-missed-notifications.js":[200559,468304],"./et-ee/nova.js":[122903,468304],"./et-ee/people-app.js":[null],"./et-ee/people-picker.js":[854962,468304],"./et-ee/people-targeting.js":[793712,350138],"./et-ee/people.js":[318868,468304],"./et-ee/person.js":[704959,468304],"./et-ee/phonelink-sms.js":[285472,376522],"./et-ee/pre-core.js":[null],"./et-ee/premium-benefits.js":[477205,479569],"./et-ee/presence.js":[895574,468304],"./et-ee/queues.js":[55115,940782],"./et-ee/recurrence.js":[689783,68074],"./et-ee/rsc-application-permissions.js":[null],"./et-ee/search.js":[429304,594819],"./et-ee/semantic-object.js":[722356,145898],"./et-ee/settings.js":[777258,468304],"./et-ee/share-in-meetings.js":[null],"./et-ee/share-to-teams-outlook-addin.js":[null],"./et-ee/share-to-teams-third-party.js":[null],"./et-ee/share-to-teams.js":[182010,803184],"./et-ee/shortcut.js":[718532,468304],"./et-ee/shortcuts.js":[222830,468304],"./et-ee/simple-collab.js":[26462,468304],"./et-ee/smart-device.js":[null],"./et-ee/survey.js":[394068,314309],"./et-ee/sv-flyout.js":[222721,468304],"./et-ee/teams-and-channels.js":[757738,382703],"./et-ee/teams-insider.js":[548846,468304],"./et-ee/telemetry.js":[983945,468304],"./et-ee/tfl-homepage.js":[267393,468304],"./et-ee/tfl-onboarding.js":[282677,468304],"./et-ee/toast-notifications.js":[290039,468304],"./et-ee/trusted-ui.js":[null],"./et-ee/unified-search.js":[143886,803184],"./et-ee/unsupported-browser.js":[null],"./et-ee/url-preview.js":[309119,468304],"./et-ee/video-capture.js":[509784,732751],"./et-ee/video-message.js":[863588,942049],"./et-ee/virtual-consumer-events.js":[899185,895757],"./et-ee/virtual-events.js":[933503,94155],"./et-ee/webinar.js":[442460,713750],"./et-ee/welcome-bot.js":[null],"./et-ee/whats-new.js":[733289,468304],"./et-ee/wiki.js":[null],"./eu-es/activity.js":[112246,324278],"./eu-es/artifacts-platform.js":[570130,238820],"./eu-es/audience-view-dialog.js":[408049,105082],"./eu-es/auth.js":[939156,324278],"./eu-es/autosuggest.js":[822101,324278],"./eu-es/avatar.js":[823511,324278],"./eu-es/biometric-enrollment.js":[279216,60684],"./eu-es/breakout-rooms.js":[10731,921995],"./eu-es/broadcast.js":[38816,962457],"./eu-es/calendar.js":[368562,417253],"./eu-es/calling.js":[653569,682522],"./eu-es/campaign-notifications.js":[323023,324278],"./eu-es/carousel-multi-card.js":[null],"./eu-es/cast.js":[405943,324278],"./eu-es/channels.js":[996216,324278],"./eu-es/chat-list.js":[835853,324278],"./eu-es/coach-report.js":[339176,784224],"./eu-es/comment-stream.js":[229906,526493],"./eu-es/communities.js":[731942,324278],"./eu-es/compose.js":[391961,324278],"./eu-es/contacts.js":[210179,324278],"./eu-es/datepicker.js":[419554,330078],"./eu-es/desktop.js":[null],"./eu-es/digital-signage.js":[null],"./eu-es/discover-surface.js":[623202,494973],"./eu-es/edu.js":[49911,425645],"./eu-es/embed.js":[935938,324278],"./eu-es/errors.js":[114269,324278],"./eu-es/esp.js":[683922,833665],"./eu-es/extensibility-ptz-extension.js":[null],"./eu-es/extensibility-room-remote.js":[null],"./eu-es/extensibility.js":[23633,324278],"./eu-es/feedback.js":[804898,879882],"./eu-es/files.js":[439641,324278],"./eu-es/framework.js":[651524,324278],"./eu-es/freemium-upgrade.js":[null],"./eu-es/freemium.js":[112846,682522],"./eu-es/funstuff.js":[867807,439738],"./eu-es/gallery.js":[245213,183393],"./eu-es/growth.js":[83898,324278],"./eu-es/guardians.js":[991313,323246],"./eu-es/health.js":[547773,993305],"./eu-es/help.js":[null],"./eu-es/hololens.js":[572081,682522],"./eu-es/host-controls.js":[908222,828268],"./eu-es/jana.js":[961316,548049],"./eu-es/lightbox.js":[543936,324278],"./eu-es/live-persona-card.js":[55273,324278],"./eu-es/live-persona-editor.js":[896440,361607],"./eu-es/lms-integration.js":[null],"./eu-es/meet-for-work.js":[158655,516703],"./eu-es/meeting-analytics.js":[122863,481897],"./eu-es/meeting-apis-app.js":[null],"./eu-es/meeting-bot.js":[null],"./eu-es/meeting-collaboration.js":[409616,876316],"./eu-es/meeting-flyout.js":[685555,324278],"./eu-es/meeting-meet-app.js":[157518,324278],"./eu-es/meeting-options.js":[974300,397782],"./eu-es/meeting-recap.js":[341363,43342],"./eu-es/meeting-room-console.js":[null],"./eu-es/meeting-stream-app.js":[null],"./eu-es/message-escalate-dialog.js":[83667,506841],"./eu-es/messaging.js":[614744,324278],"./eu-es/mobile-attach.js":[null],"./eu-es/mtma-missed-notifications.js":[292923,324278],"./eu-es/nova.js":[716964,324278],"./eu-es/people-app.js":[null],"./eu-es/people-picker.js":[771884,324278],"./eu-es/people-targeting.js":[886710,388216],"./eu-es/people.js":[780611,324278],"./eu-es/person.js":[744885,324278],"./eu-es/phonelink-sms.js":[412918,242666],"./eu-es/pre-core.js":[null],"./eu-es/premium-benefits.js":[946373,560551],"./eu-es/presence.js":[211874,324278],"./eu-es/queues.js":[931878,960489],"./eu-es/recurrence.js":[766539,343642],"./eu-es/rsc-application-permissions.js":[null],"./eu-es/search.js":[743441,330078],"./eu-es/semantic-object.js":[770134,82023],"./eu-es/settings.js":[426180,324278],"./eu-es/share-in-meetings.js":[null],"./eu-es/share-to-teams-outlook-addin.js":[null],"./eu-es/share-to-teams-third-party.js":[null],"./eu-es/share-to-teams.js":[394733,862982],"./eu-es/shortcut.js":[20595,324278],"./eu-es/shortcuts.js":[462886,324278],"./eu-es/simple-collab.js":[95338,324278],"./eu-es/smart-device.js":[null],"./eu-es/survey.js":[566436,873166],"./eu-es/sv-flyout.js":[534981,324278],"./eu-es/teams-and-channels.js":[714714,795691],"./eu-es/teams-insider.js":[122871,324278],"./eu-es/telemetry.js":[99825,324278],"./eu-es/tfl-homepage.js":[73189,324278],"./eu-es/tfl-onboarding.js":[481947,324278],"./eu-es/toast-notifications.js":[28128,324278],"./eu-es/trusted-ui.js":[null],"./eu-es/unified-search.js":[312528,862982],"./eu-es/unsupported-browser.js":[null],"./eu-es/url-preview.js":[388353,324278],"./eu-es/video-capture.js":[146239,393786],"./eu-es/video-message.js":[372996,926946],"./eu-es/virtual-consumer-events.js":[137571,190426],"./eu-es/virtual-events.js":[173079,693916],"./eu-es/webinar.js":[381415,992680],"./eu-es/welcome-bot.js":[null],"./eu-es/whats-new.js":[667931,324278],"./eu-es/wiki.js":[null],"./fi-fi/activity.js":[426357,416211],"./fi-fi/artifacts-platform.js":[375712,615798],"./fi-fi/audience-view-dialog.js":[454980,294122],"./fi-fi/auth.js":[425239,416211],"./fi-fi/autosuggest.js":[558789,416211],"./fi-fi/avatar.js":[176776,416211],"./fi-fi/biometric-enrollment.js":[72159,223035],"./fi-fi/breakout-rooms.js":[634632,156721],"./fi-fi/broadcast.js":[863833,660347],"./fi-fi/calendar.js":[772100,322125],"./fi-fi/calling.js":[790322,379316],"./fi-fi/campaign-notifications.js":[571937,416211],"./fi-fi/carousel-multi-card.js":[null],"./fi-fi/cast.js":[710808,416211],"./fi-fi/channels.js":[611536,416211],"./fi-fi/chat-list.js":[775782,416211],"./fi-fi/coach-report.js":[513031,98725],"./fi-fi/comment-stream.js":[353478,439809],"./fi-fi/communities.js":[809302,416211],"./fi-fi/compose.js":[742372,416211],"./fi-fi/contacts.js":[484913,416211],"./fi-fi/datepicker.js":[102489,478746],"./fi-fi/desktop.js":[null],"./fi-fi/digital-signage.js":[null],"./fi-fi/discover-surface.js":[396425,847794],"./fi-fi/edu.js":[282388,241544],"./fi-fi/embed.js":[926855,416211],"./fi-fi/errors.js":[604984,416211],"./fi-fi/esp.js":[425519,37364],"./fi-fi/extensibility-ptz-extension.js":[null],"./fi-fi/extensibility-room-remote.js":[null],"./fi-fi/extensibility.js":[724029,416211],"./fi-fi/feedback.js":[926516,939701],"./fi-fi/files.js":[864567,416211],"./fi-fi/framework.js":[351030,416211],"./fi-fi/freemium-upgrade.js":[null],"./fi-fi/freemium.js":[307589,379316],"./fi-fi/funstuff.js":[761401,936437],"./fi-fi/gallery.js":[537011,239117],"./fi-fi/growth.js":[295869,416211],"./fi-fi/guardians.js":[853678,756774],"./fi-fi/health.js":[241192,721941],"./fi-fi/help.js":[null],"./fi-fi/hololens.js":[756399,379316],"./fi-fi/host-controls.js":[276921,932703],"./fi-fi/jana.js":[138469,979448],"./fi-fi/lightbox.js":[17410,416211],"./fi-fi/live-persona-card.js":[974357,416211],"./fi-fi/live-persona-editor.js":[541998,957525],"./fi-fi/lms-integration.js":[null],"./fi-fi/meet-for-work.js":[908984,119371],"./fi-fi/meeting-analytics.js":[658574,265469],"./fi-fi/meeting-apis-app.js":[null],"./fi-fi/meeting-bot.js":[null],"./fi-fi/meeting-collaboration.js":[556451,784384],"./fi-fi/meeting-flyout.js":[683930,416211],"./fi-fi/meeting-meet-app.js":[800157,416211],"./fi-fi/meeting-options.js":[412314,380473],"./fi-fi/meeting-recap.js":[262934,854022],"./fi-fi/meeting-room-console.js":[null],"./fi-fi/meeting-stream-app.js":[null],"./fi-fi/message-escalate-dialog.js":[81392,247861],"./fi-fi/messaging.js":[879263,416211],"./fi-fi/mobile-attach.js":[null],"./fi-fi/mtma-missed-notifications.js":[951510,416211],"./fi-fi/nova.js":[639597,416211],"./fi-fi/people-app.js":[null],"./fi-fi/people-picker.js":[709714,416211],"./fi-fi/people-targeting.js":[197569,96380],"./fi-fi/people.js":[702526,416211],"./fi-fi/person.js":[636213,416211],"./fi-fi/phonelink-sms.js":[190043,411582],"./fi-fi/pre-core.js":[null],"./fi-fi/premium-benefits.js":[965837,312889],"./fi-fi/presence.js":[654615,416211],"./fi-fi/queues.js":[460865,209411],"./fi-fi/recurrence.js":[255619,647573],"./fi-fi/rsc-application-permissions.js":[null],"./fi-fi/search.js":[359217,478746],"./fi-fi/semantic-object.js":[842940,380293],"./fi-fi/settings.js":[951151,416211],"./fi-fi/share-in-meetings.js":[null],"./fi-fi/share-to-teams-outlook-addin.js":[null],"./fi-fi/share-to-teams-third-party.js":[null],"./fi-fi/share-to-teams.js":[340398,847663],"./fi-fi/shortcut.js":[90529,416211],"./fi-fi/shortcuts.js":[290214,416211],"./fi-fi/simple-collab.js":[850830,416211],"./fi-fi/smart-device.js":[null],"./fi-fi/survey.js":[90076,919353],"./fi-fi/sv-flyout.js":[81133,416211],"./fi-fi/teams-and-channels.js":[529514,228437],"./fi-fi/teams-insider.js":[477124,416211],"./fi-fi/telemetry.js":[194853,416211],"./fi-fi/tfl-homepage.js":[329033,416211],"./fi-fi/tfl-onboarding.js":[779145,416211],"./fi-fi/toast-notifications.js":[310196,416211],"./fi-fi/trusted-ui.js":[null],"./fi-fi/unified-search.js":[663361,847663],"./fi-fi/unsupported-browser.js":[null],"./fi-fi/url-preview.js":[607534,416211],"./fi-fi/video-capture.js":[90196,166433],"./fi-fi/video-message.js":[741061,626886],"./fi-fi/virtual-consumer-events.js":[697749,179299],"./fi-fi/virtual-events.js":[521103,360818],"./fi-fi/webinar.js":[452711,603683],"./fi-fi/welcome-bot.js":[null],"./fi-fi/whats-new.js":[373916,416211],"./fi-fi/wiki.js":[null],"./fil-ph/activity.js":[273363,980117],"./fil-ph/artifacts-platform.js":[431944,761030],"./fil-ph/audience-view-dialog.js":[938274,351507],"./fil-ph/auth.js":[705927,980117],"./fil-ph/autosuggest.js":[83075,980117],"./fil-ph/avatar.js":[578622,980117],"./fil-ph/biometric-enrollment.js":[969410,471920],"./fil-ph/breakout-rooms.js":[476595,282982],"./fil-ph/broadcast.js":[473904,941445],"./fil-ph/calendar.js":[246720,870913],"./fil-ph/calling.js":[771276,167083],"./fil-ph/campaign-notifications.js":[465539,980117],"./fil-ph/carousel-multi-card.js":[null],"./fil-ph/cast.js":[597460,980117],"./fil-ph/channels.js":[444221,980117],"./fil-ph/chat-list.js":[285882,980117],"./fil-ph/coach-report.js":[797145,350218],"./fil-ph/comment-stream.js":[691199,880142],"./fil-ph/communities.js":[93779,980117],"./fil-ph/compose.js":[722503,980117],"./fil-ph/contacts.js":[461293,980117],"./fil-ph/datepicker.js":[630231,845153],"./fil-ph/desktop.js":[null],"./fil-ph/digital-signage.js":[null],"./fil-ph/discover-surface.js":[658265,144178],"./fil-ph/edu.js":[873011,909647],"./fil-ph/embed.js":[4290,980117],"./fil-ph/errors.js":[699604,980117],"./fil-ph/esp.js":[446525,864422],"./fil-ph/extensibility-ptz-extension.js":[null],"./fil-ph/extensibility-room-remote.js":[null],"./fil-ph/extensibility.js":[552317,980117],"./fil-ph/feedback.js":[637553,335138],"./fil-ph/files.js":[324255,980117],"./fil-ph/framework.js":[812749,980117],"./fil-ph/freemium-upgrade.js":[null],"./fil-ph/freemium.js":[779542,167083],"./fil-ph/funstuff.js":[979310,284276],"./fil-ph/gallery.js":[853632,57510],"./fil-ph/growth.js":[970954,980117],"./fil-ph/guardians.js":[901554,962294],"./fil-ph/health.js":[300854,567017],"./fil-ph/help.js":[null],"./fil-ph/hololens.js":[925333,167083],"./fil-ph/host-controls.js":[215365,959009],"./fil-ph/jana.js":[333089,517637],"./fil-ph/lightbox.js":[767186,980117],"./fil-ph/live-persona-card.js":[604394,980117],"./fil-ph/live-persona-editor.js":[669600,299526],"./fil-ph/lms-integration.js":[null],"./fil-ph/meet-for-work.js":[706405,176194],"./fil-ph/meeting-analytics.js":[127860,187408],"./fil-ph/meeting-apis-app.js":[null],"./fil-ph/meeting-bot.js":[null],"./fil-ph/meeting-collaboration.js":[739924,590049],"./fil-ph/meeting-flyout.js":[836257,980117],"./fil-ph/meeting-meet-app.js":[183349,980117],"./fil-ph/meeting-options.js":[59820,961320],"./fil-ph/meeting-recap.js":[614620,900551],"./fil-ph/meeting-room-console.js":[null],"./fil-ph/meeting-stream-app.js":[null],"./fil-ph/message-escalate-dialog.js":[182286,700369],"./fil-ph/messaging.js":[102910,980117],"./fil-ph/mobile-attach.js":[null],"./fil-ph/mtma-missed-notifications.js":[925602,980117],"./fil-ph/nova.js":[757857,980117],"./fil-ph/people-app.js":[null],"./fil-ph/people-picker.js":[75778,980117],"./fil-ph/people-targeting.js":[326156,277233],"./fil-ph/people.js":[638275,980117],"./fil-ph/person.js":[920839,980117],"./fil-ph/phonelink-sms.js":[938381,346667],"./fil-ph/pre-core.js":[null],"./fil-ph/premium-benefits.js":[386105,421375],"./fil-ph/presence.js":[258313,980117],"./fil-ph/queues.js":[185374,877837],"./fil-ph/recurrence.js":[295980,200471],"./fil-ph/rsc-application-permissions.js":[null],"./fil-ph/search.js":[604374,845153],"./fil-ph/semantic-object.js":[623143,676317],"./fil-ph/settings.js":[827176,980117],"./fil-ph/share-in-meetings.js":[null],"./fil-ph/share-to-teams-outlook-addin.js":[null],"./fil-ph/share-to-teams-third-party.js":[null],"./fil-ph/share-to-teams.js":[987129,520351],"./fil-ph/shortcut.js":[607050,980117],"./fil-ph/shortcuts.js":[581576,980117],"./fil-ph/simple-collab.js":[874771,980117],"./fil-ph/smart-device.js":[null],"./fil-ph/survey.js":[495581,321346],"./fil-ph/sv-flyout.js":[810189,980117],"./fil-ph/teams-and-channels.js":[243085,157944],"./fil-ph/teams-insider.js":[804746,980117],"./fil-ph/telemetry.js":[617934,980117],"./fil-ph/tfl-homepage.js":[427964,980117],"./fil-ph/tfl-onboarding.js":[40927,980117],"./fil-ph/toast-notifications.js":[848107,980117],"./fil-ph/trusted-ui.js":[null],"./fil-ph/unified-search.js":[102366,520351],"./fil-ph/unsupported-browser.js":[null],"./fil-ph/url-preview.js":[374594,980117],"./fil-ph/video-capture.js":[864657,690531],"./fil-ph/video-message.js":[648792,653188],"./fil-ph/virtual-consumer-events.js":[321674,961739],"./fil-ph/virtual-events.js":[134480,443750],"./fil-ph/webinar.js":[76429,581249],"./fil-ph/welcome-bot.js":[null],"./fil-ph/whats-new.js":[183780,980117],"./fil-ph/wiki.js":[null],"./fr-ca/activity.js":[534619,57164],"./fr-ca/artifacts-platform.js":[182747,942595],"./fr-ca/audience-view-dialog.js":[909638,673321],"./fr-ca/auth.js":[549476,57164],"./fr-ca/autosuggest.js":[347724,57164],"./fr-ca/avatar.js":[465979,57164],"./fr-ca/biometric-enrollment.js":[500534,248098],"./fr-ca/breakout-rooms.js":[397153,387132],"./fr-ca/broadcast.js":[915395,967847],"./fr-ca/calendar.js":[103426,152287],"./fr-ca/calling.js":[828390,57069],"./fr-ca/campaign-notifications.js":[233962,57164],"./fr-ca/carousel-multi-card.js":[null],"./fr-ca/cast.js":[954416,57164],"./fr-ca/channels.js":[392389,57164],"./fr-ca/chat-list.js":[54650,57164],"./fr-ca/coach-report.js":[762860,145424],"./fr-ca/comment-stream.js":[85211,688502],"./fr-ca/communities.js":[950036,57164],"./fr-ca/compose.js":[762766,57164],"./fr-ca/contacts.js":[863311,57164],"./fr-ca/datepicker.js":[878690,480253],"./fr-ca/desktop.js":[null],"./fr-ca/digital-signage.js":[null],"./fr-ca/discover-surface.js":[466684,413768],"./fr-ca/edu.js":[68031,721231],"./fr-ca/embed.js":[528027,57164],"./fr-ca/errors.js":[875031,57164],"./fr-ca/esp.js":[131376,985381],"./fr-ca/extensibility-ptz-extension.js":[null],"./fr-ca/extensibility-room-remote.js":[null],"./fr-ca/extensibility.js":[415046,57164],"./fr-ca/feedback.js":[185715,157643],"./fr-ca/files.js":[191376,57164],"./fr-ca/framework.js":[695512,57164],"./fr-ca/freemium-upgrade.js":[null],"./fr-ca/freemium.js":[807110,57069],"./fr-ca/funstuff.js":[707710,889173],"./fr-ca/gallery.js":[180299,546713],"./fr-ca/growth.js":[286574,57164],"./fr-ca/guardians.js":[766222,961235],"./fr-ca/health.js":[25418,987110],"./fr-ca/help.js":[null],"./fr-ca/hololens.js":[804749,57069],"./fr-ca/host-controls.js":[50436,97463],"./fr-ca/jana.js":[805195,381748],"./fr-ca/lightbox.js":[279371,57164],"./fr-ca/live-persona-card.js":[459093,57164],"./fr-ca/live-persona-editor.js":[85037,618903],"./fr-ca/lms-integration.js":[null],"./fr-ca/meet-for-work.js":[215465,734966],"./fr-ca/meeting-analytics.js":[836961,985340],"./fr-ca/meeting-apis-app.js":[null],"./fr-ca/meeting-bot.js":[null],"./fr-ca/meeting-collaboration.js":[93741,591366],"./fr-ca/meeting-flyout.js":[504710,57164],"./fr-ca/meeting-meet-app.js":[605261,57164],"./fr-ca/meeting-options.js":[322593,182222],"./fr-ca/meeting-recap.js":[463886,300211],"./fr-ca/meeting-room-console.js":[null],"./fr-ca/meeting-stream-app.js":[null],"./fr-ca/message-escalate-dialog.js":[741545,941787],"./fr-ca/messaging.js":[44231,57164],"./fr-ca/mobile-attach.js":[null],"./fr-ca/mtma-missed-notifications.js":[760332,57164],"./fr-ca/nova.js":[122504,57164],"./fr-ca/people-app.js":[null],"./fr-ca/people-picker.js":[474569,57164],"./fr-ca/people-targeting.js":[74142,159360],"./fr-ca/people.js":[486606,57164],"./fr-ca/person.js":[384905,57164],"./fr-ca/phonelink-sms.js":[561103,908400],"./fr-ca/pre-core.js":[null],"./fr-ca/premium-benefits.js":[240612,976121],"./fr-ca/presence.js":[669008,57164],"./fr-ca/queues.js":[396577,392968],"./fr-ca/recurrence.js":[520121,775123],"./fr-ca/rsc-application-permissions.js":[null],"./fr-ca/search.js":[820388,480253],"./fr-ca/semantic-object.js":[830692,981879],"./fr-ca/settings.js":[106300,57164],"./fr-ca/share-in-meetings.js":[null],"./fr-ca/share-to-teams-outlook-addin.js":[null],"./fr-ca/share-to-teams-third-party.js":[null],"./fr-ca/share-to-teams.js":[491806,792966],"./fr-ca/shortcut.js":[238473,57164],"./fr-ca/shortcuts.js":[460926,57164],"./fr-ca/simple-collab.js":[688290,57164],"./fr-ca/smart-device.js":[null],"./fr-ca/survey.js":[759606,257760],"./fr-ca/sv-flyout.js":[337127,57164],"./fr-ca/teams-and-channels.js":[470546,519135],"./fr-ca/teams-insider.js":[309874,57164],"./fr-ca/telemetry.js":[497224,57164],"./fr-ca/tfl-homepage.js":[885240,57164],"./fr-ca/tfl-onboarding.js":[710196,57164],"./fr-ca/toast-notifications.js":[779927,57164],"./fr-ca/trusted-ui.js":[null],"./fr-ca/unified-search.js":[21756,792966],"./fr-ca/unsupported-browser.js":[null],"./fr-ca/url-preview.js":[49769,57164],"./fr-ca/video-capture.js":[259914,24493],"./fr-ca/video-message.js":[311355,583527],"./fr-ca/virtual-consumer-events.js":[903687,766368],"./fr-ca/virtual-events.js":[324895,953578],"./fr-ca/webinar.js":[683620,682831],"./fr-ca/welcome-bot.js":[null],"./fr-ca/whats-new.js":[395533,57164],"./fr-ca/wiki.js":[null],"./fr-fr/activity.js":[896049,760325],"./fr-fr/artifacts-platform.js":[210992,553802],"./fr-fr/audience-view-dialog.js":[444291,731953],"./fr-fr/auth.js":[51073,760325],"./fr-fr/autosuggest.js":[911025,760325],"./fr-fr/avatar.js":[653487,760325],"./fr-fr/biometric-enrollment.js":[610251,737249],"./fr-fr/breakout-rooms.js":[545472,697328],"./fr-fr/broadcast.js":[601885,617794],"./fr-fr/calendar.js":[603217,744778],"./fr-fr/calling.js":[43915,500637],"./fr-fr/campaign-notifications.js":[879295,760325],"./fr-fr/carousel-multi-card.js":[null],"./fr-fr/cast.js":[976631,760325],"./fr-fr/channels.js":[468332,760325],"./fr-fr/chat-list.js":[917655,760325],"./fr-fr/coach-report.js":[107122,504858],"./fr-fr/comment-stream.js":[900094,525040],"./fr-fr/communities.js":[459251,760325],"./fr-fr/compose.js":[134120,760325],"./fr-fr/contacts.js":[802889,760325],"./fr-fr/datepicker.js":[441859,939090],"./fr-fr/desktop.js":[null],"./fr-fr/digital-signage.js":[null],"./fr-fr/discover-surface.js":[251526,760323],"./fr-fr/edu.js":[462012,244357],"./fr-fr/embed.js":[182396,760325],"./fr-fr/errors.js":[905818,760325],"./fr-fr/esp.js":[786857,534179],"./fr-fr/extensibility-ptz-extension.js":[null],"./fr-fr/extensibility-room-remote.js":[null],"./fr-fr/extensibility.js":[443598,760325],"./fr-fr/feedback.js":[886410,846064],"./fr-fr/files.js":[569471,760325],"./fr-fr/framework.js":[956931,760325],"./fr-fr/freemium-upgrade.js":[null],"./fr-fr/freemium.js":[94268,500637],"./fr-fr/funstuff.js":[495557,630898],"./fr-fr/gallery.js":[977803,558035],"./fr-fr/growth.js":[480795,760325],"./fr-fr/guardians.js":[277551,142469],"./fr-fr/health.js":[816300,917706],"./fr-fr/help.js":[null],"./fr-fr/hololens.js":[413765,500637],"./fr-fr/host-controls.js":[39592,739134],"./fr-fr/jana.js":[245645,313401],"./fr-fr/lightbox.js":[915013,760325],"./fr-fr/live-persona-card.js":[616866,760325],"./fr-fr/live-persona-editor.js":[671122,949358],"./fr-fr/lms-integration.js":[null],"./fr-fr/meet-for-work.js":[366905,588890],"./fr-fr/meeting-analytics.js":[607816,60785],"./fr-fr/meeting-apis-app.js":[null],"./fr-fr/meeting-bot.js":[null],"./fr-fr/meeting-collaboration.js":[554827,120352],"./fr-fr/meeting-flyout.js":[834686,760325],"./fr-fr/meeting-meet-app.js":[648821,760325],"./fr-fr/meeting-options.js":[804758,628087],"./fr-fr/meeting-recap.js":[235798,443436],"./fr-fr/meeting-room-console.js":[null],"./fr-fr/meeting-stream-app.js":[null],"./fr-fr/message-escalate-dialog.js":[342257,181239],"./fr-fr/messaging.js":[936121,760325],"./fr-fr/mobile-attach.js":[null],"./fr-fr/mtma-missed-notifications.js":[324702,760325],"./fr-fr/nova.js":[690761,760325],"./fr-fr/people-app.js":[null],"./fr-fr/people-picker.js":[390128,760325],"./fr-fr/people-targeting.js":[346755,113739],"./fr-fr/people.js":[240293,760325],"./fr-fr/person.js":[56327,760325],"./fr-fr/phonelink-sms.js":[81994,560834],"./fr-fr/pre-core.js":[null],"./fr-fr/premium-benefits.js":[255790,450757],"./fr-fr/presence.js":[103282,760325],"./fr-fr/queues.js":[298347,306284],"./fr-fr/recurrence.js":[364561,538552],"./fr-fr/rsc-application-permissions.js":[null],"./fr-fr/search.js":[756845,939090],"./fr-fr/semantic-object.js":[517889,893870],"./fr-fr/settings.js":[332867,760325],"./fr-fr/share-in-meetings.js":[null],"./fr-fr/share-to-teams-outlook-addin.js":[null],"./fr-fr/share-to-teams-third-party.js":[null],"./fr-fr/share-to-teams.js":[938173,102774],"./fr-fr/shortcut.js":[82892,760325],"./fr-fr/shortcuts.js":[422350,760325],"./fr-fr/simple-collab.js":[730721,760325],"./fr-fr/smart-device.js":[null],"./fr-fr/survey.js":[433828,687844],"./fr-fr/sv-flyout.js":[202953,760325],"./fr-fr/teams-and-channels.js":[717977,454067],"./fr-fr/teams-insider.js":[505781,760325],"./fr-fr/telemetry.js":[922195,760325],"./fr-fr/tfl-homepage.js":[551168,760325],"./fr-fr/tfl-onboarding.js":[998303,760325],"./fr-fr/toast-notifications.js":[325212,760325],"./fr-fr/trusted-ui.js":[null],"./fr-fr/unified-search.js":[415529,102774],"./fr-fr/unsupported-browser.js":[null],"./fr-fr/url-preview.js":[162812,760325],"./fr-fr/video-capture.js":[120220,343970],"./fr-fr/video-message.js":[386549,754509],"./fr-fr/virtual-consumer-events.js":[758118,518363],"./fr-fr/virtual-events.js":[587595,630669],"./fr-fr/webinar.js":[32433,278800],"./fr-fr/welcome-bot.js":[null],"./fr-fr/whats-new.js":[425571,760325],"./fr-fr/wiki.js":[null],"./gl-es/activity.js":[967858,334496],"./gl-es/artifacts-platform.js":[250142,340600],"./gl-es/audience-view-dialog.js":[608600,716089],"./gl-es/auth.js":[464651,334496],"./gl-es/autosuggest.js":[597358,334496],"./gl-es/avatar.js":[232794,334496],"./gl-es/biometric-enrollment.js":[12414,196057],"./gl-es/breakout-rooms.js":[843392,489703],"./gl-es/broadcast.js":[432191,6942],"./gl-es/calendar.js":[462507,149590],"./gl-es/calling.js":[933004,221833],"./gl-es/campaign-notifications.js":[887716,334496],"./gl-es/carousel-multi-card.js":[null],"./gl-es/cast.js":[480749,334496],"./gl-es/channels.js":[646590,334496],"./gl-es/chat-list.js":[483567,334496],"./gl-es/coach-report.js":[928445,165518],"./gl-es/comment-stream.js":[337997,137546],"./gl-es/communities.js":[145324,334496],"./gl-es/compose.js":[664900,334496],"./gl-es/contacts.js":[857367,334496],"./gl-es/datepicker.js":[95348,269971],"./gl-es/desktop.js":[null],"./gl-es/digital-signage.js":[null],"./gl-es/discover-surface.js":[603112,810970],"./gl-es/edu.js":[133824,826569],"./gl-es/embed.js":[555796,334496],"./gl-es/errors.js":[27039,334496],"./gl-es/esp.js":[836739,531908],"./gl-es/extensibility-ptz-extension.js":[null],"./gl-es/extensibility-room-remote.js":[null],"./gl-es/extensibility.js":[297867,334496],"./gl-es/feedback.js":[780277,354972],"./gl-es/files.js":[808151,334496],"./gl-es/framework.js":[115333,334496],"./gl-es/freemium-upgrade.js":[null],"./gl-es/freemium.js":[135525,221833],"./gl-es/funstuff.js":[814974,158412],"./gl-es/gallery.js":[256650,157449],"./gl-es/growth.js":[146990,334496],"./gl-es/guardians.js":[231265,674687],"./gl-es/health.js":[969855,693762],"./gl-es/help.js":[null],"./gl-es/hololens.js":[306819,221833],"./gl-es/host-controls.js":[628762,715815],"./gl-es/jana.js":[516835,16616],"./gl-es/lightbox.js":[557918,334496],"./gl-es/live-persona-card.js":[463133,334496],"./gl-es/live-persona-editor.js":[892326,810259],"./gl-es/lms-integration.js":[null],"./gl-es/meet-for-work.js":[947535,998529],"./gl-es/meeting-analytics.js":[397258,505954],"./gl-es/meeting-apis-app.js":[null],"./gl-es/meeting-bot.js":[null],"./gl-es/meeting-collaboration.js":[708191,99986],"./gl-es/meeting-flyout.js":[537582,334496],"./gl-es/meeting-meet-app.js":[912247,334496],"./gl-es/meeting-options.js":[323492,388787],"./gl-es/meeting-recap.js":[784024,351403],"./gl-es/meeting-room-console.js":[null],"./gl-es/meeting-stream-app.js":[null],"./gl-es/message-escalate-dialog.js":[653603,690766],"./gl-es/messaging.js":[335954,334496],"./gl-es/mobile-attach.js":[null],"./gl-es/mtma-missed-notifications.js":[896775,334496],"./gl-es/nova.js":[802173,334496],"./gl-es/people-app.js":[null],"./gl-es/people-picker.js":[945315,334496],"./gl-es/people-targeting.js":[360847,118228],"./gl-es/people.js":[524042,334496],"./gl-es/person.js":[249028,334496],"./gl-es/phonelink-sms.js":[505684,957541],"./gl-es/pre-core.js":[null],"./gl-es/premium-benefits.js":[49816,57736],"./gl-es/presence.js":[564002,334496],"./gl-es/queues.js":[332160,388997],"./gl-es/recurrence.js":[876569,670200],"./gl-es/rsc-application-permissions.js":[null],"./gl-es/search.js":[32893,269971],"./gl-es/semantic-object.js":[865204,333981],"./gl-es/settings.js":[912160,334496],"./gl-es/share-in-meetings.js":[null],"./gl-es/share-to-teams-outlook-addin.js":[null],"./gl-es/share-to-teams-third-party.js":[null],"./gl-es/share-to-teams.js":[888687,793200],"./gl-es/shortcut.js":[43235,334496],"./gl-es/shortcuts.js":[49133,334496],"./gl-es/simple-collab.js":[903456,334496],"./gl-es/smart-device.js":[null],"./gl-es/survey.js":[161333,913749],"./gl-es/sv-flyout.js":[207142,334496],"./gl-es/teams-and-channels.js":[945788,988558],"./gl-es/teams-insider.js":[187635,334496],"./gl-es/telemetry.js":[959336,334496],"./gl-es/tfl-homepage.js":[801848,334496],"./gl-es/tfl-onboarding.js":[826412,334496],"./gl-es/toast-notifications.js":[837090,334496],"./gl-es/trusted-ui.js":[null],"./gl-es/unified-search.js":[886752,793200],"./gl-es/unsupported-browser.js":[null],"./gl-es/url-preview.js":[385698,334496],"./gl-es/video-capture.js":[434895,865947],"./gl-es/video-message.js":[131718,328749],"./gl-es/virtual-consumer-events.js":[8522,57664],"./gl-es/virtual-events.js":[698741,170796],"./gl-es/webinar.js":[961330,134257],"./gl-es/welcome-bot.js":[null],"./gl-es/whats-new.js":[19186,334496],"./gl-es/wiki.js":[null],"./he-il/activity.js":[403597,785333],"./he-il/artifacts-platform.js":[112677,410047],"./he-il/audience-view-dialog.js":[548263,449744],"./he-il/auth.js":[129209,785333],"./he-il/autosuggest.js":[758075,785333],"./he-il/avatar.js":[959602,785333],"./he-il/biometric-enrollment.js":[725446,99598],"./he-il/breakout-rooms.js":[613801,275339],"./he-il/broadcast.js":[957221,54541],"./he-il/calendar.js":[680733,921777],"./he-il/calling.js":[104053,944047],"./he-il/campaign-notifications.js":[916319,785333],"./he-il/carousel-multi-card.js":[null],"./he-il/cast.js":[390480,785333],"./he-il/channels.js":[388121,785333],"./he-il/chat-list.js":[177459,785333],"./he-il/coach-report.js":[958007,789525],"./he-il/comment-stream.js":[673652,380163],"./he-il/communities.js":[18953,785333],"./he-il/compose.js":[851415,785333],"./he-il/contacts.js":[253322,785333],"./he-il/datepicker.js":[186840,849120],"./he-il/desktop.js":[null],"./he-il/digital-signage.js":[null],"./he-il/discover-surface.js":[543772,855777],"./he-il/edu.js":[279873,657763],"./he-il/embed.js":[588411,785333],"./he-il/errors.js":[770819,785333],"./he-il/esp.js":[978759,313666],"./he-il/extensibility-ptz-extension.js":[null],"./he-il/extensibility-room-remote.js":[null],"./he-il/extensibility.js":[947426,785333],"./he-il/feedback.js":[633223,948836],"./he-il/files.js":[923499,785333],"./he-il/framework.js":[622681,785333],"./he-il/freemium-upgrade.js":[null],"./he-il/freemium.js":[313621,944047],"./he-il/funstuff.js":[413215,710566],"./he-il/gallery.js":[834354,309981],"./he-il/growth.js":[452430,785333],"./he-il/guardians.js":[464657,97202],"./he-il/health.js":[888198,632724],"./he-il/help.js":[null],"./he-il/hololens.js":[280646,944047],"./he-il/host-controls.js":[344719,151257],"./he-il/jana.js":[165342,292041],"./he-il/lightbox.js":[908591,785333],"./he-il/live-persona-card.js":[532384,785333],"./he-il/live-persona-editor.js":[595887,48710],"./he-il/lms-integration.js":[null],"./he-il/meet-for-work.js":[251606,358137],"./he-il/meeting-analytics.js":[110754,498261],"./he-il/meeting-apis-app.js":[null],"./he-il/meeting-bot.js":[null],"./he-il/meeting-collaboration.js":[620147,767634],"./he-il/meeting-flyout.js":[955884,785333],"./he-il/meeting-meet-app.js":[778121,785333],"./he-il/meeting-options.js":[645997,47838],"./he-il/meeting-recap.js":[958835,900183],"./he-il/meeting-room-console.js":[null],"./he-il/meeting-stream-app.js":[null],"./he-il/message-escalate-dialog.js":[287358,379959],"./he-il/messaging.js":[146480,785333],"./he-il/mobile-attach.js":[null],"./he-il/mtma-missed-notifications.js":[507470,785333],"./he-il/nova.js":[914559,785333],"./he-il/people-app.js":[null],"./he-il/people-picker.js":[62058,785333],"./he-il/people-targeting.js":[627426,344975],"./he-il/people.js":[892894,785333],"./he-il/person.js":[987573,785333],"./he-il/phonelink-sms.js":[180325,104374],"./he-il/pre-core.js":[null],"./he-il/premium-benefits.js":[199926,330005],"./he-il/presence.js":[35110,785333],"./he-il/queues.js":[37406,853223],"./he-il/recurrence.js":[88528,600809],"./he-il/rsc-application-permissions.js":[null],"./he-il/search.js":[919336,849120],"./he-il/semantic-object.js":[480295,37131],"./he-il/settings.js":[783859,785333],"./he-il/share-in-meetings.js":[null],"./he-il/share-to-teams-outlook-addin.js":[null],"./he-il/share-to-teams-third-party.js":[null],"./he-il/share-to-teams.js":[976007,434692],"./he-il/shortcut.js":[775530,785333],"./he-il/shortcuts.js":[524378,785333],"./he-il/simple-collab.js":[52370,785333],"./he-il/smart-device.js":[null],"./he-il/survey.js":[528169,226816],"./he-il/sv-flyout.js":[995768,785333],"./he-il/teams-and-channels.js":[510202,122413],"./he-il/teams-insider.js":[391101,785333],"./he-il/telemetry.js":[92694,785333],"./he-il/tfl-homepage.js":[825862,785333],"./he-il/tfl-onboarding.js":[442642,785333],"./he-il/toast-notifications.js":[227256,785333],"./he-il/trusted-ui.js":[null],"./he-il/unified-search.js":[330809,434692],"./he-il/unsupported-browser.js":[null],"./he-il/url-preview.js":[823822,785333],"./he-il/video-capture.js":[143989,925580],"./he-il/video-message.js":[824559,879659],"./he-il/virtual-consumer-events.js":[355283,957690],"./he-il/virtual-events.js":[938771,453196],"./he-il/webinar.js":[906705,11957],"./he-il/welcome-bot.js":[null],"./he-il/whats-new.js":[341607,785333],"./he-il/wiki.js":[null],"./hi-in/activity.js":[782904,870716],"./hi-in/artifacts-platform.js":[428342,854314],"./hi-in/audience-view-dialog.js":[569654,63335],"./hi-in/auth.js":[188123,870716],"./hi-in/autosuggest.js":[199521,870716],"./hi-in/avatar.js":[428229,870716],"./hi-in/biometric-enrollment.js":[844642,469338],"./hi-in/breakout-rooms.js":[348325,731591],"./hi-in/broadcast.js":[369479,536227],"./hi-in/calendar.js":[647248,80262],"./hi-in/calling.js":[143354,334349],"./hi-in/campaign-notifications.js":[878729,870716],"./hi-in/carousel-multi-card.js":[null],"./hi-in/cast.js":[551565,870716],"./hi-in/channels.js":[100006,870716],"./hi-in/chat-list.js":[72517,870716],"./hi-in/coach-report.js":[865957,59797],"./hi-in/comment-stream.js":[869209,727144],"./hi-in/communities.js":[416640,870716],"./hi-in/compose.js":[616649,870716],"./hi-in/contacts.js":[177247,870716],"./hi-in/datepicker.js":[286977,723794],"./hi-in/desktop.js":[null],"./hi-in/digital-signage.js":[null],"./hi-in/discover-surface.js":[27968,734632],"./hi-in/edu.js":[96499,831933],"./hi-in/embed.js":[872593,870716],"./hi-in/errors.js":[25470,870716],"./hi-in/esp.js":[468717,829046],"./hi-in/extensibility-ptz-extension.js":[null],"./hi-in/extensibility-room-remote.js":[null],"./hi-in/extensibility.js":[542502,870716],"./hi-in/feedback.js":[878961,759374],"./hi-in/files.js":[934060,870716],"./hi-in/framework.js":[521740,870716],"./hi-in/freemium-upgrade.js":[null],"./hi-in/freemium.js":[647024,334349],"./hi-in/funstuff.js":[882656,136410],"./hi-in/gallery.js":[195232,730922],"./hi-in/growth.js":[717070,870716],"./hi-in/guardians.js":[86813,206336],"./hi-in/health.js":[776167,202148],"./hi-in/help.js":[null],"./hi-in/hololens.js":[97717,334349],"./hi-in/host-controls.js":[61968,720054],"./hi-in/jana.js":[276790,241166],"./hi-in/lightbox.js":[513271,870716],"./hi-in/live-persona-card.js":[868120,870716],"./hi-in/live-persona-editor.js":[691374,3796],"./hi-in/lms-integration.js":[null],"./hi-in/meet-for-work.js":[545023,91135],"./hi-in/meeting-analytics.js":[68836,810589],"./hi-in/meeting-apis-app.js":[null],"./hi-in/meeting-bot.js":[null],"./hi-in/meeting-collaboration.js":[542733,318957],"./hi-in/meeting-flyout.js":[798545,870716],"./hi-in/meeting-meet-app.js":[932430,870716],"./hi-in/meeting-options.js":[112298,793337],"./hi-in/meeting-recap.js":[911188,413199],"./hi-in/meeting-room-console.js":[null],"./hi-in/meeting-stream-app.js":[null],"./hi-in/message-escalate-dialog.js":[486187,520401],"./hi-in/messaging.js":[757891,870716],"./hi-in/mobile-attach.js":[null],"./hi-in/mtma-missed-notifications.js":[410656,870716],"./hi-in/nova.js":[130591,870716],"./hi-in/people-app.js":[null],"./hi-in/people-picker.js":[866391,870716],"./hi-in/people-targeting.js":[981659,335833],"./hi-in/people.js":[576024,870716],"./hi-in/person.js":[106614,870716],"./hi-in/phonelink-sms.js":[89892,540771],"./hi-in/pre-core.js":[null],"./hi-in/premium-benefits.js":[247468,885490],"./hi-in/presence.js":[634738,870716],"./hi-in/queues.js":[71790,198723],"./hi-in/recurrence.js":[991822,622999],"./hi-in/rsc-application-permissions.js":[null],"./hi-in/search.js":[691101,723794],"./hi-in/semantic-object.js":[608386,697606],"./hi-in/settings.js":[325510,870716],"./hi-in/share-in-meetings.js":[null],"./hi-in/share-to-teams-outlook-addin.js":[null],"./hi-in/share-to-teams-third-party.js":[null],"./hi-in/share-to-teams.js":[289648,141064],"./hi-in/shortcut.js":[780341,870716],"./hi-in/shortcuts.js":[833424,870716],"./hi-in/simple-collab.js":[512101,870716],"./hi-in/smart-device.js":[null],"./hi-in/survey.js":[43284,665054],"./hi-in/sv-flyout.js":[460433,870716],"./hi-in/teams-and-channels.js":[161806,929922],"./hi-in/teams-insider.js":[979749,870716],"./hi-in/telemetry.js":[229823,870716],"./hi-in/tfl-homepage.js":[10668,870716],"./hi-in/tfl-onboarding.js":[109558,870716],"./hi-in/toast-notifications.js":[808965,870716],"./hi-in/trusted-ui.js":[null],"./hi-in/unified-search.js":[798871,141064],"./hi-in/unsupported-browser.js":[null],"./hi-in/url-preview.js":[577308,870716],"./hi-in/video-capture.js":[951548,372487],"./hi-in/video-message.js":[231582,756391],"./hi-in/virtual-consumer-events.js":[947381,570960],"./hi-in/virtual-events.js":[504500,136608],"./hi-in/webinar.js":[697294,893288],"./hi-in/welcome-bot.js":[null],"./hi-in/whats-new.js":[254347,870716],"./hi-in/wiki.js":[null],"./hr-hr/activity.js":[299780,489109],"./hr-hr/artifacts-platform.js":[447477,154212],"./hr-hr/audience-view-dialog.js":[713107,115314],"./hr-hr/auth.js":[913546,489109],"./hr-hr/autosuggest.js":[757525,489109],"./hr-hr/avatar.js":[556611,489109],"./hr-hr/biometric-enrollment.js":[101619,733075],"./hr-hr/breakout-rooms.js":[294497,425527],"./hr-hr/broadcast.js":[864623,883654],"./hr-hr/calendar.js":[279118,771216],"./hr-hr/calling.js":[532841,42044],"./hr-hr/campaign-notifications.js":[54447,489109],"./hr-hr/carousel-multi-card.js":[null],"./hr-hr/cast.js":[824457,489109],"./hr-hr/channels.js":[145796,489109],"./hr-hr/chat-list.js":[444600,489109],"./hr-hr/coach-report.js":[917355,481550],"./hr-hr/comment-stream.js":[392051,31490],"./hr-hr/communities.js":[570727,489109],"./hr-hr/compose.js":[466539,489109],"./hr-hr/contacts.js":[860528,489109],"./hr-hr/datepicker.js":[827327,870723],"./hr-hr/desktop.js":[null],"./hr-hr/digital-signage.js":[null],"./hr-hr/discover-surface.js":[431937,470676],"./hr-hr/edu.js":[505418,989560],"./hr-hr/embed.js":[89603,489109],"./hr-hr/errors.js":[793573,489109],"./hr-hr/esp.js":[490035,288910],"./hr-hr/extensibility-ptz-extension.js":[null],"./hr-hr/extensibility-room-remote.js":[null],"./hr-hr/extensibility.js":[63702,489109],"./hr-hr/feedback.js":[170863,717868],"./hr-hr/files.js":[898204,489109],"./hr-hr/framework.js":[225667,489109],"./hr-hr/freemium-upgrade.js":[null],"./hr-hr/freemium.js":[945689,42044],"./hr-hr/funstuff.js":[784273,664384],"./hr-hr/gallery.js":[301895,16746],"./hr-hr/growth.js":[616056,489109],"./hr-hr/guardians.js":[610263,689118],"./hr-hr/health.js":[591781,296046],"./hr-hr/help.js":[null],"./hr-hr/hololens.js":[882032,42044],"./hr-hr/host-controls.js":[577970,490112],"./hr-hr/jana.js":[317817,699798],"./hr-hr/lightbox.js":[891561,489109],"./hr-hr/live-persona-card.js":[496288,489109],"./hr-hr/live-persona-editor.js":[73473,826528],"./hr-hr/lms-integration.js":[null],"./hr-hr/meet-for-work.js":[628173,475086],"./hr-hr/meeting-analytics.js":[821137,156312],"./hr-hr/meeting-apis-app.js":[null],"./hr-hr/meeting-bot.js":[null],"./hr-hr/meeting-collaboration.js":[122288,119069],"./hr-hr/meeting-flyout.js":[349010,489109],"./hr-hr/meeting-meet-app.js":[437139,489109],"./hr-hr/meeting-options.js":[710573,855228],"./hr-hr/meeting-recap.js":[461399,614401],"./hr-hr/meeting-room-console.js":[null],"./hr-hr/meeting-stream-app.js":[null],"./hr-hr/message-escalate-dialog.js":[90,996357],"./hr-hr/messaging.js":[147983,489109],"./hr-hr/mobile-attach.js":[null],"./hr-hr/mtma-missed-notifications.js":[964194,489109],"./hr-hr/nova.js":[867838,489109],"./hr-hr/people-app.js":[null],"./hr-hr/people-picker.js":[917806,489109],"./hr-hr/people-targeting.js":[23585,589167],"./hr-hr/people.js":[80847,489109],"./hr-hr/person.js":[492615,489109],"./hr-hr/phonelink-sms.js":[395282,265562],"./hr-hr/pre-core.js":[null],"./hr-hr/premium-benefits.js":[956733,56384],"./hr-hr/presence.js":[692379,489109],"./hr-hr/queues.js":[307849,632940],"./hr-hr/recurrence.js":[671969,566467],"./hr-hr/rsc-application-permissions.js":[null],"./hr-hr/search.js":[495394,870723],"./hr-hr/semantic-object.js":[32077,471678],"./hr-hr/settings.js":[863314,489109],"./hr-hr/share-in-meetings.js":[null],"./hr-hr/share-to-teams-outlook-addin.js":[null],"./hr-hr/share-to-teams-third-party.js":[null],"./hr-hr/share-to-teams.js":[305436,82749],"./hr-hr/shortcut.js":[182737,489109],"./hr-hr/shortcuts.js":[271781,489109],"./hr-hr/simple-collab.js":[852609,489109],"./hr-hr/smart-device.js":[null],"./hr-hr/survey.js":[707897,182117],"./hr-hr/sv-flyout.js":[221185,489109],"./hr-hr/teams-and-channels.js":[552242,609436],"./hr-hr/teams-insider.js":[270894,489109],"./hr-hr/telemetry.js":[196843,489109],"./hr-hr/tfl-homepage.js":[284752,489109],"./hr-hr/tfl-onboarding.js":[634178,489109],"./hr-hr/toast-notifications.js":[874895,489109],"./hr-hr/trusted-ui.js":[null],"./hr-hr/unified-search.js":[890274,82749],"./hr-hr/unsupported-browser.js":[null],"./hr-hr/url-preview.js":[958494,489109],"./hr-hr/video-capture.js":[651386,793944],"./hr-hr/video-message.js":[697410,612389],"./hr-hr/virtual-consumer-events.js":[381904,17570],"./hr-hr/virtual-events.js":[194332,142325],"./hr-hr/webinar.js":[185866,877869],"./hr-hr/welcome-bot.js":[null],"./hr-hr/whats-new.js":[76353,489109],"./hr-hr/wiki.js":[null],"./hu-hu/activity.js":[904281,320323],"./hu-hu/artifacts-platform.js":[542516,617434],"./hu-hu/audience-view-dialog.js":[703027,919220],"./hu-hu/auth.js":[103993,320323],"./hu-hu/autosuggest.js":[273743,320323],"./hu-hu/avatar.js":[589162,320323],"./hu-hu/biometric-enrollment.js":[429251,314727],"./hu-hu/breakout-rooms.js":[491897,954639],"./hu-hu/broadcast.js":[989321,912671],"./hu-hu/calendar.js":[627163,598805],"./hu-hu/calling.js":[527362,99592],"./hu-hu/campaign-notifications.js":[363803,320323],"./hu-hu/carousel-multi-card.js":[null],"./hu-hu/cast.js":[235279,320323],"./hu-hu/channels.js":[831005,320323],"./hu-hu/chat-list.js":[703405,320323],"./hu-hu/coach-report.js":[338313,788861],"./hu-hu/comment-stream.js":[832126,806278],"./hu-hu/communities.js":[253892,320323],"./hu-hu/compose.js":[615903,320323],"./hu-hu/contacts.js":[637672,320323],"./hu-hu/datepicker.js":[328628,153715],"./hu-hu/desktop.js":[null],"./hu-hu/digital-signage.js":[null],"./hu-hu/discover-surface.js":[66879,405913],"./hu-hu/edu.js":[853212,919458],"./hu-hu/embed.js":[331463,320323],"./hu-hu/errors.js":[568604,320323],"./hu-hu/esp.js":[101303,996449],"./hu-hu/extensibility-ptz-extension.js":[null],"./hu-hu/extensibility-room-remote.js":[null],"./hu-hu/extensibility.js":[878493,320323],"./hu-hu/feedback.js":[972081,987470],"./hu-hu/files.js":[365766,320323],"./hu-hu/framework.js":[99476,320323],"./hu-hu/freemium-upgrade.js":[null],"./hu-hu/freemium.js":[970032,99592],"./hu-hu/funstuff.js":[692889,848934],"./hu-hu/gallery.js":[89249,277527],"./hu-hu/growth.js":[817190,320323],"./hu-hu/guardians.js":[762806,727910],"./hu-hu/health.js":[932208,596269],"./hu-hu/help.js":[null],"./hu-hu/hololens.js":[51030,99592],"./hu-hu/host-controls.js":[703017,907731],"./hu-hu/jana.js":[801426,253690],"./hu-hu/lightbox.js":[834396,320323],"./hu-hu/live-persona-card.js":[708236,320323],"./hu-hu/live-persona-editor.js":[141140,260543],"./hu-hu/lms-integration.js":[null],"./hu-hu/meet-for-work.js":[114121,103972],"./hu-hu/meeting-analytics.js":[664611,137589],"./hu-hu/meeting-apis-app.js":[null],"./hu-hu/meeting-bot.js":[null],"./hu-hu/meeting-collaboration.js":[939127,396211],"./hu-hu/meeting-flyout.js":[380084,320323],"./hu-hu/meeting-meet-app.js":[566856,320323],"./hu-hu/meeting-options.js":[67270,650391],"./hu-hu/meeting-recap.js":[462972,257621],"./hu-hu/meeting-room-console.js":[null],"./hu-hu/meeting-stream-app.js":[null],"./hu-hu/message-escalate-dialog.js":[220001,329367],"./hu-hu/messaging.js":[592174,320323],"./hu-hu/mobile-attach.js":[null],"./hu-hu/mtma-missed-notifications.js":[6596,320323],"./hu-hu/nova.js":[446226,320323],"./hu-hu/people-app.js":[null],"./hu-hu/people-picker.js":[92469,320323],"./hu-hu/people-targeting.js":[588313,302488],"./hu-hu/people.js":[967897,320323],"./hu-hu/person.js":[14930,320323],"./hu-hu/phonelink-sms.js":[88461,835176],"./hu-hu/pre-core.js":[null],"./hu-hu/premium-benefits.js":[654742,294417],"./hu-hu/presence.js":[495337,320323],"./hu-hu/queues.js":[720645,504759],"./hu-hu/recurrence.js":[604825,427269],"./hu-hu/rsc-application-permissions.js":[null],"./hu-hu/search.js":[803125,153715],"./hu-hu/semantic-object.js":[394881,598993],"./hu-hu/settings.js":[317805,320323],"./hu-hu/share-in-meetings.js":[null],"./hu-hu/share-to-teams-outlook-addin.js":[null],"./hu-hu/share-to-teams-third-party.js":[null],"./hu-hu/share-to-teams.js":[684468,578609],"./hu-hu/shortcut.js":[761456,320323],"./hu-hu/shortcuts.js":[885910,320323],"./hu-hu/simple-collab.js":[635877,320323],"./hu-hu/smart-device.js":[null],"./hu-hu/survey.js":[512483,207545],"./hu-hu/sv-flyout.js":[904089,320323],"./hu-hu/teams-and-channels.js":[646870,793241],"./hu-hu/teams-insider.js":[311615,320323],"./hu-hu/telemetry.js":[641951,320323],"./hu-hu/tfl-homepage.js":[785246,320323],"./hu-hu/tfl-onboarding.js":[563337,320323],"./hu-hu/toast-notifications.js":[614100,320323],"./hu-hu/trusted-ui.js":[null],"./hu-hu/unified-search.js":[517904,578609],"./hu-hu/unsupported-browser.js":[null],"./hu-hu/url-preview.js":[334218,320323],"./hu-hu/video-capture.js":[942464,151566],"./hu-hu/video-message.js":[506789,445084],"./hu-hu/virtual-consumer-events.js":[918552,716391],"./hu-hu/virtual-events.js":[185314,172325],"./hu-hu/webinar.js":[751170,206355],"./hu-hu/welcome-bot.js":[null],"./hu-hu/whats-new.js":[196987,320323],"./hu-hu/wiki.js":[null],"./id-id/activity.js":[945925,203846],"./id-id/artifacts-platform.js":[92031,665515],"./id-id/audience-view-dialog.js":[677667,672055],"./id-id/auth.js":[42897,203846],"./id-id/autosuggest.js":[651774,203846],"./id-id/avatar.js":[352273,203846],"./id-id/biometric-enrollment.js":[497856,774896],"./id-id/breakout-rooms.js":[382830,888150],"./id-id/broadcast.js":[88468,403817],"./id-id/calendar.js":[596288,634884],"./id-id/calling.js":[842720,800824],"./id-id/campaign-notifications.js":[391213,203846],"./id-id/carousel-multi-card.js":[null],"./id-id/cast.js":[976031,203846],"./id-id/channels.js":[400717,203846],"./id-id/chat-list.js":[157970,203846],"./id-id/coach-report.js":[188752,143338],"./id-id/comment-stream.js":[924765,126103],"./id-id/communities.js":[470603,203846],"./id-id/compose.js":[586157,203846],"./id-id/contacts.js":[656329,203846],"./id-id/datepicker.js":[535325,384517],"./id-id/desktop.js":[null],"./id-id/digital-signage.js":[null],"./id-id/discover-surface.js":[495061,185541],"./id-id/edu.js":[557966,758737],"./id-id/embed.js":[691120,203846],"./id-id/errors.js":[125996,203846],"./id-id/esp.js":[758262,276370],"./id-id/extensibility-ptz-extension.js":[null],"./id-id/extensibility-room-remote.js":[null],"./id-id/extensibility.js":[916235,203846],"./id-id/feedback.js":[477966,762718],"./id-id/files.js":[313630,203846],"./id-id/framework.js":[977620,203846],"./id-id/freemium-upgrade.js":[null],"./id-id/freemium.js":[938489,800824],"./id-id/funstuff.js":[598990,190805],"./id-id/gallery.js":[604464,583059],"./id-id/growth.js":[321287,203846],"./id-id/guardians.js":[89568,545965],"./id-id/health.js":[828412,826354],"./id-id/help.js":[null],"./id-id/hololens.js":[168420,800824],"./id-id/host-controls.js":[861997,233920],"./id-id/jana.js":[408992,908011],"./id-id/lightbox.js":[515570,203846],"./id-id/live-persona-card.js":[417981,203846],"./id-id/live-persona-editor.js":[472135,596175],"./id-id/lms-integration.js":[null],"./id-id/meet-for-work.js":[585962,829955],"./id-id/meeting-analytics.js":[528262,897620],"./id-id/meeting-apis-app.js":[null],"./id-id/meeting-bot.js":[null],"./id-id/meeting-collaboration.js":[614780,653831],"./id-id/meeting-flyout.js":[540518,203846],"./id-id/meeting-meet-app.js":[471160,203846],"./id-id/meeting-options.js":[150396,371993],"./id-id/meeting-recap.js":[91342,351102],"./id-id/meeting-room-console.js":[null],"./id-id/meeting-stream-app.js":[null],"./id-id/message-escalate-dialog.js":[829682,20702],"./id-id/messaging.js":[184210,203846],"./id-id/mobile-attach.js":[null],"./id-id/mtma-missed-notifications.js":[406554,203846],"./id-id/nova.js":[508181,203846],"./id-id/people-app.js":[null],"./id-id/people-picker.js":[486492,203846],"./id-id/people-targeting.js":[393998,101659],"./id-id/people.js":[241700,203846],"./id-id/person.js":[658356,203846],"./id-id/phonelink-sms.js":[906002,780445],"./id-id/pre-core.js":[null],"./id-id/premium-benefits.js":[979177,292947],"./id-id/presence.js":[540661,203846],"./id-id/queues.js":[849816,936614],"./id-id/recurrence.js":[889886,667681],"./id-id/rsc-application-permissions.js":[null],"./id-id/search.js":[263449,384517],"./id-id/semantic-object.js":[680061,989676],"./id-id/settings.js":[740526,203846],"./id-id/share-in-meetings.js":[null],"./id-id/share-to-teams-outlook-addin.js":[null],"./id-id/share-to-teams-third-party.js":[null],"./id-id/share-to-teams.js":[288333,689509],"./id-id/shortcut.js":[106559,203846],"./id-id/shortcuts.js":[860581,203846],"./id-id/simple-collab.js":[190374,203846],"./id-id/smart-device.js":[null],"./id-id/survey.js":[586490,773170],"./id-id/sv-flyout.js":[498364,203846],"./id-id/teams-and-channels.js":[446983,348943],"./id-id/teams-insider.js":[121604,203846],"./id-id/telemetry.js":[478413,203846],"./id-id/tfl-homepage.js":[578523,203846],"./id-id/tfl-onboarding.js":[394735,203846],"./id-id/toast-notifications.js":[333267,203846],"./id-id/trusted-ui.js":[null],"./id-id/unified-search.js":[655984,689509],"./id-id/unsupported-browser.js":[null],"./id-id/url-preview.js":[946876,203846],"./id-id/video-capture.js":[419699,433754],"./id-id/video-message.js":[192688,367261],"./id-id/virtual-consumer-events.js":[772035,853580],"./id-id/virtual-events.js":[381700,386683],"./id-id/webinar.js":[667844,76141],"./id-id/welcome-bot.js":[null],"./id-id/whats-new.js":[39926,203846],"./id-id/wiki.js":[null],"./is-is/activity.js":[52576,953993],"./is-is/artifacts-platform.js":[76760,933139],"./is-is/audience-view-dialog.js":[572578,446631],"./is-is/auth.js":[691212,953993],"./is-is/autosuggest.js":[652800,953993],"./is-is/avatar.js":[84050,953993],"./is-is/biometric-enrollment.js":[116939,945801],"./is-is/breakout-rooms.js":[513181,93296],"./is-is/broadcast.js":[210414,746873],"./is-is/calendar.js":[26375,873312],"./is-is/calling.js":[549134,581706],"./is-is/campaign-notifications.js":[817064,953993],"./is-is/carousel-multi-card.js":[null],"./is-is/cast.js":[77199,953993],"./is-is/channels.js":[142562,953993],"./is-is/chat-list.js":[5169,953993],"./is-is/coach-report.js":[199042,258004],"./is-is/comment-stream.js":[385105,31945],"./is-is/communities.js":[844284,953993],"./is-is/compose.js":[299106,953993],"./is-is/contacts.js":[247664,953993],"./is-is/datepicker.js":[825719,707620],"./is-is/desktop.js":[null],"./is-is/digital-signage.js":[null],"./is-is/discover-surface.js":[753264,466887],"./is-is/edu.js":[901525,559930],"./is-is/embed.js":[773928,953993],"./is-is/errors.js":[991092,953993],"./is-is/esp.js":[444941,423402],"./is-is/extensibility-ptz-extension.js":[null],"./is-is/extensibility-room-remote.js":[null],"./is-is/extensibility.js":[727824,953993],"./is-is/feedback.js":[16e3,946722],"./is-is/files.js":[331673,953993],"./is-is/framework.js":[862425,953993],"./is-is/freemium-upgrade.js":[null],"./is-is/freemium.js":[7965,581706],"./is-is/funstuff.js":[632337,449437],"./is-is/gallery.js":[235860,629837],"./is-is/growth.js":[62246,953993],"./is-is/guardians.js":[629994,97596],"./is-is/health.js":[48460,883254],"./is-is/help.js":[null],"./is-is/hololens.js":[107399,581706],"./is-is/host-controls.js":[897566,684114],"./is-is/jana.js":[173357,818945],"./is-is/lightbox.js":[256370,953993],"./is-is/live-persona-card.js":[384842,953993],"./is-is/live-persona-editor.js":[393440,47548],"./is-is/lms-integration.js":[null],"./is-is/meet-for-work.js":[389259,331433],"./is-is/meeting-analytics.js":[402334,506552],"./is-is/meeting-apis-app.js":[null],"./is-is/meeting-bot.js":[null],"./is-is/meeting-collaboration.js":[640489,969345],"./is-is/meeting-flyout.js":[600797,953993],"./is-is/meeting-meet-app.js":[279397,953993],"./is-is/meeting-options.js":[654528,213692],"./is-is/meeting-recap.js":[152746,691195],"./is-is/meeting-room-console.js":[null],"./is-is/meeting-stream-app.js":[null],"./is-is/message-escalate-dialog.js":[612913,582366],"./is-is/messaging.js":[475169,953993],"./is-is/mobile-attach.js":[null],"./is-is/mtma-missed-notifications.js":[121979,953993],"./is-is/nova.js":[896454,953993],"./is-is/people-app.js":[null],"./is-is/people-picker.js":[443950,953993],"./is-is/people-targeting.js":[946242,115078],"./is-is/people.js":[579240,953993],"./is-is/person.js":[605697,953993],"./is-is/phonelink-sms.js":[743569,541872],"./is-is/pre-core.js":[null],"./is-is/premium-benefits.js":[383119,849818],"./is-is/presence.js":[278252,953993],"./is-is/queues.js":[993146,216390],"./is-is/recurrence.js":[705605,713838],"./is-is/rsc-application-permissions.js":[null],"./is-is/search.js":[642507,707620],"./is-is/semantic-object.js":[545366,313507],"./is-is/settings.js":[670322,953993],"./is-is/share-in-meetings.js":[null],"./is-is/share-to-teams-outlook-addin.js":[null],"./is-is/share-to-teams-third-party.js":[null],"./is-is/share-to-teams.js":[593252,380127],"./is-is/shortcut.js":[158948,953993],"./is-is/shortcuts.js":[22427,953993],"./is-is/simple-collab.js":[145973,953993],"./is-is/smart-device.js":[null],"./is-is/survey.js":[851432,723968],"./is-is/sv-flyout.js":[623578,953993],"./is-is/teams-and-channels.js":[274137,793400],"./is-is/teams-insider.js":[608007,953993],"./is-is/telemetry.js":[414911,953993],"./is-is/tfl-homepage.js":[299766,953993],"./is-is/tfl-onboarding.js":[283637,953993],"./is-is/toast-notifications.js":[903385,953993],"./is-is/trusted-ui.js":[null],"./is-is/unified-search.js":[258366,380127],"./is-is/unsupported-browser.js":[null],"./is-is/url-preview.js":[741075,953993],"./is-is/video-capture.js":[515739,697225],"./is-is/video-message.js":[448634,431245],"./is-is/virtual-consumer-events.js":[536666,854311],"./is-is/virtual-events.js":[672974,677496],"./is-is/webinar.js":[421989,764010],"./is-is/welcome-bot.js":[null],"./is-is/whats-new.js":[162238,953993],"./is-is/wiki.js":[null],"./it-it/activity.js":[456881,401983],"./it-it/artifacts-platform.js":[371514,1215],"./it-it/audience-view-dialog.js":[675884,484713],"./it-it/auth.js":[745598,401983],"./it-it/autosuggest.js":[250641,401983],"./it-it/avatar.js":[113258,401983],"./it-it/biometric-enrollment.js":[217654,314095],"./it-it/breakout-rooms.js":[661054,106830],"./it-it/broadcast.js":[398028,962382],"./it-it/calendar.js":[181531,745999],"./it-it/calling.js":[899116,797119],"./it-it/campaign-notifications.js":[846711,401983],"./it-it/carousel-multi-card.js":[null],"./it-it/cast.js":[10294,401983],"./it-it/channels.js":[51845,401983],"./it-it/chat-list.js":[594336,401983],"./it-it/coach-report.js":[220892,369658],"./it-it/comment-stream.js":[213313,531405],"./it-it/communities.js":[799408,401983],"./it-it/compose.js":[561395,401983],"./it-it/contacts.js":[685471,401983],"./it-it/datepicker.js":[776049,476293],"./it-it/desktop.js":[null],"./it-it/digital-signage.js":[null],"./it-it/discover-surface.js":[961735,578857],"./it-it/edu.js":[5866,423870],"./it-it/embed.js":[575899,401983],"./it-it/errors.js":[551820,401983],"./it-it/esp.js":[148165,17984],"./it-it/extensibility-ptz-extension.js":[null],"./it-it/extensibility-room-remote.js":[null],"./it-it/extensibility.js":[963736,401983],"./it-it/feedback.js":[477867,278011],"./it-it/files.js":[173495,401983],"./it-it/framework.js":[426910,401983],"./it-it/freemium-upgrade.js":[null],"./it-it/freemium.js":[375566,797119],"./it-it/funstuff.js":[224927,840397],"./it-it/gallery.js":[263293,107215],"./it-it/growth.js":[324260,401983],"./it-it/guardians.js":[601728,903301],"./it-it/health.js":[804199,124572],"./it-it/help.js":[null],"./it-it/hololens.js":[939027,797119],"./it-it/host-controls.js":[692059,965582],"./it-it/jana.js":[875327,637959],"./it-it/lightbox.js":[847917,401983],"./it-it/live-persona-card.js":[490468,401983],"./it-it/live-persona-editor.js":[771340,277450],"./it-it/lms-integration.js":[null],"./it-it/meet-for-work.js":[700282,580570],"./it-it/meeting-analytics.js":[35350,591068],"./it-it/meeting-apis-app.js":[null],"./it-it/meeting-bot.js":[null],"./it-it/meeting-collaboration.js":[847933,91078],"./it-it/meeting-flyout.js":[295002,401983],"./it-it/meeting-meet-app.js":[971177,401983],"./it-it/meeting-options.js":[864705,756864],"./it-it/meeting-recap.js":[7189,241799],"./it-it/meeting-room-console.js":[null],"./it-it/meeting-stream-app.js":[null],"./it-it/message-escalate-dialog.js":[543291,514354],"./it-it/messaging.js":[210444,401983],"./it-it/mobile-attach.js":[null],"./it-it/mtma-missed-notifications.js":[63072,401983],"./it-it/nova.js":[624921,401983],"./it-it/people-app.js":[null],"./it-it/people-picker.js":[388501,401983],"./it-it/people-targeting.js":[875195,261537],"./it-it/people.js":[634997,401983],"./it-it/person.js":[107507,401983],"./it-it/phonelink-sms.js":[575154,456395],"./it-it/pre-core.js":[null],"./it-it/premium-benefits.js":[885448,735533],"./it-it/presence.js":[795240,401983],"./it-it/queues.js":[776307,481505],"./it-it/recurrence.js":[962813,925312],"./it-it/rsc-application-permissions.js":[null],"./it-it/search.js":[745475,476293],"./it-it/semantic-object.js":[775580,848923],"./it-it/settings.js":[421893,401983],"./it-it/share-in-meetings.js":[null],"./it-it/share-to-teams-outlook-addin.js":[null],"./it-it/share-to-teams-third-party.js":[null],"./it-it/share-to-teams.js":[447229,465844],"./it-it/shortcut.js":[314e3,401983],"./it-it/shortcuts.js":[920467,401983],"./it-it/simple-collab.js":[991537,401983],"./it-it/smart-device.js":[null],"./it-it/survey.js":[838575,64279],"./it-it/sv-flyout.js":[722314,401983],"./it-it/teams-and-channels.js":[218005,481933],"./it-it/teams-insider.js":[548566,401983],"./it-it/telemetry.js":[288338,401983],"./it-it/tfl-homepage.js":[140263,401983],"./it-it/tfl-onboarding.js":[861324,401983],"./it-it/toast-notifications.js":[635257,401983],"./it-it/trusted-ui.js":[null],"./it-it/unified-search.js":[134738,465844],"./it-it/unsupported-browser.js":[null],"./it-it/url-preview.js":[702626,401983],"./it-it/video-capture.js":[381812,927946],"./it-it/video-message.js":[386781,786113],"./it-it/virtual-consumer-events.js":[202944,599972],"./it-it/virtual-events.js":[194212,77677],"./it-it/webinar.js":[770361,911969],"./it-it/welcome-bot.js":[null],"./it-it/whats-new.js":[509732,401983],"./it-it/wiki.js":[null],"./ja-jp/activity.js":[847091,904615],"./ja-jp/artifacts-platform.js":[299522,79131],"./ja-jp/audience-view-dialog.js":[814385,376211],"./ja-jp/auth.js":[645352,904615],"./ja-jp/autosuggest.js":[116152,904615],"./ja-jp/avatar.js":[103314,904615],"./ja-jp/biometric-enrollment.js":[438159,620545],"./ja-jp/breakout-rooms.js":[600172,61532],"./ja-jp/broadcast.js":[936844,407783],"./ja-jp/calendar.js":[886239,822423],"./ja-jp/calling.js":[254014,342337],"./ja-jp/campaign-notifications.js":[853053,904615],"./ja-jp/carousel-multi-card.js":[null],"./ja-jp/cast.js":[660853,904615],"./ja-jp/channels.js":[618273,904615],"./ja-jp/chat-list.js":[111241,904615],"./ja-jp/coach-report.js":[94736,134648],"./ja-jp/comment-stream.js":[500166,716918],"./ja-jp/communities.js":[90288,904615],"./ja-jp/compose.js":[994212,904615],"./ja-jp/contacts.js":[487308,904615],"./ja-jp/datepicker.js":[656517,640221],"./ja-jp/desktop.js":[null],"./ja-jp/digital-signage.js":[null],"./ja-jp/discover-surface.js":[7501,90606],"./ja-jp/edu.js":[261419,813403],"./ja-jp/embed.js":[28332,904615],"./ja-jp/errors.js":[783896,904615],"./ja-jp/esp.js":[943975,6373],"./ja-jp/extensibility-ptz-extension.js":[null],"./ja-jp/extensibility-room-remote.js":[null],"./ja-jp/extensibility.js":[626302,904615],"./ja-jp/feedback.js":[418935,640109],"./ja-jp/files.js":[854450,904615],"./ja-jp/framework.js":[482063,904615],"./ja-jp/freemium-upgrade.js":[null],"./ja-jp/freemium.js":[317958,342337],"./ja-jp/funstuff.js":[238081,964264],"./ja-jp/gallery.js":[964809,733603],"./ja-jp/growth.js":[664960,904615],"./ja-jp/guardians.js":[261537,162036],"./ja-jp/health.js":[57477,827593],"./ja-jp/help.js":[null],"./ja-jp/hololens.js":[622894,342337],"./ja-jp/host-controls.js":[42584,70580],"./ja-jp/jana.js":[523209,737065],"./ja-jp/lightbox.js":[28375,904615],"./ja-jp/live-persona-card.js":[748622,904615],"./ja-jp/live-persona-editor.js":[897620,790467],"./ja-jp/lms-integration.js":[null],"./ja-jp/meet-for-work.js":[490420,977090],"./ja-jp/meeting-analytics.js":[281811,816705],"./ja-jp/meeting-apis-app.js":[null],"./ja-jp/meeting-bot.js":[null],"./ja-jp/meeting-collaboration.js":[431923,356939],"./ja-jp/meeting-flyout.js":[446786,904615],"./ja-jp/meeting-meet-app.js":[968318,904615],"./ja-jp/meeting-options.js":[326721,905421],"./ja-jp/meeting-recap.js":[451079,763417],"./ja-jp/meeting-room-console.js":[null],"./ja-jp/meeting-stream-app.js":[null],"./ja-jp/message-escalate-dialog.js":[363373,152793],"./ja-jp/messaging.js":[674781,904615],"./ja-jp/mobile-attach.js":[null],"./ja-jp/mtma-missed-notifications.js":[453088,904615],"./ja-jp/nova.js":[67394,904615],"./ja-jp/people-app.js":[null],"./ja-jp/people-picker.js":[782286,904615],"./ja-jp/people-targeting.js":[980739,320267],"./ja-jp/people.js":[696078,904615],"./ja-jp/person.js":[189935,904615],"./ja-jp/phonelink-sms.js":[552602,308971],"./ja-jp/pre-core.js":[null],"./ja-jp/premium-benefits.js":[150828,25614],"./ja-jp/presence.js":[484361,904615],"./ja-jp/queues.js":[820644,601046],"./ja-jp/recurrence.js":[854420,337458],"./ja-jp/rsc-application-permissions.js":[null],"./ja-jp/search.js":[216316,640221],"./ja-jp/semantic-object.js":[686134,904289],"./ja-jp/settings.js":[484485,904615],"./ja-jp/share-in-meetings.js":[null],"./ja-jp/share-to-teams-outlook-addin.js":[null],"./ja-jp/share-to-teams-third-party.js":[null],"./ja-jp/share-to-teams.js":[966618,99951],"./ja-jp/shortcut.js":[510648,904615],"./ja-jp/shortcuts.js":[591299,904615],"./ja-jp/simple-collab.js":[796156,904615],"./ja-jp/smart-device.js":[null],"./ja-jp/survey.js":[354003,435110],"./ja-jp/sv-flyout.js":[797615,904615],"./ja-jp/teams-and-channels.js":[353520,323891],"./ja-jp/teams-insider.js":[568189,904615],"./ja-jp/telemetry.js":[232678,904615],"./ja-jp/tfl-homepage.js":[476784,904615],"./ja-jp/tfl-onboarding.js":[650448,904615],"./ja-jp/toast-notifications.js":[962841,904615],"./ja-jp/trusted-ui.js":[null],"./ja-jp/unified-search.js":[555706,99951],"./ja-jp/unsupported-browser.js":[null],"./ja-jp/url-preview.js":[743275,904615],"./ja-jp/video-capture.js":[764734,36540],"./ja-jp/video-message.js":[804636,5820],"./ja-jp/virtual-consumer-events.js":[374597,223578],"./ja-jp/virtual-events.js":[178183,873507],"./ja-jp/webinar.js":[877228,644126],"./ja-jp/welcome-bot.js":[null],"./ja-jp/whats-new.js":[225776,904615],"./ja-jp/wiki.js":[null],"./ka-ge/activity.js":[752615,910562],"./ka-ge/artifacts-platform.js":[694446,577122],"./ka-ge/audience-view-dialog.js":[848978,452425],"./ka-ge/auth.js":[734596,910562],"./ka-ge/autosuggest.js":[698484,910562],"./ka-ge/avatar.js":[854187,910562],"./ka-ge/biometric-enrollment.js":[979622,504411],"./ka-ge/breakout-rooms.js":[701408,44037],"./ka-ge/broadcast.js":[942527,838653],"./ka-ge/calendar.js":[440981,487310],"./ka-ge/calling.js":[377770,153613],"./ka-ge/campaign-notifications.js":[625627,910562],"./ka-ge/carousel-multi-card.js":[null],"./ka-ge/cast.js":[420824,910562],"./ka-ge/channels.js":[504426,910562],"./ka-ge/chat-list.js":[315898,910562],"./ka-ge/coach-report.js":[24171,505213],"./ka-ge/comment-stream.js":[165171,521527],"./ka-ge/communities.js":[733174,910562],"./ka-ge/compose.js":[54162,910562],"./ka-ge/contacts.js":[378342,910562],"./ka-ge/datepicker.js":[609074,318026],"./ka-ge/desktop.js":[null],"./ka-ge/digital-signage.js":[null],"./ka-ge/discover-surface.js":[570987,776281],"./ka-ge/edu.js":[266675,374973],"./ka-ge/embed.js":[161539,910562],"./ka-ge/errors.js":[2264,910562],"./ka-ge/esp.js":[999189,122842],"./ka-ge/extensibility-ptz-extension.js":[null],"./ka-ge/extensibility-room-remote.js":[null],"./ka-ge/extensibility.js":[393009,910562],"./ka-ge/feedback.js":[63403,320084],"./ka-ge/files.js":[503075,910562],"./ka-ge/framework.js":[872417,910562],"./ka-ge/freemium-upgrade.js":[null],"./ka-ge/freemium.js":[62636,153613],"./ka-ge/funstuff.js":[609678,606581],"./ka-ge/gallery.js":[114852,102559],"./ka-ge/growth.js":[464072,910562],"./ka-ge/guardians.js":[18825,584197],"./ka-ge/health.js":[913389,204357],"./ka-ge/help.js":[null],"./ka-ge/hololens.js":[119428,153613],"./ka-ge/host-controls.js":[955145,53432],"./ka-ge/jana.js":[674492,300521],"./ka-ge/lightbox.js":[318997,910562],"./ka-ge/live-persona-card.js":[140020,910562],"./ka-ge/live-persona-editor.js":[27519,206948],"./ka-ge/lms-integration.js":[null],"./ka-ge/meet-for-work.js":[992431,606508],"./ka-ge/meeting-analytics.js":[577252,191504],"./ka-ge/meeting-apis-app.js":[null],"./ka-ge/meeting-bot.js":[null],"./ka-ge/meeting-collaboration.js":[76006,165158],"./ka-ge/meeting-flyout.js":[574546,910562],"./ka-ge/meeting-meet-app.js":[336431,910562],"./ka-ge/meeting-options.js":[34332,428256],"./ka-ge/meeting-recap.js":[515789,841746],"./ka-ge/meeting-room-console.js":[null],"./ka-ge/meeting-stream-app.js":[null],"./ka-ge/message-escalate-dialog.js":[623187,365631],"./ka-ge/messaging.js":[856109,910562],"./ka-ge/mobile-attach.js":[null],"./ka-ge/mtma-missed-notifications.js":[61084,910562],"./ka-ge/nova.js":[981111,910562],"./ka-ge/people-app.js":[null],"./ka-ge/people-picker.js":[513957,910562],"./ka-ge/people-targeting.js":[740518,339435],"./ka-ge/people.js":[858825,910562],"./ka-ge/person.js":[115389,910562],"./ka-ge/phonelink-sms.js":[510825,962701],"./ka-ge/pre-core.js":[null],"./ka-ge/premium-benefits.js":[761367,917016],"./ka-ge/presence.js":[494989,910562],"./ka-ge/queues.js":[456604,795898],"./ka-ge/recurrence.js":[853475,198872],"./ka-ge/rsc-application-permissions.js":[null],"./ka-ge/search.js":[496668,318026],"./ka-ge/semantic-object.js":[207404,23169],"./ka-ge/settings.js":[660377,910562],"./ka-ge/share-in-meetings.js":[null],"./ka-ge/share-to-teams-outlook-addin.js":[null],"./ka-ge/share-to-teams-third-party.js":[null],"./ka-ge/share-to-teams.js":[985756,394259],"./ka-ge/shortcut.js":[724956,910562],"./ka-ge/shortcuts.js":[184832,910562],"./ka-ge/simple-collab.js":[295828,910562],"./ka-ge/smart-device.js":[null],"./ka-ge/survey.js":[203471,227954],"./ka-ge/sv-flyout.js":[974982,910562],"./ka-ge/teams-and-channels.js":[725321,703983],"./ka-ge/teams-insider.js":[340855,910562],"./ka-ge/telemetry.js":[624591,910562],"./ka-ge/tfl-homepage.js":[795277,910562],"./ka-ge/tfl-onboarding.js":[230986,910562],"./ka-ge/toast-notifications.js":[283364,910562],"./ka-ge/trusted-ui.js":[null],"./ka-ge/unified-search.js":[24541,394259],"./ka-ge/unsupported-browser.js":[null],"./ka-ge/url-preview.js":[76306,910562],"./ka-ge/video-capture.js":[265605,784497],"./ka-ge/video-message.js":[660584,941193],"./ka-ge/virtual-consumer-events.js":[784327,543178],"./ka-ge/virtual-events.js":[320949,732420],"./ka-ge/webinar.js":[886662,432719],"./ka-ge/welcome-bot.js":[null],"./ka-ge/whats-new.js":[846172,910562],"./ka-ge/wiki.js":[null],"./kk-kz/activity.js":[953432,378456],"./kk-kz/artifacts-platform.js":[469535,792722],"./kk-kz/audience-view-dialog.js":[695022,796317],"./kk-kz/auth.js":[768607,378456],"./kk-kz/autosuggest.js":[398241,378456],"./kk-kz/avatar.js":[644035,378456],"./kk-kz/biometric-enrollment.js":[608197,68597],"./kk-kz/breakout-rooms.js":[747723,469988],"./kk-kz/broadcast.js":[398711,454270],"./kk-kz/calendar.js":[992264,83772],"./kk-kz/calling.js":[986196,939079],"./kk-kz/campaign-notifications.js":[526318,378456],"./kk-kz/carousel-multi-card.js":[null],"./kk-kz/cast.js":[279850,378456],"./kk-kz/channels.js":[44654,378456],"./kk-kz/chat-list.js":[233306,378456],"./kk-kz/coach-report.js":[262379,695885],"./kk-kz/comment-stream.js":[636151,946918],"./kk-kz/communities.js":[200030,378456],"./kk-kz/compose.js":[816436,378456],"./kk-kz/contacts.js":[183124,378456],"./kk-kz/datepicker.js":[565151,688164],"./kk-kz/desktop.js":[null],"./kk-kz/digital-signage.js":[null],"./kk-kz/discover-surface.js":[960823,374972],"./kk-kz/edu.js":[940059,389442],"./kk-kz/embed.js":[915523,378456],"./kk-kz/errors.js":[37591,378456],"./kk-kz/esp.js":[270787,218418],"./kk-kz/extensibility-ptz-extension.js":[null],"./kk-kz/extensibility-room-remote.js":[null],"./kk-kz/extensibility.js":[724784,378456],"./kk-kz/feedback.js":[422152,948473],"./kk-kz/files.js":[610795,378456],"./kk-kz/framework.js":[636806,378456],"./kk-kz/freemium-upgrade.js":[null],"./kk-kz/freemium.js":[888554,939079],"./kk-kz/funstuff.js":[862722,688865],"./kk-kz/gallery.js":[53175,85421],"./kk-kz/growth.js":[680611,378456],"./kk-kz/guardians.js":[853197,24149],"./kk-kz/health.js":[487258,281227],"./kk-kz/help.js":[null],"./kk-kz/hololens.js":[544318,939079],"./kk-kz/host-controls.js":[331897,693158],"./kk-kz/jana.js":[977176,741607],"./kk-kz/lightbox.js":[780100,378456],"./kk-kz/live-persona-card.js":[560367,378456],"./kk-kz/live-persona-editor.js":[118489,816485],"./kk-kz/lms-integration.js":[null],"./kk-kz/meet-for-work.js":[858274,956357],"./kk-kz/meeting-analytics.js":[405663,197282],"./kk-kz/meeting-apis-app.js":[null],"./kk-kz/meeting-bot.js":[null],"./kk-kz/meeting-collaboration.js":[340648,970167],"./kk-kz/meeting-flyout.js":[248562,378456],"./kk-kz/meeting-meet-app.js":[234028,378456],"./kk-kz/meeting-options.js":[71884,697014],"./kk-kz/meeting-recap.js":[589605,877174],"./kk-kz/meeting-room-console.js":[null],"./kk-kz/meeting-stream-app.js":[null],"./kk-kz/message-escalate-dialog.js":[356492,997203],"./kk-kz/messaging.js":[696721,378456],"./kk-kz/mobile-attach.js":[null],"./kk-kz/mtma-missed-notifications.js":[195755,378456],"./kk-kz/nova.js":[749651,378456],"./kk-kz/people-app.js":[null],"./kk-kz/people-picker.js":[479879,378456],"./kk-kz/people-targeting.js":[303664,153267],"./kk-kz/people.js":[10815,378456],"./kk-kz/person.js":[367454,378456],"./kk-kz/phonelink-sms.js":[914553,860333],"./kk-kz/pre-core.js":[null],"./kk-kz/premium-benefits.js":[471878,66772],"./kk-kz/presence.js":[253444,378456],"./kk-kz/queues.js":[413492,647531],"./kk-kz/recurrence.js":[703317,735568],"./kk-kz/rsc-application-permissions.js":[null],"./kk-kz/search.js":[96959,688164],"./kk-kz/semantic-object.js":[245439,902016],"./kk-kz/settings.js":[687300,378456],"./kk-kz/share-in-meetings.js":[null],"./kk-kz/share-to-teams-outlook-addin.js":[null],"./kk-kz/share-to-teams-third-party.js":[null],"./kk-kz/share-to-teams.js":[937697,953228],"./kk-kz/shortcut.js":[135068,378456],"./kk-kz/shortcuts.js":[745906,378456],"./kk-kz/simple-collab.js":[569028,378456],"./kk-kz/smart-device.js":[null],"./kk-kz/survey.js":[280171,89043],"./kk-kz/sv-flyout.js":[708345,378456],"./kk-kz/teams-and-channels.js":[700601,905462],"./kk-kz/teams-insider.js":[180866,378456],"./kk-kz/telemetry.js":[704241,378456],"./kk-kz/tfl-homepage.js":[934205,378456],"./kk-kz/tfl-onboarding.js":[302961,378456],"./kk-kz/toast-notifications.js":[9906,378456],"./kk-kz/trusted-ui.js":[null],"./kk-kz/unified-search.js":[254145,953228],"./kk-kz/unsupported-browser.js":[null],"./kk-kz/url-preview.js":[945944,378456],"./kk-kz/video-capture.js":[395765,150103],"./kk-kz/video-message.js":[570918,742477],"./kk-kz/virtual-consumer-events.js":[577976,573214],"./kk-kz/virtual-events.js":[316610,316290],"./kk-kz/webinar.js":[430398,355192],"./kk-kz/welcome-bot.js":[null],"./kk-kz/whats-new.js":[820284,378456],"./kk-kz/wiki.js":[null],"./ko-kr/activity.js":[290002,867526],"./ko-kr/artifacts-platform.js":[472845,168957],"./ko-kr/audience-view-dialog.js":[837275,860863],"./ko-kr/auth.js":[209236,867526],"./ko-kr/autosuggest.js":[739303,867526],"./ko-kr/avatar.js":[142220,867526],"./ko-kr/biometric-enrollment.js":[172785,931811],"./ko-kr/breakout-rooms.js":[339255,830167],"./ko-kr/broadcast.js":[799877,205400],"./ko-kr/calendar.js":[918398,111943],"./ko-kr/calling.js":[613762,474515],"./ko-kr/campaign-notifications.js":[339028,867526],"./ko-kr/carousel-multi-card.js":[null],"./ko-kr/cast.js":[799895,867526],"./ko-kr/channels.js":[611674,867526],"./ko-kr/chat-list.js":[997333,867526],"./ko-kr/coach-report.js":[176738,876504],"./ko-kr/comment-stream.js":[975464,252421],"./ko-kr/communities.js":[40636,867526],"./ko-kr/compose.js":[533207,867526],"./ko-kr/contacts.js":[776464,867526],"./ko-kr/datepicker.js":[951748,107523],"./ko-kr/desktop.js":[null],"./ko-kr/digital-signage.js":[null],"./ko-kr/discover-surface.js":[371541,538001],"./ko-kr/edu.js":[546534,687045],"./ko-kr/embed.js":[220465,867526],"./ko-kr/errors.js":[227760,867526],"./ko-kr/esp.js":[473811,194658],"./ko-kr/extensibility-ptz-extension.js":[null],"./ko-kr/extensibility-room-remote.js":[null],"./ko-kr/extensibility.js":[893292,867526],"./ko-kr/feedback.js":[972639,558947],"./ko-kr/files.js":[829761,867526],"./ko-kr/framework.js":[539406,867526],"./ko-kr/freemium-upgrade.js":[null],"./ko-kr/freemium.js":[459466,474515],"./ko-kr/funstuff.js":[287325,543492],"./ko-kr/gallery.js":[673912,554223],"./ko-kr/growth.js":[428354,867526],"./ko-kr/guardians.js":[576846,165025],"./ko-kr/health.js":[987158,396435],"./ko-kr/help.js":[null],"./ko-kr/hololens.js":[863448,474515],"./ko-kr/host-controls.js":[902486,559289],"./ko-kr/jana.js":[643957,568384],"./ko-kr/lightbox.js":[129202,867526],"./ko-kr/live-persona-card.js":[38663,867526],"./ko-kr/live-persona-editor.js":[212964,777208],"./ko-kr/lms-integration.js":[null],"./ko-kr/meet-for-work.js":[448434,715657],"./ko-kr/meeting-analytics.js":[963234,167960],"./ko-kr/meeting-apis-app.js":[null],"./ko-kr/meeting-bot.js":[null],"./ko-kr/meeting-collaboration.js":[188827,11189],"./ko-kr/meeting-flyout.js":[45488,867526],"./ko-kr/meeting-meet-app.js":[939531,867526],"./ko-kr/meeting-options.js":[92316,150480],"./ko-kr/meeting-recap.js":[193383,943950],"./ko-kr/meeting-room-console.js":[null],"./ko-kr/meeting-stream-app.js":[null],"./ko-kr/message-escalate-dialog.js":[278019,547296],"./ko-kr/messaging.js":[688132,867526],"./ko-kr/mobile-attach.js":[null],"./ko-kr/mtma-missed-notifications.js":[66204,867526],"./ko-kr/nova.js":[16357,867526],"./ko-kr/people-app.js":[null],"./ko-kr/people-picker.js":[275250,867526],"./ko-kr/people-targeting.js":[390319,502376],"./ko-kr/people.js":[503887,867526],"./ko-kr/person.js":[895336,867526],"./ko-kr/phonelink-sms.js":[152843,321542],"./ko-kr/pre-core.js":[null],"./ko-kr/premium-benefits.js":[821854,153720],"./ko-kr/presence.js":[594781,867526],"./ko-kr/queues.js":[541947,781074],"./ko-kr/recurrence.js":[252254,319856],"./ko-kr/rsc-application-permissions.js":[null],"./ko-kr/search.js":[987897,107523],"./ko-kr/semantic-object.js":[538807,588531],"./ko-kr/settings.js":[547476,867526],"./ko-kr/share-in-meetings.js":[null],"./ko-kr/share-to-teams-outlook-addin.js":[null],"./ko-kr/share-to-teams-third-party.js":[null],"./ko-kr/share-to-teams.js":[419049,755206],"./ko-kr/shortcut.js":[343511,867526],"./ko-kr/shortcuts.js":[444765,867526],"./ko-kr/simple-collab.js":[138721,867526],"./ko-kr/smart-device.js":[null],"./ko-kr/survey.js":[340334,500772],"./ko-kr/sv-flyout.js":[104407,867526],"./ko-kr/teams-and-channels.js":[579635,662763],"./ko-kr/teams-insider.js":[253558,867526],"./ko-kr/telemetry.js":[329122,867526],"./ko-kr/tfl-homepage.js":[367033,867526],"./ko-kr/tfl-onboarding.js":[114433,867526],"./ko-kr/toast-notifications.js":[597969,867526],"./ko-kr/trusted-ui.js":[null],"./ko-kr/unified-search.js":[160176,755206],"./ko-kr/unsupported-browser.js":[null],"./ko-kr/url-preview.js":[806062,867526],"./ko-kr/video-capture.js":[6559,281093],"./ko-kr/video-message.js":[254545,311369],"./ko-kr/virtual-consumer-events.js":[93571,210867],"./ko-kr/virtual-events.js":[902043,478778],"./ko-kr/webinar.js":[452066,267949],"./ko-kr/welcome-bot.js":[null],"./ko-kr/whats-new.js":[212236,867526],"./ko-kr/wiki.js":[null],"./lt-lt/activity.js":[828117,381205],"./lt-lt/artifacts-platform.js":[251259,747049],"./lt-lt/audience-view-dialog.js":[808633,806023],"./lt-lt/auth.js":[885397,381205],"./lt-lt/autosuggest.js":[863435,381205],"./lt-lt/avatar.js":[560712,381205],"./lt-lt/biometric-enrollment.js":[419061,974471],"./lt-lt/breakout-rooms.js":[508157,763991],"./lt-lt/broadcast.js":[382227,919534],"./lt-lt/calendar.js":[759586,564878],"./lt-lt/calling.js":[208768,653247],"./lt-lt/campaign-notifications.js":[596729,381205],"./lt-lt/carousel-multi-card.js":[null],"./lt-lt/cast.js":[894308,381205],"./lt-lt/channels.js":[323301,381205],"./lt-lt/chat-list.js":[144462,381205],"./lt-lt/coach-report.js":[22178,900819],"./lt-lt/comment-stream.js":[322893,596094],"./lt-lt/communities.js":[254554,381205],"./lt-lt/compose.js":[941041,381205],"./lt-lt/contacts.js":[491921,381205],"./lt-lt/datepicker.js":[726576,9014],"./lt-lt/desktop.js":[null],"./lt-lt/digital-signage.js":[null],"./lt-lt/discover-surface.js":[181540,805588],"./lt-lt/edu.js":[381101,37063],"./lt-lt/embed.js":[59817,381205],"./lt-lt/errors.js":[451749,381205],"./lt-lt/esp.js":[183465,733488],"./lt-lt/extensibility-ptz-extension.js":[null],"./lt-lt/extensibility-room-remote.js":[null],"./lt-lt/extensibility.js":[18564,381205],"./lt-lt/feedback.js":[699472,224441],"./lt-lt/files.js":[841429,381205],"./lt-lt/framework.js":[996939,381205],"./lt-lt/freemium-upgrade.js":[null],"./lt-lt/freemium.js":[48532,653247],"./lt-lt/funstuff.js":[30081,808014],"./lt-lt/gallery.js":[676475,693467],"./lt-lt/growth.js":[803185,381205],"./lt-lt/guardians.js":[533745,599710],"./lt-lt/health.js":[902350,157998],"./lt-lt/help.js":[null],"./lt-lt/hololens.js":[239435,653247],"./lt-lt/host-controls.js":[914248,808722],"./lt-lt/jana.js":[66590,562689],"./lt-lt/lightbox.js":[416221,381205],"./lt-lt/live-persona-card.js":[589988,381205],"./lt-lt/live-persona-editor.js":[498113,243857],"./lt-lt/lms-integration.js":[null],"./lt-lt/meet-for-work.js":[26458,861472],"./lt-lt/meeting-analytics.js":[750474,758670],"./lt-lt/meeting-apis-app.js":[null],"./lt-lt/meeting-bot.js":[null],"./lt-lt/meeting-collaboration.js":[879192,818787],"./lt-lt/meeting-flyout.js":[266175,381205],"./lt-lt/meeting-meet-app.js":[654062,381205],"./lt-lt/meeting-options.js":[85676,308735],"./lt-lt/meeting-recap.js":[930534,94954],"./lt-lt/meeting-room-console.js":[null],"./lt-lt/meeting-stream-app.js":[null],"./lt-lt/message-escalate-dialog.js":[570730,717795],"./lt-lt/messaging.js":[807707,381205],"./lt-lt/mobile-attach.js":[null],"./lt-lt/mtma-missed-notifications.js":[407721,381205],"./lt-lt/nova.js":[218133,381205],"./lt-lt/people-app.js":[null],"./lt-lt/people-picker.js":[135602,381205],"./lt-lt/people-targeting.js":[561677,529401],"./lt-lt/people.js":[888631,381205],"./lt-lt/person.js":[253849,381205],"./lt-lt/phonelink-sms.js":[317444,577731],"./lt-lt/pre-core.js":[null],"./lt-lt/premium-benefits.js":[490520,361774],"./lt-lt/presence.js":[432571,381205],"./lt-lt/queues.js":[708840,743061],"./lt-lt/recurrence.js":[18321,735551],"./lt-lt/rsc-application-permissions.js":[null],"./lt-lt/search.js":[631250,9014],"./lt-lt/semantic-object.js":[700448,943505],"./lt-lt/settings.js":[185138,381205],"./lt-lt/share-in-meetings.js":[null],"./lt-lt/share-to-teams-outlook-addin.js":[null],"./lt-lt/share-to-teams-third-party.js":[null],"./lt-lt/share-to-teams.js":[624078,514727],"./lt-lt/shortcut.js":[628153,381205],"./lt-lt/shortcuts.js":[354417,381205],"./lt-lt/simple-collab.js":[845563,381205],"./lt-lt/smart-device.js":[null],"./lt-lt/survey.js":[489045,915522],"./lt-lt/sv-flyout.js":[848575,381205],"./lt-lt/teams-and-channels.js":[747538,492444],"./lt-lt/teams-insider.js":[551721,381205],"./lt-lt/telemetry.js":[408594,381205],"./lt-lt/tfl-homepage.js":[555814,381205],"./lt-lt/tfl-onboarding.js":[93325,381205],"./lt-lt/toast-notifications.js":[371882,381205],"./lt-lt/trusted-ui.js":[null],"./lt-lt/unified-search.js":[381320,514727],"./lt-lt/unsupported-browser.js":[null],"./lt-lt/url-preview.js":[833398,381205],"./lt-lt/video-capture.js":[216140,670103],"./lt-lt/video-message.js":[434840,262860],"./lt-lt/virtual-consumer-events.js":[310888,135734],"./lt-lt/virtual-events.js":[778658,177330],"./lt-lt/webinar.js":[914362,138693],"./lt-lt/welcome-bot.js":[null],"./lt-lt/whats-new.js":[656956,381205],"./lt-lt/wiki.js":[null],"./lv-lv/activity.js":[810778,700926],"./lv-lv/artifacts-platform.js":[406515,579984],"./lv-lv/audience-view-dialog.js":[980082,262851],"./lv-lv/auth.js":[155042,700926],"./lv-lv/autosuggest.js":[602273,700926],"./lv-lv/avatar.js":[890133,700926],"./lv-lv/biometric-enrollment.js":[995924,834869],"./lv-lv/breakout-rooms.js":[508130,540253],"./lv-lv/broadcast.js":[733048,57610],"./lv-lv/calendar.js":[28132,709372],"./lv-lv/calling.js":[93116,817542],"./lv-lv/campaign-notifications.js":[151235,700926],"./lv-lv/carousel-multi-card.js":[null],"./lv-lv/cast.js":[933752,700926],"./lv-lv/channels.js":[444587,700926],"./lv-lv/chat-list.js":[31725,700926],"./lv-lv/coach-report.js":[218590,693594],"./lv-lv/comment-stream.js":[365803,10641],"./lv-lv/communities.js":[445226,700926],"./lv-lv/compose.js":[842524,700926],"./lv-lv/contacts.js":[594108,700926],"./lv-lv/datepicker.js":[99505,558444],"./lv-lv/desktop.js":[null],"./lv-lv/digital-signage.js":[null],"./lv-lv/discover-surface.js":[398832,727202],"./lv-lv/edu.js":[692181,675210],"./lv-lv/embed.js":[74,700926],"./lv-lv/errors.js":[122524,700926],"./lv-lv/esp.js":[913396,846697],"./lv-lv/extensibility-ptz-extension.js":[null],"./lv-lv/extensibility-room-remote.js":[null],"./lv-lv/extensibility.js":[715985,700926],"./lv-lv/feedback.js":[377071,606969],"./lv-lv/files.js":[939108,700926],"./lv-lv/framework.js":[991326,700926],"./lv-lv/freemium-upgrade.js":[null],"./lv-lv/freemium.js":[101427,817542],"./lv-lv/funstuff.js":[669100,961266],"./lv-lv/gallery.js":[122904,500987],"./lv-lv/growth.js":[463905,700926],"./lv-lv/guardians.js":[573703,511908],"./lv-lv/health.js":[704045,96601],"./lv-lv/help.js":[null],"./lv-lv/hololens.js":[837548,817542],"./lv-lv/host-controls.js":[810269,831202],"./lv-lv/jana.js":[806900,743243],"./lv-lv/lightbox.js":[272099,700926],"./lv-lv/live-persona-card.js":[462857,700926],"./lv-lv/live-persona-editor.js":[60117,414013],"./lv-lv/lms-integration.js":[null],"./lv-lv/meet-for-work.js":[797649,89798],"./lv-lv/meeting-analytics.js":[664849,268312],"./lv-lv/meeting-apis-app.js":[null],"./lv-lv/meeting-bot.js":[null],"./lv-lv/meeting-collaboration.js":[499614,762993],"./lv-lv/meeting-flyout.js":[548682,700926],"./lv-lv/meeting-meet-app.js":[937090,700926],"./lv-lv/meeting-options.js":[688730,367977],"./lv-lv/meeting-recap.js":[375729,490842],"./lv-lv/meeting-room-console.js":[null],"./lv-lv/meeting-stream-app.js":[null],"./lv-lv/message-escalate-dialog.js":[828616,661701],"./lv-lv/messaging.js":[647054,700926],"./lv-lv/mobile-attach.js":[null],"./lv-lv/mtma-missed-notifications.js":[693302,700926],"./lv-lv/nova.js":[821981,700926],"./lv-lv/people-app.js":[null],"./lv-lv/people-picker.js":[622496,700926],"./lv-lv/people-targeting.js":[394882,873523],"./lv-lv/people.js":[620533,700926],"./lv-lv/person.js":[540410,700926],"./lv-lv/phonelink-sms.js":[373965,546569],"./lv-lv/pre-core.js":[null],"./lv-lv/premium-benefits.js":[54597,683015],"./lv-lv/presence.js":[911375,700926],"./lv-lv/queues.js":[798857,281237],"./lv-lv/recurrence.js":[841922,648683],"./lv-lv/rsc-application-permissions.js":[null],"./lv-lv/search.js":[69441,558444],"./lv-lv/semantic-object.js":[741570,688901],"./lv-lv/settings.js":[413551,700926],"./lv-lv/share-in-meetings.js":[null],"./lv-lv/share-to-teams-outlook-addin.js":[null],"./lv-lv/share-to-teams-third-party.js":[null],"./lv-lv/share-to-teams.js":[229842,251317],"./lv-lv/shortcut.js":[734538,700926],"./lv-lv/shortcuts.js":[345307,700926],"./lv-lv/simple-collab.js":[189522,700926],"./lv-lv/smart-device.js":[null],"./lv-lv/survey.js":[290285,847282],"./lv-lv/sv-flyout.js":[611120,700926],"./lv-lv/teams-and-channels.js":[951495,708174],"./lv-lv/teams-insider.js":[444901,700926],"./lv-lv/telemetry.js":[903190,700926],"./lv-lv/tfl-homepage.js":[774015,700926],"./lv-lv/tfl-onboarding.js":[447320,700926],"./lv-lv/toast-notifications.js":[695182,700926],"./lv-lv/trusted-ui.js":[null],"./lv-lv/unified-search.js":[213720,251317],"./lv-lv/unsupported-browser.js":[null],"./lv-lv/url-preview.js":[871092,700926],"./lv-lv/video-capture.js":[529535,238957],"./lv-lv/video-message.js":[701829,103568],"./lv-lv/virtual-consumer-events.js":[302983,348340],"./lv-lv/virtual-events.js":[165149,416682],"./lv-lv/webinar.js":[622197,134255],"./lv-lv/welcome-bot.js":[null],"./lv-lv/whats-new.js":[64360,700926],"./lv-lv/wiki.js":[null],"./mk-mk/activity.js":[909191,638437],"./mk-mk/artifacts-platform.js":[494084,130092],"./mk-mk/audience-view-dialog.js":[220869,952157],"./mk-mk/auth.js":[389416,638437],"./mk-mk/autosuggest.js":[133534,638437],"./mk-mk/avatar.js":[317522,638437],"./mk-mk/biometric-enrollment.js":[329561,960100],"./mk-mk/breakout-rooms.js":[941650,267299],"./mk-mk/broadcast.js":[602441,42119],"./mk-mk/calendar.js":[437019,921978],"./mk-mk/calling.js":[720616,600057],"./mk-mk/campaign-notifications.js":[248648,638437],"./mk-mk/carousel-multi-card.js":[null],"./mk-mk/cast.js":[245263,638437],"./mk-mk/channels.js":[361645,638437],"./mk-mk/chat-list.js":[248254,638437],"./mk-mk/coach-report.js":[68753,898701],"./mk-mk/comment-stream.js":[75135,425574],"./mk-mk/communities.js":[155242,638437],"./mk-mk/compose.js":[637823,638437],"./mk-mk/contacts.js":[827809,638437],"./mk-mk/datepicker.js":[673538,673],"./mk-mk/desktop.js":[null],"./mk-mk/digital-signage.js":[null],"./mk-mk/discover-surface.js":[36796,138008],"./mk-mk/edu.js":[180414,230016],"./mk-mk/embed.js":[361096,638437],"./mk-mk/errors.js":[560254,638437],"./mk-mk/esp.js":[127773,270602],"./mk-mk/extensibility-ptz-extension.js":[null],"./mk-mk/extensibility-room-remote.js":[null],"./mk-mk/extensibility.js":[21305,638437],"./mk-mk/feedback.js":[285960,334080],"./mk-mk/files.js":[108999,638437],"./mk-mk/framework.js":[463391,638437],"./mk-mk/freemium-upgrade.js":[null],"./mk-mk/freemium.js":[276719,600057],"./mk-mk/funstuff.js":[972483,376106],"./mk-mk/gallery.js":[635976,121786],"./mk-mk/growth.js":[224439,638437],"./mk-mk/guardians.js":[559779,553277],"./mk-mk/health.js":[429712,495447],"./mk-mk/help.js":[null],"./mk-mk/hololens.js":[723614,600057],"./mk-mk/host-controls.js":[15311,764958],"./mk-mk/jana.js":[692686,926220],"./mk-mk/lightbox.js":[280982,638437],"./mk-mk/live-persona-card.js":[889510,638437],"./mk-mk/live-persona-editor.js":[430161,487239],"./mk-mk/lms-integration.js":[null],"./mk-mk/meet-for-work.js":[724988,677093],"./mk-mk/meeting-analytics.js":[895901,37689],"./mk-mk/meeting-apis-app.js":[null],"./mk-mk/meeting-bot.js":[null],"./mk-mk/meeting-collaboration.js":[926230,108224],"./mk-mk/meeting-flyout.js":[800708,638437],"./mk-mk/meeting-meet-app.js":[691758,638437],"./mk-mk/meeting-options.js":[769873,378334],"./mk-mk/meeting-recap.js":[624722,647812],"./mk-mk/meeting-room-console.js":[null],"./mk-mk/meeting-stream-app.js":[null],"./mk-mk/message-escalate-dialog.js":[905584,997494],"./mk-mk/messaging.js":[742921,638437],"./mk-mk/mobile-attach.js":[null],"./mk-mk/mtma-missed-notifications.js":[920516,638437],"./mk-mk/nova.js":[604625,638437],"./mk-mk/people-app.js":[null],"./mk-mk/people-picker.js":[500598,638437],"./mk-mk/people-targeting.js":[170001,852683],"./mk-mk/people.js":[405451,638437],"./mk-mk/person.js":[293055,638437],"./mk-mk/phonelink-sms.js":[116953,655259],"./mk-mk/pre-core.js":[null],"./mk-mk/premium-benefits.js":[859378,180958],"./mk-mk/presence.js":[14184,638437],"./mk-mk/queues.js":[280934,695366],"./mk-mk/recurrence.js":[757355,681102],"./mk-mk/rsc-application-permissions.js":[null],"./mk-mk/search.js":[431751,673],"./mk-mk/semantic-object.js":[264360,821083],"./mk-mk/settings.js":[513110,638437],"./mk-mk/share-in-meetings.js":[null],"./mk-mk/share-to-teams-outlook-addin.js":[null],"./mk-mk/share-to-teams-third-party.js":[null],"./mk-mk/share-to-teams.js":[298113,829122],"./mk-mk/shortcut.js":[912659,638437],"./mk-mk/shortcuts.js":[88887,638437],"./mk-mk/simple-collab.js":[850482,638437],"./mk-mk/smart-device.js":[null],"./mk-mk/survey.js":[705062,539308],"./mk-mk/sv-flyout.js":[111454,638437],"./mk-mk/teams-and-channels.js":[648120,69177],"./mk-mk/teams-insider.js":[393690,638437],"./mk-mk/telemetry.js":[427155,638437],"./mk-mk/tfl-homepage.js":[460690,638437],"./mk-mk/tfl-onboarding.js":[758879,638437],"./mk-mk/toast-notifications.js":[605459,638437],"./mk-mk/trusted-ui.js":[null],"./mk-mk/unified-search.js":[511422,829122],"./mk-mk/unsupported-browser.js":[null],"./mk-mk/url-preview.js":[77556,638437],"./mk-mk/video-capture.js":[801625,732241],"./mk-mk/video-message.js":[612707,859019],"./mk-mk/virtual-consumer-events.js":[865393,979815],"./mk-mk/virtual-events.js":[805724,105880],"./mk-mk/webinar.js":[682103,787329],"./mk-mk/welcome-bot.js":[null],"./mk-mk/whats-new.js":[379758,638437],"./mk-mk/wiki.js":[null],"./nb-no/activity.js":[435653,4128],"./nb-no/artifacts-platform.js":[912093,712252],"./nb-no/audience-view-dialog.js":[975144,524364],"./nb-no/auth.js":[924385,4128],"./nb-no/autosuggest.js":[88420,4128],"./nb-no/avatar.js":[597638,4128],"./nb-no/biometric-enrollment.js":[757379,897704],"./nb-no/breakout-rooms.js":[946421,829916],"./nb-no/broadcast.js":[859035,422312],"./nb-no/calendar.js":[22512,463054],"./nb-no/calling.js":[789290,144145],"./nb-no/campaign-notifications.js":[8200,4128],"./nb-no/carousel-multi-card.js":[null],"./nb-no/cast.js":[57023,4128],"./nb-no/channels.js":[699907,4128],"./nb-no/chat-list.js":[157447,4128],"./nb-no/coach-report.js":[926014,715442],"./nb-no/comment-stream.js":[341041,490070],"./nb-no/communities.js":[645119,4128],"./nb-no/compose.js":[506129,4128],"./nb-no/contacts.js":[937622,4128],"./nb-no/datepicker.js":[271741,938699],"./nb-no/desktop.js":[null],"./nb-no/digital-signage.js":[null],"./nb-no/discover-surface.js":[239239,381974],"./nb-no/edu.js":[927034,122924],"./nb-no/embed.js":[614720,4128],"./nb-no/errors.js":[759531,4128],"./nb-no/esp.js":[565991,132897],"./nb-no/extensibility-ptz-extension.js":[null],"./nb-no/extensibility-room-remote.js":[null],"./nb-no/extensibility.js":[343131,4128],"./nb-no/feedback.js":[538539,103202],"./nb-no/files.js":[254800,4128],"./nb-no/framework.js":[466244,4128],"./nb-no/freemium-upgrade.js":[null],"./nb-no/freemium.js":[713824,144145],"./nb-no/funstuff.js":[389772,446150],"./nb-no/gallery.js":[550744,777067],"./nb-no/growth.js":[158986,4128],"./nb-no/guardians.js":[211555,896793],"./nb-no/health.js":[785629,620295],"./nb-no/help.js":[null],"./nb-no/hololens.js":[112147,144145],"./nb-no/host-controls.js":[214797,90751],"./nb-no/jana.js":[666613,696287],"./nb-no/lightbox.js":[676756,4128],"./nb-no/live-persona-card.js":[39571,4128],"./nb-no/live-persona-editor.js":[955620,346978],"./nb-no/lms-integration.js":[null],"./nb-no/meet-for-work.js":[451111,605543],"./nb-no/meeting-analytics.js":[757084,621993],"./nb-no/meeting-apis-app.js":[null],"./nb-no/meeting-bot.js":[null],"./nb-no/meeting-collaboration.js":[160405,635329],"./nb-no/meeting-flyout.js":[140228,4128],"./nb-no/meeting-meet-app.js":[206547,4128],"./nb-no/meeting-options.js":[950514,933346],"./nb-no/meeting-recap.js":[822755,984982],"./nb-no/meeting-room-console.js":[null],"./nb-no/meeting-stream-app.js":[null],"./nb-no/message-escalate-dialog.js":[220621,341687],"./nb-no/messaging.js":[762883,4128],"./nb-no/mobile-attach.js":[null],"./nb-no/mtma-missed-notifications.js":[859489,4128],"./nb-no/nova.js":[660938,4128],"./nb-no/people-app.js":[null],"./nb-no/people-picker.js":[64498,4128],"./nb-no/people-targeting.js":[308676,534279],"./nb-no/people.js":[950932,4128],"./nb-no/person.js":[887542,4128],"./nb-no/phonelink-sms.js":[518350,633424],"./nb-no/pre-core.js":[null],"./nb-no/premium-benefits.js":[892795,997097],"./nb-no/presence.js":[431821,4128],"./nb-no/queues.js":[434571,599581],"./nb-no/recurrence.js":[993668,973142],"./nb-no/rsc-application-permissions.js":[null],"./nb-no/search.js":[91168,938699],"./nb-no/semantic-object.js":[625061,220573],"./nb-no/settings.js":[202856,4128],"./nb-no/share-in-meetings.js":[null],"./nb-no/share-to-teams-outlook-addin.js":[null],"./nb-no/share-to-teams-third-party.js":[null],"./nb-no/share-to-teams.js":[203257,597548],"./nb-no/shortcut.js":[664449,4128],"./nb-no/shortcuts.js":[367953,4128],"./nb-no/simple-collab.js":[46633,4128],"./nb-no/smart-device.js":[null],"./nb-no/survey.js":[742775,626332],"./nb-no/sv-flyout.js":[13086,4128],"./nb-no/teams-and-channels.js":[120451,399617],"./nb-no/teams-insider.js":[53395,4128],"./nb-no/telemetry.js":[319228,4128],"./nb-no/tfl-homepage.js":[759445,4128],"./nb-no/tfl-onboarding.js":[995532,4128],"./nb-no/toast-notifications.js":[894802,4128],"./nb-no/trusted-ui.js":[null],"./nb-no/unified-search.js":[844892,597548],"./nb-no/unsupported-browser.js":[null],"./nb-no/url-preview.js":[73737,4128],"./nb-no/video-capture.js":[76751,638002],"./nb-no/video-message.js":[393337,917692],"./nb-no/virtual-consumer-events.js":[387283,299773],"./nb-no/virtual-events.js":[472281,570152],"./nb-no/webinar.js":[333161,448226],"./nb-no/welcome-bot.js":[null],"./nb-no/whats-new.js":[263126,4128],"./nb-no/wiki.js":[null],"./nl-nl/activity.js":[809043,834652],"./nl-nl/artifacts-platform.js":[301038,848506],"./nl-nl/audience-view-dialog.js":[909057,119050],"./nl-nl/auth.js":[135286,834652],"./nl-nl/autosuggest.js":[792757,834652],"./nl-nl/avatar.js":[84998,834652],"./nl-nl/biometric-enrollment.js":[912494,174801],"./nl-nl/breakout-rooms.js":[390829,679230],"./nl-nl/broadcast.js":[379404,420158],"./nl-nl/calendar.js":[505173,936406],"./nl-nl/calling.js":[624511,482098],"./nl-nl/campaign-notifications.js":[792090,834652],"./nl-nl/carousel-multi-card.js":[null],"./nl-nl/cast.js":[136668,834652],"./nl-nl/channels.js":[116294,834652],"./nl-nl/chat-list.js":[781037,834652],"./nl-nl/coach-report.js":[151299,190625],"./nl-nl/comment-stream.js":[393063,931493],"./nl-nl/communities.js":[191120,834652],"./nl-nl/compose.js":[588338,834652],"./nl-nl/contacts.js":[796181,834652],"./nl-nl/datepicker.js":[197339,439036],"./nl-nl/desktop.js":[null],"./nl-nl/digital-signage.js":[null],"./nl-nl/discover-surface.js":[308421,365745],"./nl-nl/edu.js":[426291,958392],"./nl-nl/embed.js":[319853,834652],"./nl-nl/errors.js":[844726,834652],"./nl-nl/esp.js":[781514,501924],"./nl-nl/extensibility-ptz-extension.js":[null],"./nl-nl/extensibility-room-remote.js":[null],"./nl-nl/extensibility.js":[270966,834652],"./nl-nl/feedback.js":[151046,950703],"./nl-nl/files.js":[891205,834652],"./nl-nl/framework.js":[957889,834652],"./nl-nl/freemium-upgrade.js":[null],"./nl-nl/freemium.js":[287149,482098],"./nl-nl/funstuff.js":[606518,416184],"./nl-nl/gallery.js":[267378,8118],"./nl-nl/growth.js":[236166,834652],"./nl-nl/guardians.js":[773846,306929],"./nl-nl/health.js":[189930,575238],"./nl-nl/help.js":[null],"./nl-nl/hololens.js":[842646,482098],"./nl-nl/host-controls.js":[175929,836865],"./nl-nl/jana.js":[382824,456591],"./nl-nl/lightbox.js":[517741,834652],"./nl-nl/live-persona-card.js":[599794,834652],"./nl-nl/live-persona-editor.js":[277063,541666],"./nl-nl/lms-integration.js":[null],"./nl-nl/meet-for-work.js":[370301,68057],"./nl-nl/meeting-analytics.js":[296833,7850],"./nl-nl/meeting-apis-app.js":[null],"./nl-nl/meeting-bot.js":[null],"./nl-nl/meeting-collaboration.js":[779728,934188],"./nl-nl/meeting-flyout.js":[369413,834652],"./nl-nl/meeting-meet-app.js":[900710,834652],"./nl-nl/meeting-options.js":[271238,506063],"./nl-nl/meeting-recap.js":[121922,297125],"./nl-nl/meeting-room-console.js":[null],"./nl-nl/meeting-stream-app.js":[null],"./nl-nl/message-escalate-dialog.js":[531489,857330],"./nl-nl/messaging.js":[695026,834652],"./nl-nl/mobile-attach.js":[null],"./nl-nl/mtma-missed-notifications.js":[594913,834652],"./nl-nl/nova.js":[406376,834652],"./nl-nl/people-app.js":[null],"./nl-nl/people-picker.js":[597558,834652],"./nl-nl/people-targeting.js":[382970,32085],"./nl-nl/people.js":[496304,834652],"./nl-nl/person.js":[340233,834652],"./nl-nl/phonelink-sms.js":[16604,968304],"./nl-nl/pre-core.js":[null],"./nl-nl/premium-benefits.js":[92819,448819],"./nl-nl/presence.js":[721453,834652],"./nl-nl/queues.js":[107322,996866],"./nl-nl/recurrence.js":[729195,415999],"./nl-nl/rsc-application-permissions.js":[null],"./nl-nl/search.js":[246018,439036],"./nl-nl/semantic-object.js":[258087,645702],"./nl-nl/settings.js":[890448,834652],"./nl-nl/share-in-meetings.js":[null],"./nl-nl/share-to-teams-outlook-addin.js":[null],"./nl-nl/share-to-teams-third-party.js":[null],"./nl-nl/share-to-teams.js":[31033,654569],"./nl-nl/shortcut.js":[703714,834652],"./nl-nl/shortcuts.js":[641280,834652],"./nl-nl/simple-collab.js":[857030,834652],"./nl-nl/smart-device.js":[null],"./nl-nl/survey.js":[997613,573051],"./nl-nl/sv-flyout.js":[449991,834652],"./nl-nl/teams-and-channels.js":[747540,995052],"./nl-nl/teams-insider.js":[822570,834652],"./nl-nl/telemetry.js":[890211,834652],"./nl-nl/tfl-homepage.js":[350194,834652],"./nl-nl/tfl-onboarding.js":[47647,834652],"./nl-nl/toast-notifications.js":[542942,834652],"./nl-nl/trusted-ui.js":[null],"./nl-nl/unified-search.js":[871460,654569],"./nl-nl/unsupported-browser.js":[null],"./nl-nl/url-preview.js":[667828,834652],"./nl-nl/video-capture.js":[356066,218893],"./nl-nl/video-message.js":[936528,660148],"./nl-nl/virtual-consumer-events.js":[118869,52400],"./nl-nl/virtual-events.js":[300498,766793],"./nl-nl/webinar.js":[374272,120397],"./nl-nl/welcome-bot.js":[null],"./nl-nl/whats-new.js":[76880,834652],"./nl-nl/wiki.js":[null],"./nn-no/activity.js":[904742,523190],"./nn-no/artifacts-platform.js":[428297,766186],"./nn-no/audience-view-dialog.js":[213665,335346],"./nn-no/auth.js":[372211,523190],"./nn-no/autosuggest.js":[380266,523190],"./nn-no/avatar.js":[895426,523190],"./nn-no/biometric-enrollment.js":[811554,249241],"./nn-no/breakout-rooms.js":[921195,961057],"./nn-no/broadcast.js":[110069,414712],"./nn-no/calendar.js":[599780,691138],"./nn-no/calling.js":[56636,979355],"./nn-no/campaign-notifications.js":[712134,523190],"./nn-no/carousel-multi-card.js":[null],"./nn-no/cast.js":[216462,523190],"./nn-no/channels.js":[214962,523190],"./nn-no/chat-list.js":[898327,523190],"./nn-no/coach-report.js":[882739,189980],"./nn-no/comment-stream.js":[516640,991242],"./nn-no/communities.js":[158360,523190],"./nn-no/compose.js":[11995,523190],"./nn-no/contacts.js":[212335,523190],"./nn-no/datepicker.js":[64047,566525],"./nn-no/desktop.js":[null],"./nn-no/digital-signage.js":[null],"./nn-no/discover-surface.js":[969330,250241],"./nn-no/edu.js":[792650,339699],"./nn-no/embed.js":[359684,523190],"./nn-no/errors.js":[663008,523190],"./nn-no/esp.js":[64748,992784],"./nn-no/extensibility-ptz-extension.js":[null],"./nn-no/extensibility-room-remote.js":[null],"./nn-no/extensibility.js":[804227,523190],"./nn-no/feedback.js":[794491,570690],"./nn-no/files.js":[758782,523190],"./nn-no/framework.js":[24013,523190],"./nn-no/freemium-upgrade.js":[null],"./nn-no/freemium.js":[485510,979355],"./nn-no/funstuff.js":[321986,277483],"./nn-no/gallery.js":[24587,385470],"./nn-no/growth.js":[188330,523190],"./nn-no/guardians.js":[141296,504299],"./nn-no/health.js":[130812,36856],"./nn-no/help.js":[null],"./nn-no/hololens.js":[664119,979355],"./nn-no/host-controls.js":[388080,413440],"./nn-no/jana.js":[10474,509307],"./nn-no/lightbox.js":[18645,523190],"./nn-no/live-persona-card.js":[992348,523190],"./nn-no/live-persona-editor.js":[22066,149623],"./nn-no/lms-integration.js":[null],"./nn-no/meet-for-work.js":[147070,828582],"./nn-no/meeting-analytics.js":[330444,861386],"./nn-no/meeting-apis-app.js":[null],"./nn-no/meeting-bot.js":[null],"./nn-no/meeting-collaboration.js":[888735,274121],"./nn-no/meeting-flyout.js":[182268,523190],"./nn-no/meeting-meet-app.js":[678365,523190],"./nn-no/meeting-options.js":[503481,814834],"./nn-no/meeting-recap.js":[359381,704987],"./nn-no/meeting-room-console.js":[null],"./nn-no/meeting-stream-app.js":[null],"./nn-no/message-escalate-dialog.js":[695515,979753],"./nn-no/messaging.js":[439151,523190],"./nn-no/mobile-attach.js":[null],"./nn-no/mtma-missed-notifications.js":[253861,523190],"./nn-no/nova.js":[624348,523190],"./nn-no/people-app.js":[null],"./nn-no/people-picker.js":[622566,523190],"./nn-no/people-targeting.js":[819662,64108],"./nn-no/people.js":[141900,523190],"./nn-no/person.js":[465504,523190],"./nn-no/phonelink-sms.js":[193526,627377],"./nn-no/pre-core.js":[null],"./nn-no/premium-benefits.js":[47503,81660],"./nn-no/presence.js":[113980,523190],"./nn-no/queues.js":[215070,501990],"./nn-no/recurrence.js":[42812,617662],"./nn-no/rsc-application-permissions.js":[null],"./nn-no/search.js":[812534,566525],"./nn-no/semantic-object.js":[251843,274786],"./nn-no/settings.js":[314273,523190],"./nn-no/share-in-meetings.js":[null],"./nn-no/share-to-teams-outlook-addin.js":[null],"./nn-no/share-to-teams-third-party.js":[null],"./nn-no/share-to-teams.js":[778777,896317],"./nn-no/shortcut.js":[173247,523190],"./nn-no/shortcuts.js":[614619,523190],"./nn-no/simple-collab.js":[146641,523190],"./nn-no/smart-device.js":[null],"./nn-no/survey.js":[638835,290189],"./nn-no/sv-flyout.js":[815598,523190],"./nn-no/teams-and-channels.js":[967152,27214],"./nn-no/teams-insider.js":[454670,523190],"./nn-no/telemetry.js":[72691,523190],"./nn-no/tfl-homepage.js":[646655,523190],"./nn-no/tfl-onboarding.js":[799216,523190],"./nn-no/toast-notifications.js":[862443,523190],"./nn-no/trusted-ui.js":[null],"./nn-no/unified-search.js":[872692,896317],"./nn-no/unsupported-browser.js":[null],"./nn-no/url-preview.js":[242629,523190],"./nn-no/video-capture.js":[126574,227810],"./nn-no/video-message.js":[72223,903584],"./nn-no/virtual-consumer-events.js":[499989,684228],"./nn-no/virtual-events.js":[786282,125502],"./nn-no/webinar.js":[988642,460767],"./nn-no/welcome-bot.js":[null],"./nn-no/whats-new.js":[424543,523190],"./nn-no/wiki.js":[null],"./pl-pl/activity.js":[148487,383062],"./pl-pl/artifacts-platform.js":[9598,429453],"./pl-pl/audience-view-dialog.js":[818733,389869],"./pl-pl/auth.js":[813870,383062],"./pl-pl/autosuggest.js":[661808,383062],"./pl-pl/avatar.js":[15265,383062],"./pl-pl/biometric-enrollment.js":[920024,813794],"./pl-pl/breakout-rooms.js":[807319,471158],"./pl-pl/broadcast.js":[719136,688282],"./pl-pl/calendar.js":[807137,860639],"./pl-pl/calling.js":[68270,662245],"./pl-pl/campaign-notifications.js":[685875,383062],"./pl-pl/carousel-multi-card.js":[null],"./pl-pl/cast.js":[17348,383062],"./pl-pl/channels.js":[591371,383062],"./pl-pl/chat-list.js":[40991,383062],"./pl-pl/coach-report.js":[577219,557787],"./pl-pl/comment-stream.js":[666114,344625],"./pl-pl/communities.js":[500461,383062],"./pl-pl/compose.js":[135028,383062],"./pl-pl/contacts.js":[945282,383062],"./pl-pl/datepicker.js":[438941,959860],"./pl-pl/desktop.js":[null],"./pl-pl/digital-signage.js":[null],"./pl-pl/discover-surface.js":[539862,4452],"./pl-pl/edu.js":[298698,549697],"./pl-pl/embed.js":[694069,383062],"./pl-pl/errors.js":[637902,383062],"./pl-pl/esp.js":[76643,989139],"./pl-pl/extensibility-ptz-extension.js":[null],"./pl-pl/extensibility-room-remote.js":[null],"./pl-pl/extensibility.js":[548400,383062],"./pl-pl/feedback.js":[824970,884881],"./pl-pl/files.js":[365233,383062],"./pl-pl/framework.js":[160633,383062],"./pl-pl/freemium-upgrade.js":[null],"./pl-pl/freemium.js":[84120,662245],"./pl-pl/funstuff.js":[347447,933865],"./pl-pl/gallery.js":[195924,266144],"./pl-pl/growth.js":[291277,383062],"./pl-pl/guardians.js":[240128,389903],"./pl-pl/health.js":[202831,231527],"./pl-pl/help.js":[null],"./pl-pl/hololens.js":[114447,662245],"./pl-pl/host-controls.js":[35071,26285],"./pl-pl/jana.js":[707207,667034],"./pl-pl/lightbox.js":[595961,383062],"./pl-pl/live-persona-card.js":[978570,383062],"./pl-pl/live-persona-editor.js":[203634,972451],"./pl-pl/lms-integration.js":[null],"./pl-pl/meet-for-work.js":[901894,223283],"./pl-pl/meeting-analytics.js":[113523,366435],"./pl-pl/meeting-apis-app.js":[null],"./pl-pl/meeting-bot.js":[null],"./pl-pl/meeting-collaboration.js":[771549,350261],"./pl-pl/meeting-flyout.js":[708332,383062],"./pl-pl/meeting-meet-app.js":[310879,383062],"./pl-pl/meeting-options.js":[18731,927030],"./pl-pl/meeting-recap.js":[652853,932610],"./pl-pl/meeting-room-console.js":[null],"./pl-pl/meeting-stream-app.js":[null],"./pl-pl/message-escalate-dialog.js":[406335,370898],"./pl-pl/messaging.js":[802794,383062],"./pl-pl/mobile-attach.js":[null],"./pl-pl/mtma-missed-notifications.js":[599523,383062],"./pl-pl/nova.js":[20681,383062],"./pl-pl/people-app.js":[null],"./pl-pl/people-picker.js":[308929,383062],"./pl-pl/people-targeting.js":[299965,188437],"./pl-pl/people.js":[278926,383062],"./pl-pl/person.js":[581705,383062],"./pl-pl/phonelink-sms.js":[516797,775293],"./pl-pl/pre-core.js":[null],"./pl-pl/premium-benefits.js":[233233,770828],"./pl-pl/presence.js":[771447,383062],"./pl-pl/queues.js":[345646,831730],"./pl-pl/recurrence.js":[393577,120904],"./pl-pl/rsc-application-permissions.js":[null],"./pl-pl/search.js":[425579,959860],"./pl-pl/semantic-object.js":[435149,913418],"./pl-pl/settings.js":[233332,383062],"./pl-pl/share-in-meetings.js":[null],"./pl-pl/share-to-teams-outlook-addin.js":[null],"./pl-pl/share-to-teams-third-party.js":[null],"./pl-pl/share-to-teams.js":[213139,322628],"./pl-pl/shortcut.js":[285433,383062],"./pl-pl/shortcuts.js":[519112,383062],"./pl-pl/simple-collab.js":[759496,383062],"./pl-pl/smart-device.js":[null],"./pl-pl/survey.js":[639840,375519],"./pl-pl/sv-flyout.js":[872659,383062],"./pl-pl/teams-and-channels.js":[976834,162531],"./pl-pl/teams-insider.js":[12457,383062],"./pl-pl/telemetry.js":[195220,383062],"./pl-pl/tfl-homepage.js":[606085,383062],"./pl-pl/tfl-onboarding.js":[45097,383062],"./pl-pl/toast-notifications.js":[130837,383062],"./pl-pl/trusted-ui.js":[null],"./pl-pl/unified-search.js":[125967,322628],"./pl-pl/unsupported-browser.js":[null],"./pl-pl/url-preview.js":[231369,383062],"./pl-pl/video-capture.js":[666752,433418],"./pl-pl/video-message.js":[666998,284926],"./pl-pl/virtual-consumer-events.js":[284280,365501],"./pl-pl/virtual-events.js":[882668,236854],"./pl-pl/webinar.js":[497858,468472],"./pl-pl/welcome-bot.js":[null],"./pl-pl/whats-new.js":[231524,383062],"./pl-pl/wiki.js":[null],"./pt-br/activity.js":[237939,390928],"./pt-br/artifacts-platform.js":[511555,604340],"./pt-br/audience-view-dialog.js":[967927,47761],"./pt-br/auth.js":[464680,390928],"./pt-br/autosuggest.js":[704102,390928],"./pt-br/avatar.js":[658613,390928],"./pt-br/biometric-enrollment.js":[570519,537446],"./pt-br/breakout-rooms.js":[457624,650053],"./pt-br/broadcast.js":[639510,75413],"./pt-br/calendar.js":[798999,863185],"./pt-br/calling.js":[548913,88478],"./pt-br/campaign-notifications.js":[809431,390928],"./pt-br/carousel-multi-card.js":[null],"./pt-br/cast.js":[917282,390928],"./pt-br/channels.js":[21182,390928],"./pt-br/chat-list.js":[653759,390928],"./pt-br/coach-report.js":[779225,470],"./pt-br/comment-stream.js":[322134,783797],"./pt-br/communities.js":[941345,390928],"./pt-br/compose.js":[496313,390928],"./pt-br/contacts.js":[472804,390928],"./pt-br/datepicker.js":[4099,766761],"./pt-br/desktop.js":[null],"./pt-br/digital-signage.js":[null],"./pt-br/discover-surface.js":[457035,16571],"./pt-br/edu.js":[859541,365099],"./pt-br/embed.js":[517869,390928],"./pt-br/errors.js":[314573,390928],"./pt-br/esp.js":[850317,102771],"./pt-br/extensibility-ptz-extension.js":[null],"./pt-br/extensibility-room-remote.js":[null],"./pt-br/extensibility.js":[788446,390928],"./pt-br/feedback.js":[643786,987894],"./pt-br/files.js":[321724,390928],"./pt-br/framework.js":[539618,390928],"./pt-br/freemium-upgrade.js":[null],"./pt-br/freemium.js":[742802,88478],"./pt-br/funstuff.js":[312557,943391],"./pt-br/gallery.js":[108396,813652],"./pt-br/growth.js":[303507,390928],"./pt-br/guardians.js":[804950,629741],"./pt-br/health.js":[934699,648736],"./pt-br/help.js":[null],"./pt-br/hololens.js":[51957,88478],"./pt-br/host-controls.js":[522736,645465],"./pt-br/jana.js":[232362,347452],"./pt-br/lightbox.js":[942735,390928],"./pt-br/live-persona-card.js":[135158,390928],"./pt-br/live-persona-editor.js":[25972,458567],"./pt-br/lms-integration.js":[null],"./pt-br/meet-for-work.js":[53931,514512],"./pt-br/meeting-analytics.js":[222049,591736],"./pt-br/meeting-apis-app.js":[null],"./pt-br/meeting-bot.js":[null],"./pt-br/meeting-collaboration.js":[280563,378648],"./pt-br/meeting-flyout.js":[102962,390928],"./pt-br/meeting-meet-app.js":[740082,390928],"./pt-br/meeting-options.js":[195102,413680],"./pt-br/meeting-recap.js":[69702,7813],"./pt-br/meeting-room-console.js":[null],"./pt-br/meeting-stream-app.js":[null],"./pt-br/message-escalate-dialog.js":[596066,541707],"./pt-br/messaging.js":[848531,390928],"./pt-br/mobile-attach.js":[null],"./pt-br/mtma-missed-notifications.js":[619653,390928],"./pt-br/nova.js":[554689,390928],"./pt-br/people-app.js":[null],"./pt-br/people-picker.js":[47823,390928],"./pt-br/people-targeting.js":[20714,895768],"./pt-br/people.js":[235049,390928],"./pt-br/person.js":[869224,390928],"./pt-br/phonelink-sms.js":[537823,740779],"./pt-br/pre-core.js":[null],"./pt-br/premium-benefits.js":[396502,662341],"./pt-br/presence.js":[243412,390928],"./pt-br/queues.js":[653439,574329],"./pt-br/recurrence.js":[801452,717293],"./pt-br/rsc-application-permissions.js":[null],"./pt-br/search.js":[299690,766761],"./pt-br/semantic-object.js":[658323,872501],"./pt-br/settings.js":[558634,390928],"./pt-br/share-in-meetings.js":[null],"./pt-br/share-to-teams-outlook-addin.js":[null],"./pt-br/share-to-teams-third-party.js":[null],"./pt-br/share-to-teams.js":[692514,869144],"./pt-br/shortcut.js":[794634,390928],"./pt-br/shortcuts.js":[740335,390928],"./pt-br/simple-collab.js":[459931,390928],"./pt-br/smart-device.js":[null],"./pt-br/survey.js":[242805,798972],"./pt-br/sv-flyout.js":[38778,390928],"./pt-br/teams-and-channels.js":[110995,430242],"./pt-br/teams-insider.js":[708726,390928],"./pt-br/telemetry.js":[880239,390928],"./pt-br/tfl-homepage.js":[160038,390928],"./pt-br/tfl-onboarding.js":[99371,390928],"./pt-br/toast-notifications.js":[17026,390928],"./pt-br/trusted-ui.js":[null],"./pt-br/unified-search.js":[341837,869144],"./pt-br/unsupported-browser.js":[null],"./pt-br/url-preview.js":[183678,390928],"./pt-br/video-capture.js":[52013,118529],"./pt-br/video-message.js":[746346,989465],"./pt-br/virtual-consumer-events.js":[351991,431022],"./pt-br/virtual-events.js":[246722,93413],"./pt-br/webinar.js":[556296,330637],"./pt-br/welcome-bot.js":[null],"./pt-br/whats-new.js":[669971,390928],"./pt-br/wiki.js":[null],"./pt-pt/activity.js":[832975,597828],"./pt-pt/artifacts-platform.js":[345512,302514],"./pt-pt/audience-view-dialog.js":[146149,15257],"./pt-pt/auth.js":[74435,597828],"./pt-pt/autosuggest.js":[741886,597828],"./pt-pt/avatar.js":[98575,597828],"./pt-pt/biometric-enrollment.js":[89021,553460],"./pt-pt/breakout-rooms.js":[808300,674381],"./pt-pt/broadcast.js":[892508,962351],"./pt-pt/calendar.js":[412986,174249],"./pt-pt/calling.js":[846015,552534],"./pt-pt/campaign-notifications.js":[901757,597828],"./pt-pt/carousel-multi-card.js":[null],"./pt-pt/cast.js":[747009,597828],"./pt-pt/channels.js":[799753,597828],"./pt-pt/chat-list.js":[496413,597828],"./pt-pt/coach-report.js":[503262,398635],"./pt-pt/comment-stream.js":[436143,463131],"./pt-pt/communities.js":[382679,597828],"./pt-pt/compose.js":[999750,597828],"./pt-pt/contacts.js":[723809,597828],"./pt-pt/datepicker.js":[226297,646804],"./pt-pt/desktop.js":[null],"./pt-pt/digital-signage.js":[null],"./pt-pt/discover-surface.js":[103526,259999],"./pt-pt/edu.js":[674461,742163],"./pt-pt/embed.js":[987233,597828],"./pt-pt/errors.js":[754746,597828],"./pt-pt/esp.js":[661125,351106],"./pt-pt/extensibility-ptz-extension.js":[null],"./pt-pt/extensibility-room-remote.js":[null],"./pt-pt/extensibility.js":[634363,597828],"./pt-pt/feedback.js":[537068,960840],"./pt-pt/files.js":[3530,597828],"./pt-pt/framework.js":[831538,597828],"./pt-pt/freemium-upgrade.js":[null],"./pt-pt/freemium.js":[855181,552534],"./pt-pt/funstuff.js":[646615,431660],"./pt-pt/gallery.js":[933024,392278],"./pt-pt/growth.js":[132591,597828],"./pt-pt/guardians.js":[713065,961074],"./pt-pt/health.js":[592483,833238],"./pt-pt/help.js":[null],"./pt-pt/hololens.js":[34533,552534],"./pt-pt/host-controls.js":[644712,298951],"./pt-pt/jana.js":[775765,223234],"./pt-pt/lightbox.js":[783176,597828],"./pt-pt/live-persona-card.js":[932134,597828],"./pt-pt/live-persona-editor.js":[261111,926334],"./pt-pt/lms-integration.js":[null],"./pt-pt/meet-for-work.js":[382931,737310],"./pt-pt/meeting-analytics.js":[555926,366894],"./pt-pt/meeting-apis-app.js":[null],"./pt-pt/meeting-bot.js":[null],"./pt-pt/meeting-collaboration.js":[979112,173250],"./pt-pt/meeting-flyout.js":[400487,597828],"./pt-pt/meeting-meet-app.js":[894597,597828],"./pt-pt/meeting-options.js":[884274,808521],"./pt-pt/meeting-recap.js":[933838,341253],"./pt-pt/meeting-room-console.js":[null],"./pt-pt/meeting-stream-app.js":[null],"./pt-pt/message-escalate-dialog.js":[859721,195584],"./pt-pt/messaging.js":[380504,597828],"./pt-pt/mobile-attach.js":[null],"./pt-pt/mtma-missed-notifications.js":[309216,597828],"./pt-pt/nova.js":[411346,597828],"./pt-pt/people-app.js":[null],"./pt-pt/people-picker.js":[706549,597828],"./pt-pt/people-targeting.js":[675764,169380],"./pt-pt/people.js":[239681,597828],"./pt-pt/person.js":[144301,597828],"./pt-pt/phonelink-sms.js":[486212,823799],"./pt-pt/pre-core.js":[null],"./pt-pt/premium-benefits.js":[973569,625850],"./pt-pt/presence.js":[454250,597828],"./pt-pt/queues.js":[601479,752579],"./pt-pt/recurrence.js":[347869,978433],"./pt-pt/rsc-application-permissions.js":[null],"./pt-pt/search.js":[330729,646804],"./pt-pt/semantic-object.js":[730949,261539],"./pt-pt/settings.js":[131151,597828],"./pt-pt/share-in-meetings.js":[null],"./pt-pt/share-to-teams-outlook-addin.js":[null],"./pt-pt/share-to-teams-third-party.js":[null],"./pt-pt/share-to-teams.js":[7677,940042],"./pt-pt/shortcut.js":[202187,597828],"./pt-pt/shortcuts.js":[398960,597828],"./pt-pt/simple-collab.js":[111187,597828],"./pt-pt/smart-device.js":[null],"./pt-pt/survey.js":[513346,239888],"./pt-pt/sv-flyout.js":[123041,597828],"./pt-pt/teams-and-channels.js":[686933,274217],"./pt-pt/teams-insider.js":[908173,597828],"./pt-pt/telemetry.js":[383312,597828],"./pt-pt/tfl-homepage.js":[912072,597828],"./pt-pt/tfl-onboarding.js":[798872,597828],"./pt-pt/toast-notifications.js":[537134,597828],"./pt-pt/trusted-ui.js":[null],"./pt-pt/unified-search.js":[668658,940042],"./pt-pt/unsupported-browser.js":[null],"./pt-pt/url-preview.js":[828316,597828],"./pt-pt/video-capture.js":[99582,180165],"./pt-pt/video-message.js":[480059,363627],"./pt-pt/virtual-consumer-events.js":[111731,662359],"./pt-pt/virtual-events.js":[103251,509902],"./pt-pt/webinar.js":[420379,765065],"./pt-pt/welcome-bot.js":[null],"./pt-pt/whats-new.js":[538578,597828],"./pt-pt/wiki.js":[null],"./ro-ro/activity.js":[750704,351554],"./ro-ro/artifacts-platform.js":[928382,895146],"./ro-ro/audience-view-dialog.js":[358715,698929],"./ro-ro/auth.js":[738746,351554],"./ro-ro/autosuggest.js":[301729,351554],"./ro-ro/avatar.js":[823678,351554],"./ro-ro/biometric-enrollment.js":[676284,113737],"./ro-ro/breakout-rooms.js":[684740,292631],"./ro-ro/broadcast.js":[265880,756679],"./ro-ro/calendar.js":[612622,483107],"./ro-ro/calling.js":[468587,983017],"./ro-ro/campaign-notifications.js":[43532,351554],"./ro-ro/carousel-multi-card.js":[null],"./ro-ro/cast.js":[263684,351554],"./ro-ro/channels.js":[228217,351554],"./ro-ro/chat-list.js":[731310,351554],"./ro-ro/coach-report.js":[175545,836980],"./ro-ro/comment-stream.js":[409444,640606],"./ro-ro/communities.js":[551914,351554],"./ro-ro/compose.js":[937636,351554],"./ro-ro/contacts.js":[533777,351554],"./ro-ro/datepicker.js":[521579,479010],"./ro-ro/desktop.js":[null],"./ro-ro/digital-signage.js":[null],"./ro-ro/discover-surface.js":[785635,81481],"./ro-ro/edu.js":[134068,437038],"./ro-ro/embed.js":[290499,351554],"./ro-ro/errors.js":[394293,351554],"./ro-ro/esp.js":[75637,956633],"./ro-ro/extensibility-ptz-extension.js":[null],"./ro-ro/extensibility-room-remote.js":[null],"./ro-ro/extensibility.js":[266561,351554],"./ro-ro/feedback.js":[246322,397869],"./ro-ro/files.js":[895747,351554],"./ro-ro/framework.js":[295766,351554],"./ro-ro/freemium-upgrade.js":[null],"./ro-ro/freemium.js":[811135,983017],"./ro-ro/funstuff.js":[75189,561860],"./ro-ro/gallery.js":[65073,965041],"./ro-ro/growth.js":[524477,351554],"./ro-ro/guardians.js":[210511,513968],"./ro-ro/health.js":[606446,395939],"./ro-ro/help.js":[null],"./ro-ro/hololens.js":[55806,983017],"./ro-ro/host-controls.js":[160424,177882],"./ro-ro/jana.js":[103668,136389],"./ro-ro/lightbox.js":[870197,351554],"./ro-ro/live-persona-card.js":[737564,351554],"./ro-ro/live-persona-editor.js":[331733,113569],"./ro-ro/lms-integration.js":[null],"./ro-ro/meet-for-work.js":[888130,143535],"./ro-ro/meeting-analytics.js":[548295,196137],"./ro-ro/meeting-apis-app.js":[null],"./ro-ro/meeting-bot.js":[null],"./ro-ro/meeting-collaboration.js":[34282,87607],"./ro-ro/meeting-flyout.js":[264371,351554],"./ro-ro/meeting-meet-app.js":[971064,351554],"./ro-ro/meeting-options.js":[959265,600132],"./ro-ro/meeting-recap.js":[849910,46436],"./ro-ro/meeting-room-console.js":[null],"./ro-ro/meeting-stream-app.js":[null],"./ro-ro/message-escalate-dialog.js":[987059,742842],"./ro-ro/messaging.js":[618390,351554],"./ro-ro/mobile-attach.js":[null],"./ro-ro/mtma-missed-notifications.js":[772385,351554],"./ro-ro/nova.js":[35397,351554],"./ro-ro/people-app.js":[null],"./ro-ro/people-picker.js":[312150,351554],"./ro-ro/people-targeting.js":[341708,878052],"./ro-ro/people.js":[263688,351554],"./ro-ro/person.js":[446886,351554],"./ro-ro/phonelink-sms.js":[172115,712539],"./ro-ro/pre-core.js":[null],"./ro-ro/premium-benefits.js":[407849,159342],"./ro-ro/presence.js":[18430,351554],"./ro-ro/queues.js":[718680,964536],"./ro-ro/recurrence.js":[739585,417418],"./ro-ro/rsc-application-permissions.js":[null],"./ro-ro/search.js":[478226,479010],"./ro-ro/semantic-object.js":[125769,773696],"./ro-ro/settings.js":[824188,351554],"./ro-ro/share-in-meetings.js":[null],"./ro-ro/share-to-teams-outlook-addin.js":[null],"./ro-ro/share-to-teams-third-party.js":[null],"./ro-ro/share-to-teams.js":[869947,161183],"./ro-ro/shortcut.js":[467164,351554],"./ro-ro/shortcuts.js":[462374,351554],"./ro-ro/simple-collab.js":[343583,351554],"./ro-ro/smart-device.js":[null],"./ro-ro/survey.js":[895972,100598],"./ro-ro/sv-flyout.js":[80843,351554],"./ro-ro/teams-and-channels.js":[930783,426447],"./ro-ro/teams-insider.js":[929755,351554],"./ro-ro/telemetry.js":[779960,351554],"./ro-ro/tfl-homepage.js":[882445,351554],"./ro-ro/tfl-onboarding.js":[131082,351554],"./ro-ro/toast-notifications.js":[6911,351554],"./ro-ro/trusted-ui.js":[null],"./ro-ro/unified-search.js":[207718,161183],"./ro-ro/unsupported-browser.js":[null],"./ro-ro/url-preview.js":[10134,351554],"./ro-ro/video-capture.js":[449780,189910],"./ro-ro/video-message.js":[36541,409162],"./ro-ro/virtual-consumer-events.js":[748059,501096],"./ro-ro/virtual-events.js":[456713,862108],"./ro-ro/webinar.js":[390210,905049],"./ro-ro/welcome-bot.js":[null],"./ro-ro/whats-new.js":[659960,351554],"./ro-ro/wiki.js":[null],"./ru-ru/activity.js":[715498,914743],"./ru-ru/artifacts-platform.js":[372835,408632],"./ru-ru/audience-view-dialog.js":[701795,137106],"./ru-ru/auth.js":[122721,914743],"./ru-ru/autosuggest.js":[554041,914743],"./ru-ru/avatar.js":[405055,914743],"./ru-ru/biometric-enrollment.js":[228323,503940],"./ru-ru/breakout-rooms.js":[110455,351780],"./ru-ru/broadcast.js":[617766,978981],"./ru-ru/calendar.js":[683780,950636],"./ru-ru/calling.js":[933397,637754],"./ru-ru/campaign-notifications.js":[348271,914743],"./ru-ru/carousel-multi-card.js":[null],"./ru-ru/cast.js":[457770,914743],"./ru-ru/channels.js":[537241,914743],"./ru-ru/chat-list.js":[219352,914743],"./ru-ru/coach-report.js":[269508,201429],"./ru-ru/comment-stream.js":[42464,302158],"./ru-ru/communities.js":[23197,914743],"./ru-ru/compose.js":[205132,914743],"./ru-ru/contacts.js":[194426,914743],"./ru-ru/datepicker.js":[372548,54180],"./ru-ru/desktop.js":[null],"./ru-ru/digital-signage.js":[null],"./ru-ru/discover-surface.js":[841769,356092],"./ru-ru/edu.js":[100948,880089],"./ru-ru/embed.js":[933868,914743],"./ru-ru/errors.js":[73771,914743],"./ru-ru/esp.js":[773652,71021],"./ru-ru/extensibility-ptz-extension.js":[null],"./ru-ru/extensibility-room-remote.js":[null],"./ru-ru/extensibility.js":[217243,914743],"./ru-ru/feedback.js":[831545,507134],"./ru-ru/files.js":[1804,914743],"./ru-ru/framework.js":[11500,914743],"./ru-ru/freemium-upgrade.js":[null],"./ru-ru/freemium.js":[769262,637754],"./ru-ru/funstuff.js":[736101,52235],"./ru-ru/gallery.js":[101785,823954],"./ru-ru/growth.js":[40964,914743],"./ru-ru/guardians.js":[653887,128254],"./ru-ru/health.js":[60014,999114],"./ru-ru/help.js":[null],"./ru-ru/hololens.js":[859784,637754],"./ru-ru/host-controls.js":[819933,647909],"./ru-ru/jana.js":[96648,563048],"./ru-ru/lightbox.js":[9608,914743],"./ru-ru/live-persona-card.js":[941872,914743],"./ru-ru/live-persona-editor.js":[175891,447217],"./ru-ru/lms-integration.js":[null],"./ru-ru/meet-for-work.js":[610899,165446],"./ru-ru/meeting-analytics.js":[715725,545730],"./ru-ru/meeting-apis-app.js":[null],"./ru-ru/meeting-bot.js":[null],"./ru-ru/meeting-collaboration.js":[556468,76961],"./ru-ru/meeting-flyout.js":[14663,914743],"./ru-ru/meeting-meet-app.js":[513115,914743],"./ru-ru/meeting-options.js":[406126,956641],"./ru-ru/meeting-recap.js":[536066,997071],"./ru-ru/meeting-room-console.js":[null],"./ru-ru/meeting-stream-app.js":[null],"./ru-ru/message-escalate-dialog.js":[290331,388262],"./ru-ru/messaging.js":[100987,914743],"./ru-ru/mobile-attach.js":[null],"./ru-ru/mtma-missed-notifications.js":[683255,914743],"./ru-ru/nova.js":[675443,914743],"./ru-ru/people-app.js":[null],"./ru-ru/people-picker.js":[966786,914743],"./ru-ru/people-targeting.js":[995855,265758],"./ru-ru/people.js":[305130,914743],"./ru-ru/person.js":[821765,914743],"./ru-ru/phonelink-sms.js":[489954,550360],"./ru-ru/pre-core.js":[null],"./ru-ru/premium-benefits.js":[9793,278090],"./ru-ru/presence.js":[326249,914743],"./ru-ru/queues.js":[68981,592475],"./ru-ru/recurrence.js":[842750,806389],"./ru-ru/rsc-application-permissions.js":[null],"./ru-ru/search.js":[268345,54180],"./ru-ru/semantic-object.js":[212536,254122],"./ru-ru/settings.js":[794753,914743],"./ru-ru/share-in-meetings.js":[null],"./ru-ru/share-to-teams-outlook-addin.js":[null],"./ru-ru/share-to-teams-third-party.js":[null],"./ru-ru/share-to-teams.js":[790822,496334],"./ru-ru/shortcut.js":[520327,914743],"./ru-ru/shortcuts.js":[148319,914743],"./ru-ru/simple-collab.js":[592210,914743],"./ru-ru/smart-device.js":[null],"./ru-ru/survey.js":[335117,755340],"./ru-ru/sv-flyout.js":[883504,914743],"./ru-ru/teams-and-channels.js":[452713,261090],"./ru-ru/teams-insider.js":[518951,914743],"./ru-ru/telemetry.js":[971796,914743],"./ru-ru/tfl-homepage.js":[46478,914743],"./ru-ru/tfl-onboarding.js":[503268,914743],"./ru-ru/toast-notifications.js":[771366,914743],"./ru-ru/trusted-ui.js":[null],"./ru-ru/unified-search.js":[920647,496334],"./ru-ru/unsupported-browser.js":[null],"./ru-ru/url-preview.js":[146631,914743],"./ru-ru/video-capture.js":[318322,284862],"./ru-ru/video-message.js":[826779,800274],"./ru-ru/virtual-consumer-events.js":[51714,829325],"./ru-ru/virtual-events.js":[780895,36644],"./ru-ru/webinar.js":[477637,996802],"./ru-ru/welcome-bot.js":[null],"./ru-ru/whats-new.js":[387086,914743],"./ru-ru/wiki.js":[null],"./sk-sk/activity.js":[844208,127199],"./sk-sk/artifacts-platform.js":[238274,758673],"./sk-sk/audience-view-dialog.js":[223159,284063],"./sk-sk/auth.js":[266059,127199],"./sk-sk/autosuggest.js":[237091,127199],"./sk-sk/avatar.js":[388928,127199],"./sk-sk/biometric-enrollment.js":[240670,857441],"./sk-sk/breakout-rooms.js":[195187,302797],"./sk-sk/broadcast.js":[689891,980839],"./sk-sk/calendar.js":[184297,762781],"./sk-sk/calling.js":[498735,812090],"./sk-sk/campaign-notifications.js":[449083,127199],"./sk-sk/carousel-multi-card.js":[null],"./sk-sk/cast.js":[148919,127199],"./sk-sk/channels.js":[429604,127199],"./sk-sk/chat-list.js":[823741,127199],"./sk-sk/coach-report.js":[977121,582439],"./sk-sk/comment-stream.js":[249576,674669],"./sk-sk/communities.js":[540640,127199],"./sk-sk/compose.js":[118387,127199],"./sk-sk/contacts.js":[714898,127199],"./sk-sk/datepicker.js":[126616,202883],"./sk-sk/desktop.js":[null],"./sk-sk/digital-signage.js":[null],"./sk-sk/discover-surface.js":[582241,258357],"./sk-sk/edu.js":[771430,956665],"./sk-sk/embed.js":[809622,127199],"./sk-sk/errors.js":[907092,127199],"./sk-sk/esp.js":[352007,838461],"./sk-sk/extensibility-ptz-extension.js":[null],"./sk-sk/extensibility-room-remote.js":[null],"./sk-sk/extensibility.js":[535243,127199],"./sk-sk/feedback.js":[523456,917441],"./sk-sk/files.js":[941573,127199],"./sk-sk/framework.js":[887181,127199],"./sk-sk/freemium-upgrade.js":[null],"./sk-sk/freemium.js":[339101,812090],"./sk-sk/funstuff.js":[772466,805111],"./sk-sk/gallery.js":[997577,641491],"./sk-sk/growth.js":[985443,127199],"./sk-sk/guardians.js":[980127,371515],"./sk-sk/health.js":[161785,560667],"./sk-sk/help.js":[null],"./sk-sk/hololens.js":[632475,812090],"./sk-sk/host-controls.js":[130354,724904],"./sk-sk/jana.js":[440412,113351],"./sk-sk/lightbox.js":[162779,127199],"./sk-sk/live-persona-card.js":[254117,127199],"./sk-sk/live-persona-editor.js":[332451,51449],"./sk-sk/lms-integration.js":[null],"./sk-sk/meet-for-work.js":[984151,40840],"./sk-sk/meeting-analytics.js":[860698,198167],"./sk-sk/meeting-apis-app.js":[null],"./sk-sk/meeting-bot.js":[null],"./sk-sk/meeting-collaboration.js":[81976,984324],"./sk-sk/meeting-flyout.js":[171654,127199],"./sk-sk/meeting-meet-app.js":[600662,127199],"./sk-sk/meeting-options.js":[370356,744470],"./sk-sk/meeting-recap.js":[636799,72011],"./sk-sk/meeting-room-console.js":[null],"./sk-sk/meeting-stream-app.js":[null],"./sk-sk/message-escalate-dialog.js":[259998,24516],"./sk-sk/messaging.js":[856016,127199],"./sk-sk/mobile-attach.js":[null],"./sk-sk/mtma-missed-notifications.js":[599079,127199],"./sk-sk/nova.js":[465174,127199],"./sk-sk/people-app.js":[null],"./sk-sk/people-picker.js":[71385,127199],"./sk-sk/people-targeting.js":[13684,838806],"./sk-sk/people.js":[810271,127199],"./sk-sk/person.js":[176794,127199],"./sk-sk/phonelink-sms.js":[238926,311420],"./sk-sk/pre-core.js":[null],"./sk-sk/premium-benefits.js":[440425,440267],"./sk-sk/presence.js":[417879,127199],"./sk-sk/queues.js":[935035,281234],"./sk-sk/recurrence.js":[183644,240238],"./sk-sk/rsc-application-permissions.js":[null],"./sk-sk/search.js":[416134,202883],"./sk-sk/semantic-object.js":[166645,165240],"./sk-sk/settings.js":[18207,127199],"./sk-sk/share-in-meetings.js":[null],"./sk-sk/share-to-teams-outlook-addin.js":[null],"./sk-sk/share-to-teams-third-party.js":[null],"./sk-sk/share-to-teams.js":[864323,73826],"./sk-sk/shortcut.js":[653453,127199],"./sk-sk/shortcuts.js":[42926,127199],"./sk-sk/simple-collab.js":[901861,127199],"./sk-sk/smart-device.js":[null],"./sk-sk/survey.js":[361437,438685],"./sk-sk/sv-flyout.js":[982585,127199],"./sk-sk/teams-and-channels.js":[607780,216478],"./sk-sk/teams-insider.js":[890813,127199],"./sk-sk/telemetry.js":[940105,127199],"./sk-sk/tfl-homepage.js":[467899,127199],"./sk-sk/tfl-onboarding.js":[552982,127199],"./sk-sk/toast-notifications.js":[941831,127199],"./sk-sk/trusted-ui.js":[null],"./sk-sk/unified-search.js":[724273,73826],"./sk-sk/unsupported-browser.js":[null],"./sk-sk/url-preview.js":[174514,127199],"./sk-sk/video-capture.js":[26776,147872],"./sk-sk/video-message.js":[901103,742302],"./sk-sk/virtual-consumer-events.js":[180477,980031],"./sk-sk/virtual-events.js":[303476,335479],"./sk-sk/webinar.js":[20889,38021],"./sk-sk/welcome-bot.js":[null],"./sk-sk/whats-new.js":[685589,127199],"./sk-sk/wiki.js":[null],"./sl-si/activity.js":[639390,959151],"./sl-si/artifacts-platform.js":[972402,86416],"./sl-si/audience-view-dialog.js":[479881,200245],"./sl-si/auth.js":[438232,959151],"./sl-si/autosuggest.js":[552821,959151],"./sl-si/avatar.js":[146457,959151],"./sl-si/biometric-enrollment.js":[690237,707015],"./sl-si/breakout-rooms.js":[501549,472385],"./sl-si/broadcast.js":[86739,736856],"./sl-si/calendar.js":[605202,355625],"./sl-si/calling.js":[830794,435588],"./sl-si/campaign-notifications.js":[572668,959151],"./sl-si/carousel-multi-card.js":[null],"./sl-si/cast.js":[626547,959151],"./sl-si/channels.js":[865780,959151],"./sl-si/chat-list.js":[643083,959151],"./sl-si/coach-report.js":[910916,587574],"./sl-si/comment-stream.js":[695869,455159],"./sl-si/communities.js":[26398,959151],"./sl-si/compose.js":[75805,959151],"./sl-si/contacts.js":[543606,959151],"./sl-si/datepicker.js":[314853,725509],"./sl-si/desktop.js":[null],"./sl-si/digital-signage.js":[null],"./sl-si/discover-surface.js":[912781,586754],"./sl-si/edu.js":[736319,834266],"./sl-si/embed.js":[481126,959151],"./sl-si/errors.js":[707293,959151],"./sl-si/esp.js":[327044,143589],"./sl-si/extensibility-ptz-extension.js":[null],"./sl-si/extensibility-room-remote.js":[null],"./sl-si/extensibility.js":[721004,959151],"./sl-si/feedback.js":[798045,881207],"./sl-si/files.js":[413794,959151],"./sl-si/framework.js":[419960,959151],"./sl-si/freemium-upgrade.js":[null],"./sl-si/freemium.js":[519198,435588],"./sl-si/funstuff.js":[263616,415304],"./sl-si/gallery.js":[256615,89905],"./sl-si/growth.js":[179319,959151],"./sl-si/guardians.js":[833798,731167],"./sl-si/health.js":[375659,520945],"./sl-si/help.js":[null],"./sl-si/hololens.js":[936776,435588],"./sl-si/host-controls.js":[441278,92699],"./sl-si/jana.js":[465197,547900],"./sl-si/lightbox.js":[657826,959151],"./sl-si/live-persona-card.js":[481028,959151],"./sl-si/live-persona-editor.js":[450428,757180],"./sl-si/lms-integration.js":[null],"./sl-si/meet-for-work.js":[975378,305992],"./sl-si/meeting-analytics.js":[898889,206194],"./sl-si/meeting-apis-app.js":[null],"./sl-si/meeting-bot.js":[null],"./sl-si/meeting-collaboration.js":[444508,573801],"./sl-si/meeting-flyout.js":[648439,959151],"./sl-si/meeting-meet-app.js":[15578,959151],"./sl-si/meeting-options.js":[771467,559401],"./sl-si/meeting-recap.js":[769314,123552],"./sl-si/meeting-room-console.js":[null],"./sl-si/meeting-stream-app.js":[null],"./sl-si/message-escalate-dialog.js":[195581,871288],"./sl-si/messaging.js":[20294,959151],"./sl-si/mobile-attach.js":[null],"./sl-si/mtma-missed-notifications.js":[121764,959151],"./sl-si/nova.js":[830605,959151],"./sl-si/people-app.js":[null],"./sl-si/people-picker.js":[408059,959151],"./sl-si/people-targeting.js":[628879,458392],"./sl-si/people.js":[649637,959151],"./sl-si/person.js":[788156,959151],"./sl-si/phonelink-sms.js":[413879,960612],"./sl-si/pre-core.js":[null],"./sl-si/premium-benefits.js":[207396,296878],"./sl-si/presence.js":[263584,959151],"./sl-si/queues.js":[951963,115166],"./sl-si/recurrence.js":[659552,539974],"./sl-si/rsc-application-permissions.js":[null],"./sl-si/search.js":[789091,725509],"./sl-si/semantic-object.js":[956373,678130],"./sl-si/settings.js":[875500,959151],"./sl-si/share-in-meetings.js":[null],"./sl-si/share-to-teams-outlook-addin.js":[null],"./sl-si/share-to-teams-third-party.js":[null],"./sl-si/share-to-teams.js":[568974,614268],"./sl-si/shortcut.js":[608140,959151],"./sl-si/shortcuts.js":[437178,959151],"./sl-si/simple-collab.js":[924552,959151],"./sl-si/smart-device.js":[null],"./sl-si/survey.js":[671737,905188],"./sl-si/sv-flyout.js":[967791,959151],"./sl-si/teams-and-channels.js":[330058,613392],"./sl-si/teams-insider.js":[901842,959151],"./sl-si/telemetry.js":[688856,959151],"./sl-si/tfl-homepage.js":[351520,959151],"./sl-si/tfl-onboarding.js":[74574,959151],"./sl-si/toast-notifications.js":[891485,959151],"./sl-si/trusted-ui.js":[null],"./sl-si/unified-search.js":[724527,614268],"./sl-si/unsupported-browser.js":[null],"./sl-si/url-preview.js":[521807,959151],"./sl-si/video-capture.js":[100617,108418],"./sl-si/video-message.js":[43131,10567],"./sl-si/virtual-consumer-events.js":[530469,79553],"./sl-si/virtual-events.js":[393721,514302],"./sl-si/webinar.js":[104843,688725],"./sl-si/welcome-bot.js":[null],"./sl-si/whats-new.js":[586932,959151],"./sl-si/wiki.js":[null],"./sq-al/activity.js":[218050,961331],"./sq-al/artifacts-platform.js":[64652,640756],"./sq-al/audience-view-dialog.js":[533182,91759],"./sq-al/auth.js":[251715,961331],"./sq-al/autosuggest.js":[496449,961331],"./sq-al/avatar.js":[849476,961331],"./sq-al/biometric-enrollment.js":[401762,799030],"./sq-al/breakout-rooms.js":[683985,130297],"./sq-al/broadcast.js":[598979,250215],"./sq-al/calendar.js":[408264,961543],"./sq-al/calling.js":[118658,703405],"./sq-al/campaign-notifications.js":[622966,961331],"./sq-al/carousel-multi-card.js":[null],"./sq-al/cast.js":[279616,961331],"./sq-al/channels.js":[889190,961331],"./sq-al/chat-list.js":[456280,961331],"./sq-al/coach-report.js":[608883,337784],"./sq-al/comment-stream.js":[928338,614523],"./sq-al/communities.js":[308724,961331],"./sq-al/compose.js":[342515,961331],"./sq-al/contacts.js":[253875,961331],"./sq-al/datepicker.js":[705296,327172],"./sq-al/desktop.js":[null],"./sq-al/digital-signage.js":[null],"./sq-al/discover-surface.js":[565812,393597],"./sq-al/edu.js":[723498,882709],"./sq-al/embed.js":[442128,961331],"./sq-al/errors.js":[896153,961331],"./sq-al/esp.js":[155304,1129],"./sq-al/extensibility-ptz-extension.js":[null],"./sq-al/extensibility-room-remote.js":[null],"./sq-al/extensibility.js":[313457,961331],"./sq-al/feedback.js":[468720,316837],"./sq-al/files.js":[466125,961331],"./sq-al/framework.js":[616396,961331],"./sq-al/freemium-upgrade.js":[null],"./sq-al/freemium.js":[512727,703405],"./sq-al/funstuff.js":[99063,969214],"./sq-al/gallery.js":[120439,620948],"./sq-al/growth.js":[706090,961331],"./sq-al/guardians.js":[599568,645885],"./sq-al/health.js":[643554,278792],"./sq-al/help.js":[null],"./sq-al/hololens.js":[976293,703405],"./sq-al/host-controls.js":[67625,33951],"./sq-al/jana.js":[948428,877918],"./sq-al/lightbox.js":[390301,961331],"./sq-al/live-persona-card.js":[599445,961331],"./sq-al/live-persona-editor.js":[67961,291874],"./sq-al/lms-integration.js":[null],"./sq-al/meet-for-work.js":[317890,419163],"./sq-al/meeting-analytics.js":[274438,983906],"./sq-al/meeting-apis-app.js":[null],"./sq-al/meeting-bot.js":[null],"./sq-al/meeting-collaboration.js":[159466,630384],"./sq-al/meeting-flyout.js":[850998,961331],"./sq-al/meeting-meet-app.js":[828231,961331],"./sq-al/meeting-options.js":[965149,978537],"./sq-al/meeting-recap.js":[754916,615066],"./sq-al/meeting-room-console.js":[null],"./sq-al/meeting-stream-app.js":[null],"./sq-al/message-escalate-dialog.js":[100205,204484],"./sq-al/messaging.js":[486002,961331],"./sq-al/mobile-attach.js":[null],"./sq-al/mtma-missed-notifications.js":[556078,961331],"./sq-al/nova.js":[309675,961331],"./sq-al/people-app.js":[null],"./sq-al/people-picker.js":[102044,961331],"./sq-al/people-targeting.js":[545943,349663],"./sq-al/people.js":[492338,961331],"./sq-al/person.js":[612353,961331],"./sq-al/phonelink-sms.js":[302424,343106],"./sq-al/pre-core.js":[null],"./sq-al/premium-benefits.js":[782605,669868],"./sq-al/presence.js":[873418,961331],"./sq-al/queues.js":[18060,53222],"./sq-al/recurrence.js":[356012,652708],"./sq-al/rsc-application-permissions.js":[null],"./sq-al/search.js":[464060,327172],"./sq-al/semantic-object.js":[585307,547140],"./sq-al/settings.js":[241518,961331],"./sq-al/share-in-meetings.js":[null],"./sq-al/share-to-teams-outlook-addin.js":[null],"./sq-al/share-to-teams-third-party.js":[null],"./sq-al/share-to-teams.js":[845858,212776],"./sq-al/shortcut.js":[182276,961331],"./sq-al/shortcuts.js":[147271,961331],"./sq-al/simple-collab.js":[776312,961331],"./sq-al/smart-device.js":[null],"./sq-al/survey.js":[387196,860005],"./sq-al/sv-flyout.js":[594012,961331],"./sq-al/teams-and-channels.js":[389095,403034],"./sq-al/teams-insider.js":[806643,961331],"./sq-al/telemetry.js":[481847,961331],"./sq-al/tfl-homepage.js":[548822,961331],"./sq-al/tfl-onboarding.js":[224763,961331],"./sq-al/toast-notifications.js":[276940,961331],"./sq-al/trusted-ui.js":[null],"./sq-al/unified-search.js":[556793,212776],"./sq-al/unsupported-browser.js":[null],"./sq-al/url-preview.js":[781233,961331],"./sq-al/video-capture.js":[520395,46926],"./sq-al/video-message.js":[697841,39840],"./sq-al/virtual-consumer-events.js":[635922,411020],"./sq-al/virtual-events.js":[107021,897327],"./sq-al/webinar.js":[140773,469120],"./sq-al/welcome-bot.js":[null],"./sq-al/whats-new.js":[720163,961331],"./sq-al/wiki.js":[null],"./sr-latn-rs/activity.js":[437497,645285],"./sr-latn-rs/artifacts-platform.js":[795396,303982],"./sr-latn-rs/audience-view-dialog.js":[400539,62713],"./sr-latn-rs/auth.js":[644457,645285],"./sr-latn-rs/autosuggest.js":[754128,645285],"./sr-latn-rs/avatar.js":[201424,645285],"./sr-latn-rs/biometric-enrollment.js":[117127,332426],"./sr-latn-rs/breakout-rooms.js":[11543,202748],"./sr-latn-rs/broadcast.js":[952543,977153],"./sr-latn-rs/calendar.js":[788352,69006],"./sr-latn-rs/calling.js":[146906,92525],"./sr-latn-rs/campaign-notifications.js":[881436,645285],"./sr-latn-rs/carousel-multi-card.js":[null],"./sr-latn-rs/cast.js":[671298,645285],"./sr-latn-rs/channels.js":[924575,645285],"./sr-latn-rs/chat-list.js":[149520,645285],"./sr-latn-rs/coach-report.js":[580144,44292],"./sr-latn-rs/comment-stream.js":[184538,3258],"./sr-latn-rs/communities.js":[418761,645285],"./sr-latn-rs/compose.js":[4031,645285],"./sr-latn-rs/contacts.js":[144896,645285],"./sr-latn-rs/datepicker.js":[511378,775447],"./sr-latn-rs/desktop.js":[null],"./sr-latn-rs/digital-signage.js":[null],"./sr-latn-rs/discover-surface.js":[728683,951582],"./sr-latn-rs/edu.js":[221638,148183],"./sr-latn-rs/embed.js":[473288,645285],"./sr-latn-rs/errors.js":[455591,645285],"./sr-latn-rs/esp.js":[287289,44565],"./sr-latn-rs/extensibility-ptz-extension.js":[null],"./sr-latn-rs/extensibility-room-remote.js":[null],"./sr-latn-rs/extensibility.js":[411333,645285],"./sr-latn-rs/feedback.js":[761251,809293],"./sr-latn-rs/files.js":[699049,645285],"./sr-latn-rs/framework.js":[572242,645285],"./sr-latn-rs/freemium-upgrade.js":[null],"./sr-latn-rs/freemium.js":[657260,92525],"./sr-latn-rs/funstuff.js":[711784,352881],"./sr-latn-rs/gallery.js":[913797,295787],"./sr-latn-rs/growth.js":[251723,645285],"./sr-latn-rs/guardians.js":[935629,774604],"./sr-latn-rs/health.js":[43670,211779],"./sr-latn-rs/help.js":[null],"./sr-latn-rs/hololens.js":[979632,92525],"./sr-latn-rs/host-controls.js":[752738,316783],"./sr-latn-rs/jana.js":[529453,906872],"./sr-latn-rs/lightbox.js":[351808,645285],"./sr-latn-rs/live-persona-card.js":[374260,645285],"./sr-latn-rs/live-persona-editor.js":[915976,644127],"./sr-latn-rs/lms-integration.js":[null],"./sr-latn-rs/meet-for-work.js":[393839,219735],"./sr-latn-rs/meeting-analytics.js":[424236,252354],"./sr-latn-rs/meeting-apis-app.js":[null],"./sr-latn-rs/meeting-bot.js":[null],"./sr-latn-rs/meeting-collaboration.js":[622806,54436],"./sr-latn-rs/meeting-flyout.js":[584422,645285],"./sr-latn-rs/meeting-meet-app.js":[536870,645285],"./sr-latn-rs/meeting-options.js":[996501,619599],"./sr-latn-rs/meeting-recap.js":[446224,89997],"./sr-latn-rs/meeting-room-console.js":[null],"./sr-latn-rs/meeting-stream-app.js":[null],"./sr-latn-rs/message-escalate-dialog.js":[809274,862198],"./sr-latn-rs/messaging.js":[422600,645285],"./sr-latn-rs/mobile-attach.js":[null],"./sr-latn-rs/mtma-missed-notifications.js":[884608,645285],"./sr-latn-rs/nova.js":[186975,645285],"./sr-latn-rs/people-app.js":[null],"./sr-latn-rs/people-picker.js":[613438,645285],"./sr-latn-rs/people-targeting.js":[371646,477747],"./sr-latn-rs/people.js":[40480,645285],"./sr-latn-rs/person.js":[416291,645285],"./sr-latn-rs/phonelink-sms.js":[370897,679045],"./sr-latn-rs/pre-core.js":[null],"./sr-latn-rs/premium-benefits.js":[536681,16448],"./sr-latn-rs/presence.js":[132428,645285],"./sr-latn-rs/queues.js":[262921,797069],"./sr-latn-rs/recurrence.js":[557309,324013],"./sr-latn-rs/rsc-application-permissions.js":[null],"./sr-latn-rs/search.js":[72226,775447],"./sr-latn-rs/semantic-object.js":[944166,94444],"./sr-latn-rs/settings.js":[360984,645285],"./sr-latn-rs/share-in-meetings.js":[null],"./sr-latn-rs/share-to-teams-outlook-addin.js":[null],"./sr-latn-rs/share-to-teams-third-party.js":[null],"./sr-latn-rs/share-to-teams.js":[47943,18846],"./sr-latn-rs/shortcut.js":[714376,645285],"./sr-latn-rs/shortcuts.js":[840466,645285],"./sr-latn-rs/simple-collab.js":[762385,645285],"./sr-latn-rs/smart-device.js":[null],"./sr-latn-rs/survey.js":[194514,975504],"./sr-latn-rs/sv-flyout.js":[47212,645285],"./sr-latn-rs/teams-and-channels.js":[986777,996696],"./sr-latn-rs/teams-insider.js":[776710,645285],"./sr-latn-rs/telemetry.js":[144057,645285],"./sr-latn-rs/tfl-homepage.js":[696796,645285],"./sr-latn-rs/tfl-onboarding.js":[458243,645285],"./sr-latn-rs/toast-notifications.js":[787597,645285],"./sr-latn-rs/trusted-ui.js":[null],"./sr-latn-rs/unified-search.js":[529999,18846],"./sr-latn-rs/unsupported-browser.js":[null],"./sr-latn-rs/url-preview.js":[133875,645285],"./sr-latn-rs/video-capture.js":[122080,661639],"./sr-latn-rs/video-message.js":[600323,530420],"./sr-latn-rs/virtual-consumer-events.js":[270811,107799],"./sr-latn-rs/virtual-events.js":[206528,618997],"./sr-latn-rs/webinar.js":[445407,501612],"./sr-latn-rs/welcome-bot.js":[null],"./sr-latn-rs/whats-new.js":[927927,645285],"./sr-latn-rs/wiki.js":[null],"./sv-se/activity.js":[677710,988681],"./sv-se/artifacts-platform.js":[366996,90109],"./sv-se/audience-view-dialog.js":[377497,297895],"./sv-se/auth.js":[841941,988681],"./sv-se/autosuggest.js":[249954,988681],"./sv-se/avatar.js":[814878,988681],"./sv-se/biometric-enrollment.js":[875637,956010],"./sv-se/breakout-rooms.js":[573026,668452],"./sv-se/broadcast.js":[11405,661922],"./sv-se/calendar.js":[2633,800509],"./sv-se/calling.js":[505313,731374],"./sv-se/campaign-notifications.js":[203197,988681],"./sv-se/carousel-multi-card.js":[null],"./sv-se/cast.js":[337010,988681],"./sv-se/channels.js":[626452,988681],"./sv-se/chat-list.js":[183940,988681],"./sv-se/coach-report.js":[907997,342920],"./sv-se/comment-stream.js":[656379,336592],"./sv-se/communities.js":[461058,988681],"./sv-se/compose.js":[5208,988681],"./sv-se/contacts.js":[403981,988681],"./sv-se/datepicker.js":[921850,146981],"./sv-se/desktop.js":[null],"./sv-se/digital-signage.js":[null],"./sv-se/discover-surface.js":[713095,152177],"./sv-se/edu.js":[950259,575244],"./sv-se/embed.js":[348617,988681],"./sv-se/errors.js":[303117,988681],"./sv-se/esp.js":[331998,154068],"./sv-se/extensibility-ptz-extension.js":[null],"./sv-se/extensibility-room-remote.js":[null],"./sv-se/extensibility.js":[714268,988681],"./sv-se/feedback.js":[712029,968075],"./sv-se/files.js":[866139,988681],"./sv-se/framework.js":[120102,988681],"./sv-se/freemium-upgrade.js":[null],"./sv-se/freemium.js":[32174,731374],"./sv-se/funstuff.js":[256247,124246],"./sv-se/gallery.js":[939060,655550],"./sv-se/growth.js":[491114,988681],"./sv-se/guardians.js":[69834,470175],"./sv-se/health.js":[590214,749],"./sv-se/help.js":[null],"./sv-se/hololens.js":[181258,731374],"./sv-se/host-controls.js":[468432,771557],"./sv-se/jana.js":[703661,344448],"./sv-se/lightbox.js":[836210,988681],"./sv-se/live-persona-card.js":[606610,988681],"./sv-se/live-persona-editor.js":[507748,762473],"./sv-se/lms-integration.js":[null],"./sv-se/meet-for-work.js":[780844,751921],"./sv-se/meeting-analytics.js":[634955,137472],"./sv-se/meeting-apis-app.js":[null],"./sv-se/meeting-bot.js":[null],"./sv-se/meeting-collaboration.js":[919772,493235],"./sv-se/meeting-flyout.js":[619604,988681],"./sv-se/meeting-meet-app.js":[715044,988681],"./sv-se/meeting-options.js":[352,666073],"./sv-se/meeting-recap.js":[728871,301281],"./sv-se/meeting-room-console.js":[null],"./sv-se/meeting-stream-app.js":[null],"./sv-se/message-escalate-dialog.js":[223203,549087],"./sv-se/messaging.js":[889162,988681],"./sv-se/mobile-attach.js":[null],"./sv-se/mtma-missed-notifications.js":[124078,988681],"./sv-se/nova.js":[80434,988681],"./sv-se/people-app.js":[null],"./sv-se/people-picker.js":[724198,988681],"./sv-se/people-targeting.js":[938185,445270],"./sv-se/people.js":[10696,988681],"./sv-se/person.js":[937123,988681],"./sv-se/phonelink-sms.js":[123775,193209],"./sv-se/pre-core.js":[null],"./sv-se/premium-benefits.js":[824175,852038],"./sv-se/presence.js":[615864,988681],"./sv-se/queues.js":[50114,779458],"./sv-se/recurrence.js":[828493,890565],"./sv-se/rsc-application-permissions.js":[null],"./sv-se/search.js":[83607,146981],"./sv-se/semantic-object.js":[473151,246462],"./sv-se/settings.js":[962806,988681],"./sv-se/share-in-meetings.js":[null],"./sv-se/share-to-teams-outlook-addin.js":[null],"./sv-se/share-to-teams-third-party.js":[null],"./sv-se/share-to-teams.js":[670219,840879],"./sv-se/shortcut.js":[143779,988681],"./sv-se/shortcuts.js":[479870,988681],"./sv-se/simple-collab.js":[675354,988681],"./sv-se/smart-device.js":[null],"./sv-se/survey.js":[465444,807205],"./sv-se/sv-flyout.js":[105210,988681],"./sv-se/teams-and-channels.js":[682173,283400],"./sv-se/teams-insider.js":[52624,988681],"./sv-se/telemetry.js":[808041,988681],"./sv-se/tfl-homepage.js":[557369,988681],"./sv-se/tfl-onboarding.js":[402517,988681],"./sv-se/toast-notifications.js":[954843,988681],"./sv-se/trusted-ui.js":[null],"./sv-se/unified-search.js":[424957,840879],"./sv-se/unsupported-browser.js":[null],"./sv-se/url-preview.js":[771259,988681],"./sv-se/video-capture.js":[841305,473432],"./sv-se/video-message.js":[597550,609679],"./sv-se/virtual-consumer-events.js":[583255,858608],"./sv-se/virtual-events.js":[733636,431304],"./sv-se/webinar.js":[386673,596836],"./sv-se/welcome-bot.js":[null],"./sv-se/whats-new.js":[505342,988681],"./sv-se/wiki.js":[null],"./th-th/activity.js":[652026,876240],"./th-th/artifacts-platform.js":[548027,784434],"./th-th/audience-view-dialog.js":[34178,267989],"./th-th/auth.js":[618711,876240],"./th-th/autosuggest.js":[172200,876240],"./th-th/avatar.js":[236175,876240],"./th-th/biometric-enrollment.js":[189018,66736],"./th-th/breakout-rooms.js":[944235,134403],"./th-th/broadcast.js":[706426,123493],"./th-th/calendar.js":[802119,648451],"./th-th/calling.js":[578920,331963],"./th-th/campaign-notifications.js":[28586,876240],"./th-th/carousel-multi-card.js":[null],"./th-th/cast.js":[510733,876240],"./th-th/channels.js":[645252,876240],"./th-th/chat-list.js":[566880,876240],"./th-th/coach-report.js":[887152,287036],"./th-th/comment-stream.js":[797926,204739],"./th-th/communities.js":[29388,876240],"./th-th/compose.js":[883654,876240],"./th-th/contacts.js":[224156,876240],"./th-th/datepicker.js":[956180,985550],"./th-th/desktop.js":[null],"./th-th/digital-signage.js":[null],"./th-th/discover-surface.js":[566306,422410],"./th-th/edu.js":[488113,688387],"./th-th/embed.js":[929330,876240],"./th-th/errors.js":[804165,876240],"./th-th/esp.js":[748737,537965],"./th-th/extensibility-ptz-extension.js":[null],"./th-th/extensibility-room-remote.js":[null],"./th-th/extensibility.js":[149772,876240],"./th-th/feedback.js":[698462,951678],"./th-th/files.js":[4008,876240],"./th-th/framework.js":[523631,876240],"./th-th/freemium-upgrade.js":[null],"./th-th/freemium.js":[393537,331963],"./th-th/funstuff.js":[688322,20633],"./th-th/gallery.js":[103207,160713],"./th-th/growth.js":[647164,876240],"./th-th/guardians.js":[424362,285503],"./th-th/health.js":[131219,264992],"./th-th/help.js":[null],"./th-th/hololens.js":[274414,331963],"./th-th/host-controls.js":[955423,982404],"./th-th/jana.js":[408559,754105],"./th-th/lightbox.js":[767564,876240],"./th-th/live-persona-card.js":[649431,876240],"./th-th/live-persona-editor.js":[143106,781556],"./th-th/lms-integration.js":[null],"./th-th/meet-for-work.js":[350587,971592],"./th-th/meeting-analytics.js":[420284,342182],"./th-th/meeting-apis-app.js":[null],"./th-th/meeting-bot.js":[null],"./th-th/meeting-collaboration.js":[637124,709267],"./th-th/meeting-flyout.js":[32879,876240],"./th-th/meeting-meet-app.js":[53570,876240],"./th-th/meeting-options.js":[386194,795571],"./th-th/meeting-recap.js":[447672,562929],"./th-th/meeting-room-console.js":[null],"./th-th/meeting-stream-app.js":[null],"./th-th/message-escalate-dialog.js":[808708,725606],"./th-th/messaging.js":[139743,876240],"./th-th/mobile-attach.js":[null],"./th-th/mtma-missed-notifications.js":[938992,876240],"./th-th/nova.js":[942201,876240],"./th-th/people-app.js":[null],"./th-th/people-picker.js":[129986,876240],"./th-th/people-targeting.js":[334433,834379],"./th-th/people.js":[340341,876240],"./th-th/person.js":[614603,876240],"./th-th/phonelink-sms.js":[109801,738703],"./th-th/pre-core.js":[null],"./th-th/premium-benefits.js":[991735,835429],"./th-th/presence.js":[757463,876240],"./th-th/queues.js":[527796,186677],"./th-th/recurrence.js":[896828,896650],"./th-th/rsc-application-permissions.js":[null],"./th-th/search.js":[272657,985550],"./th-th/semantic-object.js":[128170,264403],"./th-th/settings.js":[237495,876240],"./th-th/share-in-meetings.js":[null],"./th-th/share-to-teams-outlook-addin.js":[null],"./th-th/share-to-teams-third-party.js":[null],"./th-th/share-to-teams.js":[733234,13752],"./th-th/shortcut.js":[86233,876240],"./th-th/shortcuts.js":[732950,876240],"./th-th/simple-collab.js":[914779,876240],"./th-th/smart-device.js":[null],"./th-th/survey.js":[222671,880956],"./th-th/sv-flyout.js":[941072,876240],"./th-th/teams-and-channels.js":[773966,730783],"./th-th/teams-insider.js":[64889,876240],"./th-th/telemetry.js":[346712,876240],"./th-th/tfl-homepage.js":[739538,876240],"./th-th/tfl-onboarding.js":[635914,876240],"./th-th/toast-notifications.js":[296657,876240],"./th-th/trusted-ui.js":[null],"./th-th/unified-search.js":[132052,13752],"./th-th/unsupported-browser.js":[null],"./th-th/url-preview.js":[755499,876240],"./th-th/video-capture.js":[727971,260744],"./th-th/video-message.js":[489088,26444],"./th-th/virtual-consumer-events.js":[587408,942765],"./th-th/virtual-events.js":[179899,862136],"./th-th/webinar.js":[861e3,710728],"./th-th/welcome-bot.js":[null],"./th-th/whats-new.js":[862944,876240],"./th-th/wiki.js":[null],"./tr-tr/activity.js":[646039,792574],"./tr-tr/artifacts-platform.js":[790394,244480],"./tr-tr/audience-view-dialog.js":[31296,231353],"./tr-tr/auth.js":[810341,792574],"./tr-tr/autosuggest.js":[1011,792574],"./tr-tr/avatar.js":[615204,792574],"./tr-tr/biometric-enrollment.js":[801094,435392],"./tr-tr/breakout-rooms.js":[626132,517097],"./tr-tr/broadcast.js":[231259,994411],"./tr-tr/calendar.js":[962472,978641],"./tr-tr/calling.js":[655526,933611],"./tr-tr/campaign-notifications.js":[448576,792574],"./tr-tr/carousel-multi-card.js":[null],"./tr-tr/cast.js":[298701,792574],"./tr-tr/channels.js":[310152,792574],"./tr-tr/chat-list.js":[264765,792574],"./tr-tr/coach-report.js":[990463,147112],"./tr-tr/comment-stream.js":[570731,867236],"./tr-tr/communities.js":[896467,792574],"./tr-tr/compose.js":[507535,792574],"./tr-tr/contacts.js":[774813,792574],"./tr-tr/datepicker.js":[684477,37514],"./tr-tr/desktop.js":[null],"./tr-tr/digital-signage.js":[null],"./tr-tr/discover-surface.js":[128858,246515],"./tr-tr/edu.js":[220057,42926],"./tr-tr/embed.js":[750966,792574],"./tr-tr/errors.js":[420825,792574],"./tr-tr/esp.js":[869045,828862],"./tr-tr/extensibility-ptz-extension.js":[null],"./tr-tr/extensibility-room-remote.js":[null],"./tr-tr/extensibility.js":[945022,792574],"./tr-tr/feedback.js":[302755,518689],"./tr-tr/files.js":[218560,792574],"./tr-tr/framework.js":[952269,792574],"./tr-tr/freemium-upgrade.js":[null],"./tr-tr/freemium.js":[943699,933611],"./tr-tr/funstuff.js":[161294,791444],"./tr-tr/gallery.js":[140926,135821],"./tr-tr/growth.js":[94638,792574],"./tr-tr/guardians.js":[958927,576118],"./tr-tr/health.js":[942495,256992],"./tr-tr/help.js":[null],"./tr-tr/hololens.js":[17003,933611],"./tr-tr/host-controls.js":[392607,529165],"./tr-tr/jana.js":[831681,638001],"./tr-tr/lightbox.js":[142517,792574],"./tr-tr/live-persona-card.js":[978433,792574],"./tr-tr/live-persona-editor.js":[279274,970470],"./tr-tr/lms-integration.js":[null],"./tr-tr/meet-for-work.js":[949107,642768],"./tr-tr/meeting-analytics.js":[218178,66235],"./tr-tr/meeting-apis-app.js":[null],"./tr-tr/meeting-bot.js":[null],"./tr-tr/meeting-collaboration.js":[160841,638707],"./tr-tr/meeting-flyout.js":[806427,792574],"./tr-tr/meeting-meet-app.js":[108922,792574],"./tr-tr/meeting-options.js":[145723,542944],"./tr-tr/meeting-recap.js":[121724,530977],"./tr-tr/meeting-room-console.js":[null],"./tr-tr/meeting-stream-app.js":[null],"./tr-tr/message-escalate-dialog.js":[762739,307124],"./tr-tr/messaging.js":[938294,792574],"./tr-tr/mobile-attach.js":[null],"./tr-tr/mtma-missed-notifications.js":[575669,792574],"./tr-tr/nova.js":[125223,792574],"./tr-tr/people-app.js":[null],"./tr-tr/people-picker.js":[723176,792574],"./tr-tr/people-targeting.js":[652842,757721],"./tr-tr/people.js":[401389,792574],"./tr-tr/person.js":[953821,792574],"./tr-tr/phonelink-sms.js":[847691,766814],"./tr-tr/pre-core.js":[null],"./tr-tr/premium-benefits.js":[169167,819091],"./tr-tr/presence.js":[951813,792574],"./tr-tr/queues.js":[181728,761949],"./tr-tr/recurrence.js":[267978,424665],"./tr-tr/rsc-application-permissions.js":[null],"./tr-tr/search.js":[544725,37514],"./tr-tr/semantic-object.js":[984903,859746],"./tr-tr/settings.js":[396219,792574],"./tr-tr/share-in-meetings.js":[null],"./tr-tr/share-to-teams-outlook-addin.js":[null],"./tr-tr/share-to-teams-third-party.js":[null],"./tr-tr/share-to-teams.js":[220280,370881],"./tr-tr/shortcut.js":[787468,792574],"./tr-tr/shortcuts.js":[466713,792574],"./tr-tr/simple-collab.js":[983527,792574],"./tr-tr/smart-device.js":[null],"./tr-tr/survey.js":[35707,350439],"./tr-tr/sv-flyout.js":[73704,792574],"./tr-tr/teams-and-channels.js":[887059,962139],"./tr-tr/teams-insider.js":[847682,792574],"./tr-tr/telemetry.js":[565841,792574],"./tr-tr/tfl-homepage.js":[785954,792574],"./tr-tr/tfl-onboarding.js":[732349,792574],"./tr-tr/toast-notifications.js":[619078,792574],"./tr-tr/trusted-ui.js":[null],"./tr-tr/unified-search.js":[229654,370881],"./tr-tr/unsupported-browser.js":[null],"./tr-tr/url-preview.js":[814332,792574],"./tr-tr/video-capture.js":[911505,332653],"./tr-tr/video-message.js":[594144,569790],"./tr-tr/virtual-consumer-events.js":[373366,66832],"./tr-tr/virtual-events.js":[169878,694535],"./tr-tr/webinar.js":[916198,644386],"./tr-tr/welcome-bot.js":[null],"./tr-tr/whats-new.js":[596547,792574],"./tr-tr/wiki.js":[null],"./uk-ua/activity.js":[731419,664618],"./uk-ua/artifacts-platform.js":[775929,602936],"./uk-ua/audience-view-dialog.js":[603067,615837],"./uk-ua/auth.js":[346610,664618],"./uk-ua/autosuggest.js":[341596,664618],"./uk-ua/avatar.js":[229230,664618],"./uk-ua/biometric-enrollment.js":[129867,534250],"./uk-ua/breakout-rooms.js":[783613,477270],"./uk-ua/broadcast.js":[543266,942239],"./uk-ua/calendar.js":[503762,488458],"./uk-ua/calling.js":[223720,442558],"./uk-ua/campaign-notifications.js":[827745,664618],"./uk-ua/carousel-multi-card.js":[null],"./uk-ua/cast.js":[773628,664618],"./uk-ua/channels.js":[851403,664618],"./uk-ua/chat-list.js":[763488,664618],"./uk-ua/coach-report.js":[25134,604184],"./uk-ua/comment-stream.js":[630042,196919],"./uk-ua/communities.js":[50605,664618],"./uk-ua/compose.js":[465639,664618],"./uk-ua/contacts.js":[656535,664618],"./uk-ua/datepicker.js":[225443,123025],"./uk-ua/desktop.js":[null],"./uk-ua/digital-signage.js":[null],"./uk-ua/discover-surface.js":[348051,845241],"./uk-ua/edu.js":[175553,668431],"./uk-ua/embed.js":[79946,664618],"./uk-ua/errors.js":[788553,664618],"./uk-ua/esp.js":[958789,722064],"./uk-ua/extensibility-ptz-extension.js":[null],"./uk-ua/extensibility-room-remote.js":[null],"./uk-ua/extensibility.js":[473901,664618],"./uk-ua/feedback.js":[983525,153351],"./uk-ua/files.js":[882483,664618],"./uk-ua/framework.js":[613932,664618],"./uk-ua/freemium-upgrade.js":[null],"./uk-ua/freemium.js":[65475,442558],"./uk-ua/funstuff.js":[862529,523383],"./uk-ua/gallery.js":[63761,520741],"./uk-ua/growth.js":[776537,664618],"./uk-ua/guardians.js":[555240,959930],"./uk-ua/health.js":[869251,10186],"./uk-ua/help.js":[null],"./uk-ua/hololens.js":[951854,442558],"./uk-ua/host-controls.js":[26829,297062],"./uk-ua/jana.js":[39400,624954],"./uk-ua/lightbox.js":[379117,664618],"./uk-ua/live-persona-card.js":[300715,664618],"./uk-ua/live-persona-editor.js":[109437,81318],"./uk-ua/lms-integration.js":[null],"./uk-ua/meet-for-work.js":[124090,608094],"./uk-ua/meeting-analytics.js":[673591,874906],"./uk-ua/meeting-apis-app.js":[null],"./uk-ua/meeting-bot.js":[null],"./uk-ua/meeting-collaboration.js":[824858,691913],"./uk-ua/meeting-flyout.js":[111983,664618],"./uk-ua/meeting-meet-app.js":[629005,664618],"./uk-ua/meeting-options.js":[9964,690166],"./uk-ua/meeting-recap.js":[883780,230100],"./uk-ua/meeting-room-console.js":[null],"./uk-ua/meeting-stream-app.js":[null],"./uk-ua/message-escalate-dialog.js":[406593,251181],"./uk-ua/messaging.js":[651010,664618],"./uk-ua/mobile-attach.js":[null],"./uk-ua/mtma-missed-notifications.js":[366969,664618],"./uk-ua/nova.js":[8934,664618],"./uk-ua/people-app.js":[null],"./uk-ua/people-picker.js":[155837,664618],"./uk-ua/people-targeting.js":[48988,403979],"./uk-ua/people.js":[1187,664618],"./uk-ua/person.js":[370159,664618],"./uk-ua/phonelink-sms.js":[400510,693802],"./uk-ua/pre-core.js":[null],"./uk-ua/premium-benefits.js":[821753,364984],"./uk-ua/presence.js":[216936,664618],"./uk-ua/queues.js":[711394,135977],"./uk-ua/recurrence.js":[518742,576807],"./uk-ua/rsc-application-permissions.js":[null],"./uk-ua/search.js":[303876,123025],"./uk-ua/semantic-object.js":[803810,280699],"./uk-ua/settings.js":[666072,664618],"./uk-ua/share-in-meetings.js":[null],"./uk-ua/share-to-teams-outlook-addin.js":[null],"./uk-ua/share-to-teams-third-party.js":[null],"./uk-ua/share-to-teams.js":[18758,891643],"./uk-ua/shortcut.js":[376330,664618],"./uk-ua/shortcuts.js":[252298,664618],"./uk-ua/simple-collab.js":[680954,664618],"./uk-ua/smart-device.js":[null],"./uk-ua/survey.js":[855305,595121],"./uk-ua/sv-flyout.js":[486562,664618],"./uk-ua/teams-and-channels.js":[446784,416918],"./uk-ua/teams-insider.js":[811210,664618],"./uk-ua/telemetry.js":[744234,664618],"./uk-ua/tfl-homepage.js":[592125,664618],"./uk-ua/tfl-onboarding.js":[735547,664618],"./uk-ua/toast-notifications.js":[779729,664618],"./uk-ua/trusted-ui.js":[null],"./uk-ua/unified-search.js":[244115,891643],"./uk-ua/unsupported-browser.js":[null],"./uk-ua/url-preview.js":[240361,664618],"./uk-ua/video-capture.js":[374562,536416],"./uk-ua/video-message.js":[729690,371761],"./uk-ua/virtual-consumer-events.js":[593827,20974],"./uk-ua/virtual-events.js":[294069,100834],"./uk-ua/webinar.js":[999832,137378],"./uk-ua/welcome-bot.js":[null],"./uk-ua/whats-new.js":[424867,664618],"./uk-ua/wiki.js":[null],"./vi-vn/activity.js":[742189,569545],"./vi-vn/artifacts-platform.js":[945449,150013],"./vi-vn/audience-view-dialog.js":[606347,810146],"./vi-vn/auth.js":[748300,569545],"./vi-vn/autosuggest.js":[961763,569545],"./vi-vn/avatar.js":[185937,569545],"./vi-vn/biometric-enrollment.js":[16008,854515],"./vi-vn/breakout-rooms.js":[234104,493937],"./vi-vn/broadcast.js":[160050,525110],"./vi-vn/calendar.js":[679304,810284],"./vi-vn/calling.js":[474946,405750],"./vi-vn/campaign-notifications.js":[215154,569545],"./vi-vn/carousel-multi-card.js":[null],"./vi-vn/cast.js":[697324,569545],"./vi-vn/channels.js":[731841,569545],"./vi-vn/chat-list.js":[708717,569545],"./vi-vn/coach-report.js":[445206,942941],"./vi-vn/comment-stream.js":[303975,585776],"./vi-vn/communities.js":[984559,569545],"./vi-vn/compose.js":[353838,569545],"./vi-vn/contacts.js":[262866,569545],"./vi-vn/datepicker.js":[64963,823065],"./vi-vn/desktop.js":[null],"./vi-vn/digital-signage.js":[null],"./vi-vn/discover-surface.js":[42766,556923],"./vi-vn/edu.js":[999803,573266],"./vi-vn/embed.js":[389597,569545],"./vi-vn/errors.js":[585634,569545],"./vi-vn/esp.js":[622426,546584],"./vi-vn/extensibility-ptz-extension.js":[null],"./vi-vn/extensibility-room-remote.js":[null],"./vi-vn/extensibility.js":[461588,569545],"./vi-vn/feedback.js":[647386,220211],"./vi-vn/files.js":[293521,569545],"./vi-vn/framework.js":[350930,569545],"./vi-vn/freemium-upgrade.js":[null],"./vi-vn/freemium.js":[256588,405750],"./vi-vn/funstuff.js":[452065,881647],"./vi-vn/gallery.js":[953437,279957],"./vi-vn/growth.js":[786997,569545],"./vi-vn/guardians.js":[14011,500397],"./vi-vn/health.js":[289923,496968],"./vi-vn/help.js":[null],"./vi-vn/hololens.js":[295299,405750],"./vi-vn/host-controls.js":[966642,531539],"./vi-vn/jana.js":[829497,550985],"./vi-vn/lightbox.js":[689403,569545],"./vi-vn/live-persona-card.js":[737915,569545],"./vi-vn/live-persona-editor.js":[623646,153338],"./vi-vn/lms-integration.js":[null],"./vi-vn/meet-for-work.js":[276010,547869],"./vi-vn/meeting-analytics.js":[843877,929813],"./vi-vn/meeting-apis-app.js":[null],"./vi-vn/meeting-bot.js":[null],"./vi-vn/meeting-collaboration.js":[555645,718031],"./vi-vn/meeting-flyout.js":[357046,569545],"./vi-vn/meeting-meet-app.js":[42250,569545],"./vi-vn/meeting-options.js":[205063,768935],"./vi-vn/meeting-recap.js":[786472,701753],"./vi-vn/meeting-room-console.js":[null],"./vi-vn/meeting-stream-app.js":[null],"./vi-vn/message-escalate-dialog.js":[187170,189560],"./vi-vn/messaging.js":[843458,569545],"./vi-vn/mobile-attach.js":[null],"./vi-vn/mtma-missed-notifications.js":[461476,569545],"./vi-vn/nova.js":[450091,569545],"./vi-vn/people-app.js":[null],"./vi-vn/people-picker.js":[696589,569545],"./vi-vn/people-targeting.js":[796927,156652],"./vi-vn/people.js":[458234,569545],"./vi-vn/person.js":[604072,569545],"./vi-vn/phonelink-sms.js":[720294,815695],"./vi-vn/pre-core.js":[null],"./vi-vn/premium-benefits.js":[103015,189025],"./vi-vn/presence.js":[477589,569545],"./vi-vn/queues.js":[470737,53108],"./vi-vn/recurrence.js":[674312,296387],"./vi-vn/rsc-application-permissions.js":[null],"./vi-vn/search.js":[183911,823065],"./vi-vn/semantic-object.js":[898713,606091],"./vi-vn/settings.js":[832291,569545],"./vi-vn/share-in-meetings.js":[null],"./vi-vn/share-to-teams-outlook-addin.js":[null],"./vi-vn/share-to-teams-third-party.js":[null],"./vi-vn/share-to-teams.js":[681154,84399],"./vi-vn/shortcut.js":[791070,569545],"./vi-vn/shortcuts.js":[286350,569545],"./vi-vn/simple-collab.js":[190392,569545],"./vi-vn/smart-device.js":[null],"./vi-vn/survey.js":[713806,925442],"./vi-vn/sv-flyout.js":[820377,569545],"./vi-vn/teams-and-channels.js":[892760,709940],"./vi-vn/teams-insider.js":[605171,569545],"./vi-vn/telemetry.js":[403962,569545],"./vi-vn/tfl-homepage.js":[81176,569545],"./vi-vn/tfl-onboarding.js":[35442,569545],"./vi-vn/toast-notifications.js":[682092,569545],"./vi-vn/trusted-ui.js":[null],"./vi-vn/unified-search.js":[694155,84399],"./vi-vn/unsupported-browser.js":[null],"./vi-vn/url-preview.js":[856241,569545],"./vi-vn/video-capture.js":[529188,788582],"./vi-vn/video-message.js":[466538,771326],"./vi-vn/virtual-consumer-events.js":[816007,775377],"./vi-vn/virtual-events.js":[440246,771285],"./vi-vn/webinar.js":[890513,791496],"./vi-vn/welcome-bot.js":[null],"./vi-vn/whats-new.js":[804119,569545],"./vi-vn/wiki.js":[null],"./zh-cn/activity.js":[429266,642742],"./zh-cn/artifacts-platform.js":[773451,624764],"./zh-cn/audience-view-dialog.js":[420528,628746],"./zh-cn/auth.js":[457660,642742],"./zh-cn/autosuggest.js":[822146,642742],"./zh-cn/avatar.js":[886898,642742],"./zh-cn/biometric-enrollment.js":[513806,838355],"./zh-cn/breakout-rooms.js":[379667,422535],"./zh-cn/broadcast.js":[64529,75895],"./zh-cn/calendar.js":[719643,584836],"./zh-cn/calling.js":[716281,630291],"./zh-cn/campaign-notifications.js":[689043,642742],"./zh-cn/carousel-multi-card.js":[null],"./zh-cn/cast.js":[272930,642742],"./zh-cn/channels.js":[670970,642742],"./zh-cn/chat-list.js":[304345,642742],"./zh-cn/coach-report.js":[980488,833477],"./zh-cn/comment-stream.js":[922257,19444],"./zh-cn/communities.js":[633379,642742],"./zh-cn/compose.js":[242487,642742],"./zh-cn/contacts.js":[186146,642742],"./zh-cn/datepicker.js":[169918,831506],"./zh-cn/desktop.js":[null],"./zh-cn/digital-signage.js":[null],"./zh-cn/discover-surface.js":[622829,669891],"./zh-cn/edu.js":[946605,478680],"./zh-cn/embed.js":[667041,642742],"./zh-cn/errors.js":[590016,642742],"./zh-cn/esp.js":[457560,174847],"./zh-cn/extensibility-ptz-extension.js":[null],"./zh-cn/extensibility-room-remote.js":[null],"./zh-cn/extensibility.js":[958025,642742],"./zh-cn/feedback.js":[765025,553067],"./zh-cn/files.js":[441773,642742],"./zh-cn/framework.js":[695029,642742],"./zh-cn/freemium-upgrade.js":[null],"./zh-cn/freemium.js":[858354,630291],"./zh-cn/funstuff.js":[32028,814551],"./zh-cn/gallery.js":[900966,627455],"./zh-cn/growth.js":[146519,642742],"./zh-cn/guardians.js":[662570,660273],"./zh-cn/health.js":[195919,433112],"./zh-cn/help.js":[null],"./zh-cn/hololens.js":[688174,630291],"./zh-cn/host-controls.js":[93716,17021],"./zh-cn/jana.js":[681781,380858],"./zh-cn/lightbox.js":[985381,642742],"./zh-cn/live-persona-card.js":[435788,642742],"./zh-cn/live-persona-editor.js":[681031,528650],"./zh-cn/lms-integration.js":[null],"./zh-cn/meet-for-work.js":[645722,895669],"./zh-cn/meeting-analytics.js":[588370,719109],"./zh-cn/meeting-apis-app.js":[null],"./zh-cn/meeting-bot.js":[null],"./zh-cn/meeting-collaboration.js":[348645,441734],"./zh-cn/meeting-flyout.js":[422752,642742],"./zh-cn/meeting-meet-app.js":[819754,642742],"./zh-cn/meeting-options.js":[290677,327217],"./zh-cn/meeting-recap.js":[501069,432673],"./zh-cn/meeting-room-console.js":[null],"./zh-cn/meeting-stream-app.js":[null],"./zh-cn/message-escalate-dialog.js":[357266,527246],"./zh-cn/messaging.js":[693396,642742],"./zh-cn/mobile-attach.js":[null],"./zh-cn/mtma-missed-notifications.js":[462294,642742],"./zh-cn/nova.js":[90116,642742],"./zh-cn/people-app.js":[null],"./zh-cn/people-picker.js":[910892,642742],"./zh-cn/people-targeting.js":[356579,167008],"./zh-cn/people.js":[40091,642742],"./zh-cn/person.js":[76790,642742],"./zh-cn/phonelink-sms.js":[194952,764099],"./zh-cn/pre-core.js":[null],"./zh-cn/premium-benefits.js":[682267,724989],"./zh-cn/presence.js":[854915,642742],"./zh-cn/queues.js":[756108,579947],"./zh-cn/recurrence.js":[534246,877357],"./zh-cn/rsc-application-permissions.js":[null],"./zh-cn/search.js":[816563,831506],"./zh-cn/semantic-object.js":[796499,707368],"./zh-cn/settings.js":[364637,642742],"./zh-cn/share-in-meetings.js":[null],"./zh-cn/share-to-teams-outlook-addin.js":[null],"./zh-cn/share-to-teams-third-party.js":[null],"./zh-cn/share-to-teams.js":[215069,961038],"./zh-cn/shortcut.js":[874867,642742],"./zh-cn/shortcuts.js":[151106,642742],"./zh-cn/simple-collab.js":[613901,642742],"./zh-cn/smart-device.js":[null],"./zh-cn/survey.js":[767507,734882],"./zh-cn/sv-flyout.js":[554649,642742],"./zh-cn/teams-and-channels.js":[846982,333371],"./zh-cn/teams-insider.js":[368391,642742],"./zh-cn/telemetry.js":[943825,642742],"./zh-cn/tfl-homepage.js":[110233,642742],"./zh-cn/tfl-onboarding.js":[887627,642742],"./zh-cn/toast-notifications.js":[38527,642742],"./zh-cn/trusted-ui.js":[null],"./zh-cn/unified-search.js":[385901,961038],"./zh-cn/unsupported-browser.js":[null],"./zh-cn/url-preview.js":[74485,642742],"./zh-cn/video-capture.js":[554348,411158],"./zh-cn/video-message.js":[252011,161747],"./zh-cn/virtual-consumer-events.js":[149795,253883],"./zh-cn/virtual-events.js":[730877,473985],"./zh-cn/webinar.js":[117122,953154],"./zh-cn/welcome-bot.js":[null],"./zh-cn/whats-new.js":[619011,642742],"./zh-cn/wiki.js":[null],"./zh-tw/activity.js":[453726,335921],"./zh-tw/artifacts-platform.js":[145572,130005],"./zh-tw/audience-view-dialog.js":[904400,499112],"./zh-tw/auth.js":[228907,335921],"./zh-tw/autosuggest.js":[85394,335921],"./zh-tw/avatar.js":[429188,335921],"./zh-tw/biometric-enrollment.js":[605248,863732],"./zh-tw/breakout-rooms.js":[873803,369326],"./zh-tw/broadcast.js":[53403,654761],"./zh-tw/calendar.js":[213374,403461],"./zh-tw/calling.js":[531351,386347],"./zh-tw/campaign-notifications.js":[120677,335921],"./zh-tw/carousel-multi-card.js":[null],"./zh-tw/cast.js":[727508,335921],"./zh-tw/channels.js":[940702,335921],"./zh-tw/chat-list.js":[867761,335921],"./zh-tw/coach-report.js":[76508,840697],"./zh-tw/comment-stream.js":[419709,675749],"./zh-tw/communities.js":[667812,335921],"./zh-tw/compose.js":[550178,335921],"./zh-tw/contacts.js":[426859,335921],"./zh-tw/datepicker.js":[348684,427521],"./zh-tw/desktop.js":[null],"./zh-tw/digital-signage.js":[null],"./zh-tw/discover-surface.js":[843958,385299],"./zh-tw/edu.js":[716469,79240],"./zh-tw/embed.js":[207130,335921],"./zh-tw/errors.js":[220705,335921],"./zh-tw/esp.js":[679569,616045],"./zh-tw/extensibility-ptz-extension.js":[null],"./zh-tw/extensibility-room-remote.js":[null],"./zh-tw/extensibility.js":[192149,335921],"./zh-tw/feedback.js":[8008,280265],"./zh-tw/files.js":[702479,335921],"./zh-tw/framework.js":[713717,335921],"./zh-tw/freemium-upgrade.js":[null],"./zh-tw/freemium.js":[929779,386347],"./zh-tw/funstuff.js":[62451,213480],"./zh-tw/gallery.js":[672091,567103],"./zh-tw/growth.js":[682144,335921],"./zh-tw/guardians.js":[256596,508954],"./zh-tw/health.js":[92329,930217],"./zh-tw/help.js":[null],"./zh-tw/hololens.js":[122119,386347],"./zh-tw/host-controls.js":[635309,888418],"./zh-tw/jana.js":[834945,77867],"./zh-tw/lightbox.js":[118871,335921],"./zh-tw/live-persona-card.js":[176190,335921],"./zh-tw/live-persona-editor.js":[448862,332069],"./zh-tw/lms-integration.js":[null],"./zh-tw/meet-for-work.js":[536318,391139],"./zh-tw/meeting-analytics.js":[141160,783226],"./zh-tw/meeting-apis-app.js":[null],"./zh-tw/meeting-bot.js":[null],"./zh-tw/meeting-collaboration.js":[11128,285815],"./zh-tw/meeting-flyout.js":[188527,335921],"./zh-tw/meeting-meet-app.js":[734778,335921],"./zh-tw/meeting-options.js":[701654,789183],"./zh-tw/meeting-recap.js":[693553,658142],"./zh-tw/meeting-room-console.js":[null],"./zh-tw/meeting-stream-app.js":[null],"./zh-tw/message-escalate-dialog.js":[483566,266613],"./zh-tw/messaging.js":[376764,335921],"./zh-tw/mobile-attach.js":[null],"./zh-tw/mtma-missed-notifications.js":[737382,335921],"./zh-tw/nova.js":[276001,335921],"./zh-tw/people-app.js":[null],"./zh-tw/people-picker.js":[946184,335921],"./zh-tw/people-targeting.js":[769922,878981],"./zh-tw/people.js":[301751,335921],"./zh-tw/person.js":[145237,335921],"./zh-tw/phonelink-sms.js":[14079,69973],"./zh-tw/pre-core.js":[null],"./zh-tw/premium-benefits.js":[107755,364367],"./zh-tw/presence.js":[877945,335921],"./zh-tw/queues.js":[663686,810072],"./zh-tw/recurrence.js":[181825,960988],"./zh-tw/rsc-application-permissions.js":[null],"./zh-tw/search.js":[908461,427521],"./zh-tw/semantic-object.js":[359856,219495],"./zh-tw/settings.js":[526279,335921],"./zh-tw/share-in-meetings.js":[null],"./zh-tw/share-to-teams-outlook-addin.js":[null],"./zh-tw/share-to-teams-third-party.js":[null],"./zh-tw/share-to-teams.js":[547527,581783],"./zh-tw/shortcut.js":[271861,335921],"./zh-tw/shortcuts.js":[161944,335921],"./zh-tw/simple-collab.js":[678081,335921],"./zh-tw/smart-device.js":[null],"./zh-tw/survey.js":[115564,519078],"./zh-tw/sv-flyout.js":[664335,335921],"./zh-tw/teams-and-channels.js":[65512,137025],"./zh-tw/teams-insider.js":[296395,335921],"./zh-tw/telemetry.js":[845113,335921],"./zh-tw/tfl-homepage.js":[777600,335921],"./zh-tw/tfl-onboarding.js":[492598,335921],"./zh-tw/toast-notifications.js":[16986,335921],"./zh-tw/trusted-ui.js":[null],"./zh-tw/unified-search.js":[688295,581783],"./zh-tw/unsupported-browser.js":[null],"./zh-tw/url-preview.js":[329381,335921],"./zh-tw/video-capture.js":[192776,77960],"./zh-tw/video-message.js":[738426,232190],"./zh-tw/virtual-consumer-events.js":[907735,344073],"./zh-tw/virtual-events.js":[729745,700632],"./zh-tw/webinar.js":[854344,165238],"./zh-tw/welcome-bot.js":[null],"./zh-tw/whats-new.js":[450443,335921],"./zh-tw/wiki.js":[null]};function o(e){if(!i.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],o=t[0];return Promise.all(t.slice(1).map(i.e)).then((()=>i(o)))}o.keys=()=>Object.keys(n),o.id=122057,e.exports=o},32668:()=>{},817774:()=>{},759455:e=>{"use strict";e.exports=JSON.parse('{"clientId":"4b3e8f46-56d3-427f-b1e2-d239b2ea6bca","basePath":"v2","experienceName":"react-web-client","fallbackLocale":"en-us","webAuth":{"cacheLocation":"localStorage","navigateToLoginRequestUrl":true,"top":{"popUp":false},"iframe":{"redirectPath":"auth"}},"ring":{"id":"ring0"},"cdnVersion":4,"enableDevTools":false,"useReactWebClientCoreTasks":true,"windowType":"ReactWebClient","lpcRegion":"","isLPCEnabled":true,"shouldExecuteDefaultCommand":true,"preloadedI18nNamespaces":["activity","auth","autosuggest","avatar","calendar","calling","channels","chatList","communities","compose","contacts","errors","extensibility","files","framework","freemium","gallery","lightbox","livePersonaCard","meetingMeetApp","messaging","mtmaMissedNotifications","nova","people","peoplePicker","premiumBenefits","presence","recurrence","settings","teamsAndChannels","telemetry","toastNotifications","urlPreview","meetingCollaboration"],"partitionCacheByExperience":true,"forceUseBrowserHistory":true,"coreTasksTimeoutMs":300000,"supportsAsyncUserContext":true,"postMessageConfig":[],"enableSupermassive":true,"enableRelay":true}')}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/219271-415decc80f495cb0.js.map