"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[369093],{969939:(e,t,s)=>{var r;s.d(t,{h:()=>r}),function(e){e.default="default",e.skypeConCore="conCore",e.mediaAgent="mediaAgent",e.CDL="CDL"}(r||(r={}))},83398:(e,t,s)=>{s.d(t,{N:()=>m});var r=s(740597),i=s(589008),n=s(185870);class a{constructor(){this.telemetry=i.sE.CreateTelemetryManager(),this.ariaLoggers={},this.statusParams={active:!0,firstPartyLoggerTokens:{},secondPartyLoggerTokens:{}},this.mainContextMap={},(0,n.cS)(this.telemetry)}initialize(e){this.initParams=e,this.telemetry.Initialize(e.config),n.hD.initialize(e.documentInfo,e.appTokens.default)}start(){this.telemetry.Start(),this.statusParams.active=!0}stop(){this.telemetry.Stop(),this.statusParams.active=!1}flush(e,t){let s=8;const r=()=>{const t=this.telemetry._eventsCache.IsEmpty(),i=0==--s;t||i?e.postMessage("flushed"):this.telemetry.Flush(r)};r()}flushForReinit(e){let t=8;const s=()=>{const r=this.telemetry._eventsCache.IsEmpty(),i=0==--t;r||i?(e.postMessage("flushedForReinit"),this.stop()):this.telemetry.Flush(s)};s()}createNewLogger(e,t){this.statusParams.firstPartyLoggerTokens[e]=t,this.ariaLoggers[e]=new n.Yd(t)}logEvent(e,t){if(!e)return;const s=this.ariaLoggers[e];s&&s.logEvent(t)}logSession(e,t){const s=this.ariaLoggers[t.name];if(!s)return;const r=t.state;s.logSession(r,t.properties,t.sessionId,t.sessionStartTime),e.postMessage("sessionId",{key:t.name,value:s.getSessionId()})}createNewSecondPartyLogger(e,t,s){this.statusParams.secondPartyLoggerTokens[e]=t}logSecondPartyEvent(e,t){}setContext(e){this.mainContextMap[e.key]={value:e.value},n.hD.setContext(e.key,e.value,e.pii)}setUserId(e){n.hD.getSemanticContext().setUserId(e)}setUserTenantId(e){n.hD.getSemanticContext().setUserTenantId(e)}setUserRing(e){n.hD.getSemanticContext().setUserRing(e)}setAppClientType(e){n.hD.getSemanticContext().setAppClientType(e)}setDeviceAuthToken(e){}setPrivacyGuardSensitiveInformation(e){}updateSDKWithPrivacyGuard(e){}logOutUser(e){}setPrimaryUser(e){}}var o=s(969939),l=s(946844),h=s(472084),u=s(94136);const d=["admin","Admin","ADMIN","administrator","Administrator","ADMINISTRATOR","automation","Automation","AUTOMATION","client","Client","CLIENT","limited","Limited","LIMITED","office","Office","OFFICE","services","Services","SERVICES","user","User","USER"],c={browserVer:"DeviceInfo.BrowserVersion",browserName:"DeviceInfo.BrowserName"},g={"appinfo.id":"ext.app.id","appinfo.env":"ext.app.env","appinfo.version":"ext.app.ver","appinfo.versionnew":"ext.app.ver","appinfo.language":"ext.app.locale","userinfo.language":"ext.user.locale","userinfo.timezone":"ext.location.tz","userinfo.id":"ext.user.id","userinfo.tenantid":"ext.user.tenantid","deviceinfo.id":"ext.device.localid","deviceinfo.make":"ext.device.make","deviceinfo.model":"ext.device.model","deviceinfo.networktype":"ext.net.type","deviceinfo.browsername":"ext.web.browser","deviceinfo.browserversion":"ext.web.browserversion"};class p{constructor(){this.oneDsLoggers={},this.contextCallbacks={},this.secondPartyLoggers={},this.oneDsManager=new l.Z,this.sharedConfig={},this.privacyGuardContext={},this.loggerContextMap={},this.userContextMap={},this.mainContextMap={},this.commonSchemaContextMap={},this.statusParams={active:!0,firstPartyLoggerTokens:{},secondPartyLoggerTokens:{}}}initialize(e){var t,s,r;this.initParams=e,this.sharedConfig={instrumentationKey:e.appTokens.default,endpointUrl:e.oneDsCollectorUrl,extensions:[],extensionConfig:[],propertyConfiguration:{populateBrowserInfo:!0,populateOperatingSystemInfo:!0,sessionAsGuid:!0},channelConfiguration:{payloadPreprocessor:e.enableCompression?(e,t)=>{this.gzipPayload(e,t)}:void 0,eventsLimitInMem:e.eventsLimitInMem,autoFlushEventsLimit:e.eventsLimitInMem*e.autoFlushPercent,ignoreMc1Ms0CookieProcessing:!0,enableCompoundKey:!0},maxMessageLimit:0},this.privacyGuard=new h.q,this.sharedConfig.extensionConfig||(this.sharedConfig.extensionConfig=[]),this.privacyGuardContext.IgnoredNameParts=d,this.sharedConfig.extensionConfig[null===(t=this.privacyGuard)||void 0===t?void 0:t.identifier]={context:this.privacyGuardContext,iKey:this.initParams.privacyGuardIngestionToken,useEventFieldPrefix:!0,useAbsoluteFieldName:!0},this.oneDsManager.create(this.sharedConfig,[this.privacyGuard]),null===(r=(s=this.oneDsManager.getPostChannel().core).stopPollingInternalLogs)||void 0===r||r.call(s),this.initParams.enablePrivacyGuard&&this._initializePrivacyGuard(),this.contextCallbacks["DeviceInfo.OsVersion"]=this.onOsVersion.bind(this)}updateSDKWithPrivacyGuard(e){e?this._initializePrivacyGuard():this._stopPrivacyGuard()}setPrivacyGuardSensitiveInformation(e){if(this.privacyGuard){const t=e.userNames,s=e.upns;t&&(this.privacyGuardContext.UserNames=t),s&&(this.privacyGuardContext.UserAliases=[],s.forEach((e=>{var t;const s=e.split("@")[0];s&&(null===(t=this.privacyGuardContext.UserAliases)||void 0===t||t.push(s))}))),this.privacyGuard.updateCommonContext(this.privacyGuardContext)}}start(){this.resume()}stop(){this.pause()}pause(){this.oneDsManager.getPostChannel().pause(),this.statusParams.active=!1}resume(){this.oneDsManager.getPostChannel().resume(),this.statusParams.active=!0}setDeviceAuthToken(e){var t;(null===(t=this.initParams)||void 0===t?void 0:t.enableLoggingGlobalDeviceId)&&this.oneDsManager.getPostChannel().setMsaAuthTicket(e)}flush(e,t){this.oneDsManager.getPostChannel().flush(!!t,(()=>{e.postMessage("flushed")}))}flushForReinit(e){this.oneDsManager.getPostChannel().flush(!1,(()=>{e.postMessage("flushedForReinit"),this.pause()}))}createNewLogger(e,t){if(e&&(this.statusParams.firstPartyLoggerTokens[e]=""),e&&t&&this.initParams){const s=this.oneDsManager.newInst(t);if(!s)return;s.stopPollingInternalLogs(),this.oneDsLoggers[e]=s,this.statusParams.firstPartyLoggerTokens[e]=t;const r="MSTeamsFix15SecondsProfile";this.oneDsManager.getPostChannel()._loadTransmitProfiles({[r]:[this.initParams.normalPrioritySendTimeInSecs,this.initParams.highPrioritySendTimeInSecs]}),this.oneDsManager.getPostChannel()._setTransmitProfile(r),this._handleSDKContextOverridesAtInit(s)}}logEvent(e,t,s){var r;if(!e||!t)return;const i=this.oneDsLoggers[e];if(!i)return;const n=t.properties,a={logger:{value:e}};for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const t=n[e],s={value:t.value,kind:t.pii};a[e]=s}const l=new Date(t.timestamp).toISOString(),h={name:t.name,baseType:t.eventType,time:l,data:Object.assign(Object.assign(Object.assign({},a),this.mainContextMap),this.loggerContextMap[e])};if(e!==o.h.default&&(h.data=Object.assign(Object.assign({},h.data),this.loggerContextMap[e])),null===(r=this.initParams)||void 0===r?void 0:r.enableMTMA){const e=!s&&this.primaryUser?this.userContextMap[this.primaryUser]:this.userContextMap[s];h.data=Object.assign(Object.assign({},h.data),e)}i.track(h)}createNewSecondPartyLogger(e,t,s=!1){const r=this.oneDsManager.newInst(t);r.stopPollingInternalLogs(),this.secondPartyLoggers[e]={logger:r,useTeamsContext:s},this.statusParams.secondPartyLoggerTokens[e]=t}logSecondPartyEvent(e,t){if(!e||!t)return;const s=this.secondPartyLoggers[e];s&&(s.useTeamsContext&&(t.data=Object.assign(Object.assign({},t.data),this.commonSchemaContextMap)),s.logger.track(t))}setContext(e){var t,s;let r={value:e.value};if(e.logger)return this.loggerContextMap[e.logger]||(this.loggerContextMap[e.logger]={}),"AppInfo.ExpIds"===e.key&&"CDL"===e.logger&&this.mainContextMap[e.key]&&this.mainContextMap[e.key].value&&(null===(t=this.initParams)||void 0===t?void 0:t.enableMergedExpIds)&&(r={value:`${e.value},${this.mainContextMap[e.key].value}`}),void(this.loggerContextMap[e.logger][e.key]=r);(null===(s=this.initParams)||void 0===s?void 0:s.enableMTMA)?("UserInfo.Id"===e.key&&e.userContextId&&(this.userContextMap[e.userContextId]||(this.userContextMap[e.userContextId]={})),e.userContextId?(this.userContextMap[e.userContextId]||(this.userContextMap[e.userContextId]={}),this.userContextMap[e.userContextId][e.key]=r):this.mainContextMap[e.key]=r,this._setToCommonSchemaPropMap(e.key,r)):(this.mainContextMap[e.key]=r,this._setToCommonSchemaPropMap(e.key,r)),e.key in this.contextCallbacks&&this.contextCallbacks[e.key](e.key,e.value),this._handleSDKContextOverrides(e.key,e.value)}setUserId(e){var t;const s="UserInfo.Id",r={value:e,kind:void 0};(null===(t=this.initParams)||void 0===t?void 0:t.enableMTMA)?this.setContext({key:s,value:e,userContextId:e}):(this.mainContextMap[s]=r,this._setToCommonSchemaPropMap(s,r))}logOutUser(e){var t;(null===(t=this.initParams)||void 0===t?void 0:t.enableMTMA)&&(this.userContextMap[e]={})}logSession(e,t){t.sessionId&&this.oneDsManager.getPropertyManager().getPropertiesContext().session.setId(t.sessionId)}setPrimaryUser(e){this.primaryUser||(this.primaryUser=e,this.userContextMap[e]||(this.userContextMap[e]={}))}setUserTenantId(e){}setUserRing(e){}setAppClientType(e){}gzipPayload(e,t){e.data=(0,u.gzip)(e.data),e.urlString+="&content-encoding=gzip",t(e)}_handleSDKContextOverridesAtInit(e){Object.values(c).forEach((t=>{var s;return this._handleSDKContextOverrides(t,null===(s=this.mainContextMap[t])||void 0===s?void 0:s.value,e)}))}_handleSDKContextOverrides(e,t,s){var r,i;if(!(null===(r=this.initParams)||void 0===r?void 0:r.enableSDKContextOverrides))return;if(!Object.values(c).includes(e))return;const n=s?[s]:Object.values(this.oneDsLoggers),a=t||(null===(i=this.mainContextMap[e])||void 0===i?void 0:i.value.toString());if(a)switch(e){case c.browserVer:n.forEach((e=>e.getOverridePropertyManager().getOverrideContext().web.setBrowserVer(a)));break;case c.browserName:n.forEach((e=>e.getOverridePropertyManager().getOverrideContext().web.setBrowser(a)))}}_setToCommonSchemaPropMap(e,t){const s=g[e.toLowerCase()];s&&(this.commonSchemaContextMap[s]=t)}_initializePrivacyGuard(){var e;null===(e=this.privacyGuard)||void 0===e||e.setEnabled(!0),this.intervalId||(this.intervalId=setInterval((()=>{var e;null===(e=this.privacyGuard)||void 0===e||e.sendSummaryEvent(!0)}),6e5))}_stopPrivacyGuard(){var e;this.intervalId&&clearInterval(this.intervalId),null===(e=this.privacyGuard)||void 0===e||e.setEnabled(!1)}onOsVersion(e,t){this.oneDsManager.getPropertyManager().getPropertiesContext().os.ver=t}}var v=s(234207);class _{constructor(e){this.router=e,this.isInitialized=!1,this.messageHandlers={},this.router.registerMessageHandler("initCoreSettingsWorker",(e=>{this.port=e.port,this.port.onmessage=this.onMessageHandler.bind(this),this.isInitialized=!0}))}get(e,t){return new Promise(((s,r)=>{var i;this.isInitialized&&this.port||r("CoreSettingsWorkerConsumer is not initialized");const n=`${(0,v.v4)()}-${e}`;this.messageHandlers[n]=e=>{const{values:t}=e;delete this.messageHandlers[n],s(t)},null===(i=this.port)||void 0===i||i.postMessage({type:"settingsRequest",payload:{category:e,settings:t,id:n}})}))}subscribe(e,t){var s;if(!this.isInitialized||!this.port)return;const r=s=>{const{values:r}=s;t(r),this.subscriptionCache&&this.subscriptionCache[e]&&(this.subscriptionCache[e].valueCache=r)};return this.subscriptionCache||(this.subscriptionCache={}),this.subscriptionCache[e]?(r({category:e,values:this.subscriptionCache[e].valueCache}),this.subscriptionCache[e].handlers.push(r)):this.subscriptionCache[e]||(this.subscriptionCache[e]={handlers:[],valueCache:{}},this.subscriptionCache[e].handlers.push(r),null===(s=this.port)||void 0===s||s.postMessage({type:"subscribeCategory",payload:{category:e}})),()=>{var t;this.subscriptionCache&&this.subscriptionCache[e]&&(this.subscriptionCache[e].handlers=this.subscriptionCache[e].handlers.filter((e=>e!==r)),0===this.subscriptionCache[e].handlers.length&&(null===(t=this.port)||void 0===t||t.postMessage({type:"unsubscribeCategory",payload:{category:e}})))}}onMessageHandler(e){const{type:t,payload:s}=e.data;if("settingsResponse"===t){const{id:t}=e.data.payload;this.messageHandlers[t](e.data.payload)}"categorySubscriptionResponse"===t&&this.subscriptionCache&&this.subscriptionCache[s.category]&&this.subscriptionCache[s.category].handlers.forEach((e=>{e(s)}))}}class m{constructor(){this.enableOneDsSdk=!1,this.transportDelayed=!1,this.existingTransports={},this.secondPartyLoggers={},this.firstPartyLoggers={},this.contextMap={},this.userContextMap={},this.primaryUser=""}initialize(e){if(!e)throw new Error("WebWorkerRouter did not exist.");this.router=e,this._registerMessageHandlers(e),this.workerCoreSettings=new _(e)}setupFirstPartyRouter(e,t){e.registerMessageHandler("initialize",(t=>{this.telemetryTransport?e.postMessage("workerInitialized"):this.transportDelayed=!0})),e.registerMessageHandler("newLogger",(e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.createNewLogger(e.key,e.value),this.firstPartyLoggers[e.key]=e.value})),e.registerMessageHandler("logEvent",(e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.logEvent(e.key,e.value,e.userContextId)})),e.registerMessageHandler("setContext",(e=>{var s;const{contextFilter:r}=t;r.has(e.key)&&(null===(s=this.telemetryTransport)||void 0===s||s.setContext(e))}))}Verbose(e){this.router&&this.router.postMessage("verbose",e)}Error(e){this.router&&this.router.postMessage("error",e)}Info(e){this.router&&this.router.postMessage("info",e)}_registerMessageHandlers(e){e.registerMessageHandler("initialize",(t=>{this.initTelemetryTransport(t),e.postMessage("workerInitialized")})),e.registerMessageHandler("start",(()=>{var e;null===(e=this.telemetryTransport)||void 0===e||e.start()})),e.registerMessageHandler("stop",(()=>{var e;null===(e=this.telemetryTransport)||void 0===e||e.stop()})),e.registerMessageHandler("flush",(t=>{var s;null===(s=this.telemetryTransport)||void 0===s||s.flush(e,null==t?void 0:t.isAsync)})),e.registerMessageHandler("flushForReinit",(t=>{this.reinitTelemetryTransport(t,e)})),e.registerMessageHandler("newLogger",(e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.createNewLogger(e.key,e.value),this.firstPartyLoggers[e.key]=e.value})),e.registerMessageHandler("logEvent",(e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.logEvent(e.key,e.value,e.userContextId)})),e.registerMessageHandler("newSecondPartyOneDsLogger",(e=>{this.createSecondPartyLogger(e.key,e.value.ingestionToken,e.value.useTeamsContext)})),e.registerMessageHandler("setPrimaryUser",(e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.setPrimaryUser(e.userContextId)})),e.registerMessageHandler("logSecondPartyEvent",(e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.logSecondPartyEvent(e.key,e.value)})),e.registerMessageHandler("logSession",(t=>{var s;t.sessionId&&(this.contextMap["Session.Id"]=t.sessionId),null===(s=this.telemetryTransport)||void 0===s||s.logSession(e,t)})),e.registerMessageHandler("setUserId",(e=>{var t;this.contextMap["UserInfo.Id"]=e,null===(t=this.telemetryTransport)||void 0===t||t.setUserId(e)})),e.registerMessageHandler("setUserTenantId",(e=>{var t;this.contextMap["UserInfo.TenantId"]=e,null===(t=this.telemetryTransport)||void 0===t||t.setUserTenantId(e)})),e.registerMessageHandler("setUserRing",(e=>{var t;this.contextMap["UserInfo.Ring"]=e,null===(t=this.telemetryTransport)||void 0===t||t.setUserRing(e)})),e.registerMessageHandler("setDeviceAuthToken",(e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.setDeviceAuthToken(e)})),e.registerMessageHandler("setAppClientType",(e=>{var t;this.contextMap["AppInfo.ClientType"]=e,null===(t=this.telemetryTransport)||void 0===t||t.setAppClientType(e)})),e.registerMessageHandler("setContext",(e=>{var t;this.contextMap[e.key]=e.value,this.enableMTMA?("UserInfo.Id"===e.key&&e.userContextId&&(this.userContextMap[e.userContextId]||(this.userContextMap[e.userContextId]={}),this.primaryUser||(this.primaryUser=e.userContextId)),e.userContextId?(this.userContextMap[e.userContextId]||(this.userContextMap[e.userContextId]={}),this.userContextMap[e.userContextId][e.key]=e.value):this.contextMap[e.key]=e.value):this.contextMap[e.key]=e.value,null===(t=this.telemetryTransport)||void 0===t||t.setContext(e)})),e.registerMessageHandler("setPrivacyGuardUserInfo",(e=>{var t;this.enableOneDsSdk&&(null===(t=this.telemetryTransport)||void 0===t||t.setPrivacyGuardSensitiveInformation(e))})),e.registerMessageHandler("updateSDKWithPrivacyGuard",(e=>{var t;this.enableOneDsSdk&&(null===(t=this.telemetryTransport)||void 0===t||t.updateSDKWithPrivacyGuard(e))})),e.registerMessageHandler("logOutUser",(e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.logOutUser(e)})),e.registerMessageHandler("pulsarSignal",(e=>(0,r.__awaiter)(this,void 0,void 0,(function*(){if(!this.pulsarSignalProcessor){const{ProcessorFactory:e}=yield s.e(850926).then(s.bind(s,502414));this.pulsarSignalProcessor=e.getInstance().createDefaultProcessor({notify:this.notifyPulsarConsumer.bind(this),workerCoreSettings:this.workerCoreSettings})}if(e.span&&e.type)switch(e.type){case"onStart":this.pulsarSignalProcessor.onStart(e.span.name,e.span);break;case"onEnd":this.pulsarSignalProcessor.onEnd(e.span.name,e.span)}}))))}notifyPulsarConsumer(e){var t;null===(t=this.router)||void 0===t||t.postMessage("pulsarSignal",e)}createSecondPartyLogger(e,t,s){var r;this.secondPartyLoggers[e]={token:t,useTeamsContext:s},null===(r=this.telemetryTransport)||void 0===r||r.createNewSecondPartyLogger(e,t,s)}reinitTelemetryTransport(e,t){var s,r,i;null===(s=this.telemetryTransport)||void 0===s||s.flushForReinit(t);const a=e.enableOneDsSdkNs?e.oneDsCollectorUrl||"":e.config.collectorUrl||"",l=this.existingTransports[a];l?l.statusParams.active?this.telemetryTransport=l:(this.telemetryTransport=l,Object.keys(this.firstPartyLoggers).forEach((e=>{var t,s,r;(null===(t=this.telemetryTransport)||void 0===t?void 0:t.statusParams.firstPartyLoggerTokens[e])&&(null===(s=this.telemetryTransport)||void 0===s?void 0:s.statusParams.firstPartyLoggerTokens[e])===this.firstPartyLoggers[e]||null===(r=this.telemetryTransport)||void 0===r||r.createNewLogger(o.h[e],this.firstPartyLoggers[e])})),Object.keys(this.secondPartyLoggers).forEach((e=>{var t,s,r;(null===(t=this.telemetryTransport)||void 0===t?void 0:t.statusParams.secondPartyLoggerTokens[e])&&(null===(s=this.telemetryTransport)||void 0===s?void 0:s.statusParams.secondPartyLoggerTokens[e])===this.secondPartyLoggers[e].token||null===(r=this.telemetryTransport)||void 0===r||r.createNewSecondPartyLogger(e,this.secondPartyLoggers[e].token,this.secondPartyLoggers[e].useTeamsContext)})),Object.keys(this.contextMap).forEach((e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.setContext({key:e,value:this.contextMap[e]})})),this.telemetryTransport.start()):(this.initTelemetryTransport(e),null===(r=this.telemetryTransport)||void 0===r||r.createNewLogger(e.defaultLoggerName||o.h.default,e.appTokens.default),null===(i=this.telemetryTransport)||void 0===i||i.logSession(t,{name:e.defaultLoggerName||o.h.default,state:n.sM.STARTED,sessionId:e.sessionId,sessionStartTime:e.sessionStartTime}),Object.keys(this.firstPartyLoggers).forEach((e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.createNewLogger(o.h[e],this.firstPartyLoggers[e])})),Object.keys(this.secondPartyLoggers).forEach((e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.createNewSecondPartyLogger(e,this.secondPartyLoggers[e].token,this.secondPartyLoggers[e].useTeamsContext)})),Object.keys(this.contextMap).forEach((e=>{var t;null===(t=this.telemetryTransport)||void 0===t||t.setContext({key:e,value:this.contextMap[e]})})))}initTelemetryTransport(e){var t;e.enableDebugTrace?e.config.log=this:e.config.log=void 0,e.enableOneDsSdkNs?(this.enableOneDsSdk=!0,this.telemetryTransport=new p,this.existingTransports[e.oneDsCollectorUrl||"defaultOneDsUrl"]=this.telemetryTransport):(this.telemetryTransport=new a,this.existingTransports[e.config.collectorUrl||"defaultAriaUrl"]=this.telemetryTransport),this.telemetryTransport.initialize(e),this.transportDelayed&&(null===(t=this.router)||void 0===t||t.postMessage("workerInitialized"))}}},561890:(e,t,s)=>{s.d(t,{t:()=>r});class r{constructor(){this.messageHandlers={},this.registerMessageHandler("batch",(e=>{for(const t of e)if(t&&t.name){const e=this.messageHandlers[t.name];e&&e(t.params)}this.postMessage("batchDone")}))}registerMessageHandler(e,t){this.messageHandlers[e]?console.warn(`message handler already registered for - ${e}`):this.messageHandlers[e]=t}unregisterMessageHandler(e){delete this.messageHandlers[e]}}},589008:(e,t,s)=>{s.d(t,{Mk:()=>y,sE:()=>f});var r=s(100836);class i{static IsSafariOrFirefox(){return null===i._isSafariOrFirefox&&i._DetectBrowser(),i._isSafariOrFirefox}static ajax(e){var t=i._createConnection();if(e.headers){var s="qsp=true";for(var r in e.headers)s+="&",s+=encodeURIComponent(r),s+="=",s+=encodeURIComponent(e.headers[r]);e.url.indexOf("?")<0?e.url+="?":e.url+="&",e.url+=s}t.open(e.type,e.url),e.complete&&(t.onload=()=>{void 0===t.status&&(t.status=200),e.complete(t)},t.ontimeout=()=>{void 0===t.status&&(t.status=500),e.complete(t)},t.onerror=()=>{e.complete(t)}),t.send(e.data)}static keys(e){if(Object.keys)return Object.keys(e);var t=[];for(var s in e)e.hasOwnProperty(s)&&t.push(s);return t}static IsUsingXDomainRequest(){null==i._usingXDomainRequest&&(void 0===(new XMLHttpRequest).withCredentials&&"undefined"!=typeof XDomainRequest?i._usingXDomainRequest=!0:i._usingXDomainRequest=!1);return i._usingXDomainRequest}static _createConnection(){var e=new XMLHttpRequest;return i.IsUsingXDomainRequest()?new XDomainRequest:e}static _DetectBrowser(){var e=navigator.userAgent.toLowerCase();(e.indexOf("safari")>=0||e.indexOf("firefox")>=0)&&e.indexOf("chrome")<0?i._isSafariOrFirefox=!0:i._isSafariOrFirefox=!1}}i._isSafariOrFirefox=null,i._usingXDomainRequest=null;var n,a,o,l=s(878097),h=s(435098);class u{constructor(){this._buffer=[]}WriteByte(e){this._buffer.push(h.Mr.ToByte(e))}Write(e,t,s){for(;s--;)this.WriteByte(e[t++])}GetBuffer(){return this._buffer}}class d{constructor(){this.data=[]}WriteBlob(e){let t={type:"blob",value:e};this.data.push(t)}WriteBool(e){let t={type:"boolean",value:e};this.data.push(t)}WriteContainerBegin(e,t){let s={type:"containerBegin",size:e,elementType:t};this.data.push(s)}WriteMapContainerBegin(e,t,s){let r={type:"mapContainerBegin",size:e,keyType:t,valueType:s};this.data.push(r)}WriteContainerEnd(){this.data.push({type:"containerEnd"})}WriteDouble(e){let t={type:"number",value:e};this.data.push(t)}WriteFloat(e){let t={type:"number",value:e};this.data.push(t)}WriteFieldBegin(e,t,s){let r={type:"fieldBegin",id:t};this.data.push(r)}WriteFieldEnd(){this.data.push({type:"fieldEnd"})}WriteFieldOmitted(e,t,s){let r={type:"fieldOmitted",id:t};this.data.push(r)}WriteInt16(e){let t={type:"number",value:e};this.data.push(t)}WriteInt32(e){let t={type:"number",value:e};this.data.push(t)}WriteInt64(e){let t={type:"number",value:4294967296*e.high+e.low};this.data.push(t)}WriteInt8(e){let t={type:"number",value:e};this.data.push(t)}WriteString(e){let t={type:"string",value:e};this.data.push(t)}WriteStructBegin(e,t){let s={type:"structBegin",isBase:t};this.data.push(s)}WriteStructEnd(e){let t={type:"structEnd",isBase:e};this.data.push(t)}WriteUInt16(e){let t={type:"number",value:e};this.data.push(t)}WriteUInt32(e){let t={type:"number",value:e};this.data.push(t)}WriteUInt64(e){let t={type:"number",value:e};this.data.push(t)}WriteUInt8(e){let t={type:"number",value:e};this.data.push(t)}WriteWString(e){let t={type:"string",value:e};this.data.push(t)}}!function(e){e[e.ECS_ERROR_OK=0]="ECS_ERROR_OK",e[e.ECS_ERROR_INVALID_STATUS=1]="ECS_ERROR_INVALID_STATUS",e[e.ECS_ERROR_INVALID_RESPONSE=6]="ECS_ERROR_INVALID_RESPONSE",e[e.ECS_ERROR_INVALID_CONFIG=8]="ECS_ERROR_INVALID_CONFIG"}(n||(n={}));!function(e){e[e.CONFIG_UPDATED=0]="CONFIG_UPDATED",e[e.TOKEN_IS_INVALID=1]="TOKEN_IS_INVALID"}(a||(a={}));class c{}c.Servers=["https://config.teams.microsoft.com/config/v1/Skype/"],c.RefreshIntervalInMS=36e5,c.FailedRetryFactorInMS=1e4,c.MaxRetryIntervalForFailedInMS=36e5,function(e){e[e.Created=0]="Created",e[e.Initialized=1]="Initialized",e[e.Started=2]="Started",e[e.Loading=3]="Loading"}(o||(o={}));var g,p,v,_=s(119830);!function(e){e[e.SENT=0]="SENT",e[e.SEND_FAILED=1]="SEND_FAILED"}(g||(g={})),function(e){e[e.DATARV_ERROR_OK=0]="DATARV_ERROR_OK",e[e.DATARV_ERROR_INVALID_EVENT=1]="DATARV_ERROR_INVALID_EVENT",e[e.DATARV_ERROR_INVALID_CONFIG=2]="DATARV_ERROR_INVALID_CONFIG",e[e.DATARV_ERROR_INVALID_DEPENDENCIES=3]="DATARV_ERROR_INVALID_DEPENDENCIES",e[e.DATARV_ERROR_INVALID_STATUS=4]="DATARV_ERROR_INVALID_STATUS",e[e.DATARV_ERROR_INVALID_ARG=5]="DATARV_ERROR_INVALID_ARG"}(p||(p={}));class m{constructor(e){this._errorCode=p.DATARV_ERROR_OK,this._errorCode=e}ErrorCode(){return this._errorCode}toString(){switch(this._errorCode){case p.DATARV_ERROR_OK:return"DATARV_ERROR_OK";case p.DATARV_ERROR_INVALID_EVENT:return"Event is invalid. Either event.Id is empty, or event.Timestamp is empty, or event.EventType is empty.";case p.DATARV_ERROR_INVALID_CONFIG:return"Invalid configuration. CollectorUrl is missing.";case p.DATARV_ERROR_INVALID_DEPENDENCIES:return"DATARV_ERROR_INVALID_DEPENDENCIES";case p.DATARV_ERROR_INVALID_STATUS:return"Telemetry Manager is not initialized.";case p.DATARV_ERROR_INVALID_ARG:return"TenantToken is null or empty, or events is null.";default:return"Unknown error"}}}class y{constructor(){this.eventsLimitInMem=1e4}}class f{static CreateTelemetryManager(){return new T}}class C{}C.MaxPackageSizeInBytes=3e6,C.TimeIntervalForNextSendInMS=15e3,function(e){e[e.Created=0]="Created",e[e.Initialized=1]="Initialized",e[e.Started=2]="Started"}(v||(v={}));class T{constructor(){this._MaxPackageSizeInBytes=C.MaxPackageSizeInBytes,this._listeners=[],this._status=v.Created,this._ecsClient=null,this._etag=null,this._ecsCallback=null,this._testServerResponseHook=null,this._testHookListeners=[]}Initialize(e){if(this._status!=v.Created)throw new m(p.DATARV_ERROR_INVALID_STATUS);if(!e||!e.collectorUrl)throw new m(p.DATARV_ERROR_INVALID_CONFIG);this._config=e,this._Reset(),this._status=v.Initialized,e.ecsClient&&(this._Verbose("ECS object assigned. Do integration"),this._ecsClient=e.ecsClient),e.overwriteSendTimeInterval&&e.overwriteSendTimeInterval>=0&&(C.TimeIntervalForNextSendInMS=e.overwriteSendTimeInterval),this._Verbose("Initialize() done")}setEventsLimitInMem(e){this._eventsCache.setEventsLimitInMem(e)}AddListener(e){if(this._status<v.Initialized)throw new m(p.DATARV_ERROR_INVALID_STATUS);this._Verbose(["AddListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e)return void this._Verbose("the listener has been added already, index: "+t);this._listeners.push(e),this._Verbose("AddListener() done, the new length: "+this._listeners.length)}RemoveListener(e){if(this._status<v.Initialized)throw new m(p.DATARV_ERROR_INVALID_STATUS);this._Verbose(["RemoveListener(), status: ",this._status," old length: ",this._listeners.length," func: ",e].join(""));for(var t=0;t<this._listeners.length;++t)if(this._listeners[t]==e)return 1==this._listeners.length?this._listeners=[]:t==this._listeners.length-1?this._listeners.pop():this._listeners[t]=this._listeners.pop(),void this._Verbose(["this listener has been found, index: ",t,"new length: ",this._listeners.length].join(""));this._Verbose("listener isn't been found, new length"+this._listeners.length)}Start(){if(this._status<v.Initialized)throw new m(p.DATARV_ERROR_INVALID_STATUS);this._Verbose(["Start(), status:",this._status,"tag:",T._tag].join(" ")),this._status>=v.Started&&this._Verbose("Start() already, ignore"),this._ecsClient&&(this._ecsCallback=this._CreateEcsCallback(),this._ecsClient.AddListener(this._ecsCallback),this._etag=this._ecsClient.GetETag()),++T._tag,this._status=v.Started,this._Verbose(["Start() done, status: ",this._status,"tag: ",T._tag].join(""))}Stop(){if(this._status<v.Initialized)throw new m(p.DATARV_ERROR_INVALID_STATUS);this._Verbose("Stop(), status: "+this._status),this._status!=v.Initialized?(this._Reset(),this._status=v.Initialized,this._Verbose("Stop() done, status: "+this._status)):this._Verbose("Stop() already, ignore")}Flush(e){this._eventsCache.IsEmpty()||this._WorkThread(e)}SendAsync(e,t){var s;if(this._status<v.Initialized)throw new m(p.DATARV_ERROR_INVALID_STATUS);if(this._Verbose(["SendAsync(), status:",this._status,"tenantToken:",e,"count:",t.length].join(" ")),this._status<v.Started)return this._Info("SendAsync(), not started, ignore, return false"),!1;if(!e||!t)throw this._Error("SendAsync(), tenantToken or events is null or empty"),new m(p.DATARV_ERROR_INVALID_ARG);for(var r=0;r<t.length;++r)if(!t[r].Id||!T._eventTypeRegex.test(t[r].EventType)||t[r].Timestamp.Equals("0"))throw this._Error(["eventId:",t[r].Id,"eventType:",t[r].EventType,"timestamp high:",t[r].Timestamp.high,"timestamp low:",t[r].Timestamp.low].join("")),new m(p.DATARV_ERROR_INVALID_EVENT);return null===(s=this._eventsCache)||void 0===s||s.AddEvents(e,t),this._Verbose(["SendAsync(), currentTimer: ",this._timer,"eventsCacheIsEmpty",this._eventsCache.IsEmpty()].join(" ")),this._eventsCache.IsEmpty()||this._timer||this._ScheduleTimer(!1),this._Verbose("SendAsync() done"),!0}_WorkThread(e){var t;try{var s=Date.now();if(this._Verbose("_WorkThread, status: "+this._status),this._status<v.Started)return void this._Verbose("_WorkThread, status is not started, return");var r=this._eventsCache.DequeuEvents();if(null==r)return this._Verbose("_WorkThread, No events found, return"),void this._CleanTimer();var n=r.events.length,a=this._PackEvents(r.tenantToken,r.events);null===(t=this._eventsCache)||void 0===t||t.AddEvents(r.tenantToken,a.remainedEvents);var o=a.remainedEvents.length;if(null==a.buffer||0==a.buffer.length)return void(this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1)));if(this._testHookListeners)for(var h=0;h<this._testHookListeners.length;++h)this._testHookListeners[h](a.sendEvents);if(this._testServerResponseHook){var u=this._testServerResponseHook();return void setTimeout((()=>this._SendCallback(c,r.tenantToken,a.sendEvents,u,null)),100)}var d={type:"POST",url:this._config.collectorUrl,processData:!1,headers:{"content-type":"application/bond-compact-binary","client-id":"NO_AUTH","sdk-version":"ACT-Web-JS-"+_.w.version},complete:t=>this._SendCallback(c,r.tenantToken,a.sendEvents,t,e)};this._config.useJsonTextStream?(d.data=a.buffer,d.headers["content-type"]="application/json"):i.IsSafariOrFirefox()||"undefined"==typeof Uint8Array?(this._Verbose("Uint8Array is undefined, send with base64 encode."),d.data=l.DS.GetString(a.buffer),d.headers["content-encoding"]="base64"):(this._Verbose("Uint8Array is defined, send with binary format directly."),d.data=new Uint8Array(a.buffer)),r.tenantToken&&(d.headers["x-apikey"]=r.tenantToken);var c=T._tag;this._lastActiveTime=(new Date).getTime(),i.ajax(d),this._Verbose("_Workthread, send via jquery, tag: "+c),this._Info("Processing telemetry events took "+(Date.now()-s)+" ms for "+(n-o)+" events with total size of "+a.buffer.length+" bytes, remaining events - "+o)}catch(e){this._Error("_WorkThread, exception: "+e)}}_PackEvents(e,t){this._Verbose("_PackageEvents, total Count: "+t.length);var s,i=new r.$L,n=new r.Pm;n.Source="JS_default_source",n.DataPackageId=r.P6.GetGuid(),n.Timestamp=r.P6.GetTimeStamp();var a=t;if(t=[],a.length>200){var o=a.splice(0,200);t.push.apply(t,a),a=o}for(;n.Records=[],n.Records.push.apply(n.Records,a),i.DataPackages=[],i.DataPackages.push(n),s=this._Serialize(i),this._Verbose(["_PackageEvents, sendEvents.length:",a.length," buffer.length:",s.length," MaxPackageSize:",this._MaxPackageSizeInBytes].join("")),!(s.length<this._MaxPackageSizeInBytes);){if(1==a.length){a=[],s=null;break}var l=a.splice(0,Math.floor(a.length/2));this._Verbose("_PackageEvents, too large, package again"),t.push.apply(t,a),a=l}return this._Verbose(["_PakcageEvents done, sendEventsCount:",a.length,"buffer.length:",null==s?0:s.length,"remained events:",t.length].join("")),{buffer:s,sendEvents:a,remainedEvents:t}}_Serialize(e){if(this._config.useJsonTextStream){var t=new d;return e.Write(t),JSON.stringify(t.data)}var s=new u,r=new h.rH(s);return e.Write(r),s.GetBuffer()}_SendCallback(e,t,s,r,i){var n;if(this._Verbose(["_SendCallback","tag:",e,"current tag:",T._tag,"tenantToken:",t,"events count:",s.length,"jqXHR:",r].join("")),null==i){var a=null!=r&&r.status>=200&&r.status<300;if(this._status<v.Started||e<T._tag)this._Verbose("_SendCallback, is not started, or tag is not the same, return");else{if(!(a||r&&400==r.status))return this._Verbose("retry statusCode: "+(r?r.status:0)),null===(n=this._eventsCache)||void 0===n||n.AddEvents(t,s),void this._ScheduleTimer(!0);for(var o=0;o<this._listeners.length;++o)this._listeners[o](a?g.SENT:g.SEND_FAILED,r?r.status:0,t,s);this._eventsCache.IsEmpty()?(this._Verbose("eventsCache is empty, stop schedule"),this._CleanTimer()):(this._Verbose("eventsCache is not empty, schedule for next run"),this._ScheduleTimer(!1))}}else i(r?r.status:0,t,s)}_CleanTimer(){this._Verbose("_CleanTimer(), timer: "+this._timer),this._timer&&(clearTimeout(this._timer),this._timer=null)}_ScheduleTimer(e){if(this._Verbose("_ScheduleTimer: isRetry: "+e),this._CleanTimer(),e){this._Verbose("_ScheduleTimer, current factor: "+this._rescheduleFactor);t=Math.floor(5*this._rescheduleFactor*(1+Math.random()));this._timer=setTimeout((()=>this._WorkThread(null)),1e3*t),this._Verbose("_ScheduleTimer, next try (s): "+t),this._rescheduleFactor<<=1,this._rescheduleFactor>64&&(this._rescheduleFactor=1)}else{var t=0,s=(new Date).getTime()-this._lastActiveTime;t=s>C.TimeIntervalForNextSendInMS?0:C.TimeIntervalForNextSendInMS-s,this._timer=setTimeout((()=>this._WorkThread(null)),t),this._Verbose("_ScheduleTimer, next try: "+t),this._rescheduleFactor=1}}_Verbose(e){this._config.log&&this._config.log.Verbose("[TelemetryManagerImpl]: "+e)}_Info(e){this._config.log&&this._config.log.Info("[TelemetryManagerImpl]: "+e)}_Error(e){this._config.log&&this._config.log.Error("[TelemetryManagerImpl]: "+e)}_Reset(){this._Verbose("Reset()"),this._CleanTimer(),this._lastActiveTime=0,this._rescheduleFactor=1,this._sendingEvents=[],this._eventsCache=new I(this._config.log,this._config.eventsLimitInMem),this._ecsClient&&(this._ecsClient.RemoveListener(this._ecsCallback),this._ecsCallback=null)}_CreateEcsCallback(){return e=>{e==a.CONFIG_UPDATED&&(this._etag=this._ecsClient.GetETag())}}__AddTestHookListener(e){if(this._status<v.Initialized)throw new m(p.DATARV_ERROR_INVALID_STATUS);for(var t=0;t<this._testHookListeners.length;++t)if(this._testHookListeners[t]==e)return;this._testHookListeners.push(e)}__ClearTestHookListener(){this._testHookListeners=[]}__GetListenerArray(){return this._listeners}__GetTotalEventsCount(){return this._eventsCache.GetTotalEventsCount()}__IsScheduled(){return null!=this._timer}__ChageMaxPackageSizeInKB(e){this._MaxPackageSizeInBytes=1024*e}__SetTestServerResponseHook(e){this._testServerResponseHook=e}}T._eventTypeRegex=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,T._tag=0;class I{constructor(e,t){this._logger=e,this._eventsLimitInMem=t,this._events={},this._tokens=[]}AddEvents(e,t){t.length&&(t.length>this._eventsLimitInMem?this._logDroppedEvents(e,t.length):(this._events[e]||(this._events[e]=[],this._tokens.push(e)),this._events[e].push.apply(this._events[e],t)))}IsEmpty(){return 0==this._tokens.length}DequeuEvents(){if(0==this._tokens.length)return null;var e=this._tokens.shift(),t=this._events[e];return delete this._events[e],{tenantToken:e,events:t}}GetTotalEventsCount(){var e=0;for(var t in this._events)e+=this._events[t].length;return e}setEventsLimitInMem(e){this._eventsLimitInMem=e}_logDroppedEvents(e,t){if(!this._logger)return;let s=0;this._events[e]&&(s=this._events[e].length),this._logger.Verbose(`[TelemetryEventCache]: Size of dropped events: ${t},\n      events size currently in queue for tenant ${e}: ${s}`)}}},119830:(e,t,s)=>{s.d(t,{w:()=>r});class r{static get version(){return"2.5.0"}}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/369093-c328108263956c83.js.map